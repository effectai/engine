<meta charset="UTF-8">
<div id="app" style="text-align: center">
  <h1>Effect AI - Sentence Verification </h1>

  <hr />

  <div class="mx-auto" style="max-width: 80%">

  <p class="mb-5">Is a linguistically correct sentence?</p>
  <div class="box">
    <p class="is-size-4 has-text-weight-semibold">{{sentence}}</p>
  </div>

  <div class="mb-5">
    <button class="button is-medium"
    :class="{ 'is-success': this.isValidated == 'Yes' }"
    @click="this.isValidated='Yes'">Yes</button>

    <button class="button is-medium mx-3"
    :class="{ 'is-dark': this.isValidated == 'Skip' }"
    @click="this.isValidated='Skip'">Skip</button>

    <button class="button is-medium"
    :class="{ 'is-danger': this.isValidated == 'No' }"
    @click="this.isValidated='No'">No</button>
  </div>

  <p style="color: red;"
  :class="{'is-hidden mb-3': !notComplete}">
    Task incomplete - Please complete all sections of the task
  </p>

  <button
    @click.prevent="uploadAndSubmit"
    class="button is-success is-large"
    :class="{'is-loading': btnLoading}"
  >
    Submit
  </button>
</div>

<!-- üìö Load in resources: [Bulma, Effect Network Styling]  -->
<link rel="stylesheet" href="https://unpkg.com/bulma@0.9.4/css/bulma.min.css" />
<link href="https://app.effect.network/force-defaults.css" rel="stylesheet" />

<script src="https://cdn.jsdelivr.net/npm/ipfs-http-client/dist/index.min.js"></script>
<script type="module">
  import { createApp } from "https://unpkg.com/vue@3/dist/vue.esm-browser.js";
  

  createApp({
    data() {
      return {
        title: "Effect AI Sentence Verifier",
        btnLoading: false,
        author: "${submissionByPeer}", 
        // incoming result - {"timestamp": "", "submissionByPeer": "", "taskId": "", "result": "JSON_STRING"}
        sentence: (JSON.parse("${result}")).values.answer, 
        isValidated: "",
        loading: true,
        notComplete: false,
        instructions: `
          <div>
            <h2>Verify a Sentence - Common Voice</h2>
            <p>
              In this task, you'll review short, simple, and natural sentences created by other contributors.
              Your goal is to decide whether each sentence follows the project guidelines and can be used to train AI models effectively.
            </p>

            <h3>1. Instructions</h3>
            <p>
              Your job is to carefully read each sentence and decide whether it is clear, natural, and written in good English.
              You should mark a sentence as <strong>‚ÄúYes‚Äù</strong> if it follows the rules below, or <strong>‚ÄúNo‚Äù</strong> if it does not. If 
              you are unsure, you may <strong>Skip</strong> it.
            </p>

            <h4>Sentence Verification Guidelines</h4>
            <ul>
              <li>The sentence should be short - fewer than 15 words.</li>
              <li>It must have proper grammar, spelling, and punctuation.</li>
              <li>It should sound natural and conversational, like everyday speech.</li>
              <li>Casual English is fine, but avoid confusing slang or unclear phrasing.</li>
              <li>The sentence should make complete sense on its own.</li>
            </ul>

            <h4>Mark as INCORRECT if you see:</h4>
            <ul>
              <li>Numbers or special characters (e.g. $, %, @, #, 123).</li>
              <li>Foreign letters or words not in English.</li>
              <li>Overly complex, unnatural, or technical language.</li>
              <li>Personal information (like names, addresses, phone numbers, or emails).</li>
              <li>Major spelling or grammar mistakes.</li>
              <li>Sentences that are too short or don't sound like natural speech.</li>
            </ul>

            <h3>2. Examples</h3>
            <p><strong>‚úÖ Correct Sentences</strong></p>
            <ul>
              <li>I enjoy walking home when the weather feels calm.</li>
              <li>She left her jacket on the chair by the door.</li>
              <li>We usually talk quietly while eating dinner together.</li>
            </ul>

            <p><strong>‚ùå Incorrect Sentences</strong></p>
            <ul>
              <li>THIS sentence has RANDOM capitalization and symbols!!! (unnatural formatting)</li>
              <li>The town has 24500 residents living there. (numbers not allowed)</li>
              <li>Walking home. Feeling tired. (fragmented and unnatural)</li>
              <li>Je vais au parc ce matin. (foreign language)</li>
            </ul>

            <h3>3. Tips for Success</h3>
            <ul>
              <li>Read the sentence out loud, it should sound natural and easy to say.</li>
              <li>If you have to read it twice to understand it, it's probably incorrect.</li>
              <li>Don't overthink it, use your common sense and trust your ear for natural English.</li>
            </ul>
          </div>
          `
      };
    },
    computed: {},
    created() {},
    mounted() {
      window.top.postMessage(
        {
          type: 'task-instructions',
          instructions: this.instructions
        },
        "*"
      );
    },
    methods: {
      async uploadAndSubmit() {
        this.btnLoading = true;
        if(this.isValidated == ""){
            this.notComplete = true
          }
        else
          try {
            parent.postMessage(
              {
                task: "submit",
                values: {
                  taskTitle: this.title,
                  author: this.author,
                  sentence: this.sentence,
                  isValidated: this.isValidated
                },
              },
              "*"
            );
          } catch (error) {
            console.error("Failed to upload to IPFS", error);
          }
        this.btnLoading = false;
      },
    },
  }).mount("#app");
</script>
