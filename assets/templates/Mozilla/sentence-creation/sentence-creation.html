<meta charset="UTF-8">
<div id="app" style="text-align: center">
    <h1>Effect AI - Sentence Creator</h1>
  
    <hr />
  
    <div class="mx-auto" style="max-width: 80%">

      <div class="container is-max-desktop">
        <label class="label has-text-left">Sentence:</label>
        <textarea
          class="textarea"
          placeholder="Enter your sentence here"
          type="text" 
          v-model="sentence"
          @keydown.enter.prevent
        >
        </textarea>
      </div>
    
    <p class="is-size-7 mb-2">By clicking this button, you accept that the sentence contributed here will be added to a publicly available cc-0 licensed dataset.</p>

    <p style="color: red;"
    :class="{'is-hidden mb-3': !tooLong}">
      Sentence is too long - Sentence should be no longer than 15 words
    </p>

    <p style="color: red;"
    :class="{'is-hidden mb-3': !tooShort}">
      Sentence is too short - Sentence should be longer than 4 words
    </p>

    <button
      @click.prevent="uploadAndSubmit"
      class="button is-success is-large"
      :class="{'is-loading': btnLoading}"
    >
      Submit
    </button>
  </div>
  
  <!-- üìö Load in resources: [Bulma, Effect Network Styling]  -->
  <link rel="stylesheet" href="https://unpkg.com/bulma@0.9.4/css/bulma.min.css" />
  <link href="https://app.effect.network/force-defaults.css" rel="stylesheet" />
  
  <script src="https://cdn.jsdelivr.net/npm/ipfs-http-client/dist/index.min.js"></script>
  <script type="module">
    import { createApp } from "https://unpkg.com/vue@3/dist/vue.esm-browser.js";
  
    createApp({
      data() {
        return {
          title: "Effect AI Sentence Creator",
          sentence: "",
          btnLoading: false,
          tooShort: false,
          tooLong: false,
          instructions: `
          <div>
            <h2>Create a sentence - Common Voice</h2>
            <p>
              In this task, you'll be writing short, simple, and natural sentences that
              follow the guidelines below. The goal is to create clear and conversational
              text that's easy to read and helps train AI models effectively.
            </p>

            <h3>1. Instructions</h3>
            <p>
              Your job is to write short, natural sentences that follow the guidelines
              below. These sentences will be used to train AI models, so it's important
              they are clear, easy to understand, and written in good English.
            </p>

            <h4>Sentence Guidelines</h4>
            <ul>
              <li>Keep each sentence short ‚Äî fewer than 15 words.</li>
              <li>Write in proper grammar with correct spelling and punctuation.</li>
              <li>Use natural, conversational English that feels like everyday speech.</li>
              <li>
                Avoid slang that's hard to understand, but it's OK if the sentence feels
                casual.
              </li>
              <li>
                Each sentence should stand on its own (not depend on another sentence).
              </li>
            </ul>

            <h4>What NOT to Include</h4>
            <ul>
              <li>Numbers or special characters (e.g. $, %, @, #, 123).</li>
              <li>Foreign letters or words.</li>
              <li>Overly complex or technical language that's hard to read.</li>
              <li>Personal information (like names, addresses, phone numbers, or emails).</li>
            </ul>

            <h3>2. Examples</h3>
            <p><strong>‚úÖ Good Sentences</strong></p>
            <ul>
              <li>The sky is blue with light clouds.</li>
              <li>My dog likes to nap in the sun.</li>
              <li>People enjoy walking through the park.</li>
            </ul>

            <p><strong>‚ùå Bad Sentences</strong></p>
            <ul>
              <li>Sky IS bLUE &amp; FULL OF $HINY CLOUDS!!! (wrong spelling, special characters)</li>
              <li>The country has 331,449,281 people. (numbers not allowed)</li>
              <li>The sun sets. The moon rises. (too short, not conversational)</li>
            </ul>

            <h3>3. Tips for Success</h3>
            <ul>
              <li>Imagine you're writing something you would actually say out loud.</li>
              <li>Vary your topics so sentences aren't too similar.</li>
              <li>Read your sentence out loud. If it sounds awkward, rewrite it.</li>
            </ul>

            <h3>4. Example Starter Topics for Sentences</h3>
            <p>
              If you're not sure what to write about, here are some broad topics you can
              use for inspiration. Each one can spark many short, natural sentences.
            </p>

            <ul>
              <li>
                <strong>Food &amp; Drinks</strong><br />
                <em>Example:</em> ‚ÄúI enjoy warm bread with butter on quiet mornings.‚Äù
              </li>

              <li>
                <strong>Weather &amp; Seasons</strong><br />
                <em>Example:</em> ‚ÄúDark clouds gathered as the air suddenly turned cooler.‚Äù
              </li>

              <li>
                <strong>Animals &amp; Pets</strong><br />
                <em>Example:</em> ‚ÄúMy dog waits by the door whenever I grab my jacket.‚Äù
              </li>

              <li>
                <strong>Daily Routines</strong><br />
                <em>Example:</em> ‚ÄúI check my calendar while drinking coffee every morning.‚Äù
              </li>

              <li>
                <strong>Home &amp; Family</strong><br />
                <em>Example:</em> ‚ÄúMy brother cooks dinner while we talk about our day.‚Äù
              </li>

              <li>
                <strong>Nature &amp; Outdoors</strong><br />
                <em>Example:</em> ‚ÄúLeaves rustled softly as the wind moved through the park.‚Äù
              </li>

              <li>
                <strong>Travel and Places</strong><br />
                <em>Example:</em> ‚ÄúThe train arrives early near the old stone bridge.‚Äù
              </li>

              <li>
                <strong>School &amp; Learning</strong><br />
                <em>Example:</em> ‚ÄúShe studies quietly while taking notes from the textbook.‚Äù
              </li>

              <li>
                <strong>Work &amp; Hobbies</strong><br />
                <em>Example:</em> ‚ÄúI practice guitar chords after work to relax.‚Äù
              </li>

              <li>
                <strong>Feelings &amp; Opinions</strong><br />
                <em>Example:</em> ‚ÄúI feel proud when my hard work finally pays off.‚Äù
              </li>
            </ul>
          </div>

        `
        };
      },
      computed: {},
      created() {},
      mounted() {
        window.top.postMessage(
        {
          type: 'task-instructions',
          instructions: this.instructions
        },
        "*"
      );
      },
      methods: {
        sanitize(text) {
          text = text
          .replace(/\r\n/g, '\n')      // normalize Windows newlines
          .replace(/[ \t]+$/gm, '')    // remove trailing spaces per line
          .replace(/\n{2,}/g, '\n')    // collapse multiple blank lines
          .trim();  

          return text
        },
        async uploadAndSubmit() {
          this.btnLoading = true;

          const cleanSentence = this.sanitize(this.sentence).trim();
          const wordCount = cleanSentence.split(/\s+/).length;

          this.tooShort = false;
          this.tooLong = false;

          if (cleanSentence === "") {
            this.notComplete = true;
          } else if (wordCount < 5) {
            this.tooShort = true;
          } else if (wordCount > 15) {
            this.tooLong = true;
          } 
          else {
            try {
              parent.postMessage(
                {
                  task: "submit",
                  values: {
                    taskTitle: this.title,
                    answer: cleanSentence,
                  },
                },
                "*"
              );
            } catch (error) {
              console.error("Failed to upload to IPFS", error);
            }
          }

          this.btnLoading = false;
        },
      },
    }).mount("#app");
  </script>