<div id="app" style="text-align: center">
  <h1>Effect AI - Sentence Verification </h1>

  <hr />

  <div class="mx-auto" style="max-width: 80%">

  <p class="mb-5">Is a linguistically correct sentence?</p>
  <div class="box">
    <p class="is-size-4 has-text-weight-semibold">{{sentence.values.answer}}</p>
  </div>

  <div class="mb-5">
    <button class="button is-medium"
    :class="{ 'is-success': this.isValidated == 'Yes' }"
    @click="this.isValidated='Yes'">Yes</button>

    <button class="button is-medium mx-3"
    :class="{ 'is-dark': this.isValidated == 'Skip' }"
    @click="this.isValidated='Skip'">Skip</button>

    <button class="button is-medium"
    :class="{ 'is-danger': this.isValidated == 'No' }"
    @click="this.isValidated='No'">No</button>
  </div>

  <p style="color: red;"
  :class="{'is-hidden mb-3': !notComplete}">
    Task incomplete - Please complete all sections of the task
  </p>

  <button
    @click.prevent="uploadAndSubmit"
    class="button is-success is-large"
    :class="{'is-loading': btnLoading}"
  >
    Submit
  </button>
</div>

<!-- ğŸ“š Load in resources: [Bulma, Effect Network Styling]  -->
<link rel="stylesheet" href="https://unpkg.com/bulma@0.9.4/css/bulma.min.css" />
<link href="https://app.effect.network/force-defaults.css" rel="stylesheet" />

<script src="https://cdn.jsdelivr.net/npm/ipfs-http-client/dist/index.min.js"></script>
<script type="module">
  import { createApp } from "https://unpkg.com/vue@3/dist/vue.esm-browser.js";
  

  createApp({
    data() {
      return {
        title: "Effect AI Sentence Verifier",
        btnLoading: false,
        author: "${submissionByPeer}", 
        // incoming result - {"timestamp": "", "submissionByPeer": "", "taskId": "", "result": "JSON_STRING"}
        sentence: JSON.parse("${result}"), 
        isValidated: "",
        loading: true,
        notComplete: false,
        instructions: `
          <div>
            <h2>Verify a Sentence - Common Voice</h2>
            <p>
              In this task, you'll review short, simple, and natural sentences created by other contributors.
              Your goal is to decide whether each sentence follows the project guidelines and can be used to train AI models effectively.
            </p>

            <h3>1. Instructions</h3>
            <p>
              Your job is to carefully read each sentence and decide whether it is clear, natural, and written in good English.
              You should mark a sentence as <strong>â€œCorrectâ€</strong> if it follows the rules below, or <strong>â€œIncorrectâ€</strong> if it does not.
            </p>

            <h4>Sentence Verification Guidelines</h4>
            <ul>
              <li>The sentence should be short â€” fewer than 15 words.</li>
              <li>It must have proper grammar, spelling, and punctuation.</li>
              <li>It should sound natural and conversational, like everyday speech.</li>
              <li>Casual English is fine, but avoid confusing slang or unclear phrasing.</li>
              <li>The sentence should make complete sense on its own.</li>
            </ul>

            <h4>Mark as INCORRECT if you see:</h4>
            <ul>
              <li>Numbers or special characters (e.g. $, %, @, #, 123).</li>
              <li>Foreign letters or words not in English.</li>
              <li>Overly complex, unnatural, or technical language.</li>
              <li>Personal information (like names, addresses, phone numbers, or emails).</li>
              <li>Major spelling or grammar mistakes.</li>
              <li>Sentences that are too short or donâ€™t sound like natural speech.</li>
            </ul>

            <h3>2. Examples</h3>
            <p><strong>âœ… Correct Sentences</strong></p>
            <ul>
              <li>The sky is blue with light clouds.</li>
              <li>My dog likes to nap in the sun.</li>
              <li>People enjoy walking through the park.</li>
            </ul>

            <p><strong>âŒ Incorrect Sentences</strong></p>
            <ul>
              <li>Sky IS bLUE &amp; FULL OF $HINY CLOUDS!!! (wrong spelling, special characters)</li>
              <li>The country has 331,449,281 people. (numbers not allowed)</li>
              <li>The sun sets. The moon rises. (too short, not conversational)</li>
              <li>Mi perro duerme en la silla. (foreign language)</li>
            </ul>

            <h3>3. Tips for Success</h3>
            <ul>
              <li>Read the sentence out loud â€” it should sound natural and easy to say.</li>
              <li>If you have to read it twice to understand it, itâ€™s probably incorrect.</li>
              <li>Donâ€™t overthink it â€” use your common sense and trust your ear for natural English.</li>
            </ul>

            <h3>4. Common Sentence Topics Youâ€™ll See</h3>
            <p>
              Sentences often describe simple, everyday topics. You donâ€™t need to judge the topic â€”
              just check that the sentence follows the rules and sounds natural.
            </p>

            <ul>
              <li><strong>Food &amp; Drinks</strong> â€” â€œI like fresh bread.â€</li>
              <li><strong>Weather &amp; Seasons</strong> â€” â€œThe sky is cloudy today.â€</li>
              <li><strong>Animals &amp; Pets</strong> â€” â€œMy dog sleeps on the chair.â€</li>
              <li><strong>Daily Routines</strong> â€” â€œI brush my teeth at night.â€</li>
              <li><strong>Home &amp; Family</strong> â€” â€œMy sister reads in the living room.â€</li>
              <li><strong>Nature &amp; Outdoors</strong> â€” â€œThe forest is full of tall trees.â€</li>
              <li><strong>Travel and Places</strong> â€” â€œThe bus stops near the library.â€</li>
              <li><strong>School &amp; Learning</strong> â€” â€œThe student writes in a notebook.â€</li>
              <li><strong>Work &amp; Hobbies</strong> â€” â€œI play guitar in the evening.â€</li>
              <li><strong>Feelings &amp; Opinions</strong> â€” â€œI feel happy when I see my friends.â€</li>
            </ul>
          </div>
          `
      };
    },
    computed: {},
    created() {},
    mounted() {
      window.top.postMessage(
        {
          type: 'task-instructions',
          instructions: this.instructions
        },
        "*"
      );
    },
    methods: {
      async uploadAndSubmit() {
        this.btnLoading = true;
        if(this.isValidated == ""){
            this.notComplete = true
          }
        else
          try {
            parent.postMessage(
              {
                task: "submit",
                values: {
                  taskTitle: this.title,
                  author: this.author,
                  sentence: this.sentence.values.answer,
                  isValidated: this.isValidated
                },
              },
              "*"
            );
          } catch (error) {
            console.error("Failed to upload to IPFS", error);
          }
        this.btnLoading = false;
      },
    },
  }).mount("#app");
</script>
