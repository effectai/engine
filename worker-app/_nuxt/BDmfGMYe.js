import{B as Buffer,b9 as Buffer$1,b6 as process$1,a7 as defineStore,l as ref$1,a8 as shallowRef,k as computed,bm as useState}from"#entry";import{c as useLocalStorage}from"./BoYffTjC.js";const empty$1=Object.freeze(Object.create(null,{__mock__:{get:()=>!0}})),empty$2=Object.freeze(Object.defineProperty({__proto__:null,default:empty$1},Symbol.toStringTag,{value:"Module"}));function _typeof(g){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},_typeof(g)}function toPrimitive(g,u){if(_typeof(g)!="object"||!g)return g;var h=g[Symbol.toPrimitive];if(h!==void 0){var y=h.call(g,u);if(_typeof(y)!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return(u==="string"?String:Number)(g)}function toPropertyKey(g){var u=toPrimitive(g,"string");return _typeof(u)=="symbol"?u:u+""}function _defineProperty(g,u,h){return(u=toPropertyKey(u))in g?Object.defineProperty(g,u,{value:h,enumerable:!0,configurable:!0,writable:!0}):g[u]=h,g}var TaskExpiredError=class extends Error{constructor(g){super(g),this.name="TaskExpiredError"}},TaskValidationError=class extends Error{constructor(g){super(g),this.name="TaskValidationError"}},EffectProtocolError=class extends Error{constructor(g,u){super(u),this.code=g,this.name="ProtocolError"}};const crypto$2=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function isBytes$3(g){return g instanceof Uint8Array||ArrayBuffer.isView(g)&&g.constructor.name==="Uint8Array"}function anumber$1(g){if(!Number.isSafeInteger(g)||g<0)throw new Error("positive integer expected, got "+g)}function abytes$2(g,...u){if(!isBytes$3(g))throw new Error("Uint8Array expected");if(u.length>0&&!u.includes(g.length))throw new Error("Uint8Array expected of length "+u+", got length="+g.length)}function ahash(g){if(typeof g!="function"||typeof g.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");anumber$1(g.outputLen),anumber$1(g.blockLen)}function aexists$1(g,u=!0){if(g.destroyed)throw new Error("Hash instance has been destroyed");if(u&&g.finished)throw new Error("Hash#digest() has already been called")}function aoutput$1(g,u){abytes$2(g);const h=u.outputLen;if(g.length<h)throw new Error("digestInto() expects output buffer of length at least "+h)}function clean$1(...g){for(let u=0;u<g.length;u++)g[u].fill(0)}function createView$2(g){return new DataView(g.buffer,g.byteOffset,g.byteLength)}function rotr$1(g,u){return g<<32-u|g>>>u}const hasHexBuiltin=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",hexes$1=Array.from({length:256},(g,u)=>u.toString(16).padStart(2,"0"));function bytesToHex$1(g){if(abytes$2(g),hasHexBuiltin)return g.toHex();let u="";for(let h=0;h<g.length;h++)u+=hexes$1[g[h]];return u}const asciis$1={_0:48,_9:57,A:65,F:70,a:97,f:102};function asciiToBase16$1(g){if(g>=asciis$1._0&&g<=asciis$1._9)return g-asciis$1._0;if(g>=asciis$1.A&&g<=asciis$1.F)return g-(asciis$1.A-10);if(g>=asciis$1.a&&g<=asciis$1.f)return g-(asciis$1.a-10)}function hexToBytes$2(g){if(typeof g!="string")throw new Error("hex string expected, got "+typeof g);if(hasHexBuiltin)return Uint8Array.fromHex(g);const u=g.length,h=u/2;if(u%2)throw new Error("hex string expected, got unpadded hex of length "+u);const y=new Uint8Array(h);for(let v=0,b=0;v<h;v++,b+=2){const w=asciiToBase16$1(g.charCodeAt(b)),E=asciiToBase16$1(g.charCodeAt(b+1));if(w===void 0||E===void 0){const _=g[b]+g[b+1];throw new Error('hex string expected, got non-hex character "'+_+'" at index '+b)}y[v]=w*16+E}return y}function utf8ToBytes$3(g){if(typeof g!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(g))}function toBytes$2(g){return typeof g=="string"&&(g=utf8ToBytes$3(g)),abytes$2(g),g}function concatBytes$2(...g){let u=0;for(let y=0;y<g.length;y++){const v=g[y];abytes$2(v),u+=v.length}const h=new Uint8Array(u);for(let y=0,v=0;y<g.length;y++){const b=g[y];h.set(b,v),v+=b.length}return h}let Hash$1=class{};function createHasher(g){const u=y=>g().update(toBytes$2(y)).digest(),h=g();return u.outputLen=h.outputLen,u.blockLen=h.blockLen,u.create=()=>g(),u}function randomBytes$3(g=32){if(crypto$2&&typeof crypto$2.getRandomValues=="function")return crypto$2.getRandomValues(new Uint8Array(g));if(crypto$2&&typeof crypto$2.randomBytes=="function")return Uint8Array.from(crypto$2.randomBytes(g));throw new Error("crypto.getRandomValues must be defined")}function setBigUint64$2(g,u,h,y){if(typeof g.setBigUint64=="function")return g.setBigUint64(u,h,y);const v=BigInt(32),b=BigInt(4294967295),w=Number(h>>v&b),E=Number(h&b),_=y?4:0,S=y?0:4;g.setUint32(u+_,w,y),g.setUint32(u+S,E,y)}function Chi$1(g,u,h){return g&u^~g&h}function Maj$1(g,u,h){return g&u^g&h^u&h}let HashMD$1=class extends Hash$1{constructor(u,h,y,v){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=u,this.outputLen=h,this.padOffset=y,this.isLE=v,this.buffer=new Uint8Array(u),this.view=createView$2(this.buffer)}update(u){aexists$1(this),u=toBytes$2(u),abytes$2(u);const{view:h,buffer:y,blockLen:v}=this,b=u.length;for(let w=0;w<b;){const E=Math.min(v-this.pos,b-w);if(E===v){const _=createView$2(u);for(;v<=b-w;w+=v)this.process(_,w);continue}y.set(u.subarray(w,w+E),this.pos),this.pos+=E,w+=E,this.pos===v&&(this.process(h,0),this.pos=0)}return this.length+=u.length,this.roundClean(),this}digestInto(u){aexists$1(this),aoutput$1(u,this),this.finished=!0;const{buffer:h,view:y,blockLen:v,isLE:b}=this;let{pos:w}=this;h[w++]=128,clean$1(this.buffer.subarray(w)),this.padOffset>v-w&&(this.process(y,0),w=0);for(let R=w;R<v;R++)h[R]=0;setBigUint64$2(y,v-8,BigInt(this.length*8),b),this.process(y,0);const E=createView$2(u),_=this.outputLen;if(_%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const S=_/4,A=this.get();if(S>A.length)throw new Error("_sha2: outputLen bigger than state");for(let R=0;R<S;R++)E.setUint32(4*R,A[R],b)}digest(){const{buffer:u,outputLen:h}=this;this.digestInto(u);const y=u.slice(0,h);return this.destroy(),y}_cloneInto(u){u||(u=new this.constructor),u.set(...this.get());const{blockLen:h,buffer:y,length:v,finished:b,destroyed:w,pos:E}=this;return u.destroyed=w,u.finished=b,u.length=v,u.pos=E,v%h&&u.buffer.set(y),u}clone(){return this._cloneInto()}};const SHA256_IV$1=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA512_IV=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),U32_MASK64$1=BigInt(2**32-1),_32n$1=BigInt(32);function fromBig$1(g,u=!1){return u?{h:Number(g&U32_MASK64$1),l:Number(g>>_32n$1&U32_MASK64$1)}:{h:Number(g>>_32n$1&U32_MASK64$1)|0,l:Number(g&U32_MASK64$1)|0}}function split$1(g,u=!1){const h=g.length;let y=new Uint32Array(h),v=new Uint32Array(h);for(let b=0;b<h;b++){const{h:w,l:E}=fromBig$1(g[b],u);[y[b],v[b]]=[w,E]}return[y,v]}const shrSH=(g,u,h)=>g>>>h,shrSL=(g,u,h)=>g<<32-h|u>>>h,rotrSH=(g,u,h)=>g>>>h|u<<32-h,rotrSL=(g,u,h)=>g<<32-h|u>>>h,rotrBH=(g,u,h)=>g<<64-h|u>>>h-32,rotrBL=(g,u,h)=>g>>>h-32|u<<64-h;function add(g,u,h,y){const v=(u>>>0)+(y>>>0);return{h:g+h+(v/2**32|0)|0,l:v|0}}const add3L=(g,u,h)=>(g>>>0)+(u>>>0)+(h>>>0),add3H=(g,u,h,y)=>u+h+y+(g/2**32|0)|0,add4L=(g,u,h,y)=>(g>>>0)+(u>>>0)+(h>>>0)+(y>>>0),add4H=(g,u,h,y,v)=>u+h+y+v+(g/2**32|0)|0,add5L=(g,u,h,y,v)=>(g>>>0)+(u>>>0)+(h>>>0)+(y>>>0)+(v>>>0),add5H=(g,u,h,y,v,b)=>u+h+y+v+b+(g/2**32|0)|0,SHA256_K$1=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_W$1=new Uint32Array(64);let SHA256$1=class extends HashMD$1{constructor(u=32){super(64,u,8,!1),this.A=SHA256_IV$1[0]|0,this.B=SHA256_IV$1[1]|0,this.C=SHA256_IV$1[2]|0,this.D=SHA256_IV$1[3]|0,this.E=SHA256_IV$1[4]|0,this.F=SHA256_IV$1[5]|0,this.G=SHA256_IV$1[6]|0,this.H=SHA256_IV$1[7]|0}get(){const{A:u,B:h,C:y,D:v,E:b,F:w,G:E,H:_}=this;return[u,h,y,v,b,w,E,_]}set(u,h,y,v,b,w,E,_){this.A=u|0,this.B=h|0,this.C=y|0,this.D=v|0,this.E=b|0,this.F=w|0,this.G=E|0,this.H=_|0}process(u,h){for(let R=0;R<16;R++,h+=4)SHA256_W$1[R]=u.getUint32(h,!1);for(let R=16;R<64;R++){const x=SHA256_W$1[R-15],T=SHA256_W$1[R-2],C=rotr$1(x,7)^rotr$1(x,18)^x>>>3,I=rotr$1(T,17)^rotr$1(T,19)^T>>>10;SHA256_W$1[R]=I+SHA256_W$1[R-7]+C+SHA256_W$1[R-16]|0}let{A:y,B:v,C:b,D:w,E,F:_,G:S,H:A}=this;for(let R=0;R<64;R++){const x=rotr$1(E,6)^rotr$1(E,11)^rotr$1(E,25),T=A+x+Chi$1(E,_,S)+SHA256_K$1[R]+SHA256_W$1[R]|0,I=(rotr$1(y,2)^rotr$1(y,13)^rotr$1(y,22))+Maj$1(y,v,b)|0;A=S,S=_,_=E,E=w+T|0,w=b,b=v,v=y,y=T+I|0}y=y+this.A|0,v=v+this.B|0,b=b+this.C|0,w=w+this.D|0,E=E+this.E|0,_=_+this.F|0,S=S+this.G|0,A=A+this.H|0,this.set(y,v,b,w,E,_,S,A)}roundClean(){clean$1(SHA256_W$1)}destroy(){this.set(0,0,0,0,0,0,0,0),clean$1(this.buffer)}};const K512=split$1(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(g=>BigInt(g))),SHA512_Kh=K512[0],SHA512_Kl=K512[1],SHA512_W_H=new Uint32Array(80),SHA512_W_L=new Uint32Array(80);class SHA512 extends HashMD$1{constructor(u=64){super(128,u,16,!1),this.Ah=SHA512_IV[0]|0,this.Al=SHA512_IV[1]|0,this.Bh=SHA512_IV[2]|0,this.Bl=SHA512_IV[3]|0,this.Ch=SHA512_IV[4]|0,this.Cl=SHA512_IV[5]|0,this.Dh=SHA512_IV[6]|0,this.Dl=SHA512_IV[7]|0,this.Eh=SHA512_IV[8]|0,this.El=SHA512_IV[9]|0,this.Fh=SHA512_IV[10]|0,this.Fl=SHA512_IV[11]|0,this.Gh=SHA512_IV[12]|0,this.Gl=SHA512_IV[13]|0,this.Hh=SHA512_IV[14]|0,this.Hl=SHA512_IV[15]|0}get(){const{Ah:u,Al:h,Bh:y,Bl:v,Ch:b,Cl:w,Dh:E,Dl:_,Eh:S,El:A,Fh:R,Fl:x,Gh:T,Gl:C,Hh:I,Hl:L}=this;return[u,h,y,v,b,w,E,_,S,A,R,x,T,C,I,L]}set(u,h,y,v,b,w,E,_,S,A,R,x,T,C,I,L){this.Ah=u|0,this.Al=h|0,this.Bh=y|0,this.Bl=v|0,this.Ch=b|0,this.Cl=w|0,this.Dh=E|0,this.Dl=_|0,this.Eh=S|0,this.El=A|0,this.Fh=R|0,this.Fl=x|0,this.Gh=T|0,this.Gl=C|0,this.Hh=I|0,this.Hl=L|0}process(u,h){for(let U=0;U<16;U++,h+=4)SHA512_W_H[U]=u.getUint32(h),SHA512_W_L[U]=u.getUint32(h+=4);for(let U=16;U<80;U++){const z=SHA512_W_H[U-15]|0,ne=SHA512_W_L[U-15]|0,ue=rotrSH(z,ne,1)^rotrSH(z,ne,8)^shrSH(z,ne,7),he=rotrSL(z,ne,1)^rotrSL(z,ne,8)^shrSL(z,ne,7),Y=SHA512_W_H[U-2]|0,X=SHA512_W_L[U-2]|0,J=rotrSH(Y,X,19)^rotrBH(Y,X,61)^shrSH(Y,X,6),j=rotrSL(Y,X,19)^rotrBL(Y,X,61)^shrSL(Y,X,6),M=add4L(he,j,SHA512_W_L[U-7],SHA512_W_L[U-16]),N=add4H(M,ue,J,SHA512_W_H[U-7],SHA512_W_H[U-16]);SHA512_W_H[U]=N|0,SHA512_W_L[U]=M|0}let{Ah:y,Al:v,Bh:b,Bl:w,Ch:E,Cl:_,Dh:S,Dl:A,Eh:R,El:x,Fh:T,Fl:C,Gh:I,Gl:L,Hh:$,Hl:B}=this;for(let U=0;U<80;U++){const z=rotrSH(R,x,14)^rotrSH(R,x,18)^rotrBH(R,x,41),ne=rotrSL(R,x,14)^rotrSL(R,x,18)^rotrBL(R,x,41),ue=R&T^~R&I,he=x&C^~x&L,Y=add5L(B,ne,he,SHA512_Kl[U],SHA512_W_L[U]),X=add5H(Y,$,z,ue,SHA512_Kh[U],SHA512_W_H[U]),J=Y|0,j=rotrSH(y,v,28)^rotrBH(y,v,34)^rotrBH(y,v,39),M=rotrSL(y,v,28)^rotrBL(y,v,34)^rotrBL(y,v,39),N=y&b^y&E^b&E,P=v&w^v&_^w&_;$=I|0,B=L|0,I=T|0,L=C|0,T=R|0,C=x|0,{h:R,l:x}=add(S|0,A|0,X|0,J|0),S=E|0,A=_|0,E=b|0,_=w|0,b=y|0,w=v|0;const O=add3L(J,M,P);y=add3H(O,X,j,N),v=O|0}({h:y,l:v}=add(this.Ah|0,this.Al|0,y|0,v|0)),{h:b,l:w}=add(this.Bh|0,this.Bl|0,b|0,w|0),{h:E,l:_}=add(this.Ch|0,this.Cl|0,E|0,_|0),{h:S,l:A}=add(this.Dh|0,this.Dl|0,S|0,A|0),{h:R,l:x}=add(this.Eh|0,this.El|0,R|0,x|0),{h:T,l:C}=add(this.Fh|0,this.Fl|0,T|0,C|0),{h:I,l:L}=add(this.Gh|0,this.Gl|0,I|0,L|0),{h:$,l:B}=add(this.Hh|0,this.Hl|0,$|0,B|0),this.set(y,v,b,w,E,_,S,A,R,x,T,C,I,L,$,B)}roundClean(){clean$1(SHA512_W_H,SHA512_W_L)}destroy(){clean$1(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const sha256$5=createHasher(()=>new SHA256$1),sha512$3=createHasher(()=>new SHA512);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$a=BigInt(0),_1n$c=BigInt(1);function _abool2(g,u=""){if(typeof g!="boolean"){const h=u&&`"${u}"`;throw new Error(h+"expected boolean, got type="+typeof g)}return g}function _abytes2(g,u,h=""){const y=isBytes$3(g),v=g?.length,b=u!==void 0;if(!y||b&&v!==u){const w=h&&`"${h}" `,E=b?` of length ${u}`:"",_=y?`length=${v}`:`type=${typeof g}`;throw new Error(w+"expected Uint8Array"+E+", got "+_)}return g}function numberToHexUnpadded$1(g){const u=g.toString(16);return u.length&1?"0"+u:u}function hexToNumber$1(g){if(typeof g!="string")throw new Error("hex string expected, got "+typeof g);return g===""?_0n$a:BigInt("0x"+g)}function bytesToNumberBE$1(g){return hexToNumber$1(bytesToHex$1(g))}function bytesToNumberLE$1(g){return abytes$2(g),hexToNumber$1(bytesToHex$1(Uint8Array.from(g).reverse()))}function numberToBytesBE$1(g,u){return hexToBytes$2(g.toString(16).padStart(u*2,"0"))}function numberToBytesLE$1(g,u){return numberToBytesBE$1(g,u).reverse()}function ensureBytes$1(g,u,h){let y;if(typeof u=="string")try{y=hexToBytes$2(u)}catch(b){throw new Error(g+" must be hex string or Uint8Array, cause: "+b)}else if(isBytes$3(u))y=Uint8Array.from(u);else throw new Error(g+" must be hex string or Uint8Array");const v=y.length;if(typeof h=="number"&&v!==h)throw new Error(g+" of length "+h+" expected, got "+v);return y}function copyBytes$1(g){return Uint8Array.from(g)}const isPosBig=g=>typeof g=="bigint"&&_0n$a<=g;function inRange$1(g,u,h){return isPosBig(g)&&isPosBig(u)&&isPosBig(h)&&u<=g&&g<h}function aInRange(g,u,h,y){if(!inRange$1(u,h,y))throw new Error("expected valid "+g+": "+h+" <= n < "+y+", got "+u)}function bitLen$1(g){let u;for(u=0;g>_0n$a;g>>=_1n$c,u+=1);return u}const bitMask$1=g=>(_1n$c<<BigInt(g))-_1n$c;function createHmacDrbg$1(g,u,h){if(typeof g!="number"||g<2)throw new Error("hashLen must be a number");if(typeof u!="number"||u<2)throw new Error("qByteLen must be a number");if(typeof h!="function")throw new Error("hmacFn must be a function");const y=T=>new Uint8Array(T),v=T=>Uint8Array.of(T);let b=y(g),w=y(g),E=0;const _=()=>{b.fill(1),w.fill(0),E=0},S=(...T)=>h(w,b,...T),A=(T=y(0))=>{w=S(v(0),T),b=S(),T.length!==0&&(w=S(v(1),T),b=S())},R=()=>{if(E++>=1e3)throw new Error("drbg: tried 1000 values");let T=0;const C=[];for(;T<u;){b=S();const I=b.slice();C.push(I),T+=b.length}return concatBytes$2(...C)};return(T,C)=>{_(),A(T);let I;for(;!(I=C(R()));)A();return _(),I}}function _validateObject(g,u,h={}){if(!g||typeof g!="object")throw new Error("expected valid options object");function y(v,b,w){const E=g[v];if(w&&E===void 0)return;const _=typeof E;if(_!==b||E===null)throw new Error(`param "${v}" is invalid: expected ${b}, got ${_}`)}Object.entries(u).forEach(([v,b])=>y(v,b,!1)),Object.entries(h).forEach(([v,b])=>y(v,b,!0))}function memoized(g){const u=new WeakMap;return(h,...y)=>{const v=u.get(h);if(v!==void 0)return v;const b=g(h,...y);return u.set(h,b),b}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$9=BigInt(0),_1n$b=BigInt(1),_2n$9=BigInt(2),_3n$4=BigInt(3),_4n$2=BigInt(4),_5n$2=BigInt(5),_7n$1=BigInt(7),_8n$3=BigInt(8),_9n=BigInt(9),_16n=BigInt(16);function mod$1(g,u){const h=g%u;return h>=_0n$9?h:u+h}function pow2$1(g,u,h){let y=g;for(;u-- >_0n$9;)y*=y,y%=h;return y}function invert$1(g,u){if(g===_0n$9)throw new Error("invert: expected non-zero number");if(u<=_0n$9)throw new Error("invert: expected positive modulus, got "+u);let h=mod$1(g,u),y=u,v=_0n$9,b=_1n$b;for(;h!==_0n$9;){const E=y/h,_=y%h,S=v-b*E;y=h,h=_,v=b,b=S}if(y!==_1n$b)throw new Error("invert: does not exist");return mod$1(v,u)}function assertIsSquare(g,u,h){if(!g.eql(g.sqr(u),h))throw new Error("Cannot find square root")}function sqrt3mod4(g,u){const h=(g.ORDER+_1n$b)/_4n$2,y=g.pow(u,h);return assertIsSquare(g,y,u),y}function sqrt5mod8(g,u){const h=(g.ORDER-_5n$2)/_8n$3,y=g.mul(u,_2n$9),v=g.pow(y,h),b=g.mul(u,v),w=g.mul(g.mul(b,_2n$9),v),E=g.mul(b,g.sub(w,g.ONE));return assertIsSquare(g,E,u),E}function sqrt9mod16(g){const u=Field$1(g),h=tonelliShanks$1(g),y=h(u,u.neg(u.ONE)),v=h(u,y),b=h(u,u.neg(y)),w=(g+_7n$1)/_16n;return(E,_)=>{let S=E.pow(_,w),A=E.mul(S,y);const R=E.mul(S,v),x=E.mul(S,b),T=E.eql(E.sqr(A),_),C=E.eql(E.sqr(R),_);S=E.cmov(S,A,T),A=E.cmov(x,R,C);const I=E.eql(E.sqr(A),_),L=E.cmov(S,A,I);return assertIsSquare(E,L,_),L}}function tonelliShanks$1(g){if(g<_3n$4)throw new Error("sqrt is not defined for small field");let u=g-_1n$b,h=0;for(;u%_2n$9===_0n$9;)u/=_2n$9,h++;let y=_2n$9;const v=Field$1(g);for(;FpLegendre(v,y)===1;)if(y++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(h===1)return sqrt3mod4;let b=v.pow(y,u);const w=(u+_1n$b)/_2n$9;return function(_,S){if(_.is0(S))return S;if(FpLegendre(_,S)!==1)throw new Error("Cannot find square root");let A=h,R=_.mul(_.ONE,b),x=_.pow(S,u),T=_.pow(S,w);for(;!_.eql(x,_.ONE);){if(_.is0(x))return _.ZERO;let C=1,I=_.sqr(x);for(;!_.eql(I,_.ONE);)if(C++,I=_.sqr(I),C===A)throw new Error("Cannot find square root");const L=_1n$b<<BigInt(A-C-1),$=_.pow(R,L);A=C,R=_.sqr($),x=_.mul(x,R),T=_.mul(T,$)}return T}}function FpSqrt$1(g){return g%_4n$2===_3n$4?sqrt3mod4:g%_8n$3===_5n$2?sqrt5mod8:g%_16n===_9n?sqrt9mod16(g):tonelliShanks$1(g)}const isNegativeLE=(g,u)=>(mod$1(g,u)&_1n$b)===_1n$b,FIELD_FIELDS$1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField$1(g){const u={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},h=FIELD_FIELDS$1.reduce((y,v)=>(y[v]="function",y),u);return _validateObject(g,h),g}function FpPow$1(g,u,h){if(h<_0n$9)throw new Error("invalid exponent, negatives unsupported");if(h===_0n$9)return g.ONE;if(h===_1n$b)return u;let y=g.ONE,v=u;for(;h>_0n$9;)h&_1n$b&&(y=g.mul(y,v)),v=g.sqr(v),h>>=_1n$b;return y}function FpInvertBatch$1(g,u,h=!1){const y=new Array(u.length).fill(h?g.ZERO:void 0),v=u.reduce((w,E,_)=>g.is0(E)?w:(y[_]=w,g.mul(w,E)),g.ONE),b=g.inv(v);return u.reduceRight((w,E,_)=>g.is0(E)?w:(y[_]=g.mul(w,y[_]),g.mul(w,E)),b),y}function FpLegendre(g,u){const h=(g.ORDER-_1n$b)/_2n$9,y=g.pow(u,h),v=g.eql(y,g.ONE),b=g.eql(y,g.ZERO),w=g.eql(y,g.neg(g.ONE));if(!v&&!b&&!w)throw new Error("invalid Legendre symbol result");return v?1:b?0:-1}function nLength$1(g,u){u!==void 0&&anumber$1(u);const h=u!==void 0?u:g.toString(2).length,y=Math.ceil(h/8);return{nBitLength:h,nByteLength:y}}function Field$1(g,u,h=!1,y={}){if(g<=_0n$9)throw new Error("invalid field: expected ORDER > 0, got "+g);let v,b,w=!1,E;if(typeof u=="object"&&u!=null){if(y.sqrt||h)throw new Error("cannot specify opts in two arguments");const x=u;x.BITS&&(v=x.BITS),x.sqrt&&(b=x.sqrt),typeof x.isLE=="boolean"&&(h=x.isLE),typeof x.modFromBytes=="boolean"&&(w=x.modFromBytes),E=x.allowedLengths}else typeof u=="number"&&(v=u),y.sqrt&&(b=y.sqrt);const{nBitLength:_,nByteLength:S}=nLength$1(g,v);if(S>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let A;const R=Object.freeze({ORDER:g,isLE:h,BITS:_,BYTES:S,MASK:bitMask$1(_),ZERO:_0n$9,ONE:_1n$b,allowedLengths:E,create:x=>mod$1(x,g),isValid:x=>{if(typeof x!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof x);return _0n$9<=x&&x<g},is0:x=>x===_0n$9,isValidNot0:x=>!R.is0(x)&&R.isValid(x),isOdd:x=>(x&_1n$b)===_1n$b,neg:x=>mod$1(-x,g),eql:(x,T)=>x===T,sqr:x=>mod$1(x*x,g),add:(x,T)=>mod$1(x+T,g),sub:(x,T)=>mod$1(x-T,g),mul:(x,T)=>mod$1(x*T,g),pow:(x,T)=>FpPow$1(R,x,T),div:(x,T)=>mod$1(x*invert$1(T,g),g),sqrN:x=>x*x,addN:(x,T)=>x+T,subN:(x,T)=>x-T,mulN:(x,T)=>x*T,inv:x=>invert$1(x,g),sqrt:b||(x=>(A||(A=FpSqrt$1(g)),A(R,x))),toBytes:x=>h?numberToBytesLE$1(x,S):numberToBytesBE$1(x,S),fromBytes:(x,T=!0)=>{if(E){if(!E.includes(x.length)||x.length>S)throw new Error("Field.fromBytes: expected "+E+" bytes, got "+x.length);const I=new Uint8Array(S);I.set(x,h?0:I.length-x.length),x=I}if(x.length!==S)throw new Error("Field.fromBytes: expected "+S+" bytes, got "+x.length);let C=h?bytesToNumberLE$1(x):bytesToNumberBE$1(x);if(w&&(C=mod$1(C,g)),!T&&!R.isValid(C))throw new Error("invalid field element: outside of range 0..ORDER");return C},invertBatch:x=>FpInvertBatch$1(R,x),cmov:(x,T,C)=>C?T:x});return Object.freeze(R)}function getFieldBytesLength$1(g){if(typeof g!="bigint")throw new Error("field order must be bigint");const u=g.toString(2).length;return Math.ceil(u/8)}function getMinHashLength$1(g){const u=getFieldBytesLength$1(g);return u+Math.ceil(u/2)}function mapHashToField$1(g,u,h=!1){const y=g.length,v=getFieldBytesLength$1(u),b=getMinHashLength$1(u);if(y<16||y<b||y>1024)throw new Error("expected "+b+"-1024 bytes of input, got "+y);const w=h?bytesToNumberLE$1(g):bytesToNumberBE$1(g),E=mod$1(w,u-_1n$b)+_1n$b;return h?numberToBytesLE$1(E,v):numberToBytesBE$1(E,v)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$8=BigInt(0),_1n$a=BigInt(1);function negateCt(g,u){const h=u.negate();return g?h:u}function normalizeZ(g,u){const h=FpInvertBatch$1(g.Fp,u.map(y=>y.Z));return u.map((y,v)=>g.fromAffine(y.toAffine(h[v])))}function validateW(g,u){if(!Number.isSafeInteger(g)||g<=0||g>u)throw new Error("invalid window size, expected [1.."+u+"], got W="+g)}function calcWOpts(g,u){validateW(g,u);const h=Math.ceil(u/g)+1,y=2**(g-1),v=2**g,b=bitMask$1(g),w=BigInt(g);return{windows:h,windowSize:y,mask:b,maxNumber:v,shiftBy:w}}function calcOffsets(g,u,h){const{windowSize:y,mask:v,maxNumber:b,shiftBy:w}=h;let E=Number(g&v),_=g>>w;E>y&&(E-=b,_+=_1n$a);const S=u*y,A=S+Math.abs(E)-1,R=E===0,x=E<0,T=u%2!==0;return{nextN:_,offset:A,isZero:R,isNeg:x,isNegF:T,offsetF:S}}function validateMSMPoints(g,u){if(!Array.isArray(g))throw new Error("array expected");g.forEach((h,y)=>{if(!(h instanceof u))throw new Error("invalid point at index "+y)})}function validateMSMScalars(g,u){if(!Array.isArray(g))throw new Error("array of scalars expected");g.forEach((h,y)=>{if(!u.isValid(h))throw new Error("invalid scalar at index "+y)})}const pointPrecomputes=new WeakMap,pointWindowSizes=new WeakMap;function getW(g){return pointWindowSizes.get(g)||1}function assert0(g){if(g!==_0n$8)throw new Error("invalid wNAF")}let wNAF$1=class{constructor(u,h){this.BASE=u.BASE,this.ZERO=u.ZERO,this.Fn=u.Fn,this.bits=h}_unsafeLadder(u,h,y=this.ZERO){let v=u;for(;h>_0n$8;)h&_1n$a&&(y=y.add(v)),v=v.double(),h>>=_1n$a;return y}precomputeWindow(u,h){const{windows:y,windowSize:v}=calcWOpts(h,this.bits),b=[];let w=u,E=w;for(let _=0;_<y;_++){E=w,b.push(E);for(let S=1;S<v;S++)E=E.add(w),b.push(E);w=E.double()}return b}wNAF(u,h,y){if(!this.Fn.isValid(y))throw new Error("invalid scalar");let v=this.ZERO,b=this.BASE;const w=calcWOpts(u,this.bits);for(let E=0;E<w.windows;E++){const{nextN:_,offset:S,isZero:A,isNeg:R,isNegF:x,offsetF:T}=calcOffsets(y,E,w);y=_,A?b=b.add(negateCt(x,h[T])):v=v.add(negateCt(R,h[S]))}return assert0(y),{p:v,f:b}}wNAFUnsafe(u,h,y,v=this.ZERO){const b=calcWOpts(u,this.bits);for(let w=0;w<b.windows&&y!==_0n$8;w++){const{nextN:E,offset:_,isZero:S,isNeg:A}=calcOffsets(y,w,b);if(y=E,!S){const R=h[_];v=v.add(A?R.negate():R)}}return assert0(y),v}getPrecomputes(u,h,y){let v=pointPrecomputes.get(h);return v||(v=this.precomputeWindow(h,u),u!==1&&(typeof y=="function"&&(v=y(v)),pointPrecomputes.set(h,v))),v}cached(u,h,y){const v=getW(u);return this.wNAF(v,this.getPrecomputes(v,u,y),h)}unsafe(u,h,y,v){const b=getW(u);return b===1?this._unsafeLadder(u,h,v):this.wNAFUnsafe(b,this.getPrecomputes(b,u,y),h,v)}createCache(u,h){validateW(h,this.bits),pointWindowSizes.set(u,h),pointPrecomputes.delete(u)}hasCache(u){return getW(u)!==1}};function mulEndoUnsafe(g,u,h,y){let v=u,b=g.ZERO,w=g.ZERO;for(;h>_0n$8||y>_0n$8;)h&_1n$a&&(b=b.add(v)),y&_1n$a&&(w=w.add(v)),v=v.double(),h>>=_1n$a,y>>=_1n$a;return{p1:b,p2:w}}function pippenger(g,u,h,y){validateMSMPoints(h,g),validateMSMScalars(y,u);const v=h.length,b=y.length;if(v!==b)throw new Error("arrays of points and scalars must have equal length");const w=g.ZERO,E=bitLen$1(BigInt(v));let _=1;E>12?_=E-3:E>4?_=E-2:E>0&&(_=2);const S=bitMask$1(_),A=new Array(Number(S)+1).fill(w),R=Math.floor((u.BITS-1)/_)*_;let x=w;for(let T=R;T>=0;T-=_){A.fill(w);for(let I=0;I<b;I++){const L=y[I],$=Number(L>>BigInt(T)&S);A[$]=A[$].add(h[I])}let C=w;for(let I=A.length-1,L=w;I>0;I--)L=L.add(A[I]),C=C.add(L);if(x=x.add(C),T!==0)for(let I=0;I<_;I++)x=x.double()}return x}function createField(g,u,h){if(u){if(u.ORDER!==g)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return validateField$1(u),u}else return Field$1(g,{isLE:h})}function _createCurveFields(g,u,h={},y){if(y===void 0&&(y=g==="edwards"),!u||typeof u!="object")throw new Error(`expected valid ${g} CURVE object`);for(const _ of["p","n","h"]){const S=u[_];if(!(typeof S=="bigint"&&S>_0n$8))throw new Error(`CURVE.${_} must be positive bigint`)}const v=createField(u.p,h.Fp,y),b=createField(u.n,h.Fn,y),E=["Gx","Gy","a",g==="weierstrass"?"b":"d"];for(const _ of E)if(!v.isValid(u[_]))throw new Error(`CURVE.${_} must be valid field element of CURVE.Fp`);return u=Object.freeze(Object.assign({},u)),{CURVE:u,Fp:v,Fn:b}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$7=BigInt(0),_1n$9=BigInt(1),_2n$8=BigInt(2),_8n$2=BigInt(8);function isEdValidXY(g,u,h,y){const v=g.sqr(h),b=g.sqr(y),w=g.add(g.mul(u.a,v),b),E=g.add(g.ONE,g.mul(u.d,g.mul(v,b)));return g.eql(w,E)}function edwards$1(g,u={}){const h=_createCurveFields("edwards",g,u,u.FpFnLE),{Fp:y,Fn:v}=h;let b=h.CURVE;const{h:w}=b;_validateObject(u,{},{uvRatio:"function"});const E=_2n$8<<BigInt(v.BYTES*8)-_1n$9,_=L=>y.create(L),S=u.uvRatio||((L,$)=>{try{return{isValid:!0,value:y.sqrt(y.div(L,$))}}catch{return{isValid:!1,value:_0n$7}}});if(!isEdValidXY(y,b,b.Gx,b.Gy))throw new Error("bad curve params: generator point");function A(L,$,B=!1){const U=B?_1n$9:_0n$7;return aInRange("coordinate "+L,$,U,E),$}function R(L){if(!(L instanceof C))throw new Error("ExtendedPoint expected")}const x=memoized((L,$)=>{const{X:B,Y:U,Z:z}=L,ne=L.is0();$==null&&($=ne?_8n$2:y.inv(z));const ue=_(B*$),he=_(U*$),Y=y.mul(z,$);if(ne)return{x:_0n$7,y:_1n$9};if(Y!==_1n$9)throw new Error("invZ was invalid");return{x:ue,y:he}}),T=memoized(L=>{const{a:$,d:B}=b;if(L.is0())throw new Error("bad point: ZERO");const{X:U,Y:z,Z:ne,T:ue}=L,he=_(U*U),Y=_(z*z),X=_(ne*ne),J=_(X*X),j=_(he*$),M=_(X*_(j+Y)),N=_(J+_(B*_(he*Y)));if(M!==N)throw new Error("bad point: equation left != right (1)");const P=_(U*z),O=_(ne*ue);if(P!==O)throw new Error("bad point: equation left != right (2)");return!0});class C{constructor($,B,U,z){this.X=A("x",$),this.Y=A("y",B),this.Z=A("z",U,!0),this.T=A("t",z),Object.freeze(this)}static CURVE(){return b}static fromAffine($){if($ instanceof C)throw new Error("extended point not allowed");const{x:B,y:U}=$||{};return A("x",B),A("y",U),new C(B,U,_1n$9,_(B*U))}static fromBytes($,B=!1){const U=y.BYTES,{a:z,d:ne}=b;$=copyBytes$1(_abytes2($,U,"point")),_abool2(B,"zip215");const ue=copyBytes$1($),he=$[U-1];ue[U-1]=he&-129;const Y=bytesToNumberLE$1(ue),X=B?E:y.ORDER;aInRange("point.y",Y,_0n$7,X);const J=_(Y*Y),j=_(J-_1n$9),M=_(ne*J-z);let{isValid:N,value:P}=S(j,M);if(!N)throw new Error("bad point: invalid y coordinate");const O=(P&_1n$9)===_1n$9,k=(he&128)!==0;if(!B&&P===_0n$7&&k)throw new Error("bad point: x=0 and x_0=1");return k!==O&&(P=_(-P)),C.fromAffine({x:P,y:Y})}static fromHex($,B=!1){return C.fromBytes(ensureBytes$1("point",$),B)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute($=8,B=!0){return I.createCache(this,$),B||this.multiply(_2n$8),this}assertValidity(){T(this)}equals($){R($);const{X:B,Y:U,Z:z}=this,{X:ne,Y:ue,Z:he}=$,Y=_(B*he),X=_(ne*z),J=_(U*he),j=_(ue*z);return Y===X&&J===j}is0(){return this.equals(C.ZERO)}negate(){return new C(_(-this.X),this.Y,this.Z,_(-this.T))}double(){const{a:$}=b,{X:B,Y:U,Z:z}=this,ne=_(B*B),ue=_(U*U),he=_(_2n$8*_(z*z)),Y=_($*ne),X=B+U,J=_(_(X*X)-ne-ue),j=Y+ue,M=j-he,N=Y-ue,P=_(J*M),O=_(j*N),k=_(J*N),q=_(M*j);return new C(P,O,q,k)}add($){R($);const{a:B,d:U}=b,{X:z,Y:ne,Z:ue,T:he}=this,{X:Y,Y:X,Z:J,T:j}=$,M=_(z*Y),N=_(ne*X),P=_(he*U*j),O=_(ue*J),k=_((z+ne)*(Y+X)-M-N),q=O-P,F=O+P,H=_(N-B*M),D=_(k*q),G=_(F*H),W=_(k*H),K=_(q*F);return new C(D,G,K,W)}subtract($){return this.add($.negate())}multiply($){if(!v.isValidNot0($))throw new Error("invalid scalar: expected 1 <= sc < curve.n");const{p:B,f:U}=I.cached(this,$,z=>normalizeZ(C,z));return normalizeZ(C,[B,U])[0]}multiplyUnsafe($,B=C.ZERO){if(!v.isValid($))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return $===_0n$7?C.ZERO:this.is0()||$===_1n$9?this:I.unsafe(this,$,U=>normalizeZ(C,U),B)}isSmallOrder(){return this.multiplyUnsafe(w).is0()}isTorsionFree(){return I.unsafe(this,b.n).is0()}toAffine($){return x(this,$)}clearCofactor(){return w===_1n$9?this:this.multiplyUnsafe(w)}toBytes(){const{x:$,y:B}=this.toAffine(),U=y.toBytes(B);return U[U.length-1]|=$&_1n$9?128:0,U}toHex(){return bytesToHex$1(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get ex(){return this.X}get ey(){return this.Y}get ez(){return this.Z}get et(){return this.T}static normalizeZ($){return normalizeZ(C,$)}static msm($,B){return pippenger(C,v,$,B)}_setWindowSize($){this.precompute($)}toRawBytes(){return this.toBytes()}}C.BASE=new C(b.Gx,b.Gy,_1n$9,_(b.Gx*b.Gy)),C.ZERO=new C(_0n$7,_1n$9,_1n$9,_0n$7),C.Fp=y,C.Fn=v;const I=new wNAF$1(C,v.BITS);return C.BASE.precompute(8),C}function eddsa$1(g,u,h={}){if(typeof u!="function")throw new Error('"hash" function param is required');_validateObject(h,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});const{prehash:y}=h,{BASE:v,Fp:b,Fn:w}=g,E=h.randomBytes||randomBytes$3,_=h.adjustScalarBytes||(X=>X),S=h.domain||((X,J,j)=>{if(_abool2(j,"phflag"),J.length||j)throw new Error("Contexts/pre-hash are not supported");return X});function A(X){return w.create(bytesToNumberLE$1(X))}function R(X){const J=U.secretKey;X=ensureBytes$1("private key",X,J);const j=ensureBytes$1("hashed private key",u(X),2*J),M=_(j.slice(0,J)),N=j.slice(J,2*J),P=A(M);return{head:M,prefix:N,scalar:P}}function x(X){const{head:J,prefix:j,scalar:M}=R(X),N=v.multiply(M),P=N.toBytes();return{head:J,prefix:j,scalar:M,point:N,pointBytes:P}}function T(X){return x(X).pointBytes}function C(X=Uint8Array.of(),...J){const j=concatBytes$2(...J);return A(u(S(j,ensureBytes$1("context",X),!!y)))}function I(X,J,j={}){X=ensureBytes$1("message",X),y&&(X=y(X));const{prefix:M,scalar:N,pointBytes:P}=x(J),O=C(j.context,M,X),k=v.multiply(O).toBytes(),q=C(j.context,k,P,X),F=w.create(O+q*N);if(!w.isValid(F))throw new Error("sign failed: invalid s");const H=concatBytes$2(k,w.toBytes(F));return _abytes2(H,U.signature,"result")}const L={zip215:!0};function $(X,J,j,M=L){const{context:N,zip215:P}=M,O=U.signature;X=ensureBytes$1("signature",X,O),J=ensureBytes$1("message",J),j=ensureBytes$1("publicKey",j,U.publicKey),P!==void 0&&_abool2(P,"zip215"),y&&(J=y(J));const k=O/2,q=X.subarray(0,k),F=bytesToNumberLE$1(X.subarray(k,O));let H,D,G;try{H=g.fromBytes(j,P),D=g.fromBytes(q,P),G=v.multiplyUnsafe(F)}catch{return!1}if(!P&&H.isSmallOrder())return!1;const W=C(N,D.toBytes(),H.toBytes(),J);return D.add(H.multiplyUnsafe(W)).subtract(G).clearCofactor().is0()}const B=b.BYTES,U={secretKey:B,publicKey:B,signature:2*B,seed:B};function z(X=E(U.seed)){return _abytes2(X,U.seed,"seed")}function ne(X){const J=Y.randomSecretKey(X);return{secretKey:J,publicKey:T(J)}}function ue(X){return isBytes$3(X)&&X.length===w.BYTES}function he(X,J){try{return!!g.fromBytes(X,J)}catch{return!1}}const Y={getExtendedPublicKey:x,randomSecretKey:z,isValidSecretKey:ue,isValidPublicKey:he,toMontgomery(X){const{y:J}=g.fromBytes(X),j=U.publicKey,M=j===32;if(!M&&j!==57)throw new Error("only defined for 25519 and 448");const N=M?b.div(_1n$9+J,_1n$9-J):b.div(J-_1n$9,J+_1n$9);return b.toBytes(N)},toMontgomerySecret(X){const J=U.secretKey;_abytes2(X,J);const j=u(X.subarray(0,J));return _(j).subarray(0,J)},randomPrivateKey:z,precompute(X=8,J=g.BASE){return J.precompute(X,!1)}};return Object.freeze({keygen:ne,getPublicKey:T,sign:I,verify:$,utils:Y,Point:g,lengths:U})}function _eddsa_legacy_opts_to_new(g){const u={a:g.a,d:g.d,p:g.Fp.ORDER,n:g.n,h:g.h,Gx:g.Gx,Gy:g.Gy},h=g.Fp,y=Field$1(u.n,g.nBitLength,!0),v={Fp:h,Fn:y,uvRatio:g.uvRatio},b={randomBytes:g.randomBytes,adjustScalarBytes:g.adjustScalarBytes,domain:g.domain,prehash:g.prehash,mapToCurve:g.mapToCurve};return{CURVE:u,curveOpts:v,hash:g.hash,eddsaOpts:b}}function _eddsa_new_output_to_legacy(g,u){const h=u.Point;return Object.assign({},u,{ExtendedPoint:h,CURVE:g,nBitLength:h.Fn.BITS,nByteLength:h.Fn.BYTES})}function twistedEdwards(g){const{CURVE:u,curveOpts:h,hash:y,eddsaOpts:v}=_eddsa_legacy_opts_to_new(g),b=edwards$1(u,h),w=eddsa$1(b,y,v);return _eddsa_new_output_to_legacy(g,w)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$6=BigInt(0),_1n$8=BigInt(1),_2n$7=BigInt(2);function validateOpts$1(g){return _validateObject(g,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...g})}function montgomery(g){const u=validateOpts$1(g),{P:h,type:y,adjustScalarBytes:v,powPminus2:b,randomBytes:w}=u,E=y==="x25519";if(!E&&y!=="x448")throw new Error("invalid type");const _=w||randomBytes$3,S=E?255:448,A=E?32:56,R=BigInt(E?9:5),x=BigInt(E?121665:39081),T=E?_2n$7**BigInt(254):_2n$7**BigInt(447),C=E?BigInt(8)*_2n$7**BigInt(251)-_1n$8:BigInt(4)*_2n$7**BigInt(445)-_1n$8,I=T+C+_1n$8,L=N=>mod$1(N,h),$=B(R);function B(N){return numberToBytesLE$1(L(N),A)}function U(N){const P=ensureBytes$1("u coordinate",N,A);return E&&(P[31]&=127),L(bytesToNumberLE$1(P))}function z(N){return bytesToNumberLE$1(v(ensureBytes$1("scalar",N,A)))}function ne(N,P){const O=Y(U(P),z(N));if(O===_0n$6)throw new Error("invalid private or public key received");return B(O)}function ue(N){return ne(N,$)}function he(N,P,O){const k=L(N*(P-O));return P=L(P-k),O=L(O+k),{x_2:P,x_3:O}}function Y(N,P){aInRange("u",N,_0n$6,h),aInRange("scalar",P,T,I);const O=P,k=N;let q=_1n$8,F=_0n$6,H=N,D=_1n$8,G=_0n$6;for(let K=BigInt(S-1);K>=_0n$6;K--){const Z=O>>K&_1n$8;G^=Z,{x_2:q,x_3:H}=he(G,q,H),{x_2:F,x_3:D}=he(G,F,D),G=Z;const ae=q+F,le=L(ae*ae),te=q-F,ce=L(te*te),ge=le-ce,Ee=H+D,pe=H-D,de=L(pe*ae),me=L(Ee*te),_e=de+me,Ae=de-me;H=L(_e*_e),D=L(k*L(Ae*Ae)),q=L(le*ce),F=L(ge*(le+L(x*ge)))}({x_2:q,x_3:H}=he(G,q,H)),{x_2:F,x_3:D}=he(G,F,D);const W=b(F);return L(q*W)}const X={secretKey:A,publicKey:A,seed:A},J=(N=_(A))=>(abytes$2(N,X.seed),N);function j(N){const P=J(N);return{secretKey:P,publicKey:ue(P)}}return{keygen:j,getSharedSecret:(N,P)=>ne(N,P),getPublicKey:N=>ue(N),scalarMult:ne,scalarMultBase:ue,utils:{randomSecretKey:J,randomPrivateKey:J},GuBytes:$.slice(),lengths:X}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _1n$7=BigInt(1),_2n$6=BigInt(2),_3n$3=BigInt(3),_5n$1=BigInt(5),_8n$1=BigInt(8),ed25519_CURVE_p=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),ed25519_CURVE={p:ed25519_CURVE_p,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:_8n$1,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function ed25519_pow_2_252_3(g){const u=BigInt(10),h=BigInt(20),y=BigInt(40),v=BigInt(80),b=ed25519_CURVE_p,E=g*g%b*g%b,_=pow2$1(E,_2n$6,b)*E%b,S=pow2$1(_,_1n$7,b)*g%b,A=pow2$1(S,_5n$1,b)*S%b,R=pow2$1(A,u,b)*A%b,x=pow2$1(R,h,b)*R%b,T=pow2$1(x,y,b)*x%b,C=pow2$1(T,v,b)*T%b,I=pow2$1(C,v,b)*T%b,L=pow2$1(I,u,b)*A%b;return{pow_p_5_8:pow2$1(L,_2n$6,b)*g%b,b2:E}}function adjustScalarBytes(g){return g[0]&=248,g[31]&=127,g[31]|=64,g}const ED25519_SQRT_M1=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function uvRatio(g,u){const h=ed25519_CURVE_p,y=mod$1(u*u*u,h),v=mod$1(y*y*u,h),b=ed25519_pow_2_252_3(g*v).pow_p_5_8;let w=mod$1(g*y*b,h);const E=mod$1(u*w*w,h),_=w,S=mod$1(w*ED25519_SQRT_M1,h),A=E===g,R=E===mod$1(-g,h),x=E===mod$1(-g*ED25519_SQRT_M1,h);return A&&(w=_),(R||x)&&(w=S),isNegativeLE(w,h)&&(w=mod$1(-w,h)),{isValid:A||R,value:w}}const Fp$1=Field$1(ed25519_CURVE.p,{isLE:!0}),ed25519Defaults={...ed25519_CURVE,Fp:Fp$1,hash:sha512$3,adjustScalarBytes,uvRatio},ed25519=twistedEdwards(ed25519Defaults),x25519=(()=>{const g=Fp$1.ORDER;return montgomery({P:g,type:"x25519",powPminus2:u=>{const{pow_p_5_8:h,b2:y}=ed25519_pow_2_252_3(u);return mod$1(pow2$1(h,_3n$3,g)*y,g)},adjustScalarBytes})})();function getDefaultExportFromCjs(g){return g&&g.__esModule&&Object.prototype.hasOwnProperty.call(g,"default")?g.default:g}function getAugmentedNamespace(g){if(Object.prototype.hasOwnProperty.call(g,"__esModule"))return g;var u=g.default;if(typeof u=="function"){var h=function y(){var v=!1;try{v=this instanceof y}catch{}return v?Reflect.construct(u,arguments,this.constructor):u.apply(this,arguments)};h.prototype=u.prototype}else h={};return Object.defineProperty(h,"__esModule",{value:!0}),Object.keys(g).forEach(function(y){var v=Object.getOwnPropertyDescriptor(g,y);Object.defineProperty(h,y,v.get?v:{enumerable:!0,get:function(){return g[y]}})}),h}var bn$3={exports:{}},dist$1={},hasRequiredDist$1;function requireDist$1(){return hasRequiredDist$1||(hasRequiredDist$1=1,(function(g){Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var u={},h={};h.byteLength=A,h.toByteArray=x,h.fromByteArray=I;for(var y=[],v=[],b=typeof Uint8Array<"u"?Uint8Array:Array,w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",E=0,_=w.length;E<_;++E)y[E]=w[E],v[w.charCodeAt(E)]=E;v[45]=62,v[95]=63;function S(B){var U=B.length;if(U%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var z=B.indexOf("=");z===-1&&(z=U);var ne=z===U?0:4-z%4;return[z,ne]}function A(B){var U=S(B),z=U[0],ne=U[1];return(z+ne)*3/4-ne}function R(B,U,z){return(U+z)*3/4-z}function x(B){var U,z=S(B),ne=z[0],ue=z[1],he=new b(R(B,ne,ue)),Y=0,X=ue>0?ne-4:ne,J;for(J=0;J<X;J+=4)U=v[B.charCodeAt(J)]<<18|v[B.charCodeAt(J+1)]<<12|v[B.charCodeAt(J+2)]<<6|v[B.charCodeAt(J+3)],he[Y++]=U>>16&255,he[Y++]=U>>8&255,he[Y++]=U&255;return ue===2&&(U=v[B.charCodeAt(J)]<<2|v[B.charCodeAt(J+1)]>>4,he[Y++]=U&255),ue===1&&(U=v[B.charCodeAt(J)]<<10|v[B.charCodeAt(J+1)]<<4|v[B.charCodeAt(J+2)]>>2,he[Y++]=U>>8&255,he[Y++]=U&255),he}function T(B){return y[B>>18&63]+y[B>>12&63]+y[B>>6&63]+y[B&63]}function C(B,U,z){for(var ne,ue=[],he=U;he<z;he+=3)ne=(B[he]<<16&16711680)+(B[he+1]<<8&65280)+(B[he+2]&255),ue.push(T(ne));return ue.join("")}function I(B){for(var U,z=B.length,ne=z%3,ue=[],he=16383,Y=0,X=z-ne;Y<X;Y+=he)ue.push(C(B,Y,Y+he>X?X:Y+he));return ne===1?(U=B[z-1],ue.push(y[U>>2]+y[U<<4&63]+"==")):ne===2&&(U=(B[z-2]<<8)+B[z-1],ue.push(y[U>>10]+y[U>>4&63]+y[U<<2&63]+"=")),ue.join("")}var L={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */L.read=function(B,U,z,ne,ue){var he,Y,X=ue*8-ne-1,J=(1<<X)-1,j=J>>1,M=-7,N=z?ue-1:0,P=z?-1:1,O=B[U+N];for(N+=P,he=O&(1<<-M)-1,O>>=-M,M+=X;M>0;he=he*256+B[U+N],N+=P,M-=8);for(Y=he&(1<<-M)-1,he>>=-M,M+=ne;M>0;Y=Y*256+B[U+N],N+=P,M-=8);if(he===0)he=1-j;else{if(he===J)return Y?NaN:(O?-1:1)*(1/0);Y=Y+Math.pow(2,ne),he=he-j}return(O?-1:1)*Y*Math.pow(2,he-ne)},L.write=function(B,U,z,ne,ue,he){var Y,X,J,j=he*8-ue-1,M=(1<<j)-1,N=M>>1,P=ue===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=ne?0:he-1,k=ne?1:-1,q=U<0||U===0&&1/U<0?1:0;for(U=Math.abs(U),isNaN(U)||U===1/0?(X=isNaN(U)?1:0,Y=M):(Y=Math.floor(Math.log(U)/Math.LN2),U*(J=Math.pow(2,-Y))<1&&(Y--,J*=2),Y+N>=1?U+=P/J:U+=P*Math.pow(2,1-N),U*J>=2&&(Y++,J/=2),Y+N>=M?(X=0,Y=M):Y+N>=1?(X=(U*J-1)*Math.pow(2,ue),Y=Y+N):(X=U*Math.pow(2,N-1)*Math.pow(2,ue),Y=0));ue>=8;B[z+O]=X&255,O+=k,X/=256,ue-=8);for(Y=Y<<ue|X,j+=ue;j>0;B[z+O]=Y&255,O+=k,Y/=256,j-=8);B[z+O-k]|=q*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(B){const U=h,z=L,ne=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;B.Buffer=M,B.SlowBuffer=K,B.INSPECT_MAX_BYTES=50;const ue=2147483647;B.kMaxLength=ue;const{Uint8Array:he,ArrayBuffer:Y,SharedArrayBuffer:X}=globalThis;M.TYPED_ARRAY_SUPPORT=J(),!M.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function J(){try{const se=new he(1),ee={foo:function(){return 42}};return Object.setPrototypeOf(ee,he.prototype),Object.setPrototypeOf(se,ee),se.foo()===42}catch{return!1}}Object.defineProperty(M.prototype,"parent",{enumerable:!0,get:function(){if(M.isBuffer(this))return this.buffer}}),Object.defineProperty(M.prototype,"offset",{enumerable:!0,get:function(){if(M.isBuffer(this))return this.byteOffset}});function j(se){if(se>ue)throw new RangeError('The value "'+se+'" is invalid for option "size"');const ee=new he(se);return Object.setPrototypeOf(ee,M.prototype),ee}function M(se,ee,oe){if(typeof se=="number"){if(typeof ee=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return k(se)}return N(se,ee,oe)}M.poolSize=8192;function N(se,ee,oe){if(typeof se=="string")return q(se,ee);if(Y.isView(se))return H(se);if(se==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof se);if(Ot(se,Y)||se&&Ot(se.buffer,Y)||typeof X<"u"&&(Ot(se,X)||se&&Ot(se.buffer,X)))return D(se,ee,oe);if(typeof se=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const be=se.valueOf&&se.valueOf();if(be!=null&&be!==se)return M.from(be,ee,oe);const xe=G(se);if(xe)return xe;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof se[Symbol.toPrimitive]=="function")return M.from(se[Symbol.toPrimitive]("string"),ee,oe);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof se)}M.from=function(se,ee,oe){return N(se,ee,oe)},Object.setPrototypeOf(M.prototype,he.prototype),Object.setPrototypeOf(M,he);function P(se){if(typeof se!="number")throw new TypeError('"size" argument must be of type number');if(se<0)throw new RangeError('The value "'+se+'" is invalid for option "size"')}function O(se,ee,oe){return P(se),se<=0?j(se):ee!==void 0?typeof oe=="string"?j(se).fill(ee,oe):j(se).fill(ee):j(se)}M.alloc=function(se,ee,oe){return O(se,ee,oe)};function k(se){return P(se),j(se<0?0:W(se)|0)}M.allocUnsafe=function(se){return k(se)},M.allocUnsafeSlow=function(se){return k(se)};function q(se,ee){if((typeof ee!="string"||ee==="")&&(ee="utf8"),!M.isEncoding(ee))throw new TypeError("Unknown encoding: "+ee);const oe=Z(se,ee)|0;let be=j(oe);const xe=be.write(se,ee);return xe!==oe&&(be=be.slice(0,xe)),be}function F(se){const ee=se.length<0?0:W(se.length)|0,oe=j(ee);for(let be=0;be<ee;be+=1)oe[be]=se[be]&255;return oe}function H(se){if(Ot(se,he)){const ee=new he(se);return D(ee.buffer,ee.byteOffset,ee.byteLength)}return F(se)}function D(se,ee,oe){if(ee<0||se.byteLength<ee)throw new RangeError('"offset" is outside of buffer bounds');if(se.byteLength<ee+(oe||0))throw new RangeError('"length" is outside of buffer bounds');let be;return ee===void 0&&oe===void 0?be=new he(se):oe===void 0?be=new he(se,ee):be=new he(se,ee,oe),Object.setPrototypeOf(be,M.prototype),be}function G(se){if(M.isBuffer(se)){const ee=W(se.length)|0,oe=j(ee);return oe.length===0||se.copy(oe,0,0,ee),oe}if(se.length!==void 0)return typeof se.length!="number"||It(se.length)?j(0):F(se);if(se.type==="Buffer"&&Array.isArray(se.data))return F(se.data)}function W(se){if(se>=ue)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+ue.toString(16)+" bytes");return se|0}function K(se){return+se!=se&&(se=0),M.alloc(+se)}M.isBuffer=function(ee){return ee!=null&&ee._isBuffer===!0&&ee!==M.prototype},M.compare=function(ee,oe){if(Ot(ee,he)&&(ee=M.from(ee,ee.offset,ee.byteLength)),Ot(oe,he)&&(oe=M.from(oe,oe.offset,oe.byteLength)),!M.isBuffer(ee)||!M.isBuffer(oe))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(ee===oe)return 0;let be=ee.length,xe=oe.length;for(let ie=0,fe=Math.min(be,xe);ie<fe;++ie)if(ee[ie]!==oe[ie]){be=ee[ie],xe=oe[ie];break}return be<xe?-1:xe<be?1:0},M.isEncoding=function(ee){switch(String(ee).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},M.concat=function(ee,oe){if(!Array.isArray(ee))throw new TypeError('"list" argument must be an Array of Buffers');if(ee.length===0)return M.alloc(0);let be;if(oe===void 0)for(oe=0,be=0;be<ee.length;++be)oe+=ee[be].length;const xe=M.allocUnsafe(oe);let ie=0;for(be=0;be<ee.length;++be){let fe=ee[be];if(Ot(fe,he))ie+fe.length>xe.length?(M.isBuffer(fe)||(fe=M.from(fe)),fe.copy(xe,ie)):he.prototype.set.call(xe,fe,ie);else if(M.isBuffer(fe))fe.copy(xe,ie);else throw new TypeError('"list" argument must be an Array of Buffers');ie+=fe.length}return xe};function Z(se,ee){if(M.isBuffer(se))return se.length;if(Y.isView(se)||Ot(se,Y))return se.byteLength;if(typeof se!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof se);const oe=se.length,be=arguments.length>2&&arguments[2]===!0;if(!be&&oe===0)return 0;let xe=!1;for(;;)switch(ee){case"ascii":case"latin1":case"binary":return oe;case"utf8":case"utf-8":return Mt(se).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return oe*2;case"hex":return oe>>>1;case"base64":return Dt(se).length;default:if(xe)return be?-1:Mt(se).length;ee=(""+ee).toLowerCase(),xe=!0}}M.byteLength=Z;function ae(se,ee,oe){let be=!1;if((ee===void 0||ee<0)&&(ee=0),ee>this.length||((oe===void 0||oe>this.length)&&(oe=this.length),oe<=0)||(oe>>>=0,ee>>>=0,oe<=ee))return"";for(se||(se="utf8");;)switch(se){case"hex":return Le(this,ee,oe);case"utf8":case"utf-8":return Ae(this,ee,oe);case"ascii":return Ne(this,ee,oe);case"latin1":case"binary":return we(this,ee,oe);case"base64":return _e(this,ee,oe);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Oe(this,ee,oe);default:if(be)throw new TypeError("Unknown encoding: "+se);se=(se+"").toLowerCase(),be=!0}}M.prototype._isBuffer=!0;function le(se,ee,oe){const be=se[ee];se[ee]=se[oe],se[oe]=be}M.prototype.swap16=function(){const ee=this.length;if(ee%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let oe=0;oe<ee;oe+=2)le(this,oe,oe+1);return this},M.prototype.swap32=function(){const ee=this.length;if(ee%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let oe=0;oe<ee;oe+=4)le(this,oe,oe+3),le(this,oe+1,oe+2);return this},M.prototype.swap64=function(){const ee=this.length;if(ee%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let oe=0;oe<ee;oe+=8)le(this,oe,oe+7),le(this,oe+1,oe+6),le(this,oe+2,oe+5),le(this,oe+3,oe+4);return this},M.prototype.toString=function(){const ee=this.length;return ee===0?"":arguments.length===0?Ae(this,0,ee):ae.apply(this,arguments)},M.prototype.toLocaleString=M.prototype.toString,M.prototype.equals=function(ee){if(!M.isBuffer(ee))throw new TypeError("Argument must be a Buffer");return this===ee?!0:M.compare(this,ee)===0},M.prototype.inspect=function(){let ee="";const oe=B.INSPECT_MAX_BYTES;return ee=this.toString("hex",0,oe).replace(/(.{2})/g,"$1 ").trim(),this.length>oe&&(ee+=" ... "),"<Buffer "+ee+">"},ne&&(M.prototype[ne]=M.prototype.inspect),M.prototype.compare=function(ee,oe,be,xe,ie){if(Ot(ee,he)&&(ee=M.from(ee,ee.offset,ee.byteLength)),!M.isBuffer(ee))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof ee);if(oe===void 0&&(oe=0),be===void 0&&(be=ee?ee.length:0),xe===void 0&&(xe=0),ie===void 0&&(ie=this.length),oe<0||be>ee.length||xe<0||ie>this.length)throw new RangeError("out of range index");if(xe>=ie&&oe>=be)return 0;if(xe>=ie)return-1;if(oe>=be)return 1;if(oe>>>=0,be>>>=0,xe>>>=0,ie>>>=0,this===ee)return 0;let fe=ie-xe,ye=be-oe;const Q=Math.min(fe,ye),ve=this.slice(xe,ie),Te=ee.slice(oe,be);for(let Ie=0;Ie<Q;++Ie)if(ve[Ie]!==Te[Ie]){fe=ve[Ie],ye=Te[Ie];break}return fe<ye?-1:ye<fe?1:0};function te(se,ee,oe,be,xe){if(se.length===0)return-1;if(typeof oe=="string"?(be=oe,oe=0):oe>2147483647?oe=2147483647:oe<-2147483648&&(oe=-2147483648),oe=+oe,It(oe)&&(oe=xe?0:se.length-1),oe<0&&(oe=se.length+oe),oe>=se.length){if(xe)return-1;oe=se.length-1}else if(oe<0)if(xe)oe=0;else return-1;if(typeof ee=="string"&&(ee=M.from(ee,be)),M.isBuffer(ee))return ee.length===0?-1:ce(se,ee,oe,be,xe);if(typeof ee=="number")return ee=ee&255,typeof he.prototype.indexOf=="function"?xe?he.prototype.indexOf.call(se,ee,oe):he.prototype.lastIndexOf.call(se,ee,oe):ce(se,[ee],oe,be,xe);throw new TypeError("val must be string, number or Buffer")}function ce(se,ee,oe,be,xe){let ie=1,fe=se.length,ye=ee.length;if(be!==void 0&&(be=String(be).toLowerCase(),be==="ucs2"||be==="ucs-2"||be==="utf16le"||be==="utf-16le")){if(se.length<2||ee.length<2)return-1;ie=2,fe/=2,ye/=2,oe/=2}function Q(Te,Ie){return ie===1?Te[Ie]:Te.readUInt16BE(Ie*ie)}let ve;if(xe){let Te=-1;for(ve=oe;ve<fe;ve++)if(Q(se,ve)===Q(ee,Te===-1?0:ve-Te)){if(Te===-1&&(Te=ve),ve-Te+1===ye)return Te*ie}else Te!==-1&&(ve-=ve-Te),Te=-1}else for(oe+ye>fe&&(oe=fe-ye),ve=oe;ve>=0;ve--){let Te=!0;for(let Ie=0;Ie<ye;Ie++)if(Q(se,ve+Ie)!==Q(ee,Ie)){Te=!1;break}if(Te)return ve}return-1}M.prototype.includes=function(ee,oe,be){return this.indexOf(ee,oe,be)!==-1},M.prototype.indexOf=function(ee,oe,be){return te(this,ee,oe,be,!0)},M.prototype.lastIndexOf=function(ee,oe,be){return te(this,ee,oe,be,!1)};function ge(se,ee,oe,be){oe=Number(oe)||0;const xe=se.length-oe;be?(be=Number(be),be>xe&&(be=xe)):be=xe;const ie=ee.length;be>ie/2&&(be=ie/2);let fe;for(fe=0;fe<be;++fe){const ye=parseInt(ee.substr(fe*2,2),16);if(It(ye))return fe;se[oe+fe]=ye}return fe}function Ee(se,ee,oe,be){return dt(Mt(ee,se.length-oe),se,oe,be)}function pe(se,ee,oe,be){return dt(ft(ee),se,oe,be)}function de(se,ee,oe,be){return dt(Dt(ee),se,oe,be)}function me(se,ee,oe,be){return dt(Ut(ee,se.length-oe),se,oe,be)}M.prototype.write=function(ee,oe,be,xe){if(oe===void 0)xe="utf8",be=this.length,oe=0;else if(be===void 0&&typeof oe=="string")xe=oe,be=this.length,oe=0;else if(isFinite(oe))oe=oe>>>0,isFinite(be)?(be=be>>>0,xe===void 0&&(xe="utf8")):(xe=be,be=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const ie=this.length-oe;if((be===void 0||be>ie)&&(be=ie),ee.length>0&&(be<0||oe<0)||oe>this.length)throw new RangeError("Attempt to write outside buffer bounds");xe||(xe="utf8");let fe=!1;for(;;)switch(xe){case"hex":return ge(this,ee,oe,be);case"utf8":case"utf-8":return Ee(this,ee,oe,be);case"ascii":case"latin1":case"binary":return pe(this,ee,oe,be);case"base64":return de(this,ee,oe,be);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return me(this,ee,oe,be);default:if(fe)throw new TypeError("Unknown encoding: "+xe);xe=(""+xe).toLowerCase(),fe=!0}},M.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function _e(se,ee,oe){return ee===0&&oe===se.length?U.fromByteArray(se):U.fromByteArray(se.slice(ee,oe))}function Ae(se,ee,oe){oe=Math.min(se.length,oe);const be=[];let xe=ee;for(;xe<oe;){const ie=se[xe];let fe=null,ye=ie>239?4:ie>223?3:ie>191?2:1;if(xe+ye<=oe){let Q,ve,Te,Ie;switch(ye){case 1:ie<128&&(fe=ie);break;case 2:Q=se[xe+1],(Q&192)===128&&(Ie=(ie&31)<<6|Q&63,Ie>127&&(fe=Ie));break;case 3:Q=se[xe+1],ve=se[xe+2],(Q&192)===128&&(ve&192)===128&&(Ie=(ie&15)<<12|(Q&63)<<6|ve&63,Ie>2047&&(Ie<55296||Ie>57343)&&(fe=Ie));break;case 4:Q=se[xe+1],ve=se[xe+2],Te=se[xe+3],(Q&192)===128&&(ve&192)===128&&(Te&192)===128&&(Ie=(ie&15)<<18|(Q&63)<<12|(ve&63)<<6|Te&63,Ie>65535&&Ie<1114112&&(fe=Ie))}}fe===null?(fe=65533,ye=1):fe>65535&&(fe-=65536,be.push(fe>>>10&1023|55296),fe=56320|fe&1023),be.push(fe),xe+=ye}return Me(be)}const Pe=4096;function Me(se){const ee=se.length;if(ee<=Pe)return String.fromCharCode.apply(String,se);let oe="",be=0;for(;be<ee;)oe+=String.fromCharCode.apply(String,se.slice(be,be+=Pe));return oe}function Ne(se,ee,oe){let be="";oe=Math.min(se.length,oe);for(let xe=ee;xe<oe;++xe)be+=String.fromCharCode(se[xe]&127);return be}function we(se,ee,oe){let be="";oe=Math.min(se.length,oe);for(let xe=ee;xe<oe;++xe)be+=String.fromCharCode(se[xe]);return be}function Le(se,ee,oe){const be=se.length;(!ee||ee<0)&&(ee=0),(!oe||oe<0||oe>be)&&(oe=be);let xe="";for(let ie=ee;ie<oe;++ie)xe+=rt[se[ie]];return xe}function Oe(se,ee,oe){const be=se.slice(ee,oe);let xe="";for(let ie=0;ie<be.length-1;ie+=2)xe+=String.fromCharCode(be[ie]+be[ie+1]*256);return xe}M.prototype.slice=function(ee,oe){const be=this.length;ee=~~ee,oe=oe===void 0?be:~~oe,ee<0?(ee+=be,ee<0&&(ee=0)):ee>be&&(ee=be),oe<0?(oe+=be,oe<0&&(oe=0)):oe>be&&(oe=be),oe<ee&&(oe=ee);const xe=this.subarray(ee,oe);return Object.setPrototypeOf(xe,M.prototype),xe};function Ce(se,ee,oe){if(se%1!==0||se<0)throw new RangeError("offset is not uint");if(se+ee>oe)throw new RangeError("Trying to access beyond buffer length")}M.prototype.readUintLE=M.prototype.readUIntLE=function(ee,oe,be){ee=ee>>>0,oe=oe>>>0,be||Ce(ee,oe,this.length);let xe=this[ee],ie=1,fe=0;for(;++fe<oe&&(ie*=256);)xe+=this[ee+fe]*ie;return xe},M.prototype.readUintBE=M.prototype.readUIntBE=function(ee,oe,be){ee=ee>>>0,oe=oe>>>0,be||Ce(ee,oe,this.length);let xe=this[ee+--oe],ie=1;for(;oe>0&&(ie*=256);)xe+=this[ee+--oe]*ie;return xe},M.prototype.readUint8=M.prototype.readUInt8=function(ee,oe){return ee=ee>>>0,oe||Ce(ee,1,this.length),this[ee]},M.prototype.readUint16LE=M.prototype.readUInt16LE=function(ee,oe){return ee=ee>>>0,oe||Ce(ee,2,this.length),this[ee]|this[ee+1]<<8},M.prototype.readUint16BE=M.prototype.readUInt16BE=function(ee,oe){return ee=ee>>>0,oe||Ce(ee,2,this.length),this[ee]<<8|this[ee+1]},M.prototype.readUint32LE=M.prototype.readUInt32LE=function(ee,oe){return ee=ee>>>0,oe||Ce(ee,4,this.length),(this[ee]|this[ee+1]<<8|this[ee+2]<<16)+this[ee+3]*16777216},M.prototype.readUint32BE=M.prototype.readUInt32BE=function(ee,oe){return ee=ee>>>0,oe||Ce(ee,4,this.length),this[ee]*16777216+(this[ee+1]<<16|this[ee+2]<<8|this[ee+3])},M.prototype.readBigUInt64LE=_t(function(ee){ee=ee>>>0,Tt(ee,"offset");const oe=this[ee],be=this[ee+7];(oe===void 0||be===void 0)&&Pt(ee,this.length-8);const xe=oe+this[++ee]*2**8+this[++ee]*2**16+this[++ee]*2**24,ie=this[++ee]+this[++ee]*2**8+this[++ee]*2**16+be*2**24;return BigInt(xe)+(BigInt(ie)<<BigInt(32))}),M.prototype.readBigUInt64BE=_t(function(ee){ee=ee>>>0,Tt(ee,"offset");const oe=this[ee],be=this[ee+7];(oe===void 0||be===void 0)&&Pt(ee,this.length-8);const xe=oe*2**24+this[++ee]*2**16+this[++ee]*2**8+this[++ee],ie=this[++ee]*2**24+this[++ee]*2**16+this[++ee]*2**8+be;return(BigInt(xe)<<BigInt(32))+BigInt(ie)}),M.prototype.readIntLE=function(ee,oe,be){ee=ee>>>0,oe=oe>>>0,be||Ce(ee,oe,this.length);let xe=this[ee],ie=1,fe=0;for(;++fe<oe&&(ie*=256);)xe+=this[ee+fe]*ie;return ie*=128,xe>=ie&&(xe-=Math.pow(2,8*oe)),xe},M.prototype.readIntBE=function(ee,oe,be){ee=ee>>>0,oe=oe>>>0,be||Ce(ee,oe,this.length);let xe=oe,ie=1,fe=this[ee+--xe];for(;xe>0&&(ie*=256);)fe+=this[ee+--xe]*ie;return ie*=128,fe>=ie&&(fe-=Math.pow(2,8*oe)),fe},M.prototype.readInt8=function(ee,oe){return ee=ee>>>0,oe||Ce(ee,1,this.length),this[ee]&128?(255-this[ee]+1)*-1:this[ee]},M.prototype.readInt16LE=function(ee,oe){ee=ee>>>0,oe||Ce(ee,2,this.length);const be=this[ee]|this[ee+1]<<8;return be&32768?be|4294901760:be},M.prototype.readInt16BE=function(ee,oe){ee=ee>>>0,oe||Ce(ee,2,this.length);const be=this[ee+1]|this[ee]<<8;return be&32768?be|4294901760:be},M.prototype.readInt32LE=function(ee,oe){return ee=ee>>>0,oe||Ce(ee,4,this.length),this[ee]|this[ee+1]<<8|this[ee+2]<<16|this[ee+3]<<24},M.prototype.readInt32BE=function(ee,oe){return ee=ee>>>0,oe||Ce(ee,4,this.length),this[ee]<<24|this[ee+1]<<16|this[ee+2]<<8|this[ee+3]},M.prototype.readBigInt64LE=_t(function(ee){ee=ee>>>0,Tt(ee,"offset");const oe=this[ee],be=this[ee+7];(oe===void 0||be===void 0)&&Pt(ee,this.length-8);const xe=this[ee+4]+this[ee+5]*2**8+this[ee+6]*2**16+(be<<24);return(BigInt(xe)<<BigInt(32))+BigInt(oe+this[++ee]*2**8+this[++ee]*2**16+this[++ee]*2**24)}),M.prototype.readBigInt64BE=_t(function(ee){ee=ee>>>0,Tt(ee,"offset");const oe=this[ee],be=this[ee+7];(oe===void 0||be===void 0)&&Pt(ee,this.length-8);const xe=(oe<<24)+this[++ee]*2**16+this[++ee]*2**8+this[++ee];return(BigInt(xe)<<BigInt(32))+BigInt(this[++ee]*2**24+this[++ee]*2**16+this[++ee]*2**8+be)}),M.prototype.readFloatLE=function(ee,oe){return ee=ee>>>0,oe||Ce(ee,4,this.length),z.read(this,ee,!0,23,4)},M.prototype.readFloatBE=function(ee,oe){return ee=ee>>>0,oe||Ce(ee,4,this.length),z.read(this,ee,!1,23,4)},M.prototype.readDoubleLE=function(ee,oe){return ee=ee>>>0,oe||Ce(ee,8,this.length),z.read(this,ee,!0,52,8)},M.prototype.readDoubleBE=function(ee,oe){return ee=ee>>>0,oe||Ce(ee,8,this.length),z.read(this,ee,!1,52,8)};function We(se,ee,oe,be,xe,ie){if(!M.isBuffer(se))throw new TypeError('"buffer" argument must be a Buffer instance');if(ee>xe||ee<ie)throw new RangeError('"value" argument is out of bounds');if(oe+be>se.length)throw new RangeError("Index out of range")}M.prototype.writeUintLE=M.prototype.writeUIntLE=function(ee,oe,be,xe){if(ee=+ee,oe=oe>>>0,be=be>>>0,!xe){const ye=Math.pow(2,8*be)-1;We(this,ee,oe,be,ye,0)}let ie=1,fe=0;for(this[oe]=ee&255;++fe<be&&(ie*=256);)this[oe+fe]=ee/ie&255;return oe+be},M.prototype.writeUintBE=M.prototype.writeUIntBE=function(ee,oe,be,xe){if(ee=+ee,oe=oe>>>0,be=be>>>0,!xe){const ye=Math.pow(2,8*be)-1;We(this,ee,oe,be,ye,0)}let ie=be-1,fe=1;for(this[oe+ie]=ee&255;--ie>=0&&(fe*=256);)this[oe+ie]=ee/fe&255;return oe+be},M.prototype.writeUint8=M.prototype.writeUInt8=function(ee,oe,be){return ee=+ee,oe=oe>>>0,be||We(this,ee,oe,1,255,0),this[oe]=ee&255,oe+1},M.prototype.writeUint16LE=M.prototype.writeUInt16LE=function(ee,oe,be){return ee=+ee,oe=oe>>>0,be||We(this,ee,oe,2,65535,0),this[oe]=ee&255,this[oe+1]=ee>>>8,oe+2},M.prototype.writeUint16BE=M.prototype.writeUInt16BE=function(ee,oe,be){return ee=+ee,oe=oe>>>0,be||We(this,ee,oe,2,65535,0),this[oe]=ee>>>8,this[oe+1]=ee&255,oe+2},M.prototype.writeUint32LE=M.prototype.writeUInt32LE=function(ee,oe,be){return ee=+ee,oe=oe>>>0,be||We(this,ee,oe,4,4294967295,0),this[oe+3]=ee>>>24,this[oe+2]=ee>>>16,this[oe+1]=ee>>>8,this[oe]=ee&255,oe+4},M.prototype.writeUint32BE=M.prototype.writeUInt32BE=function(ee,oe,be){return ee=+ee,oe=oe>>>0,be||We(this,ee,oe,4,4294967295,0),this[oe]=ee>>>24,this[oe+1]=ee>>>16,this[oe+2]=ee>>>8,this[oe+3]=ee&255,oe+4};function ze(se,ee,oe,be,xe){pt(ee,be,xe,se,oe,7);let ie=Number(ee&BigInt(4294967295));se[oe++]=ie,ie=ie>>8,se[oe++]=ie,ie=ie>>8,se[oe++]=ie,ie=ie>>8,se[oe++]=ie;let fe=Number(ee>>BigInt(32)&BigInt(4294967295));return se[oe++]=fe,fe=fe>>8,se[oe++]=fe,fe=fe>>8,se[oe++]=fe,fe=fe>>8,se[oe++]=fe,oe}function Xe(se,ee,oe,be,xe){pt(ee,be,xe,se,oe,7);let ie=Number(ee&BigInt(4294967295));se[oe+7]=ie,ie=ie>>8,se[oe+6]=ie,ie=ie>>8,se[oe+5]=ie,ie=ie>>8,se[oe+4]=ie;let fe=Number(ee>>BigInt(32)&BigInt(4294967295));return se[oe+3]=fe,fe=fe>>8,se[oe+2]=fe,fe=fe>>8,se[oe+1]=fe,fe=fe>>8,se[oe]=fe,oe+8}M.prototype.writeBigUInt64LE=_t(function(ee,oe=0){return ze(this,ee,oe,BigInt(0),BigInt("0xffffffffffffffff"))}),M.prototype.writeBigUInt64BE=_t(function(ee,oe=0){return Xe(this,ee,oe,BigInt(0),BigInt("0xffffffffffffffff"))}),M.prototype.writeIntLE=function(ee,oe,be,xe){if(ee=+ee,oe=oe>>>0,!xe){const Q=Math.pow(2,8*be-1);We(this,ee,oe,be,Q-1,-Q)}let ie=0,fe=1,ye=0;for(this[oe]=ee&255;++ie<be&&(fe*=256);)ee<0&&ye===0&&this[oe+ie-1]!==0&&(ye=1),this[oe+ie]=(ee/fe>>0)-ye&255;return oe+be},M.prototype.writeIntBE=function(ee,oe,be,xe){if(ee=+ee,oe=oe>>>0,!xe){const Q=Math.pow(2,8*be-1);We(this,ee,oe,be,Q-1,-Q)}let ie=be-1,fe=1,ye=0;for(this[oe+ie]=ee&255;--ie>=0&&(fe*=256);)ee<0&&ye===0&&this[oe+ie+1]!==0&&(ye=1),this[oe+ie]=(ee/fe>>0)-ye&255;return oe+be},M.prototype.writeInt8=function(ee,oe,be){return ee=+ee,oe=oe>>>0,be||We(this,ee,oe,1,127,-128),ee<0&&(ee=255+ee+1),this[oe]=ee&255,oe+1},M.prototype.writeInt16LE=function(ee,oe,be){return ee=+ee,oe=oe>>>0,be||We(this,ee,oe,2,32767,-32768),this[oe]=ee&255,this[oe+1]=ee>>>8,oe+2},M.prototype.writeInt16BE=function(ee,oe,be){return ee=+ee,oe=oe>>>0,be||We(this,ee,oe,2,32767,-32768),this[oe]=ee>>>8,this[oe+1]=ee&255,oe+2},M.prototype.writeInt32LE=function(ee,oe,be){return ee=+ee,oe=oe>>>0,be||We(this,ee,oe,4,2147483647,-2147483648),this[oe]=ee&255,this[oe+1]=ee>>>8,this[oe+2]=ee>>>16,this[oe+3]=ee>>>24,oe+4},M.prototype.writeInt32BE=function(ee,oe,be){return ee=+ee,oe=oe>>>0,be||We(this,ee,oe,4,2147483647,-2147483648),ee<0&&(ee=4294967295+ee+1),this[oe]=ee>>>24,this[oe+1]=ee>>>16,this[oe+2]=ee>>>8,this[oe+3]=ee&255,oe+4},M.prototype.writeBigInt64LE=_t(function(ee,oe=0){return ze(this,ee,oe,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),M.prototype.writeBigInt64BE=_t(function(ee,oe=0){return Xe(this,ee,oe,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function it(se,ee,oe,be,xe,ie){if(oe+be>se.length)throw new RangeError("Index out of range");if(oe<0)throw new RangeError("Index out of range")}function Je(se,ee,oe,be,xe){return ee=+ee,oe=oe>>>0,xe||it(se,ee,oe,4),z.write(se,ee,oe,be,23,4),oe+4}M.prototype.writeFloatLE=function(ee,oe,be){return Je(this,ee,oe,!0,be)},M.prototype.writeFloatBE=function(ee,oe,be){return Je(this,ee,oe,!1,be)};function bt(se,ee,oe,be,xe){return ee=+ee,oe=oe>>>0,xe||it(se,ee,oe,8),z.write(se,ee,oe,be,52,8),oe+8}M.prototype.writeDoubleLE=function(ee,oe,be){return bt(this,ee,oe,!0,be)},M.prototype.writeDoubleBE=function(ee,oe,be){return bt(this,ee,oe,!1,be)},M.prototype.copy=function(ee,oe,be,xe){if(!M.isBuffer(ee))throw new TypeError("argument should be a Buffer");if(be||(be=0),!xe&&xe!==0&&(xe=this.length),oe>=ee.length&&(oe=ee.length),oe||(oe=0),xe>0&&xe<be&&(xe=be),xe===be||ee.length===0||this.length===0)return 0;if(oe<0)throw new RangeError("targetStart out of bounds");if(be<0||be>=this.length)throw new RangeError("Index out of range");if(xe<0)throw new RangeError("sourceEnd out of bounds");xe>this.length&&(xe=this.length),ee.length-oe<xe-be&&(xe=ee.length-oe+be);const ie=xe-be;return this===ee&&typeof he.prototype.copyWithin=="function"?this.copyWithin(oe,be,xe):he.prototype.set.call(ee,this.subarray(be,xe),oe),ie},M.prototype.fill=function(ee,oe,be,xe){if(typeof ee=="string"){if(typeof oe=="string"?(xe=oe,oe=0,be=this.length):typeof be=="string"&&(xe=be,be=this.length),xe!==void 0&&typeof xe!="string")throw new TypeError("encoding must be a string");if(typeof xe=="string"&&!M.isEncoding(xe))throw new TypeError("Unknown encoding: "+xe);if(ee.length===1){const fe=ee.charCodeAt(0);(xe==="utf8"&&fe<128||xe==="latin1")&&(ee=fe)}}else typeof ee=="number"?ee=ee&255:typeof ee=="boolean"&&(ee=Number(ee));if(oe<0||this.length<oe||this.length<be)throw new RangeError("Out of range index");if(be<=oe)return this;oe=oe>>>0,be=be===void 0?this.length:be>>>0,ee||(ee=0);let ie;if(typeof ee=="number")for(ie=oe;ie<be;++ie)this[ie]=ee;else{const fe=M.isBuffer(ee)?ee:M.from(ee,xe),ye=fe.length;if(ye===0)throw new TypeError('The value "'+ee+'" is invalid for argument "value"');for(ie=0;ie<be-oe;++ie)this[ie+oe]=fe[ie%ye]}return this};const Et={};function lt(se,ee,oe){Et[se]=class extends oe{constructor(){super(),Object.defineProperty(this,"message",{value:ee.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${se}]`,this.stack,delete this.name}get code(){return se}set code(xe){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:xe,writable:!0})}toString(){return`${this.name} [${se}]: ${this.message}`}}}lt("ERR_BUFFER_OUT_OF_BOUNDS",function(se){return se?`${se} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),lt("ERR_INVALID_ARG_TYPE",function(se,ee){return`The "${se}" argument must be of type number. Received type ${typeof ee}`},TypeError),lt("ERR_OUT_OF_RANGE",function(se,ee,oe){let be=`The value of "${se}" is out of range.`,xe=oe;return Number.isInteger(oe)&&Math.abs(oe)>2**32?xe=wt(String(oe)):typeof oe=="bigint"&&(xe=String(oe),(oe>BigInt(2)**BigInt(32)||oe<-(BigInt(2)**BigInt(32)))&&(xe=wt(xe)),xe+="n"),be+=` It must be ${ee}. Received ${xe}`,be},RangeError);function wt(se){let ee="",oe=se.length;const be=se[0]==="-"?1:0;for(;oe>=be+4;oe-=3)ee=`_${se.slice(oe-3,oe)}${ee}`;return`${se.slice(0,oe)}${ee}`}function qt(se,ee,oe){Tt(ee,"offset"),(se[ee]===void 0||se[ee+oe]===void 0)&&Pt(ee,se.length-(oe+1))}function pt(se,ee,oe,be,xe,ie){if(se>oe||se<ee){const fe=typeof ee=="bigint"?"n":"";let ye;throw ee===0||ee===BigInt(0)?ye=`>= 0${fe} and < 2${fe} ** ${(ie+1)*8}${fe}`:ye=`>= -(2${fe} ** ${(ie+1)*8-1}${fe}) and < 2 ** ${(ie+1)*8-1}${fe}`,new Et.ERR_OUT_OF_RANGE("value",ye,se)}qt(be,xe,ie)}function Tt(se,ee){if(typeof se!="number")throw new Et.ERR_INVALID_ARG_TYPE(ee,"number",se)}function Pt(se,ee,oe){throw Math.floor(se)!==se?(Tt(se,oe),new Et.ERR_OUT_OF_RANGE("offset","an integer",se)):ee<0?new Et.ERR_BUFFER_OUT_OF_BOUNDS:new Et.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${ee}`,se)}const gt=/[^+/0-9A-Za-z-_]/g;function kt(se){if(se=se.split("=")[0],se=se.trim().replace(gt,""),se.length<2)return"";for(;se.length%4!==0;)se=se+"=";return se}function Mt(se,ee){ee=ee||1/0;let oe;const be=se.length;let xe=null;const ie=[];for(let fe=0;fe<be;++fe){if(oe=se.charCodeAt(fe),oe>55295&&oe<57344){if(!xe){if(oe>56319){(ee-=3)>-1&&ie.push(239,191,189);continue}else if(fe+1===be){(ee-=3)>-1&&ie.push(239,191,189);continue}xe=oe;continue}if(oe<56320){(ee-=3)>-1&&ie.push(239,191,189),xe=oe;continue}oe=(xe-55296<<10|oe-56320)+65536}else xe&&(ee-=3)>-1&&ie.push(239,191,189);if(xe=null,oe<128){if((ee-=1)<0)break;ie.push(oe)}else if(oe<2048){if((ee-=2)<0)break;ie.push(oe>>6|192,oe&63|128)}else if(oe<65536){if((ee-=3)<0)break;ie.push(oe>>12|224,oe>>6&63|128,oe&63|128)}else if(oe<1114112){if((ee-=4)<0)break;ie.push(oe>>18|240,oe>>12&63|128,oe>>6&63|128,oe&63|128)}else throw new Error("Invalid code point")}return ie}function ft(se){const ee=[];for(let oe=0;oe<se.length;++oe)ee.push(se.charCodeAt(oe)&255);return ee}function Ut(se,ee){let oe,be,xe;const ie=[];for(let fe=0;fe<se.length&&!((ee-=2)<0);++fe)oe=se.charCodeAt(fe),be=oe>>8,xe=oe%256,ie.push(xe),ie.push(be);return ie}function Dt(se){return U.toByteArray(kt(se))}function dt(se,ee,oe,be){let xe;for(xe=0;xe<be&&!(xe+oe>=ee.length||xe>=se.length);++xe)ee[xe+oe]=se[xe];return xe}function Ot(se,ee){return se instanceof ee||se!=null&&se.constructor!=null&&se.constructor.name!=null&&se.constructor.name===ee.name}function It(se){return se!==se}const rt=(function(){const se="0123456789abcdef",ee=new Array(256);for(let oe=0;oe<16;++oe){const be=oe*16;for(let xe=0;xe<16;++xe)ee[be+xe]=se[oe]+se[xe]}return ee})();function _t(se){return typeof BigInt>"u"?Se:se}function Se(){throw new Error("BigInt not supported")}})(u);const $=u.Buffer;g.Blob=u.Blob,g.BlobOptions=u.BlobOptions,g.Buffer=u.Buffer,g.File=u.File,g.FileOptions=u.FileOptions,g.INSPECT_MAX_BYTES=u.INSPECT_MAX_BYTES,g.SlowBuffer=u.SlowBuffer,g.TranscodeEncoding=u.TranscodeEncoding,g.atob=u.atob,g.btoa=u.btoa,g.constants=u.constants,g.default=$,g.isAscii=u.isAscii,g.isUtf8=u.isUtf8,g.kMaxLength=u.kMaxLength,g.kStringMaxLength=u.kStringMaxLength,g.resolveObjectURL=u.resolveObjectURL,g.transcode=u.transcode})(dist$1)),dist$1}var bn$2=bn$3.exports,hasRequiredBn$1;function requireBn$1(){return hasRequiredBn$1||(hasRequiredBn$1=1,(function(g){(function(u,h){function y(N,P){if(!N)throw new Error(P||"Assertion failed")}function v(N,P){N.super_=P;var O=function(){};O.prototype=P.prototype,N.prototype=new O,N.prototype.constructor=N}function b(N,P,O){if(b.isBN(N))return N;this.negative=0,this.words=null,this.length=0,this.red=null,N!==null&&((P==="le"||P==="be")&&(O=P,P=10),this._init(N||0,P||10,O||"be"))}typeof u=="object"?u.exports=b:h.BN=b,b.BN=b,b.wordSize=26;var w;try{typeof window<"u"&&typeof window.Buffer<"u"?w=window.Buffer:w=requireDist$1().Buffer}catch{}b.isBN=function(P){return P instanceof b?!0:P!==null&&typeof P=="object"&&P.constructor.wordSize===b.wordSize&&Array.isArray(P.words)},b.max=function(P,O){return P.cmp(O)>0?P:O},b.min=function(P,O){return P.cmp(O)<0?P:O},b.prototype._init=function(P,O,k){if(typeof P=="number")return this._initNumber(P,O,k);if(typeof P=="object")return this._initArray(P,O,k);O==="hex"&&(O=16),y(O===(O|0)&&O>=2&&O<=36),P=P.toString().replace(/\s+/g,"");var q=0;P[0]==="-"&&(q++,this.negative=1),q<P.length&&(O===16?this._parseHex(P,q,k):(this._parseBase(P,O,q),k==="le"&&this._initArray(this.toArray(),O,k)))},b.prototype._initNumber=function(P,O,k){P<0&&(this.negative=1,P=-P),P<67108864?(this.words=[P&67108863],this.length=1):P<4503599627370496?(this.words=[P&67108863,P/67108864&67108863],this.length=2):(y(P<9007199254740992),this.words=[P&67108863,P/67108864&67108863,1],this.length=3),k==="le"&&this._initArray(this.toArray(),O,k)},b.prototype._initArray=function(P,O,k){if(y(typeof P.length=="number"),P.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(P.length/3),this.words=new Array(this.length);for(var q=0;q<this.length;q++)this.words[q]=0;var F,H,D=0;if(k==="be")for(q=P.length-1,F=0;q>=0;q-=3)H=P[q]|P[q-1]<<8|P[q-2]<<16,this.words[F]|=H<<D&67108863,this.words[F+1]=H>>>26-D&67108863,D+=24,D>=26&&(D-=26,F++);else if(k==="le")for(q=0,F=0;q<P.length;q+=3)H=P[q]|P[q+1]<<8|P[q+2]<<16,this.words[F]|=H<<D&67108863,this.words[F+1]=H>>>26-D&67108863,D+=24,D>=26&&(D-=26,F++);return this._strip()};function E(N,P){var O=N.charCodeAt(P);if(O>=48&&O<=57)return O-48;if(O>=65&&O<=70)return O-55;if(O>=97&&O<=102)return O-87;y(!1,"Invalid character in "+N)}function _(N,P,O){var k=E(N,O);return O-1>=P&&(k|=E(N,O-1)<<4),k}b.prototype._parseHex=function(P,O,k){this.length=Math.ceil((P.length-O)/6),this.words=new Array(this.length);for(var q=0;q<this.length;q++)this.words[q]=0;var F=0,H=0,D;if(k==="be")for(q=P.length-1;q>=O;q-=2)D=_(P,O,q)<<F,this.words[H]|=D&67108863,F>=18?(F-=18,H+=1,this.words[H]|=D>>>26):F+=8;else{var G=P.length-O;for(q=G%2===0?O+1:O;q<P.length;q+=2)D=_(P,O,q)<<F,this.words[H]|=D&67108863,F>=18?(F-=18,H+=1,this.words[H]|=D>>>26):F+=8}this._strip()};function S(N,P,O,k){for(var q=0,F=0,H=Math.min(N.length,O),D=P;D<H;D++){var G=N.charCodeAt(D)-48;q*=k,G>=49?F=G-49+10:G>=17?F=G-17+10:F=G,y(G>=0&&F<k,"Invalid character"),q+=F}return q}b.prototype._parseBase=function(P,O,k){this.words=[0],this.length=1;for(var q=0,F=1;F<=67108863;F*=O)q++;q--,F=F/O|0;for(var H=P.length-k,D=H%q,G=Math.min(H,H-D)+k,W=0,K=k;K<G;K+=q)W=S(P,K,K+q,O),this.imuln(F),this.words[0]+W<67108864?this.words[0]+=W:this._iaddn(W);if(D!==0){var Z=1;for(W=S(P,K,P.length,O),K=0;K<D;K++)Z*=O;this.imuln(Z),this.words[0]+W<67108864?this.words[0]+=W:this._iaddn(W)}this._strip()},b.prototype.copy=function(P){P.words=new Array(this.length);for(var O=0;O<this.length;O++)P.words[O]=this.words[O];P.length=this.length,P.negative=this.negative,P.red=this.red};function A(N,P){N.words=P.words,N.length=P.length,N.negative=P.negative,N.red=P.red}if(b.prototype._move=function(P){A(P,this)},b.prototype.clone=function(){var P=new b(null);return this.copy(P),P},b.prototype._expand=function(P){for(;this.length<P;)this.words[this.length++]=0;return this},b.prototype._strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},b.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},typeof Symbol<"u"&&typeof Symbol.for=="function")try{b.prototype[Symbol.for("nodejs.util.inspect.custom")]=R}catch{b.prototype.inspect=R}else b.prototype.inspect=R;function R(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var x=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],T=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],C=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];b.prototype.toString=function(P,O){P=P||10,O=O|0||1;var k;if(P===16||P==="hex"){k="";for(var q=0,F=0,H=0;H<this.length;H++){var D=this.words[H],G=((D<<q|F)&16777215).toString(16);F=D>>>24-q&16777215,q+=2,q>=26&&(q-=26,H--),F!==0||H!==this.length-1?k=x[6-G.length]+G+k:k=G+k}for(F!==0&&(k=F.toString(16)+k);k.length%O!==0;)k="0"+k;return this.negative!==0&&(k="-"+k),k}if(P===(P|0)&&P>=2&&P<=36){var W=T[P],K=C[P];k="";var Z=this.clone();for(Z.negative=0;!Z.isZero();){var ae=Z.modrn(K).toString(P);Z=Z.idivn(K),Z.isZero()?k=ae+k:k=x[W-ae.length]+ae+k}for(this.isZero()&&(k="0"+k);k.length%O!==0;)k="0"+k;return this.negative!==0&&(k="-"+k),k}y(!1,"Base should be between 2 and 36")},b.prototype.toNumber=function(){var P=this.words[0];return this.length===2?P+=this.words[1]*67108864:this.length===3&&this.words[2]===1?P+=4503599627370496+this.words[1]*67108864:this.length>2&&y(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-P:P},b.prototype.toJSON=function(){return this.toString(16,2)},w&&(b.prototype.toBuffer=function(P,O){return this.toArrayLike(w,P,O)}),b.prototype.toArray=function(P,O){return this.toArrayLike(Array,P,O)};var I=function(P,O){return P.allocUnsafe?P.allocUnsafe(O):new P(O)};b.prototype.toArrayLike=function(P,O,k){this._strip();var q=this.byteLength(),F=k||Math.max(1,q);y(q<=F,"byte array longer than desired length"),y(F>0,"Requested array length <= 0");var H=I(P,F),D=O==="le"?"LE":"BE";return this["_toArrayLike"+D](H,q),H},b.prototype._toArrayLikeLE=function(P,O){for(var k=0,q=0,F=0,H=0;F<this.length;F++){var D=this.words[F]<<H|q;P[k++]=D&255,k<P.length&&(P[k++]=D>>8&255),k<P.length&&(P[k++]=D>>16&255),H===6?(k<P.length&&(P[k++]=D>>24&255),q=0,H=0):(q=D>>>24,H+=2)}if(k<P.length)for(P[k++]=q;k<P.length;)P[k++]=0},b.prototype._toArrayLikeBE=function(P,O){for(var k=P.length-1,q=0,F=0,H=0;F<this.length;F++){var D=this.words[F]<<H|q;P[k--]=D&255,k>=0&&(P[k--]=D>>8&255),k>=0&&(P[k--]=D>>16&255),H===6?(k>=0&&(P[k--]=D>>24&255),q=0,H=0):(q=D>>>24,H+=2)}if(k>=0)for(P[k--]=q;k>=0;)P[k--]=0},Math.clz32?b.prototype._countBits=function(P){return 32-Math.clz32(P)}:b.prototype._countBits=function(P){var O=P,k=0;return O>=4096&&(k+=13,O>>>=13),O>=64&&(k+=7,O>>>=7),O>=8&&(k+=4,O>>>=4),O>=2&&(k+=2,O>>>=2),k+O},b.prototype._zeroBits=function(P){if(P===0)return 26;var O=P,k=0;return(O&8191)===0&&(k+=13,O>>>=13),(O&127)===0&&(k+=7,O>>>=7),(O&15)===0&&(k+=4,O>>>=4),(O&3)===0&&(k+=2,O>>>=2),(O&1)===0&&k++,k},b.prototype.bitLength=function(){var P=this.words[this.length-1],O=this._countBits(P);return(this.length-1)*26+O};function L(N){for(var P=new Array(N.bitLength()),O=0;O<P.length;O++){var k=O/26|0,q=O%26;P[O]=N.words[k]>>>q&1}return P}b.prototype.zeroBits=function(){if(this.isZero())return 0;for(var P=0,O=0;O<this.length;O++){var k=this._zeroBits(this.words[O]);if(P+=k,k!==26)break}return P},b.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},b.prototype.toTwos=function(P){return this.negative!==0?this.abs().inotn(P).iaddn(1):this.clone()},b.prototype.fromTwos=function(P){return this.testn(P-1)?this.notn(P).iaddn(1).ineg():this.clone()},b.prototype.isNeg=function(){return this.negative!==0},b.prototype.neg=function(){return this.clone().ineg()},b.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},b.prototype.iuor=function(P){for(;this.length<P.length;)this.words[this.length++]=0;for(var O=0;O<P.length;O++)this.words[O]=this.words[O]|P.words[O];return this._strip()},b.prototype.ior=function(P){return y((this.negative|P.negative)===0),this.iuor(P)},b.prototype.or=function(P){return this.length>P.length?this.clone().ior(P):P.clone().ior(this)},b.prototype.uor=function(P){return this.length>P.length?this.clone().iuor(P):P.clone().iuor(this)},b.prototype.iuand=function(P){var O;this.length>P.length?O=P:O=this;for(var k=0;k<O.length;k++)this.words[k]=this.words[k]&P.words[k];return this.length=O.length,this._strip()},b.prototype.iand=function(P){return y((this.negative|P.negative)===0),this.iuand(P)},b.prototype.and=function(P){return this.length>P.length?this.clone().iand(P):P.clone().iand(this)},b.prototype.uand=function(P){return this.length>P.length?this.clone().iuand(P):P.clone().iuand(this)},b.prototype.iuxor=function(P){var O,k;this.length>P.length?(O=this,k=P):(O=P,k=this);for(var q=0;q<k.length;q++)this.words[q]=O.words[q]^k.words[q];if(this!==O)for(;q<O.length;q++)this.words[q]=O.words[q];return this.length=O.length,this._strip()},b.prototype.ixor=function(P){return y((this.negative|P.negative)===0),this.iuxor(P)},b.prototype.xor=function(P){return this.length>P.length?this.clone().ixor(P):P.clone().ixor(this)},b.prototype.uxor=function(P){return this.length>P.length?this.clone().iuxor(P):P.clone().iuxor(this)},b.prototype.inotn=function(P){y(typeof P=="number"&&P>=0);var O=Math.ceil(P/26)|0,k=P%26;this._expand(O),k>0&&O--;for(var q=0;q<O;q++)this.words[q]=~this.words[q]&67108863;return k>0&&(this.words[q]=~this.words[q]&67108863>>26-k),this._strip()},b.prototype.notn=function(P){return this.clone().inotn(P)},b.prototype.setn=function(P,O){y(typeof P=="number"&&P>=0);var k=P/26|0,q=P%26;return this._expand(k+1),O?this.words[k]=this.words[k]|1<<q:this.words[k]=this.words[k]&~(1<<q),this._strip()},b.prototype.iadd=function(P){var O;if(this.negative!==0&&P.negative===0)return this.negative=0,O=this.isub(P),this.negative^=1,this._normSign();if(this.negative===0&&P.negative!==0)return P.negative=0,O=this.isub(P),P.negative=1,O._normSign();var k,q;this.length>P.length?(k=this,q=P):(k=P,q=this);for(var F=0,H=0;H<q.length;H++)O=(k.words[H]|0)+(q.words[H]|0)+F,this.words[H]=O&67108863,F=O>>>26;for(;F!==0&&H<k.length;H++)O=(k.words[H]|0)+F,this.words[H]=O&67108863,F=O>>>26;if(this.length=k.length,F!==0)this.words[this.length]=F,this.length++;else if(k!==this)for(;H<k.length;H++)this.words[H]=k.words[H];return this},b.prototype.add=function(P){var O;return P.negative!==0&&this.negative===0?(P.negative=0,O=this.sub(P),P.negative^=1,O):P.negative===0&&this.negative!==0?(this.negative=0,O=P.sub(this),this.negative=1,O):this.length>P.length?this.clone().iadd(P):P.clone().iadd(this)},b.prototype.isub=function(P){if(P.negative!==0){P.negative=0;var O=this.iadd(P);return P.negative=1,O._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(P),this.negative=1,this._normSign();var k=this.cmp(P);if(k===0)return this.negative=0,this.length=1,this.words[0]=0,this;var q,F;k>0?(q=this,F=P):(q=P,F=this);for(var H=0,D=0;D<F.length;D++)O=(q.words[D]|0)-(F.words[D]|0)+H,H=O>>26,this.words[D]=O&67108863;for(;H!==0&&D<q.length;D++)O=(q.words[D]|0)+H,H=O>>26,this.words[D]=O&67108863;if(H===0&&D<q.length&&q!==this)for(;D<q.length;D++)this.words[D]=q.words[D];return this.length=Math.max(this.length,D),q!==this&&(this.negative=1),this._strip()},b.prototype.sub=function(P){return this.clone().isub(P)};function $(N,P,O){O.negative=P.negative^N.negative;var k=N.length+P.length|0;O.length=k,k=k-1|0;var q=N.words[0]|0,F=P.words[0]|0,H=q*F,D=H&67108863,G=H/67108864|0;O.words[0]=D;for(var W=1;W<k;W++){for(var K=G>>>26,Z=G&67108863,ae=Math.min(W,P.length-1),le=Math.max(0,W-N.length+1);le<=ae;le++){var te=W-le|0;q=N.words[te]|0,F=P.words[le]|0,H=q*F+Z,K+=H/67108864|0,Z=H&67108863}O.words[W]=Z|0,G=K|0}return G!==0?O.words[W]=G|0:O.length--,O._strip()}var B=function(P,O,k){var q=P.words,F=O.words,H=k.words,D=0,G,W,K,Z=q[0]|0,ae=Z&8191,le=Z>>>13,te=q[1]|0,ce=te&8191,ge=te>>>13,Ee=q[2]|0,pe=Ee&8191,de=Ee>>>13,me=q[3]|0,_e=me&8191,Ae=me>>>13,Pe=q[4]|0,Me=Pe&8191,Ne=Pe>>>13,we=q[5]|0,Le=we&8191,Oe=we>>>13,Ce=q[6]|0,We=Ce&8191,ze=Ce>>>13,Xe=q[7]|0,it=Xe&8191,Je=Xe>>>13,bt=q[8]|0,Et=bt&8191,lt=bt>>>13,wt=q[9]|0,qt=wt&8191,pt=wt>>>13,Tt=F[0]|0,Pt=Tt&8191,gt=Tt>>>13,kt=F[1]|0,Mt=kt&8191,ft=kt>>>13,Ut=F[2]|0,Dt=Ut&8191,dt=Ut>>>13,Ot=F[3]|0,It=Ot&8191,rt=Ot>>>13,_t=F[4]|0,Se=_t&8191,se=_t>>>13,ee=F[5]|0,oe=ee&8191,be=ee>>>13,xe=F[6]|0,ie=xe&8191,fe=xe>>>13,ye=F[7]|0,Q=ye&8191,ve=ye>>>13,Te=F[8]|0,Ie=Te&8191,$e=Te>>>13,De=F[9]|0,Ve=De&8191,Ke=De>>>13;k.negative=P.negative^O.negative,k.length=19,G=Math.imul(ae,Pt),W=Math.imul(ae,gt),W=W+Math.imul(le,Pt)|0,K=Math.imul(le,gt);var vt=(D+G|0)+((W&8191)<<13)|0;D=(K+(W>>>13)|0)+(vt>>>26)|0,vt&=67108863,G=Math.imul(ce,Pt),W=Math.imul(ce,gt),W=W+Math.imul(ge,Pt)|0,K=Math.imul(ge,gt),G=G+Math.imul(ae,Mt)|0,W=W+Math.imul(ae,ft)|0,W=W+Math.imul(le,Mt)|0,K=K+Math.imul(le,ft)|0;var Ge=(D+G|0)+((W&8191)<<13)|0;D=(K+(W>>>13)|0)+(Ge>>>26)|0,Ge&=67108863,G=Math.imul(pe,Pt),W=Math.imul(pe,gt),W=W+Math.imul(de,Pt)|0,K=Math.imul(de,gt),G=G+Math.imul(ce,Mt)|0,W=W+Math.imul(ce,ft)|0,W=W+Math.imul(ge,Mt)|0,K=K+Math.imul(ge,ft)|0,G=G+Math.imul(ae,Dt)|0,W=W+Math.imul(ae,dt)|0,W=W+Math.imul(le,Dt)|0,K=K+Math.imul(le,dt)|0;var nt=(D+G|0)+((W&8191)<<13)|0;D=(K+(W>>>13)|0)+(nt>>>26)|0,nt&=67108863,G=Math.imul(_e,Pt),W=Math.imul(_e,gt),W=W+Math.imul(Ae,Pt)|0,K=Math.imul(Ae,gt),G=G+Math.imul(pe,Mt)|0,W=W+Math.imul(pe,ft)|0,W=W+Math.imul(de,Mt)|0,K=K+Math.imul(de,ft)|0,G=G+Math.imul(ce,Dt)|0,W=W+Math.imul(ce,dt)|0,W=W+Math.imul(ge,Dt)|0,K=K+Math.imul(ge,dt)|0,G=G+Math.imul(ae,It)|0,W=W+Math.imul(ae,rt)|0,W=W+Math.imul(le,It)|0,K=K+Math.imul(le,rt)|0;var st=(D+G|0)+((W&8191)<<13)|0;D=(K+(W>>>13)|0)+(st>>>26)|0,st&=67108863,G=Math.imul(Me,Pt),W=Math.imul(Me,gt),W=W+Math.imul(Ne,Pt)|0,K=Math.imul(Ne,gt),G=G+Math.imul(_e,Mt)|0,W=W+Math.imul(_e,ft)|0,W=W+Math.imul(Ae,Mt)|0,K=K+Math.imul(Ae,ft)|0,G=G+Math.imul(pe,Dt)|0,W=W+Math.imul(pe,dt)|0,W=W+Math.imul(de,Dt)|0,K=K+Math.imul(de,dt)|0,G=G+Math.imul(ce,It)|0,W=W+Math.imul(ce,rt)|0,W=W+Math.imul(ge,It)|0,K=K+Math.imul(ge,rt)|0,G=G+Math.imul(ae,Se)|0,W=W+Math.imul(ae,se)|0,W=W+Math.imul(le,Se)|0,K=K+Math.imul(le,se)|0;var mt=(D+G|0)+((W&8191)<<13)|0;D=(K+(W>>>13)|0)+(mt>>>26)|0,mt&=67108863,G=Math.imul(Le,Pt),W=Math.imul(Le,gt),W=W+Math.imul(Oe,Pt)|0,K=Math.imul(Oe,gt),G=G+Math.imul(Me,Mt)|0,W=W+Math.imul(Me,ft)|0,W=W+Math.imul(Ne,Mt)|0,K=K+Math.imul(Ne,ft)|0,G=G+Math.imul(_e,Dt)|0,W=W+Math.imul(_e,dt)|0,W=W+Math.imul(Ae,Dt)|0,K=K+Math.imul(Ae,dt)|0,G=G+Math.imul(pe,It)|0,W=W+Math.imul(pe,rt)|0,W=W+Math.imul(de,It)|0,K=K+Math.imul(de,rt)|0,G=G+Math.imul(ce,Se)|0,W=W+Math.imul(ce,se)|0,W=W+Math.imul(ge,Se)|0,K=K+Math.imul(ge,se)|0,G=G+Math.imul(ae,oe)|0,W=W+Math.imul(ae,be)|0,W=W+Math.imul(le,oe)|0,K=K+Math.imul(le,be)|0;var yt=(D+G|0)+((W&8191)<<13)|0;D=(K+(W>>>13)|0)+(yt>>>26)|0,yt&=67108863,G=Math.imul(We,Pt),W=Math.imul(We,gt),W=W+Math.imul(ze,Pt)|0,K=Math.imul(ze,gt),G=G+Math.imul(Le,Mt)|0,W=W+Math.imul(Le,ft)|0,W=W+Math.imul(Oe,Mt)|0,K=K+Math.imul(Oe,ft)|0,G=G+Math.imul(Me,Dt)|0,W=W+Math.imul(Me,dt)|0,W=W+Math.imul(Ne,Dt)|0,K=K+Math.imul(Ne,dt)|0,G=G+Math.imul(_e,It)|0,W=W+Math.imul(_e,rt)|0,W=W+Math.imul(Ae,It)|0,K=K+Math.imul(Ae,rt)|0,G=G+Math.imul(pe,Se)|0,W=W+Math.imul(pe,se)|0,W=W+Math.imul(de,Se)|0,K=K+Math.imul(de,se)|0,G=G+Math.imul(ce,oe)|0,W=W+Math.imul(ce,be)|0,W=W+Math.imul(ge,oe)|0,K=K+Math.imul(ge,be)|0,G=G+Math.imul(ae,ie)|0,W=W+Math.imul(ae,fe)|0,W=W+Math.imul(le,ie)|0,K=K+Math.imul(le,fe)|0;var ot=(D+G|0)+((W&8191)<<13)|0;D=(K+(W>>>13)|0)+(ot>>>26)|0,ot&=67108863,G=Math.imul(it,Pt),W=Math.imul(it,gt),W=W+Math.imul(Je,Pt)|0,K=Math.imul(Je,gt),G=G+Math.imul(We,Mt)|0,W=W+Math.imul(We,ft)|0,W=W+Math.imul(ze,Mt)|0,K=K+Math.imul(ze,ft)|0,G=G+Math.imul(Le,Dt)|0,W=W+Math.imul(Le,dt)|0,W=W+Math.imul(Oe,Dt)|0,K=K+Math.imul(Oe,dt)|0,G=G+Math.imul(Me,It)|0,W=W+Math.imul(Me,rt)|0,W=W+Math.imul(Ne,It)|0,K=K+Math.imul(Ne,rt)|0,G=G+Math.imul(_e,Se)|0,W=W+Math.imul(_e,se)|0,W=W+Math.imul(Ae,Se)|0,K=K+Math.imul(Ae,se)|0,G=G+Math.imul(pe,oe)|0,W=W+Math.imul(pe,be)|0,W=W+Math.imul(de,oe)|0,K=K+Math.imul(de,be)|0,G=G+Math.imul(ce,ie)|0,W=W+Math.imul(ce,fe)|0,W=W+Math.imul(ge,ie)|0,K=K+Math.imul(ge,fe)|0,G=G+Math.imul(ae,Q)|0,W=W+Math.imul(ae,ve)|0,W=W+Math.imul(le,Q)|0,K=K+Math.imul(le,ve)|0;var ct=(D+G|0)+((W&8191)<<13)|0;D=(K+(W>>>13)|0)+(ct>>>26)|0,ct&=67108863,G=Math.imul(Et,Pt),W=Math.imul(Et,gt),W=W+Math.imul(lt,Pt)|0,K=Math.imul(lt,gt),G=G+Math.imul(it,Mt)|0,W=W+Math.imul(it,ft)|0,W=W+Math.imul(Je,Mt)|0,K=K+Math.imul(Je,ft)|0,G=G+Math.imul(We,Dt)|0,W=W+Math.imul(We,dt)|0,W=W+Math.imul(ze,Dt)|0,K=K+Math.imul(ze,dt)|0,G=G+Math.imul(Le,It)|0,W=W+Math.imul(Le,rt)|0,W=W+Math.imul(Oe,It)|0,K=K+Math.imul(Oe,rt)|0,G=G+Math.imul(Me,Se)|0,W=W+Math.imul(Me,se)|0,W=W+Math.imul(Ne,Se)|0,K=K+Math.imul(Ne,se)|0,G=G+Math.imul(_e,oe)|0,W=W+Math.imul(_e,be)|0,W=W+Math.imul(Ae,oe)|0,K=K+Math.imul(Ae,be)|0,G=G+Math.imul(pe,ie)|0,W=W+Math.imul(pe,fe)|0,W=W+Math.imul(de,ie)|0,K=K+Math.imul(de,fe)|0,G=G+Math.imul(ce,Q)|0,W=W+Math.imul(ce,ve)|0,W=W+Math.imul(ge,Q)|0,K=K+Math.imul(ge,ve)|0,G=G+Math.imul(ae,Ie)|0,W=W+Math.imul(ae,$e)|0,W=W+Math.imul(le,Ie)|0,K=K+Math.imul(le,$e)|0;var at=(D+G|0)+((W&8191)<<13)|0;D=(K+(W>>>13)|0)+(at>>>26)|0,at&=67108863,G=Math.imul(qt,Pt),W=Math.imul(qt,gt),W=W+Math.imul(pt,Pt)|0,K=Math.imul(pt,gt),G=G+Math.imul(Et,Mt)|0,W=W+Math.imul(Et,ft)|0,W=W+Math.imul(lt,Mt)|0,K=K+Math.imul(lt,ft)|0,G=G+Math.imul(it,Dt)|0,W=W+Math.imul(it,dt)|0,W=W+Math.imul(Je,Dt)|0,K=K+Math.imul(Je,dt)|0,G=G+Math.imul(We,It)|0,W=W+Math.imul(We,rt)|0,W=W+Math.imul(ze,It)|0,K=K+Math.imul(ze,rt)|0,G=G+Math.imul(Le,Se)|0,W=W+Math.imul(Le,se)|0,W=W+Math.imul(Oe,Se)|0,K=K+Math.imul(Oe,se)|0,G=G+Math.imul(Me,oe)|0,W=W+Math.imul(Me,be)|0,W=W+Math.imul(Ne,oe)|0,K=K+Math.imul(Ne,be)|0,G=G+Math.imul(_e,ie)|0,W=W+Math.imul(_e,fe)|0,W=W+Math.imul(Ae,ie)|0,K=K+Math.imul(Ae,fe)|0,G=G+Math.imul(pe,Q)|0,W=W+Math.imul(pe,ve)|0,W=W+Math.imul(de,Q)|0,K=K+Math.imul(de,ve)|0,G=G+Math.imul(ce,Ie)|0,W=W+Math.imul(ce,$e)|0,W=W+Math.imul(ge,Ie)|0,K=K+Math.imul(ge,$e)|0,G=G+Math.imul(ae,Ve)|0,W=W+Math.imul(ae,Ke)|0,W=W+Math.imul(le,Ve)|0,K=K+Math.imul(le,Ke)|0;var Ze=(D+G|0)+((W&8191)<<13)|0;D=(K+(W>>>13)|0)+(Ze>>>26)|0,Ze&=67108863,G=Math.imul(qt,Mt),W=Math.imul(qt,ft),W=W+Math.imul(pt,Mt)|0,K=Math.imul(pt,ft),G=G+Math.imul(Et,Dt)|0,W=W+Math.imul(Et,dt)|0,W=W+Math.imul(lt,Dt)|0,K=K+Math.imul(lt,dt)|0,G=G+Math.imul(it,It)|0,W=W+Math.imul(it,rt)|0,W=W+Math.imul(Je,It)|0,K=K+Math.imul(Je,rt)|0,G=G+Math.imul(We,Se)|0,W=W+Math.imul(We,se)|0,W=W+Math.imul(ze,Se)|0,K=K+Math.imul(ze,se)|0,G=G+Math.imul(Le,oe)|0,W=W+Math.imul(Le,be)|0,W=W+Math.imul(Oe,oe)|0,K=K+Math.imul(Oe,be)|0,G=G+Math.imul(Me,ie)|0,W=W+Math.imul(Me,fe)|0,W=W+Math.imul(Ne,ie)|0,K=K+Math.imul(Ne,fe)|0,G=G+Math.imul(_e,Q)|0,W=W+Math.imul(_e,ve)|0,W=W+Math.imul(Ae,Q)|0,K=K+Math.imul(Ae,ve)|0,G=G+Math.imul(pe,Ie)|0,W=W+Math.imul(pe,$e)|0,W=W+Math.imul(de,Ie)|0,K=K+Math.imul(de,$e)|0,G=G+Math.imul(ce,Ve)|0,W=W+Math.imul(ce,Ke)|0,W=W+Math.imul(ge,Ve)|0,K=K+Math.imul(ge,Ke)|0;var tt=(D+G|0)+((W&8191)<<13)|0;D=(K+(W>>>13)|0)+(tt>>>26)|0,tt&=67108863,G=Math.imul(qt,Dt),W=Math.imul(qt,dt),W=W+Math.imul(pt,Dt)|0,K=Math.imul(pt,dt),G=G+Math.imul(Et,It)|0,W=W+Math.imul(Et,rt)|0,W=W+Math.imul(lt,It)|0,K=K+Math.imul(lt,rt)|0,G=G+Math.imul(it,Se)|0,W=W+Math.imul(it,se)|0,W=W+Math.imul(Je,Se)|0,K=K+Math.imul(Je,se)|0,G=G+Math.imul(We,oe)|0,W=W+Math.imul(We,be)|0,W=W+Math.imul(ze,oe)|0,K=K+Math.imul(ze,be)|0,G=G+Math.imul(Le,ie)|0,W=W+Math.imul(Le,fe)|0,W=W+Math.imul(Oe,ie)|0,K=K+Math.imul(Oe,fe)|0,G=G+Math.imul(Me,Q)|0,W=W+Math.imul(Me,ve)|0,W=W+Math.imul(Ne,Q)|0,K=K+Math.imul(Ne,ve)|0,G=G+Math.imul(_e,Ie)|0,W=W+Math.imul(_e,$e)|0,W=W+Math.imul(Ae,Ie)|0,K=K+Math.imul(Ae,$e)|0,G=G+Math.imul(pe,Ve)|0,W=W+Math.imul(pe,Ke)|0,W=W+Math.imul(de,Ve)|0,K=K+Math.imul(de,Ke)|0;var Ye=(D+G|0)+((W&8191)<<13)|0;D=(K+(W>>>13)|0)+(Ye>>>26)|0,Ye&=67108863,G=Math.imul(qt,It),W=Math.imul(qt,rt),W=W+Math.imul(pt,It)|0,K=Math.imul(pt,rt),G=G+Math.imul(Et,Se)|0,W=W+Math.imul(Et,se)|0,W=W+Math.imul(lt,Se)|0,K=K+Math.imul(lt,se)|0,G=G+Math.imul(it,oe)|0,W=W+Math.imul(it,be)|0,W=W+Math.imul(Je,oe)|0,K=K+Math.imul(Je,be)|0,G=G+Math.imul(We,ie)|0,W=W+Math.imul(We,fe)|0,W=W+Math.imul(ze,ie)|0,K=K+Math.imul(ze,fe)|0,G=G+Math.imul(Le,Q)|0,W=W+Math.imul(Le,ve)|0,W=W+Math.imul(Oe,Q)|0,K=K+Math.imul(Oe,ve)|0,G=G+Math.imul(Me,Ie)|0,W=W+Math.imul(Me,$e)|0,W=W+Math.imul(Ne,Ie)|0,K=K+Math.imul(Ne,$e)|0,G=G+Math.imul(_e,Ve)|0,W=W+Math.imul(_e,Ke)|0,W=W+Math.imul(Ae,Ve)|0,K=K+Math.imul(Ae,Ke)|0;var Qe=(D+G|0)+((W&8191)<<13)|0;D=(K+(W>>>13)|0)+(Qe>>>26)|0,Qe&=67108863,G=Math.imul(qt,Se),W=Math.imul(qt,se),W=W+Math.imul(pt,Se)|0,K=Math.imul(pt,se),G=G+Math.imul(Et,oe)|0,W=W+Math.imul(Et,be)|0,W=W+Math.imul(lt,oe)|0,K=K+Math.imul(lt,be)|0,G=G+Math.imul(it,ie)|0,W=W+Math.imul(it,fe)|0,W=W+Math.imul(Je,ie)|0,K=K+Math.imul(Je,fe)|0,G=G+Math.imul(We,Q)|0,W=W+Math.imul(We,ve)|0,W=W+Math.imul(ze,Q)|0,K=K+Math.imul(ze,ve)|0,G=G+Math.imul(Le,Ie)|0,W=W+Math.imul(Le,$e)|0,W=W+Math.imul(Oe,Ie)|0,K=K+Math.imul(Oe,$e)|0,G=G+Math.imul(Me,Ve)|0,W=W+Math.imul(Me,Ke)|0,W=W+Math.imul(Ne,Ve)|0,K=K+Math.imul(Ne,Ke)|0;var et=(D+G|0)+((W&8191)<<13)|0;D=(K+(W>>>13)|0)+(et>>>26)|0,et&=67108863,G=Math.imul(qt,oe),W=Math.imul(qt,be),W=W+Math.imul(pt,oe)|0,K=Math.imul(pt,be),G=G+Math.imul(Et,ie)|0,W=W+Math.imul(Et,fe)|0,W=W+Math.imul(lt,ie)|0,K=K+Math.imul(lt,fe)|0,G=G+Math.imul(it,Q)|0,W=W+Math.imul(it,ve)|0,W=W+Math.imul(Je,Q)|0,K=K+Math.imul(Je,ve)|0,G=G+Math.imul(We,Ie)|0,W=W+Math.imul(We,$e)|0,W=W+Math.imul(ze,Ie)|0,K=K+Math.imul(ze,$e)|0,G=G+Math.imul(Le,Ve)|0,W=W+Math.imul(Le,Ke)|0,W=W+Math.imul(Oe,Ve)|0,K=K+Math.imul(Oe,Ke)|0;var je=(D+G|0)+((W&8191)<<13)|0;D=(K+(W>>>13)|0)+(je>>>26)|0,je&=67108863,G=Math.imul(qt,ie),W=Math.imul(qt,fe),W=W+Math.imul(pt,ie)|0,K=Math.imul(pt,fe),G=G+Math.imul(Et,Q)|0,W=W+Math.imul(Et,ve)|0,W=W+Math.imul(lt,Q)|0,K=K+Math.imul(lt,ve)|0,G=G+Math.imul(it,Ie)|0,W=W+Math.imul(it,$e)|0,W=W+Math.imul(Je,Ie)|0,K=K+Math.imul(Je,$e)|0,G=G+Math.imul(We,Ve)|0,W=W+Math.imul(We,Ke)|0,W=W+Math.imul(ze,Ve)|0,K=K+Math.imul(ze,Ke)|0;var Be=(D+G|0)+((W&8191)<<13)|0;D=(K+(W>>>13)|0)+(Be>>>26)|0,Be&=67108863,G=Math.imul(qt,Q),W=Math.imul(qt,ve),W=W+Math.imul(pt,Q)|0,K=Math.imul(pt,ve),G=G+Math.imul(Et,Ie)|0,W=W+Math.imul(Et,$e)|0,W=W+Math.imul(lt,Ie)|0,K=K+Math.imul(lt,$e)|0,G=G+Math.imul(it,Ve)|0,W=W+Math.imul(it,Ke)|0,W=W+Math.imul(Je,Ve)|0,K=K+Math.imul(Je,Ke)|0;var ke=(D+G|0)+((W&8191)<<13)|0;D=(K+(W>>>13)|0)+(ke>>>26)|0,ke&=67108863,G=Math.imul(qt,Ie),W=Math.imul(qt,$e),W=W+Math.imul(pt,Ie)|0,K=Math.imul(pt,$e),G=G+Math.imul(Et,Ve)|0,W=W+Math.imul(Et,Ke)|0,W=W+Math.imul(lt,Ve)|0,K=K+Math.imul(lt,Ke)|0;var Fe=(D+G|0)+((W&8191)<<13)|0;D=(K+(W>>>13)|0)+(Fe>>>26)|0,Fe&=67108863,G=Math.imul(qt,Ve),W=Math.imul(qt,Ke),W=W+Math.imul(pt,Ve)|0,K=Math.imul(pt,Ke);var qe=(D+G|0)+((W&8191)<<13)|0;return D=(K+(W>>>13)|0)+(qe>>>26)|0,qe&=67108863,H[0]=vt,H[1]=Ge,H[2]=nt,H[3]=st,H[4]=mt,H[5]=yt,H[6]=ot,H[7]=ct,H[8]=at,H[9]=Ze,H[10]=tt,H[11]=Ye,H[12]=Qe,H[13]=et,H[14]=je,H[15]=Be,H[16]=ke,H[17]=Fe,H[18]=qe,D!==0&&(H[19]=D,k.length++),k};Math.imul||(B=$);function U(N,P,O){O.negative=P.negative^N.negative,O.length=N.length+P.length;for(var k=0,q=0,F=0;F<O.length-1;F++){var H=q;q=0;for(var D=k&67108863,G=Math.min(F,P.length-1),W=Math.max(0,F-N.length+1);W<=G;W++){var K=F-W,Z=N.words[K]|0,ae=P.words[W]|0,le=Z*ae,te=le&67108863;H=H+(le/67108864|0)|0,te=te+D|0,D=te&67108863,H=H+(te>>>26)|0,q+=H>>>26,H&=67108863}O.words[F]=D,k=H,H=q}return k!==0?O.words[F]=k:O.length--,O._strip()}function z(N,P,O){return U(N,P,O)}b.prototype.mulTo=function(P,O){var k,q=this.length+P.length;return this.length===10&&P.length===10?k=B(this,P,O):q<63?k=$(this,P,O):q<1024?k=U(this,P,O):k=z(this,P,O),k},b.prototype.mul=function(P){var O=new b(null);return O.words=new Array(this.length+P.length),this.mulTo(P,O)},b.prototype.mulf=function(P){var O=new b(null);return O.words=new Array(this.length+P.length),z(this,P,O)},b.prototype.imul=function(P){return this.clone().mulTo(P,this)},b.prototype.imuln=function(P){var O=P<0;O&&(P=-P),y(typeof P=="number"),y(P<67108864);for(var k=0,q=0;q<this.length;q++){var F=(this.words[q]|0)*P,H=(F&67108863)+(k&67108863);k>>=26,k+=F/67108864|0,k+=H>>>26,this.words[q]=H&67108863}return k!==0&&(this.words[q]=k,this.length++),this.length=P===0?1:this.length,O?this.ineg():this},b.prototype.muln=function(P){return this.clone().imuln(P)},b.prototype.sqr=function(){return this.mul(this)},b.prototype.isqr=function(){return this.imul(this.clone())},b.prototype.pow=function(P){var O=L(P);if(O.length===0)return new b(1);for(var k=this,q=0;q<O.length&&O[q]===0;q++,k=k.sqr());if(++q<O.length)for(var F=k.sqr();q<O.length;q++,F=F.sqr())O[q]!==0&&(k=k.mul(F));return k},b.prototype.iushln=function(P){y(typeof P=="number"&&P>=0);var O=P%26,k=(P-O)/26,q=67108863>>>26-O<<26-O,F;if(O!==0){var H=0;for(F=0;F<this.length;F++){var D=this.words[F]&q,G=(this.words[F]|0)-D<<O;this.words[F]=G|H,H=D>>>26-O}H&&(this.words[F]=H,this.length++)}if(k!==0){for(F=this.length-1;F>=0;F--)this.words[F+k]=this.words[F];for(F=0;F<k;F++)this.words[F]=0;this.length+=k}return this._strip()},b.prototype.ishln=function(P){return y(this.negative===0),this.iushln(P)},b.prototype.iushrn=function(P,O,k){y(typeof P=="number"&&P>=0);var q;O?q=(O-O%26)/26:q=0;var F=P%26,H=Math.min((P-F)/26,this.length),D=67108863^67108863>>>F<<F,G=k;if(q-=H,q=Math.max(0,q),G){for(var W=0;W<H;W++)G.words[W]=this.words[W];G.length=H}if(H!==0)if(this.length>H)for(this.length-=H,W=0;W<this.length;W++)this.words[W]=this.words[W+H];else this.words[0]=0,this.length=1;var K=0;for(W=this.length-1;W>=0&&(K!==0||W>=q);W--){var Z=this.words[W]|0;this.words[W]=K<<26-F|Z>>>F,K=Z&D}return G&&K!==0&&(G.words[G.length++]=K),this.length===0&&(this.words[0]=0,this.length=1),this._strip()},b.prototype.ishrn=function(P,O,k){return y(this.negative===0),this.iushrn(P,O,k)},b.prototype.shln=function(P){return this.clone().ishln(P)},b.prototype.ushln=function(P){return this.clone().iushln(P)},b.prototype.shrn=function(P){return this.clone().ishrn(P)},b.prototype.ushrn=function(P){return this.clone().iushrn(P)},b.prototype.testn=function(P){y(typeof P=="number"&&P>=0);var O=P%26,k=(P-O)/26,q=1<<O;if(this.length<=k)return!1;var F=this.words[k];return!!(F&q)},b.prototype.imaskn=function(P){y(typeof P=="number"&&P>=0);var O=P%26,k=(P-O)/26;if(y(this.negative===0,"imaskn works only with positive numbers"),this.length<=k)return this;if(O!==0&&k++,this.length=Math.min(k,this.length),O!==0){var q=67108863^67108863>>>O<<O;this.words[this.length-1]&=q}return this._strip()},b.prototype.maskn=function(P){return this.clone().imaskn(P)},b.prototype.iaddn=function(P){return y(typeof P=="number"),y(P<67108864),P<0?this.isubn(-P):this.negative!==0?this.length===1&&(this.words[0]|0)<=P?(this.words[0]=P-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(P),this.negative=1,this):this._iaddn(P)},b.prototype._iaddn=function(P){this.words[0]+=P;for(var O=0;O<this.length&&this.words[O]>=67108864;O++)this.words[O]-=67108864,O===this.length-1?this.words[O+1]=1:this.words[O+1]++;return this.length=Math.max(this.length,O+1),this},b.prototype.isubn=function(P){if(y(typeof P=="number"),y(P<67108864),P<0)return this.iaddn(-P);if(this.negative!==0)return this.negative=0,this.iaddn(P),this.negative=1,this;if(this.words[0]-=P,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var O=0;O<this.length&&this.words[O]<0;O++)this.words[O]+=67108864,this.words[O+1]-=1;return this._strip()},b.prototype.addn=function(P){return this.clone().iaddn(P)},b.prototype.subn=function(P){return this.clone().isubn(P)},b.prototype.iabs=function(){return this.negative=0,this},b.prototype.abs=function(){return this.clone().iabs()},b.prototype._ishlnsubmul=function(P,O,k){var q=P.length+k,F;this._expand(q);var H,D=0;for(F=0;F<P.length;F++){H=(this.words[F+k]|0)+D;var G=(P.words[F]|0)*O;H-=G&67108863,D=(H>>26)-(G/67108864|0),this.words[F+k]=H&67108863}for(;F<this.length-k;F++)H=(this.words[F+k]|0)+D,D=H>>26,this.words[F+k]=H&67108863;if(D===0)return this._strip();for(y(D===-1),D=0,F=0;F<this.length;F++)H=-(this.words[F]|0)+D,D=H>>26,this.words[F]=H&67108863;return this.negative=1,this._strip()},b.prototype._wordDiv=function(P,O){var k=this.length-P.length,q=this.clone(),F=P,H=F.words[F.length-1]|0,D=this._countBits(H);k=26-D,k!==0&&(F=F.ushln(k),q.iushln(k),H=F.words[F.length-1]|0);var G=q.length-F.length,W;if(O!=="mod"){W=new b(null),W.length=G+1,W.words=new Array(W.length);for(var K=0;K<W.length;K++)W.words[K]=0}var Z=q.clone()._ishlnsubmul(F,1,G);Z.negative===0&&(q=Z,W&&(W.words[G]=1));for(var ae=G-1;ae>=0;ae--){var le=(q.words[F.length+ae]|0)*67108864+(q.words[F.length+ae-1]|0);for(le=Math.min(le/H|0,67108863),q._ishlnsubmul(F,le,ae);q.negative!==0;)le--,q.negative=0,q._ishlnsubmul(F,1,ae),q.isZero()||(q.negative^=1);W&&(W.words[ae]=le)}return W&&W._strip(),q._strip(),O!=="div"&&k!==0&&q.iushrn(k),{div:W||null,mod:q}},b.prototype.divmod=function(P,O,k){if(y(!P.isZero()),this.isZero())return{div:new b(0),mod:new b(0)};var q,F,H;return this.negative!==0&&P.negative===0?(H=this.neg().divmod(P,O),O!=="mod"&&(q=H.div.neg()),O!=="div"&&(F=H.mod.neg(),k&&F.negative!==0&&F.iadd(P)),{div:q,mod:F}):this.negative===0&&P.negative!==0?(H=this.divmod(P.neg(),O),O!=="mod"&&(q=H.div.neg()),{div:q,mod:H.mod}):(this.negative&P.negative)!==0?(H=this.neg().divmod(P.neg(),O),O!=="div"&&(F=H.mod.neg(),k&&F.negative!==0&&F.isub(P)),{div:H.div,mod:F}):P.length>this.length||this.cmp(P)<0?{div:new b(0),mod:this}:P.length===1?O==="div"?{div:this.divn(P.words[0]),mod:null}:O==="mod"?{div:null,mod:new b(this.modrn(P.words[0]))}:{div:this.divn(P.words[0]),mod:new b(this.modrn(P.words[0]))}:this._wordDiv(P,O)},b.prototype.div=function(P){return this.divmod(P,"div",!1).div},b.prototype.mod=function(P){return this.divmod(P,"mod",!1).mod},b.prototype.umod=function(P){return this.divmod(P,"mod",!0).mod},b.prototype.divRound=function(P){var O=this.divmod(P);if(O.mod.isZero())return O.div;var k=O.div.negative!==0?O.mod.isub(P):O.mod,q=P.ushrn(1),F=P.andln(1),H=k.cmp(q);return H<0||F===1&&H===0?O.div:O.div.negative!==0?O.div.isubn(1):O.div.iaddn(1)},b.prototype.modrn=function(P){var O=P<0;O&&(P=-P),y(P<=67108863);for(var k=(1<<26)%P,q=0,F=this.length-1;F>=0;F--)q=(k*q+(this.words[F]|0))%P;return O?-q:q},b.prototype.modn=function(P){return this.modrn(P)},b.prototype.idivn=function(P){var O=P<0;O&&(P=-P),y(P<=67108863);for(var k=0,q=this.length-1;q>=0;q--){var F=(this.words[q]|0)+k*67108864;this.words[q]=F/P|0,k=F%P}return this._strip(),O?this.ineg():this},b.prototype.divn=function(P){return this.clone().idivn(P)},b.prototype.egcd=function(P){y(P.negative===0),y(!P.isZero());var O=this,k=P.clone();O.negative!==0?O=O.umod(P):O=O.clone();for(var q=new b(1),F=new b(0),H=new b(0),D=new b(1),G=0;O.isEven()&&k.isEven();)O.iushrn(1),k.iushrn(1),++G;for(var W=k.clone(),K=O.clone();!O.isZero();){for(var Z=0,ae=1;(O.words[0]&ae)===0&&Z<26;++Z,ae<<=1);if(Z>0)for(O.iushrn(Z);Z-- >0;)(q.isOdd()||F.isOdd())&&(q.iadd(W),F.isub(K)),q.iushrn(1),F.iushrn(1);for(var le=0,te=1;(k.words[0]&te)===0&&le<26;++le,te<<=1);if(le>0)for(k.iushrn(le);le-- >0;)(H.isOdd()||D.isOdd())&&(H.iadd(W),D.isub(K)),H.iushrn(1),D.iushrn(1);O.cmp(k)>=0?(O.isub(k),q.isub(H),F.isub(D)):(k.isub(O),H.isub(q),D.isub(F))}return{a:H,b:D,gcd:k.iushln(G)}},b.prototype._invmp=function(P){y(P.negative===0),y(!P.isZero());var O=this,k=P.clone();O.negative!==0?O=O.umod(P):O=O.clone();for(var q=new b(1),F=new b(0),H=k.clone();O.cmpn(1)>0&&k.cmpn(1)>0;){for(var D=0,G=1;(O.words[0]&G)===0&&D<26;++D,G<<=1);if(D>0)for(O.iushrn(D);D-- >0;)q.isOdd()&&q.iadd(H),q.iushrn(1);for(var W=0,K=1;(k.words[0]&K)===0&&W<26;++W,K<<=1);if(W>0)for(k.iushrn(W);W-- >0;)F.isOdd()&&F.iadd(H),F.iushrn(1);O.cmp(k)>=0?(O.isub(k),q.isub(F)):(k.isub(O),F.isub(q))}var Z;return O.cmpn(1)===0?Z=q:Z=F,Z.cmpn(0)<0&&Z.iadd(P),Z},b.prototype.gcd=function(P){if(this.isZero())return P.abs();if(P.isZero())return this.abs();var O=this.clone(),k=P.clone();O.negative=0,k.negative=0;for(var q=0;O.isEven()&&k.isEven();q++)O.iushrn(1),k.iushrn(1);do{for(;O.isEven();)O.iushrn(1);for(;k.isEven();)k.iushrn(1);var F=O.cmp(k);if(F<0){var H=O;O=k,k=H}else if(F===0||k.cmpn(1)===0)break;O.isub(k)}while(!0);return k.iushln(q)},b.prototype.invm=function(P){return this.egcd(P).a.umod(P)},b.prototype.isEven=function(){return(this.words[0]&1)===0},b.prototype.isOdd=function(){return(this.words[0]&1)===1},b.prototype.andln=function(P){return this.words[0]&P},b.prototype.bincn=function(P){y(typeof P=="number");var O=P%26,k=(P-O)/26,q=1<<O;if(this.length<=k)return this._expand(k+1),this.words[k]|=q,this;for(var F=q,H=k;F!==0&&H<this.length;H++){var D=this.words[H]|0;D+=F,F=D>>>26,D&=67108863,this.words[H]=D}return F!==0&&(this.words[H]=F,this.length++),this},b.prototype.isZero=function(){return this.length===1&&this.words[0]===0},b.prototype.cmpn=function(P){var O=P<0;if(this.negative!==0&&!O)return-1;if(this.negative===0&&O)return 1;this._strip();var k;if(this.length>1)k=1;else{O&&(P=-P),y(P<=67108863,"Number is too big");var q=this.words[0]|0;k=q===P?0:q<P?-1:1}return this.negative!==0?-k|0:k},b.prototype.cmp=function(P){if(this.negative!==0&&P.negative===0)return-1;if(this.negative===0&&P.negative!==0)return 1;var O=this.ucmp(P);return this.negative!==0?-O|0:O},b.prototype.ucmp=function(P){if(this.length>P.length)return 1;if(this.length<P.length)return-1;for(var O=0,k=this.length-1;k>=0;k--){var q=this.words[k]|0,F=P.words[k]|0;if(q!==F){q<F?O=-1:q>F&&(O=1);break}}return O},b.prototype.gtn=function(P){return this.cmpn(P)===1},b.prototype.gt=function(P){return this.cmp(P)===1},b.prototype.gten=function(P){return this.cmpn(P)>=0},b.prototype.gte=function(P){return this.cmp(P)>=0},b.prototype.ltn=function(P){return this.cmpn(P)===-1},b.prototype.lt=function(P){return this.cmp(P)===-1},b.prototype.lten=function(P){return this.cmpn(P)<=0},b.prototype.lte=function(P){return this.cmp(P)<=0},b.prototype.eqn=function(P){return this.cmpn(P)===0},b.prototype.eq=function(P){return this.cmp(P)===0},b.red=function(P){return new j(P)},b.prototype.toRed=function(P){return y(!this.red,"Already a number in reduction context"),y(this.negative===0,"red works only with positives"),P.convertTo(this)._forceRed(P)},b.prototype.fromRed=function(){return y(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},b.prototype._forceRed=function(P){return this.red=P,this},b.prototype.forceRed=function(P){return y(!this.red,"Already a number in reduction context"),this._forceRed(P)},b.prototype.redAdd=function(P){return y(this.red,"redAdd works only with red numbers"),this.red.add(this,P)},b.prototype.redIAdd=function(P){return y(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,P)},b.prototype.redSub=function(P){return y(this.red,"redSub works only with red numbers"),this.red.sub(this,P)},b.prototype.redISub=function(P){return y(this.red,"redISub works only with red numbers"),this.red.isub(this,P)},b.prototype.redShl=function(P){return y(this.red,"redShl works only with red numbers"),this.red.shl(this,P)},b.prototype.redMul=function(P){return y(this.red,"redMul works only with red numbers"),this.red._verify2(this,P),this.red.mul(this,P)},b.prototype.redIMul=function(P){return y(this.red,"redMul works only with red numbers"),this.red._verify2(this,P),this.red.imul(this,P)},b.prototype.redSqr=function(){return y(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},b.prototype.redISqr=function(){return y(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},b.prototype.redSqrt=function(){return y(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},b.prototype.redInvm=function(){return y(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},b.prototype.redNeg=function(){return y(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},b.prototype.redPow=function(P){return y(this.red&&!P.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,P)};var ne={k256:null,p224:null,p192:null,p25519:null};function ue(N,P){this.name=N,this.p=new b(P,16),this.n=this.p.bitLength(),this.k=new b(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}ue.prototype._tmp=function(){var P=new b(null);return P.words=new Array(Math.ceil(this.n/13)),P},ue.prototype.ireduce=function(P){var O=P,k;do this.split(O,this.tmp),O=this.imulK(O),O=O.iadd(this.tmp),k=O.bitLength();while(k>this.n);var q=k<this.n?-1:O.ucmp(this.p);return q===0?(O.words[0]=0,O.length=1):q>0?O.isub(this.p):O.strip!==void 0?O.strip():O._strip(),O},ue.prototype.split=function(P,O){P.iushrn(this.n,0,O)},ue.prototype.imulK=function(P){return P.imul(this.k)};function he(){ue.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}v(he,ue),he.prototype.split=function(P,O){for(var k=4194303,q=Math.min(P.length,9),F=0;F<q;F++)O.words[F]=P.words[F];if(O.length=q,P.length<=9){P.words[0]=0,P.length=1;return}var H=P.words[9];for(O.words[O.length++]=H&k,F=10;F<P.length;F++){var D=P.words[F]|0;P.words[F-10]=(D&k)<<4|H>>>22,H=D}H>>>=22,P.words[F-10]=H,H===0&&P.length>10?P.length-=10:P.length-=9},he.prototype.imulK=function(P){P.words[P.length]=0,P.words[P.length+1]=0,P.length+=2;for(var O=0,k=0;k<P.length;k++){var q=P.words[k]|0;O+=q*977,P.words[k]=O&67108863,O=q*64+(O/67108864|0)}return P.words[P.length-1]===0&&(P.length--,P.words[P.length-1]===0&&P.length--),P};function Y(){ue.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}v(Y,ue);function X(){ue.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}v(X,ue);function J(){ue.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}v(J,ue),J.prototype.imulK=function(P){for(var O=0,k=0;k<P.length;k++){var q=(P.words[k]|0)*19+O,F=q&67108863;q>>>=26,P.words[k]=F,O=q}return O!==0&&(P.words[P.length++]=O),P},b._prime=function(P){if(ne[P])return ne[P];var O;if(P==="k256")O=new he;else if(P==="p224")O=new Y;else if(P==="p192")O=new X;else if(P==="p25519")O=new J;else throw new Error("Unknown prime "+P);return ne[P]=O,O};function j(N){if(typeof N=="string"){var P=b._prime(N);this.m=P.p,this.prime=P}else y(N.gtn(1),"modulus must be greater than 1"),this.m=N,this.prime=null}j.prototype._verify1=function(P){y(P.negative===0,"red works only with positives"),y(P.red,"red works only with red numbers")},j.prototype._verify2=function(P,O){y((P.negative|O.negative)===0,"red works only with positives"),y(P.red&&P.red===O.red,"red works only with red numbers")},j.prototype.imod=function(P){return this.prime?this.prime.ireduce(P)._forceRed(this):(A(P,P.umod(this.m)._forceRed(this)),P)},j.prototype.neg=function(P){return P.isZero()?P.clone():this.m.sub(P)._forceRed(this)},j.prototype.add=function(P,O){this._verify2(P,O);var k=P.add(O);return k.cmp(this.m)>=0&&k.isub(this.m),k._forceRed(this)},j.prototype.iadd=function(P,O){this._verify2(P,O);var k=P.iadd(O);return k.cmp(this.m)>=0&&k.isub(this.m),k},j.prototype.sub=function(P,O){this._verify2(P,O);var k=P.sub(O);return k.cmpn(0)<0&&k.iadd(this.m),k._forceRed(this)},j.prototype.isub=function(P,O){this._verify2(P,O);var k=P.isub(O);return k.cmpn(0)<0&&k.iadd(this.m),k},j.prototype.shl=function(P,O){return this._verify1(P),this.imod(P.ushln(O))},j.prototype.imul=function(P,O){return this._verify2(P,O),this.imod(P.imul(O))},j.prototype.mul=function(P,O){return this._verify2(P,O),this.imod(P.mul(O))},j.prototype.isqr=function(P){return this.imul(P,P.clone())},j.prototype.sqr=function(P){return this.mul(P,P)},j.prototype.sqrt=function(P){if(P.isZero())return P.clone();var O=this.m.andln(3);if(y(O%2===1),O===3){var k=this.m.add(new b(1)).iushrn(2);return this.pow(P,k)}for(var q=this.m.subn(1),F=0;!q.isZero()&&q.andln(1)===0;)F++,q.iushrn(1);y(!q.isZero());var H=new b(1).toRed(this),D=H.redNeg(),G=this.m.subn(1).iushrn(1),W=this.m.bitLength();for(W=new b(2*W*W).toRed(this);this.pow(W,G).cmp(D)!==0;)W.redIAdd(D);for(var K=this.pow(W,q),Z=this.pow(P,q.addn(1).iushrn(1)),ae=this.pow(P,q),le=F;ae.cmp(H)!==0;){for(var te=ae,ce=0;te.cmp(H)!==0;ce++)te=te.redSqr();y(ce<le);var ge=this.pow(K,new b(1).iushln(le-ce-1));Z=Z.redMul(ge),K=ge.redSqr(),ae=ae.redMul(K),le=ce}return Z},j.prototype.invm=function(P){var O=P._invmp(this.m);return O.negative!==0?(O.negative=0,this.imod(O).redNeg()):this.imod(O)},j.prototype.pow=function(P,O){if(O.isZero())return new b(1).toRed(this);if(O.cmpn(1)===0)return P.clone();var k=4,q=new Array(1<<k);q[0]=new b(1).toRed(this),q[1]=P;for(var F=2;F<q.length;F++)q[F]=this.mul(q[F-1],P);var H=q[0],D=0,G=0,W=O.bitLength()%26;for(W===0&&(W=26),F=O.length-1;F>=0;F--){for(var K=O.words[F],Z=W-1;Z>=0;Z--){var ae=K>>Z&1;if(H!==q[0]&&(H=this.sqr(H)),ae===0&&D===0){G=0;continue}D<<=1,D|=ae,G++,!(G!==k&&(F!==0||Z!==0))&&(H=this.mul(H,q[D]),G=0,D=0)}W=26}return H},j.prototype.convertTo=function(P){var O=P.umod(this.m);return O===P?O.clone():O},j.prototype.convertFrom=function(P){var O=P.clone();return O.red=null,O},b.mont=function(P){return new M(P)};function M(N){j.call(this,N),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new b(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}v(M,j),M.prototype.convertTo=function(P){return this.imod(P.ushln(this.shift))},M.prototype.convertFrom=function(P){var O=this.imod(P.mul(this.rinv));return O.red=null,O},M.prototype.imul=function(P,O){if(P.isZero()||O.isZero())return P.words[0]=0,P.length=1,P;var k=P.imul(O),q=k.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),F=k.isub(q).iushrn(this.shift),H=F;return F.cmp(this.m)>=0?H=F.isub(this.m):F.cmpn(0)<0&&(H=F.iadd(this.m)),H._forceRed(this)},M.prototype.mul=function(P,O){if(P.isZero()||O.isZero())return new b(0)._forceRed(this);var k=P.mul(O),q=k.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),F=k.isub(q).iushrn(this.shift),H=F;return F.cmp(this.m)>=0?H=F.isub(this.m):F.cmpn(0)<0&&(H=F.iadd(this.m)),H._forceRed(this)},M.prototype.invm=function(P){var O=this.imod(P._invmp(this.m).mul(this.r2));return O._forceRed(this)}})(g,bn$2)})(bn$3)),bn$3.exports}var bnExports=requireBn$1();const BN=getDefaultExportFromCjs(bnExports);var safeBuffer$1={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var hasRequiredSafeBuffer$1;function requireSafeBuffer$1(){return hasRequiredSafeBuffer$1||(hasRequiredSafeBuffer$1=1,(function(g,u){var h=requireDist$1(),y=h.Buffer;function v(w,E){for(var _ in w)E[_]=w[_]}y.from&&y.alloc&&y.allocUnsafe&&y.allocUnsafeSlow?g.exports=h:(v(h,u),u.Buffer=b);function b(w,E,_){return y(w,E,_)}b.prototype=Object.create(y.prototype),v(y,b),b.from=function(w,E,_){if(typeof w=="number")throw new TypeError("Argument must not be a number");return y(w,E,_)},b.alloc=function(w,E,_){if(typeof w!="number")throw new TypeError("Argument must be a number");var S=y(w);return E!==void 0?typeof _=="string"?S.fill(E,_):S.fill(E):S.fill(0),S},b.allocUnsafe=function(w){if(typeof w!="number")throw new TypeError("Argument must be a number");return y(w)},b.allocUnsafeSlow=function(w){if(typeof w!="number")throw new TypeError("Argument must be a number");return h.SlowBuffer(w)}})(safeBuffer$1,safeBuffer$1.exports)),safeBuffer$1.exports}var src$2,hasRequiredSrc$1;function requireSrc$1(){if(hasRequiredSrc$1)return src$2;hasRequiredSrc$1=1;var g=requireSafeBuffer$1().Buffer;function u(h){if(h.length>=255)throw new TypeError("Alphabet too long");for(var y=new Uint8Array(256),v=0;v<y.length;v++)y[v]=255;for(var b=0;b<h.length;b++){var w=h.charAt(b),E=w.charCodeAt(0);if(y[E]!==255)throw new TypeError(w+" is ambiguous");y[E]=b}var _=h.length,S=h.charAt(0),A=Math.log(_)/Math.log(256),R=Math.log(256)/Math.log(_);function x(I){if((Array.isArray(I)||I instanceof Uint8Array)&&(I=g.from(I)),!g.isBuffer(I))throw new TypeError("Expected Buffer");if(I.length===0)return"";for(var L=0,$=0,B=0,U=I.length;B!==U&&I[B]===0;)B++,L++;for(var z=(U-B)*R+1>>>0,ne=new Uint8Array(z);B!==U;){for(var ue=I[B],he=0,Y=z-1;(ue!==0||he<$)&&Y!==-1;Y--,he++)ue+=256*ne[Y]>>>0,ne[Y]=ue%_>>>0,ue=ue/_>>>0;if(ue!==0)throw new Error("Non-zero carry");$=he,B++}for(var X=z-$;X!==z&&ne[X]===0;)X++;for(var J=S.repeat(L);X<z;++X)J+=h.charAt(ne[X]);return J}function T(I){if(typeof I!="string")throw new TypeError("Expected String");if(I.length===0)return g.alloc(0);for(var L=0,$=0,B=0;I[L]===S;)$++,L++;for(var U=(I.length-L)*A+1>>>0,z=new Uint8Array(U);L<I.length;){var ne=I.charCodeAt(L);if(ne>255)return;var ue=y[ne];if(ue===255)return;for(var he=0,Y=U-1;(ue!==0||he<B)&&Y!==-1;Y--,he++)ue+=_*z[Y]>>>0,z[Y]=ue%256>>>0,ue=ue/256>>>0;if(ue!==0)throw new Error("Non-zero carry");B=he,L++}for(var X=U-B;X!==U&&z[X]===0;)X++;var J=g.allocUnsafe($+(U-X));J.fill(0,0,$);for(var j=$;X!==U;)J[j++]=z[X++];return J}function C(I){var L=T(I);if(L)return L;throw new Error("Non-base"+_+" character")}return{encode:x,decodeUnsafe:T,decode:C}}return src$2=u,src$2}var bs58$3,hasRequiredBs58$1;function requireBs58$1(){if(hasRequiredBs58$1)return bs58$3;hasRequiredBs58$1=1;var g=requireSrc$1(),u="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";return bs58$3=g(u),bs58$3}var bs58Exports$1=requireBs58$1();const bs58$2=getDefaultExportFromCjs(bs58Exports$1),sha256$4=sha256$5;var lib={};function inRange(g,u,h){return u<=g&&g<=h}function ToDictionary(g){if(g===void 0)return{};if(g===Object(g))return g;throw TypeError("Could not convert argument to dictionary")}function stringToCodePoints(g){for(var u=String(g),h=u.length,y=0,v=[];y<h;){var b=u.charCodeAt(y);if(b<55296||b>57343)v.push(b);else if(56320<=b&&b<=57343)v.push(65533);else if(55296<=b&&b<=56319)if(y===h-1)v.push(65533);else{var w=g.charCodeAt(y+1);if(56320<=w&&w<=57343){var E=b&1023,_=w&1023;v.push(65536+(E<<10)+_),y+=1}else v.push(65533)}y+=1}return v}function codePointsToString(g){for(var u="",h=0;h<g.length;++h){var y=g[h];y<=65535?u+=String.fromCharCode(y):(y-=65536,u+=String.fromCharCode((y>>10)+55296,(y&1023)+56320))}return u}var end_of_stream=-1;function Stream(g){this.tokens=[].slice.call(g)}Stream.prototype={endOfStream:function(){return!this.tokens.length},read:function(){return this.tokens.length?this.tokens.shift():end_of_stream},prepend:function(g){if(Array.isArray(g))for(var u=g;u.length;)this.tokens.unshift(u.pop());else this.tokens.unshift(g)},push:function(g){if(Array.isArray(g))for(var u=g;u.length;)this.tokens.push(u.shift());else this.tokens.push(g)}};var finished=-1;function decoderError(g,u){if(g)throw TypeError("Decoder error");return u||65533}var DEFAULT_ENCODING="utf-8";function TextDecoder$1(g,u){if(!(this instanceof TextDecoder$1))return new TextDecoder$1(g,u);if(g=g!==void 0?String(g).toLowerCase():DEFAULT_ENCODING,g!==DEFAULT_ENCODING)throw new Error("Encoding not supported. Only utf-8 is supported");u=ToDictionary(u),this._streaming=!1,this._BOMseen=!1,this._decoder=null,this._fatal=!!u.fatal,this._ignoreBOM=!!u.ignoreBOM,Object.defineProperty(this,"encoding",{value:"utf-8"}),Object.defineProperty(this,"fatal",{value:this._fatal}),Object.defineProperty(this,"ignoreBOM",{value:this._ignoreBOM})}TextDecoder$1.prototype={decode:function(u,h){var y;typeof u=="object"&&u instanceof ArrayBuffer?y=new Uint8Array(u):typeof u=="object"&&"buffer"in u&&u.buffer instanceof ArrayBuffer?y=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):y=new Uint8Array(0),h=ToDictionary(h),this._streaming||(this._decoder=new UTF8Decoder({fatal:this._fatal}),this._BOMseen=!1),this._streaming=!!h.stream;for(var v=new Stream(y),b=[],w;!v.endOfStream()&&(w=this._decoder.handler(v,v.read()),w!==finished);)w!==null&&(Array.isArray(w)?b.push.apply(b,w):b.push(w));if(!this._streaming){do{if(w=this._decoder.handler(v,v.read()),w===finished)break;w!==null&&(Array.isArray(w)?b.push.apply(b,w):b.push(w))}while(!v.endOfStream());this._decoder=null}return b.length&&["utf-8"].indexOf(this.encoding)!==-1&&!this._ignoreBOM&&!this._BOMseen&&(b[0]===65279?(this._BOMseen=!0,b.shift()):this._BOMseen=!0),codePointsToString(b)}};function TextEncoder$1(g,u){if(!(this instanceof TextEncoder$1))return new TextEncoder$1(g,u);if(g=g!==void 0?String(g).toLowerCase():DEFAULT_ENCODING,g!==DEFAULT_ENCODING)throw new Error("Encoding not supported. Only utf-8 is supported");u=ToDictionary(u),this._streaming=!1,this._encoder=null,this._options={fatal:!!u.fatal},Object.defineProperty(this,"encoding",{value:"utf-8"})}TextEncoder$1.prototype={encode:function(u,h){u=u?String(u):"",h=ToDictionary(h),this._streaming||(this._encoder=new UTF8Encoder(this._options)),this._streaming=!!h.stream;for(var y=[],v=new Stream(stringToCodePoints(u)),b;!v.endOfStream()&&(b=this._encoder.handler(v,v.read()),b!==finished);)Array.isArray(b)?y.push.apply(y,b):y.push(b);if(!this._streaming){for(;b=this._encoder.handler(v,v.read()),b!==finished;)Array.isArray(b)?y.push.apply(y,b):y.push(b);this._encoder=null}return new Uint8Array(y)}};function UTF8Decoder(g){var u=g.fatal,h=0,y=0,v=0,b=128,w=191;this.handler=function(E,_){if(_===end_of_stream&&v!==0)return v=0,decoderError(u);if(_===end_of_stream)return finished;if(v===0){if(inRange(_,0,127))return _;if(inRange(_,194,223))v=1,h=_-192;else if(inRange(_,224,239))_===224&&(b=160),_===237&&(w=159),v=2,h=_-224;else if(inRange(_,240,244))_===240&&(b=144),_===244&&(w=143),v=3,h=_-240;else return decoderError(u);return h=h<<6*v,null}if(!inRange(_,b,w))return h=v=y=0,b=128,w=191,E.prepend(_),decoderError(u);if(b=128,w=191,y+=1,h+=_-128<<6*(v-y),y!==v)return null;var S=h;return h=v=y=0,S}}function UTF8Encoder(g){g.fatal,this.handler=function(u,h){if(h===end_of_stream)return finished;if(inRange(h,0,127))return h;var y,v;inRange(h,128,2047)?(y=1,v=192):inRange(h,2048,65535)?(y=2,v=224):inRange(h,65536,1114111)&&(y=3,v=240);for(var b=[(h>>6*y)+v];y>0;){var w=h>>6*(y-1);b.push(128|w&63),y-=1}return b}}const encoding=Object.freeze(Object.defineProperty({__proto__:null,TextDecoder:TextDecoder$1,TextEncoder:TextEncoder$1},Symbol.toStringTag,{value:"Module"})),require$$2$1=getAugmentedNamespace(encoding);var hasRequiredLib;function requireLib(){if(hasRequiredLib)return lib;hasRequiredLib=1;var g=lib&&lib.__createBinding||(Object.create?(function(X,J,j,M){M===void 0&&(M=j),Object.defineProperty(X,M,{enumerable:!0,get:function(){return J[j]}})}):(function(X,J,j,M){M===void 0&&(M=j),X[M]=J[j]})),u=lib&&lib.__setModuleDefault||(Object.create?(function(X,J){Object.defineProperty(X,"default",{enumerable:!0,value:J})}):function(X,J){X.default=J}),h=lib&&lib.__decorate||function(X,J,j,M){var N=arguments.length,P=N<3?J:M===null?M=Object.getOwnPropertyDescriptor(J,j):M,O;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")P=Reflect.decorate(X,J,j,M);else for(var k=X.length-1;k>=0;k--)(O=X[k])&&(P=(N<3?O(P):N>3?O(J,j,P):O(J,j))||P);return N>3&&P&&Object.defineProperty(J,j,P),P},y=lib&&lib.__importStar||function(X){if(X&&X.__esModule)return X;var J={};if(X!=null)for(var j in X)j!=="default"&&Object.hasOwnProperty.call(X,j)&&g(J,X,j);return u(J,X),J},v=lib&&lib.__importDefault||function(X){return X&&X.__esModule?X:{default:X}};Object.defineProperty(lib,"__esModule",{value:!0}),lib.deserializeUnchecked=lib.deserialize=lib.serialize=lib.BinaryReader=lib.BinaryWriter=lib.BorshError=lib.baseDecode=lib.baseEncode=void 0;const b=v(requireBn$1()),w=v(requireBs58$1()),E=y(require$$2$1),_=typeof TextDecoder!="function"?E.TextDecoder:TextDecoder,S=new _("utf-8",{fatal:!0});function A(X){return typeof X=="string"&&(X=Buffer.from(X,"utf8")),w.default.encode(Buffer.from(X))}lib.baseEncode=A;function R(X){return Buffer.from(w.default.decode(X))}lib.baseDecode=R;const x=1024;class T extends Error{constructor(J){super(J),this.fieldPath=[],this.originalMessage=J}addToFieldPath(J){this.fieldPath.splice(0,0,J),this.message=this.originalMessage+": "+this.fieldPath.join(".")}}lib.BorshError=T;class C{constructor(){this.buf=Buffer.alloc(x),this.length=0}maybeResize(){this.buf.length<16+this.length&&(this.buf=Buffer.concat([this.buf,Buffer.alloc(x)]))}writeU8(J){this.maybeResize(),this.buf.writeUInt8(J,this.length),this.length+=1}writeU16(J){this.maybeResize(),this.buf.writeUInt16LE(J,this.length),this.length+=2}writeU32(J){this.maybeResize(),this.buf.writeUInt32LE(J,this.length),this.length+=4}writeU64(J){this.maybeResize(),this.writeBuffer(Buffer.from(new b.default(J).toArray("le",8)))}writeU128(J){this.maybeResize(),this.writeBuffer(Buffer.from(new b.default(J).toArray("le",16)))}writeU256(J){this.maybeResize(),this.writeBuffer(Buffer.from(new b.default(J).toArray("le",32)))}writeU512(J){this.maybeResize(),this.writeBuffer(Buffer.from(new b.default(J).toArray("le",64)))}writeBuffer(J){this.buf=Buffer.concat([Buffer.from(this.buf.subarray(0,this.length)),J,Buffer.alloc(x)]),this.length+=J.length}writeString(J){this.maybeResize();const j=Buffer.from(J,"utf8");this.writeU32(j.length),this.writeBuffer(j)}writeFixedArray(J){this.writeBuffer(Buffer.from(J))}writeArray(J,j){this.maybeResize(),this.writeU32(J.length);for(const M of J)this.maybeResize(),j(M)}toArray(){return this.buf.subarray(0,this.length)}}lib.BinaryWriter=C;function I(X,J,j){const M=j.value;j.value=function(...N){try{return M.apply(this,N)}catch(P){if(P instanceof RangeError){const O=P.code;if(["ERR_BUFFER_OUT_OF_BOUNDS","ERR_OUT_OF_RANGE"].indexOf(O)>=0)throw new T("Reached the end of buffer when deserializing")}throw P}}}class L{constructor(J){this.buf=J,this.offset=0}readU8(){const J=this.buf.readUInt8(this.offset);return this.offset+=1,J}readU16(){const J=this.buf.readUInt16LE(this.offset);return this.offset+=2,J}readU32(){const J=this.buf.readUInt32LE(this.offset);return this.offset+=4,J}readU64(){const J=this.readBuffer(8);return new b.default(J,"le")}readU128(){const J=this.readBuffer(16);return new b.default(J,"le")}readU256(){const J=this.readBuffer(32);return new b.default(J,"le")}readU512(){const J=this.readBuffer(64);return new b.default(J,"le")}readBuffer(J){if(this.offset+J>this.buf.length)throw new T(`Expected buffer length ${J} isn't within bounds`);const j=this.buf.slice(this.offset,this.offset+J);return this.offset+=J,j}readString(){const J=this.readU32(),j=this.readBuffer(J);try{return S.decode(j)}catch(M){throw new T(`Error decoding UTF-8 string: ${M}`)}}readFixedArray(J){return new Uint8Array(this.readBuffer(J))}readArray(J){const j=this.readU32(),M=Array();for(let N=0;N<j;++N)M.push(J());return M}}h([I],L.prototype,"readU8",null),h([I],L.prototype,"readU16",null),h([I],L.prototype,"readU32",null),h([I],L.prototype,"readU64",null),h([I],L.prototype,"readU128",null),h([I],L.prototype,"readU256",null),h([I],L.prototype,"readU512",null),h([I],L.prototype,"readString",null),h([I],L.prototype,"readFixedArray",null),h([I],L.prototype,"readArray",null),lib.BinaryReader=L;function $(X){return X.charAt(0).toUpperCase()+X.slice(1)}function B(X,J,j,M,N){try{if(typeof M=="string")N[`write${$(M)}`](j);else if(M instanceof Array)if(typeof M[0]=="number"){if(j.length!==M[0])throw new T(`Expecting byte array of length ${M[0]}, but got ${j.length} bytes`);N.writeFixedArray(j)}else if(M.length===2&&typeof M[1]=="number"){if(j.length!==M[1])throw new T(`Expecting byte array of length ${M[1]}, but got ${j.length} bytes`);for(let P=0;P<M[1];P++)B(X,null,j[P],M[0],N)}else N.writeArray(j,P=>{B(X,J,P,M[0],N)});else if(M.kind!==void 0)switch(M.kind){case"option":{j==null?N.writeU8(0):(N.writeU8(1),B(X,J,j,M.type,N));break}case"map":{N.writeU32(j.size),j.forEach((P,O)=>{B(X,J,O,M.key,N),B(X,J,P,M.value,N)});break}default:throw new T(`FieldType ${M} unrecognized`)}else U(X,j,N)}catch(P){throw P instanceof T&&P.addToFieldPath(J),P}}function U(X,J,j){if(typeof J.borshSerialize=="function"){J.borshSerialize(j);return}const M=X.get(J.constructor);if(!M)throw new T(`Class ${J.constructor.name} is missing in schema`);if(M.kind==="struct")M.fields.map(([N,P])=>{B(X,N,J[N],P,j)});else if(M.kind==="enum"){const N=J[M.field];for(let P=0;P<M.values.length;++P){const[O,k]=M.values[P];if(O===N){j.writeU8(P),B(X,O,J[O],k,j);break}}}else throw new T(`Unexpected schema kind: ${M.kind} for ${J.constructor.name}`)}function z(X,J,j=C){const M=new j;return U(X,J,M),M.toArray()}lib.serialize=z;function ne(X,J,j,M){try{if(typeof j=="string")return M[`read${$(j)}`]();if(j instanceof Array){if(typeof j[0]=="number")return M.readFixedArray(j[0]);if(typeof j[1]=="number"){const N=[];for(let P=0;P<j[1];P++)N.push(ne(X,null,j[0],M));return N}else return M.readArray(()=>ne(X,J,j[0],M))}if(j.kind==="option")return M.readU8()?ne(X,J,j.type,M):void 0;if(j.kind==="map"){let N=new Map;const P=M.readU32();for(let O=0;O<P;O++){const k=ne(X,J,j.key,M),q=ne(X,J,j.value,M);N.set(k,q)}return N}return ue(X,j,M)}catch(N){throw N instanceof T&&N.addToFieldPath(J),N}}function ue(X,J,j){if(typeof J.borshDeserialize=="function")return J.borshDeserialize(j);const M=X.get(J);if(!M)throw new T(`Class ${J.name} is missing in schema`);if(M.kind==="struct"){const N={};for(const[P,O]of X.get(J).fields)N[P]=ne(X,P,O,j);return new J(N)}if(M.kind==="enum"){const N=j.readU8();if(N>=M.values.length)throw new T(`Enum index: ${N} is out of range`);const[P,O]=M.values[N],k=ne(X,P,O,j);return new J({[P]:k})}throw new T(`Unexpected schema kind: ${M.kind} for ${J.constructor.name}`)}function he(X,J,j,M=L){const N=new M(j),P=ue(X,J,N);if(N.offset<j.length)throw new T(`Unexpected ${j.length-N.offset} bytes after deserialized data`);return P}lib.deserialize=he;function Y(X,J,j,M=L){const N=new M(j);return ue(X,J,N)}return lib.deserializeUnchecked=Y,lib}var libExports=requireLib(),Layout={},hasRequiredLayout;function requireLayout(){if(hasRequiredLayout)return Layout;hasRequiredLayout=1,Object.defineProperty(Layout,"__esModule",{value:!0}),Layout.s16=Layout.s8=Layout.nu64be=Layout.u48be=Layout.u40be=Layout.u32be=Layout.u24be=Layout.u16be=Layout.nu64=Layout.u48=Layout.u40=Layout.u32=Layout.u24=Layout.u16=Layout.u8=Layout.offset=Layout.greedy=Layout.Constant=Layout.UTF8=Layout.CString=Layout.Blob=Layout.Boolean=Layout.BitField=Layout.BitStructure=Layout.VariantLayout=Layout.Union=Layout.UnionLayoutDiscriminator=Layout.UnionDiscriminator=Layout.Structure=Layout.Sequence=Layout.DoubleBE=Layout.Double=Layout.FloatBE=Layout.Float=Layout.NearInt64BE=Layout.NearInt64=Layout.NearUInt64BE=Layout.NearUInt64=Layout.IntBE=Layout.Int=Layout.UIntBE=Layout.UInt=Layout.OffsetLayout=Layout.GreedyCount=Layout.ExternalLayout=Layout.bindConstructorLayout=Layout.nameWithProperty=Layout.Layout=Layout.uint8ArrayToBuffer=Layout.checkUint8Array=void 0,Layout.constant=Layout.utf8=Layout.cstr=Layout.blob=Layout.unionLayoutDiscriminator=Layout.union=Layout.seq=Layout.bits=Layout.struct=Layout.f64be=Layout.f64=Layout.f32be=Layout.f32=Layout.ns64be=Layout.s48be=Layout.s40be=Layout.s32be=Layout.s24be=Layout.s16be=Layout.ns64=Layout.s48=Layout.s40=Layout.s32=Layout.s24=void 0;const g=requireDist$1();function u(W){if(!(W instanceof Uint8Array))throw new TypeError("b must be a Uint8Array")}Layout.checkUint8Array=u;function h(W){return u(W),g.Buffer.from(W.buffer,W.byteOffset,W.length)}Layout.uint8ArrayToBuffer=h;let y=class{constructor(K,Z){if(!Number.isInteger(K))throw new TypeError("span must be an integer");this.span=K,this.property=Z}makeDestinationObject(){return{}}getSpan(K,Z){if(0>this.span)throw new RangeError("indeterminate span");return this.span}replicate(K){const Z=Object.create(this.constructor.prototype);return Object.assign(Z,this),Z.property=K,Z}fromArray(K){}};Layout.Layout=y;function v(W,K){return K.property?W+"["+K.property+"]":W}Layout.nameWithProperty=v;function b(W,K){if(typeof W!="function")throw new TypeError("Class must be constructor");if(Object.prototype.hasOwnProperty.call(W,"layout_"))throw new Error("Class is already bound to a layout");if(!(K&&K instanceof y))throw new TypeError("layout must be a Layout");if(Object.prototype.hasOwnProperty.call(K,"boundConstructor_"))throw new Error("layout is already bound to a constructor");W.layout_=K,K.boundConstructor_=W,K.makeDestinationObject=(()=>new W),Object.defineProperty(W.prototype,"encode",{value(Z,ae){return K.encode(this,Z,ae)},writable:!0}),Object.defineProperty(W,"decode",{value(Z,ae){return K.decode(Z,ae)},writable:!0})}Layout.bindConstructorLayout=b;class w extends y{isCount(){throw new Error("ExternalLayout is abstract")}}Layout.ExternalLayout=w;class E extends w{constructor(K=1,Z){if(!Number.isInteger(K)||0>=K)throw new TypeError("elementSpan must be a (positive) integer");super(-1,Z),this.elementSpan=K}isCount(){return!0}decode(K,Z=0){u(K);const ae=K.length-Z;return Math.floor(ae/this.elementSpan)}encode(K,Z,ae){return 0}}Layout.GreedyCount=E;class _ extends w{constructor(K,Z=0,ae){if(!(K instanceof y))throw new TypeError("layout must be a Layout");if(!Number.isInteger(Z))throw new TypeError("offset must be integer or undefined");super(K.span,ae||K.property),this.layout=K,this.offset=Z}isCount(){return this.layout instanceof S||this.layout instanceof A}decode(K,Z=0){return this.layout.decode(K,Z+this.offset)}encode(K,Z,ae=0){return this.layout.encode(K,Z,ae+this.offset)}}Layout.OffsetLayout=_;class S extends y{constructor(K,Z){if(super(K,Z),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(K,Z=0){return h(K).readUIntLE(Z,this.span)}encode(K,Z,ae=0){return h(Z).writeUIntLE(K,ae,this.span),this.span}}Layout.UInt=S;class A extends y{constructor(K,Z){if(super(K,Z),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(K,Z=0){return h(K).readUIntBE(Z,this.span)}encode(K,Z,ae=0){return h(Z).writeUIntBE(K,ae,this.span),this.span}}Layout.UIntBE=A;class R extends y{constructor(K,Z){if(super(K,Z),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(K,Z=0){return h(K).readIntLE(Z,this.span)}encode(K,Z,ae=0){return h(Z).writeIntLE(K,ae,this.span),this.span}}Layout.Int=R;class x extends y{constructor(K,Z){if(super(K,Z),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(K,Z=0){return h(K).readIntBE(Z,this.span)}encode(K,Z,ae=0){return h(Z).writeIntBE(K,ae,this.span),this.span}}Layout.IntBE=x;const T=Math.pow(2,32);function C(W){const K=Math.floor(W/T),Z=W-K*T;return{hi32:K,lo32:Z}}function I(W,K){return W*T+K}class L extends y{constructor(K){super(8,K)}decode(K,Z=0){const ae=h(K),le=ae.readUInt32LE(Z),te=ae.readUInt32LE(Z+4);return I(te,le)}encode(K,Z,ae=0){const le=C(K),te=h(Z);return te.writeUInt32LE(le.lo32,ae),te.writeUInt32LE(le.hi32,ae+4),8}}Layout.NearUInt64=L;class $ extends y{constructor(K){super(8,K)}decode(K,Z=0){const ae=h(K),le=ae.readUInt32BE(Z),te=ae.readUInt32BE(Z+4);return I(le,te)}encode(K,Z,ae=0){const le=C(K),te=h(Z);return te.writeUInt32BE(le.hi32,ae),te.writeUInt32BE(le.lo32,ae+4),8}}Layout.NearUInt64BE=$;class B extends y{constructor(K){super(8,K)}decode(K,Z=0){const ae=h(K),le=ae.readUInt32LE(Z),te=ae.readInt32LE(Z+4);return I(te,le)}encode(K,Z,ae=0){const le=C(K),te=h(Z);return te.writeUInt32LE(le.lo32,ae),te.writeInt32LE(le.hi32,ae+4),8}}Layout.NearInt64=B;class U extends y{constructor(K){super(8,K)}decode(K,Z=0){const ae=h(K),le=ae.readInt32BE(Z),te=ae.readUInt32BE(Z+4);return I(le,te)}encode(K,Z,ae=0){const le=C(K),te=h(Z);return te.writeInt32BE(le.hi32,ae),te.writeUInt32BE(le.lo32,ae+4),8}}Layout.NearInt64BE=U;class z extends y{constructor(K){super(4,K)}decode(K,Z=0){return h(K).readFloatLE(Z)}encode(K,Z,ae=0){return h(Z).writeFloatLE(K,ae),4}}Layout.Float=z;class ne extends y{constructor(K){super(4,K)}decode(K,Z=0){return h(K).readFloatBE(Z)}encode(K,Z,ae=0){return h(Z).writeFloatBE(K,ae),4}}Layout.FloatBE=ne;class ue extends y{constructor(K){super(8,K)}decode(K,Z=0){return h(K).readDoubleLE(Z)}encode(K,Z,ae=0){return h(Z).writeDoubleLE(K,ae),8}}Layout.Double=ue;class he extends y{constructor(K){super(8,K)}decode(K,Z=0){return h(K).readDoubleBE(Z)}encode(K,Z,ae=0){return h(Z).writeDoubleBE(K,ae),8}}Layout.DoubleBE=he;class Y extends y{constructor(K,Z,ae){if(!(K instanceof y))throw new TypeError("elementLayout must be a Layout");if(!(Z instanceof w&&Z.isCount()||Number.isInteger(Z)&&0<=Z))throw new TypeError("count must be non-negative integer or an unsigned integer ExternalLayout");let le=-1;!(Z instanceof w)&&0<K.span&&(le=Z*K.span),super(le,ae),this.elementLayout=K,this.count=Z}getSpan(K,Z=0){if(0<=this.span)return this.span;let ae=0,le=this.count;if(le instanceof w&&(le=le.decode(K,Z)),0<this.elementLayout.span)ae=le*this.elementLayout.span;else{let te=0;for(;te<le;)ae+=this.elementLayout.getSpan(K,Z+ae),++te}return ae}decode(K,Z=0){const ae=[];let le=0,te=this.count;for(te instanceof w&&(te=te.decode(K,Z));le<te;)ae.push(this.elementLayout.decode(K,Z)),Z+=this.elementLayout.getSpan(K,Z),le+=1;return ae}encode(K,Z,ae=0){const le=this.elementLayout,te=K.reduce((ce,ge)=>ce+le.encode(ge,Z,ae+ce),0);return this.count instanceof w&&this.count.encode(K.length,Z,ae),te}}Layout.Sequence=Y;class X extends y{constructor(K,Z,ae){if(!(Array.isArray(K)&&K.reduce((te,ce)=>te&&ce instanceof y,!0)))throw new TypeError("fields must be array of Layout instances");typeof Z=="boolean"&&ae===void 0&&(ae=Z,Z=void 0);for(const te of K)if(0>te.span&&te.property===void 0)throw new Error("fields cannot contain unnamed variable-length layout");let le=-1;try{le=K.reduce((te,ce)=>te+ce.getSpan(),0)}catch{}super(le,Z),this.fields=K,this.decodePrefixes=!!ae}getSpan(K,Z=0){if(0<=this.span)return this.span;let ae=0;try{ae=this.fields.reduce((le,te)=>{const ce=te.getSpan(K,Z);return Z+=ce,le+ce},0)}catch{throw new RangeError("indeterminate span")}return ae}decode(K,Z=0){u(K);const ae=this.makeDestinationObject();for(const le of this.fields)if(le.property!==void 0&&(ae[le.property]=le.decode(K,Z)),Z+=le.getSpan(K,Z),this.decodePrefixes&&K.length===Z)break;return ae}encode(K,Z,ae=0){const le=ae;let te=0,ce=0;for(const ge of this.fields){let Ee=ge.span;if(ce=0<Ee?Ee:0,ge.property!==void 0){const pe=K[ge.property];pe!==void 0&&(ce=ge.encode(pe,Z,ae),0>Ee&&(Ee=ge.getSpan(Z,ae)))}te=ae,ae+=Ee}return te+ce-le}fromArray(K){const Z=this.makeDestinationObject();for(const ae of this.fields)ae.property!==void 0&&0<K.length&&(Z[ae.property]=K.shift());return Z}layoutFor(K){if(typeof K!="string")throw new TypeError("property must be string");for(const Z of this.fields)if(Z.property===K)return Z}offsetOf(K){if(typeof K!="string")throw new TypeError("property must be string");let Z=0;for(const ae of this.fields){if(ae.property===K)return Z;0>ae.span?Z=-1:0<=Z&&(Z+=ae.span)}}}Layout.Structure=X;class J{constructor(K){this.property=K}decode(K,Z){throw new Error("UnionDiscriminator is abstract")}encode(K,Z,ae){throw new Error("UnionDiscriminator is abstract")}}Layout.UnionDiscriminator=J;class j extends J{constructor(K,Z){if(!(K instanceof w&&K.isCount()))throw new TypeError("layout must be an unsigned integer ExternalLayout");super(Z||K.property||"variant"),this.layout=K}decode(K,Z){return this.layout.decode(K,Z)}encode(K,Z,ae){return this.layout.encode(K,Z,ae)}}Layout.UnionLayoutDiscriminator=j;class M extends y{constructor(K,Z,ae){let le;if(K instanceof S||K instanceof A)le=new j(new _(K));else if(K instanceof w&&K.isCount())le=new j(K);else if(K instanceof J)le=K;else throw new TypeError("discr must be a UnionDiscriminator or an unsigned integer layout");if(Z===void 0&&(Z=null),!(Z===null||Z instanceof y))throw new TypeError("defaultLayout must be null or a Layout");if(Z!==null){if(0>Z.span)throw new Error("defaultLayout must have constant span");Z.property===void 0&&(Z=Z.replicate("content"))}let te=-1;Z&&(te=Z.span,0<=te&&(K instanceof S||K instanceof A)&&(te+=le.layout.span)),super(te,ae),this.discriminator=le,this.usesPrefixDiscriminator=K instanceof S||K instanceof A,this.defaultLayout=Z,this.registry={};let ce=this.defaultGetSourceVariant.bind(this);this.getSourceVariant=function(ge){return ce(ge)},this.configGetSourceVariant=function(ge){ce=ge.bind(this)}}getSpan(K,Z=0){if(0<=this.span)return this.span;const ae=this.getVariant(K,Z);if(!ae)throw new Error("unable to determine span for unrecognized variant");return ae.getSpan(K,Z)}defaultGetSourceVariant(K){if(Object.prototype.hasOwnProperty.call(K,this.discriminator.property)){if(this.defaultLayout&&this.defaultLayout.property&&Object.prototype.hasOwnProperty.call(K,this.defaultLayout.property))return;const Z=this.registry[K[this.discriminator.property]];if(Z&&(!Z.layout||Z.property&&Object.prototype.hasOwnProperty.call(K,Z.property)))return Z}else for(const Z in this.registry){const ae=this.registry[Z];if(ae.property&&Object.prototype.hasOwnProperty.call(K,ae.property))return ae}throw new Error("unable to infer src variant")}decode(K,Z=0){let ae;const le=this.discriminator,te=le.decode(K,Z),ce=this.registry[te];if(ce===void 0){const ge=this.defaultLayout;let Ee=0;this.usesPrefixDiscriminator&&(Ee=le.layout.span),ae=this.makeDestinationObject(),ae[le.property]=te,ae[ge.property]=ge.decode(K,Z+Ee)}else ae=ce.decode(K,Z);return ae}encode(K,Z,ae=0){const le=this.getSourceVariant(K);if(le===void 0){const te=this.discriminator,ce=this.defaultLayout;let ge=0;return this.usesPrefixDiscriminator&&(ge=te.layout.span),te.encode(K[te.property],Z,ae),ge+ce.encode(K[ce.property],Z,ae+ge)}return le.encode(K,Z,ae)}addVariant(K,Z,ae){const le=new N(this,K,Z,ae);return this.registry[K]=le,le}getVariant(K,Z=0){let ae;return K instanceof Uint8Array?ae=this.discriminator.decode(K,Z):ae=K,this.registry[ae]}}Layout.Union=M;class N extends y{constructor(K,Z,ae,le){if(!(K instanceof M))throw new TypeError("union must be a Union");if(!Number.isInteger(Z)||0>Z)throw new TypeError("variant must be a (non-negative) integer");if(typeof ae=="string"&&le===void 0&&(le=ae,ae=null),ae){if(!(ae instanceof y))throw new TypeError("layout must be a Layout");if(K.defaultLayout!==null&&0<=ae.span&&ae.span>K.defaultLayout.span)throw new Error("variant span exceeds span of containing union");if(typeof le!="string")throw new TypeError("variant must have a String property")}let te=K.span;0>K.span&&(te=ae?ae.span:0,0<=te&&K.usesPrefixDiscriminator&&(te+=K.discriminator.layout.span)),super(te,le),this.union=K,this.variant=Z,this.layout=ae||null}getSpan(K,Z=0){if(0<=this.span)return this.span;let ae=0;this.union.usesPrefixDiscriminator&&(ae=this.union.discriminator.layout.span);let le=0;return this.layout&&(le=this.layout.getSpan(K,Z+ae)),ae+le}decode(K,Z=0){const ae=this.makeDestinationObject();if(this!==this.union.getVariant(K,Z))throw new Error("variant mismatch");let le=0;return this.union.usesPrefixDiscriminator&&(le=this.union.discriminator.layout.span),this.layout?ae[this.property]=this.layout.decode(K,Z+le):this.property?ae[this.property]=!0:this.union.usesPrefixDiscriminator&&(ae[this.union.discriminator.property]=this.variant),ae}encode(K,Z,ae=0){let le=0;if(this.union.usesPrefixDiscriminator&&(le=this.union.discriminator.layout.span),this.layout&&!Object.prototype.hasOwnProperty.call(K,this.property))throw new TypeError("variant lacks property "+this.property);this.union.discriminator.encode(this.variant,Z,ae);let te=le;if(this.layout&&(this.layout.encode(K[this.property],Z,ae+le),te+=this.layout.getSpan(Z,ae+le),0<=this.union.span&&te>this.union.span))throw new Error("encoded variant overruns containing union");return te}fromArray(K){if(this.layout)return this.layout.fromArray(K)}}Layout.VariantLayout=N;function P(W){return 0>W&&(W+=4294967296),W}class O extends y{constructor(K,Z,ae){if(!(K instanceof S||K instanceof A))throw new TypeError("word must be a UInt or UIntBE layout");if(typeof Z=="string"&&ae===void 0&&(ae=Z,Z=!1),4<K.span)throw new RangeError("word cannot exceed 32 bits");super(K.span,ae),this.word=K,this.msb=!!Z,this.fields=[];let le=0;this._packedSetValue=function(te){return le=P(te),this},this._packedGetValue=function(){return le}}decode(K,Z=0){const ae=this.makeDestinationObject(),le=this.word.decode(K,Z);this._packedSetValue(le);for(const te of this.fields)te.property!==void 0&&(ae[te.property]=te.decode(K));return ae}encode(K,Z,ae=0){const le=this.word.decode(Z,ae);this._packedSetValue(le);for(const te of this.fields)if(te.property!==void 0){const ce=K[te.property];ce!==void 0&&te.encode(ce)}return this.word.encode(this._packedGetValue(),Z,ae)}addField(K,Z){const ae=new k(this,K,Z);return this.fields.push(ae),ae}addBoolean(K){const Z=new q(this,K);return this.fields.push(Z),Z}fieldFor(K){if(typeof K!="string")throw new TypeError("property must be string");for(const Z of this.fields)if(Z.property===K)return Z}}Layout.BitStructure=O;class k{constructor(K,Z,ae){if(!(K instanceof O))throw new TypeError("container must be a BitStructure");if(!Number.isInteger(Z)||0>=Z)throw new TypeError("bits must be positive integer");const le=8*K.span,te=K.fields.reduce((ce,ge)=>ce+ge.bits,0);if(Z+te>le)throw new Error("bits too long for span remainder ("+(le-te)+" of "+le+" remain)");this.container=K,this.bits=Z,this.valueMask=(1<<Z)-1,Z===32&&(this.valueMask=4294967295),this.start=te,this.container.msb&&(this.start=le-te-Z),this.wordMask=P(this.valueMask<<this.start),this.property=ae}decode(K,Z){const ae=this.container._packedGetValue();return P(ae&this.wordMask)>>>this.start}encode(K){if(typeof K!="number"||!Number.isInteger(K)||K!==P(K&this.valueMask))throw new TypeError(v("BitField.encode",this)+" value must be integer not exceeding "+this.valueMask);const Z=this.container._packedGetValue(),ae=P(K<<this.start);this.container._packedSetValue(P(Z&~this.wordMask)|ae)}}Layout.BitField=k;class q extends k{constructor(K,Z){super(K,1,Z)}decode(K,Z){return!!super.decode(K,Z)}encode(K){typeof K=="boolean"&&(K=+K),super.encode(K)}}Layout.Boolean=q;class F extends y{constructor(K,Z){if(!(K instanceof w&&K.isCount()||Number.isInteger(K)&&0<=K))throw new TypeError("length must be positive integer or an unsigned integer ExternalLayout");let ae=-1;K instanceof w||(ae=K),super(ae,Z),this.length=K}getSpan(K,Z){let ae=this.span;return 0>ae&&(ae=this.length.decode(K,Z)),ae}decode(K,Z=0){let ae=this.span;return 0>ae&&(ae=this.length.decode(K,Z)),h(K).slice(Z,Z+ae)}encode(K,Z,ae){let le=this.length;if(this.length instanceof w&&(le=K.length),!(K instanceof Uint8Array&&le===K.length))throw new TypeError(v("Blob.encode",this)+" requires (length "+le+") Uint8Array as src");if(ae+le>Z.length)throw new RangeError("encoding overruns Uint8Array");const te=h(K);return h(Z).write(te.toString("hex"),ae,le,"hex"),this.length instanceof w&&this.length.encode(le,Z,ae),le}}Layout.Blob=F;class H extends y{constructor(K){super(-1,K)}getSpan(K,Z=0){u(K);let ae=Z;for(;ae<K.length&&K[ae]!==0;)ae+=1;return 1+ae-Z}decode(K,Z=0){const ae=this.getSpan(K,Z);return h(K).slice(Z,Z+ae-1).toString("utf-8")}encode(K,Z,ae=0){typeof K!="string"&&(K=String(K));const le=g.Buffer.from(K,"utf8"),te=le.length;if(ae+te>Z.length)throw new RangeError("encoding overruns Buffer");const ce=h(Z);return le.copy(ce,ae),ce[ae+te]=0,te+1}}Layout.CString=H;class D extends y{constructor(K,Z){if(typeof K=="string"&&Z===void 0&&(Z=K,K=void 0),K===void 0)K=-1;else if(!Number.isInteger(K))throw new TypeError("maxSpan must be an integer");super(-1,Z),this.maxSpan=K}getSpan(K,Z=0){return u(K),K.length-Z}decode(K,Z=0){const ae=this.getSpan(K,Z);if(0<=this.maxSpan&&this.maxSpan<ae)throw new RangeError("text length exceeds maxSpan");return h(K).slice(Z,Z+ae).toString("utf-8")}encode(K,Z,ae=0){typeof K!="string"&&(K=String(K));const le=g.Buffer.from(K,"utf8"),te=le.length;if(0<=this.maxSpan&&this.maxSpan<te)throw new RangeError("text length exceeds maxSpan");if(ae+te>Z.length)throw new RangeError("encoding overruns Buffer");return le.copy(h(Z),ae),te}}Layout.UTF8=D;class G extends y{constructor(K,Z){super(0,Z),this.value=K}decode(K,Z){return this.value}encode(K,Z,ae){return 0}}return Layout.Constant=G,Layout.greedy=((W,K)=>new E(W,K)),Layout.offset=((W,K,Z)=>new _(W,K,Z)),Layout.u8=(W=>new S(1,W)),Layout.u16=(W=>new S(2,W)),Layout.u24=(W=>new S(3,W)),Layout.u32=(W=>new S(4,W)),Layout.u40=(W=>new S(5,W)),Layout.u48=(W=>new S(6,W)),Layout.nu64=(W=>new L(W)),Layout.u16be=(W=>new A(2,W)),Layout.u24be=(W=>new A(3,W)),Layout.u32be=(W=>new A(4,W)),Layout.u40be=(W=>new A(5,W)),Layout.u48be=(W=>new A(6,W)),Layout.nu64be=(W=>new $(W)),Layout.s8=(W=>new R(1,W)),Layout.s16=(W=>new R(2,W)),Layout.s24=(W=>new R(3,W)),Layout.s32=(W=>new R(4,W)),Layout.s40=(W=>new R(5,W)),Layout.s48=(W=>new R(6,W)),Layout.ns64=(W=>new B(W)),Layout.s16be=(W=>new x(2,W)),Layout.s24be=(W=>new x(3,W)),Layout.s32be=(W=>new x(4,W)),Layout.s40be=(W=>new x(5,W)),Layout.s48be=(W=>new x(6,W)),Layout.ns64be=(W=>new U(W)),Layout.f32=(W=>new z(W)),Layout.f32be=(W=>new ne(W)),Layout.f64=(W=>new ue(W)),Layout.f64be=(W=>new he(W)),Layout.struct=((W,K,Z)=>new X(W,K,Z)),Layout.bits=((W,K,Z)=>new O(W,K,Z)),Layout.seq=((W,K,Z)=>new Y(W,K,Z)),Layout.union=((W,K,Z)=>new M(W,K,Z)),Layout.unionLayoutDiscriminator=((W,K)=>new j(W,K)),Layout.blob=((W,K)=>new F(W,K)),Layout.cstr=(W=>new H(W)),Layout.utf8=((W,K)=>new D(W,K)),Layout.constant=((W,K)=>new G(W,K)),Layout}var LayoutExports=requireLayout(),SOLANA_ERROR__BLOCK_HEIGHT_EXCEEDED=1,SOLANA_ERROR__LAMPORTS_OUT_OF_RANGE=6,SOLANA_ERROR__MALFORMED_JSON_RPC_ERROR=10,SOLANA_ERROR__JSON_RPC__PARSE_ERROR=-32700,SOLANA_ERROR__JSON_RPC__INTERNAL_ERROR=-32603,SOLANA_ERROR__JSON_RPC__INVALID_PARAMS=-32602,SOLANA_ERROR__JSON_RPC__METHOD_NOT_FOUND=-32601,SOLANA_ERROR__JSON_RPC__INVALID_REQUEST=-32600,SOLANA_ERROR__JSON_RPC__SERVER_ERROR_UNSUPPORTED_TRANSACTION_VERSION=-32015,SOLANA_ERROR__JSON_RPC__SERVER_ERROR_BLOCK_STATUS_NOT_AVAILABLE_YET=-32014,SOLANA_ERROR__JSON_RPC__SCAN_ERROR=-32012,SOLANA_ERROR__JSON_RPC__SERVER_ERROR_KEY_EXCLUDED_FROM_SECONDARY_INDEX=-32010,SOLANA_ERROR__JSON_RPC__SERVER_ERROR_LONG_TERM_STORAGE_SLOT_SKIPPED=-32009,SOLANA_ERROR__JSON_RPC__SERVER_ERROR_SLOT_SKIPPED=-32007,SOLANA_ERROR__JSON_RPC__SERVER_ERROR_TRANSACTION_PRECOMPILE_VERIFICATION_FAILURE=-32006,SOLANA_ERROR__JSON_RPC__SERVER_ERROR_BLOCK_NOT_AVAILABLE=-32004,SOLANA_ERROR__JSON_RPC__SERVER_ERROR_SEND_TRANSACTION_PREFLIGHT_FAILURE=-32002,SOLANA_ERROR__JSON_RPC__SERVER_ERROR_BLOCK_CLEANED_UP=-32001,SOLANA_ERROR__ADDRESSES__INVALID_BYTE_LENGTH=28e5,SOLANA_ERROR__ADDRESSES__STRING_LENGTH_OUT_OF_RANGE=2800001,SOLANA_ERROR__ADDRESSES__INVALID_ED25519_PUBLIC_KEY=2800003,SOLANA_ERROR__ADDRESSES__MAX_NUMBER_OF_PDA_SEEDS_EXCEEDED=2800006,SOLANA_ERROR__ADDRESSES__MAX_PDA_SEED_LENGTH_EXCEEDED=2800007,SOLANA_ERROR__ADDRESSES__INVALID_SEEDS_POINT_ON_CURVE=2800008,SOLANA_ERROR__ADDRESSES__FAILED_TO_FIND_VIABLE_PDA_BUMP_SEED=2800009,SOLANA_ERROR__ACCOUNTS__ACCOUNT_NOT_FOUND=323e4,SOLANA_ERROR__ACCOUNTS__FAILED_TO_DECODE_ACCOUNT=3230002,SOLANA_ERROR__SUBTLE_CRYPTO__DISALLOWED_IN_INSECURE_CONTEXT=361e4,SOLANA_ERROR__SUBTLE_CRYPTO__DIGEST_UNIMPLEMENTED=3610001,SOLANA_ERROR__SUBTLE_CRYPTO__ED25519_ALGORITHM_UNIMPLEMENTED=3610002,SOLANA_ERROR__SUBTLE_CRYPTO__EXPORT_FUNCTION_UNIMPLEMENTED=3610003,SOLANA_ERROR__SUBTLE_CRYPTO__GENERATE_FUNCTION_UNIMPLEMENTED=3610004,SOLANA_ERROR__SUBTLE_CRYPTO__SIGN_FUNCTION_UNIMPLEMENTED=3610005,SOLANA_ERROR__SUBTLE_CRYPTO__VERIFY_FUNCTION_UNIMPLEMENTED=3610006,SOLANA_ERROR__SUBTLE_CRYPTO__CANNOT_EXPORT_NON_EXTRACTABLE_KEY=3610007,SOLANA_ERROR__CRYPTO__RANDOM_VALUES_FUNCTION_UNIMPLEMENTED=3611e3,SOLANA_ERROR__KEYS__INVALID_KEY_PAIR_BYTE_LENGTH=3704e3,SOLANA_ERROR__KEYS__INVALID_PRIVATE_KEY_BYTE_LENGTH=3704001,SOLANA_ERROR__KEYS__PUBLIC_KEY_MUST_MATCH_PRIVATE_KEY=3704004,SOLANA_ERROR__INSTRUCTION_ERROR__UNKNOWN=4615e3,SOLANA_ERROR__INSTRUCTION_ERROR__CUSTOM=4615026,SOLANA_ERROR__INSTRUCTION_ERROR__BORSH_IO_ERROR=4615045,SOLANA_ERROR__SIGNER__ADDRESS_CANNOT_HAVE_MULTIPLE_SIGNERS=5508e3,SOLANA_ERROR__SIGNER__TRANSACTION_CANNOT_HAVE_MULTIPLE_SENDING_SIGNERS=5508009,SOLANA_ERROR__SIGNER__TRANSACTION_SENDING_SIGNER_MISSING=5508010,SOLANA_ERROR__TRANSACTION__INVOKED_PROGRAMS_CANNOT_PAY_FEES=5663e3,SOLANA_ERROR__TRANSACTION__INVOKED_PROGRAMS_MUST_NOT_BE_WRITABLE=5663001,SOLANA_ERROR__TRANSACTION__VERSION_NUMBER_OUT_OF_RANGE=5663004,SOLANA_ERROR__TRANSACTION__SIGNATURES_MISSING=5663009,SOLANA_ERROR__TRANSACTION__FEE_PAYER_SIGNATURE_MISSING=5663012,SOLANA_ERROR__TRANSACTION__ADDRESSES_CANNOT_SIGN_TRANSACTION=5663015,SOLANA_ERROR__TRANSACTION__CANNOT_ENCODE_WITH_EMPTY_SIGNATURES=5663016,SOLANA_ERROR__TRANSACTION_ERROR__UNKNOWN=705e4,SOLANA_ERROR__TRANSACTION_ERROR__ALREADY_PROCESSED=7050007,SOLANA_ERROR__TRANSACTION_ERROR__DUPLICATE_INSTRUCTION=7050030,SOLANA_ERROR__TRANSACTION_ERROR__INSUFFICIENT_FUNDS_FOR_RENT=7050031,SOLANA_ERROR__TRANSACTION_ERROR__PROGRAM_EXECUTION_TEMPORARILY_RESTRICTED=7050035,SOLANA_ERROR__CODECS__CANNOT_DECODE_EMPTY_BYTE_ARRAY=8078e3,SOLANA_ERROR__CODECS__INVALID_BYTE_LENGTH=8078001,SOLANA_ERROR__CODECS__EXPECTED_FIXED_LENGTH=8078002,SOLANA_ERROR__CODECS__ENCODER_DECODER_SIZE_COMPATIBILITY_MISMATCH=8078004,SOLANA_ERROR__CODECS__ENCODER_DECODER_FIXED_SIZE_MISMATCH=8078005,SOLANA_ERROR__CODECS__ENCODER_DECODER_MAX_SIZE_MISMATCH=8078006,SOLANA_ERROR__CODECS__INVALID_NUMBER_OF_ITEMS=8078007,SOLANA_ERROR__CODECS__ENUM_DISCRIMINATOR_OUT_OF_RANGE=8078008,SOLANA_ERROR__CODECS__INVALID_DISCRIMINATED_UNION_VARIANT=8078009,SOLANA_ERROR__CODECS__INVALID_ENUM_VARIANT=8078010,SOLANA_ERROR__CODECS__NUMBER_OUT_OF_RANGE=8078011,SOLANA_ERROR__CODECS__INVALID_STRING_FOR_BASE=8078012,SOLANA_ERROR__CODECS__EXPECTED_POSITIVE_BYTE_LENGTH=8078013,SOLANA_ERROR__CODECS__OFFSET_OUT_OF_RANGE=8078014,SOLANA_ERROR__CODECS__UNION_VARIANT_OUT_OF_RANGE=8078017,SOLANA_ERROR__CODECS__INVALID_CONSTANT=8078018,SOLANA_ERROR__CODECS__CANNOT_USE_LEXICAL_VALUES_AS_ENUM_DISCRIMINATORS=8078022,SOLANA_ERROR__RPC__INTEGER_OVERFLOW=81e5,SOLANA_ERROR__RPC__TRANSPORT_HTTP_ERROR=8100002,SOLANA_ERROR__RPC__API_PLAN_MISSING_FOR_RPC_METHOD=8100003,SOLANA_ERROR__RPC_SUBSCRIPTIONS__CANNOT_CREATE_SUBSCRIPTION_PLAN=819e4,SOLANA_ERROR__RPC_SUBSCRIPTIONS__EXPECTED_SERVER_SUBSCRIPTION_ID=8190001,SOLANA_ERROR__RPC_SUBSCRIPTIONS__CHANNEL_CLOSED_BEFORE_MESSAGE_BUFFERED=8190002,SOLANA_ERROR__RPC_SUBSCRIPTIONS__CHANNEL_CONNECTION_CLOSED=8190003,SOLANA_ERROR__RPC_SUBSCRIPTIONS__CHANNEL_FAILED_TO_CONNECT=8190004,SOLANA_ERROR__INVARIANT_VIOLATION__SUBSCRIPTION_ITERATOR_STATE_MISSING=99e5,SOLANA_ERROR__INVARIANT_VIOLATION__SUBSCRIPTION_ITERATOR_MUST_NOT_POLL_BEFORE_RESOLVING_EXISTING_MESSAGE_PROMISE=9900001,SOLANA_ERROR__INVARIANT_VIOLATION__SWITCH_MUST_BE_EXHAUSTIVE=9900003,SOLANA_ERROR__INVARIANT_VIOLATION__DATA_PUBLISHER_CHANNEL_UNIMPLEMENTED=9900004;function encodeValue(g){return Array.isArray(g)?"%5B"+g.map(encodeValue).join("%2C%20")+"%5D":typeof g=="bigint"?`${g}n`:encodeURIComponent(String(g!=null&&Object.getPrototypeOf(g)===null?{...g}:g))}function encodeObjectContextEntry([g,u]){return`${g}=${encodeValue(u)}`}function encodeContextObject(g){const u=Object.entries(g).map(encodeObjectContextEntry).join("&");return btoa(u)}function getErrorMessage(g,u={}){{let h=`Solana error #${g}; Decode this error by running \`npx @solana/errors decode -- ${g}`;return Object.keys(u).length&&(h+=` '${encodeContextObject(u)}'`),`${h}\``}}function isSolanaError(g,u){return g instanceof Error&&g.name==="SolanaError"?u!==void 0?g.context.__code===u:!0:!1}var SolanaError=class extends Error{cause=this.cause;context;constructor(...[g,u]){let h,y;if(u){const{cause:b,...w}=u;b&&(y={cause:b}),Object.keys(w).length>0&&(h=w)}const v=getErrorMessage(g,h);super(v,y),this.context={__code:g,...h},this.name="SolanaError"}};function safeCaptureStackTrace(...g){"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(...g)}function getSolanaErrorFromRpcError({errorCodeBaseOffset:g,getErrorContext:u,orderedErrorNames:h,rpcEnumError:y},v){let b,w;typeof y=="string"?b=y:(b=Object.keys(y)[0],w=y[b]);const E=h.indexOf(b),_=g+E,S=u(_,b,w),A=new SolanaError(_,S);return safeCaptureStackTrace(A,v),A}var ORDERED_ERROR_NAMES=["GenericError","InvalidArgument","InvalidInstructionData","InvalidAccountData","AccountDataTooSmall","InsufficientFunds","IncorrectProgramId","MissingRequiredSignature","AccountAlreadyInitialized","UninitializedAccount","UnbalancedInstruction","ModifiedProgramId","ExternalAccountLamportSpend","ExternalAccountDataModified","ReadonlyLamportChange","ReadonlyDataModified","DuplicateAccountIndex","ExecutableModified","RentEpochModified","NotEnoughAccountKeys","AccountDataSizeChanged","AccountNotExecutable","AccountBorrowFailed","AccountBorrowOutstanding","DuplicateAccountOutOfSync","Custom","InvalidError","ExecutableDataModified","ExecutableLamportChange","ExecutableAccountNotRentExempt","UnsupportedProgramId","CallDepth","MissingAccount","ReentrancyNotAllowed","MaxSeedLengthExceeded","InvalidSeeds","InvalidRealloc","ComputationalBudgetExceeded","PrivilegeEscalation","ProgramEnvironmentSetupFailure","ProgramFailedToComplete","ProgramFailedToCompile","Immutable","IncorrectAuthority","BorshIoError","AccountNotRentExempt","InvalidAccountOwner","ArithmeticOverflow","UnsupportedSysvar","IllegalOwner","MaxAccountsDataAllocationsExceeded","MaxAccountsExceeded","MaxInstructionTraceLengthExceeded","BuiltinProgramsMustConsumeComputeUnits"];function getSolanaErrorFromInstructionError(g,u){const h=Number(g);return getSolanaErrorFromRpcError({errorCodeBaseOffset:4615001,getErrorContext(y,v,b){return y===SOLANA_ERROR__INSTRUCTION_ERROR__UNKNOWN?{errorName:v,index:h,...b!==void 0?{instructionErrorContext:b}:null}:y===SOLANA_ERROR__INSTRUCTION_ERROR__CUSTOM?{code:Number(b),index:h}:y===SOLANA_ERROR__INSTRUCTION_ERROR__BORSH_IO_ERROR?{encodedData:b,index:h}:{index:h}},orderedErrorNames:ORDERED_ERROR_NAMES,rpcEnumError:u},getSolanaErrorFromInstructionError)}var ORDERED_ERROR_NAMES2=["AccountInUse","AccountLoadedTwice","AccountNotFound","ProgramAccountNotFound","InsufficientFundsForFee","InvalidAccountForFee","AlreadyProcessed","BlockhashNotFound","CallChainTooDeep","MissingSignatureForFee","InvalidAccountIndex","SignatureFailure","InvalidProgramForExecution","SanitizeFailure","ClusterMaintenance","AccountBorrowOutstanding","WouldExceedMaxBlockCostLimit","UnsupportedVersion","InvalidWritableAccount","WouldExceedMaxAccountCostLimit","WouldExceedAccountDataBlockLimit","TooManyAccountLocks","AddressLookupTableNotFound","InvalidAddressLookupTableOwner","InvalidAddressLookupTableData","InvalidAddressLookupTableIndex","InvalidRentPayingAccount","WouldExceedMaxVoteCostLimit","WouldExceedAccountDataTotalLimit","DuplicateInstruction","InsufficientFundsForRent","MaxLoadedAccountsDataSizeExceeded","InvalidLoadedAccountsDataSizeLimit","ResanitizationNeeded","ProgramExecutionTemporarilyRestricted","UnbalancedTransaction"];function getSolanaErrorFromTransactionError(g){return typeof g=="object"&&"InstructionError"in g?getSolanaErrorFromInstructionError(...g.InstructionError):getSolanaErrorFromRpcError({errorCodeBaseOffset:7050001,getErrorContext(u,h,y){if(u===SOLANA_ERROR__TRANSACTION_ERROR__UNKNOWN)return{errorName:h,...y!==void 0?{transactionErrorContext:y}:null};if(u===SOLANA_ERROR__TRANSACTION_ERROR__DUPLICATE_INSTRUCTION)return{index:Number(y)};if(u===SOLANA_ERROR__TRANSACTION_ERROR__INSUFFICIENT_FUNDS_FOR_RENT||u===SOLANA_ERROR__TRANSACTION_ERROR__PROGRAM_EXECUTION_TEMPORARILY_RESTRICTED)return{accountIndex:Number(y.account_index)}},orderedErrorNames:ORDERED_ERROR_NAMES2,rpcEnumError:g},getSolanaErrorFromTransactionError)}function getSolanaErrorFromJsonRpcError(g){let u;if(isRpcErrorResponse(g)){const{code:h,data:y,message:v}=g,b=Number(h);if(b===SOLANA_ERROR__JSON_RPC__SERVER_ERROR_SEND_TRANSACTION_PREFLIGHT_FAILURE){const{err:w,...E}=y,_=w?{cause:getSolanaErrorFromTransactionError(w)}:null;u=new SolanaError(SOLANA_ERROR__JSON_RPC__SERVER_ERROR_SEND_TRANSACTION_PREFLIGHT_FAILURE,{...E,..._})}else{let w;switch(b){case SOLANA_ERROR__JSON_RPC__INTERNAL_ERROR:case SOLANA_ERROR__JSON_RPC__INVALID_PARAMS:case SOLANA_ERROR__JSON_RPC__INVALID_REQUEST:case SOLANA_ERROR__JSON_RPC__METHOD_NOT_FOUND:case SOLANA_ERROR__JSON_RPC__PARSE_ERROR:case SOLANA_ERROR__JSON_RPC__SCAN_ERROR:case SOLANA_ERROR__JSON_RPC__SERVER_ERROR_BLOCK_CLEANED_UP:case SOLANA_ERROR__JSON_RPC__SERVER_ERROR_BLOCK_NOT_AVAILABLE:case SOLANA_ERROR__JSON_RPC__SERVER_ERROR_BLOCK_STATUS_NOT_AVAILABLE_YET:case SOLANA_ERROR__JSON_RPC__SERVER_ERROR_KEY_EXCLUDED_FROM_SECONDARY_INDEX:case SOLANA_ERROR__JSON_RPC__SERVER_ERROR_LONG_TERM_STORAGE_SLOT_SKIPPED:case SOLANA_ERROR__JSON_RPC__SERVER_ERROR_SLOT_SKIPPED:case SOLANA_ERROR__JSON_RPC__SERVER_ERROR_TRANSACTION_PRECOMPILE_VERIFICATION_FAILURE:case SOLANA_ERROR__JSON_RPC__SERVER_ERROR_UNSUPPORTED_TRANSACTION_VERSION:w={__serverMessage:v};break;default:typeof y=="object"&&!Array.isArray(y)&&(w=y)}u=new SolanaError(b,w)}}else{const h=typeof g=="object"&&g!==null&&"message"in g&&typeof g.message=="string"?g.message:"Malformed JSON-RPC error with no message attribute";u=new SolanaError(SOLANA_ERROR__MALFORMED_JSON_RPC_ERROR,{error:g,message:h})}return safeCaptureStackTrace(u,getSolanaErrorFromJsonRpcError),u}function isRpcErrorResponse(g){return typeof g=="object"&&g!==null&&"code"in g&&"message"in g&&(typeof g.code=="number"||typeof g.code=="bigint")&&typeof g.message=="string"}var padBytes=(g,u)=>{if(g.length>=u)return g;const h=new Uint8Array(u).fill(0);return h.set(g),h},fixBytes=(g,u)=>padBytes(g.length<=u?g:g.slice(0,u),u);function containsBytes(g,u,h){const y=h===0&&g.length===u.length?g:g.slice(h,h+u.length);return y.length!==u.length?!1:u.every((v,b)=>v===y[b])}function getEncodedSize(g,u){return"fixedSize"in u?u.fixedSize:u.getSizeFromValue(g)}function createEncoder(g){return Object.freeze({...g,encode:u=>{const h=new Uint8Array(getEncodedSize(u,g));return g.write(u,h,0),h}})}function createDecoder(g){return Object.freeze({...g,decode:(u,h=0)=>g.read(u,h)[0]})}function isFixedSize(g){return"fixedSize"in g&&typeof g.fixedSize=="number"}function assertIsFixedSize(g){if(!isFixedSize(g))throw new SolanaError(SOLANA_ERROR__CODECS__EXPECTED_FIXED_LENGTH)}function isVariableSize(g){return!isFixedSize(g)}function combineCodec(g,u){if(isFixedSize(g)!==isFixedSize(u))throw new SolanaError(SOLANA_ERROR__CODECS__ENCODER_DECODER_SIZE_COMPATIBILITY_MISMATCH);if(isFixedSize(g)&&isFixedSize(u)&&g.fixedSize!==u.fixedSize)throw new SolanaError(SOLANA_ERROR__CODECS__ENCODER_DECODER_FIXED_SIZE_MISMATCH,{decoderFixedSize:u.fixedSize,encoderFixedSize:g.fixedSize});if(!isFixedSize(g)&&!isFixedSize(u)&&g.maxSize!==u.maxSize)throw new SolanaError(SOLANA_ERROR__CODECS__ENCODER_DECODER_MAX_SIZE_MISMATCH,{decoderMaxSize:u.maxSize,encoderMaxSize:g.maxSize});return{...u,...g,decode:u.decode,encode:g.encode,read:u.read,write:g.write}}function assertByteArrayIsNotEmptyForCodec(g,u,h=0){if(u.length-h<=0)throw new SolanaError(SOLANA_ERROR__CODECS__CANNOT_DECODE_EMPTY_BYTE_ARRAY,{codecDescription:g})}function assertByteArrayHasEnoughBytesForCodec(g,u,h,y=0){const v=h.length-y;if(v<u)throw new SolanaError(SOLANA_ERROR__CODECS__INVALID_BYTE_LENGTH,{bytesLength:v,codecDescription:g,expected:u})}function assertByteArrayOffsetIsNotOutOfRange(g,u,h){if(u<0||u>h)throw new SolanaError(SOLANA_ERROR__CODECS__OFFSET_OUT_OF_RANGE,{bytesLength:h,codecDescription:g,offset:u})}function addEncoderSizePrefix(g,u){const h=(w,E,_)=>{const S=g.encode(w);return _=u.write(S.length,E,_),E.set(S,_),_+S.length};if(isFixedSize(u)&&isFixedSize(g))return createEncoder({...g,fixedSize:u.fixedSize+g.fixedSize,write:h});const y=isFixedSize(u)?u.fixedSize:u.maxSize??null,v=isFixedSize(g)?g.fixedSize:g.maxSize??null,b=y!==null&&v!==null?y+v:null;return createEncoder({...g,...b!==null?{maxSize:b}:{},getSizeFromValue:w=>{const E=getEncodedSize(w,g);return getEncodedSize(E,u)+E},write:h})}function addDecoderSizePrefix(g,u){const h=(w,E)=>{const[_,S]=u.read(w,E),A=Number(_);return E=S,(E>0||w.length>A)&&(w=w.slice(E,E+A)),assertByteArrayHasEnoughBytesForCodec("addDecoderSizePrefix",A,w),[g.decode(w),E+A]};if(isFixedSize(u)&&isFixedSize(g))return createDecoder({...g,fixedSize:u.fixedSize+g.fixedSize,read:h});const y=isFixedSize(u)?u.fixedSize:u.maxSize??null,v=isFixedSize(g)?g.fixedSize:g.maxSize??null,b=y!==null&&v!==null?y+v:null;return createDecoder({...g,...b!==null?{maxSize:b}:{},read:h})}function fixEncoderSize(g,u){return createEncoder({fixedSize:u,write:(h,y,v)=>{const b=g.encode(h),w=b.length>u?b.slice(0,u):b;return y.set(w,v),v+u}})}function fixDecoderSize(g,u){return createDecoder({fixedSize:u,read:(h,y)=>{assertByteArrayHasEnoughBytesForCodec("fixCodecSize",u,h,y),(y>0||h.length>u)&&(h=h.slice(y,y+u)),isFixedSize(g)&&(h=fixBytes(h,g.fixedSize));const[v]=g.read(h,0);return[v,y+u]}})}function offsetEncoder(g,u){return createEncoder({...g,write:(h,y,v)=>{const b=S=>modulo(S,y.length),w=u.preOffset?u.preOffset({bytes:y,preOffset:v,wrapBytes:b}):v;assertByteArrayOffsetIsNotOutOfRange("offsetEncoder",w,y.length);const E=g.write(h,y,w),_=u.postOffset?u.postOffset({bytes:y,newPreOffset:w,postOffset:E,preOffset:v,wrapBytes:b}):E;return assertByteArrayOffsetIsNotOutOfRange("offsetEncoder",_,y.length),_}})}function modulo(g,u){return u===0?0:(g%u+u)%u}function resizeEncoder(g,u){if(isFixedSize(g)){const h=u(g.fixedSize);if(h<0)throw new SolanaError(SOLANA_ERROR__CODECS__EXPECTED_POSITIVE_BYTE_LENGTH,{bytesLength:h,codecDescription:"resizeEncoder"});return createEncoder({...g,fixedSize:h})}return createEncoder({...g,getSizeFromValue:h=>{const y=u(g.getSizeFromValue(h));if(y<0)throw new SolanaError(SOLANA_ERROR__CODECS__EXPECTED_POSITIVE_BYTE_LENGTH,{bytesLength:y,codecDescription:"resizeEncoder"});return y}})}function padLeftEncoder(g,u){return offsetEncoder(resizeEncoder(g,h=>h+u),{preOffset:({preOffset:h})=>h+u})}function transformEncoder(g,u){return createEncoder({...isVariableSize(g)?{...g,getSizeFromValue:h=>g.getSizeFromValue(u(h))}:g,write:(h,y,v)=>g.write(u(h),y,v)})}function transformDecoder(g,u){return createDecoder({...g,read:(h,y)=>{const[v,b]=g.read(h,y);return[u(v,h,y),b]}})}function assertNumberIsBetweenForCodec(g,u,h,y){if(y<u||y>h)throw new SolanaError(SOLANA_ERROR__CODECS__NUMBER_OUT_OF_RANGE,{codecDescription:g,max:h,min:u,value:y})}function isLittleEndian(g){return g?.endian!==1}function numberEncoderFactory(g){return createEncoder({fixedSize:g.size,write(u,h,y){g.range&&assertNumberIsBetweenForCodec(g.name,g.range[0],g.range[1],u);const v=new ArrayBuffer(g.size);return g.set(new DataView(v),u,isLittleEndian(g.config)),h.set(new Uint8Array(v),y),y+g.size}})}function numberDecoderFactory(g){return createDecoder({fixedSize:g.size,read(u,h=0){assertByteArrayIsNotEmptyForCodec(g.name,u,h),assertByteArrayHasEnoughBytesForCodec(g.name,g.size,u,h);const y=new DataView(toArrayBuffer(u,h,g.size));return[g.get(y,isLittleEndian(g.config)),h+g.size]}})}function toArrayBuffer(g,u,h){const y=g.byteOffset+(u??0),v=h??g.byteLength;return g.buffer.slice(y,y+v)}var getF64Encoder=(g={})=>numberEncoderFactory({config:g,name:"f64",set:(u,h,y)=>u.setFloat64(0,Number(h),y),size:8}),getF64Decoder=(g={})=>numberDecoderFactory({config:g,get:(u,h)=>u.getFloat64(0,h),name:"f64",size:8}),getI16Encoder=(g={})=>numberEncoderFactory({config:g,name:"i16",range:[-+"0x7fff"-1,+"0x7fff"],set:(u,h,y)=>u.setInt16(0,Number(h),y),size:2}),getI16Decoder=(g={})=>numberDecoderFactory({config:g,get:(u,h)=>u.getInt16(0,h),name:"i16",size:2}),getShortU16Encoder=()=>createEncoder({getSizeFromValue:g=>g<=127?1:g<=16383?2:3,maxSize:3,write:(g,u,h)=>{assertNumberIsBetweenForCodec("shortU16",0,65535,g);const y=[0];for(let v=0;;v+=1){const b=Number(g)>>v*7;if(b===0)break;const w=127&b;y[v]=w,v>0&&(y[v-1]|=128)}return u.set(y,h),h+y.length}}),getU16Encoder=(g={})=>numberEncoderFactory({config:g,name:"u16",range:[0,+"0xffff"],set:(u,h,y)=>u.setUint16(0,Number(h),y),size:2}),getU16Decoder=(g={})=>numberDecoderFactory({config:g,get:(u,h)=>u.getUint16(0,h),name:"u16",size:2}),getU32Encoder=(g={})=>numberEncoderFactory({config:g,name:"u32",range:[0,+"0xffffffff"],set:(u,h,y)=>u.setUint32(0,Number(h),y),size:4}),getU32Decoder=(g={})=>numberDecoderFactory({config:g,get:(u,h)=>u.getUint32(0,h),name:"u32",size:4}),getU64Encoder=(g={})=>numberEncoderFactory({config:g,name:"u64",range:[0n,BigInt("0xffffffffffffffff")],set:(u,h,y)=>u.setBigUint64(0,BigInt(h),y),size:8}),getU64Decoder=(g={})=>numberDecoderFactory({config:g,get:(u,h)=>u.getBigUint64(0,h),name:"u64",size:8}),getU64Codec=(g={})=>combineCodec(getU64Encoder(g),getU64Decoder(g)),getU8Encoder=()=>numberEncoderFactory({name:"u8",range:[0,+"0xff"],set:(g,u)=>g.setUint8(0,Number(u)),size:1}),getU8Decoder=()=>numberDecoderFactory({get:g=>g.getUint8(0),name:"u8",size:1});class StructError extends TypeError{constructor(u,h){let y;const{message:v,explanation:b,...w}=u,{path:E}=u,_=E.length===0?v:`At path: ${E.join(".")} -- ${v}`;super(b??_),b!=null&&(this.cause=_),Object.assign(this,w),this.name=this.constructor.name,this.failures=()=>y??(y=[u,...h()])}}function isIterable$1(g){return isObject$2(g)&&typeof g[Symbol.iterator]=="function"}function isObject$2(g){return typeof g=="object"&&g!=null}function isNonArrayObject(g){return isObject$2(g)&&!Array.isArray(g)}function print(g){return typeof g=="symbol"?g.toString():typeof g=="string"?JSON.stringify(g):`${g}`}function shiftIterator(g){const{done:u,value:h}=g.next();return u?void 0:h}function toFailure(g,u,h,y){if(g===!0)return;g===!1?g={}:typeof g=="string"&&(g={message:g});const{path:v,branch:b}=u,{type:w}=h,{refinement:E,message:_=`Expected a value of type \`${w}\`${E?` with refinement \`${E}\``:""}, but received: \`${print(y)}\``}=g;return{value:y,type:w,refinement:E,key:v[v.length-1],path:v,branch:b,...g,message:_}}function*toFailures(g,u,h,y){isIterable$1(g)||(g=[g]);for(const v of g){const b=toFailure(v,u,h,y);b&&(yield b)}}function*run(g,u,h={}){const{path:y=[],branch:v=[g],coerce:b=!1,mask:w=!1}=h,E={path:y,branch:v,mask:w};b&&(g=u.coercer(g,E));let _="valid";for(const S of u.validator(g,E))S.explanation=h.message,_="not_valid",yield[S,void 0];for(let[S,A,R]of u.entries(g,E)){const x=run(A,R,{path:S===void 0?y:[...y,S],branch:S===void 0?v:[...v,A],coerce:b,mask:w,message:h.message});for(const T of x)T[0]?(_=T[0].refinement!=null?"not_refined":"not_valid",yield[T[0],void 0]):b&&(A=T[1],S===void 0?g=A:g instanceof Map?g.set(S,A):g instanceof Set?g.add(A):isObject$2(g)&&(A!==void 0||S in g)&&(g[S]=A))}if(_!=="not_valid")for(const S of u.refiner(g,E))S.explanation=h.message,_="not_refined",yield[S,void 0];_==="valid"&&(yield[void 0,g])}let Struct$1=class{constructor(u){const{type:h,schema:y,validator:v,refiner:b,coercer:w=_=>_,entries:E=function*(){}}=u;this.type=h,this.schema=y,this.entries=E,this.coercer=w,v?this.validator=(_,S)=>{const A=v(_,S);return toFailures(A,S,this,_)}:this.validator=()=>[],b?this.refiner=(_,S)=>{const A=b(_,S);return toFailures(A,S,this,_)}:this.refiner=()=>[]}assert(u,h){return assert$3(u,this,h)}create(u,h){return create$1(u,this,h)}is(u){return is(u,this)}mask(u,h){return mask(u,this,h)}validate(u,h={}){return validate$3(u,this,h)}};function assert$3(g,u,h){const y=validate$3(g,u,{message:h});if(y[0])throw y[0]}function create$1(g,u,h){const y=validate$3(g,u,{coerce:!0,message:h});if(y[0])throw y[0];return y[1]}function mask(g,u,h){const y=validate$3(g,u,{coerce:!0,mask:!0,message:h});if(y[0])throw y[0];return y[1]}function is(g,u){return!validate$3(g,u)[0]}function validate$3(g,u,h={}){const y=run(g,u,h),v=shiftIterator(y);return v[0]?[new StructError(v[0],function*(){for(const w of y)w[0]&&(yield w[0])}),void 0]:[void 0,v[1]]}function define(g,u){return new Struct$1({type:g,schema:null,validator:u})}function any(){return define("any",()=>!0)}function array(g){return new Struct$1({type:"array",schema:g,*entries(u){if(g&&Array.isArray(u))for(const[h,y]of u.entries())yield[h,y,g]},coercer(u){return Array.isArray(u)?u.slice():u},validator(u){return Array.isArray(u)||`Expected an array value, but received: ${print(u)}`}})}function boolean(){return define("boolean",g=>typeof g=="boolean")}function instance(g){return define("instance",u=>u instanceof g||`Expected a \`${g.name}\` instance, but received: ${print(u)}`)}function literal(g){const u=print(g),h=typeof g;return new Struct$1({type:"literal",schema:h==="string"||h==="number"||h==="boolean"?g:null,validator(y){return y===g||`Expected the literal \`${u}\`, but received: ${print(y)}`}})}function never(){return define("never",()=>!1)}function nullable(g){return new Struct$1({...g,validator:(u,h)=>u===null||g.validator(u,h),refiner:(u,h)=>u===null||g.refiner(u,h)})}function number$1(){return define("number",g=>typeof g=="number"&&!isNaN(g)||`Expected a number, but received: ${print(g)}`)}function optional$1(g){return new Struct$1({...g,validator:(u,h)=>u===void 0||g.validator(u,h),refiner:(u,h)=>u===void 0||g.refiner(u,h)})}function record(g,u){return new Struct$1({type:"record",schema:null,*entries(h){if(isObject$2(h))for(const y in h){const v=h[y];yield[y,y,g],yield[y,v,u]}},validator(h){return isNonArrayObject(h)||`Expected an object, but received: ${print(h)}`},coercer(h){return isNonArrayObject(h)?{...h}:h}})}function string$1(){return define("string",g=>typeof g=="string"||`Expected a string, but received: ${print(g)}`)}function tuple(g){const u=never();return new Struct$1({type:"tuple",schema:null,*entries(h){if(Array.isArray(h)){const y=Math.max(g.length,h.length);for(let v=0;v<y;v++)yield[v,h[v],g[v]||u]}},validator(h){return Array.isArray(h)||`Expected an array, but received: ${print(h)}`},coercer(h){return Array.isArray(h)?h.slice():h}})}function type$1(g){const u=Object.keys(g);return new Struct$1({type:"type",schema:g,*entries(h){if(isObject$2(h))for(const y of u)yield[y,h[y],g[y]]},validator(h){return isNonArrayObject(h)||`Expected an object, but received: ${print(h)}`},coercer(h){return isNonArrayObject(h)?{...h}:h}})}function union(g){const u=g.map(h=>h.type).join(" | ");return new Struct$1({type:"union",schema:null,coercer(h,y){for(const v of g){const[b,w]=v.validate(h,{coerce:!0,mask:y.mask});if(!b)return w}return h},validator(h,y){const v=[];for(const b of g){const[...w]=run(h,b,y),[E]=w;if(E[0])for(const[_]of w)_&&v.push(_);else return[]}return[`Expected the value to satisfy a union of \`${u}\`, but received: ${print(h)}`,...v]}})}function unknown(){return define("unknown",()=>!0)}function coerce$1(g,u,h){return new Struct$1({...g,coercer:(y,v)=>is(y,u)?g.coercer(h(y,v),v):g.coercer(y,v)})}var getRandomValues,rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const REGEX=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function validate$2(g){return typeof g=="string"&&REGEX.test(g)}var byteToHex=[];for(var i$1=0;i$1<256;++i$1)byteToHex.push((i$1+256).toString(16).substr(1));function stringify$2(g){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,h=(byteToHex[g[u+0]]+byteToHex[g[u+1]]+byteToHex[g[u+2]]+byteToHex[g[u+3]]+"-"+byteToHex[g[u+4]]+byteToHex[g[u+5]]+"-"+byteToHex[g[u+6]]+byteToHex[g[u+7]]+"-"+byteToHex[g[u+8]]+byteToHex[g[u+9]]+"-"+byteToHex[g[u+10]]+byteToHex[g[u+11]]+byteToHex[g[u+12]]+byteToHex[g[u+13]]+byteToHex[g[u+14]]+byteToHex[g[u+15]]).toLowerCase();if(!validate$2(h))throw TypeError("Stringified UUID is invalid");return h}var _nodeId,_clockseq,_lastMSecs=0,_lastNSecs=0;function v1(g,u,h){var y=u&&h||0,v=u||new Array(16);g=g||{};var b=g.node||_nodeId,w=g.clockseq!==void 0?g.clockseq:_clockseq;if(b==null||w==null){var E=g.random||(g.rng||rng)();b==null&&(b=_nodeId=[E[0]|1,E[1],E[2],E[3],E[4],E[5]]),w==null&&(w=_clockseq=(E[6]<<8|E[7])&16383)}var _=g.msecs!==void 0?g.msecs:Date.now(),S=g.nsecs!==void 0?g.nsecs:_lastNSecs+1,A=_-_lastMSecs+(S-_lastNSecs)/1e4;if(A<0&&g.clockseq===void 0&&(w=w+1&16383),(A<0||_>_lastMSecs)&&g.nsecs===void 0&&(S=0),S>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=_,_lastNSecs=S,_clockseq=w,_+=122192928e5;var R=((_&268435455)*1e4+S)%4294967296;v[y++]=R>>>24&255,v[y++]=R>>>16&255,v[y++]=R>>>8&255,v[y++]=R&255;var x=_/4294967296*1e4&268435455;v[y++]=x>>>8&255,v[y++]=x&255,v[y++]=x>>>24&15|16,v[y++]=x>>>16&255,v[y++]=w>>>8|128,v[y++]=w&255;for(var T=0;T<6;++T)v[y+T]=b[T];return u||stringify$2(v)}function parse$2(g){if(!validate$2(g))throw TypeError("Invalid UUID");var u,h=new Uint8Array(16);return h[0]=(u=parseInt(g.slice(0,8),16))>>>24,h[1]=u>>>16&255,h[2]=u>>>8&255,h[3]=u&255,h[4]=(u=parseInt(g.slice(9,13),16))>>>8,h[5]=u&255,h[6]=(u=parseInt(g.slice(14,18),16))>>>8,h[7]=u&255,h[8]=(u=parseInt(g.slice(19,23),16))>>>8,h[9]=u&255,h[10]=(u=parseInt(g.slice(24,36),16))/1099511627776&255,h[11]=u/4294967296&255,h[12]=u>>>24&255,h[13]=u>>>16&255,h[14]=u>>>8&255,h[15]=u&255,h}function stringToBytes$1(g){g=unescape(encodeURIComponent(g));for(var u=[],h=0;h<g.length;++h)u.push(g.charCodeAt(h));return u}var DNS$1="6ba7b810-9dad-11d1-80b4-00c04fd430c8",URL$1="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function v35(g,u,h){function y(v,b,w,E){if(typeof v=="string"&&(v=stringToBytes$1(v)),typeof b=="string"&&(b=parse$2(b)),b.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var _=new Uint8Array(16+v.length);if(_.set(b),_.set(v,b.length),_=h(_),_[6]=_[6]&15|u,_[8]=_[8]&63|128,w){E=E||0;for(var S=0;S<16;++S)w[E+S]=_[S];return w}return stringify$2(_)}try{y.name=g}catch{}return y.DNS=DNS$1,y.URL=URL$1,y}function md5$2(g){if(typeof g=="string"){var u=unescape(encodeURIComponent(g));g=new Uint8Array(u.length);for(var h=0;h<u.length;++h)g[h]=u.charCodeAt(h)}return md5ToHexEncodedArray(wordsToMd5(bytesToWords(g),g.length*8))}function md5ToHexEncodedArray(g){for(var u=[],h=g.length*32,y="0123456789abcdef",v=0;v<h;v+=8){var b=g[v>>5]>>>v%32&255,w=parseInt(y.charAt(b>>>4&15)+y.charAt(b&15),16);u.push(w)}return u}function getOutputLength(g){return(g+64>>>9<<4)+14+1}function wordsToMd5(g,u){g[u>>5]|=128<<u%32,g[getOutputLength(u)-1]=u;for(var h=1732584193,y=-271733879,v=-1732584194,b=271733878,w=0;w<g.length;w+=16){var E=h,_=y,S=v,A=b;h=md5ff(h,y,v,b,g[w],7,-680876936),b=md5ff(b,h,y,v,g[w+1],12,-389564586),v=md5ff(v,b,h,y,g[w+2],17,606105819),y=md5ff(y,v,b,h,g[w+3],22,-1044525330),h=md5ff(h,y,v,b,g[w+4],7,-176418897),b=md5ff(b,h,y,v,g[w+5],12,1200080426),v=md5ff(v,b,h,y,g[w+6],17,-1473231341),y=md5ff(y,v,b,h,g[w+7],22,-45705983),h=md5ff(h,y,v,b,g[w+8],7,1770035416),b=md5ff(b,h,y,v,g[w+9],12,-1958414417),v=md5ff(v,b,h,y,g[w+10],17,-42063),y=md5ff(y,v,b,h,g[w+11],22,-1990404162),h=md5ff(h,y,v,b,g[w+12],7,1804603682),b=md5ff(b,h,y,v,g[w+13],12,-40341101),v=md5ff(v,b,h,y,g[w+14],17,-1502002290),y=md5ff(y,v,b,h,g[w+15],22,1236535329),h=md5gg(h,y,v,b,g[w+1],5,-165796510),b=md5gg(b,h,y,v,g[w+6],9,-1069501632),v=md5gg(v,b,h,y,g[w+11],14,643717713),y=md5gg(y,v,b,h,g[w],20,-373897302),h=md5gg(h,y,v,b,g[w+5],5,-701558691),b=md5gg(b,h,y,v,g[w+10],9,38016083),v=md5gg(v,b,h,y,g[w+15],14,-660478335),y=md5gg(y,v,b,h,g[w+4],20,-405537848),h=md5gg(h,y,v,b,g[w+9],5,568446438),b=md5gg(b,h,y,v,g[w+14],9,-1019803690),v=md5gg(v,b,h,y,g[w+3],14,-187363961),y=md5gg(y,v,b,h,g[w+8],20,1163531501),h=md5gg(h,y,v,b,g[w+13],5,-1444681467),b=md5gg(b,h,y,v,g[w+2],9,-51403784),v=md5gg(v,b,h,y,g[w+7],14,1735328473),y=md5gg(y,v,b,h,g[w+12],20,-1926607734),h=md5hh(h,y,v,b,g[w+5],4,-378558),b=md5hh(b,h,y,v,g[w+8],11,-2022574463),v=md5hh(v,b,h,y,g[w+11],16,1839030562),y=md5hh(y,v,b,h,g[w+14],23,-35309556),h=md5hh(h,y,v,b,g[w+1],4,-1530992060),b=md5hh(b,h,y,v,g[w+4],11,1272893353),v=md5hh(v,b,h,y,g[w+7],16,-155497632),y=md5hh(y,v,b,h,g[w+10],23,-1094730640),h=md5hh(h,y,v,b,g[w+13],4,681279174),b=md5hh(b,h,y,v,g[w],11,-358537222),v=md5hh(v,b,h,y,g[w+3],16,-722521979),y=md5hh(y,v,b,h,g[w+6],23,76029189),h=md5hh(h,y,v,b,g[w+9],4,-640364487),b=md5hh(b,h,y,v,g[w+12],11,-421815835),v=md5hh(v,b,h,y,g[w+15],16,530742520),y=md5hh(y,v,b,h,g[w+2],23,-995338651),h=md5ii(h,y,v,b,g[w],6,-198630844),b=md5ii(b,h,y,v,g[w+7],10,1126891415),v=md5ii(v,b,h,y,g[w+14],15,-1416354905),y=md5ii(y,v,b,h,g[w+5],21,-57434055),h=md5ii(h,y,v,b,g[w+12],6,1700485571),b=md5ii(b,h,y,v,g[w+3],10,-1894986606),v=md5ii(v,b,h,y,g[w+10],15,-1051523),y=md5ii(y,v,b,h,g[w+1],21,-2054922799),h=md5ii(h,y,v,b,g[w+8],6,1873313359),b=md5ii(b,h,y,v,g[w+15],10,-30611744),v=md5ii(v,b,h,y,g[w+6],15,-1560198380),y=md5ii(y,v,b,h,g[w+13],21,1309151649),h=md5ii(h,y,v,b,g[w+4],6,-145523070),b=md5ii(b,h,y,v,g[w+11],10,-1120210379),v=md5ii(v,b,h,y,g[w+2],15,718787259),y=md5ii(y,v,b,h,g[w+9],21,-343485551),h=safeAdd(h,E),y=safeAdd(y,_),v=safeAdd(v,S),b=safeAdd(b,A)}return[h,y,v,b]}function bytesToWords(g){if(g.length===0)return[];for(var u=g.length*8,h=new Uint32Array(getOutputLength(u)),y=0;y<u;y+=8)h[y>>5]|=(g[y/8]&255)<<y%32;return h}function safeAdd(g,u){var h=(g&65535)+(u&65535),y=(g>>16)+(u>>16)+(h>>16);return y<<16|h&65535}function bitRotateLeft(g,u){return g<<u|g>>>32-u}function md5cmn(g,u,h,y,v,b){return safeAdd(bitRotateLeft(safeAdd(safeAdd(u,g),safeAdd(y,b)),v),h)}function md5ff(g,u,h,y,v,b,w){return md5cmn(u&h|~u&y,g,u,v,b,w)}function md5gg(g,u,h,y,v,b,w){return md5cmn(u&y|h&~y,g,u,v,b,w)}function md5hh(g,u,h,y,v,b,w){return md5cmn(u^h^y,g,u,v,b,w)}function md5ii(g,u,h,y,v,b,w){return md5cmn(h^(u|~y),g,u,v,b,w)}var v3=v35("v3",48,md5$2);function v4(g,u,h){g=g||{};var y=g.random||(g.rng||rng)();if(y[6]=y[6]&15|64,y[8]=y[8]&63|128,u){h=h||0;for(var v=0;v<16;++v)u[h+v]=y[v];return u}return stringify$2(y)}function f$1(g,u,h,y){switch(g){case 0:return u&h^~u&y;case 1:return u^h^y;case 2:return u&h^u&y^h&y;case 3:return u^h^y}}function ROTL(g,u){return g<<u|g>>>32-u}function sha1$1(g){var u=[1518500249,1859775393,2400959708,3395469782],h=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof g=="string"){var y=unescape(encodeURIComponent(g));g=[];for(var v=0;v<y.length;++v)g.push(y.charCodeAt(v))}else Array.isArray(g)||(g=Array.prototype.slice.call(g));g.push(128);for(var b=g.length/4+2,w=Math.ceil(b/16),E=new Array(w),_=0;_<w;++_){for(var S=new Uint32Array(16),A=0;A<16;++A)S[A]=g[_*64+A*4]<<24|g[_*64+A*4+1]<<16|g[_*64+A*4+2]<<8|g[_*64+A*4+3];E[_]=S}E[w-1][14]=(g.length-1)*8/Math.pow(2,32),E[w-1][14]=Math.floor(E[w-1][14]),E[w-1][15]=(g.length-1)*8&4294967295;for(var R=0;R<w;++R){for(var x=new Uint32Array(80),T=0;T<16;++T)x[T]=E[R][T];for(var C=16;C<80;++C)x[C]=ROTL(x[C-3]^x[C-8]^x[C-14]^x[C-16],1);for(var I=h[0],L=h[1],$=h[2],B=h[3],U=h[4],z=0;z<80;++z){var ne=Math.floor(z/20),ue=ROTL(I,5)+f$1(ne,L,$,B)+U+u[ne]+x[z]>>>0;U=B,B=$,$=ROTL(L,30)>>>0,L=I,I=ue}h[0]=h[0]+I>>>0,h[1]=h[1]+L>>>0,h[2]=h[2]+$>>>0,h[3]=h[3]+B>>>0,h[4]=h[4]+U>>>0}return[h[0]>>24&255,h[0]>>16&255,h[0]>>8&255,h[0]&255,h[1]>>24&255,h[1]>>16&255,h[1]>>8&255,h[1]&255,h[2]>>24&255,h[2]>>16&255,h[2]>>8&255,h[2]&255,h[3]>>24&255,h[3]>>16&255,h[3]>>8&255,h[3]&255,h[4]>>24&255,h[4]>>16&255,h[4]>>8&255,h[4]&255]}var v5=v35("v5",80,sha1$1);const nil="00000000-0000-0000-0000-000000000000";function version$4(g){if(!validate$2(g))throw TypeError("Invalid UUID");return parseInt(g.substr(14,1),16)}const esmBrowser=Object.freeze(Object.defineProperty({__proto__:null,NIL:nil,parse:parse$2,stringify:stringify$2,v1,v3,v4,v5,validate:validate$2,version:version$4},Symbol.toStringTag,{value:"Module"})),require$$0$2=getAugmentedNamespace(esmBrowser);var generateRequest_1,hasRequiredGenerateRequest;function requireGenerateRequest(){if(hasRequiredGenerateRequest)return generateRequest_1;hasRequiredGenerateRequest=1;const g=require$$0$2.v4;return generateRequest_1=function(h,y,v,b){if(typeof h!="string")throw new TypeError(h+" must be a string");b=b||{};const w=typeof b.version=="number"?b.version:2;if(w!==1&&w!==2)throw new TypeError(w+" must be 1 or 2");const E={method:h};if(w===2&&(E.jsonrpc="2.0"),y){if(typeof y!="object"&&!Array.isArray(y))throw new TypeError(y+" must be an object, array or omitted");E.params=y}if(typeof v>"u"){const _=typeof b.generator=="function"?b.generator:function(){return g()};E.id=_(E,b)}else w===2&&v===null?b.notificationIdNull&&(E.id=null):E.id=v;return E},generateRequest_1}var browser$f,hasRequiredBrowser$e;function requireBrowser$e(){if(hasRequiredBrowser$e)return browser$f;hasRequiredBrowser$e=1;const g=require$$0$2.v4,u=requireGenerateRequest(),h=function(y,v){if(!(this instanceof h))return new h(y,v);v||(v={}),this.options={reviver:typeof v.reviver<"u"?v.reviver:null,replacer:typeof v.replacer<"u"?v.replacer:null,generator:typeof v.generator<"u"?v.generator:function(){return g()},version:typeof v.version<"u"?v.version:2,notificationIdNull:typeof v.notificationIdNull=="boolean"?v.notificationIdNull:!1},this.callServer=y};return browser$f=h,h.prototype.request=function(y,v,b,w){const E=this;let _=null;const S=Array.isArray(y)&&typeof v=="function";if(this.options.version===1&&S)throw new TypeError("JSON-RPC 1.0 does not support batching");if(S||!S&&y&&typeof y=="object"&&typeof v=="function")w=v,_=y;else{typeof b=="function"&&(w=b,b=void 0);const x=typeof w=="function";try{_=u(y,v,b,{generator:this.options.generator,version:this.options.version,notificationIdNull:this.options.notificationIdNull})}catch(T){if(x)return w(T);throw T}if(!x)return _}let R;try{R=JSON.stringify(_,this.options.replacer)}catch(x){return w(x)}return this.callServer(R,function(x,T){E._parseResponse(x,T,w)}),_},h.prototype._parseResponse=function(y,v,b){if(y){b(y);return}if(!v)return b();let w;try{w=JSON.parse(v,this.options.reviver)}catch(E){return b(E)}if(b.length===3)if(Array.isArray(w)){const E=function(S){return typeof S.error<"u"},_=function(S){return!E(S)};return b(null,w.filter(E),w.filter(_))}else return b(null,w.error,w.result);b(null,w)},browser$f}requireBrowser$e();var eventemitter3={exports:{}},hasRequiredEventemitter3;function requireEventemitter3(){return hasRequiredEventemitter3||(hasRequiredEventemitter3=1,(function(g){var u=Object.prototype.hasOwnProperty,h="~";function y(){}Object.create&&(y.prototype=Object.create(null),new y().__proto__||(h=!1));function v(_,S,A){this.fn=_,this.context=S,this.once=A||!1}function b(_,S,A,R,x){if(typeof A!="function")throw new TypeError("The listener must be a function");var T=new v(A,R||_,x),C=h?h+S:S;return _._events[C]?_._events[C].fn?_._events[C]=[_._events[C],T]:_._events[C].push(T):(_._events[C]=T,_._eventsCount++),_}function w(_,S){--_._eventsCount===0?_._events=new y:delete _._events[S]}function E(){this._events=new y,this._eventsCount=0}E.prototype.eventNames=function(){var S=[],A,R;if(this._eventsCount===0)return S;for(R in A=this._events)u.call(A,R)&&S.push(h?R.slice(1):R);return Object.getOwnPropertySymbols?S.concat(Object.getOwnPropertySymbols(A)):S},E.prototype.listeners=function(S){var A=h?h+S:S,R=this._events[A];if(!R)return[];if(R.fn)return[R.fn];for(var x=0,T=R.length,C=new Array(T);x<T;x++)C[x]=R[x].fn;return C},E.prototype.listenerCount=function(S){var A=h?h+S:S,R=this._events[A];return R?R.fn?1:R.length:0},E.prototype.emit=function(S,A,R,x,T,C){var I=h?h+S:S;if(!this._events[I])return!1;var L=this._events[I],$=arguments.length,B,U;if(L.fn){switch(L.once&&this.removeListener(S,L.fn,void 0,!0),$){case 1:return L.fn.call(L.context),!0;case 2:return L.fn.call(L.context,A),!0;case 3:return L.fn.call(L.context,A,R),!0;case 4:return L.fn.call(L.context,A,R,x),!0;case 5:return L.fn.call(L.context,A,R,x,T),!0;case 6:return L.fn.call(L.context,A,R,x,T,C),!0}for(U=1,B=new Array($-1);U<$;U++)B[U-1]=arguments[U];L.fn.apply(L.context,B)}else{var z=L.length,ne;for(U=0;U<z;U++)switch(L[U].once&&this.removeListener(S,L[U].fn,void 0,!0),$){case 1:L[U].fn.call(L[U].context);break;case 2:L[U].fn.call(L[U].context,A);break;case 3:L[U].fn.call(L[U].context,A,R);break;case 4:L[U].fn.call(L[U].context,A,R,x);break;default:if(!B)for(ne=1,B=new Array($-1);ne<$;ne++)B[ne-1]=arguments[ne];L[U].fn.apply(L[U].context,B)}}return!0},E.prototype.on=function(S,A,R){return b(this,S,A,R,!1)},E.prototype.once=function(S,A,R){return b(this,S,A,R,!0)},E.prototype.removeListener=function(S,A,R,x){var T=h?h+S:S;if(!this._events[T])return this;if(!A)return w(this,T),this;var C=this._events[T];if(C.fn)C.fn===A&&(!x||C.once)&&(!R||C.context===R)&&w(this,T);else{for(var I=0,L=[],$=C.length;I<$;I++)(C[I].fn!==A||x&&!C[I].once||R&&C[I].context!==R)&&L.push(C[I]);L.length?this._events[T]=L.length===1?L[0]:L:w(this,T)}return this},E.prototype.removeAllListeners=function(S){var A;return S?(A=h?h+S:S,this._events[A]&&w(this,A)):(this._events=new y,this._eventsCount=0),this},E.prototype.off=E.prototype.removeListener,E.prototype.addListener=E.prototype.on,E.prefixed=h,E.EventEmitter=E,g.exports=E})(eventemitter3)),eventemitter3.exports}var eventemitter3Exports=requireEventemitter3();const EventEmitter=getDefaultExportFromCjs(eventemitter3Exports);let HMAC$1=class extends Hash$1{constructor(u,h){super(),this.finished=!1,this.destroyed=!1,ahash(u);const y=toBytes$2(h);if(this.iHash=u.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const v=this.blockLen,b=new Uint8Array(v);b.set(y.length>v?u.create().update(y).digest():y);for(let w=0;w<b.length;w++)b[w]^=54;this.iHash.update(b),this.oHash=u.create();for(let w=0;w<b.length;w++)b[w]^=106;this.oHash.update(b),clean$1(b)}update(u){return aexists$1(this),this.iHash.update(u),this}digestInto(u){aexists$1(this),abytes$2(u,this.outputLen),this.finished=!0,this.iHash.digestInto(u),this.oHash.update(u),this.oHash.digestInto(u),this.destroy()}digest(){const u=new Uint8Array(this.oHash.outputLen);return this.digestInto(u),u}_cloneInto(u){u||(u=Object.create(Object.getPrototypeOf(this),{}));const{oHash:h,iHash:y,finished:v,destroyed:b,blockLen:w,outputLen:E}=this;return u=u,u.finished=v,u.destroyed=b,u.blockLen=w,u.outputLen=E,u.oHash=h._cloneInto(u.oHash),u.iHash=y._cloneInto(u.iHash),u}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$2=(g,u,h)=>new HMAC$1(g,u).update(h).digest();hmac$2.create=(g,u)=>new HMAC$1(g,u);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const divNearest$1=(g,u)=>(g+(g>=0?u:-u)/_2n$5)/u;function _splitEndoScalar(g,u,h){const[[y,v],[b,w]]=u,E=divNearest$1(w*g,h),_=divNearest$1(-v*g,h);let S=g-E*y-_*b,A=-E*v-_*w;const R=S<_0n$5,x=A<_0n$5;R&&(S=-S),x&&(A=-A);const T=bitMask$1(Math.ceil(bitLen$1(h)/2))+_1n$6;if(S<_0n$5||S>=T||A<_0n$5||A>=T)throw new Error("splitScalar (endomorphism): failed, k="+g);return{k1neg:R,k1:S,k2neg:x,k2:A}}function validateSigFormat(g){if(!["compact","recovered","der"].includes(g))throw new Error('Signature format must be "compact", "recovered", or "der"');return g}function validateSigOpts(g,u){const h={};for(let y of Object.keys(u))h[y]=g[y]===void 0?u[y]:g[y];return _abool2(h.lowS,"lowS"),_abool2(h.prehash,"prehash"),h.format!==void 0&&validateSigFormat(h.format),h}class DERErr extends Error{constructor(u=""){super(u)}}const DER$1={Err:DERErr,_tlv:{encode:(g,u)=>{const{Err:h}=DER$1;if(g<0||g>256)throw new h("tlv.encode: wrong tag");if(u.length&1)throw new h("tlv.encode: unpadded data");const y=u.length/2,v=numberToHexUnpadded$1(y);if(v.length/2&128)throw new h("tlv.encode: long form length too big");const b=y>127?numberToHexUnpadded$1(v.length/2|128):"";return numberToHexUnpadded$1(g)+b+v+u},decode(g,u){const{Err:h}=DER$1;let y=0;if(g<0||g>256)throw new h("tlv.encode: wrong tag");if(u.length<2||u[y++]!==g)throw new h("tlv.decode: wrong tlv");const v=u[y++],b=!!(v&128);let w=0;if(!b)w=v;else{const _=v&127;if(!_)throw new h("tlv.decode(long): indefinite length not supported");if(_>4)throw new h("tlv.decode(long): byte length is too big");const S=u.subarray(y,y+_);if(S.length!==_)throw new h("tlv.decode: length bytes not complete");if(S[0]===0)throw new h("tlv.decode(long): zero leftmost byte");for(const A of S)w=w<<8|A;if(y+=_,w<128)throw new h("tlv.decode(long): not minimal encoding")}const E=u.subarray(y,y+w);if(E.length!==w)throw new h("tlv.decode: wrong value length");return{v:E,l:u.subarray(y+w)}}},_int:{encode(g){const{Err:u}=DER$1;if(g<_0n$5)throw new u("integer: negative integers are not allowed");let h=numberToHexUnpadded$1(g);if(Number.parseInt(h[0],16)&8&&(h="00"+h),h.length&1)throw new u("unexpected DER parsing assertion: unpadded hex");return h},decode(g){const{Err:u}=DER$1;if(g[0]&128)throw new u("invalid signature integer: negative");if(g[0]===0&&!(g[1]&128))throw new u("invalid signature integer: unnecessary leading zero");return bytesToNumberBE$1(g)}},toSig(g){const{Err:u,_int:h,_tlv:y}=DER$1,v=ensureBytes$1("signature",g),{v:b,l:w}=y.decode(48,v);if(w.length)throw new u("invalid signature: left bytes after parsing");const{v:E,l:_}=y.decode(2,b),{v:S,l:A}=y.decode(2,_);if(A.length)throw new u("invalid signature: left bytes after parsing");return{r:h.decode(E),s:h.decode(S)}},hexFromSig(g){const{_tlv:u,_int:h}=DER$1,y=u.encode(2,h.encode(g.r)),v=u.encode(2,h.encode(g.s)),b=y+v;return u.encode(48,b)}},_0n$5=BigInt(0),_1n$6=BigInt(1),_2n$5=BigInt(2),_3n$2=BigInt(3),_4n$1=BigInt(4);function _normFnElement(g,u){const{BYTES:h}=g;let y;if(typeof u=="bigint")y=u;else{let v=ensureBytes$1("private key",u);try{y=g.fromBytes(v)}catch{throw new Error(`invalid private key: expected ui8a of size ${h}, got ${typeof u}`)}}if(!g.isValidNot0(y))throw new Error("invalid private key: out of range [1..N-1]");return y}function weierstrassN(g,u={}){const h=_createCurveFields("weierstrass",g,u),{Fp:y,Fn:v}=h;let b=h.CURVE;const{h:w,n:E}=b;_validateObject(u,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:_}=u;if(_&&(!y.is0(b.a)||typeof _.beta!="bigint"||!Array.isArray(_.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const S=getWLengths(y,v);function A(){if(!y.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function R(M,N,P){const{x:O,y:k}=N.toAffine(),q=y.toBytes(O);if(_abool2(P,"isCompressed"),P){A();const F=!y.isOdd(k);return concatBytes$2(pprefix(F),q)}else return concatBytes$2(Uint8Array.of(4),q,y.toBytes(k))}function x(M){_abytes2(M,void 0,"Point");const{publicKey:N,publicKeyUncompressed:P}=S,O=M.length,k=M[0],q=M.subarray(1);if(O===N&&(k===2||k===3)){const F=y.fromBytes(q);if(!y.isValid(F))throw new Error("bad point: is not on curve, wrong x");const H=I(F);let D;try{D=y.sqrt(H)}catch(K){const Z=K instanceof Error?": "+K.message:"";throw new Error("bad point: is not on curve, sqrt error"+Z)}A();const G=y.isOdd(D);return(k&1)===1!==G&&(D=y.neg(D)),{x:F,y:D}}else if(O===P&&k===4){const F=y.BYTES,H=y.fromBytes(q.subarray(0,F)),D=y.fromBytes(q.subarray(F,F*2));if(!L(H,D))throw new Error("bad point: is not on curve");return{x:H,y:D}}else throw new Error(`bad point: got length ${O}, expected compressed=${N} or uncompressed=${P}`)}const T=u.toBytes||R,C=u.fromBytes||x;function I(M){const N=y.sqr(M),P=y.mul(N,M);return y.add(y.add(P,y.mul(M,b.a)),b.b)}function L(M,N){const P=y.sqr(N),O=I(M);return y.eql(P,O)}if(!L(b.Gx,b.Gy))throw new Error("bad curve params: generator point");const $=y.mul(y.pow(b.a,_3n$2),_4n$1),B=y.mul(y.sqr(b.b),BigInt(27));if(y.is0(y.add($,B)))throw new Error("bad curve params: a or b");function U(M,N,P=!1){if(!y.isValid(N)||P&&y.is0(N))throw new Error(`bad point coordinate ${M}`);return N}function z(M){if(!(M instanceof X))throw new Error("ProjectivePoint expected")}function ne(M){if(!_||!_.basises)throw new Error("no endo");return _splitEndoScalar(M,_.basises,v.ORDER)}const ue=memoized((M,N)=>{const{X:P,Y:O,Z:k}=M;if(y.eql(k,y.ONE))return{x:P,y:O};const q=M.is0();N==null&&(N=q?y.ONE:y.inv(k));const F=y.mul(P,N),H=y.mul(O,N),D=y.mul(k,N);if(q)return{x:y.ZERO,y:y.ZERO};if(!y.eql(D,y.ONE))throw new Error("invZ was invalid");return{x:F,y:H}}),he=memoized(M=>{if(M.is0()){if(u.allowInfinityPoint&&!y.is0(M.Y))return;throw new Error("bad point: ZERO")}const{x:N,y:P}=M.toAffine();if(!y.isValid(N)||!y.isValid(P))throw new Error("bad point: x or y not field elements");if(!L(N,P))throw new Error("bad point: equation left != right");if(!M.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function Y(M,N,P,O,k){return P=new X(y.mul(P.X,M),P.Y,P.Z),N=negateCt(O,N),P=negateCt(k,P),N.add(P)}class X{constructor(N,P,O){this.X=U("x",N),this.Y=U("y",P,!0),this.Z=U("z",O),Object.freeze(this)}static CURVE(){return b}static fromAffine(N){const{x:P,y:O}=N||{};if(!N||!y.isValid(P)||!y.isValid(O))throw new Error("invalid affine point");if(N instanceof X)throw new Error("projective point not allowed");return y.is0(P)&&y.is0(O)?X.ZERO:new X(P,O,y.ONE)}static fromBytes(N){const P=X.fromAffine(C(_abytes2(N,void 0,"point")));return P.assertValidity(),P}static fromHex(N){return X.fromBytes(ensureBytes$1("pointHex",N))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(N=8,P=!0){return j.createCache(this,N),P||this.multiply(_3n$2),this}assertValidity(){he(this)}hasEvenY(){const{y:N}=this.toAffine();if(!y.isOdd)throw new Error("Field doesn't support isOdd");return!y.isOdd(N)}equals(N){z(N);const{X:P,Y:O,Z:k}=this,{X:q,Y:F,Z:H}=N,D=y.eql(y.mul(P,H),y.mul(q,k)),G=y.eql(y.mul(O,H),y.mul(F,k));return D&&G}negate(){return new X(this.X,y.neg(this.Y),this.Z)}double(){const{a:N,b:P}=b,O=y.mul(P,_3n$2),{X:k,Y:q,Z:F}=this;let H=y.ZERO,D=y.ZERO,G=y.ZERO,W=y.mul(k,k),K=y.mul(q,q),Z=y.mul(F,F),ae=y.mul(k,q);return ae=y.add(ae,ae),G=y.mul(k,F),G=y.add(G,G),H=y.mul(N,G),D=y.mul(O,Z),D=y.add(H,D),H=y.sub(K,D),D=y.add(K,D),D=y.mul(H,D),H=y.mul(ae,H),G=y.mul(O,G),Z=y.mul(N,Z),ae=y.sub(W,Z),ae=y.mul(N,ae),ae=y.add(ae,G),G=y.add(W,W),W=y.add(G,W),W=y.add(W,Z),W=y.mul(W,ae),D=y.add(D,W),Z=y.mul(q,F),Z=y.add(Z,Z),W=y.mul(Z,ae),H=y.sub(H,W),G=y.mul(Z,K),G=y.add(G,G),G=y.add(G,G),new X(H,D,G)}add(N){z(N);const{X:P,Y:O,Z:k}=this,{X:q,Y:F,Z:H}=N;let D=y.ZERO,G=y.ZERO,W=y.ZERO;const K=b.a,Z=y.mul(b.b,_3n$2);let ae=y.mul(P,q),le=y.mul(O,F),te=y.mul(k,H),ce=y.add(P,O),ge=y.add(q,F);ce=y.mul(ce,ge),ge=y.add(ae,le),ce=y.sub(ce,ge),ge=y.add(P,k);let Ee=y.add(q,H);return ge=y.mul(ge,Ee),Ee=y.add(ae,te),ge=y.sub(ge,Ee),Ee=y.add(O,k),D=y.add(F,H),Ee=y.mul(Ee,D),D=y.add(le,te),Ee=y.sub(Ee,D),W=y.mul(K,ge),D=y.mul(Z,te),W=y.add(D,W),D=y.sub(le,W),W=y.add(le,W),G=y.mul(D,W),le=y.add(ae,ae),le=y.add(le,ae),te=y.mul(K,te),ge=y.mul(Z,ge),le=y.add(le,te),te=y.sub(ae,te),te=y.mul(K,te),ge=y.add(ge,te),ae=y.mul(le,ge),G=y.add(G,ae),ae=y.mul(Ee,ge),D=y.mul(ce,D),D=y.sub(D,ae),ae=y.mul(ce,le),W=y.mul(Ee,W),W=y.add(W,ae),new X(D,G,W)}subtract(N){return this.add(N.negate())}is0(){return this.equals(X.ZERO)}multiply(N){const{endo:P}=u;if(!v.isValidNot0(N))throw new Error("invalid scalar: out of range");let O,k;const q=F=>j.cached(this,F,H=>normalizeZ(X,H));if(P){const{k1neg:F,k1:H,k2neg:D,k2:G}=ne(N),{p:W,f:K}=q(H),{p:Z,f:ae}=q(G);k=K.add(ae),O=Y(P.beta,W,Z,F,D)}else{const{p:F,f:H}=q(N);O=F,k=H}return normalizeZ(X,[O,k])[0]}multiplyUnsafe(N){const{endo:P}=u,O=this;if(!v.isValid(N))throw new Error("invalid scalar: out of range");if(N===_0n$5||O.is0())return X.ZERO;if(N===_1n$6)return O;if(j.hasCache(this))return this.multiply(N);if(P){const{k1neg:k,k1:q,k2neg:F,k2:H}=ne(N),{p1:D,p2:G}=mulEndoUnsafe(X,O,q,H);return Y(P.beta,D,G,k,F)}else return j.unsafe(O,N)}multiplyAndAddUnsafe(N,P,O){const k=this.multiplyUnsafe(P).add(N.multiplyUnsafe(O));return k.is0()?void 0:k}toAffine(N){return ue(this,N)}isTorsionFree(){const{isTorsionFree:N}=u;return w===_1n$6?!0:N?N(X,this):j.unsafe(this,E).is0()}clearCofactor(){const{clearCofactor:N}=u;return w===_1n$6?this:N?N(X,this):this.multiplyUnsafe(w)}isSmallOrder(){return this.multiplyUnsafe(w).is0()}toBytes(N=!0){return _abool2(N,"isCompressed"),this.assertValidity(),T(X,this,N)}toHex(N=!0){return bytesToHex$1(this.toBytes(N))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(N=!0){return this.toBytes(N)}_setWindowSize(N){this.precompute(N)}static normalizeZ(N){return normalizeZ(X,N)}static msm(N,P){return pippenger(X,v,N,P)}static fromPrivateKey(N){return X.BASE.multiply(_normFnElement(v,N))}}X.BASE=new X(b.Gx,b.Gy,y.ONE),X.ZERO=new X(y.ZERO,y.ONE,y.ZERO),X.Fp=y,X.Fn=v;const J=v.BITS,j=new wNAF$1(X,u.endo?Math.ceil(J/2):J);return X.BASE.precompute(8),X}function pprefix(g){return Uint8Array.of(g?2:3)}function getWLengths(g,u){return{secretKey:u.BYTES,publicKey:1+g.BYTES,publicKeyUncompressed:1+2*g.BYTES,publicKeyHasPrefix:!0,signature:2*u.BYTES}}function ecdh(g,u={}){const{Fn:h}=g,y=u.randomBytes||randomBytes$3,v=Object.assign(getWLengths(g.Fp,h),{seed:getMinHashLength$1(h.ORDER)});function b(T){try{return!!_normFnElement(h,T)}catch{return!1}}function w(T,C){const{publicKey:I,publicKeyUncompressed:L}=v;try{const $=T.length;return C===!0&&$!==I||C===!1&&$!==L?!1:!!g.fromBytes(T)}catch{return!1}}function E(T=y(v.seed)){return mapHashToField$1(_abytes2(T,v.seed,"seed"),h.ORDER)}function _(T,C=!0){return g.BASE.multiply(_normFnElement(h,T)).toBytes(C)}function S(T){const C=E(T);return{secretKey:C,publicKey:_(C)}}function A(T){if(typeof T=="bigint")return!1;if(T instanceof g)return!0;const{secretKey:C,publicKey:I,publicKeyUncompressed:L}=v;if(h.allowedLengths||C===I)return;const $=ensureBytes$1("key",T).length;return $===I||$===L}function R(T,C,I=!0){if(A(T)===!0)throw new Error("first arg must be private key");if(A(C)===!1)throw new Error("second arg must be public key");const L=_normFnElement(h,T);return g.fromHex(C).multiply(L).toBytes(I)}return Object.freeze({getPublicKey:_,getSharedSecret:R,keygen:S,Point:g,utils:{isValidSecretKey:b,isValidPublicKey:w,randomSecretKey:E,isValidPrivateKey:b,randomPrivateKey:E,normPrivateKeyToScalar:T=>_normFnElement(h,T),precompute(T=8,C=g.BASE){return C.precompute(T,!1)}},lengths:v})}function ecdsa(g,u,h={}){ahash(u),_validateObject(h,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const y=h.randomBytes||randomBytes$3,v=h.hmac||((P,...O)=>hmac$2(u,P,concatBytes$2(...O))),{Fp:b,Fn:w}=g,{ORDER:E,BITS:_}=w,{keygen:S,getPublicKey:A,getSharedSecret:R,utils:x,lengths:T}=ecdh(g,h),C={prehash:!1,lowS:typeof h.lowS=="boolean"?h.lowS:!1,format:void 0,extraEntropy:!1},I="compact";function L(P){const O=E>>_1n$6;return P>O}function $(P,O){if(!w.isValidNot0(O))throw new Error(`invalid signature ${P}: out of range 1..Point.Fn.ORDER`);return O}function B(P,O){validateSigFormat(O);const k=T.signature,q=O==="compact"?k:O==="recovered"?k+1:void 0;return _abytes2(P,q,`${O} signature`)}class U{constructor(O,k,q){this.r=$("r",O),this.s=$("s",k),q!=null&&(this.recovery=q),Object.freeze(this)}static fromBytes(O,k=I){B(O,k);let q;if(k==="der"){const{r:G,s:W}=DER$1.toSig(_abytes2(O));return new U(G,W)}k==="recovered"&&(q=O[0],k="compact",O=O.subarray(1));const F=w.BYTES,H=O.subarray(0,F),D=O.subarray(F,F*2);return new U(w.fromBytes(H),w.fromBytes(D),q)}static fromHex(O,k){return this.fromBytes(hexToBytes$2(O),k)}addRecoveryBit(O){return new U(this.r,this.s,O)}recoverPublicKey(O){const k=b.ORDER,{r:q,s:F,recovery:H}=this;if(H==null||![0,1,2,3].includes(H))throw new Error("recovery id invalid");if(E*_2n$5<k&&H>1)throw new Error("recovery id is ambiguous for h>1 curve");const G=H===2||H===3?q+E:q;if(!b.isValid(G))throw new Error("recovery id 2 or 3 invalid");const W=b.toBytes(G),K=g.fromBytes(concatBytes$2(pprefix((H&1)===0),W)),Z=w.inv(G),ae=ne(ensureBytes$1("msgHash",O)),le=w.create(-ae*Z),te=w.create(F*Z),ce=g.BASE.multiplyUnsafe(le).add(K.multiplyUnsafe(te));if(ce.is0())throw new Error("point at infinify");return ce.assertValidity(),ce}hasHighS(){return L(this.s)}toBytes(O=I){if(validateSigFormat(O),O==="der")return hexToBytes$2(DER$1.hexFromSig(this));const k=w.toBytes(this.r),q=w.toBytes(this.s);if(O==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return concatBytes$2(Uint8Array.of(this.recovery),k,q)}return concatBytes$2(k,q)}toHex(O){return bytesToHex$1(this.toBytes(O))}assertValidity(){}static fromCompact(O){return U.fromBytes(ensureBytes$1("sig",O),"compact")}static fromDER(O){return U.fromBytes(ensureBytes$1("sig",O),"der")}normalizeS(){return this.hasHighS()?new U(this.r,w.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return bytesToHex$1(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return bytesToHex$1(this.toBytes("compact"))}}const z=h.bits2int||function(O){if(O.length>8192)throw new Error("input is too large");const k=bytesToNumberBE$1(O),q=O.length*8-_;return q>0?k>>BigInt(q):k},ne=h.bits2int_modN||function(O){return w.create(z(O))},ue=bitMask$1(_);function he(P){return aInRange("num < 2^"+_,P,_0n$5,ue),w.toBytes(P)}function Y(P,O){return _abytes2(P,void 0,"message"),O?_abytes2(u(P),void 0,"prehashed message"):P}function X(P,O,k){if(["recovered","canonical"].some(le=>le in k))throw new Error("sign() legacy options not supported");const{lowS:q,prehash:F,extraEntropy:H}=validateSigOpts(k,C);P=Y(P,F);const D=ne(P),G=_normFnElement(w,O),W=[he(G),he(D)];if(H!=null&&H!==!1){const le=H===!0?y(T.secretKey):H;W.push(ensureBytes$1("extraEntropy",le))}const K=concatBytes$2(...W),Z=D;function ae(le){const te=z(le);if(!w.isValidNot0(te))return;const ce=w.inv(te),ge=g.BASE.multiply(te).toAffine(),Ee=w.create(ge.x);if(Ee===_0n$5)return;const pe=w.create(ce*w.create(Z+Ee*G));if(pe===_0n$5)return;let de=(ge.x===Ee?0:2)|Number(ge.y&_1n$6),me=pe;return q&&L(pe)&&(me=w.neg(pe),de^=1),new U(Ee,me,de)}return{seed:K,k2sig:ae}}function J(P,O,k={}){P=ensureBytes$1("message",P);const{seed:q,k2sig:F}=X(P,O,k);return createHmacDrbg$1(u.outputLen,w.BYTES,v)(q,F)}function j(P){let O;const k=typeof P=="string"||isBytes$3(P),q=!k&&P!==null&&typeof P=="object"&&typeof P.r=="bigint"&&typeof P.s=="bigint";if(!k&&!q)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(q)O=new U(P.r,P.s);else if(k){try{O=U.fromBytes(ensureBytes$1("sig",P),"der")}catch(F){if(!(F instanceof DER$1.Err))throw F}if(!O)try{O=U.fromBytes(ensureBytes$1("sig",P),"compact")}catch{return!1}}return O||!1}function M(P,O,k,q={}){const{lowS:F,prehash:H,format:D}=validateSigOpts(q,C);if(k=ensureBytes$1("publicKey",k),O=Y(ensureBytes$1("message",O),H),"strict"in q)throw new Error("options.strict was renamed to lowS");const G=D===void 0?j(P):U.fromBytes(ensureBytes$1("sig",P),D);if(G===!1)return!1;try{const W=g.fromBytes(k);if(F&&G.hasHighS())return!1;const{r:K,s:Z}=G,ae=ne(O),le=w.inv(Z),te=w.create(ae*le),ce=w.create(K*le),ge=g.BASE.multiplyUnsafe(te).add(W.multiplyUnsafe(ce));return ge.is0()?!1:w.create(ge.x)===K}catch{return!1}}function N(P,O,k={}){const{prehash:q}=validateSigOpts(k,C);return O=Y(O,q),U.fromBytes(P,"recovered").recoverPublicKey(O).toBytes()}return Object.freeze({keygen:S,getPublicKey:A,getSharedSecret:R,utils:x,lengths:T,Point:g,sign:J,verify:M,recoverPublicKey:N,Signature:U,hash:u})}function _weierstrass_legacy_opts_to_new(g){const u={a:g.a,b:g.b,p:g.Fp.ORDER,n:g.n,h:g.h,Gx:g.Gx,Gy:g.Gy},h=g.Fp;let y=g.allowedPrivateKeyLengths?Array.from(new Set(g.allowedPrivateKeyLengths.map(w=>Math.ceil(w/2)))):void 0;const v=Field$1(u.n,{BITS:g.nBitLength,allowedLengths:y,modFromBytes:g.wrapPrivateKey}),b={Fp:h,Fn:v,allowInfinityPoint:g.allowInfinityPoint,endo:g.endo,isTorsionFree:g.isTorsionFree,clearCofactor:g.clearCofactor,fromBytes:g.fromBytes,toBytes:g.toBytes};return{CURVE:u,curveOpts:b}}function _ecdsa_legacy_opts_to_new(g){const{CURVE:u,curveOpts:h}=_weierstrass_legacy_opts_to_new(g),y={hmac:g.hmac,randomBytes:g.randomBytes,lowS:g.lowS,bits2int:g.bits2int,bits2int_modN:g.bits2int_modN};return{CURVE:u,curveOpts:h,hash:g.hash,ecdsaOpts:y}}function _ecdsa_new_output_to_legacy(g,u){const h=u.Point;return Object.assign({},u,{ProjectivePoint:h,CURVE:Object.assign({},g,nLength$1(h.Fn.ORDER,h.Fn.BITS))})}function weierstrass$1(g){const{CURVE:u,curveOpts:h,hash:y,ecdsaOpts:v}=_ecdsa_legacy_opts_to_new(g),b=weierstrassN(u,h),w=ecdsa(b,y,v);return _ecdsa_new_output_to_legacy(g,w)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function createCurve$1(g,u){const h=y=>weierstrass$1({...g,hash:y});return{...h(u),create:h}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1_CURVE={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},secp256k1_ENDO={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},_2n$4=BigInt(2);function sqrtMod$1(g){const u=secp256k1_CURVE.p,h=BigInt(3),y=BigInt(6),v=BigInt(11),b=BigInt(22),w=BigInt(23),E=BigInt(44),_=BigInt(88),S=g*g*g%u,A=S*S*g%u,R=pow2$1(A,h,u)*A%u,x=pow2$1(R,h,u)*A%u,T=pow2$1(x,_2n$4,u)*S%u,C=pow2$1(T,v,u)*T%u,I=pow2$1(C,b,u)*C%u,L=pow2$1(I,E,u)*I%u,$=pow2$1(L,_,u)*L%u,B=pow2$1($,E,u)*I%u,U=pow2$1(B,h,u)*A%u,z=pow2$1(U,w,u)*C%u,ne=pow2$1(z,y,u)*S%u,ue=pow2$1(ne,_2n$4,u);if(!Fpk1.eql(Fpk1.sqr(ue),g))throw new Error("Cannot find square root");return ue}const Fpk1=Field$1(secp256k1_CURVE.p,{sqrt:sqrtMod$1}),secp256k1$2=createCurve$1({...secp256k1_CURVE,Fp:Fpk1,lowS:!0,endo:secp256k1_ENDO},sha256$5);ed25519.utils.randomPrivateKey;const generateKeypair=()=>{const g=ed25519.utils.randomPrivateKey(),u=getPublicKey(g),h=new Uint8Array(64);return h.set(g),h.set(u,32),{publicKey:u,secretKey:h}},getPublicKey=ed25519.getPublicKey;function isOnCurve(g){try{return ed25519.ExtendedPoint.fromHex(g),!0}catch{return!1}}const sign$3=(g,u)=>ed25519.sign(g,u.slice(0,32));ed25519.verify;const toBuffer$1=g=>Buffer$1.isBuffer(g)?g:g instanceof Uint8Array?Buffer$1.from(g.buffer,g.byteOffset,g.byteLength):Buffer$1.from(g);class Struct{constructor(u){Object.assign(this,u)}encode(){return Buffer$1.from(libExports.serialize(SOLANA_SCHEMA,this))}static decode(u){return libExports.deserialize(SOLANA_SCHEMA,this,u)}static decodeUnchecked(u){return libExports.deserializeUnchecked(SOLANA_SCHEMA,this,u)}}const SOLANA_SCHEMA=new Map;var _PublicKey;const MAX_SEED_LENGTH=32,PUBLIC_KEY_LENGTH=32;function isPublicKeyData(g){return g._bn!==void 0}let uniquePublicKeyCounter=1,PublicKey$1=class Xt extends Struct{constructor(u){if(super({}),this._bn=void 0,isPublicKeyData(u))this._bn=u._bn;else{if(typeof u=="string"){const h=bs58$2.decode(u);if(h.length!=PUBLIC_KEY_LENGTH)throw new Error("Invalid public key input");this._bn=new BN(h)}else this._bn=new BN(u);if(this._bn.byteLength()>PUBLIC_KEY_LENGTH)throw new Error("Invalid public key input")}}static unique(){const u=new Xt(uniquePublicKeyCounter);return uniquePublicKeyCounter+=1,new Xt(u.toBuffer())}equals(u){return this._bn.eq(u._bn)}toBase58(){return bs58$2.encode(this.toBytes())}toJSON(){return this.toBase58()}toBytes(){const u=this.toBuffer();return new Uint8Array(u.buffer,u.byteOffset,u.byteLength)}toBuffer(){const u=this._bn.toArrayLike(Buffer$1);if(u.length===PUBLIC_KEY_LENGTH)return u;const h=Buffer$1.alloc(32);return u.copy(h,32-u.length),h}get[Symbol.toStringTag](){return`PublicKey(${this.toString()})`}toString(){return this.toBase58()}static async createWithSeed(u,h,y){const v=Buffer$1.concat([u.toBuffer(),Buffer$1.from(h),y.toBuffer()]),b=sha256$4(v);return new Xt(b)}static createProgramAddressSync(u,h){let y=Buffer$1.alloc(0);u.forEach(function(b){if(b.length>MAX_SEED_LENGTH)throw new TypeError("Max seed length exceeded");y=Buffer$1.concat([y,toBuffer$1(b)])}),y=Buffer$1.concat([y,h.toBuffer(),Buffer$1.from("ProgramDerivedAddress")]);const v=sha256$4(y);if(isOnCurve(v))throw new Error("Invalid seeds, address must fall off the curve");return new Xt(v)}static async createProgramAddress(u,h){return this.createProgramAddressSync(u,h)}static findProgramAddressSync(u,h){let y=255,v;for(;y!=0;){try{const b=u.concat(Buffer$1.from([y]));v=this.createProgramAddressSync(b,h)}catch(b){if(b instanceof TypeError)throw b;y--;continue}return[v,y]}throw new Error("Unable to find a viable program address nonce")}static async findProgramAddress(u,h){return this.findProgramAddressSync(u,h)}static isOnCurve(u){const h=new Xt(u);return isOnCurve(h.toBytes())}};_PublicKey=PublicKey$1;PublicKey$1.default=new _PublicKey("11111111111111111111111111111111");SOLANA_SCHEMA.set(PublicKey$1,{kind:"struct",fields:[["_bn","u256"]]});new PublicKey$1("BPFLoader1111111111111111111111111111111111");const PACKET_DATA_SIZE=1232,VERSION_PREFIX_MASK=127,SIGNATURE_LENGTH_IN_BYTES=64;class MessageAccountKeys{constructor(u,h){this.staticAccountKeys=void 0,this.accountKeysFromLookups=void 0,this.staticAccountKeys=u,this.accountKeysFromLookups=h}keySegments(){const u=[this.staticAccountKeys];return this.accountKeysFromLookups&&(u.push(this.accountKeysFromLookups.writable),u.push(this.accountKeysFromLookups.readonly)),u}get(u){for(const h of this.keySegments()){if(u<h.length)return h[u];u-=h.length}}get length(){return this.keySegments().flat().length}compileInstructions(u){if(this.length>256)throw new Error("Account index overflow encountered during compilation");const y=new Map;this.keySegments().flat().forEach((b,w)=>{y.set(b.toBase58(),w)});const v=b=>{const w=y.get(b.toBase58());if(w===void 0)throw new Error("Encountered an unknown instruction account key during compilation");return w};return u.map(b=>({programIdIndex:v(b.programId),accountKeyIndexes:b.keys.map(w=>v(w.pubkey)),data:b.data}))}}const publicKey=(g="publicKey")=>LayoutExports.blob(32,g),signature$2=(g="signature")=>LayoutExports.blob(64,g),rustString=(g="string")=>{const u=LayoutExports.struct([LayoutExports.u32("length"),LayoutExports.u32("lengthPadding"),LayoutExports.blob(LayoutExports.offset(LayoutExports.u32(),-8),"chars")],g),h=u.decode.bind(u),y=u.encode.bind(u),v=u;return v.decode=(b,w)=>h(b,w).chars.toString(),v.encode=(b,w,E)=>{const _={chars:Buffer$1.from(b,"utf8")};return y(_,w,E)},v.alloc=b=>LayoutExports.u32().span+LayoutExports.u32().span+Buffer$1.from(b,"utf8").length,v},authorized=(g="authorized")=>LayoutExports.struct([publicKey("staker"),publicKey("withdrawer")],g),lockup=(g="lockup")=>LayoutExports.struct([LayoutExports.ns64("unixTimestamp"),LayoutExports.ns64("epoch"),publicKey("custodian")],g),voteInit=(g="voteInit")=>LayoutExports.struct([publicKey("nodePubkey"),publicKey("authorizedVoter"),publicKey("authorizedWithdrawer"),LayoutExports.u8("commission")],g),voteAuthorizeWithSeedArgs=(g="voteAuthorizeWithSeedArgs")=>LayoutExports.struct([LayoutExports.u32("voteAuthorizationType"),publicKey("currentAuthorityDerivedKeyOwnerPubkey"),rustString("currentAuthorityDerivedKeySeed"),publicKey("newAuthorized")],g);function decodeLength(g){let u=0,h=0;for(;;){let y=g.shift();if(u|=(y&127)<<h*7,h+=1,(y&128)===0)break}return u}function encodeLength$1(g,u){let h=u;for(;;){let y=h&127;if(h>>=7,h==0){g.push(y);break}else y|=128,g.push(y)}}function assert$2(g,u){if(!g)throw new Error(u||"Assertion failed")}class CompiledKeys{constructor(u,h){this.payer=void 0,this.keyMetaMap=void 0,this.payer=u,this.keyMetaMap=h}static compile(u,h){const y=new Map,v=w=>{const E=w.toBase58();let _=y.get(E);return _===void 0&&(_={isSigner:!1,isWritable:!1,isInvoked:!1},y.set(E,_)),_},b=v(h);b.isSigner=!0,b.isWritable=!0;for(const w of u){v(w.programId).isInvoked=!0;for(const E of w.keys){const _=v(E.pubkey);_.isSigner||=E.isSigner,_.isWritable||=E.isWritable}}return new CompiledKeys(h,y)}getMessageComponents(){const u=[...this.keyMetaMap.entries()];assert$2(u.length<=256,"Max static account keys length exceeded");const h=u.filter(([,_])=>_.isSigner&&_.isWritable),y=u.filter(([,_])=>_.isSigner&&!_.isWritable),v=u.filter(([,_])=>!_.isSigner&&_.isWritable),b=u.filter(([,_])=>!_.isSigner&&!_.isWritable),w={numRequiredSignatures:h.length+y.length,numReadonlySignedAccounts:y.length,numReadonlyUnsignedAccounts:b.length};{assert$2(h.length>0,"Expected at least one writable signer key");const[_]=h[0];assert$2(_===this.payer.toBase58(),"Expected first writable signer key to be the fee payer")}const E=[...h.map(([_])=>new PublicKey$1(_)),...y.map(([_])=>new PublicKey$1(_)),...v.map(([_])=>new PublicKey$1(_)),...b.map(([_])=>new PublicKey$1(_))];return[w,E]}extractTableLookup(u){const[h,y]=this.drainKeysFoundInLookupTable(u.state.addresses,w=>!w.isSigner&&!w.isInvoked&&w.isWritable),[v,b]=this.drainKeysFoundInLookupTable(u.state.addresses,w=>!w.isSigner&&!w.isInvoked&&!w.isWritable);if(!(h.length===0&&v.length===0))return[{accountKey:u.key,writableIndexes:h,readonlyIndexes:v},{writable:y,readonly:b}]}drainKeysFoundInLookupTable(u,h){const y=new Array,v=new Array;for(const[b,w]of this.keyMetaMap.entries())if(h(w)){const E=new PublicKey$1(b),_=u.findIndex(S=>S.equals(E));_>=0&&(assert$2(_<256,"Max lookup table index exceeded"),y.push(_),v.push(E),this.keyMetaMap.delete(b))}return[y,v]}}const END_OF_BUFFER_ERROR_MESSAGE="Reached end of buffer unexpectedly";function guardedShift(g){if(g.length===0)throw new Error(END_OF_BUFFER_ERROR_MESSAGE);return g.shift()}function guardedSplice(g,...u){const[h]=u;if(u.length===2?h+(u[1]??0)>g.length:h>=g.length)throw new Error(END_OF_BUFFER_ERROR_MESSAGE);return g.splice(...u)}let Message$2=class Jt{constructor(u){this.header=void 0,this.accountKeys=void 0,this.recentBlockhash=void 0,this.instructions=void 0,this.indexToProgramIds=new Map,this.header=u.header,this.accountKeys=u.accountKeys.map(h=>new PublicKey$1(h)),this.recentBlockhash=u.recentBlockhash,this.instructions=u.instructions,this.instructions.forEach(h=>this.indexToProgramIds.set(h.programIdIndex,this.accountKeys[h.programIdIndex]))}get version(){return"legacy"}get staticAccountKeys(){return this.accountKeys}get compiledInstructions(){return this.instructions.map(u=>({programIdIndex:u.programIdIndex,accountKeyIndexes:u.accounts,data:bs58$2.decode(u.data)}))}get addressTableLookups(){return[]}getAccountKeys(){return new MessageAccountKeys(this.staticAccountKeys)}static compile(u){const h=CompiledKeys.compile(u.instructions,u.payerKey),[y,v]=h.getMessageComponents(),w=new MessageAccountKeys(v).compileInstructions(u.instructions).map(E=>({programIdIndex:E.programIdIndex,accounts:E.accountKeyIndexes,data:bs58$2.encode(E.data)}));return new Jt({header:y,accountKeys:v,recentBlockhash:u.recentBlockhash,instructions:w})}isAccountSigner(u){return u<this.header.numRequiredSignatures}isAccountWritable(u){const h=this.header.numRequiredSignatures;if(u>=this.header.numRequiredSignatures){const y=u-h,b=this.accountKeys.length-h-this.header.numReadonlyUnsignedAccounts;return y<b}else{const y=h-this.header.numReadonlySignedAccounts;return u<y}}isProgramId(u){return this.indexToProgramIds.has(u)}programIds(){return[...this.indexToProgramIds.values()]}nonProgramIds(){return this.accountKeys.filter((u,h)=>!this.isProgramId(h))}serialize(){const u=this.accountKeys.length;let h=[];encodeLength$1(h,u);const y=this.instructions.map(R=>{const{accounts:x,programIdIndex:T}=R,C=Array.from(bs58$2.decode(R.data));let I=[];encodeLength$1(I,x.length);let L=[];return encodeLength$1(L,C.length),{programIdIndex:T,keyIndicesCount:Buffer$1.from(I),keyIndices:x,dataLength:Buffer$1.from(L),data:C}});let v=[];encodeLength$1(v,y.length);let b=Buffer$1.alloc(PACKET_DATA_SIZE);Buffer$1.from(v).copy(b);let w=v.length;y.forEach(R=>{const T=LayoutExports.struct([LayoutExports.u8("programIdIndex"),LayoutExports.blob(R.keyIndicesCount.length,"keyIndicesCount"),LayoutExports.seq(LayoutExports.u8("keyIndex"),R.keyIndices.length,"keyIndices"),LayoutExports.blob(R.dataLength.length,"dataLength"),LayoutExports.seq(LayoutExports.u8("userdatum"),R.data.length,"data")]).encode(R,b,w);w+=T}),b=b.slice(0,w);const E=LayoutExports.struct([LayoutExports.blob(1,"numRequiredSignatures"),LayoutExports.blob(1,"numReadonlySignedAccounts"),LayoutExports.blob(1,"numReadonlyUnsignedAccounts"),LayoutExports.blob(h.length,"keyCount"),LayoutExports.seq(publicKey("key"),u,"keys"),publicKey("recentBlockhash")]),_={numRequiredSignatures:Buffer$1.from([this.header.numRequiredSignatures]),numReadonlySignedAccounts:Buffer$1.from([this.header.numReadonlySignedAccounts]),numReadonlyUnsignedAccounts:Buffer$1.from([this.header.numReadonlyUnsignedAccounts]),keyCount:Buffer$1.from(h),keys:this.accountKeys.map(R=>toBuffer$1(R.toBytes())),recentBlockhash:bs58$2.decode(this.recentBlockhash)};let S=Buffer$1.alloc(2048);const A=E.encode(_,S);return b.copy(S,A),S.slice(0,A+b.length)}static from(u){let h=[...u];const y=guardedShift(h);if(y!==(y&VERSION_PREFIX_MASK))throw new Error("Versioned messages must be deserialized with VersionedMessage.deserialize()");const v=guardedShift(h),b=guardedShift(h),w=decodeLength(h);let E=[];for(let x=0;x<w;x++){const T=guardedSplice(h,0,PUBLIC_KEY_LENGTH);E.push(new PublicKey$1(Buffer$1.from(T)))}const _=guardedSplice(h,0,PUBLIC_KEY_LENGTH),S=decodeLength(h);let A=[];for(let x=0;x<S;x++){const T=guardedShift(h),C=decodeLength(h),I=guardedSplice(h,0,C),L=decodeLength(h),$=guardedSplice(h,0,L),B=bs58$2.encode(Buffer$1.from($));A.push({programIdIndex:T,accounts:I,data:B})}const R={header:{numRequiredSignatures:y,numReadonlySignedAccounts:v,numReadonlyUnsignedAccounts:b},recentBlockhash:bs58$2.encode(Buffer$1.from(_)),accountKeys:E,instructions:A};return new Jt(R)}};class MessageV0{constructor(u){this.header=void 0,this.staticAccountKeys=void 0,this.recentBlockhash=void 0,this.compiledInstructions=void 0,this.addressTableLookups=void 0,this.header=u.header,this.staticAccountKeys=u.staticAccountKeys,this.recentBlockhash=u.recentBlockhash,this.compiledInstructions=u.compiledInstructions,this.addressTableLookups=u.addressTableLookups}get version(){return 0}get numAccountKeysFromLookups(){let u=0;for(const h of this.addressTableLookups)u+=h.readonlyIndexes.length+h.writableIndexes.length;return u}getAccountKeys(u){let h;if(u&&"accountKeysFromLookups"in u&&u.accountKeysFromLookups){if(this.numAccountKeysFromLookups!=u.accountKeysFromLookups.writable.length+u.accountKeysFromLookups.readonly.length)throw new Error("Failed to get account keys because of a mismatch in the number of account keys from lookups");h=u.accountKeysFromLookups}else if(u&&"addressLookupTableAccounts"in u&&u.addressLookupTableAccounts)h=this.resolveAddressTableLookups(u.addressLookupTableAccounts);else if(this.addressTableLookups.length>0)throw new Error("Failed to get account keys because address table lookups were not resolved");return new MessageAccountKeys(this.staticAccountKeys,h)}isAccountSigner(u){return u<this.header.numRequiredSignatures}isAccountWritable(u){const h=this.header.numRequiredSignatures,y=this.staticAccountKeys.length;if(u>=y){const v=u-y,b=this.addressTableLookups.reduce((w,E)=>w+E.writableIndexes.length,0);return v<b}else if(u>=this.header.numRequiredSignatures){const v=u-h,w=y-h-this.header.numReadonlyUnsignedAccounts;return v<w}else{const v=h-this.header.numReadonlySignedAccounts;return u<v}}resolveAddressTableLookups(u){const h={writable:[],readonly:[]};for(const y of this.addressTableLookups){const v=u.find(b=>b.key.equals(y.accountKey));if(!v)throw new Error(`Failed to find address lookup table account for table key ${y.accountKey.toBase58()}`);for(const b of y.writableIndexes)if(b<v.state.addresses.length)h.writable.push(v.state.addresses[b]);else throw new Error(`Failed to find address for index ${b} in address lookup table ${y.accountKey.toBase58()}`);for(const b of y.readonlyIndexes)if(b<v.state.addresses.length)h.readonly.push(v.state.addresses[b]);else throw new Error(`Failed to find address for index ${b} in address lookup table ${y.accountKey.toBase58()}`)}return h}static compile(u){const h=CompiledKeys.compile(u.instructions,u.payerKey),y=new Array,v={writable:new Array,readonly:new Array},b=u.addressLookupTableAccounts||[];for(const A of b){const R=h.extractTableLookup(A);if(R!==void 0){const[x,{writable:T,readonly:C}]=R;y.push(x),v.writable.push(...T),v.readonly.push(...C)}}const[w,E]=h.getMessageComponents(),S=new MessageAccountKeys(E,v).compileInstructions(u.instructions);return new MessageV0({header:w,staticAccountKeys:E,recentBlockhash:u.recentBlockhash,compiledInstructions:S,addressTableLookups:y})}serialize(){const u=Array();encodeLength$1(u,this.staticAccountKeys.length);const h=this.serializeInstructions(),y=Array();encodeLength$1(y,this.compiledInstructions.length);const v=this.serializeAddressTableLookups(),b=Array();encodeLength$1(b,this.addressTableLookups.length);const w=LayoutExports.struct([LayoutExports.u8("prefix"),LayoutExports.struct([LayoutExports.u8("numRequiredSignatures"),LayoutExports.u8("numReadonlySignedAccounts"),LayoutExports.u8("numReadonlyUnsignedAccounts")],"header"),LayoutExports.blob(u.length,"staticAccountKeysLength"),LayoutExports.seq(publicKey(),this.staticAccountKeys.length,"staticAccountKeys"),publicKey("recentBlockhash"),LayoutExports.blob(y.length,"instructionsLength"),LayoutExports.blob(h.length,"serializedInstructions"),LayoutExports.blob(b.length,"addressTableLookupsLength"),LayoutExports.blob(v.length,"serializedAddressTableLookups")]),E=new Uint8Array(PACKET_DATA_SIZE),S=w.encode({prefix:128,header:this.header,staticAccountKeysLength:new Uint8Array(u),staticAccountKeys:this.staticAccountKeys.map(A=>A.toBytes()),recentBlockhash:bs58$2.decode(this.recentBlockhash),instructionsLength:new Uint8Array(y),serializedInstructions:h,addressTableLookupsLength:new Uint8Array(b),serializedAddressTableLookups:v},E);return E.slice(0,S)}serializeInstructions(){let u=0;const h=new Uint8Array(PACKET_DATA_SIZE);for(const y of this.compiledInstructions){const v=Array();encodeLength$1(v,y.accountKeyIndexes.length);const b=Array();encodeLength$1(b,y.data.length);const w=LayoutExports.struct([LayoutExports.u8("programIdIndex"),LayoutExports.blob(v.length,"encodedAccountKeyIndexesLength"),LayoutExports.seq(LayoutExports.u8(),y.accountKeyIndexes.length,"accountKeyIndexes"),LayoutExports.blob(b.length,"encodedDataLength"),LayoutExports.blob(y.data.length,"data")]);u+=w.encode({programIdIndex:y.programIdIndex,encodedAccountKeyIndexesLength:new Uint8Array(v),accountKeyIndexes:y.accountKeyIndexes,encodedDataLength:new Uint8Array(b),data:y.data},h,u)}return h.slice(0,u)}serializeAddressTableLookups(){let u=0;const h=new Uint8Array(PACKET_DATA_SIZE);for(const y of this.addressTableLookups){const v=Array();encodeLength$1(v,y.writableIndexes.length);const b=Array();encodeLength$1(b,y.readonlyIndexes.length);const w=LayoutExports.struct([publicKey("accountKey"),LayoutExports.blob(v.length,"encodedWritableIndexesLength"),LayoutExports.seq(LayoutExports.u8(),y.writableIndexes.length,"writableIndexes"),LayoutExports.blob(b.length,"encodedReadonlyIndexesLength"),LayoutExports.seq(LayoutExports.u8(),y.readonlyIndexes.length,"readonlyIndexes")]);u+=w.encode({accountKey:y.accountKey.toBytes(),encodedWritableIndexesLength:new Uint8Array(v),writableIndexes:y.writableIndexes,encodedReadonlyIndexesLength:new Uint8Array(b),readonlyIndexes:y.readonlyIndexes},h,u)}return h.slice(0,u)}static deserialize(u){let h=[...u];const y=guardedShift(h),v=y&VERSION_PREFIX_MASK;assert$2(y!==v,"Expected versioned message but received legacy message");const b=v;assert$2(b===0,`Expected versioned message with version 0 but found version ${b}`);const w={numRequiredSignatures:guardedShift(h),numReadonlySignedAccounts:guardedShift(h),numReadonlyUnsignedAccounts:guardedShift(h)},E=[],_=decodeLength(h);for(let C=0;C<_;C++)E.push(new PublicKey$1(guardedSplice(h,0,PUBLIC_KEY_LENGTH)));const S=bs58$2.encode(guardedSplice(h,0,PUBLIC_KEY_LENGTH)),A=decodeLength(h),R=[];for(let C=0;C<A;C++){const I=guardedShift(h),L=decodeLength(h),$=guardedSplice(h,0,L),B=decodeLength(h),U=new Uint8Array(guardedSplice(h,0,B));R.push({programIdIndex:I,accountKeyIndexes:$,data:U})}const x=decodeLength(h),T=[];for(let C=0;C<x;C++){const I=new PublicKey$1(guardedSplice(h,0,PUBLIC_KEY_LENGTH)),L=decodeLength(h),$=guardedSplice(h,0,L),B=decodeLength(h),U=guardedSplice(h,0,B);T.push({accountKey:I,writableIndexes:$,readonlyIndexes:U})}return new MessageV0({header:w,staticAccountKeys:E,recentBlockhash:S,compiledInstructions:R,addressTableLookups:T})}}const VersionedMessage={deserializeMessageVersion(g){const u=g[0],h=u&VERSION_PREFIX_MASK;return h===u?"legacy":h},deserialize:g=>{const u=VersionedMessage.deserializeMessageVersion(g);if(u==="legacy")return Message$2.from(g);if(u===0)return MessageV0.deserialize(g);throw new Error(`Transaction message version ${u} deserialization is not supported`)}};Buffer$1.alloc(SIGNATURE_LENGTH_IN_BYTES).fill(0);class VersionedTransaction{get version(){return this.message.version}constructor(u,h){if(this.signatures=void 0,this.message=void 0,h!==void 0)assert$2(h.length===u.header.numRequiredSignatures,"Expected signatures length to be equal to the number of required signatures"),this.signatures=h;else{const y=[];for(let v=0;v<u.header.numRequiredSignatures;v++)y.push(new Uint8Array(SIGNATURE_LENGTH_IN_BYTES));this.signatures=y}this.message=u}serialize(){const u=this.message.serialize(),h=Array();encodeLength$1(h,this.signatures.length);const y=LayoutExports.struct([LayoutExports.blob(h.length,"encodedSignaturesLength"),LayoutExports.seq(signature$2(),this.signatures.length,"signatures"),LayoutExports.blob(u.length,"serializedMessage")]),v=new Uint8Array(2048),b=y.encode({encodedSignaturesLength:new Uint8Array(h),signatures:this.signatures,serializedMessage:u},v);return v.slice(0,b)}static deserialize(u){let h=[...u];const y=[],v=decodeLength(h);for(let w=0;w<v;w++)y.push(new Uint8Array(guardedSplice(h,0,SIGNATURE_LENGTH_IN_BYTES)));const b=VersionedMessage.deserialize(new Uint8Array(h));return new VersionedTransaction(b,y)}sign(u){const h=this.message.serialize(),y=this.message.staticAccountKeys.slice(0,this.message.header.numRequiredSignatures);for(const v of u){const b=y.findIndex(w=>w.equals(v.publicKey));assert$2(b>=0,`Cannot sign with non signer key ${v.publicKey.toBase58()}`),this.signatures[b]=sign$3(h,v.secretKey)}}addSignature(u,h){assert$2(h.byteLength===64,"Signature must be 64 bytes long");const v=this.message.staticAccountKeys.slice(0,this.message.header.numRequiredSignatures).findIndex(b=>b.equals(u));assert$2(v>=0,`Can not add signature; \`${u.toBase58()}\` is not required to sign this transaction`),this.signatures[v]=h}}new PublicKey$1("SysvarC1ock11111111111111111111111111111111");new PublicKey$1("SysvarEpochSchedu1e111111111111111111111111");new PublicKey$1("Sysvar1nstructions1111111111111111111111111");new PublicKey$1("SysvarRecentB1ockHashes11111111111111111111");new PublicKey$1("SysvarRent111111111111111111111111111111111");new PublicKey$1("SysvarRewards111111111111111111111111111111");new PublicKey$1("SysvarS1otHashes111111111111111111111111111");new PublicKey$1("SysvarS1otHistory11111111111111111111111111");new PublicKey$1("SysvarStakeHistory1111111111111111111111111");const FeeCalculatorLayout=LayoutExports.nu64("lamportsPerSignature"),NonceAccountLayout=LayoutExports.struct([LayoutExports.u32("version"),LayoutExports.u32("state"),publicKey("authorizedPubkey"),publicKey("nonce"),LayoutExports.struct([FeeCalculatorLayout],"feeCalculator")]);NonceAccountLayout.span;function u64(g){const u=LayoutExports.blob(8,g),h=u.decode.bind(u),y=u.encode.bind(u),v=u,b=getU64Codec();return v.decode=(w,E)=>{const _=h(w,E);return b.decode(_)},v.encode=(w,E,_)=>{const S=b.encode(w);return y(S,E,_)},v}Object.freeze({Create:{index:0,layout:LayoutExports.struct([LayoutExports.u32("instruction"),LayoutExports.ns64("lamports"),LayoutExports.ns64("space"),publicKey("programId")])},Assign:{index:1,layout:LayoutExports.struct([LayoutExports.u32("instruction"),publicKey("programId")])},Transfer:{index:2,layout:LayoutExports.struct([LayoutExports.u32("instruction"),u64("lamports")])},CreateWithSeed:{index:3,layout:LayoutExports.struct([LayoutExports.u32("instruction"),publicKey("base"),rustString("seed"),LayoutExports.ns64("lamports"),LayoutExports.ns64("space"),publicKey("programId")])},AdvanceNonceAccount:{index:4,layout:LayoutExports.struct([LayoutExports.u32("instruction")])},WithdrawNonceAccount:{index:5,layout:LayoutExports.struct([LayoutExports.u32("instruction"),LayoutExports.ns64("lamports")])},InitializeNonceAccount:{index:6,layout:LayoutExports.struct([LayoutExports.u32("instruction"),publicKey("authorized")])},AuthorizeNonceAccount:{index:7,layout:LayoutExports.struct([LayoutExports.u32("instruction"),publicKey("authorized")])},Allocate:{index:8,layout:LayoutExports.struct([LayoutExports.u32("instruction"),LayoutExports.ns64("space")])},AllocateWithSeed:{index:9,layout:LayoutExports.struct([LayoutExports.u32("instruction"),publicKey("base"),rustString("seed"),LayoutExports.ns64("space"),publicKey("programId")])},AssignWithSeed:{index:10,layout:LayoutExports.struct([LayoutExports.u32("instruction"),publicKey("base"),rustString("seed"),publicKey("programId")])},TransferWithSeed:{index:11,layout:LayoutExports.struct([LayoutExports.u32("instruction"),u64("lamports"),rustString("seed"),publicKey("programId")])},UpgradeNonceAccount:{index:12,layout:LayoutExports.struct([LayoutExports.u32("instruction")])}});new PublicKey$1("11111111111111111111111111111111");new PublicKey$1("BPFLoader2111111111111111111111111111111111");LayoutExports.struct([LayoutExports.u32("typeIndex"),u64("deactivationSlot"),LayoutExports.nu64("lastExtendedSlot"),LayoutExports.u8("lastExtendedStartIndex"),LayoutExports.u8(),LayoutExports.seq(publicKey(),LayoutExports.offset(LayoutExports.u8(),-1),"authority")]);const PublicKeyFromString=coerce$1(instance(PublicKey$1),string$1(),g=>new PublicKey$1(g)),RawAccountDataResult=tuple([string$1(),literal("base64")]),BufferFromRawAccountData=coerce$1(instance(Buffer$1),RawAccountDataResult,g=>Buffer$1.from(g[0],"base64"));function createRpcResult(g){return union([type$1({jsonrpc:literal("2.0"),id:string$1(),result:g}),type$1({jsonrpc:literal("2.0"),id:string$1(),error:type$1({code:unknown(),message:string$1(),data:optional$1(any())})})])}const UnknownRpcResult=createRpcResult(unknown());function jsonRpcResult(g){return coerce$1(createRpcResult(g),UnknownRpcResult,u=>"error"in u?u:{...u,result:create$1(u.result,g)})}function jsonRpcResultAndContext(g){return jsonRpcResult(type$1({context:type$1({slot:number$1()}),value:g}))}function notificationResultAndContext(g){return type$1({context:type$1({slot:number$1()}),value:g})}const GetInflationGovernorResult=type$1({foundation:number$1(),foundationTerm:number$1(),initial:number$1(),taper:number$1(),terminal:number$1()});jsonRpcResult(array(nullable(type$1({epoch:number$1(),effectiveSlot:number$1(),amount:number$1(),postBalance:number$1(),commission:optional$1(nullable(number$1()))}))));const GetRecentPrioritizationFeesResult=array(type$1({slot:number$1(),prioritizationFee:number$1()})),GetInflationRateResult=type$1({total:number$1(),validator:number$1(),foundation:number$1(),epoch:number$1()}),GetEpochInfoResult=type$1({epoch:number$1(),slotIndex:number$1(),slotsInEpoch:number$1(),absoluteSlot:number$1(),blockHeight:optional$1(number$1()),transactionCount:optional$1(number$1())}),GetEpochScheduleResult=type$1({slotsPerEpoch:number$1(),leaderScheduleSlotOffset:number$1(),warmup:boolean(),firstNormalEpoch:number$1(),firstNormalSlot:number$1()}),GetLeaderScheduleResult=record(string$1(),array(number$1())),TransactionErrorResult=nullable(union([type$1({}),string$1()])),SignatureStatusResult=type$1({err:TransactionErrorResult}),SignatureReceivedResult=literal("receivedSignature");type$1({"solana-core":string$1(),"feature-set":optional$1(number$1())});const ParsedInstructionStruct=type$1({program:string$1(),programId:PublicKeyFromString,parsed:unknown()}),PartiallyDecodedInstructionStruct=type$1({programId:PublicKeyFromString,accounts:array(PublicKeyFromString),data:string$1()});jsonRpcResultAndContext(type$1({err:nullable(union([type$1({}),string$1()])),logs:nullable(array(string$1())),accounts:optional$1(nullable(array(nullable(type$1({executable:boolean(),owner:string$1(),lamports:number$1(),data:array(string$1()),rentEpoch:optional$1(number$1())}))))),unitsConsumed:optional$1(number$1()),returnData:optional$1(nullable(type$1({programId:string$1(),data:tuple([string$1(),literal("base64")])}))),innerInstructions:optional$1(nullable(array(type$1({index:number$1(),instructions:array(union([ParsedInstructionStruct,PartiallyDecodedInstructionStruct]))}))))}));jsonRpcResultAndContext(type$1({byIdentity:record(string$1(),array(number$1())),range:type$1({firstSlot:number$1(),lastSlot:number$1()})}));jsonRpcResult(GetInflationGovernorResult);jsonRpcResult(GetInflationRateResult);jsonRpcResult(GetRecentPrioritizationFeesResult);jsonRpcResult(GetEpochInfoResult);jsonRpcResult(GetEpochScheduleResult);jsonRpcResult(GetLeaderScheduleResult);jsonRpcResult(number$1());jsonRpcResultAndContext(type$1({total:number$1(),circulating:number$1(),nonCirculating:number$1(),nonCirculatingAccounts:array(PublicKeyFromString)}));const TokenAmountResult=type$1({amount:string$1(),uiAmount:nullable(number$1()),decimals:number$1(),uiAmountString:optional$1(string$1())});jsonRpcResultAndContext(array(type$1({address:PublicKeyFromString,amount:string$1(),uiAmount:nullable(number$1()),decimals:number$1(),uiAmountString:optional$1(string$1())})));jsonRpcResultAndContext(array(type$1({pubkey:PublicKeyFromString,account:type$1({executable:boolean(),owner:PublicKeyFromString,lamports:number$1(),data:BufferFromRawAccountData,rentEpoch:number$1()})})));const ParsedAccountDataResult=type$1({program:string$1(),parsed:unknown(),space:number$1()});jsonRpcResultAndContext(array(type$1({pubkey:PublicKeyFromString,account:type$1({executable:boolean(),owner:PublicKeyFromString,lamports:number$1(),data:ParsedAccountDataResult,rentEpoch:number$1()})})));jsonRpcResultAndContext(array(type$1({lamports:number$1(),address:PublicKeyFromString})));const AccountInfoResult=type$1({executable:boolean(),owner:PublicKeyFromString,lamports:number$1(),data:BufferFromRawAccountData,rentEpoch:number$1()});type$1({pubkey:PublicKeyFromString,account:AccountInfoResult});const ParsedOrRawAccountData=coerce$1(union([instance(Buffer$1),ParsedAccountDataResult]),union([RawAccountDataResult,ParsedAccountDataResult]),g=>Array.isArray(g)?create$1(g,BufferFromRawAccountData):g),ParsedAccountInfoResult=type$1({executable:boolean(),owner:PublicKeyFromString,lamports:number$1(),data:ParsedOrRawAccountData,rentEpoch:number$1()});type$1({pubkey:PublicKeyFromString,account:ParsedAccountInfoResult});type$1({state:union([literal("active"),literal("inactive"),literal("activating"),literal("deactivating")]),active:number$1(),inactive:number$1()});jsonRpcResult(array(type$1({signature:string$1(),slot:number$1(),err:TransactionErrorResult,memo:nullable(string$1()),blockTime:optional$1(nullable(number$1()))})));jsonRpcResult(array(type$1({signature:string$1(),slot:number$1(),err:TransactionErrorResult,memo:nullable(string$1()),blockTime:optional$1(nullable(number$1()))})));type$1({subscription:number$1(),result:notificationResultAndContext(AccountInfoResult)});const ProgramAccountInfoResult=type$1({pubkey:PublicKeyFromString,account:AccountInfoResult});type$1({subscription:number$1(),result:notificationResultAndContext(ProgramAccountInfoResult)});const SlotInfoResult=type$1({parent:number$1(),slot:number$1(),root:number$1()});type$1({subscription:number$1(),result:SlotInfoResult});const SlotUpdateResult=union([type$1({type:union([literal("firstShredReceived"),literal("completed"),literal("optimisticConfirmation"),literal("root")]),slot:number$1(),timestamp:number$1()}),type$1({type:literal("createdBank"),parent:number$1(),slot:number$1(),timestamp:number$1()}),type$1({type:literal("frozen"),slot:number$1(),timestamp:number$1(),stats:type$1({numTransactionEntries:number$1(),numSuccessfulTransactions:number$1(),numFailedTransactions:number$1(),maxTransactionsPerEntry:number$1()})}),type$1({type:literal("dead"),slot:number$1(),timestamp:number$1(),err:string$1()})]);type$1({subscription:number$1(),result:SlotUpdateResult});type$1({subscription:number$1(),result:notificationResultAndContext(union([SignatureStatusResult,SignatureReceivedResult]))});type$1({subscription:number$1(),result:number$1()});type$1({pubkey:string$1(),gossip:nullable(string$1()),tpu:nullable(string$1()),rpc:nullable(string$1()),version:nullable(string$1())});const VoteAccountInfoResult=type$1({votePubkey:string$1(),nodePubkey:string$1(),activatedStake:number$1(),epochVoteAccount:boolean(),epochCredits:array(tuple([number$1(),number$1(),number$1()])),commission:number$1(),lastVote:number$1(),rootSlot:nullable(number$1())});jsonRpcResult(type$1({current:array(VoteAccountInfoResult),delinquent:array(VoteAccountInfoResult)}));const ConfirmationStatus=union([literal("processed"),literal("confirmed"),literal("finalized")]),SignatureStatusResponse=type$1({slot:number$1(),confirmations:nullable(number$1()),err:TransactionErrorResult,confirmationStatus:optional$1(ConfirmationStatus)});jsonRpcResultAndContext(array(nullable(SignatureStatusResponse)));jsonRpcResult(number$1());const AddressTableLookupStruct=type$1({accountKey:PublicKeyFromString,writableIndexes:array(number$1()),readonlyIndexes:array(number$1())}),ConfirmedTransactionResult=type$1({signatures:array(string$1()),message:type$1({accountKeys:array(string$1()),header:type$1({numRequiredSignatures:number$1(),numReadonlySignedAccounts:number$1(),numReadonlyUnsignedAccounts:number$1()}),instructions:array(type$1({accounts:array(number$1()),data:string$1(),programIdIndex:number$1()})),recentBlockhash:string$1(),addressTableLookups:optional$1(array(AddressTableLookupStruct))})}),AnnotatedAccountKey=type$1({pubkey:PublicKeyFromString,signer:boolean(),writable:boolean(),source:optional$1(union([literal("transaction"),literal("lookupTable")]))}),ConfirmedTransactionAccountsModeResult=type$1({accountKeys:array(AnnotatedAccountKey),signatures:array(string$1())}),ParsedInstructionResult=type$1({parsed:unknown(),program:string$1(),programId:PublicKeyFromString}),RawInstructionResult=type$1({accounts:array(PublicKeyFromString),data:string$1(),programId:PublicKeyFromString}),InstructionResult=union([RawInstructionResult,ParsedInstructionResult]),UnknownInstructionResult=union([type$1({parsed:unknown(),program:string$1(),programId:string$1()}),type$1({accounts:array(string$1()),data:string$1(),programId:string$1()})]),ParsedOrRawInstruction=coerce$1(InstructionResult,UnknownInstructionResult,g=>"accounts"in g?create$1(g,RawInstructionResult):create$1(g,ParsedInstructionResult)),ParsedConfirmedTransactionResult=type$1({signatures:array(string$1()),message:type$1({accountKeys:array(AnnotatedAccountKey),instructions:array(ParsedOrRawInstruction),recentBlockhash:string$1(),addressTableLookups:optional$1(nullable(array(AddressTableLookupStruct)))})}),TokenBalanceResult=type$1({accountIndex:number$1(),mint:string$1(),owner:optional$1(string$1()),programId:optional$1(string$1()),uiTokenAmount:TokenAmountResult}),LoadedAddressesResult=type$1({writable:array(PublicKeyFromString),readonly:array(PublicKeyFromString)}),ConfirmedTransactionMetaResult=type$1({err:TransactionErrorResult,fee:number$1(),innerInstructions:optional$1(nullable(array(type$1({index:number$1(),instructions:array(type$1({accounts:array(number$1()),data:string$1(),programIdIndex:number$1()}))})))),preBalances:array(number$1()),postBalances:array(number$1()),logMessages:optional$1(nullable(array(string$1()))),preTokenBalances:optional$1(nullable(array(TokenBalanceResult))),postTokenBalances:optional$1(nullable(array(TokenBalanceResult))),loadedAddresses:optional$1(LoadedAddressesResult),computeUnitsConsumed:optional$1(number$1()),costUnits:optional$1(number$1())}),ParsedConfirmedTransactionMetaResult=type$1({err:TransactionErrorResult,fee:number$1(),innerInstructions:optional$1(nullable(array(type$1({index:number$1(),instructions:array(ParsedOrRawInstruction)})))),preBalances:array(number$1()),postBalances:array(number$1()),logMessages:optional$1(nullable(array(string$1()))),preTokenBalances:optional$1(nullable(array(TokenBalanceResult))),postTokenBalances:optional$1(nullable(array(TokenBalanceResult))),loadedAddresses:optional$1(LoadedAddressesResult),computeUnitsConsumed:optional$1(number$1()),costUnits:optional$1(number$1())}),TransactionVersionStruct=union([literal(0),literal("legacy")]),RewardsResult=type$1({pubkey:string$1(),lamports:number$1(),postBalance:nullable(number$1()),rewardType:nullable(string$1()),commission:optional$1(nullable(number$1()))});jsonRpcResult(nullable(type$1({blockhash:string$1(),previousBlockhash:string$1(),parentSlot:number$1(),transactions:array(type$1({transaction:ConfirmedTransactionResult,meta:nullable(ConfirmedTransactionMetaResult),version:optional$1(TransactionVersionStruct)})),rewards:optional$1(array(RewardsResult)),blockTime:nullable(number$1()),blockHeight:nullable(number$1())})));jsonRpcResult(nullable(type$1({blockhash:string$1(),previousBlockhash:string$1(),parentSlot:number$1(),rewards:optional$1(array(RewardsResult)),blockTime:nullable(number$1()),blockHeight:nullable(number$1())})));jsonRpcResult(nullable(type$1({blockhash:string$1(),previousBlockhash:string$1(),parentSlot:number$1(),transactions:array(type$1({transaction:ConfirmedTransactionAccountsModeResult,meta:nullable(ConfirmedTransactionMetaResult),version:optional$1(TransactionVersionStruct)})),rewards:optional$1(array(RewardsResult)),blockTime:nullable(number$1()),blockHeight:nullable(number$1())})));jsonRpcResult(nullable(type$1({blockhash:string$1(),previousBlockhash:string$1(),parentSlot:number$1(),transactions:array(type$1({transaction:ParsedConfirmedTransactionResult,meta:nullable(ParsedConfirmedTransactionMetaResult),version:optional$1(TransactionVersionStruct)})),rewards:optional$1(array(RewardsResult)),blockTime:nullable(number$1()),blockHeight:nullable(number$1())})));jsonRpcResult(nullable(type$1({blockhash:string$1(),previousBlockhash:string$1(),parentSlot:number$1(),transactions:array(type$1({transaction:ConfirmedTransactionAccountsModeResult,meta:nullable(ParsedConfirmedTransactionMetaResult),version:optional$1(TransactionVersionStruct)})),rewards:optional$1(array(RewardsResult)),blockTime:nullable(number$1()),blockHeight:nullable(number$1())})));jsonRpcResult(nullable(type$1({blockhash:string$1(),previousBlockhash:string$1(),parentSlot:number$1(),rewards:optional$1(array(RewardsResult)),blockTime:nullable(number$1()),blockHeight:nullable(number$1())})));jsonRpcResult(nullable(type$1({blockhash:string$1(),previousBlockhash:string$1(),parentSlot:number$1(),transactions:array(type$1({transaction:ConfirmedTransactionResult,meta:nullable(ConfirmedTransactionMetaResult)})),rewards:optional$1(array(RewardsResult)),blockTime:nullable(number$1())})));jsonRpcResult(nullable(type$1({blockhash:string$1(),previousBlockhash:string$1(),parentSlot:number$1(),signatures:array(string$1()),blockTime:nullable(number$1())})));jsonRpcResult(nullable(type$1({slot:number$1(),meta:nullable(ConfirmedTransactionMetaResult),blockTime:optional$1(nullable(number$1())),transaction:ConfirmedTransactionResult,version:optional$1(TransactionVersionStruct)})));jsonRpcResult(nullable(type$1({slot:number$1(),transaction:ParsedConfirmedTransactionResult,meta:nullable(ParsedConfirmedTransactionMetaResult),blockTime:optional$1(nullable(number$1())),version:optional$1(TransactionVersionStruct)})));jsonRpcResultAndContext(type$1({blockhash:string$1(),lastValidBlockHeight:number$1()}));jsonRpcResultAndContext(boolean());const PerfSampleResult=type$1({slot:number$1(),numTransactions:number$1(),numSlots:number$1(),samplePeriodSecs:number$1()});jsonRpcResult(array(PerfSampleResult));jsonRpcResultAndContext(nullable(type$1({feeCalculator:type$1({lamportsPerSignature:number$1()})})));jsonRpcResult(string$1());jsonRpcResult(string$1());const LogsResult=type$1({err:TransactionErrorResult,logs:array(string$1()),signature:string$1()});type$1({result:notificationResultAndContext(LogsResult),subscription:number$1()});class Keypair{constructor(u){this._keypair=void 0,this._keypair=u??generateKeypair()}static generate(){return new Keypair(generateKeypair())}static fromSecretKey(u,h){if(u.byteLength!==64)throw new Error("bad secret key size");const y=u.slice(32,64);if(!h||!h.skipValidation){const v=u.slice(0,32),b=getPublicKey(v);for(let w=0;w<32;w++)if(y[w]!==b[w])throw new Error("provided secretKey is invalid")}return new Keypair({publicKey:y,secretKey:u})}static fromSeed(u){const h=getPublicKey(u),y=new Uint8Array(64);return y.set(u),y.set(h,32),new Keypair({publicKey:h,secretKey:y})}get publicKey(){return new PublicKey$1(this._keypair.publicKey)}get secretKey(){return new Uint8Array(this._keypair.secretKey)}}Object.freeze({CreateLookupTable:{index:0,layout:LayoutExports.struct([LayoutExports.u32("instruction"),u64("recentSlot"),LayoutExports.u8("bumpSeed")])},FreezeLookupTable:{index:1,layout:LayoutExports.struct([LayoutExports.u32("instruction")])},ExtendLookupTable:{index:2,layout:LayoutExports.struct([LayoutExports.u32("instruction"),u64(),LayoutExports.seq(publicKey(),LayoutExports.offset(LayoutExports.u32(),-8),"addresses")])},DeactivateLookupTable:{index:3,layout:LayoutExports.struct([LayoutExports.u32("instruction")])},CloseLookupTable:{index:4,layout:LayoutExports.struct([LayoutExports.u32("instruction")])}});new PublicKey$1("AddressLookupTab1e1111111111111111111111111");Object.freeze({RequestUnits:{index:0,layout:LayoutExports.struct([LayoutExports.u8("instruction"),LayoutExports.u32("units"),LayoutExports.u32("additionalFee")])},RequestHeapFrame:{index:1,layout:LayoutExports.struct([LayoutExports.u8("instruction"),LayoutExports.u32("bytes")])},SetComputeUnitLimit:{index:2,layout:LayoutExports.struct([LayoutExports.u8("instruction"),LayoutExports.u32("units")])},SetComputeUnitPrice:{index:3,layout:LayoutExports.struct([LayoutExports.u8("instruction"),u64("microLamports")])}});new PublicKey$1("ComputeBudget111111111111111111111111111111");LayoutExports.struct([LayoutExports.u8("numSignatures"),LayoutExports.u8("padding"),LayoutExports.u16("signatureOffset"),LayoutExports.u16("signatureInstructionIndex"),LayoutExports.u16("publicKeyOffset"),LayoutExports.u16("publicKeyInstructionIndex"),LayoutExports.u16("messageDataOffset"),LayoutExports.u16("messageDataSize"),LayoutExports.u16("messageInstructionIndex")]);new PublicKey$1("Ed25519SigVerify111111111111111111111111111");secp256k1$2.utils.isValidPrivateKey;secp256k1$2.getPublicKey;LayoutExports.struct([LayoutExports.u8("numSignatures"),LayoutExports.u16("signatureOffset"),LayoutExports.u8("signatureInstructionIndex"),LayoutExports.u16("ethAddressOffset"),LayoutExports.u8("ethAddressInstructionIndex"),LayoutExports.u16("messageDataOffset"),LayoutExports.u16("messageDataSize"),LayoutExports.u8("messageInstructionIndex"),LayoutExports.blob(20,"ethAddress"),LayoutExports.blob(64,"signature"),LayoutExports.u8("recoveryId")]);new PublicKey$1("KeccakSecp256k11111111111111111111111111111");var _Lockup;new PublicKey$1("StakeConfig11111111111111111111111111111111");class Lockup{constructor(u,h,y){this.unixTimestamp=void 0,this.epoch=void 0,this.custodian=void 0,this.unixTimestamp=u,this.epoch=h,this.custodian=y}}_Lockup=Lockup;Lockup.default=new _Lockup(0,0,PublicKey$1.default);Object.freeze({Initialize:{index:0,layout:LayoutExports.struct([LayoutExports.u32("instruction"),authorized(),lockup()])},Authorize:{index:1,layout:LayoutExports.struct([LayoutExports.u32("instruction"),publicKey("newAuthorized"),LayoutExports.u32("stakeAuthorizationType")])},Delegate:{index:2,layout:LayoutExports.struct([LayoutExports.u32("instruction")])},Split:{index:3,layout:LayoutExports.struct([LayoutExports.u32("instruction"),LayoutExports.ns64("lamports")])},Withdraw:{index:4,layout:LayoutExports.struct([LayoutExports.u32("instruction"),LayoutExports.ns64("lamports")])},Deactivate:{index:5,layout:LayoutExports.struct([LayoutExports.u32("instruction")])},Merge:{index:7,layout:LayoutExports.struct([LayoutExports.u32("instruction")])},AuthorizeWithSeed:{index:8,layout:LayoutExports.struct([LayoutExports.u32("instruction"),publicKey("newAuthorized"),LayoutExports.u32("stakeAuthorizationType"),rustString("authoritySeed"),publicKey("authorityOwner")])}});new PublicKey$1("Stake11111111111111111111111111111111111111");Object.freeze({InitializeAccount:{index:0,layout:LayoutExports.struct([LayoutExports.u32("instruction"),voteInit()])},Authorize:{index:1,layout:LayoutExports.struct([LayoutExports.u32("instruction"),publicKey("newAuthorized"),LayoutExports.u32("voteAuthorizationType")])},Withdraw:{index:3,layout:LayoutExports.struct([LayoutExports.u32("instruction"),LayoutExports.ns64("lamports")])},UpdateValidatorIdentity:{index:4,layout:LayoutExports.struct([LayoutExports.u32("instruction")])},AuthorizeWithSeed:{index:10,layout:LayoutExports.struct([LayoutExports.u32("instruction"),voteAuthorizeWithSeedArgs()])}});new PublicKey$1("Vote111111111111111111111111111111111111111");new PublicKey$1("Va1idator1nfo111111111111111111111111111111");type$1({name:string$1(),website:optional$1(string$1()),details:optional$1(string$1()),iconUrl:optional$1(string$1()),keybaseUsername:optional$1(string$1())});new PublicKey$1("Vote111111111111111111111111111111111111111");LayoutExports.struct([publicKey("nodePubkey"),publicKey("authorizedWithdrawer"),LayoutExports.u8("commission"),LayoutExports.nu64(),LayoutExports.seq(LayoutExports.struct([LayoutExports.nu64("slot"),LayoutExports.u32("confirmationCount")]),LayoutExports.offset(LayoutExports.u32(),-8),"votes"),LayoutExports.u8("rootSlotValid"),LayoutExports.nu64("rootSlot"),LayoutExports.nu64(),LayoutExports.seq(LayoutExports.struct([LayoutExports.nu64("epoch"),publicKey("authorizedVoter")]),LayoutExports.offset(LayoutExports.u32(),-8),"authorizedVoters"),LayoutExports.struct([LayoutExports.seq(LayoutExports.struct([publicKey("authorizedPubkey"),LayoutExports.nu64("epochOfLastAuthorizedSwitch"),LayoutExports.nu64("targetEpoch")]),32,"buf"),LayoutExports.nu64("idx"),LayoutExports.u8("isEmpty")],"priorVoters"),LayoutExports.nu64(),LayoutExports.seq(LayoutExports.struct([LayoutExports.nu64("epoch"),LayoutExports.nu64("credits"),LayoutExports.nu64("prevCredits")]),LayoutExports.offset(LayoutExports.u32(),-8),"epochCredits"),LayoutExports.struct([LayoutExports.nu64("slot"),LayoutExports.nu64("timestamp")],"lastTimestamp")]);const connectionSymbol=Symbol.for("@libp2p/connection"),contentRoutingSymbol=Symbol.for("@libp2p/content-routing"),peerDiscoverySymbol=Symbol.for("@libp2p/peer-discovery"),peerIdSymbol=Symbol.for("@libp2p/peer-id");function isPeerId(g){return!!g?.[peerIdSymbol]}const peerRoutingSymbol=Symbol.for("@libp2p/peer-routing"),KEEP_ALIVE="keep-alive",transportSymbol=Symbol.for("@libp2p/transport");var FaultTolerance;(function(g){g[g.FATAL_ALL=0]="FATAL_ALL",g[g.NO_FATAL=1]="NO_FATAL"})(FaultTolerance||(FaultTolerance={}));let AbortError$6=class extends Error{static name="AbortError";constructor(u="The operation was aborted"){super(u),this.name="AbortError"}};class UnexpectedPeerError extends Error{static name="UnexpectedPeerError";constructor(u="Unexpected Peer"){super(u),this.name="UnexpectedPeerError"}}let InvalidCryptoExchangeError$1=class extends Error{static name="InvalidCryptoExchangeError";constructor(u="Invalid crypto exchange"){super(u),this.name="InvalidCryptoExchangeError"}},InvalidParametersError$1=class extends Error{static name="InvalidParametersError";constructor(u="Invalid parameters"){super(u),this.name="InvalidParametersError"}};class InvalidPublicKeyError extends Error{static name="InvalidPublicKeyError";constructor(u="Invalid public key"){super(u),this.name="InvalidPublicKeyError"}}class ConnectionClosingError extends Error{static name="ConnectionClosingError";constructor(u="The connection is closing"){super(u),this.name="ConnectionClosingError"}}class ConnectionClosedError extends Error{static name="ConnectionClosedError";constructor(u="The connection is closed"){super(u),this.name="ConnectionClosedError"}}class ConnectionFailedError extends Error{static name="ConnectionFailedError";constructor(u="Connection failed"){super(u),this.name="ConnectionFailedError"}}class MuxerClosedError extends Error{static name="MuxerClosedError";constructor(u="The muxer is closed"){super(u),this.name="MuxerClosedError"}}class StreamResetError extends Error{static name="StreamResetError";constructor(u="The stream has been reset"){super(u),this.name="StreamResetError"}}class StreamStateError extends Error{static name="StreamStateError";constructor(u="The stream is in an invalid state"){super(u),this.name="StreamStateError"}}let NotFoundError$1=class extends Error{static name="NotFoundError";constructor(u="Not found"){super(u),this.name="NotFoundError"}};class InvalidPeerIdError extends Error{static name="InvalidPeerIdError";constructor(u="Invalid PeerID"){super(u),this.name="InvalidPeerIdError"}}let InvalidMultiaddrError$1=class extends Error{static name="InvalidMultiaddrError";constructor(u="Invalid multiaddr"){super(u),this.name="InvalidMultiaddrError"}};class InvalidCIDError extends Error{static name="InvalidCIDError";constructor(u="Invalid CID"){super(u),this.name="InvalidCIDError"}}class InvalidMultihashError extends Error{static name="InvalidMultihashError";constructor(u="Invalid Multihash"){super(u),this.name="InvalidMultihashError"}}class UnsupportedProtocolError extends Error{static name="UnsupportedProtocolError";constructor(u="Unsupported protocol error"){super(u),this.name="UnsupportedProtocolError"}}class InvalidMessageError extends Error{static name="InvalidMessageError";constructor(u="Invalid message"){super(u),this.name="InvalidMessageError"}}class ProtocolError extends Error{static name="ProtocolError";constructor(u="Protocol error"){super(u),this.name="ProtocolError"}}let TimeoutError$1=class extends Error{static name="TimeoutError";constructor(u="Timed out"){super(u),this.name="TimeoutError"}};class NotStartedError extends Error{static name="NotStartedError";constructor(u="Not started"){super(u),this.name="NotStartedError"}}class DialError extends Error{static name="DialError";constructor(u="Dial error"){super(u),this.name="DialError"}}class ListenError extends Error{static name="ListenError";constructor(u="Listen error"){super(u),this.name="ListenError"}}class LimitedConnectionError extends Error{static name="LimitedConnectionError";constructor(u="Limited connection"){super(u),this.name="LimitedConnectionError"}}class TooManyInboundProtocolStreamsError extends Error{static name="TooManyInboundProtocolStreamsError";constructor(u="Too many inbound protocol streams"){super(u),this.name="TooManyInboundProtocolStreamsError"}}class TooManyOutboundProtocolStreamsError extends Error{static name="TooManyOutboundProtocolStreamsError";constructor(u="Too many outbound protocol streams"){super(u),this.name="TooManyOutboundProtocolStreamsError"}}class UnsupportedKeyTypeError extends Error{static name="UnsupportedKeyTypeError";constructor(u="Unsupported key type"){super(u),this.name="UnsupportedKeyTypeError"}}function setMaxListeners(){}class TypedEventEmitter extends EventTarget{#e=new Map;constructor(){super()}listenerCount(u){const h=this.#e.get(u);return h==null?0:h.length}addEventListener(u,h,y){super.addEventListener(u,h,y);let v=this.#e.get(u);v==null&&(v=[],this.#e.set(u,v)),v.push({callback:h,once:(y!==!0&&y!==!1&&y?.once)??!1})}removeEventListener(u,h,y){super.removeEventListener(u.toString(),h??null,y);let v=this.#e.get(u);v!=null&&(v=v.filter(({callback:b})=>b!==h),this.#e.set(u,v))}dispatchEvent(u){const h=super.dispatchEvent(u);let y=this.#e.get(u.type);return y==null||(y=y.filter(({once:v})=>!v),this.#e.set(u.type,y)),h}safeDispatchEvent(u,h={}){return this.dispatchEvent(new CustomEvent(u,h))}}function isStartable(g){return g!=null&&typeof g.start=="function"&&typeof g.stop=="function"}async function start(...g){const u=[];for(const h of g)isStartable(h)&&u.push(h);await Promise.all(u.map(async h=>{h.beforeStart!=null&&await h.beforeStart()})),await Promise.all(u.map(async h=>{await h.start()})),await Promise.all(u.map(async h=>{h.afterStart!=null&&await h.afterStart()}))}async function stop(...g){const u=[];for(const h of g)isStartable(h)&&u.push(h);await Promise.all(u.map(async h=>{h.beforeStop!=null&&await h.beforeStop()})),await Promise.all(u.map(async h=>{await h.stop()})),await Promise.all(u.map(async h=>{h.afterStop!=null&&await h.afterStop()}))}const serviceCapabilities=Symbol.for("@libp2p/service-capabilities"),serviceDependencies=Symbol.for("@libp2p/service-dependencies");function equals$2(g,u){if(g===u)return!0;if(g.byteLength!==u.byteLength)return!1;for(let h=0;h<g.byteLength;h++)if(g[h]!==u[h])return!1;return!0}function coerce(g){if(g instanceof Uint8Array&&g.constructor.name==="Uint8Array")return g;if(g instanceof ArrayBuffer)return new Uint8Array(g);if(ArrayBuffer.isView(g))return new Uint8Array(g.buffer,g.byteOffset,g.byteLength);throw new Error("Unknown type, must be binary type")}function fromString$1(g){return new TextEncoder().encode(g)}function toString$2(g){return new TextDecoder().decode(g)}function base$2(g,u){if(g.length>=255)throw new TypeError("Alphabet too long");for(var h=new Uint8Array(256),y=0;y<h.length;y++)h[y]=255;for(var v=0;v<g.length;v++){var b=g.charAt(v),w=b.charCodeAt(0);if(h[w]!==255)throw new TypeError(b+" is ambiguous");h[w]=v}var E=g.length,_=g.charAt(0),S=Math.log(E)/Math.log(256),A=Math.log(256)/Math.log(E);function R(C){if(C instanceof Uint8Array||(ArrayBuffer.isView(C)?C=new Uint8Array(C.buffer,C.byteOffset,C.byteLength):Array.isArray(C)&&(C=Uint8Array.from(C))),!(C instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(C.length===0)return"";for(var I=0,L=0,$=0,B=C.length;$!==B&&C[$]===0;)$++,I++;for(var U=(B-$)*A+1>>>0,z=new Uint8Array(U);$!==B;){for(var ne=C[$],ue=0,he=U-1;(ne!==0||ue<L)&&he!==-1;he--,ue++)ne+=256*z[he]>>>0,z[he]=ne%E>>>0,ne=ne/E>>>0;if(ne!==0)throw new Error("Non-zero carry");L=ue,$++}for(var Y=U-L;Y!==U&&z[Y]===0;)Y++;for(var X=_.repeat(I);Y<U;++Y)X+=g.charAt(z[Y]);return X}function x(C){if(typeof C!="string")throw new TypeError("Expected String");if(C.length===0)return new Uint8Array;var I=0;if(C[I]!==" "){for(var L=0,$=0;C[I]===_;)L++,I++;for(var B=(C.length-I)*S+1>>>0,U=new Uint8Array(B);C[I];){var z=h[C.charCodeAt(I)];if(z===255)return;for(var ne=0,ue=B-1;(z!==0||ne<$)&&ue!==-1;ue--,ne++)z+=E*U[ue]>>>0,U[ue]=z%256>>>0,z=z/256>>>0;if(z!==0)throw new Error("Non-zero carry");$=ne,I++}if(C[I]!==" "){for(var he=B-$;he!==B&&U[he]===0;)he++;for(var Y=new Uint8Array(L+(B-he)),X=L;he!==B;)Y[X++]=U[he++];return Y}}}function T(C){var I=x(C);if(I)return I;throw new Error(`Non-${u} character`)}return{encode:R,decodeUnsafe:x,decode:T}}var src$1=base$2,_brrp__multiformats_scope_baseX=src$1;let Encoder$1=class{name;prefix;baseEncode;constructor(u,h,y){this.name=u,this.prefix=h,this.baseEncode=y}encode(u){if(u instanceof Uint8Array)return`${this.prefix}${this.baseEncode(u)}`;throw Error("Unknown type, must be binary type")}},Decoder$2=class{name;prefix;baseDecode;prefixCodePoint;constructor(u,h,y){this.name=u,this.prefix=h;const v=h.codePointAt(0);if(v===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=v,this.baseDecode=y}decode(u){if(typeof u=="string"){if(u.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(u)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(u.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(u){return or$1(this,u)}};class ComposedDecoder{decoders;constructor(u){this.decoders=u}or(u){return or$1(this,u)}decode(u){const h=u[0],y=this.decoders[h];if(y!=null)return y.decode(u);throw RangeError(`Unable to decode multibase string ${JSON.stringify(u)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function or$1(g,u){return new ComposedDecoder({...g.decoders??{[g.prefix]:g},...u.decoders??{[u.prefix]:u}})}class Codec{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(u,h,y,v){this.name=u,this.prefix=h,this.baseEncode=y,this.baseDecode=v,this.encoder=new Encoder$1(u,h,y),this.decoder=new Decoder$2(u,h,v)}encode(u){return this.encoder.encode(u)}decode(u){return this.decoder.decode(u)}}function from$1({name:g,prefix:u,encode:h,decode:y}){return new Codec(g,u,h,y)}function baseX({name:g,prefix:u,alphabet:h}){const{encode:y,decode:v}=_brrp__multiformats_scope_baseX(h,g);return from$1({prefix:u,name:g,encode:y,decode:b=>coerce(v(b))})}function decode$8(g,u,h,y){let v=g.length;for(;g[v-1]==="=";)--v;const b=new Uint8Array(v*h/8|0);let w=0,E=0,_=0;for(let S=0;S<v;++S){const A=u[g[S]];if(A===void 0)throw new SyntaxError(`Non-${y} character`);E=E<<h|A,w+=h,w>=8&&(w-=8,b[_++]=255&E>>w)}if(w>=h||(255&E<<8-w)!==0)throw new SyntaxError("Unexpected end of data");return b}function encode$6(g,u,h){const y=u[u.length-1]==="=",v=(1<<h)-1;let b="",w=0,E=0;for(let _=0;_<g.length;++_)for(E=E<<8|g[_],w+=8;w>h;)w-=h,b+=u[v&E>>w];if(w!==0&&(b+=u[v&E<<h-w]),y)for(;(b.length*h&7)!==0;)b+="=";return b}function createAlphabetIdx(g){const u={};for(let h=0;h<g.length;++h)u[g[h]]=h;return u}function rfc4648({name:g,prefix:u,bitsPerChar:h,alphabet:y}){const v=createAlphabetIdx(y);return from$1({prefix:u,name:g,encode(b){return encode$6(b,y,h)},decode(b){return decode$8(b,v,h,g)}})}const base58btc=baseX({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr=baseX({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58=Object.freeze(Object.defineProperty({__proto__:null,base58btc,base58flickr},Symbol.toStringTag,{value:"Module"})),base32=rfc4648({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper=rfc4648({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad=rfc4648({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper=rfc4648({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex=rfc4648({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper=rfc4648({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad=rfc4648({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper=rfc4648({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z=rfc4648({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$1=Object.freeze(Object.defineProperty({__proto__:null,base32,base32hex,base32hexpad,base32hexpadupper,base32hexupper,base32pad,base32padupper,base32upper,base32z},Symbol.toStringTag,{value:"Module"})),base36=baseX({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper=baseX({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$1=Object.freeze(Object.defineProperty({__proto__:null,base36,base36upper},Symbol.toStringTag,{value:"Module"}));var encode_1=encode$5,MSB$1=128,MSBALL=-128,INT=Math.pow(2,31);function encode$5(g,u,h){u=u||[],h=h||0;for(var y=h;g>=INT;)u[h++]=g&255|MSB$1,g/=128;for(;g&MSBALL;)u[h++]=g&255|MSB$1,g>>>=7;return u[h]=g|0,encode$5.bytes=h-y+1,u}var decode$7=read$2,MSB$1$1=128,REST$1=127;function read$2(g,y){var h=0,y=y||0,v=0,b=y,w,E=g.length;do{if(b>=E)throw read$2.bytes=0,new RangeError("Could not decode varint");w=g[b++],h+=v<28?(w&REST$1)<<v:(w&REST$1)*Math.pow(2,v),v+=7}while(w>=MSB$1$1);return read$2.bytes=b-y,h}var N1$1=Math.pow(2,7),N2$1=Math.pow(2,14),N3$1=Math.pow(2,21),N4$1=Math.pow(2,28),N5$1=Math.pow(2,35),N6$1=Math.pow(2,42),N7$1=Math.pow(2,49),N8=Math.pow(2,56),N9=Math.pow(2,63),length$1=function(g){return g<N1$1?1:g<N2$1?2:g<N3$1?3:g<N4$1?4:g<N5$1?5:g<N6$1?6:g<N7$1?7:g<N8?8:g<N9?9:10},varint={encode:encode_1,decode:decode$7,encodingLength:length$1},_brrp_varint=varint;function decode$6(g,u=0){return[_brrp_varint.decode(g,u),_brrp_varint.decode.bytes]}function encodeTo(g,u,h=0){return _brrp_varint.encode(g,u,h),u}function encodingLength$1(g){return _brrp_varint.encodingLength(g)}function create(g,u){const h=u.byteLength,y=encodingLength$1(g),v=y+encodingLength$1(h),b=new Uint8Array(v+h);return encodeTo(g,b,0),encodeTo(h,b,y),b.set(u,v),new Digest(g,h,u,b)}function decode$5(g){const u=coerce(g),[h,y]=decode$6(u),[v,b]=decode$6(u.subarray(y)),w=u.subarray(y+b);if(w.byteLength!==v)throw new Error("Incorrect length");return new Digest(h,v,w,u)}function equals$1(g,u){if(g===u)return!0;{const h=u;return g.code===h.code&&g.size===h.size&&h.bytes instanceof Uint8Array&&equals$2(g.bytes,h.bytes)}}class Digest{code;size;digest;bytes;constructor(u,h,y,v){this.code=u,this.size=h,this.digest=y,this.bytes=v}}function format(g,u){const{bytes:h,version:y}=g;switch(y){case 0:return toStringV0(h,baseCache(g),u??base58btc.encoder);default:return toStringV1(h,baseCache(g),u??base32.encoder)}}const cache$2=new WeakMap;function baseCache(g){const u=cache$2.get(g);if(u==null){const h=new Map;return cache$2.set(g,h),h}return u}class CID{code;version;multihash;bytes;"/";constructor(u,h,y,v){this.code=h,this.version=u,this.multihash=y,this.bytes=v,this["/"]=v}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:u,multihash:h}=this;if(u!==DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(h.code!==SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return CID.createV0(h)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:u,digest:h}=this.multihash,y=create(u,h);return CID.createV1(this.code,y)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(u){return CID.equals(this,u)}static equals(u,h){const y=h;return y!=null&&u.code===y.code&&u.version===y.version&&equals$1(u.multihash,y.multihash)}toString(u){return format(this,u)}toJSON(){return{"/":format(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(u){if(u==null)return null;const h=u;if(h instanceof CID)return h;if(h["/"]!=null&&h["/"]===h.bytes||h.asCID===h){const{version:y,code:v,multihash:b,bytes:w}=h;return new CID(y,v,b,w??encodeCID(y,v,b.bytes))}else if(h[cidSymbol]===!0){const{version:y,multihash:v,code:b}=h,w=decode$5(v);return CID.create(y,b,w)}else return null}static create(u,h,y){if(typeof h!="number")throw new Error("String codecs are no longer supported");if(!(y.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(u){case 0:{if(h!==DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${DAG_PB_CODE}) block encoding`);return new CID(u,h,y,y.bytes)}case 1:{const v=encodeCID(u,h,y.bytes);return new CID(u,h,y,v)}default:throw new Error("Invalid version")}}static createV0(u){return CID.create(0,DAG_PB_CODE,u)}static createV1(u,h){return CID.create(1,u,h)}static decode(u){const[h,y]=CID.decodeFirst(u);if(y.length!==0)throw new Error("Incorrect length");return h}static decodeFirst(u){const h=CID.inspectBytes(u),y=h.size-h.multihashSize,v=coerce(u.subarray(y,y+h.multihashSize));if(v.byteLength!==h.multihashSize)throw new Error("Incorrect length");const b=v.subarray(h.multihashSize-h.digestSize),w=new Digest(h.multihashCode,h.digestSize,b,v);return[h.version===0?CID.createV0(w):CID.createV1(h.codec,w),u.subarray(h.size)]}static inspectBytes(u){let h=0;const y=()=>{const[R,x]=decode$6(u.subarray(h));return h+=x,R};let v=y(),b=DAG_PB_CODE;if(v===18?(v=0,h=0):b=y(),v!==0&&v!==1)throw new RangeError(`Invalid CID version ${v}`);const w=h,E=y(),_=y(),S=h+_,A=S-w;return{version:v,codec:b,multihashCode:E,digestSize:_,multihashSize:A,size:S}}static parse(u,h){const[y,v]=parseCIDtoBytes(u,h),b=CID.decode(v);if(b.version===0&&u[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return baseCache(b).set(y,u),b}}function parseCIDtoBytes(g,u){switch(g[0]){case"Q":{const h=u??base58btc;return[base58btc.prefix,h.decode(`${base58btc.prefix}${g}`)]}case base58btc.prefix:{const h=u??base58btc;return[base58btc.prefix,h.decode(g)]}case base32.prefix:{const h=u??base32;return[base32.prefix,h.decode(g)]}case base36.prefix:{const h=u??base36;return[base36.prefix,h.decode(g)]}default:{if(u==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[g[0],u.decode(g)]}}}function toStringV0(g,u,h){const{prefix:y}=h;if(y!==base58btc.prefix)throw Error(`Cannot string encode V0 in ${h.name} encoding`);const v=u.get(y);if(v==null){const b=h.encode(g).slice(1);return u.set(y,b),b}else return v}function toStringV1(g,u,h){const{prefix:y}=h,v=u.get(y);if(v==null){const b=h.encode(g);return u.set(y,b),b}else return v}const DAG_PB_CODE=112,SHA_256_CODE=18;function encodeCID(g,u,h){const y=encodingLength$1(g),v=y+encodingLength$1(u),b=new Uint8Array(v+h.byteLength);return encodeTo(g,b,0),encodeTo(u,b,y),b.set(h,v),b}const cidSymbol=Symbol.for("@ipld/js-cid/CID"),code$1=0,name$1="identity",encode$4=coerce;function digest(g,u){if(u?.truncate!=null&&u.truncate!==g.byteLength){if(u.truncate<0||u.truncate>g.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${g.byteLength}`);g=g.subarray(0,u.truncate)}return create(code$1,encode$4(g))}const identity$1={code:code$1,name:name$1,encode:encode$4,digest};function equals(g,u){if(g===u)return!0;if(g.byteLength!==u.byteLength)return!1;for(let h=0;h<g.byteLength;h++)if(g[h]!==u[h])return!1;return!0}function alloc$1(g=0){return new Uint8Array(g)}function allocUnsafe(g=0){return new Uint8Array(g)}function asUint8Array(g){return g}function concat(g,u){u==null&&(u=g.reduce((v,b)=>v+b.length,0));const h=allocUnsafe(u);let y=0;for(const v of g)h.set(v,y),y+=v.length;return h}const symbol$1=Symbol.for("@achingbrain/uint8arraylist");function findBufAndOffset(g,u){if(u==null||u<0)throw new RangeError("index is out of bounds");let h=0;for(const y of g){const v=h+y.byteLength;if(u<v)return{buf:y,index:u-h};h=v}throw new RangeError("index is out of bounds")}function isUint8ArrayList(g){return!!g?.[symbol$1]}class Uint8ArrayList{bufs;length;[symbol$1]=!0;constructor(...u){this.bufs=[],this.length=0,u.length>0&&this.appendAll(u)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...u){this.appendAll(u)}appendAll(u){let h=0;for(const y of u)if(y instanceof Uint8Array)h+=y.byteLength,this.bufs.push(y);else if(isUint8ArrayList(y))h+=y.byteLength,this.bufs.push(...y.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=h}prepend(...u){this.prependAll(u)}prependAll(u){let h=0;for(const y of u.reverse())if(y instanceof Uint8Array)h+=y.byteLength,this.bufs.unshift(y);else if(isUint8ArrayList(y))h+=y.byteLength,this.bufs.unshift(...y.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=h}get(u){const h=findBufAndOffset(this.bufs,u);return h.buf[h.index]}set(u,h){const y=findBufAndOffset(this.bufs,u);y.buf[y.index]=h}write(u,h=0){if(u instanceof Uint8Array)for(let y=0;y<u.length;y++)this.set(h+y,u[y]);else if(isUint8ArrayList(u))for(let y=0;y<u.length;y++)this.set(h+y,u.get(y));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(u){if(u=Math.trunc(u),!(Number.isNaN(u)||u<=0)){if(u===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(u>=this.bufs[0].byteLength)u-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(u),this.length-=u;break}}}slice(u,h){const{bufs:y,length:v}=this._subList(u,h);return concat(y,v)}subarray(u,h){const{bufs:y,length:v}=this._subList(u,h);return y.length===1?y[0]:concat(y,v)}sublist(u,h){const{bufs:y,length:v}=this._subList(u,h),b=new Uint8ArrayList;return b.length=v,b.bufs=[...y],b}_subList(u,h){if(u=u??0,h=h??this.length,u<0&&(u=this.length+u),h<0&&(h=this.length+h),u<0||h>this.length)throw new RangeError("index is out of bounds");if(u===h)return{bufs:[],length:0};if(u===0&&h===this.length)return{bufs:this.bufs,length:this.length};const y=[];let v=0;for(let b=0;b<this.bufs.length;b++){const w=this.bufs[b],E=v,_=E+w.byteLength;if(v=_,u>=_)continue;const S=u>=E&&u<_,A=h>E&&h<=_;if(S&&A){if(u===E&&h===_){y.push(w);break}const R=u-E;y.push(w.subarray(R,R+(h-u)));break}if(S){if(u===0){y.push(w);continue}y.push(w.subarray(u-E));continue}if(A){if(h===_){y.push(w);break}y.push(w.subarray(0,h-E));break}y.push(w)}return{bufs:y,length:h-u}}indexOf(u,h=0){if(!isUint8ArrayList(u)&&!(u instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const y=u instanceof Uint8Array?u:u.subarray();if(h=Number(h??0),isNaN(h)&&(h=0),h<0&&(h=this.length+h),h<0&&(h=0),u.length===0)return h>this.length?this.length:h;const v=y.byteLength;if(v===0)throw new TypeError("search must be at least 1 byte long");const b=256,w=new Int32Array(b);for(let R=0;R<b;R++)w[R]=-1;for(let R=0;R<v;R++)w[y[R]]=R;const E=w,_=this.byteLength-y.byteLength,S=y.byteLength-1;let A;for(let R=h;R<=_;R+=A){A=0;for(let x=S;x>=0;x--){const T=this.get(R+x);if(y[x]!==T){A=Math.max(1,x-E[T]);break}}if(A===0)return R}return-1}getInt8(u){const h=this.subarray(u,u+1);return new DataView(h.buffer,h.byteOffset,h.byteLength).getInt8(0)}setInt8(u,h){const y=allocUnsafe(1);new DataView(y.buffer,y.byteOffset,y.byteLength).setInt8(0,h),this.write(y,u)}getInt16(u,h){const y=this.subarray(u,u+2);return new DataView(y.buffer,y.byteOffset,y.byteLength).getInt16(0,h)}setInt16(u,h,y){const v=alloc$1(2);new DataView(v.buffer,v.byteOffset,v.byteLength).setInt16(0,h,y),this.write(v,u)}getInt32(u,h){const y=this.subarray(u,u+4);return new DataView(y.buffer,y.byteOffset,y.byteLength).getInt32(0,h)}setInt32(u,h,y){const v=alloc$1(4);new DataView(v.buffer,v.byteOffset,v.byteLength).setInt32(0,h,y),this.write(v,u)}getBigInt64(u,h){const y=this.subarray(u,u+8);return new DataView(y.buffer,y.byteOffset,y.byteLength).getBigInt64(0,h)}setBigInt64(u,h,y){const v=alloc$1(8);new DataView(v.buffer,v.byteOffset,v.byteLength).setBigInt64(0,h,y),this.write(v,u)}getUint8(u){const h=this.subarray(u,u+1);return new DataView(h.buffer,h.byteOffset,h.byteLength).getUint8(0)}setUint8(u,h){const y=allocUnsafe(1);new DataView(y.buffer,y.byteOffset,y.byteLength).setUint8(0,h),this.write(y,u)}getUint16(u,h){const y=this.subarray(u,u+2);return new DataView(y.buffer,y.byteOffset,y.byteLength).getUint16(0,h)}setUint16(u,h,y){const v=alloc$1(2);new DataView(v.buffer,v.byteOffset,v.byteLength).setUint16(0,h,y),this.write(v,u)}getUint32(u,h){const y=this.subarray(u,u+4);return new DataView(y.buffer,y.byteOffset,y.byteLength).getUint32(0,h)}setUint32(u,h,y){const v=alloc$1(4);new DataView(v.buffer,v.byteOffset,v.byteLength).setUint32(0,h,y),this.write(v,u)}getBigUint64(u,h){const y=this.subarray(u,u+8);return new DataView(y.buffer,y.byteOffset,y.byteLength).getBigUint64(0,h)}setBigUint64(u,h,y){const v=alloc$1(8);new DataView(v.buffer,v.byteOffset,v.byteLength).setBigUint64(0,h,y),this.write(v,u)}getFloat32(u,h){const y=this.subarray(u,u+4);return new DataView(y.buffer,y.byteOffset,y.byteLength).getFloat32(0,h)}setFloat32(u,h,y){const v=alloc$1(4);new DataView(v.buffer,v.byteOffset,v.byteLength).setFloat32(0,h,y),this.write(v,u)}getFloat64(u,h){const y=this.subarray(u,u+8);return new DataView(y.buffer,y.byteOffset,y.byteLength).getFloat64(0,h)}setFloat64(u,h,y){const v=alloc$1(8);new DataView(v.buffer,v.byteOffset,v.byteLength).setFloat64(0,h,y),this.write(v,u)}equals(u){if(u==null||!(u instanceof Uint8ArrayList)||u.bufs.length!==this.bufs.length)return!1;for(let h=0;h<this.bufs.length;h++)if(!equals(this.bufs[h],u.bufs[h]))return!1;return!0}static fromUint8Arrays(u,h){const y=new Uint8ArrayList;return y.bufs=u,h==null&&(h=u.reduce((v,b)=>v+b.byteLength,0)),y.length=h,y}}const base10=baseX({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$1=Object.freeze(Object.defineProperty({__proto__:null,base10},Symbol.toStringTag,{value:"Module"})),base16=rfc4648({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper=rfc4648({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$1=Object.freeze(Object.defineProperty({__proto__:null,base16,base16upper},Symbol.toStringTag,{value:"Module"})),base2=rfc4648({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$1=Object.freeze(Object.defineProperty({__proto__:null,base2},Symbol.toStringTag,{value:"Module"})),alphabet=Array.from(""),alphabetBytesToChars=alphabet.reduce((g,u,h)=>(g[h]=u,g),[]),alphabetCharsToBytes=alphabet.reduce((g,u,h)=>{const y=u.codePointAt(0);if(y==null)throw new Error(`Invalid character: ${u}`);return g[y]=h,g},[]);function encode$3(g){return g.reduce((u,h)=>(u+=alphabetBytesToChars[h],u),"")}function decode$4(g){const u=[];for(const h of g){const y=h.codePointAt(0);if(y==null)throw new Error(`Invalid character: ${h}`);const v=alphabetCharsToBytes[y];if(v==null)throw new Error(`Non-base256emoji character: ${h}`);u.push(v)}return new Uint8Array(u)}const base256emoji=from$1({prefix:"",name:"base256emoji",encode:encode$3,decode:decode$4}),base256emoji$1=Object.freeze(Object.defineProperty({__proto__:null,base256emoji},Symbol.toStringTag,{value:"Module"})),base64=rfc4648({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad=rfc4648({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url$3=rfc4648({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad=rfc4648({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$1=Object.freeze(Object.defineProperty({__proto__:null,base64,base64pad,base64url:base64url$3,base64urlpad},Symbol.toStringTag,{value:"Module"})),base8=rfc4648({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$1=Object.freeze(Object.defineProperty({__proto__:null,base8},Symbol.toStringTag,{value:"Module"})),identity=from$1({prefix:"\0",name:"identity",encode:g=>toString$2(g),decode:g=>fromString$1(g)}),identityBase=Object.freeze(Object.defineProperty({__proto__:null,identity},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const DEFAULT_MIN_DIGEST_LENGTH=20;function from({name:g,code:u,encode:h,minDigestLength:y,maxDigestLength:v}){return new Hasher(g,u,h,y,v)}class Hasher{name;code;encode;minDigestLength;maxDigestLength;constructor(u,h,y,v,b){this.name=u,this.code=h,this.encode=y,this.minDigestLength=v??DEFAULT_MIN_DIGEST_LENGTH,this.maxDigestLength=b}digest(u,h){if(h?.truncate!=null){if(h.truncate<this.minDigestLength)throw new Error(`Invalid truncate option, must be greater than or equal to ${this.minDigestLength}`);if(this.maxDigestLength!=null&&h.truncate>this.maxDigestLength)throw new Error(`Invalid truncate option, must be less than or equal to ${this.maxDigestLength}`)}if(u instanceof Uint8Array){const y=this.encode(u);return y instanceof Uint8Array?createDigest(y,this.code,h?.truncate):y.then(v=>createDigest(v,this.code,h?.truncate))}else throw Error("Unknown type, must be binary type")}}function createDigest(g,u,h){if(h!=null&&h!==g.byteLength){if(h>g.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${g.byteLength}`);g=g.subarray(0,h)}return create(u,g)}function sha$2(g){return async u=>new Uint8Array(await crypto.subtle.digest(g,u))}const sha256$3=from({name:"sha2-256",code:18,encode:sha$2("SHA-256")}),bases={...identityBase,...base2$1,...base8$1,...base10$1,...base16$1,...base32$1,...base36$1,...base58,...base64$1,...base256emoji$1};function createCodec$1(g,u,h,y){return{name:g,prefix:u,encoder:{name:g,prefix:u,encode:h},decoder:{decode:y}}}const string=createCodec$1("utf8","u",g=>"u"+new TextDecoder("utf8").decode(g),g=>new TextEncoder().encode(g.substring(1))),ascii=createCodec$1("ascii","a",g=>{let u="a";for(let h=0;h<g.length;h++)u+=String.fromCharCode(g[h]);return u},g=>{g=g.substring(1);const u=allocUnsafe(g.length);for(let h=0;h<g.length;h++)u[h]=g.charCodeAt(h);return u}),BASES={utf8:string,"utf-8":string,hex:bases.base16,latin1:ascii,ascii,binary:ascii,...bases};function fromString(g,u="utf8"){const h=BASES[u];if(h==null)throw new Error(`Unsupported encoding "${u}"`);return h.decoder.decode(`${h.prefix}${g}`)}function toString$1(g,u="utf8"){const h=BASES[u];if(h==null)throw new Error(`Unsupported encoding "${u}"`);return h.encoder.encode(g).substring(1)}const TAG_MASK=parseInt("11111",2),LONG_LENGTH_MASK=parseInt("10000000",2),LONG_LENGTH_BYTES_MASK=parseInt("01111111",2),decoders$2={0:readSequence,1:readSequence,2:readInteger,3:readBitString,4:readOctetString,5:readNull,6:readObjectIdentifier,16:readSequence,22:readSequence,48:readSequence};function decodeDer(g,u={offset:0}){const h=g[u.offset]&TAG_MASK;if(u.offset++,decoders$2[h]!=null)return decoders$2[h](g,u);throw new Error("No decoder for tag "+h)}function readLength(g,u){let h=0;if((g[u.offset]&LONG_LENGTH_MASK)===LONG_LENGTH_MASK){const y=g[u.offset]&LONG_LENGTH_BYTES_MASK;let v="0x";u.offset++;for(let b=0;b<y;b++,u.offset++)v+=g[u.offset].toString(16).padStart(2,"0");h=parseInt(v,16)}else h=g[u.offset],u.offset++;return h}function readSequence(g,u){readLength(g,u);const h=[];for(;!(u.offset>=g.byteLength);){const y=decodeDer(g,u);if(y===null)break;h.push(y)}return h}function readInteger(g,u){const h=readLength(g,u),y=u.offset,v=u.offset+h,b=[];for(let w=y;w<v;w++)w===y&&g[w]===0||b.push(g[w]);return u.offset+=h,Uint8Array.from(b)}function readObjectIdentifier(g,u){const h=readLength(g,u),y=u.offset+h,v=g[u.offset];u.offset++;let b=0,w=0;v<40?(b=0,w=v):v<80?(b=1,w=v-40):(b=2,w=v-80);let E=`${b}.${w}`,_=[];for(;u.offset<y;){const S=g[u.offset];if(u.offset++,_.push(S&127),S<128){_.reverse();let A=0;for(let R=0;R<_.length;R++)A+=_[R]<<R*7;E+=`.${A}`,_=[]}}return E}function readNull(g,u){return u.offset++,null}function readBitString(g,u){const h=readLength(g,u),y=g[u.offset];u.offset++;const v=g.subarray(u.offset,u.offset+h-1);if(u.offset+=h,y!==0)throw new Error("Unused bits in bit string is unimplemented");return v}function readOctetString(g,u){const h=readLength(g,u),y=g.subarray(u.offset,u.offset+h);return u.offset+=h,y}function encodeNumber(g){let u=g.toString(16);u.length%2===1&&(u="0"+u);const h=new Uint8ArrayList;for(let y=0;y<u.length;y+=2)h.append(Uint8Array.from([parseInt(`${u[y]}${u[y+1]}`,16)]));return h}function encodeLength(g){if(g.byteLength<128)return Uint8Array.from([g.byteLength]);const u=encodeNumber(g.byteLength);return new Uint8ArrayList(Uint8Array.from([u.byteLength|LONG_LENGTH_MASK]),u)}function encodeInteger(g){const u=new Uint8ArrayList,h=128;return(g.subarray()[0]&h)===h&&u.append(Uint8Array.from([0])),u.append(g),new Uint8ArrayList(Uint8Array.from([2]),encodeLength(u),u)}function encodeBitString(g){const u=Uint8Array.from([0]),h=new Uint8ArrayList(u,g);return new Uint8ArrayList(Uint8Array.from([3]),encodeLength(h),h)}function encodeSequence(g,u=48){const h=new Uint8ArrayList;for(const y of g)h.append(y);return new Uint8ArrayList(Uint8Array.from([u]),encodeLength(h),h)}async function hashAndVerify$3(g,u,h,y){const v=await crypto.subtle.importKey("jwk",g,{name:"ECDSA",namedCurve:g.crv??"P-256"},!1,["verify"]);y?.signal?.throwIfAborted();const b=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},v,u,h.subarray());return y?.signal?.throwIfAborted(),b}const OID_256=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),OID_384=Uint8Array.from([6,5,43,129,4,0,34]),OID_521=Uint8Array.from([6,5,43,129,4,0,35]),P_256_KEY_JWK={ext:!0,kty:"EC",crv:"P-256"},P_384_KEY_JWK={ext:!0,kty:"EC",crv:"P-384"},P_521_KEY_JWK={ext:!0,kty:"EC",crv:"P-521"},P_256_KEY_LENGTH=32,P_384_KEY_LENGTH=48,P_521_KEY_LENGTH=66;function unmarshalECDSAPublicKey(g){const u=decodeDer(g);return pkiMessageToECDSAPublicKey(u)}function pkiMessageToECDSAPublicKey(g){const u=g[1][1][0],h=1;let y,v;if(u.byteLength===P_256_KEY_LENGTH*2+1)return y=toString$1(u.subarray(h,h+P_256_KEY_LENGTH),"base64url"),v=toString$1(u.subarray(h+P_256_KEY_LENGTH),"base64url"),new ECDSAPublicKey({...P_256_KEY_JWK,key_ops:["verify"],x:y,y:v});if(u.byteLength===P_384_KEY_LENGTH*2+1)return y=toString$1(u.subarray(h,h+P_384_KEY_LENGTH),"base64url"),v=toString$1(u.subarray(h+P_384_KEY_LENGTH),"base64url"),new ECDSAPublicKey({...P_384_KEY_JWK,key_ops:["verify"],x:y,y:v});if(u.byteLength===P_521_KEY_LENGTH*2+1)return y=toString$1(u.subarray(h,h+P_521_KEY_LENGTH),"base64url"),v=toString$1(u.subarray(h+P_521_KEY_LENGTH),"base64url"),new ECDSAPublicKey({...P_521_KEY_JWK,key_ops:["verify"],x:y,y:v});throw new InvalidParametersError$1(`coordinates were wrong length, got ${u.byteLength}, expected 65, 97 or 133`)}function publicKeyToPKIMessage(g){return encodeSequence([encodeInteger(Uint8Array.from([1])),encodeSequence([getOID(g.crv)],160),encodeSequence([encodeBitString(new Uint8ArrayList(Uint8Array.from([4]),fromString(g.x??"","base64url"),fromString(g.y??"","base64url")))],161)]).subarray()}function getOID(g){if(g==="P-256")return OID_256;if(g==="P-384")return OID_384;if(g==="P-521")return OID_521;throw new InvalidParametersError$1(`Invalid curve ${g}`)}class ECDSAPublicKey{type="ECDSA";jwk;_raw;constructor(u){this.jwk=u}get raw(){return this._raw==null&&(this._raw=publicKeyToPKIMessage(this.jwk)),this._raw}toMultihash(){return identity$1.digest(publicKeyToProtobuf(this))}toCID(){return CID.createV1(114,this.toMultihash())}toString(){return base58btc.encode(this.toMultihash().bytes).substring(1)}equals(u){return u==null||!(u.raw instanceof Uint8Array)?!1:equals(this.raw,u.raw)}async verify(u,h,y){return hashAndVerify$3(this.jwk,h,u,y)}}class VerificationError extends Error{constructor(u="An error occurred while verifying a message"){super(u),this.name="VerificationError"}}class WebCryptoMissingError extends Error{constructor(u="Missing Web Crypto API"){super(u),this.name="WebCryptoMissingError"}}const webcrypto={get(g=globalThis){const u=g.crypto;if(u?.subtle==null)throw new WebCryptoMissingError("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return u}},PUBLIC_KEY_BYTE_LENGTH=32,PRIVATE_KEY_BYTE_LENGTH=64,KEYS_BYTE_LENGTH=32;let ed25519Supported;const webCryptoEd25519SupportedPromise=(async()=>{try{return await webcrypto.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}})();function generateKey(){const g=ed25519.utils.randomPrivateKey(),u=ed25519.getPublicKey(g);return{privateKey:concatKeys(g,u),publicKey:u}}function generateKeyFromSeed(g){if(g.length!==KEYS_BYTE_LENGTH)throw new TypeError('"seed" must be 32 bytes in length.');if(!(g instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const u=g,h=ed25519.getPublicKey(u);return{privateKey:concatKeys(u,h),publicKey:h}}async function hashAndSignWebCrypto(g,u){let h;g.length===PRIVATE_KEY_BYTE_LENGTH?h=g.subarray(0,32):h=g;const y={crv:"Ed25519",kty:"OKP",x:toString$1(g.subarray(32),"base64url"),d:toString$1(h,"base64url"),ext:!0,key_ops:["sign"]},v=await webcrypto.get().subtle.importKey("jwk",y,{name:"Ed25519"},!0,["sign"]),b=await webcrypto.get().subtle.sign({name:"Ed25519"},v,u instanceof Uint8Array?u:u.subarray());return new Uint8Array(b,0,b.byteLength)}function hashAndSignNoble(g,u){const h=g.subarray(0,KEYS_BYTE_LENGTH);return ed25519.sign(u instanceof Uint8Array?u:u.subarray(),h)}async function hashAndSign(g,u){return ed25519Supported==null&&(ed25519Supported=await webCryptoEd25519SupportedPromise),ed25519Supported?hashAndSignWebCrypto(g,u):hashAndSignNoble(g,u)}async function hashAndVerifyWebCrypto(g,u,h){if(g.buffer instanceof ArrayBuffer){const y=await webcrypto.get().subtle.importKey("raw",g.buffer,{name:"Ed25519"},!1,["verify"]);return await webcrypto.get().subtle.verify({name:"Ed25519"},y,u,h instanceof Uint8Array?h:h.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")}function hashAndVerifyNoble(g,u,h){return ed25519.verify(u,h instanceof Uint8Array?h:h.subarray(),g)}async function hashAndVerify$2(g,u,h){return ed25519Supported==null&&(ed25519Supported=await webCryptoEd25519SupportedPromise),ed25519Supported?hashAndVerifyWebCrypto(g,u,h):hashAndVerifyNoble(g,u,h)}function concatKeys(g,u){const h=new Uint8Array(PRIVATE_KEY_BYTE_LENGTH);for(let y=0;y<KEYS_BYTE_LENGTH;y++)h[y]=g[y],h[KEYS_BYTE_LENGTH+y]=u[y];return h}function isPromise$4(g){return g==null?!1:typeof g.then=="function"&&typeof g.catch=="function"&&typeof g.finally=="function"}class Ed25519PublicKey{type="Ed25519";raw;constructor(u){this.raw=ensureEd25519Key(u,PUBLIC_KEY_BYTE_LENGTH)}toMultihash(){return identity$1.digest(publicKeyToProtobuf(this))}toCID(){return CID.createV1(114,this.toMultihash())}toString(){return base58btc.encode(this.toMultihash().bytes).substring(1)}equals(u){return u==null||!(u.raw instanceof Uint8Array)?!1:equals(this.raw,u.raw)}verify(u,h,y){y?.signal?.throwIfAborted();const v=hashAndVerify$2(this.raw,h,u);return isPromise$4(v)?v.then(b=>(y?.signal?.throwIfAborted(),b)):v}}class Ed25519PrivateKey{type="Ed25519";raw;publicKey;constructor(u,h){this.raw=ensureEd25519Key(u,PRIVATE_KEY_BYTE_LENGTH),this.publicKey=new Ed25519PublicKey(h)}equals(u){return u==null||!(u.raw instanceof Uint8Array)?!1:equals(this.raw,u.raw)}sign(u,h){h?.signal?.throwIfAborted();const y=hashAndSign(this.raw,u);return isPromise$4(y)?y.then(v=>(h?.signal?.throwIfAborted(),v)):(h?.signal?.throwIfAborted(),y)}}function unmarshalEd25519PublicKey(g){return g=ensureEd25519Key(g,PUBLIC_KEY_BYTE_LENGTH),new Ed25519PublicKey(g)}async function generateEd25519KeyPair(){const{privateKey:g,publicKey:u}=generateKey();return new Ed25519PrivateKey(g,u)}async function generateEd25519KeyPairFromSeed(g){const{privateKey:u,publicKey:h}=generateKeyFromSeed(g);return new Ed25519PrivateKey(u,h)}function ensureEd25519Key(g,u){if(g=Uint8Array.from(g??[]),g.length!==u)throw new InvalidParametersError$1(`Key must be a Uint8Array of length ${u}, got ${g.length}`);return g}const N1=Math.pow(2,7),N2=Math.pow(2,14),N3=Math.pow(2,21),N4=Math.pow(2,28),N5=Math.pow(2,35),N6=Math.pow(2,42),N7=Math.pow(2,49),MSB=128,REST=127;function encodingLength(g){if(g<N1)return 1;if(g<N2)return 2;if(g<N3)return 3;if(g<N4)return 4;if(g<N5)return 5;if(g<N6)return 6;if(g<N7)return 7;if(Number.MAX_SAFE_INTEGER!=null&&g>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function encodeUint8Array(g,u,h=0){switch(encodingLength(g)){case 8:u[h++]=g&255|MSB,g/=128;case 7:u[h++]=g&255|MSB,g/=128;case 6:u[h++]=g&255|MSB,g/=128;case 5:u[h++]=g&255|MSB,g/=128;case 4:u[h++]=g&255|MSB,g>>>=7;case 3:u[h++]=g&255|MSB,g>>>=7;case 2:u[h++]=g&255|MSB,g>>>=7;case 1:{u[h++]=g&255,g>>>=7;break}default:throw new Error("unreachable")}return u}function encodeUint8ArrayList(g,u,h=0){switch(encodingLength(g)){case 8:u.set(h++,g&255|MSB),g/=128;case 7:u.set(h++,g&255|MSB),g/=128;case 6:u.set(h++,g&255|MSB),g/=128;case 5:u.set(h++,g&255|MSB),g/=128;case 4:u.set(h++,g&255|MSB),g>>>=7;case 3:u.set(h++,g&255|MSB),g>>>=7;case 2:u.set(h++,g&255|MSB),g>>>=7;case 1:{u.set(h++,g&255),g>>>=7;break}default:throw new Error("unreachable")}return u}function decodeUint8Array(g,u){let h=g[u],y=0;if(y+=h&REST,h<MSB||(h=g[u+1],y+=(h&REST)<<7,h<MSB)||(h=g[u+2],y+=(h&REST)<<14,h<MSB)||(h=g[u+3],y+=(h&REST)<<21,h<MSB)||(h=g[u+4],y+=(h&REST)*N4,h<MSB)||(h=g[u+5],y+=(h&REST)*N5,h<MSB)||(h=g[u+6],y+=(h&REST)*N6,h<MSB)||(h=g[u+7],y+=(h&REST)*N7,h<MSB))return y;throw new RangeError("Could not decode varint")}function decodeUint8ArrayList(g,u){let h=g.get(u),y=0;if(y+=h&REST,h<MSB||(h=g.get(u+1),y+=(h&REST)<<7,h<MSB)||(h=g.get(u+2),y+=(h&REST)<<14,h<MSB)||(h=g.get(u+3),y+=(h&REST)<<21,h<MSB)||(h=g.get(u+4),y+=(h&REST)*N4,h<MSB)||(h=g.get(u+5),y+=(h&REST)*N5,h<MSB)||(h=g.get(u+6),y+=(h&REST)*N6,h<MSB)||(h=g.get(u+7),y+=(h&REST)*N7,h<MSB))return y;throw new RangeError("Could not decode varint")}function encode$2(g,u,h=0){return u==null&&(u=allocUnsafe(encodingLength(g))),u instanceof Uint8Array?encodeUint8Array(g,u,h):encodeUint8ArrayList(g,u,h)}function decode$3(g,u=0){return g instanceof Uint8Array?decodeUint8Array(g,u):decodeUint8ArrayList(g,u)}const f32=new Float32Array([-0]),f8b=new Uint8Array(f32.buffer);function writeFloatLE(g,u,h){f32[0]=g,u[h]=f8b[0],u[h+1]=f8b[1],u[h+2]=f8b[2],u[h+3]=f8b[3]}function readFloatLE(g,u){return f8b[0]=g[u],f8b[1]=g[u+1],f8b[2]=g[u+2],f8b[3]=g[u+3],f32[0]}const f64=new Float64Array([-0]),d8b=new Uint8Array(f64.buffer);function writeDoubleLE(g,u,h){f64[0]=g,u[h]=d8b[0],u[h+1]=d8b[1],u[h+2]=d8b[2],u[h+3]=d8b[3],u[h+4]=d8b[4],u[h+5]=d8b[5],u[h+6]=d8b[6],u[h+7]=d8b[7]}function readDoubleLE(g,u){return d8b[0]=g[u],d8b[1]=g[u+1],d8b[2]=g[u+2],d8b[3]=g[u+3],d8b[4]=g[u+4],d8b[5]=g[u+5],d8b[6]=g[u+6],d8b[7]=g[u+7],f64[0]}const MAX_SAFE_NUMBER_INTEGER=BigInt(Number.MAX_SAFE_INTEGER),MIN_SAFE_NUMBER_INTEGER=BigInt(Number.MIN_SAFE_INTEGER);class LongBits{lo;hi;constructor(u,h){this.lo=u|0,this.hi=h|0}toNumber(u=!1){if(!u&&this.hi>>>31>0){const h=~this.lo+1>>>0;let y=~this.hi>>>0;return h===0&&(y=y+1>>>0),-(h+y*4294967296)}return this.lo+this.hi*4294967296}toBigInt(u=!1){if(u)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){const h=~this.lo+1>>>0;let y=~this.hi>>>0;return h===0&&(y=y+1>>>0),-(BigInt(h)+(BigInt(y)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(u=!1){return this.toBigInt(u).toString()}zzEncode(){const u=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^u)>>>0,this.lo=(this.lo<<1^u)>>>0,this}zzDecode(){const u=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^u)>>>0,this.hi=(this.hi>>>1^u)>>>0,this}length(){const u=this.lo,h=(this.lo>>>28|this.hi<<4)>>>0,y=this.hi>>>24;return y===0?h===0?u<16384?u<128?1:2:u<2097152?3:4:h<16384?h<128?5:6:h<2097152?7:8:y<128?9:10}static fromBigInt(u){if(u===0n)return zero;if(u<MAX_SAFE_NUMBER_INTEGER&&u>MIN_SAFE_NUMBER_INTEGER)return this.fromNumber(Number(u));const h=u<0n;h&&(u=-u);let y=u>>32n,v=u-(y<<32n);return h&&(y=~y|0n,v=~v|0n,++v>TWO_32&&(v=0n,++y>TWO_32&&(y=0n))),new LongBits(Number(v),Number(y))}static fromNumber(u){if(u===0)return zero;const h=u<0;h&&(u=-u);let y=u>>>0,v=(u-y)/4294967296>>>0;return h&&(v=~v>>>0,y=~y>>>0,++y>4294967295&&(y=0,++v>4294967295&&(v=0))),new LongBits(y,v)}static from(u){return typeof u=="number"?LongBits.fromNumber(u):typeof u=="bigint"?LongBits.fromBigInt(u):typeof u=="string"?LongBits.fromBigInt(BigInt(u)):u.low!=null||u.high!=null?new LongBits(u.low>>>0,u.high>>>0):zero}}const zero=new LongBits(0,0);zero.toBigInt=function(){return 0n};zero.zzEncode=zero.zzDecode=function(){return this};zero.length=function(){return 1};const TWO_32=4294967296n;function length(g){let u=0,h=0;for(let y=0;y<g.length;++y)h=g.charCodeAt(y),h<128?u+=1:h<2048?u+=2:(h&64512)===55296&&(g.charCodeAt(y+1)&64512)===56320?(++y,u+=4):u+=3;return u}function read$1(g,u,h){if(h-u<1)return"";let v;const b=[];let w=0,E;for(;u<h;)E=g[u++],E<128?b[w++]=E:E>191&&E<224?b[w++]=(E&31)<<6|g[u++]&63:E>239&&E<365?(E=((E&7)<<18|(g[u++]&63)<<12|(g[u++]&63)<<6|g[u++]&63)-65536,b[w++]=55296+(E>>10),b[w++]=56320+(E&1023)):b[w++]=(E&15)<<12|(g[u++]&63)<<6|g[u++]&63,w>8191&&((v??(v=[])).push(String.fromCharCode.apply(String,b)),w=0);return v!=null?(w>0&&v.push(String.fromCharCode.apply(String,b.slice(0,w))),v.join("")):String.fromCharCode.apply(String,b.slice(0,w))}function write$1(g,u,h){const y=h;let v,b;for(let w=0;w<g.length;++w)v=g.charCodeAt(w),v<128?u[h++]=v:v<2048?(u[h++]=v>>6|192,u[h++]=v&63|128):(v&64512)===55296&&((b=g.charCodeAt(w+1))&64512)===56320?(v=65536+((v&1023)<<10)+(b&1023),++w,u[h++]=v>>18|240,u[h++]=v>>12&63|128,u[h++]=v>>6&63|128,u[h++]=v&63|128):(u[h++]=v>>12|224,u[h++]=v>>6&63|128,u[h++]=v&63|128);return h-y}function indexOutOfRange(g,u){return RangeError(`index out of range: ${g.pos} + ${u??1} > ${g.len}`)}function readFixed32End(g,u){return(g[u-4]|g[u-3]<<8|g[u-2]<<16|g[u-1]<<24)>>>0}class Uint8ArrayReader{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(u){this.buf=u,this.pos=0,this.len=u.length}uint32(){let u=4294967295;if(u=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(u=(u|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(u=(u|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(u=(u|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(u=(u|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return u;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return u}int32(){return this.uint32()|0}sint32(){const u=this.uint32();return u>>>1^-(u&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32End(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32End(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);const u=readFloatLE(this.buf,this.pos);return this.pos+=4,u}double(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);const u=readDoubleLE(this.buf,this.pos);return this.pos+=8,u}bytes(){const u=this.uint32(),h=this.pos,y=this.pos+u;if(y>this.len)throw indexOutOfRange(this,u);return this.pos+=u,h===y?new Uint8Array(0):this.buf.subarray(h,y)}string(){const u=this.bytes();return read$1(u,0,u.length)}skip(u){if(typeof u=="number"){if(this.pos+u>this.len)throw indexOutOfRange(this,u);this.pos+=u}else do if(this.pos>=this.len)throw indexOutOfRange(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(u){switch(u){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(u=this.uint32()&7)!==4;)this.skipType(u);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${u} at offset ${this.pos}`)}return this}readLongVarint(){const u=new LongBits(0,0);let h=0;if(this.len-this.pos>4){for(;h<4;++h)if(u.lo=(u.lo|(this.buf[this.pos]&127)<<h*7)>>>0,this.buf[this.pos++]<128)return u;if(u.lo=(u.lo|(this.buf[this.pos]&127)<<28)>>>0,u.hi=(u.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return u;h=0}else{for(;h<3;++h){if(this.pos>=this.len)throw indexOutOfRange(this);if(u.lo=(u.lo|(this.buf[this.pos]&127)<<h*7)>>>0,this.buf[this.pos++]<128)return u}return u.lo=(u.lo|(this.buf[this.pos++]&127)<<h*7)>>>0,u}if(this.len-this.pos>4){for(;h<5;++h)if(u.hi=(u.hi|(this.buf[this.pos]&127)<<h*7+3)>>>0,this.buf[this.pos++]<128)return u}else for(;h<5;++h){if(this.pos>=this.len)throw indexOutOfRange(this);if(u.hi=(u.hi|(this.buf[this.pos]&127)<<h*7+3)>>>0,this.buf[this.pos++]<128)return u}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);const u=readFixed32End(this.buf,this.pos+=4),h=readFixed32End(this.buf,this.pos+=4);return new LongBits(u,h)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const u=decodeUint8Array(this.buf,this.pos);return this.pos+=encodingLength(u),u}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function createReader(g){return new Uint8ArrayReader(g instanceof Uint8Array?g:g.subarray())}function decodeMessage(g,u,h){const y=createReader(g);return u.decode(y,void 0,h)}function pool(g){let y,v=8192;return function(w){if(w<1||w>4096)return allocUnsafe(w);v+w>8192&&(y=allocUnsafe(8192),v=0);const E=y.subarray(v,v+=w);return(v&7)!==0&&(v=(v|7)+1),E}}class Op{fn;len;next;val;constructor(u,h,y){this.fn=u,this.len=h,this.next=void 0,this.val=y}}function noop(){}class State{head;tail;len;next;constructor(u){this.head=u.head,this.tail=u.tail,this.len=u.len,this.next=u.states}}const bufferPool=pool();function alloc(g){return globalThis.Buffer!=null?allocUnsafe(g):bufferPool(g)}class Uint8ArrayWriter{len;head;tail;states;constructor(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}_push(u,h,y){return this.tail=this.tail.next=new Op(u,h,y),this.len+=h,this}uint32(u){return this.len+=(this.tail=this.tail.next=new VarintOp((u=u>>>0)<128?1:u<16384?2:u<2097152?3:u<268435456?4:5,u)).len,this}int32(u){return u<0?this._push(writeVarint64,10,LongBits.fromNumber(u)):this.uint32(u)}sint32(u){return this.uint32((u<<1^u>>31)>>>0)}uint64(u){const h=LongBits.fromBigInt(u);return this._push(writeVarint64,h.length(),h)}uint64Number(u){return this._push(encodeUint8Array,encodingLength(u),u)}uint64String(u){return this.uint64(BigInt(u))}int64(u){return this.uint64(u)}int64Number(u){return this.uint64Number(u)}int64String(u){return this.uint64String(u)}sint64(u){const h=LongBits.fromBigInt(u).zzEncode();return this._push(writeVarint64,h.length(),h)}sint64Number(u){const h=LongBits.fromNumber(u).zzEncode();return this._push(writeVarint64,h.length(),h)}sint64String(u){return this.sint64(BigInt(u))}bool(u){return this._push(writeByte,1,u?1:0)}fixed32(u){return this._push(writeFixed32,4,u>>>0)}sfixed32(u){return this.fixed32(u)}fixed64(u){const h=LongBits.fromBigInt(u);return this._push(writeFixed32,4,h.lo)._push(writeFixed32,4,h.hi)}fixed64Number(u){const h=LongBits.fromNumber(u);return this._push(writeFixed32,4,h.lo)._push(writeFixed32,4,h.hi)}fixed64String(u){return this.fixed64(BigInt(u))}sfixed64(u){return this.fixed64(u)}sfixed64Number(u){return this.fixed64Number(u)}sfixed64String(u){return this.fixed64String(u)}float(u){return this._push(writeFloatLE,4,u)}double(u){return this._push(writeDoubleLE,8,u)}bytes(u){const h=u.length>>>0;return h===0?this._push(writeByte,1,0):this.uint32(h)._push(writeBytes,h,u)}string(u){const h=length(u);return h!==0?this.uint32(h)._push(write$1,h,u):this._push(writeByte,1,0)}fork(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this}ldelim(){const u=this.head,h=this.tail,y=this.len;return this.reset().uint32(y),y!==0&&(this.tail.next=u.next,this.tail=h,this.len+=y),this}finish(){let u=this.head.next;const h=alloc(this.len);let y=0;for(;u!=null;)u.fn(u.val,h,y),y+=u.len,u=u.next;return h}}function writeByte(g,u,h){u[h]=g&255}function writeVarint32(g,u,h){for(;g>127;)u[h++]=g&127|128,g>>>=7;u[h]=g}class VarintOp extends Op{next;constructor(u,h){super(writeVarint32,u,h),this.next=void 0}}function writeVarint64(g,u,h){for(;g.hi!==0;)u[h++]=g.lo&127|128,g.lo=(g.lo>>>7|g.hi<<25)>>>0,g.hi>>>=7;for(;g.lo>127;)u[h++]=g.lo&127|128,g.lo=g.lo>>>7;u[h++]=g.lo}function writeFixed32(g,u,h){u[h]=g&255,u[h+1]=g>>>8&255,u[h+2]=g>>>16&255,u[h+3]=g>>>24}function writeBytes(g,u,h){u.set(g,h)}globalThis.Buffer!=null&&(Uint8ArrayWriter.prototype.bytes=function(g){const u=g.length>>>0;return this.uint32(u),u>0&&this._push(writeBytesBuffer,u,g),this},Uint8ArrayWriter.prototype.string=function(g){const u=globalThis.Buffer.byteLength(g);return this.uint32(u),u>0&&this._push(writeStringBuffer,u,g),this});function writeBytesBuffer(g,u,h){u.set(g,h)}function writeStringBuffer(g,u,h){g.length<40?write$1(g,u,h):u.utf8Write!=null?u.utf8Write(g,h):u.set(fromString(g),h)}function createWriter(){return new Uint8ArrayWriter}function encodeMessage(g,u){const h=createWriter();return u.encode(g,h,{lengthDelimited:!1}),h.finish()}var CODEC_TYPES;(function(g){g[g.VARINT=0]="VARINT",g[g.BIT64=1]="BIT64",g[g.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",g[g.START_GROUP=3]="START_GROUP",g[g.END_GROUP=4]="END_GROUP",g[g.BIT32=5]="BIT32"})(CODEC_TYPES||(CODEC_TYPES={}));function createCodec(g,u,h,y){return{name:g,type:u,encode:h,decode:y}}function enumeration(g){function u(v){if(g[v.toString()]==null)throw new Error("Invalid enum value");return g[v]}const h=function(b,w){const E=u(b);w.int32(E)},y=function(b){const w=b.int32();return u(w)};return createCodec("enum",CODEC_TYPES.VARINT,h,y)}function message(g,u){return createCodec("message",CODEC_TYPES.LENGTH_DELIMITED,g,u)}class MaxLengthError extends Error{code="ERR_MAX_LENGTH";name="MaxLengthError"}class MaxSizeError extends Error{code="ERR_MAX_SIZE";name="MaxSizeError"}var KeyType;(function(g){g.RSA="RSA",g.Ed25519="Ed25519",g.secp256k1="secp256k1",g.ECDSA="ECDSA"})(KeyType||(KeyType={}));var __KeyTypeValues;(function(g){g[g.RSA=0]="RSA",g[g.Ed25519=1]="Ed25519",g[g.secp256k1=2]="secp256k1",g[g.ECDSA=3]="ECDSA"})(__KeyTypeValues||(__KeyTypeValues={}));(function(g){g.codec=()=>enumeration(__KeyTypeValues)})(KeyType||(KeyType={}));var PublicKey;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.Type!=null&&(y.uint32(8),KeyType.codec().encode(h.Type,y)),h.Data!=null&&(y.uint32(18),y.bytes(h.Data)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.Type=KeyType.codec().decode(h);break}case 2:{b.Data=h.bytes();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(PublicKey||(PublicKey={}));var PrivateKey;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.Type!=null&&(y.uint32(8),KeyType.codec().encode(h.Type,y)),h.Data!=null&&(y.uint32(18),y.bytes(h.Data)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.Type=KeyType.codec().decode(h);break}case 2:{b.Data=h.bytes();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(PrivateKey||(PrivateKey={}));function randomBytes$2(g){if(isNaN(g)||g<=0)throw new InvalidParametersError$1("random bytes length must be a Number bigger than 0");return randomBytes$3(g)}class RSAPublicKey{type="RSA";jwk;_raw;_multihash;constructor(u,h){this.jwk=u,this._multihash=h}get raw(){return this._raw==null&&(this._raw=jwkToPkix(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return CID.createV1(114,this._multihash)}toString(){return base58btc.encode(this.toMultihash().bytes).substring(1)}equals(u){return u==null||!(u.raw instanceof Uint8Array)?!1:equals(this.raw,u.raw)}verify(u,h,y){return hashAndVerify$1(this.jwk,h,u,y)}}const SHA2_256_CODE=18,MAX_RSA_JWK_SIZE=1062,RSA_ALGORITHM_IDENTIFIER=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function pkixMessageToJwk(g){const u=decodeDer(g[1],{offset:0});return{kty:"RSA",n:toString$1(u[0],"base64url"),e:toString$1(u[1],"base64url")}}function jwkToPkix(g){if(g.n==null||g.e==null)throw new InvalidParametersError$1("JWK was missing components");return encodeSequence([RSA_ALGORITHM_IDENTIFIER,encodeBitString(encodeSequence([encodeInteger(fromString(g.n,"base64url")),encodeInteger(fromString(g.e,"base64url"))]))]).subarray()}function pkixToRSAPublicKey(g,u){if(g.byteLength>=MAX_RSA_JWK_SIZE)throw new InvalidPublicKeyError("Key size is too large");const h=decodeDer(g,{offset:0});return pkixMessageToRSAPublicKey(h,g,u)}function pkixMessageToRSAPublicKey(g,u,h){const y=pkixMessageToJwk(g);if(h==null){const v=sha256$4(PublicKey.encode({Type:KeyType.RSA,Data:u}));h=create(SHA2_256_CODE,v)}return new RSAPublicKey(y,h)}async function hashAndVerify$1(g,u,h,y){const v=await webcrypto.get().subtle.importKey("jwk",g,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);y?.signal?.throwIfAborted();const b=await webcrypto.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},v,u,h instanceof Uint8Array?h:h.subarray());return y?.signal?.throwIfAborted(),b}function hashAndVerify(g,u,h,y){const v=sha256$3.digest(h instanceof Uint8Array?h:h.subarray());if(isPromise$4(v))return v.then(({digest:b})=>(y?.signal?.throwIfAborted(),secp256k1$2.verify(u,b,g))).catch(b=>{throw b.name==="AbortError"?b:new VerificationError(String(b))});try{return y?.signal?.throwIfAborted(),secp256k1$2.verify(u,v.digest,g)}catch(b){throw new VerificationError(String(b))}}class Secp256k1PublicKey{type="secp256k1";raw;_key;constructor(u){this._key=validateSecp256k1PublicKey(u),this.raw=compressSecp256k1PublicKey(this._key)}toMultihash(){return identity$1.digest(publicKeyToProtobuf(this))}toCID(){return CID.createV1(114,this.toMultihash())}toString(){return base58btc.encode(this.toMultihash().bytes).substring(1)}equals(u){return u==null||!(u.raw instanceof Uint8Array)?!1:equals(this.raw,u.raw)}verify(u,h,y){return hashAndVerify(this._key,h,u,y)}}function unmarshalSecp256k1PublicKey(g){return new Secp256k1PublicKey(g)}function compressSecp256k1PublicKey(g){return secp256k1$2.ProjectivePoint.fromHex(g).toRawBytes(!0)}function validateSecp256k1PublicKey(g){try{return secp256k1$2.ProjectivePoint.fromHex(g),g}catch(u){throw new InvalidPublicKeyError(String(u))}}async function generateKeyPair(g,u){return generateEd25519KeyPair()}async function generateKeyPairFromSeed(g,u){return generateEd25519KeyPairFromSeed(u)}function publicKeyFromProtobuf(g,u){const{Type:h,Data:y}=PublicKey.decode(g),v=y??new Uint8Array;switch(h){case KeyType.RSA:return pkixToRSAPublicKey(v,u);case KeyType.Ed25519:return unmarshalEd25519PublicKey(v);case KeyType.secp256k1:return unmarshalSecp256k1PublicKey(v);case KeyType.ECDSA:return unmarshalECDSAPublicKey(v);default:throw new UnsupportedKeyTypeError}}function publicKeyFromMultihash(g){const{Type:u,Data:h}=PublicKey.decode(g.digest),y=h??new Uint8Array;switch(u){case KeyType.Ed25519:return unmarshalEd25519PublicKey(y);case KeyType.secp256k1:return unmarshalSecp256k1PublicKey(y);case KeyType.ECDSA:return unmarshalECDSAPublicKey(y);default:throw new UnsupportedKeyTypeError}}function publicKeyToProtobuf(g){return PublicKey.encode({Type:KeyType[g.type],Data:g.raw})}const inspect$2=Symbol.for("nodejs.util.inspect.custom"),LIBP2P_KEY_CODE$1=114;class PeerIdImpl{type;multihash;publicKey;string;constructor(u){this.type=u.type,this.multihash=u.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[peerIdSymbol]=!0;toString(){return this.string==null&&(this.string=base58btc.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return CID.createV1(LIBP2P_KEY_CODE$1,this.multihash)}toJSON(){return this.toString()}equals(u){if(u==null)return!1;if(u instanceof Uint8Array)return equals(this.multihash.bytes,u);if(typeof u=="string")return this.toString()===u;if(u?.toMultihash()?.bytes!=null)return equals(this.multihash.bytes,u.toMultihash().bytes);throw new Error("not valid Id")}[inspect$2](){return`PeerId(${this.toString()})`}}class RSAPeerId extends PeerIdImpl{type="RSA";publicKey;constructor(u){super({...u,type:"RSA"}),this.publicKey=u.publicKey}}class Ed25519PeerId extends PeerIdImpl{type="Ed25519";publicKey;constructor(u){super({...u,type:"Ed25519"}),this.publicKey=u.publicKey}}class Secp256k1PeerId extends PeerIdImpl{type="secp256k1";publicKey;constructor(u){super({...u,type:"secp256k1"}),this.publicKey=u.publicKey}}const TRANSPORT_IPFS_GATEWAY_HTTP_CODE$1=2336;class URLPeerId{type="url";multihash;publicKey;url;constructor(u){this.url=u.toString(),this.multihash=identity$1.digest(fromString(this.url))}[inspect$2](){return`PeerId(${this.url})`}[peerIdSymbol]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return CID.createV1(TRANSPORT_IPFS_GATEWAY_HTTP_CODE$1,this.toMultihash())}toJSON(){return this.toString()}equals(u){return u==null?!1:(u instanceof Uint8Array&&(u=toString$1(u)),u.toString()===this.toString())}}const LIBP2P_KEY_CODE=114,TRANSPORT_IPFS_GATEWAY_HTTP_CODE=2336;function peerIdFromString$1(g,u){let h;if(g.charAt(0)==="1"||g.charAt(0)==="Q")h=decode$5(base58btc.decode(`z${g}`));else{if(g.startsWith("k51qzi5uqu5")||g.startsWith("kzwfwjn5ji4")||g.startsWith("k2k4r8")||g.startsWith("bafz"))return peerIdFromCID(CID.parse(g));throw new InvalidParametersError$1('Please pass a multibase decoder for strings that do not start with "1" or "Q"')}return peerIdFromMultihash(h)}function peerIdFromPublicKey(g){if(g.type==="Ed25519")return new Ed25519PeerId({multihash:g.toCID().multihash,publicKey:g});if(g.type==="secp256k1")return new Secp256k1PeerId({multihash:g.toCID().multihash,publicKey:g});if(g.type==="RSA")return new RSAPeerId({multihash:g.toCID().multihash,publicKey:g});throw new UnsupportedKeyTypeError}function peerIdFromPrivateKey(g){return peerIdFromPublicKey(g.publicKey)}function peerIdFromMultihash(g){if(isSha256Multihash(g))return new RSAPeerId({multihash:g});if(isIdentityMultihash(g))try{const u=publicKeyFromMultihash(g);if(u.type==="Ed25519")return new Ed25519PeerId({multihash:g,publicKey:u});if(u.type==="secp256k1")return new Secp256k1PeerId({multihash:g,publicKey:u})}catch{const h=toString$1(g.digest);return new URLPeerId(new URL(h))}throw new InvalidMultihashError("Supplied PeerID Multihash is invalid")}function peerIdFromCID(g){if(g?.multihash==null||g.version==null||g.version===1&&g.code!==LIBP2P_KEY_CODE&&g.code!==TRANSPORT_IPFS_GATEWAY_HTTP_CODE)throw new InvalidCIDError("Supplied PeerID CID is invalid");if(g.code===TRANSPORT_IPFS_GATEWAY_HTTP_CODE){const u=toString$1(g.multihash.digest);return new URLPeerId(new URL(u))}return peerIdFromMultihash(g.multihash)}function isIdentityMultihash(g){return g.code===identity$1.code}function isSha256Multihash(g){return g.code===sha256$3.code}function stringifyWithBigInt(g){return JSON.stringify(g,(u,h)=>typeof h=="bigint"?`${h}n`:h)}function parseWithBigInt(g){return JSON.parse(g,(u,h)=>typeof h=="string"&&/^\d+n$/.test(h)?BigInt(h.slice(0,-1)):h)}function extractMessageType(g){const h=Object.entries(g).filter(([b,w])=>w!==void 0);if(h.length!==1)throw new Error(`Message must have exactly one defined field, found ${h.length}`);const[y,v]=h[0];return{type:y,payload:v}}function shouldExpectResponse(g){return"proofRequest"in g||"payoutRequest"in g||"templateRequest"in g||"task"in g||"taskAccepted"in g||"taskRejected"in g||"taskCompleted"in g||"payment"in g||"proofRequest"in g||"requestToWork"in g||"identifyRequest"in g||"bulkProofRequest"in g||!1}const MAX_LENGTH_LENGTH=8,MAX_DATA_LENGTH=1024*1024*4;let InvalidMessageLengthError$2=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},InvalidDataLengthError$2=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},InvalidDataLengthLengthError$2=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"},UnexpectedEOFError$2=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};function isAsyncIterable$8(g){return g[Symbol.asyncIterator]!=null}function validateMaxDataLength(g,u){if(g.byteLength>u)throw new InvalidDataLengthError$2("Message length too long")}const defaultEncoder=g=>{const u=encodingLength(g),h=allocUnsafe(u);return encode$2(g,h),defaultEncoder.bytes=u,h};defaultEncoder.bytes=0;function encode$1(g,u){u=u??{};const h=u.lengthEncoder??defaultEncoder,y=u?.maxDataLength??MAX_DATA_LENGTH;function*v(b){validateMaxDataLength(b,y);const w=h(b.byteLength);w instanceof Uint8Array?yield w:yield*w,b instanceof Uint8Array?yield b:yield*b}return isAsyncIterable$8(g)?(async function*(){for await(const b of g)yield*v(b)})():(function*(){for(const b of g)yield*v(b)})()}encode$1.single=(g,u)=>{u=u??{};const h=u.lengthEncoder??defaultEncoder,y=u?.maxDataLength??MAX_DATA_LENGTH;return validateMaxDataLength(g,y),new Uint8ArrayList(h(g.byteLength),g)};var ReadMode;(function(g){g[g.LENGTH=0]="LENGTH",g[g.DATA=1]="DATA"})(ReadMode||(ReadMode={}));const defaultDecoder=g=>{const u=decode$3(g);return defaultDecoder.bytes=encodingLength(u),u};defaultDecoder.bytes=0;function decode$2(g,u){const h=new Uint8ArrayList;let y=ReadMode.LENGTH,v=-1;const b=u?.lengthDecoder??defaultDecoder,w=u?.maxLengthLength??MAX_LENGTH_LENGTH,E=u?.maxDataLength??MAX_DATA_LENGTH;function*_(){for(;h.byteLength>0;){if(y===ReadMode.LENGTH)try{if(v=b(h),v<0)throw new InvalidMessageLengthError$2("Invalid message length");if(v>E)throw new InvalidDataLengthError$2("Message length too long");const S=b.bytes;h.consume(S),u?.onLength!=null&&u.onLength(v),y=ReadMode.DATA}catch(S){if(S instanceof RangeError){if(h.byteLength>w)throw new InvalidDataLengthLengthError$2("Message length length too long");break}throw S}if(y===ReadMode.DATA){if(h.byteLength<v)break;const S=h.sublist(0,v);h.consume(v),u?.onData!=null&&u.onData(S),yield S,y=ReadMode.LENGTH}}}return isAsyncIterable$8(g)?(async function*(){for await(const S of g)h.append(S),yield*_();if(h.byteLength>0)throw new UnexpectedEOFError$2("Unexpected end of input")})():(function*(){for(const S of g)h.append(S),yield*_();if(h.byteLength>0)throw new UnexpectedEOFError$2("Unexpected end of input")})()}decode$2.fromReader=(g,u)=>{let h=1;const y=(async function*(){for(;;)try{const{done:b,value:w}=await g.next(h);if(b===!0)return;w!=null&&(yield w)}catch(b){if(b.code==="ERR_UNDER_READ")return{done:!0,value:null};throw b}finally{h=1}})();return decode$2(y,{...u??{},onLength:b=>{h=b}})};function pDefer(){const g={};return g.promise=new Promise((u,h)=>{g.resolve=u,g.reject=h}),g}let AbortError$5=class extends Error{type;code;constructor(u,h,y){super(u??"The operation was aborted"),this.type="aborted",this.name=y??"AbortError",this.code=h??"ABORT_ERR"}};async function raceSignal$1(g,u,h){if(u==null)return g;if(u.aborted)return g.catch(()=>{}),Promise.reject(new AbortError$5(h?.errorMessage,h?.errorCode,h?.errorName));let y;const v=new AbortError$5(h?.errorMessage,h?.errorCode,h?.errorName);try{return await Promise.race([g,new Promise((b,w)=>{y=()=>{w(v)},u.addEventListener("abort",y)})])}finally{y!=null&&u.removeEventListener("abort",y)}}let QueuelessPushable$1=class{readNext;haveNext;ended;nextResult;error;constructor(){this.ended=!1,this.readNext=pDefer(),this.haveNext=pDefer()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const u=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=pDefer(),u}async throw(u){return this.ended=!0,this.error=u,u!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(u)),{done:!0,value:void 0}}async return(){const u={done:!0,value:void 0};return this.ended=!0,this.nextResult=u,this.haveNext.resolve(),u}async push(u,h){await this._push(u,h)}async end(u,h){u!=null?await this.throw(u):await this._push(void 0,h)}async _push(u,h){if(u!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;u!=null?this.nextResult={done:!1,value:u}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=pDefer(),await raceSignal$1(this.readNext.promise,h?.signal,h)}};function queuelessPushable$1(){return new QueuelessPushable$1}let UnexpectedEOFError$1=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};function byteStream$1(g,u){const h=queuelessPushable$1();g.sink(h).catch(async w=>{await h.end(w)}),g.sink=async w=>{for await(const E of w)await h.push(E);await h.end()};let y=g.source;g.source[Symbol.iterator]!=null?y=g.source[Symbol.iterator]():g.source[Symbol.asyncIterator]!=null&&(y=g.source[Symbol.asyncIterator]());const v=new Uint8ArrayList;return{read:async w=>{if(w?.signal?.throwIfAborted(),w?.bytes==null){const{done:_,value:S}=await raceSignal$1(y.next(),w?.signal);return _===!0?null:S}for(;v.byteLength<w.bytes;){const{value:_,done:S}=await raceSignal$1(y.next(),w?.signal);if(S===!0)throw new UnexpectedEOFError$1("unexpected end of input");v.append(_)}const E=v.sublist(0,w.bytes);return v.consume(w.bytes),E},write:async(w,E)=>{E?.signal?.throwIfAborted(),w instanceof Uint8Array?await h.push(w,E):await h.push(w.subarray(),E)},unwrap:()=>{if(v.byteLength>0){const w=g.source;g.source=(async function*(){u?.yieldBytes===!1?yield v:yield*v,yield*w})()}return g}}}let InvalidMessageLengthError$1=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},InvalidDataLengthError$1=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},InvalidDataLengthLengthError$1=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"};function lpStream$1(g,u={}){const h=byteStream$1(g,u);u.maxDataLength!=null&&u.maxLengthLength==null&&(u.maxLengthLength=encodingLength(u.maxDataLength));const y=u?.lengthDecoder??decode$3,v=u?.lengthEncoder??encode$2;return{read:async w=>{let E=-1;const _=new Uint8ArrayList;for(;;){_.append(await h.read({...w,bytes:1}));try{E=y(_)}catch(S){if(S instanceof RangeError)continue;throw S}if(E<0)throw new InvalidMessageLengthError$1("Invalid message length");if(u?.maxLengthLength!=null&&_.byteLength>u.maxLengthLength)throw new InvalidDataLengthLengthError$1("message length length too long");if(E>-1)break}if(u?.maxDataLength!=null&&E>u.maxDataLength)throw new InvalidDataLengthError$1("message length too long");return h.read({...w,bytes:E})},write:async(w,E)=>{await h.write(new Uint8ArrayList(v(w.byteLength),w),E)},writeV:async(w,E)=>{const _=new Uint8ArrayList(...w.flatMap(S=>[v(S.byteLength),S]));await h.write(_,E)},unwrap:()=>h.unwrap()}}function pair(){const g=pDefer();let u=!1;return{sink:async h=>{if(u)throw new Error("already piped");u=!0,g.resolve(h)},source:(async function*(){yield*await g.promise})()}}function duplexPair(){const g=pair(),u=pair();return[{source:g.source,sink:u.sink},{source:u.source,sink:g.sink}]}class FixedFIFO{buffer;mask;top;btm;next;constructor(u){if(!(u>0)||(u-1&u)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(u),this.mask=u-1,this.top=0,this.btm=0,this.next=null}push(u){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=u,this.top=this.top+1&this.mask,!0)}shift(){const u=this.buffer[this.btm];if(u!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,u}isEmpty(){return this.buffer[this.btm]===void 0}}class FIFO{size;hwm;head;tail;constructor(u={}){this.hwm=u.splitLimit??16,this.head=new FixedFIFO(this.hwm),this.tail=this.head,this.size=0}calculateSize(u){return u?.byteLength!=null?u.byteLength:1}push(u){if(u?.value!=null&&(this.size+=this.calculateSize(u.value)),!this.head.push(u)){const h=this.head;this.head=h.next=new FixedFIFO(2*this.head.buffer.length),this.head.push(u)}}shift(){let u=this.tail.shift();if(u===void 0&&this.tail.next!=null){const h=this.tail.next;this.tail.next=null,this.tail=h,u=this.tail.shift()}return u?.value!=null&&(this.size-=this.calculateSize(u.value)),u}isEmpty(){return this.head.isEmpty()}}let AbortError$4=class extends Error{type;code;constructor(u,h){super(u??"The operation was aborted"),this.type="aborted",this.code=h??"ABORT_ERR"}};function pushable(g={}){return _pushable(h=>{const y=h.shift();if(y==null)return{done:!0};if(y.error!=null)throw y.error;return{done:y.done===!0,value:y.value}},g)}function _pushable(g,u){u=u??{};let h=u.onEnd,y=new FIFO,v,b,w,E=pDefer();const _=async()=>{try{return y.isEmpty()?w?{done:!0}:await new Promise((L,$)=>{b=B=>{b=null,y.push(B);try{L(g(y))}catch(U){$(U)}return v}}):g(y)}finally{y.isEmpty()&&queueMicrotask(()=>{E.resolve(),E=pDefer()})}},S=L=>b!=null?b(L):(y.push(L),v),A=L=>(y=new FIFO,b!=null?b({error:L}):(y.push({error:L}),v)),R=L=>{if(w)return v;if(u?.objectMode!==!0&&L?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return S({done:!1,value:L})},x=L=>w?v:(w=!0,L!=null?A(L):S({done:!0})),T=()=>(y=new FIFO,x(),{done:!0}),C=L=>(x(L),{done:!0});if(v={[Symbol.asyncIterator](){return this},next:_,return:T,throw:C,push:R,end:x,get readableLength(){return y.size},onEmpty:async L=>{const $=L?.signal;if($?.throwIfAborted(),y.isEmpty())return;let B,U;$!=null&&(B=new Promise((z,ne)=>{U=()=>{ne(new AbortError$4)},$.addEventListener("abort",U)}));try{await Promise.race([E.promise,B])}finally{U!=null&&$!=null&&$?.removeEventListener("abort",U)}}},h==null)return v;const I=v;return v={[Symbol.asyncIterator](){return this},next(){return I.next()},throw(L){return I.throw(L),h!=null&&(h(L),h=void 0),{done:!0}},return(){return I.return(),h!=null&&(h(),h=void 0),{done:!0}},push:R,end(L){return I.end(L),h!=null&&(h(L),h=void 0),v},get readableLength(){return I.readableLength},onEmpty:L=>I.onEmpty(L)},v}function isAsyncIterable$7(g){return g[Symbol.asyncIterator]!=null}async function addAllToPushable(g,u,h){try{await Promise.all(g.map(async y=>{for await(const v of y)await u.push(v,{signal:h}),h.throwIfAborted()})),await u.end(void 0,{signal:h})}catch(y){await u.end(y,{signal:h}).catch(()=>{})}}async function*mergeSources(g){const u=new AbortController,h=queuelessPushable$1();addAllToPushable(g,h,u.signal).catch(()=>{});try{yield*h}finally{u.abort()}}function*mergeSyncSources(g){for(const u of g)yield*u}function merge$1(...g){const u=[];for(const h of g)isAsyncIterable$7(h)||u.push(h);return u.length===g.length?mergeSyncSources(u):mergeSources(g)}function pipe(g,...u){if(g==null)throw new Error("Empty pipeline");if(isDuplex(g)){const y=g;g=()=>y.source}else if(isIterable(g)||isAsyncIterable$6(g)){const y=g;g=()=>y}const h=[g,...u];if(h.length>1&&isDuplex(h[h.length-1])&&(h[h.length-1]=h[h.length-1].sink),h.length>2)for(let y=1;y<h.length-1;y++)isDuplex(h[y])&&(h[y]=duplexPipelineFn(h[y]));return rawPipe(...h)}const rawPipe=(...g)=>{let u;for(;g.length>0;)u=g.shift()(u);return u},isAsyncIterable$6=g=>g?.[Symbol.asyncIterator]!=null,isIterable=g=>g?.[Symbol.iterator]!=null,isDuplex=g=>g==null?!1:g.sink!=null&&g.source!=null,duplexPipelineFn=g=>u=>{const h=g.sink(u);if(h?.then!=null){const y=pushable({objectMode:!0});h.then(()=>{y.end()},w=>{y.end(w)});let v;const b=g.source;if(isAsyncIterable$6(b))v=async function*(){yield*b,y.end()};else if(isIterable(b))v=function*(){yield*b,y.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return merge$1(y,v())}return g.source};var define_globalThis_process_env_default$2={};const NOISE_MSG_MAX_LENGTH_BYTES=65535,NOISE_MSG_MAX_LENGTH_BYTES_WITHOUT_TAG=NOISE_MSG_MAX_LENGTH_BYTES-16,DUMP_SESSION_KEYS=!!define_globalThis_process_env_default$2?.DUMP_SESSION_KEYS;/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function isBytes$2(g){return g instanceof Uint8Array||ArrayBuffer.isView(g)&&g.constructor.name==="Uint8Array"}function abool(g){if(typeof g!="boolean")throw new Error(`boolean expected, not ${g}`)}function anumber(g){if(!Number.isSafeInteger(g)||g<0)throw new Error("positive integer expected, got "+g)}function abytes$1(g,...u){if(!isBytes$2(g))throw new Error("Uint8Array expected");if(u.length>0&&!u.includes(g.length))throw new Error("Uint8Array expected of length "+u+", got length="+g.length)}function aexists(g,u=!0){if(g.destroyed)throw new Error("Hash instance has been destroyed");if(u&&g.finished)throw new Error("Hash#digest() has already been called")}function aoutput(g,u){abytes$1(g);const h=u.outputLen;if(g.length<h)throw new Error("digestInto() expects output buffer of length at least "+h)}function u32$1(g){return new Uint32Array(g.buffer,g.byteOffset,Math.floor(g.byteLength/4))}function clean(...g){for(let u=0;u<g.length;u++)g[u].fill(0)}function createView$1(g){return new DataView(g.buffer,g.byteOffset,g.byteLength)}const isLE$1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function utf8ToBytes$2(g){if(typeof g!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(g))}function toBytes$1(g){if(typeof g=="string")g=utf8ToBytes$2(g);else if(isBytes$2(g))g=copyBytes(g);else throw new Error("Uint8Array expected, got "+typeof g);return g}function checkOpts(g,u){if(u==null||typeof u!="object")throw new Error("options must be defined");return Object.assign(g,u)}function equalBytes$1(g,u){if(g.length!==u.length)return!1;let h=0;for(let y=0;y<g.length;y++)h|=g[y]^u[y];return h===0}const wrapCipher=(g,u)=>{function h(y,...v){if(abytes$1(y),!isLE$1)throw new Error("Non little-endian hardware is not yet supported");if(g.nonceLength!==void 0){const A=v[0];if(!A)throw new Error("nonce / iv required");g.varSizeNonce?abytes$1(A):abytes$1(A,g.nonceLength)}const b=g.tagLength;b&&v[1]!==void 0&&abytes$1(v[1]);const w=u(y,...v),E=(A,R)=>{if(R!==void 0){if(A!==2)throw new Error("cipher output not supported");abytes$1(R)}};let _=!1;return{encrypt(A,R){if(_)throw new Error("cannot encrypt() twice with same key + nonce");return _=!0,abytes$1(A),E(w.encrypt.length,R),w.encrypt(A,R)},decrypt(A,R){if(abytes$1(A),b&&A.length<b)throw new Error("invalid ciphertext length: smaller than tagLength="+b);return E(w.decrypt.length,R),w.decrypt(A,R)}}}return Object.assign(h,g),h};function getOutput(g,u,h=!0){if(u===void 0)return new Uint8Array(g);if(u.length!==g)throw new Error("invalid output length, expected "+g+", got: "+u.length);if(h&&!isAligned32$1(u))throw new Error("invalid output, must be aligned");return u}function setBigUint64$1(g,u,h,y){if(typeof g.setBigUint64=="function")return g.setBigUint64(u,h,y);const v=BigInt(32),b=BigInt(4294967295),w=Number(h>>v&b),E=Number(h&b),_=4,S=0;g.setUint32(u+_,w,y),g.setUint32(u+S,E,y)}function u64Lengths(g,u,h){abool(h);const y=new Uint8Array(16),v=createView$1(y);return setBigUint64$1(v,0,BigInt(u),h),setBigUint64$1(v,8,BigInt(g),h),y}function isAligned32$1(g){return g.byteOffset%4===0}function copyBytes(g){return Uint8Array.from(g)}const _utf8ToBytes=g=>Uint8Array.from(g.split("").map(u=>u.charCodeAt(0))),sigma16=_utf8ToBytes("expand 16-byte k"),sigma32=_utf8ToBytes("expand 32-byte k"),sigma16_32=u32$1(sigma16),sigma32_32=u32$1(sigma32);function rotl(g,u){return g<<u|g>>>32-u}function isAligned32(g){return g.byteOffset%4===0}const BLOCK_LEN=64,BLOCK_LEN32=16,MAX_COUNTER=2**32-1,U32_EMPTY=new Uint32Array;function runCipher(g,u,h,y,v,b,w,E){const _=v.length,S=new Uint8Array(BLOCK_LEN),A=u32$1(S),R=isAligned32(v)&&isAligned32(b),x=R?u32$1(v):U32_EMPTY,T=R?u32$1(b):U32_EMPTY;for(let C=0;C<_;w++){if(g(u,h,y,A,w,E),w>=MAX_COUNTER)throw new Error("arx: counter overflow");const I=Math.min(BLOCK_LEN,_-C);if(R&&I===BLOCK_LEN){const L=C/4;if(C%4!==0)throw new Error("arx: invalid block position");for(let $=0,B;$<BLOCK_LEN32;$++)B=L+$,T[B]=x[B]^A[$];C+=BLOCK_LEN;continue}for(let L=0,$;L<I;L++)$=C+L,b[$]=v[$]^S[L];C+=I}}function createCipher(g,u){const{allowShortKeys:h,extendNonceFn:y,counterLength:v,counterRight:b,rounds:w}=checkOpts({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},u);if(typeof g!="function")throw new Error("core must be a function");return anumber(v),anumber(w),abool(b),abool(h),(E,_,S,A,R=0)=>{abytes$1(E),abytes$1(_),abytes$1(S);const x=S.length;if(A===void 0&&(A=new Uint8Array(x)),abytes$1(A),anumber(R),R<0||R>=MAX_COUNTER)throw new Error("arx: counter overflow");if(A.length<x)throw new Error(`arx: output (${A.length}) is shorter than data (${x})`);const T=[];let C=E.length,I,L;if(C===32)T.push(I=copyBytes(E)),L=sigma32_32;else if(C===16&&h)I=new Uint8Array(32),I.set(E),I.set(E,16),L=sigma16_32,T.push(I);else throw new Error(`arx: invalid 32-byte key, got length=${C}`);isAligned32(_)||T.push(_=copyBytes(_));const $=u32$1(I);if(y){if(_.length!==24)throw new Error("arx: extended nonce must be 24 bytes");y(L,$,u32$1(_.subarray(0,16)),$),_=_.subarray(16)}const B=16-v;if(B!==_.length)throw new Error(`arx: nonce must be ${B} or 16 bytes`);if(B!==12){const z=new Uint8Array(12);z.set(_,b?0:12-_.length),_=z,T.push(_)}const U=u32$1(_);return runCipher(g,L,$,U,S,A,R,w),clean(...T),A}}const u8to16=(g,u)=>g[u++]&255|(g[u++]&255)<<8;class Poly1305{constructor(u){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,u=toBytes$1(u),abytes$1(u,32);const h=u8to16(u,0),y=u8to16(u,2),v=u8to16(u,4),b=u8to16(u,6),w=u8to16(u,8),E=u8to16(u,10),_=u8to16(u,12),S=u8to16(u,14);this.r[0]=h&8191,this.r[1]=(h>>>13|y<<3)&8191,this.r[2]=(y>>>10|v<<6)&7939,this.r[3]=(v>>>7|b<<9)&8191,this.r[4]=(b>>>4|w<<12)&255,this.r[5]=w>>>1&8190,this.r[6]=(w>>>14|E<<2)&8191,this.r[7]=(E>>>11|_<<5)&8065,this.r[8]=(_>>>8|S<<8)&8191,this.r[9]=S>>>5&127;for(let A=0;A<8;A++)this.pad[A]=u8to16(u,16+2*A)}process(u,h,y=!1){const v=y?0:2048,{h:b,r:w}=this,E=w[0],_=w[1],S=w[2],A=w[3],R=w[4],x=w[5],T=w[6],C=w[7],I=w[8],L=w[9],$=u8to16(u,h+0),B=u8to16(u,h+2),U=u8to16(u,h+4),z=u8to16(u,h+6),ne=u8to16(u,h+8),ue=u8to16(u,h+10),he=u8to16(u,h+12),Y=u8to16(u,h+14);let X=b[0]+($&8191),J=b[1]+(($>>>13|B<<3)&8191),j=b[2]+((B>>>10|U<<6)&8191),M=b[3]+((U>>>7|z<<9)&8191),N=b[4]+((z>>>4|ne<<12)&8191),P=b[5]+(ne>>>1&8191),O=b[6]+((ne>>>14|ue<<2)&8191),k=b[7]+((ue>>>11|he<<5)&8191),q=b[8]+((he>>>8|Y<<8)&8191),F=b[9]+(Y>>>5|v),H=0,D=H+X*E+J*(5*L)+j*(5*I)+M*(5*C)+N*(5*T);H=D>>>13,D&=8191,D+=P*(5*x)+O*(5*R)+k*(5*A)+q*(5*S)+F*(5*_),H+=D>>>13,D&=8191;let G=H+X*_+J*E+j*(5*L)+M*(5*I)+N*(5*C);H=G>>>13,G&=8191,G+=P*(5*T)+O*(5*x)+k*(5*R)+q*(5*A)+F*(5*S),H+=G>>>13,G&=8191;let W=H+X*S+J*_+j*E+M*(5*L)+N*(5*I);H=W>>>13,W&=8191,W+=P*(5*C)+O*(5*T)+k*(5*x)+q*(5*R)+F*(5*A),H+=W>>>13,W&=8191;let K=H+X*A+J*S+j*_+M*E+N*(5*L);H=K>>>13,K&=8191,K+=P*(5*I)+O*(5*C)+k*(5*T)+q*(5*x)+F*(5*R),H+=K>>>13,K&=8191;let Z=H+X*R+J*A+j*S+M*_+N*E;H=Z>>>13,Z&=8191,Z+=P*(5*L)+O*(5*I)+k*(5*C)+q*(5*T)+F*(5*x),H+=Z>>>13,Z&=8191;let ae=H+X*x+J*R+j*A+M*S+N*_;H=ae>>>13,ae&=8191,ae+=P*E+O*(5*L)+k*(5*I)+q*(5*C)+F*(5*T),H+=ae>>>13,ae&=8191;let le=H+X*T+J*x+j*R+M*A+N*S;H=le>>>13,le&=8191,le+=P*_+O*E+k*(5*L)+q*(5*I)+F*(5*C),H+=le>>>13,le&=8191;let te=H+X*C+J*T+j*x+M*R+N*A;H=te>>>13,te&=8191,te+=P*S+O*_+k*E+q*(5*L)+F*(5*I),H+=te>>>13,te&=8191;let ce=H+X*I+J*C+j*T+M*x+N*R;H=ce>>>13,ce&=8191,ce+=P*A+O*S+k*_+q*E+F*(5*L),H+=ce>>>13,ce&=8191;let ge=H+X*L+J*I+j*C+M*T+N*x;H=ge>>>13,ge&=8191,ge+=P*R+O*A+k*S+q*_+F*E,H+=ge>>>13,ge&=8191,H=(H<<2)+H|0,H=H+D|0,D=H&8191,H=H>>>13,G+=H,b[0]=D,b[1]=G,b[2]=W,b[3]=K,b[4]=Z,b[5]=ae,b[6]=le,b[7]=te,b[8]=ce,b[9]=ge}finalize(){const{h:u,pad:h}=this,y=new Uint16Array(10);let v=u[1]>>>13;u[1]&=8191;for(let E=2;E<10;E++)u[E]+=v,v=u[E]>>>13,u[E]&=8191;u[0]+=v*5,v=u[0]>>>13,u[0]&=8191,u[1]+=v,v=u[1]>>>13,u[1]&=8191,u[2]+=v,y[0]=u[0]+5,v=y[0]>>>13,y[0]&=8191;for(let E=1;E<10;E++)y[E]=u[E]+v,v=y[E]>>>13,y[E]&=8191;y[9]-=8192;let b=(v^1)-1;for(let E=0;E<10;E++)y[E]&=b;b=~b;for(let E=0;E<10;E++)u[E]=u[E]&b|y[E];u[0]=(u[0]|u[1]<<13)&65535,u[1]=(u[1]>>>3|u[2]<<10)&65535,u[2]=(u[2]>>>6|u[3]<<7)&65535,u[3]=(u[3]>>>9|u[4]<<4)&65535,u[4]=(u[4]>>>12|u[5]<<1|u[6]<<14)&65535,u[5]=(u[6]>>>2|u[7]<<11)&65535,u[6]=(u[7]>>>5|u[8]<<8)&65535,u[7]=(u[8]>>>8|u[9]<<5)&65535;let w=u[0]+h[0];u[0]=w&65535;for(let E=1;E<8;E++)w=(u[E]+h[E]|0)+(w>>>16)|0,u[E]=w&65535;clean(y)}update(u){aexists(this),u=toBytes$1(u),abytes$1(u);const{buffer:h,blockLen:y}=this,v=u.length;for(let b=0;b<v;){const w=Math.min(y-this.pos,v-b);if(w===y){for(;y<=v-b;b+=y)this.process(u,b);continue}h.set(u.subarray(b,b+w),this.pos),this.pos+=w,b+=w,this.pos===y&&(this.process(h,0,!1),this.pos=0)}return this}destroy(){clean(this.h,this.r,this.buffer,this.pad)}digestInto(u){aexists(this),aoutput(u,this),this.finished=!0;const{buffer:h,h:y}=this;let{pos:v}=this;if(v){for(h[v++]=1;v<16;v++)h[v]=0;this.process(h,0,!0)}this.finalize();let b=0;for(let w=0;w<8;w++)u[b++]=y[w]>>>0,u[b++]=y[w]>>>8;return u}digest(){const{buffer:u,outputLen:h}=this;this.digestInto(u);const y=u.slice(0,h);return this.destroy(),y}}function wrapConstructorWithKey(g){const u=(y,v)=>g(v).update(toBytes$1(y)).digest(),h=g(new Uint8Array(32));return u.outputLen=h.outputLen,u.blockLen=h.blockLen,u.create=y=>g(y),u}const poly1305=wrapConstructorWithKey(g=>new Poly1305(g));function chachaCore(g,u,h,y,v,b=20){let w=g[0],E=g[1],_=g[2],S=g[3],A=u[0],R=u[1],x=u[2],T=u[3],C=u[4],I=u[5],L=u[6],$=u[7],B=v,U=h[0],z=h[1],ne=h[2],ue=w,he=E,Y=_,X=S,J=A,j=R,M=x,N=T,P=C,O=I,k=L,q=$,F=B,H=U,D=z,G=ne;for(let K=0;K<b;K+=2)ue=ue+J|0,F=rotl(F^ue,16),P=P+F|0,J=rotl(J^P,12),ue=ue+J|0,F=rotl(F^ue,8),P=P+F|0,J=rotl(J^P,7),he=he+j|0,H=rotl(H^he,16),O=O+H|0,j=rotl(j^O,12),he=he+j|0,H=rotl(H^he,8),O=O+H|0,j=rotl(j^O,7),Y=Y+M|0,D=rotl(D^Y,16),k=k+D|0,M=rotl(M^k,12),Y=Y+M|0,D=rotl(D^Y,8),k=k+D|0,M=rotl(M^k,7),X=X+N|0,G=rotl(G^X,16),q=q+G|0,N=rotl(N^q,12),X=X+N|0,G=rotl(G^X,8),q=q+G|0,N=rotl(N^q,7),ue=ue+j|0,G=rotl(G^ue,16),k=k+G|0,j=rotl(j^k,12),ue=ue+j|0,G=rotl(G^ue,8),k=k+G|0,j=rotl(j^k,7),he=he+M|0,F=rotl(F^he,16),q=q+F|0,M=rotl(M^q,12),he=he+M|0,F=rotl(F^he,8),q=q+F|0,M=rotl(M^q,7),Y=Y+N|0,H=rotl(H^Y,16),P=P+H|0,N=rotl(N^P,12),Y=Y+N|0,H=rotl(H^Y,8),P=P+H|0,N=rotl(N^P,7),X=X+J|0,D=rotl(D^X,16),O=O+D|0,J=rotl(J^O,12),X=X+J|0,D=rotl(D^X,8),O=O+D|0,J=rotl(J^O,7);let W=0;y[W++]=w+ue|0,y[W++]=E+he|0,y[W++]=_+Y|0,y[W++]=S+X|0,y[W++]=A+J|0,y[W++]=R+j|0,y[W++]=x+M|0,y[W++]=T+N|0,y[W++]=C+P|0,y[W++]=I+O|0,y[W++]=L+k|0,y[W++]=$+q|0,y[W++]=B+F|0,y[W++]=U+H|0,y[W++]=z+D|0,y[W++]=ne+G|0}const chacha20=createCipher(chachaCore,{counterRight:!1,counterLength:4,allowShortKeys:!1}),ZEROS16=new Uint8Array(16),updatePadded=(g,u)=>{g.update(u);const h=u.length%16;h&&g.update(ZEROS16.subarray(h))},ZEROS32=new Uint8Array(32);function computeTag(g,u,h,y,v){const b=g(u,h,ZEROS32),w=poly1305.create(b);v&&updatePadded(w,v),updatePadded(w,y);const E=u64Lengths(y.length,v?v.length:0,!0);w.update(E);const _=w.digest();return clean(b,E),_}const _poly1305_aead=g=>(u,h,y)=>({encrypt(b,w){const E=b.length;w=getOutput(E+16,w,!1),w.set(b);const _=w.subarray(0,-16);g(u,h,_,_,1);const S=computeTag(g,u,h,_,y);return w.set(S,E),clean(S),w},decrypt(b,w){w=getOutput(b.length-16,w,!1);const E=b.subarray(0,-16),_=b.subarray(-16),S=computeTag(g,u,h,E,y);if(!equalBytes$1(_,S))throw new Error("invalid tag");return w.set(b.subarray(0,-16)),g(u,h,w,w,1),clean(S),w}}),chacha20poly1305=wrapCipher({blockSize:64,nonceLength:12,tagLength:16},_poly1305_aead(chacha20));function extract(g,u,h){return ahash(g),h===void 0&&(h=new Uint8Array(g.outputLen)),hmac$2(g,toBytes$2(h),toBytes$2(u))}const HKDF_COUNTER=Uint8Array.from([0]),EMPTY_BUFFER=Uint8Array.of();function expand(g,u,h,y=32){ahash(g),anumber$1(y);const v=g.outputLen;if(y>255*v)throw new Error("Length should be <= 255*HashLen");const b=Math.ceil(y/v);h===void 0&&(h=EMPTY_BUFFER);const w=new Uint8Array(b*v),E=hmac$2.create(g,u),_=E._cloneInto(),S=new Uint8Array(E.outputLen);for(let A=0;A<b;A++)HKDF_COUNTER[0]=A+1,_.update(A===0?EMPTY_BUFFER:S).update(h).update(HKDF_COUNTER).digestInto(S),w.set(S,v*A),E._cloneInto(_);return E.destroy(),_.destroy(),clean$1(S,HKDF_COUNTER),w.slice(0,y)}const pureJsCrypto={hashSHA256(g){return sha256$4(g.subarray())},getHKDF(g,u){const h=extract(sha256$4,u,g),v=expand(sha256$4,h,void 0,96),b=v.subarray(0,32),w=v.subarray(32,64),E=v.subarray(64,96);return[b,w,E]},generateX25519KeyPair(){const g=x25519.utils.randomPrivateKey();return{publicKey:x25519.getPublicKey(g),privateKey:g}},generateX25519KeyPairFromSeed(g){return{publicKey:x25519.getPublicKey(g),privateKey:g}},generateX25519SharedKey(g,u){return x25519.getSharedSecret(g.subarray(),u.subarray())},chaCha20Poly1305Encrypt(g,u,h,y){return chacha20poly1305(y,u,h).encrypt(g.subarray())},chaCha20Poly1305Decrypt(g,u,h,y,v){return chacha20poly1305(y,u,h).decrypt(g.subarray(),v)}},defaultCrypto=pureJsCrypto;function wrapCrypto(g){return{generateKeypair:g.generateX25519KeyPair,dh:(u,h)=>g.generateX25519SharedKey(u.privateKey,h).subarray(0,32),encrypt:g.chaCha20Poly1305Encrypt,decrypt:g.chaCha20Poly1305Decrypt,hash:g.hashSHA256,hkdf:g.getHKDF}}const uint16BEEncode=g=>{const u=allocUnsafe(2);return u[0]=g>>8,u[1]=g,u};uint16BEEncode.bytes=2;const uint16BEDecode=g=>{if(g.length<2)throw RangeError("Could not decode int16BE");if(g instanceof Uint8Array){let u=0;return u+=g[0]<<8,u+=g[1],u}return g.getUint16(0)};uint16BEDecode.bytes=2;function registerMetrics(g){return{xxHandshakeSuccesses:g.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:g.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:g.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:g.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:g.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function logLocalStaticKeys(g,u){!u.enabled||!DUMP_SESSION_KEYS||(g?(u(`LOCAL_STATIC_PUBLIC_KEY ${toString$1(g.publicKey,"hex")}`),u(`LOCAL_STATIC_PRIVATE_KEY ${toString$1(g.privateKey,"hex")}`)):u("Missing local static keys."))}function logLocalEphemeralKeys(g,u){!u.enabled||!DUMP_SESSION_KEYS||(g?(u(`LOCAL_PUBLIC_EPHEMERAL_KEY ${toString$1(g.publicKey,"hex")}`),u(`LOCAL_PRIVATE_EPHEMERAL_KEY ${toString$1(g.privateKey,"hex")}`)):u("Missing local ephemeral keys."))}function logRemoteStaticKey(g,u){!u.enabled||!DUMP_SESSION_KEYS||u(g?`REMOTE_STATIC_PUBLIC_KEY ${toString$1(g.subarray(),"hex")}`:"Missing remote static public key.")}function logRemoteEphemeralKey(g,u){!u.enabled||!DUMP_SESSION_KEYS||u(g?`REMOTE_EPHEMERAL_PUBLIC_KEY ${toString$1(g.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function logCipherState(g,u,h){!h.enabled||!DUMP_SESSION_KEYS||(h(`CIPHER_STATE_1 ${g.n.getUint64()} ${g.k&&toString$1(g.k,"hex")}`),h(`CIPHER_STATE_2 ${u.n.getUint64()} ${u.k&&toString$1(u.k,"hex")}`))}class InvalidCryptoExchangeError extends Error{code;constructor(u="Invalid crypto exchange"){super(u),this.code=InvalidCryptoExchangeError.code}static code="ERR_INVALID_CRYPTO_EXCHANGE"}const MIN_NONCE=0,MAX_NONCE=4294967295,ERR_MAX_NONCE="Cipherstate has reached maximum n, a new handshake must be performed";class Nonce{n;bytes;view;constructor(u=MIN_NONCE){this.n=u,this.bytes=alloc$1(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,u,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>MAX_NONCE)throw new Error(ERR_MAX_NONCE)}}const ZEROLEN=alloc$1(0);class CipherState{k;n;crypto;constructor(u,h=void 0,y=0){this.crypto=u,this.k=h,this.n=new Nonce(y)}hasKey(){return!!this.k}encryptWithAd(u,h){if(!this.hasKey())return h;this.n.assertValue();const y=this.crypto.encrypt(h,this.n.getBytes(),u,this.k);return this.n.increment(),y}decryptWithAd(u,h,y){if(!this.hasKey())return h;this.n.assertValue();const v=this.crypto.decrypt(h,this.n.getBytes(),u,this.k,y);return this.n.increment(),v}}class SymmetricState{cs;ck;h;crypto;constructor(u,h){this.crypto=u;const y=fromString(h,"utf-8");this.h=hashProtocolName(u,y),this.ck=this.h,this.cs=new CipherState(u)}mixKey(u){const[h,y]=this.crypto.hkdf(this.ck,u);this.ck=h,this.cs=new CipherState(this.crypto,y)}mixHash(u){this.h=this.crypto.hash(new Uint8ArrayList(this.h,u))}encryptAndHash(u){const h=this.cs.encryptWithAd(this.h,u);return this.mixHash(h),h}decryptAndHash(u){const h=this.cs.decryptWithAd(this.h,u);return this.mixHash(u),h}split(){const[u,h]=this.crypto.hkdf(this.ck,ZEROLEN);return[new CipherState(this.crypto,u),new CipherState(this.crypto,h)]}}class AbstractHandshakeState{ss;s;e;rs;re;initiator;crypto;constructor(u){const{crypto:h,protocolName:y,prologue:v,initiator:b,s:w,e:E,rs:_,re:S}=u;this.crypto=h,this.ss=new SymmetricState(h,y),this.ss.mixHash(v),this.initiator=b,this.s=w,this.e=E,this.rs=_,this.re=S}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");const u=this.crypto.generateKeypair();return this.ss.mixHash(u.publicKey),this.e=u,u.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(u,h=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(u.byteLength<h+32)throw new Error("message is not long enough");this.re=u.sublist(h,h+32),this.ss.mixHash(this.re)}readS(u,h=0){if(this.rs)throw new Error("remote static public key is already set");const y=32+(this.ss.cs.hasKey()?16:0);if(u.byteLength<h+y)throw new Error("message is not long enough");const v=u.sublist(h,h+y);return this.rs=this.ss.decryptAndHash(v),y}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}}class XXHandshakeState extends AbstractHandshakeState{writeMessageA(u){return new Uint8ArrayList(this.writeE(),this.ss.encryptAndHash(u))}writeMessageB(u){const h=this.writeE();this.writeEE();const y=this.writeS();return this.writeES(),new Uint8ArrayList(h,y,this.ss.encryptAndHash(u))}writeMessageC(u){const h=this.writeS();return this.writeSE(),new Uint8ArrayList(h,this.ss.encryptAndHash(u))}readMessageA(u){try{return this.readE(u),this.ss.decryptAndHash(u.sublist(32))}catch(h){throw new InvalidCryptoExchangeError(`handshake stage 0 validation fail: ${h.message}`)}}readMessageB(u){try{this.readE(u),this.readEE();const h=this.readS(u,32);return this.readES(),this.ss.decryptAndHash(u.sublist(32+h))}catch(h){throw new InvalidCryptoExchangeError(`handshake stage 1 validation fail: ${h.message}`)}}readMessageC(u){try{const h=this.readS(u);return this.readSE(),this.ss.decryptAndHash(u.sublist(h))}catch(h){throw new InvalidCryptoExchangeError(`handshake stage 2 validation fail: ${h.message}`)}}}function hashProtocolName(g,u){if(u.length<=32){const h=alloc$1(32);return h.set(u),h}else return g.hash(u)}var NoiseExtensions;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{if(v.lengthDelimited!==!1&&y.fork(),h.webtransportCerthashes!=null)for(const b of h.webtransportCerthashes)y.uint32(10),y.bytes(b);if(h.streamMuxers!=null)for(const b of h.streamMuxers)y.uint32(18),y.string(b);v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={webtransportCerthashes:[],streamMuxers:[]},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{if(v.limits?.webtransportCerthashes!=null&&b.webtransportCerthashes.length===v.limits.webtransportCerthashes)throw new MaxLengthError('Decode error - map field "webtransportCerthashes" had too many elements');b.webtransportCerthashes.push(h.bytes());break}case 2:{if(v.limits?.streamMuxers!=null&&b.streamMuxers.length===v.limits.streamMuxers)throw new MaxLengthError('Decode error - map field "streamMuxers" had too many elements');b.streamMuxers.push(h.string());break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(NoiseExtensions||(NoiseExtensions={}));var NoiseHandshakePayload;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.identityKey!=null&&h.identityKey.byteLength>0&&(y.uint32(10),y.bytes(h.identityKey)),h.identitySig!=null&&h.identitySig.byteLength>0&&(y.uint32(18),y.bytes(h.identitySig)),h.extensions!=null&&(y.uint32(34),NoiseExtensions.codec().encode(h.extensions,y)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={identityKey:alloc$1(0),identitySig:alloc$1(0)},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.identityKey=h.bytes();break}case 2:{b.identitySig=h.bytes();break}case 4:{b.extensions=NoiseExtensions.codec().decode(h,h.uint32(),{limits:v.limits?.extensions});break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(NoiseHandshakePayload||(NoiseHandshakePayload={}));async function createHandshakePayload(g,u,h){const y=await g.sign(getSignaturePayload(u));return NoiseHandshakePayload.encode({identityKey:publicKeyToProtobuf(g.publicKey),identitySig:y,extensions:h})}async function decodeHandshakePayload(g,u,h){try{const y=NoiseHandshakePayload.decode(g),v=publicKeyFromProtobuf(y.identityKey);if(h?.equals(v)===!1)throw new Error(`Payload identity key ${v} does not match expected remote identity key ${h}`);if(!u)throw new Error("Remote static does not exist");const b=getSignaturePayload(u);if(!await v.verify(b,y.identitySig))throw new Error("Invalid payload signature");return y}catch(y){throw new UnexpectedPeerError(y.message)}}function getSignaturePayload(g){const u=fromString("noise-libp2p-static-key:");return g instanceof Uint8Array?concat([u,g],u.length+g.length):(g.prepend(u),g)}async function performHandshakeInitiator(g,u){const{log:h,connection:y,crypto:v,privateKey:b,prologue:w,s:E,remoteIdentityKey:_,extensions:S}=g,A=await createHandshakePayload(b,E.publicKey,S),R=new XXHandshakeState({crypto:v,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:w,s:E});logLocalStaticKeys(R.s,h),h.trace("Stage 0 - Initiator starting to send first message."),await y.write(R.writeMessageA(ZEROLEN),u),h.trace("Stage 0 - Initiator finished sending first message."),logLocalEphemeralKeys(R.e,h),h.trace("Stage 1 - Initiator waiting to receive first message from responder...");const x=R.readMessageB(await y.read(u));h.trace("Stage 1 - Initiator received the message."),logRemoteEphemeralKey(R.re,h),logRemoteStaticKey(R.rs,h),h.trace("Initiator going to check remote's signature...");const T=await decodeHandshakePayload(x,R.rs,_);h.trace("All good with the signature!"),h.trace("Stage 2 - Initiator sending third handshake message."),await y.write(R.writeMessageC(A),u),h.trace("Stage 2 - Initiator sent message with signed payload.");const[C,I]=R.ss.split();return logCipherState(C,I,h),{payload:T,encrypt:L=>C.encryptWithAd(ZEROLEN,L),decrypt:(L,$)=>I.decryptWithAd(ZEROLEN,L,$)}}async function performHandshakeResponder(g,u){const{log:h,connection:y,crypto:v,privateKey:b,prologue:w,s:E,remoteIdentityKey:_,extensions:S}=g,A=await createHandshakePayload(b,E.publicKey,S),R=new XXHandshakeState({crypto:v,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:w,s:E});logLocalStaticKeys(R.s,h),h.trace("Stage 0 - Responder waiting to receive first message."),R.readMessageA(await y.read(u)),h.trace("Stage 0 - Responder received first message."),logRemoteEphemeralKey(R.re,h),h.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await y.write(R.writeMessageB(A),u),h.trace("Stage 1 - Responder sent the second handshake message with signed payload."),logLocalEphemeralKeys(R.e,h),h.trace("Stage 2 - Responder waiting for third handshake message...");const x=R.readMessageC(await y.read(u));h.trace("Stage 2 - Responder received the message, finished handshake.");const T=await decodeHandshakePayload(x,R.rs,_),[C,I]=R.ss.split();return logCipherState(C,I,h),{payload:T,encrypt:L=>I.encryptWithAd(ZEROLEN,L),decrypt:(L,$)=>C.decryptWithAd(ZEROLEN,L,$)}}const CHACHA_TAG_LENGTH=16;function encryptStream(g,u){return async function*(h){for await(const y of h)for(let v=0;v<y.length;v+=NOISE_MSG_MAX_LENGTH_BYTES_WITHOUT_TAG){let b=v+NOISE_MSG_MAX_LENGTH_BYTES_WITHOUT_TAG;b>y.length&&(b=y.length);let w;y instanceof Uint8Array?w=g.encrypt(y.subarray(v,b)):w=g.encrypt(y.sublist(v,b)),u?.encryptedPackets.increment(),yield new Uint8ArrayList(uint16BEEncode(w.byteLength),w)}}}function decryptStream(g,u){return async function*(h){for await(const y of h)for(let v=0;v<y.length;v+=NOISE_MSG_MAX_LENGTH_BYTES){let b=v+NOISE_MSG_MAX_LENGTH_BYTES;if(b>y.length&&(b=y.length),b-CHACHA_TAG_LENGTH<v)throw new Error("Invalid chunk");const w=y.sublist(v,b),E=y.subarray(v,b-CHACHA_TAG_LENGTH);try{const _=g.decrypt(w,E);u?.decryptedPackets.increment(),yield _}catch(_){throw u?.decryptErrors.increment(),_}}}}class Noise{protocol="/noise";crypto;prologue;staticKey;extensions;metrics;components;constructor(u,h={}){const{staticNoiseKey:y,extensions:v,crypto:b,prologueBytes:w}=h,{metrics:E}=u;this.components=u;const _=b??defaultCrypto;this.crypto=wrapCrypto(_),this.extensions={webtransportCerthashes:[],...v},this.metrics=E?registerMetrics(E):void 0,y?this.staticKey=_.generateX25519KeyPairFromSeed(y):this.staticKey=_.generateX25519KeyPair(),this.prologue=w??alloc$1(0)}[Symbol.toStringTag]="@chainsafe/libp2p-noise";[serviceCapabilities]=["@libp2p/connection-encryption","@chainsafe/libp2p-noise"];async secureOutbound(u,h){const y=lpStream$1(u,{lengthEncoder:uint16BEEncode,lengthDecoder:uint16BEDecode,maxDataLength:NOISE_MSG_MAX_LENGTH_BYTES}),v=await this.performHandshakeInitiator(y,this.components.privateKey,h?.remotePeer?.publicKey,h),b=await this.createSecureConnection(y,v);u.source=b.source,u.sink=b.sink;const w=publicKeyFromProtobuf(v.payload.identityKey);return{conn:u,remoteExtensions:v.payload.extensions,remotePeer:peerIdFromPublicKey(w),streamMuxer:h?.skipStreamMuxerNegotiation===!0?void 0:this.getStreamMuxer(v.payload.extensions?.streamMuxers)}}getStreamMuxer(u){if(u==null||u.length===0)return;const h=this.components.upgrader.getStreamMuxers();if(h!=null)for(const y of u){const v=h.get(y);if(v!=null)return v}if(u.length)throw new InvalidCryptoExchangeError$1("Early muxer negotiation was requested but the initiator and responder had no common muxers")}async secureInbound(u,h){const y=lpStream$1(u,{lengthEncoder:uint16BEEncode,lengthDecoder:uint16BEDecode,maxDataLength:NOISE_MSG_MAX_LENGTH_BYTES}),v=await this.performHandshakeResponder(y,this.components.privateKey,h?.remotePeer?.publicKey,h),b=await this.createSecureConnection(y,v);u.source=b.source,u.sink=b.sink;const w=publicKeyFromProtobuf(v.payload.identityKey);return{conn:u,remoteExtensions:v.payload.extensions,remotePeer:peerIdFromPublicKey(w),streamMuxer:h?.skipStreamMuxerNegotiation===!0?void 0:this.getStreamMuxer(v.payload.extensions?.streamMuxers)}}async performHandshakeInitiator(u,h,y,v){let b;const w=v?.skipStreamMuxerNegotiation===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{b=await performHandshakeInitiator({connection:u,privateKey:h,remoteIdentityKey:y,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:w,webtransportCerthashes:[],...this.extensions}},v),this.metrics?.xxHandshakeSuccesses.increment()}catch(E){throw this.metrics?.xxHandshakeErrors.increment(),E}return b}async performHandshakeResponder(u,h,y,v){let b;const w=v?.skipStreamMuxerNegotiation===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{b=await performHandshakeResponder({connection:u,privateKey:h,remoteIdentityKey:y,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:w,webtransportCerthashes:[],...this.extensions}},v),this.metrics?.xxHandshakeSuccesses.increment()}catch(E){throw this.metrics?.xxHandshakeErrors.increment(),E}return b}async createSecureConnection(u,h){const[y,v]=duplexPair(),b=u.unwrap();return await pipe(y,encryptStream(h,this.metrics),b,w=>decode$2(w,{lengthDecoder:uint16BEDecode}),decryptStream(h,this.metrics),y),v}}function noise(g={}){return u=>new Noise(u,g)}function getIterator(g){if(g!=null){if(typeof g[Symbol.iterator]=="function")return g[Symbol.iterator]();if(typeof g[Symbol.asyncIterator]=="function")return g[Symbol.asyncIterator]();if(typeof g.next=="function")return g}throw new Error("argument is not an iterator or iterable")}class InvalidFrameError extends Error{static name="InvalidFrameError";constructor(u="The frame was invalid"){super(u),this.name="InvalidFrameError"}}class UnrequestedPingError extends Error{static name="UnrequestedPingError";constructor(u="Unrequested ping error"){super(u),this.name="UnrequestedPingError"}}class NotMatchingPingError extends Error{static name="NotMatchingPingError";constructor(u="Unrequested ping error"){super(u),this.name="NotMatchingPingError"}}class InvalidStateError extends Error{static name="InvalidStateError";constructor(u="Invalid state"){super(u),this.name="InvalidStateError"}}class StreamAlreadyExistsError extends Error{static name="StreamAlreadyExistsError";constructor(u="Strean already exists"){super(u),this.name="StreamAlreadyExistsError"}}class DecodeInvalidVersionError extends Error{static name="DecodeInvalidVersionError";constructor(u="Decode invalid version"){super(u),this.name="DecodeInvalidVersionError"}}class BothClientsError extends Error{static name="BothClientsError";constructor(u="Both clients"){super(u),this.name="BothClientsError"}}class ReceiveWindowExceededError extends Error{static name="ReceiveWindowExceededError";constructor(u="Receive window exceeded"){super(u),this.name="ReceiveWindowExceededError"}}const PROTOCOL_ERRORS=new Set([InvalidFrameError.name,UnrequestedPingError.name,NotMatchingPingError.name,StreamAlreadyExistsError.name,DecodeInvalidVersionError.name,BothClientsError.name,ReceiveWindowExceededError.name]),INITIAL_STREAM_WINDOW=256*1024,MAX_STREAM_WINDOW=16*1024*1024,defaultConfig={enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:INITIAL_STREAM_WINDOW,maxStreamWindowSize:MAX_STREAM_WINDOW,maxMessageSize:64*1024};function verifyConfig(g){if(g.keepAliveInterval<=0)throw new InvalidParametersError$1("keep-alive interval must be positive");if(g.maxInboundStreams<0)throw new InvalidParametersError$1("max inbound streams must be larger or equal 0");if(g.maxOutboundStreams<0)throw new InvalidParametersError$1("max outbound streams must be larger or equal 0");if(g.initialStreamWindowSize<INITIAL_STREAM_WINDOW)throw new InvalidParametersError$1("InitialStreamWindowSize must be larger or equal 256 kB");if(g.maxStreamWindowSize<g.initialStreamWindowSize)throw new InvalidParametersError$1("MaxStreamWindowSize must be larger than the InitialStreamWindowSize");if(g.maxStreamWindowSize>2**32-1)throw new InvalidParametersError$1("MaxStreamWindowSize must be less than equal MAX_UINT32");if(g.maxMessageSize<1024)throw new InvalidParametersError$1("MaxMessageSize must be greater than a kilobyte")}var FrameType;(function(g){g[g.Data=0]="Data",g[g.WindowUpdate=1]="WindowUpdate",g[g.Ping=2]="Ping",g[g.GoAway=3]="GoAway"})(FrameType||(FrameType={}));var Flag;(function(g){g[g.SYN=1]="SYN",g[g.ACK=2]="ACK",g[g.FIN=4]="FIN",g[g.RST=8]="RST"})(Flag||(Flag={}));Object.values(Flag).filter(g=>typeof g!="string");const YAMUX_VERSION=0;var GoAwayCode;(function(g){g[g.NormalTermination=0]="NormalTermination",g[g.ProtocolError=1]="ProtocolError",g[g.InternalError=2]="InternalError"})(GoAwayCode||(GoAwayCode={}));const HEADER_LENGTH=12,twoPow24=2**24;function decodeHeader(g){if(g[0]!==YAMUX_VERSION)throw new InvalidFrameError("Invalid frame version");return{type:g[1],flag:(g[2]<<8)+g[3],streamID:g[4]*twoPow24+(g[5]<<16)+(g[6]<<8)+g[7],length:g[8]*twoPow24+(g[9]<<16)+(g[10]<<8)+g[11]}}let Decoder$1=class{source;buffer;frameInProgress;constructor(u){this.source=returnlessSource(u),this.buffer=new Uint8ArrayList,this.frameInProgress=!1}async*emitFrames(){for await(const u of this.source)for(this.buffer.append(u);;){const h=this.readHeader();if(h===void 0)break;const{type:y,length:v}=h;y===FrameType.Data?(this.frameInProgress=!0,yield{header:h,readData:this.readBytes.bind(this,v)}):yield{header:h}}}readHeader(){if(this.frameInProgress)throw new InvalidStateError("decoding frame already in progress");if(this.buffer.length<HEADER_LENGTH)return;const u=decodeHeader(this.buffer.subarray(0,HEADER_LENGTH));return this.buffer.consume(HEADER_LENGTH),u}async readBytes(u){if(this.buffer.length<u){for await(const y of this.source)if(this.buffer.append(y),this.buffer.length>=u)break}const h=this.buffer.sublist(0,u);return this.buffer.consume(u),this.frameInProgress=!1,h}};function returnlessSource(g){if(g[Symbol.iterator]!==void 0){const u=g[Symbol.iterator]();return u.return=void 0,{[Symbol.iterator](){return u}}}else if(g[Symbol.asyncIterator]!==void 0){const u=g[Symbol.asyncIterator]();return u.return=void 0,{[Symbol.asyncIterator](){return u}}}else throw new Error("a source must be either an iterable or an async iterable")}function encodeHeader(g){const u=new Uint8Array(HEADER_LENGTH);return u[1]=g.type,u[2]=g.flag>>>8,u[3]=g.flag,u[4]=g.streamID>>>24,u[5]=g.streamID>>>16,u[6]=g.streamID>>>8,u[7]=g.streamID,u[8]=g.length>>>24,u[9]=g.length>>>16,u[10]=g.length>>>8,u[11]=g.length,u}function isPromise$3(g){return g==null?!1:typeof g.then=="function"&&typeof g.catch=="function"&&typeof g.finally=="function"}function closeSource(g,u){const h=getIterator(g).return?.();isPromise$3(h)&&h.catch(y=>{u.error("could not cause iterator to return",y)})}const DEFAULT_SEND_CLOSE_WRITE_TIMEOUT=5e3;function isPromise$2(g){return g==null?!1:typeof g.then=="function"&&typeof g.catch=="function"&&typeof g.finally=="function"}class AbstractStream{id;direction;timeline;protocol;metadata;source;status;readStatus;writeStatus;log;sinkController;sinkEnd;closed;endErr;streamSource;onEnd;onCloseRead;onCloseWrite;onReset;onAbort;sendCloseWriteTimeout;sendingData;constructor(u){this.sinkController=new AbortController,this.sinkEnd=pDefer(),this.closed=pDefer(),this.log=u.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=u.id,this.metadata=u.metadata??{},this.direction=u.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=u.sendCloseWriteTimeout??DEFAULT_SEND_CLOSE_WRITE_TIMEOUT,this.onEnd=u.onEnd,this.onCloseRead=u.onCloseRead,this.onCloseWrite=u.onCloseWrite,this.onReset=u.onReset,this.onAbort=u.onAbort,this.source=this.streamSource=pushable({onEnd:h=>{h!=null?this.log.trace("source ended with error",h):this.log.trace("source ended"),this.onSourceEnd(h)}}),this.sink=this.sink.bind(this)}async sink(u){if(this.writeStatus!=="ready")throw new StreamStateError(`writable end state is "${this.writeStatus}" not "ready"`);try{this.writeStatus="writing";const h={signal:this.sinkController.signal};if(this.direction==="outbound"){const v=this.sendNewStream(h);isPromise$2(v)&&await v}const y=()=>{closeSource(u,this.log)};try{this.sinkController.signal.addEventListener("abort",y),this.log.trace("sink reading from source");for await(let v of u){v=v instanceof Uint8Array?new Uint8ArrayList(v):v;const b=this.sendData(v,h);isPromise$2(b)&&(this.sendingData=pDefer(),await b,this.sendingData.resolve(),this.sendingData=void 0)}}finally{this.sinkController.signal.removeEventListener("abort",y)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),this.writeStatus==="writing"&&(this.writeStatus="closing",this.log.trace("send close write to remote"),await this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(h){throw this.log.trace("sink ended with error, calling abort with error",h),this.abort(h),h}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(u){this.timeline.closeRead==null&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",u!=null&&this.endErr==null&&(this.endErr=u),this.onCloseRead?.(),this.timeline.closeWrite!=null?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(u){this.timeline.closeWrite==null&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",u!=null&&this.endErr==null&&(this.endErr=u),this.onCloseWrite?.(),this.timeline.closeRead!=null?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}async close(u){this.status==="open"&&(this.log.trace("closing gracefully"),this.status="closing",await raceSignal$1(Promise.all([this.closeWrite(u),this.closeRead(u),this.closed.promise]),u?.signal),this.status="closed",this.log.trace("closed gracefully"))}async closeRead(u={}){if(this.readStatus==="closing"||this.readStatus==="closed")return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);const h=this.readStatus;this.readStatus="closing",this.status!=="reset"&&this.status!=="aborted"&&this.timeline.closeRead==null&&(this.log.trace("send close read to remote"),await this.sendCloseRead(u)),h==="ready"&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")}async closeWrite(u={}){this.writeStatus==="closing"||this.writeStatus==="closed"||(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),this.writeStatus==="ready"&&(this.log.trace("sink was never sunk, sink an empty array"),await raceSignal$1(this.sink([]),u.signal)),this.writeStatus==="writing"&&(this.sendingData!=null&&await raceSignal$1(this.sendingData.promise,u.signal),this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),await raceSignal$1(this.sinkEnd.promise,u.signal)),this.writeStatus="closed",this.log.trace("closed writable end of stream"))}abort(u){if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;this.log("abort with error",u),this.log("try to send reset to remote");const h=this.sendReset();isPromise$2(h)&&h.catch(y=>{this.log.error("error sending reset message",y)}),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(u),this.onAbort?.(u)}reset(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;const u=new StreamResetError("stream reset");this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(u),this.onReset?.()}_closeSinkAndSource(u){this._closeSink(u),this._closeSource(u)}_closeSink(u){this.writeStatus==="writing"&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(u)}_closeSource(u){this.readStatus!=="closing"&&this.readStatus!=="closed"&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(u))}remoteCloseWrite(){if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("received remote close write but local source is already closed");return}this.log.trace("remote close write"),this._closeSource()}remoteCloseRead(){if(this.writeStatus==="closing"||this.writeStatus==="closed"){this.log("received remote close read but local sink is already closed");return}this.log.trace("remote close read"),this._closeSink()}destroy(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset"){this.log("received destroy but we are already closed");return}this.log.trace("stream destroyed"),this._closeSinkAndSource()}sourcePush(u){this.streamSource.push(u)}sourceReadableLength(){return this.streamSource.readableLength}}function peekable(g){const[u,h]=g[Symbol.asyncIterator]!=null?[g[Symbol.asyncIterator](),Symbol.asyncIterator]:[g[Symbol.iterator](),Symbol.iterator],y=[];return{peek:()=>u.next(),push:v=>{y.push(v)},next:()=>y.length>0?{done:!1,value:y.shift()}:u.next(),[h](){return this}}}function isAsyncIterable$5(g){return g[Symbol.asyncIterator]!=null}function isPromise$1(g){return g?.then!=null}function forEach$1(g,u){let h=0;if(isAsyncIterable$5(g))return(async function*(){for await(const _ of g){const S=u(_,h++);isPromise$1(S)&&await S,yield _}})();const y=peekable(g),{value:v,done:b}=y.next();if(b===!0)return(function*(){})();if(typeof u(v,h++)?.then=="function")return(async function*(){yield v;for(const _ of y){const S=u(_,h++);isPromise$1(S)&&await S,yield _}})();const E=u;return(function*(){yield v;for(const _ of y)E(_,h++),yield _})()}var StreamState;(function(g){g[g.Init=0]="Init",g[g.SYNSent=1]="SYNSent",g[g.SYNReceived=2]="SYNReceived",g[g.Established=3]="Established",g[g.Finished=4]="Finished"})(StreamState||(StreamState={}));class YamuxStream extends AbstractStream{name;state;config;_id;sendWindowCapacity;sendWindowCapacityUpdate;recvWindow;recvWindowCapacity;epochStart;getRTT;sendFrame;constructor(u){super({...u,onEnd:h=>{this.state=StreamState.Finished,u.onEnd?.(h)}}),this.config=u.config,this._id=parseInt(u.id,10),this.name=u.name,this.state=u.state,this.sendWindowCapacity=INITIAL_STREAM_WINDOW,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=u.getRTT,this.sendFrame=u.sendFrame,this.source=forEach$1(this.source,()=>{this.sendWindowUpdate()})}async sendNewStream(){}async sendData(u,h={}){for(u=u.sublist();u.byteLength!==0;){if(this.sendWindowCapacity===0&&(this.log?.trace("wait for send window capacity, status %s",this.status),await this.waitForSendWindowCapacity(h),this.status==="closed"||this.status==="aborted"||this.status==="reset")){this.log?.trace("%s while waiting for send window capacity",this.status);return}const y=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-HEADER_LENGTH,u.length),v=this.getSendFlags();this.sendFrame({type:FrameType.Data,flag:v,streamID:this._id,length:y},u.sublist(0,y)),this.sendWindowCapacity-=y,u.consume(y)}}async sendReset(){this.sendFrame({type:FrameType.WindowUpdate,flag:Flag.RST,streamID:this._id,length:0})}async sendCloseWrite(){const u=this.getSendFlags()|Flag.FIN;this.sendFrame({type:FrameType.WindowUpdate,flag:u,streamID:this._id,length:0})}async sendCloseRead(){}async waitForSendWindowCapacity(u={}){if(this.sendWindowCapacity>0)return;let h,y;const v=()=>{this.status==="open"||this.status==="closing"?y(new AbortError$6("Stream aborted")):h()};u.signal?.addEventListener("abort",v);try{await new Promise((b,w)=>{this.sendWindowCapacityUpdate=()=>{b()},y=w,h=b})}finally{u.signal?.removeEventListener("abort",v)}}handleWindowUpdate(u){this.log?.trace("stream received window update id=%s",this._id),this.processFlags(u.flag);const h=this.sendWindowCapacity;this.sendWindowCapacity+=u.length,h===0&&u.length>0&&this.sendWindowCapacityUpdate?.()}async handleData(u,h){if(this.log?.trace("stream received data id=%s",this._id),this.processFlags(u.flag),this.recvWindowCapacity<u.length)throw new ReceiveWindowExceededError("Receive window exceeded");const y=await h();this.recvWindowCapacity-=u.length,this.sourcePush(y)}processFlags(u){(u&Flag.ACK)===Flag.ACK&&this.state===StreamState.SYNSent&&(this.state=StreamState.Established),(u&Flag.FIN)===Flag.FIN&&this.remoteCloseWrite(),(u&Flag.RST)===Flag.RST&&this.reset()}getSendFlags(){switch(this.state){case StreamState.Init:return this.state=StreamState.SYNSent,Flag.SYN;case StreamState.SYNReceived:return this.state=StreamState.Established,Flag.ACK;default:return 0}}sendWindowUpdate(){const u=this.getSendFlags(),h=Date.now(),y=this.getRTT();if(u===0&&y>-1&&h-this.epochStart<y*4&&(this.recvWindow=Math.min(this.recvWindow*2,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&u===0)return;const v=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=h,this.sendFrame({type:FrameType.WindowUpdate,flag:u,streamID:this._id,length:v})}}const YAMUX_PROTOCOL_ID="/yamux/1.0.0",CLOSE_TIMEOUT$2=500;class Yamux{protocol=YAMUX_PROTOCOL_ID;_components;_init;constructor(u,h={}){this._components=u,this._init=h}[Symbol.toStringTag]="@chainsafe/libp2p-yamux";[serviceCapabilities]=["@libp2p/stream-multiplexing"];createStreamMuxer(u){return new YamuxMuxer(this._components,{...this._init,...u})}}class YamuxMuxer{protocol=YAMUX_PROTOCOL_ID;source;sink;config;log;logger;closeController;nextStreamID;_streams;nextPingID;activePing;rtt;client;localGoAway;remoteGoAway;numInboundStreams;numOutboundStreams;onIncomingStream;onStreamEnd;constructor(u,h){this.client=h.direction==="outbound",this.config={...defaultConfig,...h},this.logger=u.logger,this.log=this.logger.forComponent("libp2p:yamux"),verifyConfig(this.config),this.closeController=new AbortController,this.closeController.signal,this.onIncomingStream=h.onIncomingStream,this.onStreamEnd=h.onStreamEnd,this._streams=new Map,this.source=pushable({onEnd:()=>{this.log?.trace("muxer source ended"),this._streams.forEach(y=>{y.destroy()})}}),this.sink=async y=>{const v=()=>{const E=getIterator(y);if(E.return!=null){const _=E.return();isPromise(_)&&_.catch(S=>{this.log?.("could not cause sink source to return",S)})}};let b,w;try{const E=new Decoder$1(y);try{this.closeController.signal.addEventListener("abort",v);for await(const _ of E.emitFrames())await this.handleFrame(_.header,_.readData)}finally{this.closeController.signal.removeEventListener("abort",v)}b=GoAwayCode.NormalTermination}catch(E){PROTOCOL_ERRORS.has(E.name)?(this.log?.error("protocol error in sink",E),b=GoAwayCode.ProtocolError):(this.log?.error("internal error in sink",E),b=GoAwayCode.InternalError),w=E}this.log?.trace("muxer sink ended"),w!=null?this.abort(w,b):await this.close({reason:b})},this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=-1,this.log?.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch(y=>this.log?.error("keepalive error: %s",y)),this.ping().catch(y=>this.log?.error("ping error: %s",y))}get streams(){return Array.from(this._streams.values())}newStream(u){if(this.remoteGoAway!==void 0)throw new MuxerClosedError("Muxer closed remotely");if(this.localGoAway!==void 0)throw new MuxerClosedError("Muxer closed locally");const h=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new TooManyOutboundProtocolStreamsError("max outbound streams exceeded");this.log?.trace("new outgoing stream id=%s",h);const y=this._newStream(h,u,StreamState.Init,"outbound");return this._streams.set(h,y),this.numOutboundStreams++,y.sendWindowUpdate(),y}async ping(){if(this.remoteGoAway!==void 0)throw new MuxerClosedError("Muxer closed remotely");if(this.localGoAway!==void 0)throw new MuxerClosedError("Muxer closed locally");if(this.activePing===void 0){let u=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise((v,b)=>{const w=()=>{b(new MuxerClosedError("Muxer closed locally"))};this.closeController.signal.addEventListener("abort",w,{once:!0}),u=()=>{this.closeController.signal.removeEventListener("abort",w),v()}}),resolve:u};const h=Date.now();this.sendPing(this.activePing.id);try{await this.activePing.promise}finally{delete this.activePing}const y=Date.now();this.rtt=y-h}else await this.activePing.promise;return this.rtt}getRTT(){return this.rtt}async close(u={}){if(this.closeController.signal.aborted)return;const h=u?.reason??GoAwayCode.NormalTermination;if(this.log?.trace("muxer close reason=%s",h),u.signal==null){const y=AbortSignal.timeout(CLOSE_TIMEOUT$2);u={...u,signal:y}}try{await Promise.all([...this._streams.values()].map(async y=>y.close(u))),this.sendGoAway(h),this._closeMuxer()}catch(y){this.abort(y)}}abort(u,h){if(!this.closeController.signal.aborted){h=h??GoAwayCode.InternalError,this.log?.error("muxer abort reason=%s error=%s",h,u);for(const y of this._streams.values())y.abort(u);this.sendGoAway(h),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(u,h,y,v){if(this._streams.get(u)!=null)throw new InvalidParametersError$1("Stream already exists with that id");const b=new YamuxStream({id:u.toString(),name:h,state:y,direction:v,sendFrame:this.sendFrame.bind(this),onEnd:()=>{this.closeStream(u),this.onStreamEnd?.(b)},log:this.logger.forComponent(`libp2p:yamux:${v}:${u}`),config:this.config,getRTT:this.getRTT.bind(this)});return b}closeStream(u){this.client===(u%2===0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(u)}async keepAliveLoop(){for(this.log?.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let u;try{await raceSignal$1(new Promise(h=>{u=setTimeout(h,this.config.keepAliveInterval)}),this.closeController.signal),this.ping().catch(h=>this.log?.error("ping error: %s",h))}catch{clearInterval(u);return}}}async handleFrame(u,h){const{streamID:y,type:v,length:b}=u;if(this.log?.trace("received frame %o",u),y===0)switch(v){case FrameType.Ping:{this.handlePing(u);return}case FrameType.GoAway:{this.handleGoAway(b);return}default:throw new InvalidFrameError("Invalid frame type")}else switch(u.type){case FrameType.Data:case FrameType.WindowUpdate:{await this.handleStreamMessage(u,h);return}default:throw new InvalidFrameError("Invalid frame type")}}handlePing(u){if(u.flag===Flag.SYN)this.log?.trace("received ping request pingId=%s",u.length),this.sendPing(u.length,Flag.ACK);else if(u.flag===Flag.ACK)this.log?.trace("received ping response pingId=%s",u.length),this.handlePingResponse(u.length);else throw new InvalidFrameError("Invalid frame flag")}handlePingResponse(u){if(this.activePing===void 0)throw new UnrequestedPingError("ping not requested");if(this.activePing.id!==u)throw new NotMatchingPingError("ping doesn't match our id");this.activePing.resolve()}handleGoAway(u){this.log?.trace("received GoAway reason=%s",GoAwayCode[u]??"unknown"),this.remoteGoAway=u;for(const h of this._streams.values())h.reset();this._closeMuxer()}async handleStreamMessage(u,h){const{streamID:y,flag:v,type:b}=u;(v&Flag.SYN)===Flag.SYN&&this.incomingStream(y);const w=this._streams.get(y);if(w===void 0){if(b===FrameType.Data){if(this.log?.("discarding data for stream id=%s",y),h===void 0)throw new Error("unreachable");await h()}else this.log?.trace("frame for missing stream id=%s",y);return}switch(b){case FrameType.WindowUpdate:{w.handleWindowUpdate(u);return}case FrameType.Data:{if(h===void 0)throw new Error("unreachable");await w.handleData(u,h);return}default:throw new Error("unreachable")}}incomingStream(u){if(this.client!==(u%2===0))throw new InvalidParametersError$1("Both endpoints are clients");if(this._streams.has(u))return;if(this.log?.trace("new incoming stream id=%s",u),this.localGoAway!==void 0){this.sendFrame({type:FrameType.WindowUpdate,flag:Flag.RST,streamID:u,length:0});return}if(this.numInboundStreams>=this.config.maxInboundStreams){this.log?.("maxIncomingStreams exceeded, forcing stream reset"),this.sendFrame({type:FrameType.WindowUpdate,flag:Flag.RST,streamID:u,length:0});return}const h=this._newStream(u,void 0,StreamState.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(u,h),this.onIncomingStream?.(h)}sendFrame(u,h){if(this.log?.trace("sending frame %o",u),u.type===FrameType.Data){if(h===void 0)throw new InvalidFrameError("Invalid frame");this.source.push(new Uint8ArrayList(encodeHeader(u),h))}else this.source.push(encodeHeader(u))}sendPing(u,h=Flag.SYN){h===Flag.SYN?this.log?.trace("sending ping request pingId=%s",u):this.log?.trace("sending ping response pingId=%s",u),this.sendFrame({type:FrameType.Ping,flag:h,streamID:0,length:u})}sendGoAway(u=GoAwayCode.NormalTermination){this.log?.("sending GoAway reason=%s",GoAwayCode[u]),this.localGoAway=u,this.sendFrame({type:FrameType.GoAway,flag:0,streamID:0,length:u})}}function isPromise(g){return g!=null&&typeof g.then=="function"}function yamux(g={}){return u=>new Yamux(u,g)}var Envelope$1;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.publicKey!=null&&h.publicKey.byteLength>0&&(y.uint32(10),y.bytes(h.publicKey)),h.payloadType!=null&&h.payloadType.byteLength>0&&(y.uint32(18),y.bytes(h.payloadType)),h.payload!=null&&h.payload.byteLength>0&&(y.uint32(26),y.bytes(h.payload)),h.signature!=null&&h.signature.byteLength>0&&(y.uint32(42),y.bytes(h.signature)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={publicKey:alloc$1(0),payloadType:alloc$1(0),payload:alloc$1(0),signature:alloc$1(0)},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.publicKey=h.bytes();break}case 2:{b.payloadType=h.bytes();break}case 3:{b.payload=h.bytes();break}case 5:{b.signature=h.bytes();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(Envelope$1||(Envelope$1={}));class InvalidSignatureError extends Error{constructor(u="Invalid signature"){super(u),this.name="InvalidSignatureError"}}class RecordEnvelope{static createFromProtobuf=u=>{const h=Envelope$1.decode(u),y=publicKeyFromProtobuf(h.publicKey);return new RecordEnvelope({publicKey:y,payloadType:h.payloadType,payload:h.payload,signature:h.signature})};static seal=async(u,h,y)=>{if(h==null)throw new Error("Missing private key");const v=u.domain,b=u.codec,w=u.marshal(),E=formatSignaturePayload(v,b,w),_=await h.sign(E.subarray(),y);return new RecordEnvelope({publicKey:h.publicKey,payloadType:b,payload:w,signature:_})};static openAndCertify=async(u,h,y)=>{const v=RecordEnvelope.createFromProtobuf(u);if(!await v.validate(h,y))throw new InvalidSignatureError("Envelope signature is not valid for the given domain");return v};publicKey;payloadType;payload;signature;marshaled;constructor(u){const{publicKey:h,payloadType:y,payload:v,signature:b}=u;this.publicKey=h,this.payloadType=y,this.payload=v,this.signature=b}marshal(){return this.marshaled==null&&(this.marshaled=Envelope$1.encode({publicKey:publicKeyToProtobuf(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(u){return u==null?!1:equals(this.marshal(),u.marshal())}async validate(u,h){const y=formatSignaturePayload(u,this.payloadType,this.payload);return this.publicKey.verify(y.subarray(),this.signature,h)}}const formatSignaturePayload=(g,u,h)=>{const y=fromString(g),v=encode$2(y.byteLength),b=encode$2(u.length),w=encode$2(h.length);return new Uint8ArrayList(v,y,b,u,w,h)};function arrayEquals(g,u){const h=(y,v)=>y.toString().localeCompare(v.toString());return g.length!==u.length?!1:(u.sort(h),g.sort(h).every((y,v)=>u[v].equals(y)))}class InvalidMultiaddrError extends Error{static name="InvalidMultiaddrError";name="InvalidMultiaddrError"}class ValidationError extends Error{static name="ValidationError";name="ValidationError"}class InvalidParametersError extends Error{static name="InvalidParametersError";name="InvalidParametersError"}class UnknownProtocolError extends Error{static name="UnknownProtocolError";name="UnknownProtocolError"}let Parser$1=class{index=0;input="";new(u){return this.index=0,this.input=u,this}readAtomically(u){const h=this.index,y=u();return y===void 0&&(this.index=h),y}parseWith(u){const h=u();if(this.index===this.input.length)return h}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(u){return this.readAtomically(()=>{const h=this.readChar();if(h===u)return h})}readSeparator(u,h,y){return this.readAtomically(()=>{if(!(h>0&&this.readGivenChar(u)===void 0))return y()})}readNumber(u,h,y,v){return this.readAtomically(()=>{let b=0,w=0;const E=this.peekChar();if(E===void 0)return;const _=E==="0",S=2**(8*v)-1;for(;;){const A=this.readAtomically(()=>{const R=this.readChar();if(R===void 0)return;const x=Number.parseInt(R,u);if(!Number.isNaN(x))return x});if(A===void 0)break;if(b*=u,b+=A,b>S||(w+=1,h!==void 0&&w>h))return}if(w!==0)return!y&&_&&w>1?void 0:b})}readIPv4Addr(){return this.readAtomically(()=>{const u=new Uint8Array(4);for(let h=0;h<u.length;h++){const y=this.readSeparator(".",h,()=>this.readNumber(10,3,!1,1));if(y===void 0)return;u[h]=y}return u})}readIPv6Addr(){const u=h=>{for(let y=0;y<h.length/2;y++){const v=y*2;if(y<h.length-3){const w=this.readSeparator(":",y,()=>this.readIPv4Addr());if(w!==void 0)return h[v]=w[0],h[v+1]=w[1],h[v+2]=w[2],h[v+3]=w[3],[v+4,!0]}const b=this.readSeparator(":",y,()=>this.readNumber(16,4,!0,2));if(b===void 0)return[v,!1];h[v]=b>>8,h[v+1]=b&255}return[h.length,!1]};return this.readAtomically(()=>{const h=new Uint8Array(16),[y,v]=u(h);if(y===16)return h;if(v||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;const b=new Uint8Array(14),w=16-(y+2),[E]=u(b.subarray(0,w));return h.set(b.subarray(0,E),16-E),h})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};const MAX_IPV6_LENGTH=45,MAX_IPV4_LENGTH=15,parser$1=new Parser$1;function parseIPv4(g){if(!(g.length>MAX_IPV4_LENGTH))return parser$1.new(g).parseWith(()=>parser$1.readIPv4Addr())}function parseIPv6(g){if(g.includes("%")&&(g=g.split("%")[0]),!(g.length>MAX_IPV6_LENGTH))return parser$1.new(g).parseWith(()=>parser$1.readIPv6Addr())}function parseIP(g,u=!1){if(g.includes("%")&&(g=g.split("%")[0]),g.length>MAX_IPV6_LENGTH)return;const h=parser$1.new(g).parseWith(()=>parser$1.readIPAddr());if(h)return u&&h.length===4?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,h[0],h[1],h[2],h[3]]):h}function isIPv4(g){return!!parseIPv4(g)}function isIPv6(g){return!!parseIPv6(g)}const CODE_IP4=4,CODE_TCP=6,CODE_UDP=273,CODE_DCCP=33,CODE_IP6=41,CODE_IP6ZONE=42,CODE_IPCIDR=43,CODE_DNS=53,CODE_DNS4=54,CODE_DNS6=55,CODE_DNSADDR=56,CODE_SCTP=132,CODE_UDT=301,CODE_UTP=302,CODE_UNIX=400,CODE_P2P=421,CODE_ONION=444,CODE_ONION3=445,CODE_GARLIC64=446,CODE_GARLIC32=447,CODE_TLS=448,CODE_SNI=449,CODE_NOISE=454,CODE_QUIC=460,CODE_QUIC_V1=461,CODE_WEBTRANSPORT=465,CODE_CERTHASH=466,CODE_HTTP=480,CODE_HTTP_PATH=481,CODE_HTTPS=443,CODE_WS=477,CODE_WSS=478,CODE_P2P_WEBSOCKET_STAR=479,CODE_P2P_STARDUST=277,CODE_P2P_WEBRTC_STAR=275,CODE_P2P_WEBRTC_DIRECT=276,CODE_WEBRTC_DIRECT=280,CODE_WEBRTC=281,CODE_P2P_CIRCUIT=290,CODE_MEMORY=777;function bytesToString(g){return u=>toString$1(u,g)}function stringToBytes(g){return u=>fromString(u,g)}function bytes2port(g){return new DataView(g.buffer).getUint16(g.byteOffset).toString()}function port2bytes(g){const u=new ArrayBuffer(2);return new DataView(u).setUint16(0,typeof g=="string"?parseInt(g):g),new Uint8Array(u)}function onion2bytes(g){const u=g.split(":");if(u.length!==2)throw new Error(`failed to parse onion addr: ["'${u.join('", "')}'"]' does not contain a port number`);if(u[0].length!==16)throw new Error(`failed to parse onion addr: ${u[0]} not a Tor onion address.`);const h=fromString(u[0],"base32"),y=parseInt(u[1],10);if(y<1||y>65536)throw new Error("Port number is not in range(1, 65536)");const v=port2bytes(y);return concat([h,v],h.length+v.length)}function onion32bytes(g){const u=g.split(":");if(u.length!==2)throw new Error(`failed to parse onion addr: ["'${u.join('", "')}'"]' does not contain a port number`);if(u[0].length!==56)throw new Error(`failed to parse onion addr: ${u[0]} not a Tor onion3 address.`);const h=base32.decode(`b${u[0]}`),y=parseInt(u[1],10);if(y<1||y>65536)throw new Error("Port number is not in range(1, 65536)");const v=port2bytes(y);return concat([h,v],h.length+v.length)}function bytes2onion(g){const u=g.subarray(0,g.length-2),h=g.subarray(g.length-2),y=toString$1(u,"base32"),v=bytes2port(h);return`${y}:${v}`}const ip4ToBytes=function(g){g=g.toString().trim();const u=new Uint8Array(4);return g.split(/\./g).forEach((h,y)=>{const v=parseInt(h,10);if(isNaN(v)||v<0||v>255)throw new InvalidMultiaddrError("Invalid byte value in IP address");u[y]=v}),u},ip6ToBytes=function(g){let u=0;g=g.toString().trim();const h=g.split(":",8);let y;for(y=0;y<h.length;y++){const b=isIPv4(h[y]);let w;b&&(w=ip4ToBytes(h[y]),h[y]=toString$1(w.subarray(0,2),"base16")),w!=null&&++y<8&&h.splice(y,0,toString$1(w.subarray(2,4),"base16"))}if(h[0]==="")for(;h.length<8;)h.unshift("0");else if(h[h.length-1]==="")for(;h.length<8;)h.push("0");else if(h.length<8){for(y=0;y<h.length&&h[y]!=="";y++);const b=[y,1];for(y=9-h.length;y>0;y--)b.push("0");h.splice.apply(h,b)}const v=new Uint8Array(u+16);for(y=0;y<h.length;y++){h[y]===""&&(h[y]="0");const b=parseInt(h[y],16);if(isNaN(b)||b<0||b>65535)throw new InvalidMultiaddrError("Invalid byte value in IP address");v[u++]=b>>8&255,v[u++]=b&255}return v},ip4ToString=function(g){if(g.byteLength!==4)throw new InvalidMultiaddrError("IPv4 address was incorrect length");const u=[];for(let h=0;h<g.byteLength;h++)u.push(g[h]);return u.join(".")},ip6ToString=function(g){if(g.byteLength!==16)throw new InvalidMultiaddrError("IPv6 address was incorrect length");const u=[];for(let y=0;y<g.byteLength;y+=2){const v=g[y],b=g[y+1],w=`${v.toString(16).padStart(2,"0")}${b.toString(16).padStart(2,"0")}`;u.push(w)}const h=u.join(":");try{const y=new URL(`http://[${h}]`);return y.hostname.substring(1,y.hostname.length-1)}catch{throw new InvalidMultiaddrError(`Invalid IPv6 address "${h}"`)}};function ip6StringToValue(g){try{const u=new URL(`http://[${g}]`);return u.hostname.substring(1,u.hostname.length-1)}catch{throw new InvalidMultiaddrError(`Invalid IPv6 address "${g}"`)}}const decoders$1=Object.values(bases).map(g=>g.decoder),anybaseDecoder=(function(){let g=decoders$1[0].or(decoders$1[1]);return decoders$1.slice(2).forEach(u=>g=g.or(u)),g})();function mb2bytes(g){return anybaseDecoder.decode(g)}function bytes2mb(g){return u=>g.encoder.encode(u)}function integer(g){if(parseInt(g).toString()!==g)throw new ValidationError("Value must be an integer")}function positive(g){if(g<0)throw new ValidationError("Value must be a positive integer, or zero")}function maxValue(g){return u=>{if(u>g)throw new ValidationError(`Value must be smaller than or equal to ${g}`)}}function validate$1(...g){return u=>{for(const h of g)h(u)}}const validatePort=validate$1(integer,positive,maxValue(65535)),V=-1;class Registry{protocolsByCode=new Map;protocolsByName=new Map;getProtocol(u){let h;if(typeof u=="string"?h=this.protocolsByName.get(u):h=this.protocolsByCode.get(u),h==null)throw new UnknownProtocolError(`Protocol ${u} was unknown`);return h}addProtocol(u){this.protocolsByCode.set(u.code,u),this.protocolsByName.set(u.name,u),u.aliases?.forEach(h=>{this.protocolsByName.set(h,u)})}removeProtocol(u){const h=this.protocolsByCode.get(u);h!=null&&(this.protocolsByCode.delete(h.code),this.protocolsByName.delete(h.name),h.aliases?.forEach(y=>{this.protocolsByName.delete(y)}))}}const registry=new Registry,codecs=[{code:CODE_IP4,name:"ip4",size:32,valueToBytes:ip4ToBytes,bytesToValue:ip4ToString,validate:g=>{if(!isIPv4(g))throw new ValidationError(`Invalid IPv4 address "${g}"`)}},{code:CODE_TCP,name:"tcp",size:16,valueToBytes:port2bytes,bytesToValue:bytes2port,validate:validatePort},{code:CODE_UDP,name:"udp",size:16,valueToBytes:port2bytes,bytesToValue:bytes2port,validate:validatePort},{code:CODE_DCCP,name:"dccp",size:16,valueToBytes:port2bytes,bytesToValue:bytes2port,validate:validatePort},{code:CODE_IP6,name:"ip6",size:128,valueToBytes:ip6ToBytes,bytesToValue:ip6ToString,stringToValue:ip6StringToValue,validate:g=>{if(!isIPv6(g))throw new ValidationError(`Invalid IPv6 address "${g}"`)}},{code:CODE_IP6ZONE,name:"ip6zone",size:V},{code:CODE_IPCIDR,name:"ipcidr",size:8,bytesToValue:bytesToString("base10"),valueToBytes:stringToBytes("base10")},{code:CODE_DNS,name:"dns",size:V,resolvable:!0},{code:CODE_DNS4,name:"dns4",size:V,resolvable:!0},{code:CODE_DNS6,name:"dns6",size:V,resolvable:!0},{code:CODE_DNSADDR,name:"dnsaddr",size:V,resolvable:!0},{code:CODE_SCTP,name:"sctp",size:16,valueToBytes:port2bytes,bytesToValue:bytes2port,validate:validatePort},{code:CODE_UDT,name:"udt"},{code:CODE_UTP,name:"utp"},{code:CODE_UNIX,name:"unix",size:V,path:!0,stringToValue:g=>decodeURIComponent(g),valueToString:g=>encodeURIComponent(g)},{code:CODE_P2P,name:"p2p",aliases:["ipfs"],size:V,bytesToValue:bytesToString("base58btc"),valueToBytes:g=>g.startsWith("Q")||g.startsWith("1")?stringToBytes("base58btc")(g):CID.parse(g).multihash.bytes},{code:CODE_ONION,name:"onion",size:96,bytesToValue:bytes2onion,valueToBytes:onion2bytes},{code:CODE_ONION3,name:"onion3",size:296,bytesToValue:bytes2onion,valueToBytes:onion32bytes},{code:CODE_GARLIC64,name:"garlic64",size:V},{code:CODE_GARLIC32,name:"garlic32",size:V},{code:CODE_TLS,name:"tls"},{code:CODE_SNI,name:"sni",size:V},{code:CODE_NOISE,name:"noise"},{code:CODE_QUIC,name:"quic"},{code:CODE_QUIC_V1,name:"quic-v1"},{code:CODE_WEBTRANSPORT,name:"webtransport"},{code:CODE_CERTHASH,name:"certhash",size:V,bytesToValue:bytes2mb(base64url$3),valueToBytes:mb2bytes},{code:CODE_HTTP,name:"http"},{code:CODE_HTTP_PATH,name:"http-path",size:V,stringToValue:g=>`/${decodeURIComponent(g)}`,valueToString:g=>encodeURIComponent(g.substring(1))},{code:CODE_HTTPS,name:"https"},{code:CODE_WS,name:"ws"},{code:CODE_WSS,name:"wss"},{code:CODE_P2P_WEBSOCKET_STAR,name:"p2p-websocket-star"},{code:CODE_P2P_STARDUST,name:"p2p-stardust"},{code:CODE_P2P_WEBRTC_STAR,name:"p2p-webrtc-star"},{code:CODE_P2P_WEBRTC_DIRECT,name:"p2p-webrtc-direct"},{code:CODE_WEBRTC_DIRECT,name:"webrtc-direct"},{code:CODE_WEBRTC,name:"webrtc"},{code:CODE_P2P_CIRCUIT,name:"p2p-circuit"},{code:CODE_MEMORY,name:"memory",size:V}];codecs.forEach(g=>{registry.addProtocol(g)});function bytesToComponents(g){const u=[];let h=0;for(;h<g.length;){const y=decode$3(g,h),v=registry.getProtocol(y),b=encodingLength(y),w=sizeForAddr(v,g,h+b);let E=0;w>0&&v.size===V&&(E=encodingLength(w));const _=b+E+w,S={code:y,name:v.name,bytes:g.subarray(h,h+_)};if(w>0){const A=h+b+E,R=g.subarray(A,A+w);S.value=v.bytesToValue?.(R)??toString$1(R)}u.push(S),h+=_}return u}function componentsToBytes(g){let u=0;const h=[];for(const y of g){if(y.bytes==null){const v=registry.getProtocol(y.code),b=encodingLength(y.code);let w,E=0,_=0;y.value!=null&&(w=v.valueToBytes?.(y.value)??fromString(y.value),E=w.byteLength,v.size===V&&(_=encodingLength(E)));const S=new Uint8Array(b+_+E);let A=0;encodeUint8Array(y.code,S,A),A+=b,w!=null&&(v.size===V&&(encodeUint8Array(E,S,A),A+=_),S.set(w,A)),y.bytes=S}h.push(y.bytes),u+=y.bytes.byteLength}return concat(h,u)}function stringToComponents(g){if(g.charAt(0)!=="/")throw new InvalidMultiaddrError('String multiaddr must start with "/"');const u=[];let h="protocol",y="",v="";for(let b=1;b<g.length;b++){const w=g.charAt(b);w!=="/"&&(h==="protocol"?v+=g.charAt(b):y+=g.charAt(b));const E=b===g.length-1;if(w==="/"||E){const _=registry.getProtocol(v);if(h==="protocol"){if(_.size==null||_.size===0){u.push({code:_.code,name:_.name}),y="",v="",h="protocol";continue}else if(E)throw new InvalidMultiaddrError(`Component ${v} was missing value`);h="value"}else if(h==="value"){const S={code:_.code,name:_.name};if(_.size!=null&&_.size!==0){if(y==="")throw new InvalidMultiaddrError(`Component ${v} was missing value`);S.value=_.stringToValue?.(y)??y}u.push(S),y="",v="",h="protocol"}}}if(v!==""&&y!=="")throw new InvalidMultiaddrError("Incomplete multiaddr");return u}function componentsToString(g){return`/${g.flatMap(u=>{if(u.value==null)return u.name;const h=registry.getProtocol(u.code);if(h==null)throw new InvalidMultiaddrError(`Unknown protocol code ${u.code}`);return[u.name,h.valueToString?.(u.value)??u.value]}).join("/")}`}function sizeForAddr(g,u,h){return g.size==null||g.size===0?0:g.size>0?g.size/8:decode$3(u,h)}const inspect$1=Symbol.for("nodejs.util.inspect.custom"),symbol=Symbol.for("@multiformats/multiaddr"),DNS_CODES=[CODE_DNS,CODE_DNS4,CODE_DNS6,CODE_DNSADDR];class NoAvailableResolverError extends Error{constructor(u="No available resolver"){super(u),this.name="NoAvailableResolverError"}}function toComponents(g){if(g==null&&(g="/"),isMultiaddr(g))return g.getComponents();if(g instanceof Uint8Array)return bytesToComponents(g);if(typeof g=="string")return g=g.replace(/\/(\/)+/,"/").replace(/(\/)+$/,""),g===""&&(g="/"),stringToComponents(g);if(Array.isArray(g))return g;throw new InvalidMultiaddrError("Must be a string, Uint8Array, Component[], or another Multiaddr")}class Multiaddr{[symbol]=!0;#e;#t;#r;constructor(u="/",h={}){this.#e=toComponents(u),h.validate!==!1&&validate(this)}get bytes(){return this.#r==null&&(this.#r=componentsToBytes(this.#e)),this.#r}toString(){return this.#t==null&&(this.#t=componentsToString(this.#e)),this.#t}toJSON(){return this.toString()}toOptions(){let u,h,y,v,b="";for(const{code:E,name:_,value:S}of this.#e)E===CODE_IP6ZONE&&(b=`%${S??""}`),DNS_CODES.includes(E)&&(h="tcp",v=443,y=`${S??""}${b}`,u=E===CODE_DNS6?6:4),(E===CODE_TCP||E===CODE_UDP)&&(h=_==="tcp"?"tcp":"udp",v=parseInt(S??"")),(E===CODE_IP4||E===CODE_IP6)&&(h="tcp",y=`${S??""}${b}`,u=E===CODE_IP6?6:4);if(u==null||h==null||y==null||v==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:u,host:y,transport:h,port:v}}getComponents(){return[...this.#e]}protos(){return this.#e.map(({code:u,value:h})=>{const y=registry.getProtocol(u);return{code:u,size:y.size??0,name:y.name,resolvable:!!y.resolvable,path:!!y.path}})}protoCodes(){return this.#e.map(({code:u})=>u)}protoNames(){return this.#e.map(({name:u})=>u)}tuples(){return this.#e.map(({code:u,value:h})=>{if(h==null)return[u];const y=registry.getProtocol(u),v=[u];return h!=null&&v.push(y.valueToBytes?.(h)??fromString(h)),v})}stringTuples(){return this.#e.map(({code:u,value:h})=>h==null?[u]:[u,h])}encapsulate(u){const h=new Multiaddr(u);return new Multiaddr([...this.#e,...h.getComponents()],{validate:!1})}decapsulate(u){const h=u.toString(),y=this.toString(),v=y.lastIndexOf(h);if(v<0)throw new InvalidParametersError(`Address ${this.toString()} does not contain subaddress: ${u.toString()}`);return new Multiaddr(y.slice(0,v),{validate:!1})}decapsulateCode(u){let h;for(let y=this.#e.length-1;y>-1;y--)if(this.#e[y].code===u){h=y;break}return new Multiaddr(this.#e.slice(0,h),{validate:!1})}getPeerId(){try{let u=[];this.#e.forEach(({code:y,value:v})=>{y===CODE_P2P&&u.push([y,v]),y===CODE_P2P_CIRCUIT&&(u=[])});const h=u.pop();if(h?.[1]!=null){const y=h[1];return y[0]==="Q"||y[0]==="1"?toString$1(base58btc.decode(`z${y}`),"base58btc"):toString$1(CID.parse(y).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){for(const u of this.#e)if(registry.getProtocol(u.code).path)return u.value??null;return null}equals(u){return equals(this.bytes,u.bytes)}async resolve(u){const h=this.protos().find(b=>b.resolvable);if(h==null)return[this];const y=resolvers.get(h.name);if(y==null)throw new NoAvailableResolverError(`no available resolver for ${h.name}`);return(await y(this,u)).map(b=>multiaddr(b))}nodeAddress(){const u=this.toOptions();if(u.transport!=="tcp"&&u.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${u.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:u.family,address:u.host,port:u.port}}isThinWaistAddress(){return!(this.#e.length!==2||this.#e[0].code!==CODE_IP4&&this.#e[0].code!==CODE_IP6||this.#e[1].code!==CODE_TCP&&this.#e[1].code!==CODE_UDP)}[inspect$1](){return`Multiaddr(${this.toString()})`}}function validate(g){g.getComponents().forEach(u=>{const h=registry.getProtocol(u.code);u.value!=null&&h.validate?.(u.value)})}function allFF(g,u,h){let y=0;for(const v of g)if(!(y<u)){if(y>h)break;if(v!==255)return!1;y++}return!0}function deepEqual(g,u,h,y){let v=0;for(const b of g)if(!(v<h)){if(v>y)break;if(b!==u[v])return!1;v++}return!0}function ipToString(g){switch(g.length){case IPv4Len:return g.join(".");case IPv6Len:{const u=[];for(let h=0;h<g.length;h++)h%2===0&&u.push(g[h].toString(16).padStart(2,"0")+g[h+1].toString(16).padStart(2,"0"));return u.join(":")}default:throw new Error("Invalid ip length")}}function simpleMaskLength(g){let u=0;for(let[h,y]of g.entries()){if(y===255){u+=8;continue}for(;(y&128)!=0;)u++,y=y<<1;if((y&128)!=0)return-1;for(let v=h+1;v<g.length;v++)if(g[v]!=0)return-1;break}return u}function maskToHex(g){let u="0x";for(const h of g)u+=(h>>4).toString(16)+(h&15).toString(16);return u}const IPv4Len=4,IPv6Len=16,ipv4Prefix=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function maskIp(g,u){u.length===IPv6Len&&g.length===IPv4Len&&allFF(u,0,11)&&(u=u.slice(12)),u.length===IPv4Len&&g.length===IPv6Len&&deepEqual(g,ipv4Prefix,0,11)&&(g=g.slice(12));const h=g.length;if(h!=u.length)throw new Error("Failed to mask ip");const y=new Uint8Array(h);for(let v=0;v<h;v++)y[v]=g[v]&u[v];return y}function containsIp(g,u){if(typeof u=="string"&&(u=parseIP(u)),u==null)throw new Error("Invalid ip");if(u.length!==g.network.length)return!1;for(let h=0;h<u.length;h++)if((g.network[h]&g.mask[h])!==(u[h]&g.mask[h]))return!1;return!0}function parseCidr(g){const[u,h]=g.split("/");if(!u||!h)throw new Error("Failed to parse given CIDR: "+g);let y=IPv4Len,v=parseIPv4(u);if(v==null&&(y=IPv6Len,v=parseIPv6(u),v==null))throw new Error("Failed to parse given CIDR: "+g);const b=parseInt(h,10);if(Number.isNaN(b)||String(b).length!==h.length||b<0||b>y*8)throw new Error("Failed to parse given CIDR: "+g);const w=cidrMask(b,8*y);return{network:maskIp(v,w),mask:w}}function cidrMask(g,u){if(u!==8*IPv4Len&&u!==8*IPv6Len)throw new Error("Invalid CIDR mask");if(g<0||g>u)throw new Error("Invalid CIDR mask");const h=u/8,y=new Uint8Array(h);for(let v=0;v<h;v++){if(g>=8){y[v]=255,g-=8;continue}y[v]=255-(255>>g),g=0}return y}class IpNet{constructor(u,h){if(h==null)({network:this.network,mask:this.mask}=parseCidr(u));else{const y=parseIP(u);if(y==null)throw new Error("Failed to parse network");h=String(h);const v=parseInt(h,10);if(Number.isNaN(v)||String(v).length!==h.length||v<0||v>y.length*8){const b=parseIP(h);if(b==null)throw new Error("Failed to parse mask");this.mask=b}else this.mask=cidrMask(v,8*y.length);this.network=maskIp(y,this.mask)}}contains(u){return containsIp({network:this.network,mask:this.mask},u)}toString(){const u=simpleMaskLength(this.mask),h=u!==-1?String(u):maskToHex(this.mask);return ipToString(this.network)+"/"+h}}function cidrContains(g,u){return new IpNet(g).contains(u)}function convertToIpNet(g){let u,h;if(g.getComponents().forEach(y=>{(y.name==="ip4"||y.name==="ip6")&&(h=y.value),y.name==="ipcidr"&&(u=y.value)}),u==null||h==null)throw new Error("Invalid multiaddr");return new IpNet(h,u)}const resolvers=new Map;function isMultiaddr(g){return!!g?.[symbol]}function multiaddr(g){return new Multiaddr(g)}function protocols(g){const u=registry.getProtocol(g);return{code:u.code,size:u.size??0,name:u.name,resolvable:!!u.resolvable,path:!!u.path}}const ENVELOPE_DOMAIN_PEER_RECORD="libp2p-peer-record",ENVELOPE_PAYLOAD_TYPE_PEER_RECORD=Uint8Array.from([3,1]);var PeerRecord$1;(function(g){(function(h){let y;h.codec=()=>(y==null&&(y=message((v,b,w={})=>{w.lengthDelimited!==!1&&b.fork(),v.multiaddr!=null&&v.multiaddr.byteLength>0&&(b.uint32(10),b.bytes(v.multiaddr)),w.lengthDelimited!==!1&&b.ldelim()},(v,b,w={})=>{const E={multiaddr:alloc$1(0)},_=b==null?v.len:v.pos+b;for(;v.pos<_;){const S=v.uint32();switch(S>>>3){case 1:{E.multiaddr=v.bytes();break}default:{v.skipType(S&7);break}}}return E})),y),h.encode=v=>encodeMessage(v,h.codec()),h.decode=(v,b)=>decodeMessage(v,h.codec(),b)})(g.AddressInfo||(g.AddressInfo={}));let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{if(v.lengthDelimited!==!1&&y.fork(),h.peerId!=null&&h.peerId.byteLength>0&&(y.uint32(10),y.bytes(h.peerId)),h.seq!=null&&h.seq!==0n&&(y.uint32(16),y.uint64(h.seq)),h.addresses!=null)for(const b of h.addresses)y.uint32(26),g.AddressInfo.codec().encode(b,y);v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={peerId:alloc$1(0),seq:0n,addresses:[]},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.peerId=h.bytes();break}case 2:{b.seq=h.uint64();break}case 3:{if(v.limits?.addresses!=null&&b.addresses.length===v.limits.addresses)throw new MaxLengthError('Decode error - map field "addresses" had too many elements');b.addresses.push(g.AddressInfo.codec().decode(h,h.uint32(),{limits:v.limits?.addresses$}));break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(PeerRecord$1||(PeerRecord$1={}));class PeerRecord{static createFromProtobuf=u=>{const h=PeerRecord$1.decode(u),y=peerIdFromMultihash(decode$5(h.peerId)),v=(h.addresses??[]).map(w=>multiaddr(w.multiaddr)),b=h.seq;return new PeerRecord({peerId:y,multiaddrs:v,seqNumber:b})};static DOMAIN=ENVELOPE_DOMAIN_PEER_RECORD;static CODEC=ENVELOPE_PAYLOAD_TYPE_PEER_RECORD;peerId;multiaddrs;seqNumber;domain=PeerRecord.DOMAIN;codec=PeerRecord.CODEC;marshaled;constructor(u){const{peerId:h,multiaddrs:y,seqNumber:v}=u;this.peerId=h,this.multiaddrs=y??[],this.seqNumber=v??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=PeerRecord$1.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(u=>({multiaddr:u.bytes}))})),this.marshaled}equals(u){return!(!(u instanceof PeerRecord)||!this.peerId.equals(u.peerId)||this.seqNumber!==u.seqNumber||!arrayEquals(this.multiaddrs,u.multiaddrs))}}function debounce$1(g,u){let h;const y=function(){const v=function(){h=void 0,g()};clearTimeout(h),h=setTimeout(v,u)};return y.start=()=>{},y.stop=()=>{clearTimeout(h)},y}function isAsyncIterable$4(g){return g[Symbol.asyncIterator]!=null}function drain(g){if(isAsyncIterable$4(g))return(async()=>{for await(const u of g);})();for(const u of g);}const CustomEvent$1=globalThis.CustomEvent??Event;async function*parallel(g,u={}){let h=u.concurrency??1/0;h<1&&(h=1/0);const y=u.ordered??!1,v=new EventTarget,b=[];let w=pDefer(),E=pDefer(),_=!1,S,A=!1;v.addEventListener("task-complete",()=>{E.resolve()}),Promise.resolve().then(async()=>{try{for await(const C of g){if(b.length===h&&(w=pDefer(),await w.promise),A)break;const I={done:!1};b.push(I),C().then(L=>{I.done=!0,I.ok=!0,I.value=L,v.dispatchEvent(new CustomEvent$1("task-complete"))},L=>{I.done=!0,I.err=L,v.dispatchEvent(new CustomEvent$1("task-complete"))})}_=!0,v.dispatchEvent(new CustomEvent$1("task-complete"))}catch(C){S=C,v.dispatchEvent(new CustomEvent$1("task-complete"))}});function R(){return y?b[0]?.done:!!b.find(C=>C.done)}function*x(){for(;b.length>0&&b[0].done;){const C=b[0];if(b.shift(),C.ok)yield C.value;else throw A=!0,w.resolve(),C.err;w.resolve()}}function*T(){for(;R();)for(let C=0;C<b.length;C++)if(b[C].done){const I=b[C];if(b.splice(C,1),C--,I.ok)yield I.value;else throw A=!0,w.resolve(),I.err;w.resolve()}}for(;;){if(R()||(E=pDefer(),await E.promise),S!=null||(y?yield*x():yield*T(),S!=null))throw S;if(_&&b.length===0)break}}function pbStream$1(g,u){const h=lpStream$1(g,u),y={read:async(v,b)=>{const w=await h.read(b);return v.decode(w)},write:async(v,b,w)=>{await h.write(b.encode(v),w)},writeV:async(v,b,w)=>{await h.writeV(v.map(E=>b.encode(E)),w)},pb:v=>({read:async b=>y.read(v,b),write:async(b,w)=>y.write(b,v,w),writeV:async(b,w)=>y.writeV(b,v,w),unwrap:()=>y}),unwrap:()=>h.unwrap()};return y}const IDENTIFY_PROTOCOL_VERSION="0.1.0",MULTICODEC_IDENTIFY_PROTOCOL_NAME="id",MULTICODEC_IDENTIFY_PROTOCOL_VERSION="1.0.0",MAX_IDENTIFY_MESSAGE_SIZE=1024*8;var Identify$1;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{if(v.lengthDelimited!==!1&&y.fork(),h.protocolVersion!=null&&(y.uint32(42),y.string(h.protocolVersion)),h.agentVersion!=null&&(y.uint32(50),y.string(h.agentVersion)),h.publicKey!=null&&(y.uint32(10),y.bytes(h.publicKey)),h.listenAddrs!=null)for(const b of h.listenAddrs)y.uint32(18),y.bytes(b);if(h.observedAddr!=null&&(y.uint32(34),y.bytes(h.observedAddr)),h.protocols!=null)for(const b of h.protocols)y.uint32(26),y.string(b);h.signedPeerRecord!=null&&(y.uint32(66),y.bytes(h.signedPeerRecord)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={listenAddrs:[],protocols:[]},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 5:{b.protocolVersion=h.string();break}case 6:{b.agentVersion=h.string();break}case 1:{b.publicKey=h.bytes();break}case 2:{if(v.limits?.listenAddrs!=null&&b.listenAddrs.length===v.limits.listenAddrs)throw new MaxLengthError('Decode error - map field "listenAddrs" had too many elements');b.listenAddrs.push(h.bytes());break}case 4:{b.observedAddr=h.bytes();break}case 3:{if(v.limits?.protocols!=null&&b.protocols.length===v.limits.protocols)throw new MaxLengthError('Decode error - map field "protocols" had too many elements');b.protocols.push(h.string());break}case 8:{b.signedPeerRecord=h.bytes();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(Identify$1||(Identify$1={}));const defaultValues$3={protocolPrefix:"ipfs",timeout:5e3,maxInboundStreams:1,maxOutboundStreams:1,maxObservedAddresses:10,maxMessageSize:MAX_IDENTIFY_MESSAGE_SIZE,runOnConnectionOpen:!0,runOnLimitedConnection:!0};function getCleanMultiaddr(g){if(g!=null&&g.length>0)try{return multiaddr(g)}catch{}}function getAgentVersion(g,u){return u??g.userAgent}async function consumeIdentifyMessage(g,u,h,y,v){if(h("received identify from %p",y.remotePeer),v==null)throw new InvalidMessageError("message was null or undefined");const b={};if(v.listenAddrs.length>0&&(b.addresses=v.listenAddrs.map(_=>({isCertified:!1,multiaddr:multiaddr(_)}))),v.protocols.length>0&&(b.protocols=v.protocols),v.publicKey!=null){const _=publicKeyFromProtobuf(v.publicKey);if(!peerIdFromPublicKey(_).equals(y.remotePeer))throw new InvalidMessageError("public key did not match remote PeerId");b.publicKey=_}let w;if(v.signedPeerRecord!=null){h.trace("received signedPeerRecord from %p",y.remotePeer);let _=v.signedPeerRecord;const S=await RecordEnvelope.openAndCertify(_,PeerRecord.DOMAIN);let A=PeerRecord.createFromProtobuf(S.payload);const R=peerIdFromCID(S.publicKey.toCID());if(!A.peerId.equals(R))throw new InvalidMessageError("signing key does not match PeerId in the PeerRecord");if(!y.remotePeer.equals(A.peerId))throw new InvalidMessageError("signing key does not match remote PeerId");let x;try{x=await g.get(A.peerId)}catch(T){if(T.name!=="NotFoundError")throw T}if(x!=null&&(b.metadata=x.metadata,x.peerRecordEnvelope!=null)){const T=RecordEnvelope.createFromProtobuf(x.peerRecordEnvelope),C=PeerRecord.createFromProtobuf(T.payload);C.seqNumber>=A.seqNumber&&(h("sequence number was lower or equal to existing sequence number - stored: %d received: %d",C.seqNumber,A.seqNumber),A=C,_=x.peerRecordEnvelope)}b.peerRecordEnvelope=_,b.addresses=A.multiaddrs.map(T=>({isCertified:!0,multiaddr:T})),w={seq:A.seqNumber,addresses:A.multiaddrs}}else h("%p did not send a signed peer record",y.remotePeer);if(h.trace("patching %p with",y.remotePeer,b),await g.patch(y.remotePeer,b),v.agentVersion!=null||v.protocolVersion!=null){const _={};v.agentVersion!=null&&(_.AgentVersion=fromString(v.agentVersion)),v.protocolVersion!=null&&(_.ProtocolVersion=fromString(v.protocolVersion)),h.trace("merging %p metadata",y.remotePeer,_),await g.merge(y.remotePeer,{metadata:_})}const E={peerId:y.remotePeer,protocolVersion:v.protocolVersion,agentVersion:v.agentVersion,publicKey:v.publicKey,listenAddrs:v.listenAddrs.map(_=>multiaddr(_)),observedAddr:v.observedAddr==null?void 0:multiaddr(v.observedAddr),protocols:v.protocols,signedPeerRecord:w,connection:y};return u.safeDispatchEvent("peer:identify",{detail:E}),E}class AbstractIdentify{host;protocol;started;timeout;peerId;privateKey;peerStore;registrar;addressManager;maxInboundStreams;maxOutboundStreams;maxMessageSize;maxObservedAddresses;events;runOnLimitedConnection;log;constructor(u,h){this.protocol=h.protocol,this.started=!1,this.peerId=u.peerId,this.privateKey=u.privateKey,this.peerStore=u.peerStore,this.registrar=u.registrar,this.addressManager=u.addressManager,this.events=u.events,this.log=h.log,this.timeout=h.timeout??defaultValues$3.timeout,this.maxInboundStreams=h.maxInboundStreams??defaultValues$3.maxInboundStreams,this.maxOutboundStreams=h.maxOutboundStreams??defaultValues$3.maxOutboundStreams,this.maxMessageSize=h.maxMessageSize??defaultValues$3.maxMessageSize,this.maxObservedAddresses=h.maxObservedAddresses??defaultValues$3.maxObservedAddresses,this.runOnLimitedConnection=h.runOnLimitedConnection??defaultValues$3.runOnLimitedConnection,this.host={protocolVersion:`${h.protocolPrefix??defaultValues$3.protocolPrefix}/${IDENTIFY_PROTOCOL_VERSION}`,agentVersion:getAgentVersion(u.nodeInfo,h.agentVersion)}}isStarted(){return this.started}async start(){this.started||(await this.peerStore.merge(this.peerId,{metadata:{AgentVersion:fromString(this.host.agentVersion),ProtocolVersion:fromString(this.host.protocolVersion)}}),await this.registrar.handle(this.protocol,u=>{this.handleProtocol(u).catch(h=>{this.log.error(h)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0)}async stop(){await this.registrar.unhandle(this.protocol),this.started=!1}}function isGlobalUnicast(g){try{for(const{code:u,value:h}of g.getComponents())if(h!=null&&u===CODE_IP6)return cidrContains("2000::/3",h)}catch{}return!1}var netmask={},hasRequiredNetmask;function requireNetmask(){return hasRequiredNetmask||(hasRequiredNetmask=1,(function(){var g,u,h,y,v,b,w,E;E=function(_){var S,A,R,x;return S=(_&255<<24)>>>24,A=(_&255<<16)>>>16,R=(_&65280)>>>8,x=_&255,[S,A,R,x].join(".")},w=function(_){var S,A,R,x,T,C;for(S=[],R=x=0;x<=3&&_.length!==0;R=++x){if(R>0){if(_[0]!==".")throw new Error("Invalid IP");_=_.substring(1)}C=u(_),T=C[0],A=C[1],_=_.substring(A),S.push(T)}if(_.length!==0)throw new Error("Invalid IP");switch(S.length){case 1:if(S[0]>4294967295)throw new Error("Invalid IP");return S[0]>>>0;case 2:if(S[0]>255||S[1]>16777215)throw new Error("Invalid IP");return(S[0]<<24|S[1])>>>0;case 3:if(S[0]>255||S[1]>255||S[2]>65535)throw new Error("Invalid IP");return(S[0]<<24|S[1]<<16|S[2])>>>0;case 4:if(S[0]>255||S[1]>255||S[2]>255||S[3]>255)throw new Error("Invalid IP");return(S[0]<<24|S[1]<<16|S[2]<<8|S[3])>>>0;default:throw new Error("Invalid IP")}},h=function(_){return _.charCodeAt(0)},y=h("0"),b=h("a"),v=h("A"),u=function(_){var S,A,R,x,T;for(x=0,S=10,A="9",R=0,_.length>1&&_[R]==="0"&&(_[R+1]==="x"||_[R+1]==="X"?(R+=2,S=16):"0"<=_[R+1]&&_[R+1]<="9"&&(R++,S=8,A="7")),T=R;R<_.length;){if("0"<=_[R]&&_[R]<=A)x=x*S+(h(_[R])-y)>>>0;else if(S===16)if("a"<=_[R]&&_[R]<="f")x=x*S+(10+h(_[R])-b)>>>0;else if("A"<=_[R]&&_[R]<="F")x=x*S+(10+h(_[R])-v)>>>0;else break;else break;if(x>4294967295)throw new Error("too large");R++}if(R===T)throw new Error("empty octet");return[x,R]},g=(function(){function _(S,A){var R,x,T;if(typeof S!="string")throw new Error("Missing `net' parameter");if(A||(T=S.split("/",2),S=T[0],A=T[1]),A||(A=32),typeof A=="string"&&A.indexOf(".")>-1){try{this.maskLong=w(A)}catch{throw new Error("Invalid mask: "+A)}for(R=x=32;x>=0;R=--x)if(this.maskLong===4294967295<<32-R>>>0){this.bitmask=R;break}}else if(A||A===0)this.bitmask=parseInt(A,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(w(S)&this.maskLong)>>>0}catch{throw new Error("Invalid net address: "+S)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+A);this.size=Math.pow(2,32-this.bitmask),this.base=E(this.netLong),this.mask=E(this.maskLong),this.hostmask=E(~this.maskLong),this.first=this.bitmask<=30?E(this.netLong+1):this.base,this.last=this.bitmask<=30?E(this.netLong+this.size-2):E(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?E(this.netLong+this.size-1):void 0}return _.prototype.contains=function(S){return typeof S=="string"&&(S.indexOf("/")>0||S.split(".").length!==4)&&(S=new _(S)),S instanceof _?this.contains(S.base)&&this.contains(S.broadcast||S.last):(w(S)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},_.prototype.next=function(S){return S==null&&(S=1),new _(E(this.netLong+this.size*S),this.mask)},_.prototype.forEach=function(S){var A,R,x;for(x=w(this.first),R=w(this.last),A=0;x<=R;)S(E(x),x,A),A++,x++},_.prototype.toString=function(){return this.base+"/"+this.bitmask},_})(),netmask.ip2long=w,netmask.long2ip=E,netmask.Netmask=g}).call(netmask)),netmask}var netmaskExports=requireNetmask();const PRIVATE_IP_RANGES=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],NETMASK_RANGES=PRIVATE_IP_RANGES.map(g=>new netmaskExports.Netmask(g));function ipv4Check(g){for(const u of NETMASK_RANGES)if(u.contains(g))return!0;return!1}function isIpv4MappedIpv6(g){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(g)}function ipv4MappedIpv6Check(g){const u=g.split(":");if(u.length<2)return!1;const h=u[u.length-1].padStart(4,"0"),y=u[u.length-2].padStart(4,"0"),v=`${parseInt(y.substring(0,2),16)}.${parseInt(y.substring(2),16)}.${parseInt(h.substring(0,2),16)}.${parseInt(h.substring(2),16)}`;return ipv4Check(v)}function isIpv4EmbeddedIpv6(g){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(g)}function ipv4EmbeddedIpv6Check(g){const u=g.split(":"),h=u[u.length-1];return ipv4Check(h)}function ipv6Check(g){return/^::$/.test(g)||/^::1$/.test(g)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(g)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(g)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(g)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(g)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(g)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(g)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(g)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(g)||/^ff([0-9a-fA-F]{2,2}):/i.test(g)}function isPrivateIp(g){if(isIPv4(g))return ipv4Check(g);if(isIpv4MappedIpv6(g))return ipv4MappedIpv6Check(g);if(isIpv4EmbeddedIpv6(g))return ipv4EmbeddedIpv6Check(g);if(isIPv6(g))return ipv6Check(g)}function isIpBased(g){try{for(const{code:u}of g.getComponents())if(u!==CODE_IP6ZONE)return u===CODE_IP4||u===CODE_IP6}catch{}return!1}function isPrivate(g){try{if(!isIpBased(g))return!1;const[[,u]]=g.stringTuples();return u==null?!1:isPrivateIp(u)??!1}catch{}return!0}const code=g=>({match:u=>{const h=u[0];return h==null||h.code!==g||h.value!=null?!1:u.slice(1)}}),value$1=(g,u)=>({match:h=>{const y=h[0];return y?.code!==g||y.value==null||u!=null&&y.value!==u?!1:h.slice(1)}}),optional=g=>({match:u=>{const h=g.match(u);return h===!1?u:h}}),or=(...g)=>({match:u=>{let h;for(const y of g){const v=y.match(u);v!==!1&&(h==null||v.length<h.length)&&(h=v)}return h??!1}}),and=(...g)=>({match:u=>{for(const h of g){const y=h.match(u);if(y===!1)return!1;u=y}return u}});function fmt(...g){function u(v){if(v==null)return!1;let b=v.getComponents();for(const w of g){const E=w.match(b);if(E===!1)return!1;b=E}return b}function h(v){return u(v)!==!1}function y(v){const b=u(v);return b===!1?!1:b.length===0}return{matchers:g,matches:h,exactMatch:y}}const _PEER_ID=value$1(CODE_P2P),PEER_ID=fmt(_PEER_ID),_DNS4=value$1(CODE_DNS4),_DNS6=value$1(CODE_DNS6),_DNSADDR=value$1(CODE_DNSADDR),_DNS=value$1(CODE_DNS);fmt(_DNS4,optional(value$1(CODE_P2P)));fmt(_DNS6,optional(value$1(CODE_P2P)));fmt(_DNSADDR,optional(value$1(CODE_P2P)));fmt(or(_DNS,_DNSADDR,_DNS4,_DNS6),optional(value$1(CODE_P2P)));const _IP4=and(value$1(CODE_IP4),optional(value$1(CODE_IPCIDR))),_IP6=and(optional(value$1(CODE_IP6ZONE)),value$1(CODE_IP6),optional(value$1(CODE_IPCIDR))),_IP=or(_IP4,_IP6),_IP_OR_DOMAIN=or(_IP,_DNS,_DNS4,_DNS6,_DNSADDR),IP_OR_DOMAIN=fmt(or(_IP,and(or(_DNS,_DNSADDR,_DNS4,_DNS6),optional(value$1(CODE_P2P))))),IP4=fmt(_IP4),IP6=fmt(_IP6);fmt(_IP);const _TCP=and(_IP_OR_DOMAIN,value$1(CODE_TCP)),_UDP=and(_IP_OR_DOMAIN,value$1(CODE_UDP)),TCP=fmt(and(_TCP,optional(value$1(CODE_P2P))));fmt(_UDP);const _QUIC=and(_UDP,code(CODE_QUIC),optional(value$1(CODE_P2P))),_QUIC_V1=and(_UDP,code(CODE_QUIC_V1),optional(value$1(CODE_P2P))),QUIC_V0_OR_V1=or(_QUIC,_QUIC_V1);fmt(_QUIC);const QUIC_V1=fmt(_QUIC_V1),_WEB=or(_IP_OR_DOMAIN,_TCP,_UDP,_QUIC,_QUIC_V1),_WebSockets=or(and(_WEB,code(CODE_WS),optional(value$1(CODE_P2P)))),WebSockets$1=fmt(_WebSockets),_WebSocketsSecure=or(and(_WEB,code(CODE_WSS),optional(value$1(CODE_P2P))),and(_WEB,code(CODE_TLS),optional(value$1(CODE_SNI)),code(CODE_WS),optional(value$1(CODE_P2P)))),WebSocketsSecure=fmt(_WebSocketsSecure),_WebRTCDirect=and(_UDP,code(CODE_WEBRTC_DIRECT),optional(value$1(CODE_CERTHASH)),optional(value$1(CODE_CERTHASH)),optional(value$1(CODE_P2P))),WebRTCDirect=fmt(_WebRTCDirect),_WebTransport=and(_QUIC_V1,code(CODE_WEBTRANSPORT),optional(value$1(CODE_CERTHASH)),optional(value$1(CODE_CERTHASH)),optional(value$1(CODE_P2P))),WebTransport$1=fmt(_WebTransport),_P2P=or(_WebSockets,_WebSocketsSecure,and(_TCP,optional(value$1(CODE_P2P))),and(QUIC_V0_OR_V1,optional(value$1(CODE_P2P))),and(_IP_OR_DOMAIN,optional(value$1(CODE_P2P))),_WebRTCDirect,_WebTransport,value$1(CODE_P2P)),P2P=fmt(_P2P),_Circuit=and(_P2P,code(CODE_P2P_CIRCUIT),value$1(CODE_P2P)),Circuit$1=fmt(_Circuit),_WebRTC=or(and(_P2P,code(CODE_P2P_CIRCUIT),code(CODE_WEBRTC),optional(value$1(CODE_P2P))),and(_P2P,code(CODE_WEBRTC),optional(value$1(CODE_P2P))),and(code(CODE_WEBRTC),optional(value$1(CODE_P2P)))),WebRTC=fmt(_WebRTC),_HTTP=or(and(_IP_OR_DOMAIN,value$1(CODE_TCP),code(CODE_HTTP),optional(value$1(CODE_P2P))),and(_IP_OR_DOMAIN,code(CODE_HTTP),optional(value$1(CODE_P2P))));fmt(_HTTP);const _HTTPS=and(_IP_OR_DOMAIN,or(and(value$1(CODE_TCP,"443"),code(CODE_HTTP)),and(value$1(CODE_TCP),code(CODE_HTTPS)),and(value$1(CODE_TCP),code(CODE_TLS),code(CODE_HTTP)),and(code(CODE_TLS),code(CODE_HTTP)),code(CODE_TLS),code(CODE_HTTPS)),optional(value$1(CODE_P2P)));fmt(_HTTPS);const _Memory=or(and(value$1(CODE_MEMORY),optional(value$1(CODE_P2P))));fmt(_Memory);const _Unix=or(and(value$1(CODE_UNIX),optional(value$1(CODE_P2P))));fmt(_Unix);class Identify extends AbstractIdentify{constructor(u,h={}){super(u,{...h,protocol:`/${h.protocolPrefix??defaultValues$3.protocolPrefix}/${MULTICODEC_IDENTIFY_PROTOCOL_NAME}/${MULTICODEC_IDENTIFY_PROTOCOL_VERSION}`,log:u.logger.forComponent("libp2p:identify")}),(h.runOnConnectionOpen??defaultValues$3.runOnConnectionOpen)&&u.events.addEventListener("connection:open",y=>{const v=y.detail;this.identify(v).catch(b=>{b.name!==UnsupportedProtocolError.name&&this.log.error("error during identify trigged by connection:open",b)})})}[serviceCapabilities]=["@libp2p/identify"];async _identify(u,h={}){let y;if(h.signal==null){const v=AbortSignal.timeout(this.timeout);h={...h,signal:v}}try{y=await u.newStream(this.protocol,{...h,runOnLimitedConnection:this.runOnLimitedConnection});const b=await pbStream$1(y,{maxDataLength:this.maxMessageSize}).pb(Identify$1).read(h);return await y.close(h),b}catch(v){throw y?.abort(v),v}}async identify(u,h={}){const y=await this._identify(u,h),{publicKey:v,protocols:b,observedAddr:w}=y;if(v==null)throw new InvalidMessageError("Public key was missing from identify message");const E=publicKeyFromProtobuf(v),_=peerIdFromCID(E.toCID()),S=u.log.newScope("identify");if(!u.remotePeer.equals(_))throw new InvalidMessageError("Identified peer does not match the expected peer");if(this.peerId.equals(_))throw new InvalidMessageError("Identified peer is our own peer id?");return this.maybeAddObservedAddress(w,S),S("completed for peer %p and protocols %o",_,b),consumeIdentifyMessage(this.peerStore,this.events,S,u,y)}maybeAddObservedAddress(u,h){const y=getCleanMultiaddr(u);if(y==null)return;if(h.trace("our observed address was %a",y),isPrivate(y)){this.log.trace("our observed address was private");return}const v=y.getComponents();if((v[0].code===CODE_IP6||v[0].code===CODE_IP6ZONE&&v[1].code===CODE_IP6)&&!isGlobalUnicast(y)){h.trace("our observed address was IPv6 but not a global unicast address");return}TCP.exactMatch(y)||(h.trace("storing the observed address"),this.addressManager.addObservedAddr(y))}async handleProtocol(u){const{connection:h,stream:y}=u,v=h.log.newScope("identify"),b=AbortSignal.timeout(this.timeout);try{const w=await this.peerStore.get(this.peerId),E=this.addressManager.getAddresses().map(R=>R.decapsulateCode(protocols("p2p").code));let _=w.peerRecordEnvelope;if(E.length>0&&_==null){const R=new PeerRecord({peerId:this.peerId,multiaddrs:E});_=(await RecordEnvelope.seal(R,this.privateKey)).marshal().subarray()}let S=h.remoteAddr.bytes;IP_OR_DOMAIN.matches(h.remoteAddr)||(S=void 0),await pbStream$1(y).pb(Identify$1).write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:publicKeyToProtobuf(this.privateKey.publicKey),listenAddrs:E.map(R=>R.bytes),signedPeerRecord:_,observedAddr:S,protocols:w.protocols},{signal:b}),await y.close({signal:b})}catch(w){v.error("could not respond to identify request",w),y.abort(w)}}}function identify(g={}){return u=>new Identify(u,g)}const PING_LENGTH$1=32,PROTOCOL_VERSION$2="1.0.0",PROTOCOL_NAME$2="ping",PROTOCOL_PREFIX$1="ipfs",TIMEOUT=1e4,MAX_INBOUND_STREAMS=2,MAX_OUTBOUND_STREAMS=1;class Ping{protocol;components;started;timeout;maxInboundStreams;maxOutboundStreams;runOnLimitedConnection;constructor(u,h={}){this.components=u,this.started=!1,this.protocol=`/${h.protocolPrefix??PROTOCOL_PREFIX$1}/${PROTOCOL_NAME$2}/${PROTOCOL_VERSION$2}`,this.timeout=h.timeout??TIMEOUT,this.maxInboundStreams=h.maxInboundStreams??MAX_INBOUND_STREAMS,this.maxOutboundStreams=h.maxOutboundStreams??MAX_OUTBOUND_STREAMS,this.runOnLimitedConnection=h.runOnLimitedConnection??!0,this.handleMessage=this.handleMessage.bind(this)}[Symbol.toStringTag]="@libp2p/ping";[serviceCapabilities]=["@libp2p/ping"];async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(u){const h=u.connection.log.newScope("ping");h.trace("ping from %p",u.connection.remotePeer);const{stream:y}=u,v=Date.now(),b=byteStream$1(y);let w=!1;Promise.resolve().then(async()=>{for(;;){const E=AbortSignal.timeout(this.timeout);E.addEventListener("abort",()=>{y?.abort(new TimeoutError$1("ping timeout"))});const _=await b.read({bytes:PING_LENGTH$1,signal:E});await b.write(_,{signal:E}),w=!0}}).catch(E=>{w&&E.name==="UnexpectedEOFError"&&y.readStatus!=="ready"||(h.error("ping from %p failed with error - %e",u.connection.remotePeer,E),y?.abort(E))}).finally(()=>{const E=Date.now()-v;h("ping from %p complete in %dms",u.connection.remotePeer,E);const _=AbortSignal.timeout(this.timeout);y.close({signal:_}).catch(S=>{h.error("error closing ping stream from %p - %e",u.connection.remotePeer,S),y?.abort(S)})})}async ping(u,h={}){const y=Date.now(),v=randomBytes$2(PING_LENGTH$1),b=await this.components.connectionManager.openConnection(u,h),w=b.log.newScope("ping");let E;if(h.signal==null){const _=AbortSignal.timeout(this.timeout);h={...h,signal:_}}try{E=await b.newStream(this.protocol,{...h,runOnLimitedConnection:this.runOnLimitedConnection});const _=byteStream$1(E),[,S]=await Promise.all([_.write(v,h),_.read({...h,bytes:PING_LENGTH$1})]),A=Date.now()-y;if(!equals(v,S.subarray()))throw new ProtocolError(`Received wrong ping ack after ${A}ms`);return w("ping %p complete in %dms",b.remotePeer,A),A}catch(_){throw w.error("error while pinging %p",b.remotePeer,_),E?.abort(_),_}finally{E!=null&&await E.close(h)}}}function ping(g={}){return u=>new Ping(u,g)}function isPlainObject$1(g){if(typeof g!="object"||g===null)return!1;const u=Object.getPrototypeOf(g);return(u===null||u===Object.prototype||Object.getPrototypeOf(u)===null)&&!(Symbol.toStringTag in g)&&!(Symbol.iterator in g)}const{hasOwnProperty}=Object.prototype,{propertyIsEnumerable}=Object,defineProperty=(g,u,h)=>{Object.defineProperty(g,u,{value:h,writable:!0,enumerable:!0,configurable:!0})},globalThis$1=void 0,defaultMergeOptions={concatArrays:!1,ignoreUndefined:!1},getEnumerableOwnPropertyKeys=g=>{const u=[];for(const h in g)hasOwnProperty.call(g,h)&&u.push(h);if(Object.getOwnPropertySymbols){const h=Object.getOwnPropertySymbols(g);for(const y of h)propertyIsEnumerable.call(g,y)&&u.push(y)}return u};function clone$1(g){return Array.isArray(g)?cloneArray(g):isPlainObject$1(g)?cloneOptionObject(g):g}function cloneArray(g){const u=g.slice(0,0);return getEnumerableOwnPropertyKeys(g).forEach(h=>{defineProperty(u,h,clone$1(g[h]))}),u}function cloneOptionObject(g){const u=Object.getPrototypeOf(g)===null?Object.create(null):{};return getEnumerableOwnPropertyKeys(g).forEach(h=>{defineProperty(u,h,clone$1(g[h]))}),u}const mergeKeys=(g,u,h,y)=>(h.forEach(v=>{typeof u[v]>"u"&&y.ignoreUndefined||(v in g&&g[v]!==Object.getPrototypeOf(g)?defineProperty(g,v,merge(g[v],u[v],y)):defineProperty(g,v,clone$1(u[v])))}),g),concatArrays=(g,u,h)=>{let y=g.slice(0,0),v=0;return[g,u].forEach(b=>{const w=[];for(let E=0;E<b.length;E++)hasOwnProperty.call(b,E)&&(w.push(String(E)),b===g?defineProperty(y,v++,b[E]):defineProperty(y,v++,clone$1(b[E])));y=mergeKeys(y,b,getEnumerableOwnPropertyKeys(b).filter(E=>!w.includes(E)),h)}),y};function merge(g,u,h){return h.concatArrays&&Array.isArray(g)&&Array.isArray(u)?concatArrays(g,u,h):!isPlainObject$1(u)||!isPlainObject$1(g)?clone$1(u):mergeKeys(g,u,getEnumerableOwnPropertyKeys(u),h)}function mergeOptions(...g){const u=merge(clone$1(defaultMergeOptions),this!==globalThis$1&&this||{},defaultMergeOptions);let h={_:{}};for(const y of g)if(y!==void 0){if(!isPlainObject$1(y))throw new TypeError("`"+y+"` is not an Option Object");h=merge(h,{_:y},u)}return h._}class CustomProgressEvent extends Event{type;detail;constructor(u,h){super(u),this.type=u,this.detail=h}}class TimeoutError extends Error{constructor(u){super(u),this.name="TimeoutError"}}let AbortError$3=class extends Error{constructor(u){super(),this.name="AbortError",this.message=u}};const getDOMException=g=>globalThis.DOMException===void 0?new AbortError$3(g):new DOMException(g),getAbortedReason=g=>{const u=g.reason===void 0?getDOMException("This operation was aborted."):g.reason;return u instanceof Error?u:getDOMException(u)};function pTimeout(g,u){const{milliseconds:h,fallback:y,message:v,customTimers:b={setTimeout,clearTimeout}}=u;let w,E;const S=new Promise((A,R)=>{if(typeof h!="number"||Math.sign(h)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${h}\``);if(u.signal){const{signal:T}=u;T.aborted&&R(getAbortedReason(T)),E=()=>{R(getAbortedReason(T))},T.addEventListener("abort",E,{once:!0})}if(h===Number.POSITIVE_INFINITY){g.then(A,R);return}const x=new TimeoutError;w=b.setTimeout.call(void 0,()=>{if(y){try{A(y())}catch(T){R(T)}return}typeof g.cancel=="function"&&g.cancel(),v===!1?A():v instanceof Error?R(v):(x.message=v??`Promise timed out after ${h} milliseconds`,R(x))},h),(async()=>{try{A(await g)}catch(T){R(T)}})()}).finally(()=>{S.clear(),E&&u.signal&&u.signal.removeEventListener("abort",E)});return S.clear=()=>{b.clearTimeout.call(void 0,w),w=void 0},S}function lowerBound(g,u,h){let y=0,v=g.length;for(;v>0;){const b=Math.trunc(v/2);let w=y+b;h(g[w],u)<=0?(y=++w,v-=b+1):v=b}return y}let PriorityQueue$1=class{#e=[];enqueue(u,h){h={priority:0,...h};const y={priority:h.priority,id:h.id,run:u};if(this.size===0||this.#e[this.size-1].priority>=h.priority){this.#e.push(y);return}const v=lowerBound(this.#e,y,(b,w)=>w.priority-b.priority);this.#e.splice(v,0,y)}setPriority(u,h){const y=this.#e.findIndex(b=>b.id===u);if(y===-1)throw new ReferenceError(`No promise function with the id "${u}" exists in the queue.`);const[v]=this.#e.splice(y,1);this.enqueue(v.run,{priority:h,id:u})}dequeue(){return this.#e.shift()?.run}filter(u){return this.#e.filter(h=>h.priority===u.priority).map(h=>h.run)}get size(){return this.#e.length}};class PQueue extends EventEmitter{#e;#t;#r=0;#h;#a;#p=0;#i;#c;#n;#g;#s=0;#u;#o;#y;#v=1n;timeout;constructor(u){if(super(),u={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:PriorityQueue$1,...u},!(typeof u.intervalCap=="number"&&u.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${u.intervalCap?.toString()??""}\` (${typeof u.intervalCap})`);if(u.interval===void 0||!(Number.isFinite(u.interval)&&u.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${u.interval?.toString()??""}\` (${typeof u.interval})`);this.#e=u.carryoverConcurrencyCount,this.#t=u.intervalCap===Number.POSITIVE_INFINITY||u.interval===0,this.#h=u.intervalCap,this.#a=u.interval,this.#n=new u.queueClass,this.#g=u.queueClass,this.concurrency=u.concurrency,this.timeout=u.timeout,this.#y=u.throwOnTimeout===!0,this.#o=u.autoStart===!1}get#w(){return this.#t||this.#r<this.#h}get#E(){return this.#s<this.#u}#_(){this.#s--,this.#l(),this.emit("next")}#S(){this.#b(),this.#m(),this.#c=void 0}get#A(){const u=Date.now();if(this.#i===void 0){const h=this.#p-u;if(h<0)this.#r=this.#e?this.#s:0;else return this.#c===void 0&&(this.#c=setTimeout(()=>{this.#S()},h)),!0}return!1}#l(){if(this.#n.size===0)return this.#i&&clearInterval(this.#i),this.#i=void 0,this.emit("empty"),this.#s===0&&this.emit("idle"),!1;if(!this.#o){const u=!this.#A;if(this.#w&&this.#E){const h=this.#n.dequeue();return h?(this.emit("active"),h(),u&&this.#m(),!0):!1}}return!1}#m(){this.#t||this.#i!==void 0||(this.#i=setInterval(()=>{this.#b()},this.#a),this.#p=Date.now()+this.#a)}#b(){this.#r===0&&this.#s===0&&this.#i&&(clearInterval(this.#i),this.#i=void 0),this.#r=this.#e?this.#s:0,this.#f()}#f(){for(;this.#l(););}get concurrency(){return this.#u}set concurrency(u){if(!(typeof u=="number"&&u>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${u}\` (${typeof u})`);this.#u=u,this.#f()}async#R(u){return new Promise((h,y)=>{u.addEventListener("abort",()=>{y(u.reason)},{once:!0})})}setPriority(u,h){this.#n.setPriority(u,h)}async add(u,h={}){return h.id??=(this.#v++).toString(),h={timeout:this.timeout,throwOnTimeout:this.#y,...h},new Promise((y,v)=>{this.#n.enqueue(async()=>{this.#s++;try{h.signal?.throwIfAborted(),this.#r++;let b=u({signal:h.signal});h.timeout&&(b=pTimeout(Promise.resolve(b),{milliseconds:h.timeout})),h.signal&&(b=Promise.race([b,this.#R(h.signal)]));const w=await b;y(w),this.emit("completed",w)}catch(b){if(b instanceof TimeoutError&&!h.throwOnTimeout){y();return}v(b),this.emit("error",b)}finally{this.#_()}},h),this.emit("add"),this.#l()})}async addAll(u,h){return Promise.all(u.map(async y=>this.add(y,h)))}start(){return this.#o?(this.#o=!1,this.#f(),this):this}pause(){this.#o=!0}clear(){this.#n=new this.#g}async onEmpty(){this.#n.size!==0&&await this.#d("empty")}async onSizeLessThan(u){this.#n.size<u||await this.#d("next",()=>this.#n.size<u)}async onIdle(){this.#s===0&&this.#n.size===0||await this.#d("idle")}async#d(u,h){return new Promise(y=>{const v=()=>{h&&!h()||(this.off(u,v),y())};this.on(u,v)})}get size(){return this.#n.size}sizeBy(u){return this.#n.filter(u).length}get pending(){return this.#s}get isPaused(){return this.#o}}function getTypes(g){const u=[RecordType.A];return g==null?u:Array.isArray(g)?g.length===0?u:g:[g]}const DEFAULT_TTL=60;function toDNSResponse(g){return{Status:g.Status??0,TC:g.TC??g.flag_tc??!1,RD:g.RD??g.flag_rd??!1,RA:g.RA??g.flag_ra??!1,AD:g.AD??g.flag_ad??!1,CD:g.CD??g.flag_cd??!1,Question:(g.Question??g.questions??[]).map(u=>({name:u.name,type:RecordType[u.type]})),Answer:(g.Answer??g.answers??[]).map(u=>({name:u.name,type:RecordType[u.type],TTL:u.TTL??u.ttl??DEFAULT_TTL,data:u.data instanceof Uint8Array?toString$1(u.data):u.data}))}}const DEFAULT_QUERY_CONCURRENCY=4;function dnsJsonOverHttps(g,u={}){const h=new PQueue({concurrency:u.queryConcurrency??DEFAULT_QUERY_CONCURRENCY});return async(y,v={})=>{const b=new URLSearchParams;b.set("name",y),getTypes(v.types).forEach(E=>{b.append("type",RecordType[E])}),v.onProgress?.(new CustomProgressEvent("dns:query",y));const w=await h.add(async()=>{const E=await fetch(`${g}?${b}`,{headers:{accept:"application/dns-json"},signal:v?.signal});if(E.status!==200)throw new Error(`Unexpected HTTP status: ${E.status} - ${E.statusText}`);const _=toDNSResponse(await E.json());return v.onProgress?.(new CustomProgressEvent("dns:response",_)),_},{signal:v.signal});if(w==null)throw new Error("No DNS response received");return w}}function defaultResolver(){return[dnsJsonOverHttps("https://cloudflare-dns.com/dns-query"),dnsJsonOverHttps("https://dns.google/resolve")]}var hashlru$1,hasRequiredHashlru;function requireHashlru(){return hasRequiredHashlru||(hasRequiredHashlru=1,hashlru$1=function(g){if(!g)throw Error("hashlru must have a max value, of type number, greater than 0");var u=0,h=Object.create(null),y=Object.create(null);function v(b,w){h[b]=w,u++,u>=g&&(u=0,y=h,h=Object.create(null))}return{has:function(b){return h[b]!==void 0||y[b]!==void 0},remove:function(b){h[b]!==void 0&&(h[b]=void 0),y[b]!==void 0&&(y[b]=void 0)},get:function(b){var w=h[b];if(w!==void 0)return w;if((w=y[b])!==void 0)return v(b,w),w},set:function(b,w){h[b]!==void 0?h[b]=w:v(b,w)},clear:function(){h=Object.create(null),y=Object.create(null)}}}),hashlru$1}var hashlruExports=requireHashlru();const hashlru=getDefaultExportFromCjs(hashlruExports);class CachedAnswers{lru;constructor(u){this.lru=hashlru(u)}get(u,h){let y=!0;const v=[];for(const b of h){const w=this.getAnswers(u,b);if(w.length===0){y=!1;break}v.push(...w)}if(y)return toDNSResponse({answers:v})}getAnswers(u,h){const y=`${u.toLowerCase()}-${h}`,v=this.lru.get(y);if(v!=null){const b=v.filter(w=>w.expires>Date.now()).map(({expires:w,value:E})=>({...E,TTL:Math.round((w-Date.now())/1e3),type:RecordType[E.type]}));return b.length===0&&this.lru.remove(y),b}return[]}add(u,h){const y=`${u.toLowerCase()}-${h.type}`,v=this.lru.get(y)??[];v.push({expires:Date.now()+(h.TTL??DEFAULT_TTL)*1e3,value:h}),this.lru.set(y,v)}remove(u,h){const y=`${u.toLowerCase()}-${h}`;this.lru.remove(y)}clear(){this.lru.clear()}}function cache$1(g){return new CachedAnswers(g)}const DEFAULT_ANSWER_CACHE_SIZE=1e3;class DNS{resolvers;cache;constructor(u){this.resolvers={},this.cache=cache$1(u.cacheSize??DEFAULT_ANSWER_CACHE_SIZE),Object.entries(u.resolvers??{}).forEach(([h,y])=>{Array.isArray(y)||(y=[y]),h.endsWith(".")||(h=`${h}.`),this.resolvers[h]=y}),this.resolvers["."]==null&&(this.resolvers["."]=defaultResolver())}async query(u,h={}){const y=getTypes(h.types),v=h.cached!==!1?this.cache.get(u,y):void 0;if(v!=null)return h.onProgress?.(new CustomProgressEvent("dns:cache",v)),v;const b=`${u.split(".").pop()}.`,w=(this.resolvers[b]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),E=[];for(const _ of w){if(h.signal?.aborted===!0)break;try{const S=await _(u,{...h,types:y});for(const A of S.Answer)this.cache.add(u,A);return S}catch(S){E.push(S),h.onProgress?.(new CustomProgressEvent("dns:error",S))}}throw E.length===1?E[0]:new AggregateError(E,`DNS lookup of ${u} ${y} failed`)}}var RecordType;(function(g){g[g.A=1]="A",g[g.CNAME=5]="CNAME",g[g.TXT=16]="TXT",g[g.AAAA=28]="AAAA"})(RecordType||(RecordType={}));function dns(g={}){return new DNS(g)}class DNSAddrResolver{dns;canResolve(u){return u.getComponents().some(({name:h})=>h==="dnsaddr")}async resolve(u,h){const y=u.getComponents().find(_=>_.name==="dnsaddr")?.value;if(y==null)return[u];const b=await this.getDNS(h).query(`_dnsaddr.${y}`,{signal:h?.signal,types:[RecordType.TXT]}),w=u.getComponents().find(_=>_.name==="p2p")?.value,E=[];for(const _ of b.Answer){const S=_.data.replace(/["']/g,"").trim().split("=")[1];S!=null&&(w!=null&&!S.includes(w)||E.push(multiaddr(S)))}return E}getDNS(u){return u.dns!=null?u.dns:(this.dns==null&&(this.dns=dns()),this.dns)}}const dnsaddrResolver=new DNSAddrResolver;var define_globalThis_process_env_default$1={};const DefaultConfig={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:g=>g},connectionManager:{resolvers:{dnsaddr:dnsaddrResolver}},transportManager:{faultTolerance:FaultTolerance.FATAL_ALL}};async function validateConfig(g){const u=mergeOptions(DefaultConfig,g);if(u.connectionProtector===null&&define_globalThis_process_env_default$1?.LIBP2P_FORCE_PNET!=null)throw new InvalidParametersError$1("Private network is enforced, but no protector was provided");return u}const e=1e3,t=e*60,n=t*60,r=n*24,i=r*7,a=r*365.25,o=a/12;function s(g,u){if(typeof g=="string")return l$1(g);if(typeof g=="number")return p(g,u);throw Error(`Value provided to ms() must be a string or number. value=${JSON.stringify(g)}`)}var c=s;function l$1(g){if(typeof g!="string"||g.length===0||g.length>100)throw Error(`Value provided to ms.parse() must be a string with length between 1 and 99. value=${JSON.stringify(g)}`);let u=/^(?<value>-?\d*\.?\d+) *(?<unit>milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|months?|mo|years?|yrs?|y)?$/i.exec(g);if(!u?.groups)return NaN;let{value:h,unit:y="ms"}=u.groups,v=parseFloat(h),b=y.toLowerCase();switch(b){case"years":case"year":case"yrs":case"yr":case"y":return v*a;case"months":case"month":case"mo":return v*o;case"weeks":case"week":case"w":return v*i;case"days":case"day":case"d":return v*r;case"hours":case"hour":case"hrs":case"hr":case"h":return v*n;case"minutes":case"minute":case"mins":case"min":case"m":return v*t;case"seconds":case"second":case"secs":case"sec":case"s":return v*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return v;default:throw Error(`Unknown unit "${b}" provided to ms.parse(). value=${JSON.stringify(g)}`)}}function d(g){let u=Math.abs(g);return u>=a?`${Math.round(g/a)}y`:u>=o?`${Math.round(g/o)}mo`:u>=i?`${Math.round(g/i)}w`:u>=r?`${Math.round(g/r)}d`:u>=n?`${Math.round(g/n)}h`:u>=t?`${Math.round(g/t)}m`:u>=e?`${Math.round(g/e)}s`:`${g}ms`}function f(g){let u=Math.abs(g);return u>=a?m(g,u,a,"year"):u>=o?m(g,u,o,"month"):u>=i?m(g,u,i,"week"):u>=r?m(g,u,r,"day"):u>=n?m(g,u,n,"hour"):u>=t?m(g,u,t,"minute"):u>=e?m(g,u,e,"second"):`${g} ms`}function p(g,u){if(typeof g!="number"||!Number.isFinite(g))throw Error("Value provided to ms.format() must be of type number.");return u?.long?f(g):d(g)}function m(g,u,h,y){let v=u>=h*1.5;return`${Math.round(g/h)} ${y}${v?"s":""}`}function setup(g){h.debug=h,h.default=h,h.coerce=_,h.disable=b,h.enable=v,h.enabled=w,h.humanize=c,h.destroy=S,Object.keys(g).forEach(A=>{h[A]=g[A]}),h.names=[],h.skips=[],h.formatters={};function u(A){let R=0;for(let x=0;x<A.length;x++)R=(R<<5)-R+A.charCodeAt(x),R|=0;return h.colors[Math.abs(R)%h.colors.length]}h.selectColor=u;function h(A){let R,x=null,T,C;function I(...L){if(!I.enabled)return;const $=I,B=Number(new Date),U=B-(R||B);$.diff=U,$.prev=R,$.curr=B,R=B,L[0]=h.coerce(L[0]),typeof L[0]!="string"&&L.unshift("%O");let z=0;L[0]=L[0].replace(/%([a-zA-Z%])/g,(ue,he)=>{if(ue==="%%")return"%";z++;const Y=h.formatters[he];if(typeof Y=="function"){const X=L[z];ue=Y.call($,X),L.splice(z,1),z--}return ue}),h.formatArgs.call($,L),($.log||h.log).apply($,L)}return I.namespace=A,I.useColors=h.useColors(),I.color=h.selectColor(A),I.extend=y,I.destroy=h.destroy,Object.defineProperty(I,"enabled",{enumerable:!0,configurable:!1,get:()=>x!==null?x:(T!==h.namespaces&&(T=h.namespaces,C=h.enabled(A)),C),set:L=>{x=L}}),typeof h.init=="function"&&h.init(I),I}function y(A,R){const x=h(this.namespace+(typeof R>"u"?":":R)+A);return x.log=this.log,x}function v(A){h.save(A),h.namespaces=A,h.names=[],h.skips=[];let R;const x=(typeof A=="string"?A:"").split(/[\s,]+/),T=x.length;for(R=0;R<T;R++)x[R]&&(A=x[R].replace(/\*/g,".*?"),A[0]==="-"?h.skips.push(new RegExp("^"+A.substr(1)+"$")):h.names.push(new RegExp("^"+A+"$")))}function b(){const A=[...h.names.map(E),...h.skips.map(E).map(R=>"-"+R)].join(",");return h.enable(""),A}function w(A){if(A[A.length-1]==="*")return!0;let R,x;for(R=0,x=h.skips.length;R<x;R++)if(h.skips[R].test(A))return!1;for(R=0,x=h.names.length;R<x;R++)if(h.names[R].test(A))return!0;return!1}function E(A){return A.toString().substring(2,A.toString().length-2).replace(/\.\*\?$/,"*")}function _(A){return A instanceof Error?A.stack??A.message:A}function S(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return h.setupFormatters(h.formatters),h.enable(h.load()),h}var define_globalThis_process_env_default={};const storage=localstorage(),colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function useColors(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/(edge|trident)\/(\d+)/)!=null?!1:typeof document<"u"&&document.documentElement?.style?.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/firefox\/(\d+)/)!=null&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/applewebkit\/(\d+)/)}function formatArgs(g){if(g[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+g[0]+(this.useColors?"%c ":" ")+"+"+c(this.diff),!this.useColors)return;const u="color: "+this.color;g.splice(1,0,u,"color: inherit");let h=0,y=0;g[0].replace(/%[a-zA-Z%]/g,v=>{v!=="%%"&&(h++,v==="%c"&&(y=h))}),g.splice(y,0,u)}const log$3=console.debug??console.log??(()=>{});function save(g){try{g?storage?.setItem("debug",g):storage?.removeItem("debug")}catch{}}function load(){let g;try{g=storage?.getItem("debug")}catch{}return!g&&typeof globalThis.process<"u"&&"env"in globalThis.process&&(g=define_globalThis_process_env_default.DEBUG),g}function localstorage(){try{return localStorage}catch{}}function setupFormatters(g){g.j=function(u){try{return JSON.stringify(u)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}}const weald=setup({formatArgs,save,load,useColors,setupFormatters,colors,storage,log:log$3});weald.formatters.b=g=>g==null?"undefined":base58btc.baseEncode(g);weald.formatters.t=g=>g==null?"undefined":base32.baseEncode(g);weald.formatters.m=g=>g==null?"undefined":base64.baseEncode(g);weald.formatters.p=g=>g==null?"undefined":g.toString();weald.formatters.c=g=>g==null?"undefined":g.toString();weald.formatters.k=g=>g==null?"undefined":g.toString();weald.formatters.a=g=>g==null?"undefined":g.toString();weald.formatters.e=g=>g==null?"undefined":notEmpty(g.stack)??notEmpty(g.message)??g.toString();function createDisabledLogger(g){const u=()=>{};return u.enabled=!1,u.color="",u.diff=0,u.log=()=>{},u.namespace=g,u.destroy=()=>!0,u.extend=()=>u,u}function defaultLogger(){return{forComponent(g){return logger(g)}}}function logger(g){let u=createDisabledLogger(`${g}:trace`);return weald.enabled(`${g}:trace`)&&weald.names.map(h=>h.toString()).find(h=>h.includes(":trace"))!=null&&(u=weald(`${g}:trace`)),Object.assign(weald(g),{error:weald(`${g}:error`),trace:u,newScope:h=>logger(`${g}:${h}`)})}function notEmpty(g){if(g!=null&&(g=g.trim(),g.length!==0))return g}function mapIterable(g,u){const h={[Symbol.iterator]:()=>h,next:()=>{const y=g.next(),v=y.value;return y.done===!0||v==null?{done:!0,value:void 0}:{done:!1,value:u(v)}}};return h}function peerIdFromString(g){const u=decode$5(base58btc.decode(`z${g}`));return peerIdFromMultihash(u)}class PeerMap{map;constructor(u){if(this.map=new Map,u!=null)for(const[h,y]of u.entries())this.map.set(h.toString(),{key:h,value:y})}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(u){return this.map.delete(u.toString())}entries(){return mapIterable(this.map.entries(),u=>[u[1].key,u[1].value])}forEach(u){this.map.forEach((h,y)=>{u(h.value,h.key,this)})}get(u){return this.map.get(u.toString())?.value}has(u){return this.map.has(u.toString())}set(u,h){this.map.set(u.toString(),{key:u,value:h})}keys(){return mapIterable(this.map.values(),u=>u.key)}values(){return mapIterable(this.map.values(),u=>u.value)}get size(){return this.map.size}}class PeerSet{set;constructor(u){if(this.set=new Set,u!=null)for(const h of u)this.set.add(h.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(u){this.set.add(u.toString())}clear(){this.set.clear()}delete(u){this.set.delete(u.toString())}entries(){return mapIterable(this.set.entries(),u=>{const h=peerIdFromString(u[0]);return[h,h]})}forEach(u){this.set.forEach(h=>{const y=peerIdFromString(h);u(y,y,this)})}has(u){return this.set.has(u.toString())}values(){return mapIterable(this.set.values(),u=>peerIdFromString(u))}intersection(u){const h=new PeerSet;for(const y of u)this.has(y)&&h.add(y);return h}difference(u){const h=new PeerSet;for(const y of this)u.has(y)||h.add(y);return h}union(u){const h=new PeerSet;for(const y of u)h.add(y);for(const y of this)h.add(y);return h}}const FNV_PRIMES={32:16777619n,64:1099511628211n,128:309485009821345068724781371n,256:374144419156711147060143317175368453031918731002211n,512:35835915874844867368919076489095108449946327955754392558399825615420669938882575126094039892345713852759n,1024:5016456510113118655434598811035278955030765345404790744303017523831112055108147451509157692220295382716162651878526895249385292291816524375083746691371804094271873160484737966720260389217684476157468082573n},FNV_OFFSETS={32:2166136261n,64:14695981039346656037n,128:144066263297769815596495629667062367629n,256:100029257958052580907070968620625704837092796014241193945225284501741471925557n,512:9659303129496669498009435400716310466090418745672637896108374329434462657994582932197716438449813051892206539805784495328239340083876191928701583869517785n,1024:14197795064947621068722070641403218320880622795441933960878474914617582723252296732303717722150864096521202355549365628174669108571814760471015076148029755969804077320157692458563003215304957150157403644460363550505412711285966361610267868082893823963790439336411086884584107735010676915n},cachedEncoder=new globalThis.TextEncoder;function fnv1aUint8Array(g,u){const h=FNV_PRIMES[u];let y=FNV_OFFSETS[u];for(let v=0;v<g.length;v++)y^=BigInt(g[v]),y=BigInt.asUintN(u,y*h);return y}function fnv1aEncodeInto(g,u,h){if(h.length===0)throw new Error("The `utf8Buffer` option must have a length greater than zero");const y=FNV_PRIMES[u];let v=FNV_OFFSETS[u],b=g;for(;b.length>0;){const w=cachedEncoder.encodeInto(b,h);b=b.slice(w.read);for(let E=0;E<w.written;E++)v^=BigInt(h[E]),v=BigInt.asUintN(u,v*y)}return v}function fnv1a$1(g,{size:u=32,utf8Buffer:h}={}){if(!FNV_PRIMES[u])throw new Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if(typeof g=="string"){if(h)return fnv1aEncodeInto(g,u,h);g=cachedEncoder.encode(g)}return fnv1aUint8Array(g,u)}const fnv1a={hash:g=>Number(fnv1a$1(g,{size:32})),hashV:(g,u)=>numberToBuffer(fnv1a.hash(g,u))};function numberToBuffer(g){let u=g.toString(16);return u.length%2===1&&(u=`0${u}`),fromString(u,"base16")}const MAX_FINGERPRINT_SIZE=64;class Fingerprint{fp;h;seed;constructor(u,h,y,v=2){if(v>MAX_FINGERPRINT_SIZE)throw new TypeError("Invalid Fingerprint Size");const b=h.hashV(u,y),w=alloc$1(v);for(let E=0;E<w.length;E++)w[E]=b[E];w.length===0&&(w[0]=7),this.fp=w,this.h=h,this.seed=y}hash(){return this.h.hash(this.fp,this.seed)}equals(u){return u?.fp instanceof Uint8Array?equals(this.fp,u.fp):!1}}function getRandomInt(g,u){return Math.floor(Math.random()*(u-g))+g}class Bucket{contents;constructor(u){this.contents=new Array(u).fill(null)}has(u){if(!(u instanceof Fingerprint))throw new TypeError("Invalid Fingerprint");return this.contents.some(h=>u.equals(h))}add(u){if(!(u instanceof Fingerprint))throw new TypeError("Invalid Fingerprint");for(let h=0;h<this.contents.length;h++)if(this.contents[h]==null)return this.contents[h]=u,!0;return!0}swap(u){if(!(u instanceof Fingerprint))throw new TypeError("Invalid Fingerprint");const h=getRandomInt(0,this.contents.length-1),y=this.contents[h];return this.contents[h]=u,y}remove(u){if(!(u instanceof Fingerprint))throw new TypeError("Invalid Fingerprint");const h=this.contents.findIndex(y=>u.equals(y));return h>-1?(this.contents[h]=null,!0):!1}}const maxCuckooCount=500;class CuckooFilter{bucketSize;filterSize;fingerprintSize;buckets;count;hash;seed;constructor(u){this.filterSize=u.filterSize,this.bucketSize=u.bucketSize??4,this.fingerprintSize=u.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=u.hash??fnv1a,this.seed=u.seed??getRandomInt(0,Math.pow(2,10))}add(u){typeof u=="string"&&(u=fromString(u));const h=new Fingerprint(u,this.hash,this.seed,this.fingerprintSize),y=this.hash.hash(u,this.seed)%this.filterSize,v=(y^h.hash())%this.filterSize;if(this.buckets[y]==null&&(this.buckets[y]=new Bucket(this.bucketSize)),this.buckets[v]==null&&(this.buckets[v]=new Bucket(this.bucketSize)),this.buckets[y].add(h)||this.buckets[v].add(h))return this.count++,!0;const b=[y,v];let w=b[getRandomInt(0,b.length-1)];this.buckets[w]==null&&(this.buckets[w]=new Bucket(this.bucketSize));for(let E=0;E<maxCuckooCount;E++){const _=this.buckets[w].swap(h);if(_!=null&&(w=(w^_.hash())%this.filterSize,this.buckets[w]==null&&(this.buckets[w]=new Bucket(this.bucketSize)),this.buckets[w].add(_)))return this.count++,!0}return!1}has(u){typeof u=="string"&&(u=fromString(u));const h=new Fingerprint(u,this.hash,this.seed,this.fingerprintSize),y=this.hash.hash(u,this.seed)%this.filterSize,v=this.buckets[y]?.has(h)??!1;if(v)return v;const b=(y^h.hash())%this.filterSize;return this.buckets[b]?.has(h)??!1}remove(u){typeof u=="string"&&(u=fromString(u));const h=new Fingerprint(u,this.hash,this.seed,this.fingerprintSize),y=this.hash.hash(u,this.seed)%this.filterSize,v=this.buckets[y]?.remove(h)??!1;if(v)return this.count--,v;const b=(y^h.hash())%this.filterSize,w=this.buckets[b]?.remove(h)??!1;return w&&this.count--,w}get reliable(){return Math.floor(100*(this.count/this.filterSize))<=90}}const MAX_LOAD={1:.5,2:.84,4:.95,8:.98};function calculateBucketSize(g=.001){return g>.002?2:g>1e-5?4:8}function optimize(g,u=.001){const h=calculateBucketSize(u),y=MAX_LOAD[h],v=Math.round(g/y),b=Math.min(Math.ceil(Math.log2(1/u)+Math.log2(2*h)),MAX_FINGERPRINT_SIZE);return{filterSize:v,bucketSize:h,fingerprintSize:b}}class ScalableCuckooFilter{filterSize;bucketSize;fingerprintSize;scale;filterSeries;hash;seed;constructor(u){this.bucketSize=u.bucketSize??4,this.filterSize=u.filterSize??(1<<18)/this.bucketSize,this.fingerprintSize=u.fingerprintSize??2,this.scale=u.scale??2,this.hash=u.hash??fnv1a,this.seed=u.seed??getRandomInt(0,Math.pow(2,10)),this.filterSeries=[new CuckooFilter({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(u){if(typeof u=="string"&&(u=fromString(u)),this.has(u))return!0;let h=this.filterSeries.find(y=>y.reliable);if(h==null){const y=this.filterSize*Math.pow(this.scale,this.filterSeries.length);h=new CuckooFilter({filterSize:y,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(h)}return h.add(u)}has(u){typeof u=="string"&&(u=fromString(u));for(let h=0;h<this.filterSeries.length;h++)if(this.filterSeries[h].has(u))return!0;return!1}remove(u){typeof u=="string"&&(u=fromString(u));for(let h=0;h<this.filterSeries.length;h++)if(this.filterSeries[h].remove(u))return!0;return!1}get count(){return this.filterSeries.reduce((u,h)=>u+h.count,0)}}function createScalableCuckooFilter(g,u=.001,h){return new ScalableCuckooFilter({...optimize(g,u)})}class PeerFilter{filter;constructor(u,h){this.filter=createScalableCuckooFilter(u,h)}has(u){return this.filter.has(u.toMultihash().bytes)}add(u){this.filter.add(u.toMultihash().bytes)}remove(u){this.filter.remove?.(u.toMultihash().bytes)}}function peerFilter(g,u=.001){return new PeerFilter(g,u)}class TrackedPeerMap extends PeerMap{metric;constructor(u){super();const{name:h,metrics:y}=u;this.metric=y.registerMetric(h),this.updateComponentMetric()}set(u,h){return super.set(u,h),this.updateComponentMetric(),this}delete(u){const h=super.delete(u);return this.updateComponentMetric(),h}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function trackedPeerMap(g){const{name:u,metrics:h}=g;let y;return h!=null?y=new TrackedPeerMap({name:u,metrics:h}):y=new PeerMap,y}function isAsyncIterable$3(g){return g[Symbol.asyncIterator]!=null}function all$1(g){if(isAsyncIterable$3(g))return(async()=>{const h=[];for await(const y of g)h.push(y);return h})();const u=[];for(const h of g)u.push(h);return u}let AbortError$2=class extends Error{static name="AbortError";name="AbortError";constructor(u="The operation was aborted",...h){super(u,...h)}};async function raceEvent(g,u,h,y){const v=new AbortError$2(y?.errorMessage);y?.errorCode!=null&&(v.code=y.errorCode);const b=y?.errorEvent??"error";return h?.aborted===!0?Promise.reject(v):new Promise((w,E)=>{function _(){removeListener(h,"abort",R),removeListener(g,u,S),removeListener(g,b,A)}const S=x=>{try{if(y?.filter?.(x)===!1)return}catch(T){_(),E(T);return}_(),w(x)},A=x=>{if(_(),x instanceof Error){E(x);return}E(x.detail??y?.error??new Error(`The "${y?.errorEvent}" event was emitted but the event had no '.detail' field. Pass an 'error' option to race-event to change this message.`))},R=()=>{_(),E(v)};addListener(h,"abort",R),addListener(g,u,S),addListener(g,b,A)})}function addListener(g,u,h){g!=null&&(isEventTarget(g)?g.addEventListener(u,h):g.addListener(u,h))}function removeListener(g,u,h){g!=null&&(isEventTarget(g)?g.removeEventListener(u,h):g.removeListener(u,h))}function isEventTarget(g){return typeof g.addEventListener=="function"&&typeof g.removeEventListener=="function"}let QueueFullError$1=class extends Error{static name="QueueFullError";constructor(u="The queue was full"){super(u),this.name="QueueFullError"}},JobRecipient$1=class{deferred;signal;constructor(u){this.signal=u,this.deferred=Promise.withResolvers(),this.onAbort=this.onAbort.bind(this),this.signal?.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(this.signal?.reason??new AbortError$2)}cleanup(){this.signal?.removeEventListener("abort",this.onAbort)}};function randomId$1(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}let Job$1=class{id;fn;options;recipients;status;timeline;controller;constructor(u,h){this.id=randomId$1(),this.status="queued",this.fn=u,this.options=h,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(u){this.controller.abort(u)}onAbort(){this.recipients.reduce((h,y)=>h&&y.signal?.aborted===!0,!0)&&(this.controller.abort(new AbortError$2),this.cleanup())}async join(u={}){const h=new JobRecipient$1(u.signal);return this.recipients.push(h),u.signal?.addEventListener("abort",this.onAbort),h.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const u=await raceSignal$1(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(h=>{h.deferred.resolve(u)}),this.status="complete"}catch(u){this.recipients.forEach(h=>{h.deferred.reject(u)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(u=>{u.cleanup(),u.signal?.removeEventListener("abort",this.onAbort)})}};function debounce(g,u){let h;const y=function(){const v=function(){h=void 0,g()};clearTimeout(h),h=setTimeout(v,u)};return y.start=()=>{},y.stop=()=>{clearTimeout(h)},y}let Queue$1=class extends TypedEventEmitter{concurrency;maxSize;queue;pending;sort;autoStart;constructor(u={}){super(),this.concurrency=u.concurrency??Number.POSITIVE_INFINITY,this.maxSize=u.maxSize??Number.POSITIVE_INFINITY,this.pending=0,this.autoStart=u.autoStart??!0,this.sort=u.sort,this.queue=[],this.emitEmpty=debounce(this.emitEmpty.bind(this),1),this.emitIdle=debounce(this.emitIdle.bind(this),1)}[Symbol.asyncIterator](){return this.toGenerator()}emitEmpty(){this.size===0&&this.safeDispatchEvent("empty")}emitIdle(){this.running===0&&this.safeDispatchEvent("idle")}tryToStartAnother(){if(this.size===0)return this.emitEmpty(),this.running===0&&this.emitIdle(),!1;if(this.pending<this.concurrency){let u;for(const h of this.queue)if(h.status==="queued"){u=h;break}return u==null?!1:(this.safeDispatchEvent("active"),this.pending++,u.run().finally(()=>{for(let h=0;h<this.queue.length;h++)if(this.queue[h]===u){this.queue.splice(h,1);break}this.pending--,this.safeDispatchEvent("next"),this.autoStart&&this.tryToStartAnother()}),!0)}return!1}enqueue(u){this.queue.push(u),this.sort!=null&&this.queue.sort(this.sort)}start(){this.autoStart===!1&&(this.autoStart=!0,this.tryToStartAnother())}pause(){this.autoStart=!1}async add(u,h){if(h?.signal?.throwIfAborted(),this.size===this.maxSize)throw new QueueFullError$1;const y=new Job$1(u,h);return this.enqueue(y),this.safeDispatchEvent("add"),this.autoStart&&this.tryToStartAnother(),y.join(h).then(v=>(this.safeDispatchEvent("success",{detail:{job:y,result:v}}),v)).catch(v=>{if(y.status==="queued"){for(let b=0;b<this.queue.length;b++)if(this.queue[b]===y){this.queue.splice(b,1);break}}throw this.safeDispatchEvent("failure",{detail:{job:y,error:v}}),v})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(u=>{u.abort(new AbortError$2)}),this.clear()}async onEmpty(u){this.size!==0&&await raceEvent(this,"empty",u?.signal)}async onSizeLessThan(u,h){this.size<u||await raceEvent(this,"next",h?.signal,{filter:()=>this.size<u})}async onIdle(u){this.pending===0&&this.size===0||await raceEvent(this,"idle",u?.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(u){u?.signal?.throwIfAborted();const h=pushable({objectMode:!0}),y=_=>{_!=null?this.abort():this.clear(),h.end(_)},v=_=>{_.detail!=null&&h.push(_.detail.result)},b=_=>{y(_.detail.error)},w=()=>{y()},E=()=>{y(new AbortError$2("Queue aborted"))};this.addEventListener("success",v),this.addEventListener("failure",b),this.addEventListener("idle",w),u?.signal?.addEventListener("abort",E);try{yield*h}finally{this.removeEventListener("success",v),this.removeEventListener("failure",b),this.removeEventListener("idle",w),u?.signal?.removeEventListener("abort",E),y()}}};const WORKER_REQUEST_READ_LOCK="lock:worker:request-read",WORKER_ABORT_READ_LOCK_REQUEST="lock:worker:abort-read-request",WORKER_RELEASE_READ_LOCK="lock:worker:release-read",MASTER_GRANT_READ_LOCK="lock:master:grant-read",MASTER_READ_LOCK_ERROR="lock:master:error-read",WORKER_REQUEST_WRITE_LOCK="lock:worker:request-write",WORKER_ABORT_WRITE_LOCK_REQUEST="lock:worker:abort-write-request",WORKER_RELEASE_WRITE_LOCK="lock:worker:release-write",MASTER_GRANT_WRITE_LOCK="lock:master:grant-write",MASTER_WRITE_LOCK_ERROR="lock:master:error-write",WORKER_FINALIZE="lock:worker:finalize",BROADCAST_CHANNEL_NAME="mortice",defaultOptions$3={singleProcess:!1},handleChannelWorkerLockRequest=(g,u,h,y,v,b,w,E,_)=>S=>{if(S.data==null)return;const A={type:S.data.type,name:S.data.name,identifier:S.data.identifier};A.type===v&&g.safeDispatchEvent(h,{detail:{name:A.name,identifier:A.identifier,handler:async()=>{u.postMessage({type:_,name:A.name,identifier:A.identifier}),await new Promise(R=>{const x=T=>{if(T?.data==null)return;const C={type:T.data.type,name:T.data.name,identifier:T.data.identifier};C.type===E&&C.identifier===A.identifier&&(u.removeEventListener("message",x),R())};u.addEventListener("message",x)})},onError:R=>{u.postMessage({type:w,name:A.name,identifier:A.identifier,error:{message:R.message,name:R.name,stack:R.stack}})}}}),A.type===b&&g.safeDispatchEvent(y,{detail:{name:A.name,identifier:A.identifier}}),A.type===WORKER_FINALIZE&&g.safeDispatchEvent("finalizeRequest",{detail:{name:A.name}})},nanoid$1=(g=10)=>Math.random().toString().substring(2,g+2);class MorticeChannelWorker{name;channel;constructor(u){this.name=u,this.channel=new BroadcastChannel(BROADCAST_CHANNEL_NAME)}readLock(u){return this.sendRequest(WORKER_REQUEST_READ_LOCK,WORKER_ABORT_READ_LOCK_REQUEST,MASTER_GRANT_READ_LOCK,MASTER_READ_LOCK_ERROR,WORKER_RELEASE_READ_LOCK,u)}writeLock(u){return this.sendRequest(WORKER_REQUEST_WRITE_LOCK,WORKER_ABORT_WRITE_LOCK_REQUEST,MASTER_GRANT_WRITE_LOCK,MASTER_WRITE_LOCK_ERROR,WORKER_RELEASE_WRITE_LOCK,u)}finalize(){this.channel.postMessage({type:WORKER_FINALIZE,name:this.name}),this.channel.close()}async sendRequest(u,h,y,v,b,w){w?.signal?.throwIfAborted();const E=nanoid$1();return this.channel.postMessage({type:u,identifier:E,name:this.name}),new Promise((_,S)=>{const A=()=>{this.channel.postMessage({type:h,identifier:E,name:this.name})};w?.signal?.addEventListener("abort",A,{once:!0});const R=x=>{if(x.data?.identifier===E&&(x.data?.type===y&&(this.channel.removeEventListener("message",R),w?.signal?.removeEventListener("abort",A),_(()=>{this.channel.postMessage({type:b,identifier:E,name:this.name})})),x.data.type===v)){this.channel.removeEventListener("message",R),w?.signal?.removeEventListener("abort",A);const T=new Error;x.data.error!=null&&(T.message=x.data.error.message,T.name=x.data.error.name,T.stack=x.data.error.stack),S(T)}};this.channel.addEventListener("message",R)})}}const impl=g=>{if(g=Object.assign({},defaultOptions$3,g),!!globalThis.document||g.singleProcess){const h=new BroadcastChannel(BROADCAST_CHANNEL_NAME),y=new TypedEventEmitter;return h.addEventListener("message",handleChannelWorkerLockRequest(y,h,"requestReadLock","abortReadLockRequest",WORKER_REQUEST_READ_LOCK,WORKER_ABORT_READ_LOCK_REQUEST,MASTER_READ_LOCK_ERROR,WORKER_RELEASE_READ_LOCK,MASTER_GRANT_READ_LOCK)),h.addEventListener("message",handleChannelWorkerLockRequest(y,h,"requestWriteLock","abortWriteLockRequest",WORKER_REQUEST_WRITE_LOCK,WORKER_ABORT_WRITE_LOCK_REQUEST,MASTER_WRITE_LOCK_ERROR,WORKER_RELEASE_WRITE_LOCK,MASTER_GRANT_WRITE_LOCK)),y}return new MorticeChannelWorker(g.name)},mutexes=new Map;let implementation$2;function isMortice(g){return typeof g?.readLock=="function"&&typeof g?.writeLock=="function"}function getImplementation(g){if(implementation$2==null&&(implementation$2=impl(g),!isMortice(implementation$2))){const u=implementation$2;u.addEventListener("requestReadLock",h=>{const y=h.detail.name,v=h.detail.identifier,b=mutexes.get(y);if(b==null)return;const w=new AbortController,E=_=>{_.detail.name!==y||_.detail.identifier!==v||w.abort()};u.addEventListener("abortReadLockRequest",E),b.readLock({signal:w.signal}).then(async _=>{await h.detail.handler().finally(()=>{_()})}).catch(_=>{h.detail.onError(_)}).finally(()=>{u.removeEventListener("abortReadLockRequest",E)})}),u.addEventListener("requestWriteLock",h=>{const y=h.detail.name,v=h.detail.identifier,b=mutexes.get(y);if(b==null)return;const w=new AbortController,E=_=>{_.detail.name!==y||_.detail.identifier!==v||w.abort()};u.addEventListener("abortWriteLockRequest",E),b.writeLock({signal:w.signal}).then(async _=>{await h.detail.handler().finally(()=>{_()})}).catch(_=>{h.detail.onError(_)}).finally(()=>{u.removeEventListener("abortWriteLockRequest",E)})}),u.addEventListener("finalizeRequest",h=>{const y=h.detail.name,v=mutexes.get(y);v?.finalize()})}return implementation$2}async function createReleasable(g,u){let h,y;const v=new Promise((w,E)=>{h=w,y=E}),b=()=>{y(new AbortError$2)};return u?.signal?.addEventListener("abort",b,{once:!0}),g.add(async()=>{await new Promise(w=>{h(()=>{u?.signal?.removeEventListener("abort",b),w()})})},{signal:u?.signal}).catch(w=>{y(w)}),v}const createMutex=(g,u)=>{let h=mutexes.get(g);if(h!=null)return h;const y=getImplementation(u);if(isMortice(y))return h=y,mutexes.set(g,h),h;const v=new Queue$1({concurrency:1});let b;return h={async readLock(w){if(b!=null)return createReleasable(b,w);b=new Queue$1({concurrency:u.concurrency,autoStart:!1});const E=b,_=createReleasable(b,w);return v.add(async()=>{E.start(),await E.onIdle().then(()=>{b===E&&(b=null)})}),_},async writeLock(w){return b=null,createReleasable(v,w)},finalize:()=>{mutexes.delete(g)},queue:v},mutexes.set(g,h),u.autoFinalize===!0&&v.addEventListener("idle",()=>{h.finalize()},{once:!0}),h},defaultOptions$2={name:"lock",concurrency:1/0,singleProcess:!1,autoFinalize:!1};function createMortice(g){const u=Object.assign({},defaultOptions$2,g);return createMutex(u.name,u)}const MAX_ADDRESS_AGE=36e5,MAX_PEER_AGE=216e5;var Peer$1;(function(g){(function(h){let y;h.codec=()=>(y==null&&(y=message((v,b,w={})=>{w.lengthDelimited!==!1&&b.fork(),v.key!=null&&v.key!==""&&(b.uint32(10),b.string(v.key)),v.value!=null&&v.value.byteLength>0&&(b.uint32(18),b.bytes(v.value)),w.lengthDelimited!==!1&&b.ldelim()},(v,b,w={})=>{const E={key:"",value:alloc$1(0)},_=b==null?v.len:v.pos+b;for(;v.pos<_;){const S=v.uint32();switch(S>>>3){case 1:{E.key=v.string();break}case 2:{E.value=v.bytes();break}default:{v.skipType(S&7);break}}}return E})),y),h.encode=v=>encodeMessage(v,h.codec()),h.decode=(v,b)=>decodeMessage(v,h.codec(),b)})(g.Peer$metadataEntry||(g.Peer$metadataEntry={})),(function(h){let y;h.codec=()=>(y==null&&(y=message((v,b,w={})=>{w.lengthDelimited!==!1&&b.fork(),v.key!=null&&v.key!==""&&(b.uint32(10),b.string(v.key)),v.value!=null&&(b.uint32(18),Tag.codec().encode(v.value,b)),w.lengthDelimited!==!1&&b.ldelim()},(v,b,w={})=>{const E={key:""},_=b==null?v.len:v.pos+b;for(;v.pos<_;){const S=v.uint32();switch(S>>>3){case 1:{E.key=v.string();break}case 2:{E.value=Tag.codec().decode(v,v.uint32(),{limits:w.limits?.value});break}default:{v.skipType(S&7);break}}}return E})),y),h.encode=v=>encodeMessage(v,h.codec()),h.decode=(v,b)=>decodeMessage(v,h.codec(),b)})(g.Peer$tagsEntry||(g.Peer$tagsEntry={}));let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{if(v.lengthDelimited!==!1&&y.fork(),h.addresses!=null)for(const b of h.addresses)y.uint32(10),Address.codec().encode(b,y);if(h.protocols!=null)for(const b of h.protocols)y.uint32(18),y.string(b);if(h.publicKey!=null&&(y.uint32(34),y.bytes(h.publicKey)),h.peerRecordEnvelope!=null&&(y.uint32(42),y.bytes(h.peerRecordEnvelope)),h.metadata!=null&&h.metadata.size!==0)for(const[b,w]of h.metadata.entries())y.uint32(50),g.Peer$metadataEntry.codec().encode({key:b,value:w},y);if(h.tags!=null&&h.tags.size!==0)for(const[b,w]of h.tags.entries())y.uint32(58),g.Peer$tagsEntry.codec().encode({key:b,value:w},y);h.updated!=null&&(y.uint32(64),y.uint64Number(h.updated)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={addresses:[],protocols:[],metadata:new Map,tags:new Map},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{if(v.limits?.addresses!=null&&b.addresses.length===v.limits.addresses)throw new MaxLengthError('Decode error - map field "addresses" had too many elements');b.addresses.push(Address.codec().decode(h,h.uint32(),{limits:v.limits?.addresses$}));break}case 2:{if(v.limits?.protocols!=null&&b.protocols.length===v.limits.protocols)throw new MaxLengthError('Decode error - map field "protocols" had too many elements');b.protocols.push(h.string());break}case 4:{b.publicKey=h.bytes();break}case 5:{b.peerRecordEnvelope=h.bytes();break}case 6:{if(v.limits?.metadata!=null&&b.metadata.size===v.limits.metadata)throw new MaxSizeError('Decode error - map field "metadata" had too many elements');const _=g.Peer$metadataEntry.codec().decode(h,h.uint32());b.metadata.set(_.key,_.value);break}case 7:{if(v.limits?.tags!=null&&b.tags.size===v.limits.tags)throw new MaxSizeError('Decode error - map field "tags" had too many elements');const _=g.Peer$tagsEntry.codec().decode(h,h.uint32(),{limits:{value:v.limits?.tags$value}});b.tags.set(_.key,_.value);break}case 8:{b.updated=h.uint64Number();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(Peer$1||(Peer$1={}));var Address;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.multiaddr!=null&&h.multiaddr.byteLength>0&&(y.uint32(10),y.bytes(h.multiaddr)),h.isCertified!=null&&(y.uint32(16),y.bool(h.isCertified)),h.observed!=null&&(y.uint32(24),y.uint64Number(h.observed)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={multiaddr:alloc$1(0)},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.multiaddr=h.bytes();break}case 2:{b.isCertified=h.bool();break}case 3:{b.observed=h.uint64Number();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(Address||(Address={}));var Tag;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.value!=null&&h.value!==0&&(y.uint32(8),y.uint32(h.value)),h.expiry!=null&&(y.uint32(16),y.uint64(h.expiry)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={value:0},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.value=h.uint32();break}case 2:{b.expiry=h.uint64();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(Tag||(Tag={}));function populatePublicKey(g,u){if(g.publicKey!=null||u.publicKey==null)return g;let h;g.type==="RSA"&&(h=g.toMultihash());const y=publicKeyFromProtobuf(u.publicKey,h);return peerIdFromPublicKey(y)}function bytesToPeer(g,u,h){const y=Peer$1.decode(u);return pbToPeer(g,y,h)}function pbToPeer(g,u,h){const y=new Map,v=BigInt(Date.now());for(const[b,w]of u.tags.entries())w.expiry!=null&&w.expiry<v||y.set(b,w);return{...u,id:populatePublicKey(g,u),addresses:u.addresses.filter(({observed:b})=>b!=null&&b>Date.now()-h).map(({multiaddr:b,isCertified:w})=>({multiaddr:multiaddr(b),isCertified:w??!1})),metadata:u.metadata,peerRecordEnvelope:u.peerRecordEnvelope??void 0,tags:y}}function peerEquals(g,u){return addressesEqual(g.addresses,u.addresses)&&protocolsEqual(g.protocols,u.protocols)&&publicKeyEqual(g.publicKey,u.publicKey)&&peerRecordEnvelope(g.peerRecordEnvelope,u.peerRecordEnvelope)&&metadataEqual(g.metadata,u.metadata)&&tagsEqual(g.tags,u.tags)}function addressesEqual(g,u){return compareArrays(g,u,(h,y)=>!(h.isCertified!==y.isCertified||!equals(h.multiaddr,y.multiaddr)))}function protocolsEqual(g,u){return compareArrays(g,u,(h,y)=>h===y)}function publicKeyEqual(g,u){return compareOptionalUint8Arrays(g,u)}function peerRecordEnvelope(g,u){return compareOptionalUint8Arrays(g,u)}function metadataEqual(g,u){return compareMaps(g,u,(h,y)=>equals(h,y))}function tagsEqual(g,u){return compareMaps(g,u,(h,y)=>h.value===y.value&&h.expiry===y.expiry)}function compareOptionalUint8Arrays(g,u){return g==null&&u==null?!0:g!=null&&u!=null?equals(g,u):!1}function compareArrays(g,u,h){if(g.length!==u.length)return!1;for(let y=0;y<g.length;y++)if(!h(g[y],u[y]))return!1;return!0}function compareMaps(g,u,h){if(g.size!==u.size)return!1;for(const[y,v]of g.entries()){const b=u.get(y);if(b==null||!h(v,b))return!1}return!0}const pathSepS="/",pathSepB=new TextEncoder().encode(pathSepS),pathSep=pathSepB[0];class Key{_buf;constructor(u,h){if(typeof u=="string")this._buf=fromString(u);else if(u instanceof Uint8Array)this._buf=u;else throw new Error("Invalid key, should be String of Uint8Array");if(h==null&&(h=!0),h&&this.clean(),this._buf.byteLength===0||this._buf[0]!==pathSep)throw new Error("Invalid key")}toString(u="utf8"){return toString$1(this._buf,u)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(u){return new Key(u.join(pathSepS))}static random(){return new Key(Math.random().toString().substring(2))}static asKey(u){return u instanceof Uint8Array||typeof u=="string"?new Key(u):typeof u.uint8Array=="function"?new Key(u.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=pathSepB),this._buf[0]!==pathSep){const u=new Uint8Array(this._buf.byteLength+1);u.fill(pathSep,0,1),u.set(this._buf,1),this._buf=u}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===pathSep;)this._buf=this._buf.subarray(0,-1)}less(u){const h=this.list(),y=u.list();for(let v=0;v<h.length;v++){if(y.length<v+1)return!1;const b=h[v],w=y[v];if(b<w)return!0;if(b>w)return!1}return h.length<y.length}reverse(){return Key.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const u=this.namespaces();return u[u.length-1]}list(){return this.toString().split(pathSepS).slice(1)}type(){return namespaceType(this.baseNamespace())}name(){return namespaceValue(this.baseNamespace())}instance(u){return new Key(this.toString()+":"+u)}path(){let u=this.parent().toString();return u.endsWith(pathSepS)||(u+=pathSepS),u+=this.type(),new Key(u)}parent(){const u=this.list();return u.length===1?new Key(pathSepS):new Key(u.slice(0,-1).join(pathSepS))}child(u){return this.toString()===pathSepS?u:u.toString()===pathSepS?this:new Key(this.toString()+u.toString(),!1)}isAncestorOf(u){return u.toString()===this.toString()?!1:u.toString().startsWith(this.toString())}isDecendantOf(u){return u.toString()===this.toString()?!1:this.toString().startsWith(u.toString())}isTopLevel(){return this.list().length===1}concat(...u){return Key.withNamespaces([...this.namespaces(),...flatten(u.map(h=>h.namespaces()))])}}function namespaceType(g){const u=g.split(":");return u.length<2?"":u.slice(0,-1).join(":")}function namespaceValue(g){const u=g.split(":");return u[u.length-1]}function flatten(g){return[].concat(...g)}const NAMESPACE_COMMON="/peers/";function peerIdToDatastoreKey(g){if(!isPeerId(g)||g.type==null)throw new InvalidParametersError$1("Invalid PeerId");const u=g.toCID().toString();return new Key(`${NAMESPACE_COMMON}${u}`)}async function dedupeFilterAndSortAddresses(g,u,h,y,v){const b=new Map;for(const w of h){if(w==null)continue;if(w.multiaddr instanceof Uint8Array&&(w.multiaddr=multiaddr(w.multiaddr)),!isMultiaddr(w.multiaddr))throw new InvalidParametersError$1("Multiaddr was invalid");if(!await u(g,w.multiaddr,v))continue;const E=w.isCertified??!1,_=w.multiaddr.toString(),S=b.get(_);S!=null?w.isCertified=S.isCertified||E:b.set(_,{multiaddr:w.multiaddr,isCertified:E})}return[...b.values()].sort((w,E)=>w.multiaddr.toString().localeCompare(E.multiaddr.toString())).map(({isCertified:w,multiaddr:E})=>{const _=E.getPeerId();return g.equals(_)&&(E=E.decapsulate(multiaddr(`/p2p/${g}`))),{isCertified:w,multiaddr:E.bytes}})}async function toPeerPB(g,u,h,y){if(u==null)throw new InvalidParametersError$1("Invalid PeerData");if(u.publicKey!=null&&g.publicKey!=null&&!u.publicKey.equals(g.publicKey))throw new InvalidParametersError$1("publicKey bytes do not match peer id publicKey bytes");const v=y.existingPeer?.peer;if(v!=null&&!g.equals(v.id))throw new InvalidParametersError$1("peer id did not match existing peer id");let b=v?.addresses??[],w=new Set(v?.protocols??[]),E=v?.metadata??new Map,_=v?.tags??new Map,S=v?.peerRecordEnvelope;if(h==="patch"){if((u.multiaddrs!=null||u.addresses!=null)&&(b=[],u.multiaddrs!=null&&b.push(...u.multiaddrs.map(x=>({isCertified:!1,multiaddr:x}))),u.addresses!=null&&b.push(...u.addresses)),u.protocols!=null&&(w=new Set(u.protocols)),u.metadata!=null){const x=u.metadata instanceof Map?[...u.metadata.entries()]:Object.entries(u.metadata);E=createSortedMap(x,{validate:validateMetadata})}if(u.tags!=null){const x=u.tags instanceof Map?[...u.tags.entries()]:Object.entries(u.tags);_=createSortedMap(x,{validate:validateTag,map:mapTag})}u.peerRecordEnvelope!=null&&(S=u.peerRecordEnvelope)}if(h==="merge"){if(u.multiaddrs!=null&&b.push(...u.multiaddrs.map(x=>({isCertified:!1,multiaddr:x}))),u.addresses!=null&&b.push(...u.addresses),u.protocols!=null&&(w=new Set([...w,...u.protocols])),u.metadata!=null){const x=u.metadata instanceof Map?[...u.metadata.entries()]:Object.entries(u.metadata);for(const[T,C]of x)C==null?E.delete(T):E.set(T,C);E=createSortedMap([...E.entries()],{validate:validateMetadata})}if(u.tags!=null){const x=u.tags instanceof Map?[...u.tags.entries()]:Object.entries(u.tags),T=new Map(_);for(const[C,I]of x)I==null?T.delete(C):T.set(C,I);_=createSortedMap([...T.entries()],{validate:validateTag,map:mapTag})}u.peerRecordEnvelope!=null&&(S=u.peerRecordEnvelope)}let A;v?.id.publicKey!=null?A=publicKeyToProtobuf(v.id.publicKey):u.publicKey!=null?A=publicKeyToProtobuf(u.publicKey):g.publicKey!=null&&(A=publicKeyToProtobuf(g.publicKey));const R={addresses:await dedupeFilterAndSortAddresses(g,y.addressFilter??(async()=>!0),b,y.existingPeer?.peerPB.addresses,y),protocols:[...w.values()].sort((x,T)=>x.localeCompare(T)),metadata:E,tags:_,publicKey:A,peerRecordEnvelope:S};return R.addresses.forEach(x=>{x.observed=y.existingPeer?.peerPB.addresses?.find(T=>equals(T.multiaddr,T.multiaddr))?.observed??Date.now()}),g.type!=="RSA"&&delete R.publicKey,R}function createSortedMap(g,u){const h=new Map;for(const[y,v]of g)v!=null&&u.validate(y,v);for(const[y,v]of g.sort(([b],[w])=>b.localeCompare(w)))v!=null&&h.set(y,u.map?.(y,v)??v);return h}function validateMetadata(g,u){if(typeof g!="string")throw new InvalidParametersError$1("Metadata key must be a string");if(!(u instanceof Uint8Array))throw new InvalidParametersError$1("Metadata value must be a Uint8Array")}function validateTag(g,u){if(typeof g!="string")throw new InvalidParametersError$1("Tag name must be a string");if(u.value!=null){if(parseInt(`${u.value}`,10)!==u.value)throw new InvalidParametersError$1("Tag value must be an integer");if(u.value<0||u.value>100)throw new InvalidParametersError$1("Tag value must be between 0-100")}if(u.ttl!=null){if(parseInt(`${u.ttl}`,10)!==u.ttl)throw new InvalidParametersError$1("Tag ttl must be an integer");if(u.ttl<0)throw new InvalidParametersError$1("Tag ttl must be between greater than 0")}}function mapTag(g,u){let h;u.expiry!=null&&(h=u.expiry),u.ttl!=null&&(h=BigInt(Date.now()+Number(u.ttl)));const y={value:u.value??0};return h!=null&&(y.expiry=h),y}function keyToPeerId(g){const u=g.toString().split("/")[2],h=CID.parse(u,base32);return peerIdFromCID(h)}function decodePeer(g,u,h){const y=keyToPeerId(g);return bytesToPeer(y,u,h)}function mapQuery(g,u){return{prefix:NAMESPACE_COMMON,filters:(g.filters??[]).map(h=>({key:y,value:v})=>h(decodePeer(y,v,u))),orders:(g.orders??[]).map(h=>(y,v)=>h(decodePeer(y.key,y.value,u),decodePeer(v.key,v.value,u)))}}class PersistentStore{peerId;datastore;locks;addressFilter;log;maxAddressAge;maxPeerAge;constructor(u,h={}){this.log=u.logger.forComponent("libp2p:peer-store"),this.peerId=u.peerId,this.datastore=u.datastore,this.addressFilter=h.addressFilter,this.locks=trackedPeerMap({name:"libp2p_peer_store_locks",metrics:u.metrics}),this.maxAddressAge=h.maxAddressAge??MAX_ADDRESS_AGE,this.maxPeerAge=h.maxPeerAge??MAX_PEER_AGE}getLock(u){let h=this.locks.get(u);return h==null&&(h={refs:0,lock:createMortice({name:u.toString(),singleProcess:!0})},this.locks.set(u,h)),h.refs++,h}maybeRemoveLock(u,h){h.refs--,h.refs===0&&(h.lock.finalize(),this.locks.delete(u))}async getReadLock(u,h){const y=this.getLock(u);try{const v=await y.lock.readLock(h);return()=>{v(),this.maybeRemoveLock(u,y)}}catch(v){throw this.maybeRemoveLock(u,y),v}}async getWriteLock(u,h){const y=this.getLock(u);try{const v=await y.lock.writeLock(h);return()=>{v(),this.maybeRemoveLock(u,y)}}catch(v){throw this.maybeRemoveLock(u,y),v}}async has(u,h){try{return await this.load(u,h),!0}catch(y){if(y.name!=="NotFoundError")throw y}return!1}async delete(u,h){this.peerId.equals(u)||await this.datastore.delete(peerIdToDatastoreKey(u),h)}async load(u,h){const y=peerIdToDatastoreKey(u),v=await this.datastore.get(y,h),b=Peer$1.decode(v);if(this.#r(u,b))throw await this.datastore.delete(y,h),new NotFoundError$1;return pbToPeer(u,b,this.peerId.equals(u)?1/0:this.maxAddressAge)}async save(u,h,y){const v=await this.#e(u,y),b=await toPeerPB(u,h,"patch",{...y,addressFilter:this.addressFilter});return this.#t(u,b,v)}async patch(u,h,y){const v=await this.#e(u,y),b=await toPeerPB(u,h,"patch",{...y,addressFilter:this.addressFilter,existingPeer:v});return this.#t(u,b,v)}async merge(u,h,y){const v=await this.#e(u,y),b=await toPeerPB(u,h,"merge",{addressFilter:this.addressFilter,existingPeer:v});return this.#t(u,b,v)}async*all(u){for await(const{key:h,value:y}of this.datastore.query(mapQuery(u??{},this.maxAddressAge),u)){const v=keyToPeerId(h);if(v.equals(this.peerId))continue;const b=Peer$1.decode(y);if(this.#r(v,b)){await this.datastore.delete(h,u);continue}yield pbToPeer(v,b,this.peerId.equals(v)?1/0:this.maxAddressAge)}}async#e(u,h){try{const y=peerIdToDatastoreKey(u),v=await this.datastore.get(y,h),b=Peer$1.decode(v);if(this.#r(u,b))throw await this.datastore.delete(y,h),new NotFoundError$1;return{peerPB:b,peer:pbToPeer(u,b,this.maxAddressAge)}}catch(y){y.name!=="NotFoundError"&&this.log.error("invalid peer data found in peer store - %e",y)}}async#t(u,h,y,v){h.updated=Date.now();const b=Peer$1.encode(h);return await this.datastore.put(peerIdToDatastoreKey(u),b,v),{peer:pbToPeer(u,h,this.maxAddressAge),previous:y?.peer,updated:y==null||!peerEquals(h,y.peerPB)}}#r(u,h){if(h.updated==null)return!0;if(this.peerId.equals(u))return!1;const y=h.updated<Date.now()-this.maxPeerAge,v=Date.now()-this.maxAddressAge,b=h.addresses.filter(w=>w.observed!=null&&w.observed>v);return y&&b.length===0}}class PersistentPeerStore{store;events;peerId;log;constructor(u,h={}){this.log=u.logger.forComponent("libp2p:peer-store"),this.events=u.events,this.peerId=u.peerId,this.store=new PersistentStore(u,h)}[Symbol.toStringTag]="@libp2p/peer-store";async forEach(u,h){for await(const y of this.store.all(h))u(y)}async all(u){return all$1(this.store.all(u))}async delete(u,h){const y=await this.store.getReadLock(u,h);try{await this.store.delete(u,h)}finally{y()}}async has(u,h){const y=await this.store.getReadLock(u,h);try{return await this.store.has(u,h)}finally{this.log.trace("has release read lock"),y?.()}}async get(u,h){const y=await this.store.getReadLock(u,h);try{return await this.store.load(u,h)}finally{y?.()}}async getInfo(u,h){const y=await this.get(u,h);return{id:y.id,multiaddrs:y.addresses.map(({multiaddr:v})=>v)}}async save(u,h,y){const v=await this.store.getWriteLock(u,y);try{const b=await this.store.save(u,h,y);return this.#e(u,b),b.peer}finally{v?.()}}async patch(u,h,y){const v=await this.store.getWriteLock(u,y);try{const b=await this.store.patch(u,h,y);return this.#e(u,b),b.peer}finally{v?.()}}async merge(u,h,y){const v=await this.store.getWriteLock(u,y);try{const b=await this.store.merge(u,h,y);return this.#e(u,b),b.peer}finally{v?.()}}async consumePeerRecord(u,h,y){const v=isPeerId(h)?h:isPeerId(h?.expectedPeer)?h.expectedPeer:void 0,b=isPeerId(h)||h===void 0?y:h,w=await RecordEnvelope.openAndCertify(u,PeerRecord.DOMAIN,b),E=peerIdFromCID(w.publicKey.toCID());if(v?.equals(E)===!1)return this.log("envelope peer id was not the expected peer id - expected: %p received: %p",v,E),!1;const _=PeerRecord.createFromProtobuf(w.payload);let S;try{S=await this.get(E,b)}catch(A){if(A.name!=="NotFoundError")throw A}if(S?.peerRecordEnvelope!=null){const A=RecordEnvelope.createFromProtobuf(S.peerRecordEnvelope),R=PeerRecord.createFromProtobuf(A.payload);if(R.seqNumber>=_.seqNumber)return this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",R.seqNumber,_.seqNumber),!1}return await this.patch(_.peerId,{peerRecordEnvelope:u,addresses:_.multiaddrs.map(A=>({isCertified:!0,multiaddr:A}))},b),!0}#e(u,h){h.updated&&(this.peerId.equals(u)?this.events.safeDispatchEvent("self:peer:update",{detail:h}):this.events.safeDispatchEvent("peer:update",{detail:h}))}}function persistentPeerStore(g,u={}){return new PersistentPeerStore(g,u)}class OpenFailedError extends Error{static name="OpenFailedError";static code="ERR_OPEN_FAILED";name=OpenFailedError.name;code=OpenFailedError.code;constructor(u="Open failed"){super(u)}}class PutFailedError extends Error{static name="PutFailedError";static code="ERR_PUT_FAILED";name=PutFailedError.name;code=PutFailedError.code;constructor(u="Put failed"){super(u)}}class GetFailedError extends Error{static name="GetFailedError";static code="ERR_GET_FAILED";name=GetFailedError.name;code=GetFailedError.code;constructor(u="Get failed"){super(u)}}class DeleteFailedError extends Error{static name="DeleteFailedError";static code="ERR_DELETE_FAILED";name=DeleteFailedError.name;code=DeleteFailedError.code;constructor(u="Delete failed"){super(u)}}class NotFoundError extends Error{static name="NotFoundError";static code="ERR_NOT_FOUND";name=NotFoundError.name;code=NotFoundError.code;constructor(u="Not Found"){super(u)}}function isAsyncIterable$2(g){return g[Symbol.asyncIterator]!=null}function filter(g,u){let h=0;if(isAsyncIterable$2(g))return(async function*(){for await(const _ of g)await u(_,h++)&&(yield _)})();const y=peekable(g),{value:v,done:b}=y.next();if(b===!0)return(function*(){})();const w=u(v,h++);if(typeof w.then=="function")return(async function*(){await w&&(yield v);for(const _ of y)await u(_,h++)&&(yield _)})();const E=u;return(function*(){w===!0&&(yield v);for(const _ of y)E(_,h++)&&(yield _)})()}function isAsyncIterable$1(g){return g[Symbol.asyncIterator]!=null}function sort(g,u){return isAsyncIterable$1(g)?(async function*(){yield*(await all$1(g)).sort(u)})():(function*(){yield*all$1(g).sort(u)})()}function isAsyncIterable(g){return g[Symbol.asyncIterator]!=null}function take(g,u){return isAsyncIterable(g)?(async function*(){let h=0;if(!(u<1)){for await(const y of g)if(yield y,h++,h===u)return}})():(function*(){let h=0;if(!(u<1)){for(const y of g)if(yield y,h++,h===u)return}})()}class BaseDatastore{put(u,h,y){return Promise.reject(new Error(".put is not implemented"))}get(u,h){return Promise.reject(new Error(".get is not implemented"))}has(u,h){return Promise.reject(new Error(".has is not implemented"))}delete(u,h){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(u,h={}){for await(const{key:y,value:v}of u)await this.put(y,v,h),yield y}async*getMany(u,h={}){for await(const y of u)yield{key:y,value:await this.get(y,h)}}async*deleteMany(u,h={}){for await(const y of u)await this.delete(y,h),yield y}batch(){let u=[],h=[];return{put(y,v){u.push({key:y,value:v})},delete(y){h.push(y)},commit:async y=>{await drain(this.putMany(u,y)),u=[],await drain(this.deleteMany(h,y)),h=[]}}}async*_all(u,h){throw new Error("._all is not implemented")}async*_allKeys(u,h){throw new Error("._allKeys is not implemented")}query(u,h){let y=this._all(u,h);if(u.prefix!=null){const v=u.prefix;y=filter(y,b=>b.key.toString().startsWith(v))}if(Array.isArray(u.filters)&&(y=u.filters.reduce((v,b)=>filter(v,b),y)),Array.isArray(u.orders)&&(y=u.orders.reduce((v,b)=>sort(v,b),y)),u.offset!=null){let v=0;const b=u.offset;y=filter(y,()=>v++>=b)}return u.limit!=null&&(y=take(y,u.limit)),y}queryKeys(u,h){let y=this._allKeys(u,h);if(u.prefix!=null){const v=u.prefix;y=filter(y,b=>b.toString().startsWith(v))}if(Array.isArray(u.filters)&&(y=u.filters.reduce((v,b)=>filter(v,b),y)),Array.isArray(u.orders)&&(y=u.orders.reduce((v,b)=>sort(v,b),y)),u.offset!=null){const v=u.offset;let b=0;y=filter(y,()=>b++>=v)}return u.limit!=null&&(y=take(y,u.limit)),y}}class MemoryDatastore extends BaseDatastore{data;constructor(){super(),this.data=new Map}put(u,h,y){return y?.signal?.throwIfAborted(),this.data.set(u.toString(),h),u}get(u,h){h?.signal?.throwIfAborted();const y=this.data.get(u.toString());if(y==null)throw new NotFoundError;return y}has(u,h){return h?.signal?.throwIfAborted(),this.data.has(u.toString())}delete(u,h){h?.signal?.throwIfAborted(),this.data.delete(u.toString())}*_all(u,h){h?.signal?.throwIfAborted();for(const[y,v]of this.data.entries())yield{key:new Key(y),value:v},h?.signal?.throwIfAborted()}*_allKeys(u,h){h?.signal?.throwIfAborted();for(const y of this.data.keys())yield new Key(y),h?.signal?.throwIfAborted()}}class TrackedMap extends Map{metric;constructor(u){super();const{name:h,metrics:y}=u;this.metric=y.registerMetric(h),this.updateComponentMetric()}set(u,h){return super.set(u,h),this.updateComponentMetric(),this}delete(u){const h=super.delete(u);return this.updateComponentMetric(),h}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function trackedMap(g){const{name:u,metrics:h}=g;let y;return h!=null?y=new TrackedMap({name:u,metrics:h}):y=new Map,y}const MAX_DATE=864e13,CODEC_TLS=448,CODEC_SNI=449,CODEC_DNS=53,CODEC_DNS4=54,CODEC_DNS6=55,CODEC_DNSADDR=56;class DNSMappings{log;mappings;constructor(u,h={}){this.log=u.logger.forComponent("libp2p:address-manager:dns-mappings"),this.mappings=trackedMap({name:"libp2p_address_manager_dns_mappings",metrics:u.metrics})}has(u){const h=this.findHost(u);for(const y of this.mappings.values())if(y.domain===h)return!0;return!1}add(u,h){h.forEach(y=>{this.log("add DNS mapping %s to %s",y,u);const v=isPrivateIp(y)===!0;this.mappings.set(y,{domain:u,verified:v,expires:v?MAX_DATE-Date.now():0,lastVerified:v?MAX_DATE-Date.now():void 0})})}remove(u){const h=this.findHost(u);let y=!1;for(const[v,b]of this.mappings.entries())b.domain===h&&(this.log("removing %s to %s DNS mapping %e",v,b.domain),this.mappings.delete(v),y=y||b.verified);return y}getAll(u){const h=[];for(let y=0;y<u.length;y++){const b=u[y].multiaddr.stringTuples(),w=b[0][1];if(w!=null)for(const[E,_]of this.mappings.entries()){if(w!==E)continue;this.maybeAddSNITuple(b,_.domain)&&(u.splice(y,1),y--,h.push({multiaddr:multiaddr(`/${b.map(A=>[protocols(A[0]).name,A[1]].join("/")).join("/")}`),verified:_.verified,type:"dns-mapping",expires:_.expires,lastVerified:_.lastVerified}))}}return h}maybeAddSNITuple(u,h){for(let y=0;y<u.length;y++)if(u[y][0]===CODEC_TLS&&u[y+1]?.[0]!==CODEC_SNI)return u.splice(y+1,0,[CODEC_SNI,h]),!0;return!1}confirm(u,h){const y=this.findHost(u);let v=!1;for(const[b,w]of this.mappings.entries())w.domain===y&&(this.log("marking %s to %s DNS mapping as verified",b,w.domain),v=w.verified,w.verified=!0,w.expires=Date.now()+h,w.lastVerified=Date.now());return v}unconfirm(u,h){const y=this.findHost(u);let v=!1;for(const[b,w]of this.mappings.entries())w.domain===y&&(this.log("removing verification of %s to %s DNS mapping",b,w.domain),v=v||w.verified,w.verified=!1,w.expires=Date.now()+h);return v}findHost(u){for(const h of u.stringTuples())if(h[0]===CODEC_SNI||h[0]===CODEC_DNS||h[0]===CODEC_DNS4||h[0]===CODEC_DNS6||h[0]===CODEC_DNSADDR)return h[1]}}const CODEC_IP4$1=4,CODEC_IP6$1=41,CODEC_TCP=6,CODEC_UDP=273;class IPMappings{log;mappings;constructor(u,h={}){this.log=u.logger.forComponent("libp2p:address-manager:ip-mappings"),this.mappings=trackedMap({name:"libp2p_address_manager_ip_mappings",metrics:u.metrics})}has(u){const h=u.stringTuples();for(const y of this.mappings.values())for(const v of y)if(v.externalIp===h[0][1])return!0;return!1}add(u,h,y,v=h,b="tcp"){const w=`${u}-${h}-${b}`,E=this.mappings.get(w)??[],_={internalIp:u,internalPort:h,externalIp:y,externalPort:v,externalFamily:isIPv4(y)?4:6,protocol:b,verified:!1,expires:0};E.push(_),this.mappings.set(w,E)}remove(u){const h=u.stringTuples(),y=h[0][1]??"",v=h[1][0]===CODEC_TCP?"tcp":"udp",b=parseInt(h[1][1]??"0");let w=!1;for(const[E,_]of this.mappings.entries()){for(let S=0;S<_.length;S++){const A=_[S];A.externalIp===y&&A.externalPort===b&&A.protocol===v&&(this.log("removing %s:%s to %s:%s %s IP mapping",A.externalIp,A.externalPort,y,b,v),w=w||A.verified,_.splice(S,1),S--)}_.length===0&&this.mappings.delete(E)}return w}getAll(u){const h=[];for(const{multiaddr:y}of u){const v=y.stringTuples();let b;if((v[0][0]===CODEC_IP4$1||v[0][0]===CODEC_IP6$1)&&v[1][0]===CODEC_TCP?b=`${v[0][1]}-${v[1][1]}-tcp`:(v[0][0]===CODEC_IP4$1||v[0][0]===CODEC_IP6$1)&&v[1][0]===CODEC_UDP&&(b=`${v[0][1]}-${v[1][1]}-udp`),b==null)continue;const w=this.mappings.get(b);if(w!=null)for(const E of w)v[0][0]=E.externalFamily===4?CODEC_IP4$1:CODEC_IP6$1,v[0][1]=E.externalIp,v[1][1]=`${E.externalPort}`,h.push({multiaddr:multiaddr(`/${v.map(_=>[protocols(_[0]).name,_[1]].join("/")).join("/")}`),verified:E.verified,type:"ip-mapping",expires:E.expires,lastVerified:E.lastVerified})}return h}confirm(u,h){const v=u.stringTuples()[0][1];let b=!1;for(const w of this.mappings.values())for(const E of w)E.externalIp===v&&(this.log("marking %s to %s IP mapping as verified",E.internalIp,E.externalIp),b=E.verified,E.verified=!0,E.expires=Date.now()+h,E.lastVerified=Date.now());return b}unconfirm(u,h){const y=u.stringTuples(),v=y[0][1]??"",b=y[1][0]===CODEC_TCP?"tcp":"udp",w=parseInt(y[1][1]??"0");let E=!1;for(const _ of this.mappings.values())for(let S=0;S<_.length;S++){const A=_[S];A.externalIp===v&&A.externalPort===w&&A.protocol===b&&(this.log("removing verification of %s:%s to %s:%s %s IP mapping",A.externalIp,A.externalPort,v,w,b),E=E||A.verified,A.verified=!1,A.expires=Date.now()+h)}return E}}function isLinkLocal(g){try{for(const{code:u,value:h}of g.getComponents())if(u!==CODE_IP6ZONE&&h!=null){if(u===CODE_IP4)return h.startsWith("169.254.");if(u===CODE_IP6)return h.toLowerCase().startsWith("fe80")}}catch{}return!1}const defaultValues$2={maxObservedAddresses:10};class ObservedAddresses{log;addresses;maxObservedAddresses;constructor(u,h={}){this.log=u.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=trackedMap({name:"libp2p_address_manager_observed_addresses",metrics:u.metrics}),this.maxObservedAddresses=h.maxObservedAddresses??defaultValues$2.maxObservedAddresses}has(u){return this.addresses.has(u.toString())}removePrefixed(u){for(const h of this.addresses.keys())h.toString().startsWith(u)&&this.addresses.delete(h)}add(u){this.addresses.size!==this.maxObservedAddresses&&(isPrivate(u)||isLinkLocal(u)||(this.log("adding observed address %a",u),this.addresses.set(u.toString(),{verified:!1,expires:0})))}getAll(){return Array.from(this.addresses).map(([u,h])=>({multiaddr:multiaddr(u),verified:h.verified,type:"observed",expires:h.expires,lastVerified:h.lastVerified}))}remove(u){const h=this.addresses.get(u.toString())?.verified??!1;return this.log("removing observed address %a",u),this.addresses.delete(u.toString()),h}confirm(u,h){const y=u.toString(),v=this.addresses.get(y)??{verified:!1,expires:Date.now()+h,lastVerified:Date.now()},b=v.verified;return v.verified=!0,v.expires=Date.now()+h,v.lastVerified=Date.now(),this.log("marking observed address %a as verified",y),this.addresses.set(y,v),b}}const NETWORK_CODECS=[CODE_IP4,CODE_IP6,CODE_DNS,CODE_DNS4,CODE_DNS6,CODE_DNSADDR];function isNetworkAddress(g){try{for(const{code:u}of g.getComponents())if(u!==CODE_IP6ZONE)return NETWORK_CODECS.includes(u)}catch{}return!1}const defaultValues$1={maxObservedAddresses:10};class TransportAddresses{log;addresses;maxObservedAddresses;constructor(u,h={}){this.log=u.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=trackedMap({name:"libp2p_address_manager_transport_addresses",metrics:u.metrics}),this.maxObservedAddresses=h.maxObservedAddresses??defaultValues$1.maxObservedAddresses}get(u,h){if(isPrivate(u))return{multiaddr:u,verified:!0,type:"transport",expires:Date.now()+h,lastVerified:Date.now()};const y=this.toKey(u);let v=this.addresses.get(y);return v==null&&(v={verified:!isNetworkAddress(u),expires:0},this.addresses.set(y,v)),{multiaddr:u,verified:v.verified,type:"transport",expires:v.expires,lastVerified:v.lastVerified}}has(u){const h=this.toKey(u);return this.addresses.has(h)}remove(u){const h=this.toKey(u),y=this.addresses.get(h)?.verified??!1;return this.log("removing observed address %a",u),this.addresses.delete(h),y}confirm(u,h){const y=this.toKey(u),v=this.addresses.get(y)??{verified:!1,expires:0,lastVerified:0},b=v.verified;return v.verified=!0,v.expires=Date.now()+h,v.lastVerified=Date.now(),this.addresses.set(y,v),b}unconfirm(u,h){const y=this.toKey(u),v=this.addresses.get(y)??{verified:!1,expires:0},b=v.verified;return v.verified=!1,v.expires=Date.now()+h,this.addresses.set(y,v),b}toKey(u){if(isNetworkAddress(u)){const h=u.toOptions();return`${h.host}-${h.port}-${h.transport}`}return u.toString()}}const ONE_MINUTE=6e4,defaultValues={addressVerificationTTL:ONE_MINUTE*10,addressVerificationRetry:ONE_MINUTE*5},defaultAddressFilter=g=>g;function stripPeerId(g,u){const h=g.getPeerId();return h!=null&&peerIdFromString$1(h).equals(u)&&(g=g.decapsulate(multiaddr(`/p2p/${u.toString()}`))),g}class AddressManager{log;components;listen;announce;appendAnnounce;announceFilter;observed;dnsMappings;ipMappings;transportAddresses;observedAddressFilter;addressVerificationTTL;addressVerificationRetry;constructor(u,h={}){const{listen:y=[],announce:v=[],appendAnnounce:b=[]}=h;this.components=u,this.log=u.logger.forComponent("libp2p:address-manager"),this.listen=y.map(w=>w.toString()),this.announce=new Set(v.map(w=>w.toString())),this.appendAnnounce=new Set(b.map(w=>w.toString())),this.observed=new ObservedAddresses(u,h),this.dnsMappings=new DNSMappings(u,h),this.ipMappings=new IPMappings(u,h),this.transportAddresses=new TransportAddresses(u,h),this.announceFilter=h.announceFilter??defaultAddressFilter,this.observedAddressFilter=createScalableCuckooFilter(1024),this.addressVerificationTTL=h.addressVerificationTTL??defaultValues.addressVerificationTTL,this.addressVerificationRetry=h.addressVerificationRetry??defaultValues.addressVerificationRetry,this._updatePeerStoreAddresses=debounce$1(this._updatePeerStoreAddresses.bind(this),1e3),u.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),u.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}[Symbol.toStringTag]="@libp2p/address-manager";_updatePeerStoreAddresses(){const u=this.getAddresses().map(h=>h.getPeerId()===this.components.peerId.toString()?h.decapsulate(`/p2p/${this.components.peerId.toString()}`):h);this.components.peerStore.patch(this.components.peerId,{multiaddrs:u}).catch(h=>{this.log.error("error updating addresses",h)})}getListenAddrs(){return Array.from(this.listen).map(u=>multiaddr(u))}getAnnounceAddrs(){return Array.from(this.announce).map(u=>multiaddr(u))}getAppendAnnounceAddrs(){return Array.from(this.appendAnnounce).map(u=>multiaddr(u))}getObservedAddrs(){return this.observed.getAll().map(u=>u.multiaddr)}addObservedAddr(u){const h=u.stringTuples(),y=`${h[0][1]}:${h[1][1]}`;this.observedAddressFilter.has(y)||(this.observedAddressFilter.add(y),u=stripPeerId(u,this.components.peerId),!this.ipMappings.has(u)&&(this.dnsMappings.has(u)||this.observed.add(u)))}confirmObservedAddr(u,h){u=stripPeerId(u,this.components.peerId);let y=!0;(h?.type==="transport"||this.transportAddresses.has(u))&&!this.transportAddresses.confirm(u,h?.ttl??this.addressVerificationTTL)&&y&&(y=!1),(h?.type==="dns-mapping"||this.dnsMappings.has(u))&&!this.dnsMappings.confirm(u,h?.ttl??this.addressVerificationTTL)&&y&&(y=!1),(h?.type==="ip-mapping"||this.ipMappings.has(u))&&!this.ipMappings.confirm(u,h?.ttl??this.addressVerificationTTL)&&y&&(y=!1),(h?.type==="observed"||this.observed.has(u))&&(this.maybeUpgradeToIPMapping(u)?(this.ipMappings.confirm(u,h?.ttl??this.addressVerificationTTL),y=!1):!this.observed.confirm(u,h?.ttl??this.addressVerificationTTL)&&y&&(y=!1)),y||this._updatePeerStoreAddresses()}removeObservedAddr(u,h){u=stripPeerId(u,this.components.peerId),this.observed.has(u)&&this.observed.remove(u),this.transportAddresses.has(u)&&this.transportAddresses.unconfirm(u,h?.ttl??this.addressVerificationRetry),this.dnsMappings.has(u)&&this.dnsMappings.unconfirm(u,h?.ttl??this.addressVerificationRetry),this.ipMappings.has(u)&&this.ipMappings.unconfirm(u,h?.ttl??this.addressVerificationRetry)}getAddresses(){const u=new Set,h=this.getAddressesWithMetadata().filter(y=>{if(!y.verified)return!1;const v=y.multiaddr.toString();return u.has(v)?!1:(u.add(v),!0)}).map(y=>y.multiaddr);return this.announceFilter(h.map(y=>{const v=multiaddr(y);return v.getComponents().pop()?.value===this.components.peerId.toString()?v:v.encapsulate(`/p2p/${this.components.peerId.toString()}`)}))}getAddressesWithMetadata(){const u=this.getAnnounceAddrs();if(u.length>0)return this.components.transportManager.getListeners().forEach(v=>{v.updateAnnounceAddrs(u)}),u.map(v=>({multiaddr:v,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()}));let h=[];h=h.concat(this.components.transportManager.getAddrs().map(v=>this.transportAddresses.get(v,this.addressVerificationTTL)));const y=this.getAppendAnnounceAddrs();return y.length>0&&(this.components.transportManager.getListeners().forEach(v=>{v.updateAnnounceAddrs(y)}),h=h.concat(y.map(v=>({multiaddr:v,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()})))),h=h.concat(this.observed.getAll()),h=h.concat(this.ipMappings.getAll(h)),h=h.concat(this.dnsMappings.getAll(h)),h}addDNSMapping(u,h){this.dnsMappings.add(u,h)}removeDNSMapping(u){this.dnsMappings.remove(multiaddr(`/dns/${u}`))&&this._updatePeerStoreAddresses()}addPublicAddressMapping(u,h,y,v=h,b="tcp"){this.ipMappings.add(u,h,y,v,b),this.observed.removePrefixed(`/ip${isIPv4(y)?4:6}/${y}/${b}/${v}`)}removePublicAddressMapping(u,h,y,v=h,b="tcp"){this.ipMappings.remove(multiaddr(`/ip${isIPv4(y)?4:6}/${y}/${b}/${v}`))&&this._updatePeerStoreAddresses()}maybeUpgradeToIPMapping(u){if(this.ipMappings.has(u))return!1;const h=u.toOptions();if(h.family===6||h.host==="127.0.0.1"||isPrivateIp(h.host)===!0)return!1;const y=this.components.transportManager.getListeners(),v=[b=>WebSockets$1.exactMatch(b)||WebSocketsSecure.exactMatch(b),b=>TCP.exactMatch(b),b=>QUIC_V1.exactMatch(b)];for(const b of v){if(!b(u))continue;const w=y.filter(S=>S.getAddrs().filter(A=>A.toOptions().family===4&&b(A)).length>0);if(w.length!==1)continue;const E=w[0].getAddrs().filter(S=>S.toOptions().host!=="127.0.0.1").pop();if(E==null)continue;const _=E.toOptions();return this.observed.remove(u),this.ipMappings.add(_.host,_.port,h.host,h.port,h.transport),!0}return!1}}var messages$1;(function(g){g.NOT_STARTED_YET="The libp2p node is not started yet",g.NOT_FOUND="Not found"})(messages$1||(messages$1={}));class MissingServiceError extends Error{constructor(u="Missing service"){super(u),this.name="MissingServiceError"}}class UnmetServiceDependenciesError extends Error{constructor(u="Unmet service dependencies"){super(u),this.name="UnmetServiceDependenciesError"}}class NoContentRoutersError extends Error{constructor(u="No content routers available"){super(u),this.name="NoContentRoutersError"}}class NoPeerRoutersError extends Error{constructor(u="No peer routers available"){super(u),this.name="NoPeerRoutersError"}}class QueriedForSelfError extends Error{constructor(u="Should not try to find self"){super(u),this.name="QueriedForSelfError"}}class UnhandledProtocolError extends Error{constructor(u="Unhandled protocol error"){super(u),this.name="UnhandledProtocolError"}}class DuplicateProtocolHandlerError extends Error{constructor(u="Duplicate protocol handler error"){super(u),this.name="DuplicateProtocolHandlerError"}}class DialDeniedError extends Error{constructor(u="Dial denied error"){super(u),this.name="DialDeniedError"}}class UnsupportedListenAddressError extends Error{constructor(u="No transport was configured to listen on this address"){super(u),this.name="UnsupportedListenAddressError"}}class UnsupportedListenAddressesError extends Error{constructor(u="Configured listen addresses could not be listened on"){super(u),this.name="UnsupportedListenAddressesError"}}class NoValidAddressesError extends Error{constructor(u="No valid addresses"){super(u),this.name="NoValidAddressesError"}}class ConnectionInterceptedError extends Error{constructor(u="Connection intercepted"){super(u),this.name="ConnectionInterceptedError"}}class ConnectionDeniedError extends Error{constructor(u="Connection denied"){super(u),this.name="ConnectionDeniedError"}}class MuxerUnavailableError extends Error{constructor(u="Stream is not multiplexed"){super(u),this.name="MuxerUnavailableError"}}class EncryptionFailedError extends Error{constructor(u="Encryption failed"){super(u),this.name="EncryptionFailedError"}}class TransportUnavailableError extends Error{constructor(u="Transport unavailable"){super(u),this.name="TransportUnavailableError"}}class RecursionLimitError extends Error{constructor(u="Max recursive depth reached"){super(u),this.name="RecursionLimitError"}}class DefaultComponents{components={};_started=!1;constructor(u={}){this.components={};for(const[h,y]of Object.entries(u))this.components[h]=y;this.components.logger==null&&(this.components.logger=defaultLogger())}isStarted(){return this._started}async _invokeStartableMethod(u){await Promise.all(Object.values(this.components).filter(h=>isStartable(h)).map(async h=>{await h[u]?.()}))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}const OPTIONAL_SERVICES=["metrics","connectionProtector","dns"],NON_SERVICE_PROPERTIES=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function defaultComponents(g={}){const u=new DefaultComponents(g);return new Proxy(u,{get(y,v,b){if(typeof v=="string"&&!NON_SERVICE_PROPERTIES.includes(v)){const w=u.components[v];if(w==null&&!OPTIONAL_SERVICES.includes(v))throw new MissingServiceError(`${v} not set`);return w}return Reflect.get(y,v,b)},set(y,v,b){return typeof v=="string"?u.components[v]=b:Reflect.set(y,v,b),!0}})}function checkServiceDependencies(g){const u={};for(const h of Object.values(g.components))for(const y of getServiceCapabilities(h))u[y]=!0;for(const h of Object.values(g.components))for(const y of getServiceDependencies(h))if(u[y]!==!0)throw new UnmetServiceDependenciesError(`Service "${getServiceName(h)}" required capability "${y}" but it was not provided by any component, you may need to add additional configuration when creating your node.`)}function getServiceCapabilities(g){return Array.isArray(g?.[serviceCapabilities])?g[serviceCapabilities]:[]}function getServiceDependencies(g){return Array.isArray(g?.[serviceDependencies])?g[serviceDependencies]:[]}function getServiceName(g){return g?.[Symbol.toStringTag]??g?.toString()??"unknown"}const CODEC_IP4=4,CODEC_IP6=41;function connectionGater(g={}){return{denyDialPeer:async()=>!1,denyDialMultiaddr:async u=>{if(WebSockets$1.matches(u))return!1;const h=u.stringTuples();return h[0][0]===CODEC_IP4||h[0][0]===CODEC_IP6?!!isPrivateIp(`${h[0][1]}`):!1},denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1,denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0,...g}}const createAbortError=()=>{const g=new Error("Delay aborted");return g.name="AbortError",g},clearMethods=new WeakMap;function createDelay({clearTimeout:g,setTimeout:u}={}){return(h,{value:y,signal:v}={})=>{if(v?.aborted)return Promise.reject(createAbortError());let b,w,E;const _=g??clearTimeout,S=()=>{_(b),E(createAbortError())},A=()=>{v&&v.removeEventListener("abort",S)},R=new Promise((x,T)=>{w=()=>{A(),x(y)},E=T,b=(u??setTimeout)(w,h)});return v&&v.addEventListener("abort",S,{once:!0}),clearMethods.set(R,()=>{_(b),b=null,w()}),R}}const delay=createDelay();class RateLimitError extends Error{remainingPoints;msBeforeNext;consumedPoints;isFirstInDuration;constructor(u="Rate limit exceeded",h){super(u),this.name="RateLimitError",this.remainingPoints=h.remainingPoints,this.msBeforeNext=h.msBeforeNext,this.consumedPoints=h.consumedPoints,this.isFirstInDuration=h.isFirstInDuration}}class QueueFullError extends Error{static name="QueueFullError";constructor(u="The queue was full"){super(u),this.name="QueueFullError"}}class RateLimiter{memoryStorage;points;duration;blockDuration;execEvenly;execEvenlyMinDelayMs;keyPrefix;constructor(u={}){this.points=u.points??4,this.duration=u.duration??1,this.blockDuration=u.blockDuration??0,this.execEvenly=u.execEvenly??!1,this.execEvenlyMinDelayMs=u.execEvenlyMinDelayMs??this.duration*1e3/this.points,this.keyPrefix=u.keyPrefix??"rlflx",this.memoryStorage=new MemoryStorage}async consume(u,h=1,y={}){const v=this.getKey(u),b=this._getKeySecDuration(y);let w=this.memoryStorage.incrby(v,h,b);if(w.remainingPoints=Math.max(this.points-w.consumedPoints,0),w.consumedPoints>this.points)throw this.blockDuration>0&&w.consumedPoints<=this.points+h&&(w=this.memoryStorage.set(v,w.consumedPoints,this.blockDuration)),new RateLimitError("Rate limit exceeded",w);if(this.execEvenly&&w.msBeforeNext>0&&!w.isFirstInDuration){let E=Math.ceil(w.msBeforeNext/(w.remainingPoints+2));E<this.execEvenlyMinDelayMs&&(E=w.consumedPoints*this.execEvenlyMinDelayMs),await delay(E)}return w}penalty(u,h=1,y={}){const v=this.getKey(u),b=this._getKeySecDuration(y),w=this.memoryStorage.incrby(v,h,b);return w.remainingPoints=Math.max(this.points-w.consumedPoints,0),w}reward(u,h=1,y={}){const v=this.getKey(u),b=this._getKeySecDuration(y),w=this.memoryStorage.incrby(v,-h,b);return w.remainingPoints=Math.max(this.points-w.consumedPoints,0),w}block(u,h){const y=h*1e3,v=this.points+1;return this.memoryStorage.set(this.getKey(u),v,h),{remainingPoints:0,msBeforeNext:y===0?-1:y,consumedPoints:v,isFirstInDuration:!1}}set(u,h,y=0){const v=(y>=0?y:this.duration)*1e3;return this.memoryStorage.set(this.getKey(u),h,y),{remainingPoints:0,msBeforeNext:v===0?-1:v,consumedPoints:h,isFirstInDuration:!1}}get(u){const h=this.memoryStorage.get(this.getKey(u));return h!=null&&(h.remainingPoints=Math.max(this.points-h.consumedPoints,0)),h}delete(u){this.memoryStorage.delete(this.getKey(u))}_getKeySecDuration(u){return u?.customDuration!=null&&u.customDuration>=0?u.customDuration:this.duration}getKey(u){return this.keyPrefix.length>0?`${this.keyPrefix}:${u}`:u}parseKey(u){return u.substring(this.keyPrefix.length)}}class MemoryStorage{storage;constructor(){this.storage=new Map}incrby(u,h,y){const v=this.storage.get(u);if(v!=null){const b=v.expiresAt!=null?v.expiresAt.getTime()-new Date().getTime():-1;return v.expiresAt==null||b>0?(v.value+=h,{remainingPoints:0,msBeforeNext:b,consumedPoints:v.value,isFirstInDuration:!1}):this.set(u,h,y)}return this.set(u,h,y)}set(u,h,y){const v=y*1e3,b=this.storage.get(u);b!=null&&clearTimeout(b.timeoutId);const w={value:h,expiresAt:v>0?new Date(Date.now()+v):void 0};return this.storage.set(u,w),v>0&&(w.timeoutId=setTimeout(()=>{this.storage.delete(u)},v),w.timeoutId.unref!=null&&w.timeoutId.unref()),{remainingPoints:0,msBeforeNext:v===0?-1:v,consumedPoints:w.value,isFirstInDuration:!0}}get(u){const h=this.storage.get(u);if(h!=null)return{remainingPoints:0,msBeforeNext:h.expiresAt!=null?h.expiresAt.getTime()-new Date().getTime():-1,consumedPoints:h.value,isFirstInDuration:!1}}delete(u){const h=this.storage.get(u);return h!=null?(h.timeoutId!=null&&clearTimeout(h.timeoutId),this.storage.delete(u),!0):!1}}function getPeerAddress(g){if(isPeerId(g))return{peerId:g,multiaddrs:[]};let u=Array.isArray(g)?g:[g],h;if(u.length>0){const y=u[0].getPeerId();h=y==null?void 0:peerIdFromString$1(y),u.forEach(v=>{if(!isMultiaddr(v))throw new InvalidMultiaddrError$1("Invalid multiaddr");const b=v.getPeerId();if(b==null){if(h!=null)throw new InvalidParametersError$1("Multiaddrs must all have the same peer id or have no peer id")}else{const w=peerIdFromString$1(b);if(h?.equals(w)!==!0)throw new InvalidParametersError$1("Multiaddrs must all have the same peer id or have no peer id")}})}return u=u.filter(y=>!PEER_ID.exactMatch(y)),{peerId:h,multiaddrs:u}}const DEFAULT_CLOSABLE_PROTOCOLS=["/ipfs/id/1.0.0","/ipfs/id/push/1.0.0","/libp2p/autonat/1.0.0","/libp2p/dcutr"];async function safelyCloseConnectionIfUnused(g,u){const h=g?.streams?.map(v=>v.protocol)??[],y=u?.closableProtocols??DEFAULT_CLOSABLE_PROTOCOLS;if(!(h.filter(v=>v!=null&&!y.includes(v)).length>0))try{await g?.close(u)}catch(v){g?.abort(v)}}function multiaddrToIpNet(g){try{let u;typeof g=="string"?u=multiaddr(g):u=g;const h=new Set([...u.getComponents().map(y=>y.name)]);if(!h.has("ipcidr")){const v=h.has("ip6")?"/ipcidr/128":"/ipcidr/32";u=u.encapsulate(v)}return convertToIpNet(u)}catch{throw new Error(`Can't convert to IpNet, Invalid multiaddr format: ${g}`)}}class ConnectionPruner{connectionManager;peerStore;allow;events;log;constructor(u,h={}){this.allow=(h.allow??[]).map(y=>multiaddrToIpNet(y)),this.connectionManager=u.connectionManager,this.peerStore=u.peerStore,this.events=u.events,this.log=u.logger.forComponent("libp2p:connection-manager:connection-pruner"),this.maybePruneConnections=this.maybePruneConnections.bind(this)}start(){this.events.addEventListener("connection:open",this.maybePruneConnections)}stop(){this.events.removeEventListener("connection:open",this.maybePruneConnections)}maybePruneConnections(){this._maybePruneConnections().catch(u=>{this.log.error("error while pruning connections %e",u)})}async _maybePruneConnections(){const u=this.connectionManager.getConnections(),h=u.length,y=this.connectionManager.getMaxConnections();if(this.log("checking max connections limit %d/%d",h,y),h<=y)return;const v=new PeerMap;for(const _ of u){const S=_.remotePeer;if(!v.has(S)){v.set(S,0);try{const A=await this.peerStore.get(S);v.set(S,[...A.tags.values()].reduce((R,x)=>R+x.value,0))}catch(A){A.name!=="NotFoundError"&&this.log.error("error loading peer tags",A)}}}const b=this.sortConnections(u,v),w=Math.max(h-y,0),E=[];for(const _ of b)if(this.log("too many connections open - closing a connection to %p",_.remotePeer),this.allow.some(A=>A.contains(_.remoteAddr.nodeAddress().address))||E.push(_),E.length===w)break;await Promise.all(E.map(async _=>{await safelyCloseConnectionIfUnused(_,{signal:AbortSignal.timeout(1e3)})})),this.events.safeDispatchEvent("connection:prune",{detail:E})}sortConnections(u,h){return u.sort((y,v)=>{const b=y.timeline.open,w=v.timeline.open;return b<w?1:b>w?-1:0}).sort((y,v)=>y.direction==="outbound"&&v.direction==="inbound"?1:y.direction==="inbound"&&v.direction==="outbound"?-1:0).sort((y,v)=>y.streams.length>v.streams.length?1:y.streams.length<v.streams.length?-1:0).sort((y,v)=>{const b=h.get(y.remotePeer)??0,w=h.get(v.remotePeer)??0;return b>w?1:b<w?-1:0})}}const DIAL_TIMEOUT=1e4,INBOUND_UPGRADE_TIMEOUT=1e4,PROTOCOL_NEGOTIATION_TIMEOUT=1e4,MAX_PEER_ADDRS_TO_DIAL=25,INBOUND_CONNECTION_THRESHOLD=5,MAX_INCOMING_PENDING_CONNECTIONS=10,MAX_PARALLEL_RECONNECTS=5,LAST_DIAL_FAILURE_KEY="last-dial-failure",LAST_DIAL_SUCCESS_KEY="last-dial-success",MAX_DIAL_QUEUE_LENGTH=500,MAX_RECURSIVE_DEPTH=32,MAX_CONNECTIONS$1=100,MAX_PARALLEL_DIALS=50;class JobRecipient{deferred;signal;constructor(u){this.signal=u,this.deferred=pDefer(),this.onAbort=this.onAbort.bind(this),this.signal?.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(this.signal?.reason??new AbortError$6)}cleanup(){this.signal?.removeEventListener("abort",this.onAbort)}}function randomId(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}class Job{id;fn;options;recipients;status;timeline;controller;constructor(u,h){this.id=randomId(),this.status="queued",this.fn=u,this.options=h,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(u){this.controller.abort(u)}onAbort(){this.recipients.reduce((h,y)=>h&&y.signal?.aborted===!0,!0)&&(this.controller.abort(new AbortError$6),this.cleanup())}async join(u={}){const h=new JobRecipient(u.signal);return this.recipients.push(h),u.signal?.addEventListener("abort",this.onAbort),h.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const u=await raceSignal$1(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(h=>{h.deferred.resolve(u)}),this.status="complete"}catch(u){this.recipients.forEach(h=>{h.deferred.reject(u)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(u=>{u.cleanup(),u.signal?.removeEventListener("abort",this.onAbort)})}}class Queue extends TypedEventEmitter{concurrency;maxSize;queue;pending;sort;constructor(u={}){super(),this.concurrency=u.concurrency??Number.POSITIVE_INFINITY,this.maxSize=u.maxSize??Number.POSITIVE_INFINITY,this.pending=0,u.metricName!=null&&u.metrics?.registerMetricGroup(u.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})}),this.sort=u.sort,this.queue=[],this.emitEmpty=debounce$1(this.emitEmpty.bind(this),1),this.emitIdle=debounce$1(this.emitIdle.bind(this),1)}emitEmpty(){this.size===0&&this.safeDispatchEvent("empty")}emitIdle(){this.running===0&&this.safeDispatchEvent("idle")}tryToStartAnother(){if(this.size===0)return this.emitEmpty(),this.running===0&&this.emitIdle(),!1;if(this.pending<this.concurrency){let u;for(const h of this.queue)if(h.status==="queued"){u=h;break}return u==null?!1:(this.safeDispatchEvent("active"),this.pending++,u.run().finally(()=>{for(let h=0;h<this.queue.length;h++)if(this.queue[h]===u){this.queue.splice(h,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(u){this.queue.push(u),this.sort!=null&&this.queue.sort(this.sort)}async add(u,h){if(h?.signal?.throwIfAborted(),this.size===this.maxSize)throw new QueueFullError;const y=new Job(u,h);return this.enqueue(y),this.safeDispatchEvent("add"),this.tryToStartAnother(),y.join(h).then(v=>(this.safeDispatchEvent("completed",{detail:v}),this.safeDispatchEvent("success",{detail:{job:y,result:v}}),v)).catch(v=>{if(y.status==="queued"){for(let b=0;b<this.queue.length;b++)if(this.queue[b]===y){this.queue.splice(b,1);break}}throw this.safeDispatchEvent("failure",{detail:{job:y,error:v}}),v})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(u=>{u.abort(new AbortError$6)}),this.clear()}async onEmpty(u){this.size!==0&&await raceEvent(this,"empty",u?.signal)}async onSizeLessThan(u,h){this.size<u||await raceEvent(this,"next",h?.signal,{filter:()=>this.size<u})}async onIdle(u){this.pending===0&&this.size===0||await raceEvent(this,"idle",u?.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(u){u?.signal?.throwIfAborted();const h=pushable({objectMode:!0}),y=_=>{_!=null?this.abort():this.clear(),h.end(_)},v=_=>{_.detail!=null&&h.push(_.detail)},b=_=>{y(_.detail.error)},w=()=>{y()},E=()=>{y(new AbortError$6("Queue aborted"))};this.addEventListener("completed",v),this.addEventListener("failure",b),this.addEventListener("idle",w),u?.signal?.addEventListener("abort",E);try{yield*h}finally{this.removeEventListener("completed",v),this.removeEventListener("failure",b),this.removeEventListener("idle",w),u?.signal?.removeEventListener("abort",E),y()}}}class PriorityQueue extends Queue{constructor(u={}){super({...u,sort:(h,y)=>h.options.priority>y.options.priority?-1:h.options.priority<y.options.priority?1:0})}}function anySignal(g){const u=new globalThis.AbortController;function h(){u.abort();for(const b of g)b?.removeEventListener!=null&&b.removeEventListener("abort",h)}for(const b of g){if(b?.aborted===!0){h();break}b?.addEventListener!=null&&b.addEventListener("abort",h)}function y(){for(const b of g)b?.removeEventListener!=null&&b.removeEventListener("abort",h)}const v=u.signal;return v.clear=y,v}function isLoopbackAddr(g){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(g)||/^::1$/.test(g)}function isLoopback(g){if(!isIpBased(g))return!1;const{address:u}=g.nodeAddress();return isLoopbackAddr(u)}function reliableTransportsFirst(g,u){const h=TCP.exactMatch(g.multiaddr),y=TCP.exactMatch(u.multiaddr);if(h&&!y)return-1;if(!h&&y)return 1;const v=WebSocketsSecure.exactMatch(g.multiaddr),b=WebSocketsSecure.exactMatch(u.multiaddr);if(v&&!b)return-1;if(!v&&b)return 1;const w=WebSockets$1.exactMatch(g.multiaddr),E=WebSockets$1.exactMatch(u.multiaddr);if(w&&!E)return-1;if(!w&&E)return 1;const _=WebRTC.exactMatch(g.multiaddr),S=WebRTC.exactMatch(u.multiaddr);if(_&&!S)return-1;if(!_&&S)return 1;const A=WebRTCDirect.exactMatch(g.multiaddr),R=WebRTCDirect.exactMatch(u.multiaddr);if(A&&!R)return-1;if(!A&&R)return 1;const x=WebTransport$1.exactMatch(g.multiaddr),T=WebTransport$1.exactMatch(u.multiaddr);return x&&!T?-1:!x&&T?1:0}function loopbackAddressLast(g,u){const h=isLoopback(g.multiaddr),y=isLoopback(u.multiaddr);return h&&!y?1:!h&&y?-1:0}function publicAddressesFirst(g,u){const h=isPrivate(g.multiaddr),y=isPrivate(u.multiaddr);return h&&!y?1:!h&&y?-1:0}function certifiedAddressesFirst(g,u){return g.isCertified&&!u.isCertified?-1:!g.isCertified&&u.isCertified?1:0}function circuitRelayAddressesLast(g,u){const h=Circuit$1.exactMatch(g.multiaddr),y=Circuit$1.exactMatch(u.multiaddr);return h&&!y?1:!h&&y?-1:0}function defaultAddressSorter(g){return g.sort(reliableTransportsFirst).sort(certifiedAddressesFirst).sort(circuitRelayAddressesLast).sort(publicAddressesFirst).sort(loopbackAddressLast)}async function resolveMultiaddr(g,u,h){const y=h.depth??0;if(y>(h.maxRecursiveDepth??MAX_RECURSIVE_DEPTH))throw new RecursionLimitError("Max recursive depth reached");let v=!1;const b=[];for(const w of Object.values(u))if(w.canResolve(g)){v=!0;const E=await w.resolve(g,h);for(const _ of E)b.push(...await resolveMultiaddr(_,u,{...h,depth:y+1}))}return v===!1&&b.push(g),b}const defaultOptions$1={maxParallelDials:MAX_PARALLEL_DIALS,maxDialQueueLength:MAX_DIAL_QUEUE_LENGTH,maxPeerAddrsToDial:MAX_PEER_ADDRS_TO_DIAL,dialTimeout:DIAL_TIMEOUT,resolvers:{dnsaddr:dnsaddrResolver}};class DialQueue{queue;components;addressSorter;maxPeerAddrsToDial;maxDialQueueLength;dialTimeout;shutDownController;connections;log;resolvers;constructor(u,h={}){this.addressSorter=h.addressSorter,this.maxPeerAddrsToDial=h.maxPeerAddrsToDial??defaultOptions$1.maxPeerAddrsToDial,this.maxDialQueueLength=h.maxDialQueueLength??defaultOptions$1.maxDialQueueLength,this.dialTimeout=h.dialTimeout??defaultOptions$1.dialTimeout,this.connections=h.connections??new PeerMap,this.log=u.logger.forComponent("libp2p:connection-manager:dial-queue"),this.components=u,this.resolvers=h.resolvers??defaultOptions$1.resolvers,this.shutDownController=new AbortController,this.shutDownController.signal,this.queue=new PriorityQueue({concurrency:h.maxParallelDials??defaultOptions$1.maxParallelDials,metricName:"libp2p_dial_queue",metrics:u.metrics}),this.queue.addEventListener("failure",y=>{y.detail?.error.name!==AbortError$6.name&&this.log.error("error in dial queue - %e",y.detail)})}start(){this.shutDownController=new AbortController,this.shutDownController.signal}stop(){this.shutDownController.abort(),this.queue.abort()}async dial(u,h={}){const{peerId:y,multiaddrs:v}=getPeerAddress(u),b=Array.from(this.connections.values()).flat().find(E=>h.force===!0||E.limits!=null?!1:E.remotePeer.equals(y)?!0:v.find(_=>_.equals(E.remoteAddr)));if(b?.status==="open")return this.log("already connected to %a",b.remoteAddr),h.onProgress?.(new CustomProgressEvent("dial-queue:already-connected")),b;const w=this.queue.queue.find(E=>{if(y?.equals(E.options.peerId)===!0)return!0;const _=E.options.multiaddrs;if(_==null)return!1;for(const S of v)if(_.has(S.toString()))return!0;return!1});if(w!=null){this.log("joining existing dial target for %p",y);for(const E of v)w.options.multiaddrs.add(E.toString());return h.onProgress?.(new CustomProgressEvent("dial-queue:already-in-dial-queue")),w.join(h)}if(this.queue.size>=this.maxDialQueueLength)throw new DialError("Dial queue is full");return this.log("creating dial target for %p",y,v.map(E=>E.toString())),h.onProgress?.(new CustomProgressEvent("dial-queue:add-to-dial-queue")),this.queue.add(async E=>{E.onProgress?.(new CustomProgressEvent("dial-queue:start-dial"));const _=anySignal([this.shutDownController.signal,E.signal]);try{return await this.dialPeer(E,_)}finally{_.clear()}},{peerId:y,priority:h.priority??DEFAULT_DIAL_PRIORITY,multiaddrs:new Set(v.map(E=>E.toString())),signal:h.signal??AbortSignal.timeout(this.dialTimeout),onProgress:h.onProgress})}async dialPeer(u,h){const y=u.peerId,v=u.multiaddrs,b=new Set;let w=u.multiaddrs.size===0,E=0,_=0;const S=[];for(this.log("starting dial to %p",y);w||v.size>0;){_++,w=!1;const A=[],R=new Set(u.multiaddrs);v.clear(),this.log("calculating addrs to dial %p from %s",y,[...R]);const x=await this.calculateMultiaddrs(y,R,{...u,signal:h});for(const T of x){if(b.has(T.multiaddr.toString())){this.log.trace("skipping previously failed multiaddr %a while dialing %p",T.multiaddr,y);continue}A.push(T)}this.log("%s dial to %p with %s",_===1?"starting":"continuing",y,A.map(T=>T.multiaddr.toString())),u?.onProgress?.(new CustomProgressEvent("dial-queue:calculated-addresses",A));for(const T of A){if(E===this.maxPeerAddrsToDial)throw this.log("dialed maxPeerAddrsToDial (%d) addresses for %p, not trying any others",E,u.peerId),new DialError("Peer had more than maxPeerAddrsToDial");E++;try{const C=await this.components.transportManager.dial(T.multiaddr,{...u,signal:h});this.log("dial to %a succeeded",T.multiaddr);try{await this.components.peerStore.merge(C.remotePeer,{multiaddrs:[C.remoteAddr],metadata:{[LAST_DIAL_SUCCESS_KEY]:fromString(Date.now().toString())}})}catch(I){this.log.error("could not update last dial failure key for %p",y,I)}return C}catch(C){if(this.log.error("dial failed to %a",T.multiaddr,C),b.add(T.multiaddr.toString()),y!=null)try{await this.components.peerStore.merge(y,{metadata:{[LAST_DIAL_FAILURE_KEY]:fromString(Date.now().toString())}})}catch(I){this.log.error("could not update last dial failure key for %p",y,I)}if(h.aborted)throw new TimeoutError$1(C.message);S.push(C)}}}throw S.length===1?S[0]:new AggregateError(S,"All multiaddr dials failed")}async calculateMultiaddrs(u,h=new Set,y={}){const v=[...h].map(R=>({multiaddr:multiaddr(R),isCertified:!1}));if(u!=null){if(this.components.peerId.equals(u))throw new DialError("Tried to dial self");if(await this.components.connectionGater.denyDialPeer?.(u)===!0)throw new DialDeniedError("The dial request is blocked by gater.allowDialPeer");if(v.length===0){this.log("loading multiaddrs for %p",u);try{const R=await this.components.peerStore.get(u);v.push(...R.addresses),this.log("loaded multiaddrs for %p",u,v.map(({multiaddr:x})=>x.toString()))}catch(R){if(R.name!=="NotFoundError")throw R}}if(v.length===0){this.log("looking up multiaddrs for %p in the peer routing",u);try{const R=await this.components.peerRouting.findPeer(u,y);this.log("found multiaddrs for %p in the peer routing",u,v.map(({multiaddr:x})=>x.toString())),v.push(...R.multiaddrs.map(x=>({multiaddr:x,isCertified:!1})))}catch(R){R.name==="NoPeerRoutersError"?this.log("no peer routers configured",u):this.log.error("looking up multiaddrs for %p in the peer routing failed - %e",u,R)}}}let b=(await Promise.all(v.map(async R=>{const x=await resolveMultiaddr(R.multiaddr,this.resolvers,{dns:this.components.dns,log:this.log,...y});return x.length===1&&x[0].equals(R.multiaddr)?R:x.map(T=>({multiaddr:T,isCertified:!1}))}))).flat();if(u!=null){const R=`/p2p/${u.toString()}`;b=b.map(x=>x.multiaddr.getComponents().pop()?.name!=="p2p"?{multiaddr:x.multiaddr.encapsulate(R),isCertified:x.isCertified}:x)}const w=b.filter(R=>{if(this.components.transportManager.dialTransportForMultiaddr(R.multiaddr)==null)return!1;const x=R.multiaddr.getPeerId();return u!=null&&x!=null?u.equals(x):!0}),E=new Map;for(const R of w){const x=R.multiaddr.toString(),T=E.get(x);if(T!=null){T.isCertified=T.isCertified||R.isCertified||!1;continue}E.set(x,R)}const _=[...E.values()];if(_.length===0)throw new NoValidAddressesError("The dial request has no valid addresses");const S=[];for(const R of _)this.components.connectionGater.denyDialMultiaddr!=null&&await this.components.connectionGater.denyDialMultiaddr(R.multiaddr)||S.push(R);const A=this.addressSorter==null?defaultAddressSorter(S):S.sort(this.addressSorter);if(A.length===0)throw new DialDeniedError("The connection gater denied all addresses in the dial request");return this.log.trace("addresses for %p before filtering",u??"unknown peer",b.map(({multiaddr:R})=>R.toString())),this.log.trace("addresses for %p after filtering",u??"unknown peer",A.map(({multiaddr:R})=>R.toString())),A}async isDialable(u,h={}){Array.isArray(u)||(u=[u]);try{const y=await this.calculateMultiaddrs(void 0,new Set(u.map(v=>v.toString())),h);return h.runOnLimitedConnection===!1?y.find(v=>!Circuit$1.matches(v.multiaddr))!=null:!0}catch(y){this.log.trace("error calculating if multiaddr(s) were dialable",y)}return!1}}class PeerQueue extends Queue{has(u){return this.find(u)!=null}find(u){return this.queue.find(h=>u.equals(h.options.peerId))}}var retry$2={},retry_operation,hasRequiredRetry_operation;function requireRetry_operation(){if(hasRequiredRetry_operation)return retry_operation;hasRequiredRetry_operation=1;function g(u,h){typeof h=="boolean"&&(h={forever:h}),this._originalTimeouts=JSON.parse(JSON.stringify(u)),this._timeouts=u,this._options=h||{},this._maxRetryTime=h&&h.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return retry_operation=g,g.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},g.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},g.prototype.retry=function(u){if(this._timeout&&clearTimeout(this._timeout),!u)return!1;var h=new Date().getTime();if(u&&h-this._operationStart>=this._maxRetryTime)return this._errors.push(u),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(u);var y=this._timeouts.shift();if(y===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),y=this._cachedTimeouts.slice(-1);else return!1;var v=this;return this._timer=setTimeout(function(){v._attempts++,v._operationTimeoutCb&&(v._timeout=setTimeout(function(){v._operationTimeoutCb(v._attempts)},v._operationTimeout),v._options.unref&&v._timeout.unref()),v._fn(v._attempts)},y),this._options.unref&&this._timer.unref(),!0},g.prototype.attempt=function(u,h){this._fn=u,h&&(h.timeout&&(this._operationTimeout=h.timeout),h.cb&&(this._operationTimeoutCb=h.cb));var y=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){y._operationTimeoutCb()},y._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},g.prototype.try=function(u){console.log("Using RetryOperation.try() is deprecated"),this.attempt(u)},g.prototype.start=function(u){console.log("Using RetryOperation.start() is deprecated"),this.attempt(u)},g.prototype.start=g.prototype.try,g.prototype.errors=function(){return this._errors},g.prototype.attempts=function(){return this._attempts},g.prototype.mainError=function(){if(this._errors.length===0)return null;for(var u={},h=null,y=0,v=0;v<this._errors.length;v++){var b=this._errors[v],w=b.message,E=(u[w]||0)+1;u[w]=E,E>=y&&(h=b,y=E)}return h},retry_operation}var hasRequiredRetry$1;function requireRetry$1(){return hasRequiredRetry$1||(hasRequiredRetry$1=1,(function(g){var u=requireRetry_operation();g.operation=function(h){var y=g.timeouts(h);return new u(y,{forever:h&&(h.forever||h.retries===1/0),unref:h&&h.unref,maxRetryTime:h&&h.maxRetryTime})},g.timeouts=function(h){if(h instanceof Array)return[].concat(h);var y={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var v in h)y[v]=h[v];if(y.minTimeout>y.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var b=[],w=0;w<y.retries;w++)b.push(this.createTimeout(w,y));return h&&h.forever&&!b.length&&b.push(this.createTimeout(w,y)),b.sort(function(E,_){return E-_}),b},g.createTimeout=function(h,y){var v=y.randomize?Math.random()+1:1,b=Math.round(v*Math.max(y.minTimeout,1)*Math.pow(y.factor,h));return b=Math.min(b,y.maxTimeout),b},g.wrap=function(h,y,v){if(y instanceof Array&&(v=y,y=null),!v){v=[];for(var b in h)typeof h[b]=="function"&&v.push(b)}for(var w=0;w<v.length;w++){var E=v[w],_=h[E];h[E]=(function(A){var R=g.operation(y),x=Array.prototype.slice.call(arguments,1),T=x.pop();x.push(function(C){R.retry(C)||(C&&(arguments[0]=R.mainError()),T.apply(this,arguments))}),R.attempt(function(){A.apply(h,x)})}).bind(h,_),h[E].options=y}}})(retry$2)),retry$2}var retry$1,hasRequiredRetry;function requireRetry(){return hasRequiredRetry||(hasRequiredRetry=1,retry$1=requireRetry$1()),retry$1}var retryExports=requireRetry();const retry=getDefaultExportFromCjs(retryExports),objectToString=Object.prototype.toString,isError=g=>objectToString.call(g)==="[object Error]",errorMessages=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred."]);function isNetworkError(g){if(!(g&&isError(g)&&g.name==="TypeError"&&typeof g.message=="string"))return!1;const{message:h,stack:y}=g;return h==="Load failed"?y===void 0||"__sentry_captured__"in g:h.startsWith("error sending request for url")?!0:errorMessages.has(h)}let AbortError$1=class extends Error{constructor(u){super(),u instanceof Error?(this.originalError=u,{message:u}=u):(this.originalError=new Error(u),this.originalError.stack=this.stack),this.name="AbortError",this.message=u}};const decorateErrorWithCounts=(g,u,h)=>{const y=h.retries-(u-1);return g.attemptNumber=u,g.retriesLeft=y,g};async function pRetry(g,u){return new Promise((h,y)=>{u={...u},u.onFailedAttempt??=()=>{},u.shouldRetry??=()=>!0,u.retries??=10;const v=retry.operation(u),b=()=>{v.stop(),y(u.signal?.reason)};u.signal&&!u.signal.aborted&&u.signal.addEventListener("abort",b,{once:!0});const w=()=>{u.signal?.removeEventListener("abort",b),v.stop()};v.attempt(async E=>{try{const _=await g(E);w(),h(_)}catch(_){try{if(!(_ instanceof Error))throw new TypeError(`Non-error was thrown: "${_}". You should only throw errors.`);if(_ instanceof AbortError$1)throw _.originalError;if(_ instanceof TypeError&&!isNetworkError(_))throw _;if(decorateErrorWithCounts(_,E,u),await u.shouldRetry(_)||(v.stop(),y(_)),await u.onFailedAttempt(_),!v.retry(_))throw v.mainError()}catch(S){decorateErrorWithCounts(S,E,u),w(),y(S)}}})})}class ReconnectQueue{log;queue;started;peerStore;retries;retryInterval;backoffFactor;connectionManager;events;constructor(u,h={}){this.log=u.logger.forComponent("libp2p:reconnect-queue"),this.peerStore=u.peerStore,this.connectionManager=u.connectionManager,this.queue=new PeerQueue({concurrency:h.maxParallelReconnects??MAX_PARALLEL_RECONNECTS,metricName:"libp2p_reconnect_queue",metrics:u.metrics}),this.started=!1,this.retries=h.retries??5,this.backoffFactor=h.backoffFactor,this.retryInterval=h.retryInterval,this.events=u.events,u.events.addEventListener("peer:disconnect",y=>{this.maybeReconnect(y.detail).catch(v=>{this.log.error("failed to maybe reconnect to %p - %e",y.detail,v)})})}async maybeReconnect(u){if(!this.started)return;const h=await this.peerStore.get(u);hasKeepAliveTag(h)&&(this.queue.has(u)||this.queue.add(async y=>{await pRetry(async v=>{if(this.started)try{await this.connectionManager.openConnection(u,{signal:y?.signal})}catch(b){throw this.log("reconnecting to %p attempt %d of %d failed - %e",u,v,this.retries,b),b}},{signal:y?.signal,retries:this.retries,factor:this.backoffFactor,minTimeout:this.retryInterval})},{peerId:u}).catch(async y=>{this.log.error("failed to reconnect to %p - %e",u,y);const v={};[...h.tags.keys()].forEach(b=>{b.startsWith(KEEP_ALIVE)&&(v[b]=void 0)}),await this.peerStore.merge(u,{tags:v}),this.events.safeDispatchEvent("peer:reconnect-failure",{detail:u})}).catch(async y=>{this.log.error("failed to remove keep-alive tag from %p - %e",u,y)}))}start(){this.started=!0}async afterStart(){Promise.resolve().then(async()=>{const u=await this.peerStore.all({filters:[h=>hasKeepAliveTag(h)]});await Promise.all(u.map(async h=>{await this.connectionManager.openConnection(h.id).catch(y=>{this.log.error(y)})}))}).catch(u=>{this.log.error(u)})}stop(){this.started=!1,this.queue.abort()}}function hasKeepAliveTag(g){for(const u of g.tags.keys())if(u.startsWith(KEEP_ALIVE))return!0;return!1}const DEFAULT_DIAL_PRIORITY=50,defaultOptions={maxConnections:MAX_CONNECTIONS$1,inboundConnectionThreshold:INBOUND_CONNECTION_THRESHOLD,maxIncomingPendingConnections:MAX_INCOMING_PENDING_CONNECTIONS};class DefaultConnectionManager{started;connections;allow;deny;maxIncomingPendingConnections;incomingPendingConnections;outboundPendingConnections;maxConnections;dialQueue;reconnectQueue;connectionPruner;inboundConnectionRateLimiter;peerStore;metrics;events;log;peerId;constructor(u,h={}){if(this.maxConnections=h.maxConnections??defaultOptions.maxConnections,this.maxConnections<1)throw new InvalidParametersError$1("Connection Manager maxConnections must be greater than 0");this.connections=new PeerMap,this.started=!1,this.peerId=u.peerId,this.peerStore=u.peerStore,this.metrics=u.metrics,this.events=u.events,this.log=u.logger.forComponent("libp2p:connection-manager"),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.allow=(h.allow??[]).map(y=>multiaddrToIpNet(y)),this.deny=(h.deny??[]).map(y=>multiaddrToIpNet(y)),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=h.maxIncomingPendingConnections??defaultOptions.maxIncomingPendingConnections,this.outboundPendingConnections=0,this.inboundConnectionRateLimiter=new RateLimiter({points:h.inboundConnectionThreshold??defaultOptions.inboundConnectionThreshold,duration:1}),this.connectionPruner=new ConnectionPruner({connectionManager:this,peerStore:u.peerStore,events:u.events,logger:u.logger},{allow:h.allow?.map(y=>multiaddr(y))}),this.dialQueue=new DialQueue(u,{addressSorter:h.addressSorter,maxParallelDials:h.maxParallelDials??MAX_PARALLEL_DIALS,maxDialQueueLength:h.maxDialQueueLength??MAX_DIAL_QUEUE_LENGTH,maxPeerAddrsToDial:h.maxPeerAddrsToDial??MAX_PEER_ADDRS_TO_DIAL,dialTimeout:h.dialTimeout??DIAL_TIMEOUT,resolvers:h.resolvers??{dnsaddr:dnsaddrResolver},connections:this.connections}),this.reconnectQueue=new ReconnectQueue({events:u.events,peerStore:u.peerStore,logger:u.logger,connectionManager:this},{retries:h.reconnectRetries,retryInterval:h.reconnectRetryInterval,backoffFactor:h.reconnectBackoffFactor,maxParallelReconnects:h.maxParallelReconnects})}[Symbol.toStringTag]="@libp2p/connection-manager";async start(){this.metrics?.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{const u={inbound:0,"inbound pending":this.incomingPendingConnections,outbound:0,"outbound pending":this.outboundPendingConnections};for(const h of this.connections.values())for(const y of h)u[y.direction]++;return u}}),this.metrics?.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{const u={};for(const h of this.connections.values())for(const y of h)for(const v of y.streams){const b=`${v.direction} ${v.protocol??"unnegotiated"}`;u[b]=(u[b]??0)+1}return u}}),this.metrics?.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{const u={};for(const y of this.connections.values())for(const v of y){const b={};for(const w of v.streams){const E=`${w.direction} ${w.protocol??"unnegotiated"}`;b[E]=(b[E]??0)+1}for(const[w,E]of Object.entries(b))u[w]=u[w]??[],u[w].push(E)}const h={};for(let[y,v]of Object.entries(u)){v=v.sort((w,E)=>w-E);const b=Math.floor(v.length*.9);h[y]=v[b]}return h}}),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),await start(this.dialQueue,this.reconnectQueue,this.connectionPruner),this.started=!0,this.log("started")}async stop(){this.events.removeEventListener("connection:open",this.onConnect),this.events.removeEventListener("connection:close",this.onDisconnect),await stop(this.reconnectQueue,this.dialQueue,this.connectionPruner);const u=[];for(const h of this.connections.values())for(const y of h)u.push((async()=>{try{await y.close()}catch(v){this.log.error(v)}})());this.log("closing %d connections",u.length),await Promise.all(u),this.connections.clear(),this.log("stopped")}getMaxConnections(){return this.maxConnections}setMaxConnections(u){if(this.maxConnections<1)throw new InvalidParametersError$1("Connection Manager maxConnections must be greater than 0");let h=!1;u<this.maxConnections&&(h=!0),this.maxConnections=u,h&&this.connectionPruner.maybePruneConnections()}onConnect(u){this._onConnect(u).catch(h=>{this.log.error(h)})}async _onConnect(u){const{detail:h}=u;if(!this.started){await h.close();return}if(h.status!=="open")return;const y=h.remotePeer,v=!this.connections.has(y),b=this.connections.get(y)??[];b.push(h),this.connections.set(y,b),y.publicKey!=null&&y.type==="RSA"&&await this.peerStore.patch(y,{publicKey:y.publicKey}),v&&this.events.safeDispatchEvent("peer:connect",{detail:h.remotePeer})}onDisconnect(u){const{detail:h}=u,y=h.remotePeer,b=(this.connections.get(y)??[]).filter(w=>w.id!==h.id);this.connections.set(y,b),b.length===0&&(this.log.trace("peer %p disconnected, removing connection map entry",y),this.connections.delete(y),this.events.safeDispatchEvent("peer:disconnect",{detail:h.remotePeer}))}getConnections(u){if(u!=null)return this.connections.get(u)??[];let h=[];for(const y of this.connections.values())h=h.concat(y);return h}getConnectionsMap(){return this.connections}async openConnection(u,h={}){if(!this.started)throw new NotStartedError("Not started");this.outboundPendingConnections++;try{h.signal?.throwIfAborted();const{peerId:y}=getPeerAddress(u);if(this.peerId.equals(y))throw new InvalidPeerIdError("Can not dial self");if(y!=null&&h.force!==!0){this.log("dial %p",y);const E=this.getConnections(y).find(_=>_.limits==null);if(E!=null)return this.log("had an existing non-limited connection to %p as %a",y,E.remoteAddr),h.onProgress?.(new CustomProgressEvent("dial-queue:already-connected")),E}const v=await this.dialQueue.dial(u,{...h,priority:h.priority??DEFAULT_DIAL_PRIORITY});if(v.status!=="open")throw new ConnectionClosedError("Remote closed connection during opening");let b=this.connections.get(v.remotePeer);b==null&&(b=[],this.connections.set(v.remotePeer,b));let w=!1;for(const E of b)if(E.id===v.id&&(w=!0),h.force!==!0&&E.id!==v.id&&E.remoteAddr.equals(v.remoteAddr))return v.abort(new InvalidMultiaddrError$1("Duplicate multiaddr connection")),E;return w||b.push(v),v}finally{this.outboundPendingConnections--}}async closeConnections(u,h={}){const y=this.connections.get(u)??[];await Promise.all(y.map(async v=>{try{await v.close(h)}catch(b){v.abort(b)}}))}async acceptIncomingConnection(u){if(this.deny.some(v=>v.contains(u.remoteAddr.nodeAddress().address)))return this.log("connection from %a refused - connection remote address was in deny list",u.remoteAddr),!1;if(this.allow.some(v=>v.contains(u.remoteAddr.nodeAddress().address)))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return this.log("connection from %a refused - incomingPendingConnections exceeded by host",u.remoteAddr),!1;if(u.remoteAddr.isThinWaistAddress()){const v=u.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(v,1)}catch{return this.log("connection from %a refused - inboundConnectionThreshold exceeded by host %s",u.remoteAddr,v),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(this.log("connection from %a refused - maxConnections exceeded",u.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){const u={queued:"queued",running:"active",errored:"error",complete:"success"};return this.dialQueue.queue.queue.map(h=>({id:h.id,status:u[h.status],peerId:h.options.peerId,multiaddrs:[...h.options.multiaddrs].map(y=>multiaddr(y))}))}async isDialable(u,h={}){return this.dialQueue.isDialable(u,h)}}class MovingAverage{movingAverage;variance;deviation;forecast;timeSpan;previousTime;constructor(u){this.timeSpan=u,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(u,h){return 1-Math.exp(-(u-h)/this.timeSpan)}push(u,h=Date.now()){if(this.previousTime!=null){const y=this.alpha(h,this.previousTime),v=u-this.movingAverage,b=y*v;this.movingAverage=y*u+(1-y)*this.movingAverage,this.variance=(1-y)*(this.variance+v*b),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+y*v}else this.movingAverage=u;this.previousTime=h}}const DEFAULT_TIMEOUT_MULTIPLIER=1.2,DEFAULT_FAILURE_MULTIPLIER=2,DEFAULT_MIN_TIMEOUT=5e3,DEFAULT_MAX_TIMEOUT=6e4,DEFAULT_INTERVAL=5e3;class AdaptiveTimeout{success;failure;next;metric;timeoutMultiplier;failureMultiplier;minTimeout;maxTimeout;constructor(u={}){const h=u.interval??DEFAULT_INTERVAL;this.success=new MovingAverage(h),this.failure=new MovingAverage(h),this.next=new MovingAverage(h),this.failureMultiplier=u.failureMultiplier??DEFAULT_FAILURE_MULTIPLIER,this.timeoutMultiplier=u.timeoutMultiplier??DEFAULT_TIMEOUT_MULTIPLIER,this.minTimeout=u.minTimeout??DEFAULT_MIN_TIMEOUT,this.maxTimeout=u.maxTimeout??DEFAULT_MAX_TIMEOUT,u.metricName!=null&&(this.metric=u.metrics?.registerMetricGroup(u.metricName))}getTimeoutSignal(u={}){let h=Math.round(this.next.movingAverage*(u.timeoutFactor??this.timeoutMultiplier));h<this.minTimeout&&(h=this.minTimeout),h>this.maxTimeout&&(h=this.maxTimeout);const y=AbortSignal.timeout(h),v=anySignal([u.signal,y]);return v.start=Date.now(),v.timeout=h,v}cleanUp(u){const h=Date.now()-u.start;u.aborted?(this.failure.push(h),this.next.push(h*this.failureMultiplier),this.metric?.update({failureMovingAverage:this.failure.movingAverage,failureDeviation:this.failure.deviation,failureForecast:this.failure.forecast,failureVariance:this.failure.variance,failure:h})):(this.success.push(h),this.next.push(h),this.metric?.update({successMovingAverage:this.success.movingAverage,successDeviation:this.success.deviation,successForecast:this.success.forecast,successVariance:this.success.variance,success:h}))}}const DEFAULT_PING_INTERVAL_MS=1e4,PROTOCOL_VERSION$1="1.0.0",PROTOCOL_NAME$1="ping",PROTOCOL_PREFIX="ipfs",PING_LENGTH=32,DEFAULT_ABORT_CONNECTION_ON_PING_FAILURE=!0;class ConnectionMonitor{protocol;components;log;heartbeatInterval;pingIntervalMs;abortController;timeout;abortConnectionOnPingFailure;constructor(u,h={}){this.components=u,this.protocol=`/${h.protocolPrefix??PROTOCOL_PREFIX}/${PROTOCOL_NAME$1}/${PROTOCOL_VERSION$1}`,this.log=u.logger.forComponent("libp2p:connection-monitor"),this.pingIntervalMs=h.pingInterval??DEFAULT_PING_INTERVAL_MS,this.abortConnectionOnPingFailure=h.abortConnectionOnPingFailure??DEFAULT_ABORT_CONNECTION_ON_PING_FAILURE,this.timeout=new AdaptiveTimeout({...h.pingTimeout??{},metrics:u.metrics,metricName:"libp2p_connection_monitor_ping_time_milliseconds"})}[Symbol.toStringTag]="@libp2p/connection-monitor";[serviceCapabilities]=["@libp2p/connection-monitor"];start(){this.abortController=new AbortController,this.abortController.signal,this.heartbeatInterval=setInterval(()=>{this.components.connectionManager.getConnections().forEach(u=>{Promise.resolve().then(async()=>{let h=Date.now();try{const y=this.timeout.getTimeoutSignal({signal:this.abortController?.signal}),v=await u.newStream(this.protocol,{signal:y,runOnLimitedConnection:!0}),b=byteStream$1(v);h=Date.now(),await Promise.all([b.write(randomBytes$2(PING_LENGTH),{signal:y}),b.read({bytes:PING_LENGTH,signal:y})]),u.rtt=Date.now()-h,await b.unwrap().close({signal:y})}catch(y){if(y.name!=="UnsupportedProtocolError")throw y;u.rtt=(Date.now()-h)/2}}).catch(h=>{this.log.error("error during heartbeat",h),this.abortConnectionOnPingFailure?(this.log.error("aborting connection due to ping failure"),u.abort(h)):this.log("connection ping failed, but not aborting due to abortConnectionOnPingFailure flag")})})},this.pingIntervalMs)}stop(){this.abortController?.abort(),this.heartbeatInterval!=null&&clearInterval(this.heartbeatInterval)}}class CompoundContentRouting{routers;started;components;constructor(u,h){this.routers=h.routers??[],this.started=!1,this.components=u,this.findProviders=u.metrics?.traceFunction("libp2p.contentRouting.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromArgs:([y],v)=>({...v,cid:y.toString()}),getAttributesFromYieldedValue:(y,v)=>({...v,providers:[...Array.isArray(v.providers)?v.providers:[],y.id.toString()]})})??this.findProviders,this.provide=u.metrics?.traceFunction("libp2p.contentRouting.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromArgs:([y],v)=>({...v,cid:y.toString()})})??this.provide,this.cancelReprovide=u.metrics?.traceFunction("libp2p.contentRouting.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1,getAttributesFromArgs:([y],v)=>({...v,cid:y.toString()})})??this.cancelReprovide,this.put=u.metrics?.traceFunction("libp2p.contentRouting.put",this.put.bind(this),{optionsIndex:2,getAttributesFromArgs:([y])=>({key:toString$1(y,"base36")})})??this.put,this.get=u.metrics?.traceFunction("libp2p.contentRouting.get",this.get.bind(this),{optionsIndex:1,getAttributesFromArgs:([y])=>({key:toString$1(y,"base36")})})??this.get}[Symbol.toStringTag]="@libp2p/content-routing";isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(u,h={}){if(this.routers.length===0)throw new NoContentRoutersError("No content routers available");const y=this,v=new PeerSet;for await(const b of merge$1(...y.routers.filter(w=>w.findProviders instanceof Function).map(w=>w.findProviders(u,h))))b!=null&&(b.multiaddrs.length>0&&await this.components.peerStore.merge(b.id,{multiaddrs:b.multiaddrs},h),!v.has(b.id)&&(v.add(b.id),yield b))}async provide(u,h={}){if(this.routers.length===0)throw new NoContentRoutersError("No content routers available");await Promise.all(this.routers.filter(y=>y.provide instanceof Function).map(async y=>{await y.provide(u,h)}))}async cancelReprovide(u,h={}){if(this.routers.length===0)throw new NoContentRoutersError("No content routers available");await Promise.all(this.routers.filter(y=>y.cancelReprovide instanceof Function).map(async y=>{await y.cancelReprovide(u,h)}))}async put(u,h,y){if(!this.isStarted())throw new NotStartedError;await Promise.all(this.routers.filter(v=>v.put instanceof Function).map(async v=>{await v.put(u,h,y)}))}async get(u,h){if(!this.isStarted())throw new NotStartedError;return Promise.any(this.routers.filter(y=>y.get instanceof Function).map(async y=>y.get(u,h)))}}class DefaultPeerRouting{log;peerId;peerStore;routers;constructor(u,h={}){this.log=u.logger.forComponent("libp2p:peer-routing"),this.peerId=u.peerId,this.peerStore=u.peerStore,this.routers=h.routers??[],this.findPeer=u.metrics?.traceFunction("libp2p.peerRouting.findPeer",this.findPeer.bind(this),{optionsIndex:1,getAttributesFromArgs:([y],v)=>({...v,peer:y.toString()})})??this.findPeer,this.getClosestPeers=u.metrics?.traceFunction("libp2p.peerRouting.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1,getAttributesFromArgs:([y],v)=>({...v,key:toString$1(y,"base36")}),getAttributesFromYieldedValue:(y,v)=>({...v,peers:[...Array.isArray(v.peers)?v.peers:[],y.id.toString()]})})??this.getClosestPeers}[Symbol.toStringTag]="@libp2p/peer-routing";async findPeer(u,h){if(this.routers.length===0)throw new NoPeerRoutersError("No peer routers available");if(u.toString()===this.peerId.toString())throw new QueriedForSelfError("Should not try to find self");const y=this,v=merge$1(...this.routers.filter(b=>b.findPeer instanceof Function).map(b=>(async function*(){try{yield await b.findPeer(u,h)}catch(w){y.log.error(w)}})()));for await(const b of v)if(b!=null)return b.multiaddrs.length>0&&await this.peerStore.merge(b.id,{multiaddrs:b.multiaddrs},h),b;throw new NotFoundError$1}async*getClosestPeers(u,h={}){if(this.routers.length===0)throw new NoPeerRoutersError("No peer routers available");const y=this,v=createScalableCuckooFilter(1024);for await(const b of parallel((async function*(){const w=merge$1(...y.routers.filter(E=>E.getClosestPeers instanceof Function).map(E=>E.getClosestPeers(u,h)));for await(let E of w)yield async()=>{if(E.multiaddrs.length===0)try{E=await y.findPeer(E.id,{...h,useCache:!1})}catch(_){y.log.error("could not find peer multiaddrs",_);return}return E}})()))b!=null&&(b.multiaddrs.length>0&&await this.peerStore.merge(b.id,{multiaddrs:b.multiaddrs},h),!v.has(b.id.toMultihash().bytes)&&(v.add(b.id.toMultihash().bytes),yield b))}}class RandomWalk extends TypedEventEmitter{peerRouting;log;walking;walkers;shutdownController;walkController;needNext;constructor(u){super(),this.log=u.logger.forComponent("libp2p:random-walk"),this.peerRouting=u.peerRouting,this.walkers=0,this.walking=!1,this.shutdownController=new AbortController,this.shutdownController.signal}[Symbol.toStringTag]="@libp2p/random-walk";start(){this.shutdownController=new AbortController,this.shutdownController.signal}stop(){this.shutdownController.abort()}async*walk(u){this.walking||this.startWalk(),this.walkers++;const h=anySignal([this.shutdownController.signal,u?.signal]);try{for(;;)this.needNext?.resolve(),this.needNext=pDefer(),yield(await raceEvent(this,"walk:peer",h,{errorEvent:"walk:error"})).detail}finally{h.clear(),this.walkers--,this.walkers===0&&(this.walkController?.abort(),this.walkController=void 0)}}startWalk(){this.walking=!0,this.walkController=new AbortController,this.walkController.signal;const u=anySignal([this.walkController.signal,this.shutdownController.signal]),h=Date.now();let y=0;Promise.resolve().then(async()=>{for(this.log("start walk");this.walkers>0;)try{const v=randomBytes$2(32);let b=Date.now();for await(const w of this.peerRouting.getClosestPeers(v,{signal:u}))u.aborted&&this.log("aborting walk"),u.throwIfAborted(),this.log("found peer %p after %dms for %d walkers",w.id,Date.now()-b,this.walkers),y++,this.safeDispatchEvent("walk:peer",{detail:w}),this.walkers===1&&this.needNext!=null&&(this.log("wait for need next"),await raceSignal$1(this.needNext.promise,u)),b=Date.now();this.log("walk iteration for %b and %d walkers finished, found %d peers",v,this.walkers,y)}catch(v){this.log.error("random walk errored",v),this.safeDispatchEvent("walk:error",{detail:v})}this.log("no walkers left, ended walk")}).catch(v=>{this.log.error("random walk errored",v)}).finally(()=>{this.log("finished walk, found %d peers after %dms",y,Date.now()-h),this.walking=!1})}}const DEFAULT_MAX_INBOUND_STREAMS=32,DEFAULT_MAX_OUTBOUND_STREAMS=64;class Registrar{log;topologies;handlers;components;constructor(u){this.components=u,this.log=u.logger.forComponent("libp2p:registrar"),this.topologies=new Map,u.metrics?.registerMetricGroup("libp2p_registrar_topologies",{calculate:()=>{const h={};for(const[y,v]of this.topologies)h[y]=v.size;return h}}),this.handlers=trackedMap({name:"libp2p_registrar_protocol_handlers",metrics:u.metrics}),this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}[Symbol.toStringTag]="@libp2p/registrar";getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(u){const h=this.handlers.get(u);if(h==null)throw new UnhandledProtocolError(`No handler registered for protocol ${u}`);return h}getTopologies(u){const h=this.topologies.get(u);return h==null?[]:[...h.values()]}async handle(u,h,y){if(this.handlers.has(u)&&y?.force!==!0)throw new DuplicateProtocolHandlerError(`Handler already registered for protocol ${u}`);const v=mergeOptions.bind({ignoreUndefined:!0})({maxInboundStreams:DEFAULT_MAX_INBOUND_STREAMS,maxOutboundStreams:DEFAULT_MAX_OUTBOUND_STREAMS},y);this.handlers.set(u,{handler:h,options:v}),await this.components.peerStore.merge(this.components.peerId,{protocols:[u]},y)}async unhandle(u,h){(Array.isArray(u)?u:[u]).forEach(v=>{this.handlers.delete(v)}),await this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()},h)}async register(u,h){if(h==null)throw new InvalidParametersError$1("invalid topology");const y=`${(Math.random()*1e9).toString(36)}${Date.now()}`;let v=this.topologies.get(u);return v==null&&(v=new Map,this.topologies.set(u,v)),v.set(y,h),y}unregister(u){for(const[h,y]of this.topologies.entries())y.has(u)&&(y.delete(u),y.size===0&&this.topologies.delete(h))}_onDisconnect(u){const h=u.detail,y={signal:AbortSignal.timeout(5e3)};this.components.peerStore.get(h,y).then(v=>{for(const b of v.protocols){const w=this.topologies.get(b);if(w!=null)for(const E of w.values())E.filter?.has(h)!==!1&&(E.filter?.remove(h),E.onDisconnect?.(h))}}).catch(v=>{v.name!=="NotFoundError"&&this.log.error("could not inform topologies of disconnecting peer %p",h,v)})}_onPeerUpdate(u){const{peer:h,previous:y}=u.detail,v=(y?.protocols??[]).filter(b=>!h.protocols.includes(b));for(const b of v){const w=this.topologies.get(b);if(w!=null)for(const E of w.values())E.filter?.has(h.id)!==!1&&(E.filter?.remove(h.id),E.onDisconnect?.(h.id))}}_onPeerIdentify(u){const h=u.detail.protocols,y=u.detail.connection,v=u.detail.peerId;for(const b of h){const w=this.topologies.get(b);if(w!=null)for(const E of w.values())y.limits!=null&&E.notifyOnLimitedConnection!==!0||E.filter?.has(v)!==!0&&(E.filter?.add(v),E.onConnect?.(v,y))}}}class DefaultTransportManager{log;components;transports;listeners;faultTolerance;started;constructor(u,h={}){this.log=u.logger.forComponent("libp2p:transports"),this.components=u,this.started=!1,this.transports=trackedMap({name:"libp2p_transport_manager_transports",metrics:this.components.metrics}),this.listeners=trackedMap({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=h.faultTolerance??FaultTolerance.FATAL_ALL}[Symbol.toStringTag]="@libp2p/transport-manager";add(u){const h=u[Symbol.toStringTag];if(h==null)throw new InvalidParametersError$1("Transport must have a valid tag");if(this.transports.has(h))throw new InvalidParametersError$1(`There is already a transport with the tag ${h}`);this.log("adding transport %s",h),this.transports.set(h,u),this.listeners.has(h)||this.listeners.set(h,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){const u=this.components.addressManager.getListenAddrs();await this.listen(u)}async stop(){const u=[];for(const[h,y]of this.listeners)for(this.log("closing listeners for %s",h);y.length>0;){const v=y.pop();v!=null&&u.push(v.close())}await Promise.all(u),this.log("all listeners closed");for(const h of this.listeners.keys())this.listeners.set(h,[]);this.started=!1}async dial(u,h){const y=this.dialTransportForMultiaddr(u);if(y==null)throw new TransportUnavailableError(`No transport available for address ${String(u)}`);return h?.onProgress?.(new CustomProgressEvent("transport-manager:selected-transport",y[Symbol.toStringTag])),y.dial(u,{...h,upgrader:this.components.upgrader})}getAddrs(){let u=[];for(const h of this.listeners.values())for(const y of h)u=[...u,...y.getAddrs()];return u}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}dialTransportForMultiaddr(u){for(const h of this.transports.values())if(h.dialFilter([u]).length>0)return h}listenTransportForMultiaddr(u){for(const h of this.transports.values())if(h.listenFilter([u]).length>0)return h}async listen(u){if(!this.isStarted())throw new NotStartedError("Not started");if(u==null||u.length===0){this.log("no addresses were provided for listening, this node is dial only");return}const h={errors:new Map,ipv4:{success:0,attempts:0},ipv6:{success:0,attempts:0}};u.forEach(b=>{h.errors.set(b.toString(),new UnsupportedListenAddressError)});const y=[];for(const[b,w]of this.transports.entries()){const E=w.listenFilter(u);for(const _ of E){this.log("creating listener for %s on %a",b,_);const S=w.createListener({upgrader:this.components.upgrader});let A=this.listeners.get(b)??[];A==null&&(A=[],this.listeners.set(b,A)),A.push(S),S.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:S})}),S.addEventListener("close",()=>{const R=A.findIndex(x=>x===S);A.splice(R,1),this.components.events.safeDispatchEvent("transport:close",{detail:S})}),IP4.matches(_)?h.ipv4.attempts++:IP6.matches(_)&&h.ipv6.attempts++,y.push(S.listen(_).then(()=>{h.errors.delete(_.toString()),IP4.matches(_)&&h.ipv4.success++,IP6.matches(_)&&h.ipv6.success++},R=>{throw this.log.error("transport %s could not listen on address %a - %e",b,_,R),h.errors.set(_.toString(),R),R}))}}const v=await Promise.allSettled(y);if(!(v.length>0&&v.every(b=>b.status==="fulfilled"))){if(this.ipv6Unsupported(h)){this.log("all IPv4 addresses succeed but all IPv6 failed");return}if(this.faultTolerance===FaultTolerance.NO_FATAL){this.log("failed to listen on any address but fault tolerance allows this");return}throw new UnsupportedListenAddressesError(`Some configured addresses failed to be listened on, you may need to remove one or more listen addresses from your configuration or set \`transportManager.faultTolerance\` to NO_FATAL:
${[...h.errors.entries()].map(([b,w])=>`
  ${b}: ${`${w.stack??w}`.split(`
`).join(`
  `)}
`).join("")}`)}}ipv6Unsupported(u){if(u.ipv4.attempts===0||u.ipv6.attempts===0)return!1;const h=u.ipv4.attempts===u.ipv4.success,y=u.ipv6.success===0;return h&&y}async remove(u){const h=this.listeners.get(u)??[];this.log.trace("removing transport %s",u);const y=[];for(this.log.trace("closing listeners for %s",u);h.length>0;){const v=h.pop();v!=null&&y.push(v.close())}await Promise.all(y),this.transports.delete(u),this.listeners.delete(u)}async removeAll(){const u=[];for(const h of this.transports.keys())u.push(this.remove(h));await Promise.all(u)}}const PROTOCOL_ID="/multistream/1.0.0",MAX_PROTOCOL_LENGTH=1024,NewLine=fromString(`
`);async function write(g,u,h){await g.write(u,h)}async function writeAll(g,u,h){await g.writeV(u,h)}async function read(g,u){const h=await g.read(u);if(h.byteLength===0||h.get(h.byteLength-1)!==NewLine[0])throw u.log.error("Invalid mss message - missing newline",h),new InvalidMessageError("Missing newline");return h.sublist(0,-1)}async function readString(g,u){const h=await read(g,u);return toString$1(h.subarray())}async function select(g,u,h){if(u=Array.isArray(u)?[...u]:[u],u.length===1&&h.negotiateFully===!1)return optimisticSelect(g,u[0],h);const y=lpStream$1(g,{...h,maxDataLength:MAX_PROTOCOL_LENGTH}),v=u.shift();if(v==null)throw new Error("At least one protocol must be specified");h.log.trace('select: write ["%s", "%s"]',PROTOCOL_ID,v);const b=fromString(`${PROTOCOL_ID}
`),w=fromString(`${v}
`);await writeAll(y,[b,w],h),h.log.trace("select: reading multistream-select header");let E=await readString(y,h);if(h.log.trace('select: read "%s"',E),E===PROTOCOL_ID&&(h.log.trace("select: reading protocol response"),E=await readString(y,h),h.log.trace('select: read "%s"',E)),E===v)return{stream:y.unwrap(),protocol:v};for(const _ of u){h.log.trace('select: write "%s"',_),await write(y,fromString(`${_}
`),h),h.log.trace("select: reading protocol response");const S=await readString(y,h);if(h.log.trace('select: read "%s" for "%s"',S,_),S===_)return{stream:y.unwrap(),protocol:_}}throw new UnsupportedProtocolError("protocol selection failed")}function optimisticSelect(g,u,h){const y=g.sink.bind(g),v=g.source;let b=!1,w=!1;const E=pDefer();let _=!1,S=!1;const A=pDefer();let R=!1,x=!1;const T=pDefer(),C=lpStream$1({sink:y,source:v},{...h,maxDataLength:MAX_PROTOCOL_LENGTH});g.sink=async B=>{const{sink:U}=C.unwrap();await U((async function*(){let z=!1;for await(const ne of B){if(S&&await A.promise,_)yield ne;else{S=!0,h.log.trace('optimistic: write ["%s", "%s", data(%d)] in sink',PROTOCOL_ID,u,ne.byteLength);const ue=`${u}
`;yield new Uint8ArrayList(Uint8Array.from([19]),fromString(`${PROTOCOL_ID}
`),encode$2(ue.length),fromString(ue),ne).subarray(),h.log.trace('optimistic: wrote ["%s", "%s", data(%d)] in sink',PROTOCOL_ID,u,ne.byteLength),_=!0,S=!1,A.resolve(),I().catch(he=>{h.log.error("could not finish optimistic protocol negotiation of %s",u,he)})}z=!0}z||await I()})())};async function I(){if(w){h.log.trace("optimistic: already negotiating %s stream",u),await E.promise;return}w=!0;try{_||(h.log.trace("optimistic: doing send protocol for %s stream",u),await L()),R||(h.log.trace("optimistic: doing read protocol for %s stream",u),await $())}finally{w=!1,b=!0,E.resolve()}}async function L(){if(S){await A.promise;return}S=!0;try{h.log.trace('optimistic: write ["%s", "%s", data] in source',PROTOCOL_ID,u),await C.writeV([fromString(`${PROTOCOL_ID}
`),fromString(`${u}
`)]),h.log.trace('optimistic: wrote ["%s", "%s", data] in source',PROTOCOL_ID,u)}finally{_=!0,S=!1,A.resolve()}}async function $(){if(x){await T.promise;return}x=!0;try{h.log.trace("optimistic: reading multistream select header");let B=await readString(C,h);if(h.log.trace('optimistic: read multistream select header "%s"',B),B===PROTOCOL_ID&&(B=await readString(C,h)),h.log.trace('optimistic: read protocol "%s", expecting "%s"',B,u),B!==u)throw new UnsupportedProtocolError("protocol selection failed")}finally{R=!0,x=!1,T.resolve()}}if(g.source=(async function*(){await I(),h.log.trace('optimistic: reading data from "%s" stream',u),yield*C.unwrap().source})(),g.closeRead!=null){const B=g.closeRead.bind(g);g.closeRead=async U=>{b||await I().catch(z=>{h.log.error("could not negotiate protocol before close read",z)}),await B(U)}}if(g.closeWrite!=null){const B=g.closeWrite.bind(g);g.closeWrite=async U=>{b||await I().catch(z=>{h.log.error("could not negotiate protocol before close write",z)}),await B(U)}}if(g.close!=null){const B=g.close.bind(g);g.close=async U=>{const z=[];S&&z.push(A.promise),x&&z.push(T.promise),z.length>0?await raceSignal$1(Promise.all(z),U?.signal):(b=!0,w=!1,E.resolve()),await B(U)}}return{stream:g,protocol:u}}async function handle(g,u,h){u=Array.isArray(u)?u:[u],h.log.trace("handle: available protocols %s",u);const y=lpStream$1(g,{...h,maxDataLength:MAX_PROTOCOL_LENGTH,maxLengthLength:2});for(;;){h.log.trace("handle: reading incoming string");const v=await readString(y,h);if(h.log.trace('handle: read "%s"',v),v===PROTOCOL_ID){h.log.trace('handle: respond with "%s" for "%s"',PROTOCOL_ID,v),await write(y,fromString(`${PROTOCOL_ID}
`),h),h.log.trace('handle: responded with "%s" for "%s"',PROTOCOL_ID,v);continue}if(u.includes(v))return h.log.trace('handle: respond with "%s" for "%s"',v,v),await write(y,fromString(`${v}
`),h),h.log.trace('handle: responded with "%s" for "%s"',v,v),{stream:y.unwrap(),protocol:v};if(v==="ls"){const b=new Uint8ArrayList(...u.map(w=>encode$1.single(fromString(`${w}
`))),fromString(`
`));h.log.trace('handle: respond with "%s" for %s',u,v),await write(y,b,h),h.log.trace('handle: responded with "%s" for %s',u,v);continue}h.log.trace('handle: respond with "na" for "%s"',v),await write(y,fromString(`na
`),h),h.log('handle: responded with "na" for "%s"',v)}}const CLOSE_TIMEOUT$1=500;class Connection{id;remoteAddr;remotePeer;direction;timeline;multiplexer;encryption;status;limits;log;tags;maConn;muxer;components;outboundStreamProtocolNegotiationTimeout;inboundStreamProtocolNegotiationTimeout;constructor(u,h){this.components=u,this.id=h.id,this.remoteAddr=h.maConn.remoteAddr,this.remotePeer=h.remotePeer,this.direction=h.direction??"outbound",this.status="open",this.timeline=h.maConn.timeline,this.encryption=h.encryption,this.limits=h.limits,this.maConn=h.maConn,this.log=h.maConn.log,this.outboundStreamProtocolNegotiationTimeout=h.outboundStreamProtocolNegotiationTimeout??PROTOCOL_NEGOTIATION_TIMEOUT,this.inboundStreamProtocolNegotiationTimeout=h.inboundStreamProtocolNegotiationTimeout??PROTOCOL_NEGOTIATION_TIMEOUT,this.remoteAddr.getPeerId()==null&&(this.remoteAddr=this.remoteAddr.encapsulate(`/p2p/${this.remotePeer}`)),this.tags=[],h.muxerFactory!=null&&(this.multiplexer=h.muxerFactory.protocol,this.muxer=h.muxerFactory.createStreamMuxer({direction:this.direction,log:this.log,onIncomingStream:y=>{this.onIncomingStream(y)}}),Promise.all([this.muxer.sink(this.maConn.source),this.maConn.sink(this.muxer.source)]).catch(y=>{this.log.error("error piping data through muxer - %e",y)}))}[Symbol.toStringTag]="Connection";[connectionSymbol]=!0;get streams(){return this.muxer?.streams??[]}newStream=async(u,h={})=>{if(this.status==="closing")throw new ConnectionClosingError("the connection is being closed");if(this.status==="closed")throw new ConnectionClosedError("the connection is closed");if(Array.isArray(u)||(u=[u]),this.limits!=null&&h?.runOnLimitedConnection!==!0)throw new LimitedConnectionError("Cannot open protocol stream on limited connection");if(this.muxer==null)throw new MuxerUnavailableError("Connection is not multiplexed");this.log.trace("starting new stream for protocols %s",u);const y=await this.muxer.newStream();this.log.trace("started new stream %s for protocols %s",y.id,u);try{if(h.signal==null){y.log("no abort signal was passed while trying to negotiate protocols %s falling back to default timeout",u);const _=AbortSignal.timeout(this.outboundStreamProtocolNegotiationTimeout);h={...h,signal:_}}y.log.trace("selecting protocol from protocols %s",u);const{stream:v,protocol:b}=await select(y,u,{...h,log:y.log,yieldBytes:!0});y.log("selected protocol %s",b);const w=findOutgoingStreamLimit(b,this.components.registrar,h),E=countStreams(b,"outbound",this);if(E>=w){const _=new TooManyOutboundProtocolStreamsError(`Too many outbound protocol streams for protocol "${b}" - ${E}/${w}`);throw y.abort(_),_}return await this.components.peerStore.merge(this.remotePeer,{protocols:[b]}),y.source=v.source,y.sink=v.sink,y.protocol=b,v.closeWrite!=null&&(y.closeWrite=v.closeWrite),v.closeRead!=null&&(y.closeRead=v.closeRead),v.close!=null&&(y.close=v.close),this.components.metrics?.trackProtocolStream(y,this),y.direction="outbound",y}catch(v){throw this.log.error("could not create new outbound stream on connection %s %a for protocols %s - %e",this.direction==="inbound"?"from":"to",this.remoteAddr,u,v),y.timeline.close==null&&y.abort(v),v}};onIncomingStream(u){const h=AbortSignal.timeout(this.inboundStreamProtocolNegotiationTimeout);Promise.resolve().then(async()=>{const y=this.components.registrar.getProtocols(),{stream:v,protocol:b}=await handle(u,y,{signal:h,log:u.log,yieldBytes:!1});this.log("incoming %s stream opened",b);const w=findIncomingStreamLimit(b,this.components.registrar);if(countStreams(b,"inbound",this)===w){const A=new TooManyInboundProtocolStreamsError(`Too many inbound protocol streams for protocol "${b}" - limit ${w}`);throw u.abort(A),A}u.source=v.source,u.sink=v.sink,u.protocol=b,v.closeWrite!=null&&(u.closeWrite=v.closeWrite),v.closeRead!=null&&(u.closeRead=v.closeRead),v.close!=null&&(u.close=v.close),await this.components.peerStore.merge(this.remotePeer,{protocols:[b]},{signal:h}),this.components.metrics?.trackProtocolStream(u,this);const{handler:_,options:S}=this.components.registrar.getHandler(b);if(this.limits!=null&&S.runOnLimitedConnection!==!0)throw new LimitedConnectionError("Cannot open protocol stream on limited connection");await _({connection:this,stream:u})}).catch(async y=>{this.log.error("error handling incoming stream id %s - %e",u.id,y),u.abort(y)})}async close(u={}){if(!(this.status==="closed"||this.status==="closing")){if(this.log("closing connection to %a",this.remoteAddr),this.status="closing",u.signal==null){const h=AbortSignal.timeout(CLOSE_TIMEOUT$1);u={...u,signal:h}}try{this.log.trace("closing underlying transport"),await this.muxer?.close(u),await this.maConn.close(u),this.log.trace("updating timeline with close time"),this.status="closed",this.timeline.close=Date.now()}catch(h){this.log.error("error encountered during graceful close of connection to %a",this.remoteAddr,h),this.abort(h)}}}abort(u){this.status!=="closed"&&(this.log.error("aborting connection to %a due to error",this.remoteAddr,u),this.status="closing",this.muxer?.abort(u),this.maConn.abort(u),this.status="closed",this.timeline.close=Date.now())}}function createConnection(g,u){return new Connection(g,u)}function findIncomingStreamLimit(g,u){try{const{options:h}=u.getHandler(g);return h.maxInboundStreams}catch(h){if(h.name!=="UnhandledProtocolError")throw h}return DEFAULT_MAX_INBOUND_STREAMS}function findOutgoingStreamLimit(g,u,h={}){try{const{options:y}=u.getHandler(g);if(y.maxOutboundStreams!=null)return y.maxOutboundStreams}catch(y){if(y.name!=="UnhandledProtocolError")throw y}return h.maxOutboundStreams??DEFAULT_MAX_OUTBOUND_STREAMS}function countStreams(g,u,h){let y=0;return h.streams.forEach(v=>{v.direction===u&&v.protocol===g&&y++}),y}class Upgrader{components;connectionEncrypters;streamMuxers;inboundUpgradeTimeout;inboundStreamProtocolNegotiationTimeout;outboundStreamProtocolNegotiationTimeout;events;metrics;constructor(u,h){this.components=u,this.connectionEncrypters=trackedMap({name:"libp2p_upgrader_connection_encrypters",metrics:this.components.metrics}),h.connectionEncrypters.forEach(y=>{this.connectionEncrypters.set(y.protocol,y)}),this.streamMuxers=trackedMap({name:"libp2p_upgrader_stream_multiplexers",metrics:this.components.metrics}),h.streamMuxers.forEach(y=>{this.streamMuxers.set(y.protocol,y)}),this.inboundUpgradeTimeout=h.inboundUpgradeTimeout??INBOUND_UPGRADE_TIMEOUT,this.inboundStreamProtocolNegotiationTimeout=h.inboundStreamProtocolNegotiationTimeout??PROTOCOL_NEGOTIATION_TIMEOUT,this.outboundStreamProtocolNegotiationTimeout=h.outboundStreamProtocolNegotiationTimeout??PROTOCOL_NEGOTIATION_TIMEOUT,this.events=u.events,this.metrics={dials:u.metrics?.registerCounterGroup("libp2p_connection_manager_dials_total"),errors:u.metrics?.registerCounterGroup("libp2p_connection_manager_dial_errors_total"),inboundErrors:u.metrics?.registerCounterGroup("libp2p_connection_manager_dials_inbound_errors_total"),outboundErrors:u.metrics?.registerCounterGroup("libp2p_connection_manager_dials_outbound_errors_total")}}[Symbol.toStringTag]="@libp2p/upgrader";async shouldBlockConnection(u,...h){const y=this.components.connectionGater[u];if(y==null)return;if(await y.apply(this.components.connectionGater,h)===!0)throw new ConnectionInterceptedError(`The multiaddr connection is blocked by gater.${u}`)}createInboundAbortSignal(u){return anySignal([AbortSignal.timeout(this.inboundUpgradeTimeout),u])}async upgradeInbound(u,h){let y=!1;const v=this.createInboundAbortSignal(h.signal);try{if(this.metrics.dials?.increment({inbound:!0}),y=await raceSignal$1(this.components.connectionManager.acceptIncomingConnection(u),v),!y)throw new ConnectionDeniedError("Connection denied");await raceSignal$1(this.shouldBlockConnection("denyInboundConnection",u),v),await this._performUpgrade(u,"inbound",{...h,signal:v})}catch(b){throw this.metrics.errors?.increment({inbound:!0}),this.metrics.inboundErrors?.increment({[b.name??"Error"]:!0}),b}finally{v.clear(),y&&this.components.connectionManager.afterUpgradeInbound()}}async upgradeOutbound(u,h){try{this.metrics.dials?.increment({outbound:!0});const y=u.remoteAddr.getPeerId();let v;y!=null&&(v=peerIdFromString$1(y),await raceSignal$1(this.shouldBlockConnection("denyOutboundConnection",v,u),h.signal));let b="outbound";return h.initiator===!1&&(b="inbound"),await this._performUpgrade(u,b,h)}catch(y){throw this.metrics.errors?.increment({outbound:!0}),this.metrics.outboundErrors?.increment({[y.name??"Error"]:!0}),y}}async _performUpgrade(u,h,y){let v,b,w,E,_;const S=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`;u.log=u.log.newScope(`${h}:${S}`),this.components.metrics?.trackMultiaddrConnection(u),u.log.trace("starting the %s connection upgrade",h);let A=u;if(y?.skipProtection!==!0){const x=this.components.connectionProtector;x!=null&&(u.log("protecting the %s connection",h),A=await x.protect(u,y))}try{if(v=A,y?.skipEncryption!==!0){y?.onProgress?.(new CustomProgressEvent(`upgrader:encrypt-${h}-connection`)),{conn:v,remotePeer:b,protocol:_,streamMuxer:E}=await(h==="inbound"?this._encryptInbound(A,y):this._encryptOutbound(A,y));const x={...A,...v};await this.shouldBlockConnection(h==="inbound"?"denyInboundEncryptedConnection":"denyOutboundEncryptedConnection",b,x)}else{const x=u.remoteAddr.getPeerId();if(x==null)throw new InvalidMultiaddrError$1(`${h} connection that skipped encryption must have a peer id`);const T=peerIdFromString$1(x);_="native",b=T}if(b.equals(this.components.peerId)){const x=new InvalidPeerIdError("Can not dial self");throw u.abort(x),x}if(w=v,y?.muxerFactory!=null)E=y.muxerFactory;else if(E==null&&this.streamMuxers.size>0){y?.onProgress?.(new CustomProgressEvent(`upgrader:multiplex-${h}-connection`));const x=await(h==="inbound"?this._multiplexInbound({...A,...v},this.streamMuxers,y):this._multiplexOutbound({...A,...v},this.streamMuxers,y));E=x.muxerFactory,w=x.stream}}catch(x){throw u.log.error("failed to upgrade inbound connection %s %a - %e",h==="inbound"?"from":"to",u.remoteAddr,x),x}await this.shouldBlockConnection(h==="inbound"?"denyInboundUpgradedConnection":"denyOutboundUpgradedConnection",b,u);const R=this._createConnection({id:S,cryptoProtocol:_,direction:h,maConn:u,upgradedConn:w,muxerFactory:E,remotePeer:b,limits:y?.limits});return R.log("successfully upgraded %s connection",h),R}_createConnection(u){const{id:h,cryptoProtocol:y,direction:v,maConn:b,upgradedConn:w,remotePeer:E,muxerFactory:_,limits:S}=u;let A;const R=b.timeline;return b.timeline=new Proxy(R,{set:(...x)=>(x[1]==="close"&&x[2]!=null&&R.close==null&&(async()=>{try{A.status==="open"&&await A.close()}catch(T){A.log.error("error closing connection after timeline close %e",T)}finally{this.events.safeDispatchEvent("connection:close",{detail:A})}})().catch(T=>{A.log.error("error thrown while dispatching connection:close event %e",T)}),Reflect.set(...x))}),b.timeline.upgraded=Date.now(),A=createConnection(this.components,{id:h,maConn:w,remotePeer:E,direction:v,muxerFactory:_,encryption:y,limits:S,outboundStreamProtocolNegotiationTimeout:this.outboundStreamProtocolNegotiationTimeout,inboundStreamProtocolNegotiationTimeout:this.inboundStreamProtocolNegotiationTimeout}),this.events.safeDispatchEvent("connection:open",{detail:A}),A}async _encryptInbound(u,h){const y=Array.from(this.connectionEncrypters.keys());try{const{stream:v,protocol:b}=await handle(u,y,{...h,log:u.log}),w=this.connectionEncrypters.get(b);if(w==null)throw new EncryptionFailedError(`no crypto module found for ${b}`);return u.log("encrypting inbound connection to %a using %s",u.remoteAddr,b),{...await w.secureInbound(v,h),protocol:b}}catch(v){throw u.log.error("encrypting inbound connection from %a failed",u.remoteAddr,v),new EncryptionFailedError(v.message)}}async _encryptOutbound(u,h){const y=Array.from(this.connectionEncrypters.keys());try{u.log.trace("selecting encrypter from %s",y);const{stream:v,protocol:b}=await select(u,y,{...h,log:u.log,yieldBytes:!0}),w=this.connectionEncrypters.get(b);if(w==null)throw new EncryptionFailedError(`no crypto module found for ${b}`);return u.log("encrypting outbound connection to %a using %s",u.remoteAddr,b),{...await w.secureOutbound(v,h),protocol:b}}catch(v){throw u.log.error("encrypting outbound connection to %a failed",u.remoteAddr,v),new EncryptionFailedError(v.message)}}async _multiplexOutbound(u,h,y){const v=Array.from(h.keys());u.log("outbound selecting muxer %s",v);try{u.log.trace("selecting stream muxer from %s",v);const{stream:b,protocol:w}=await select(u,v,{...y,log:u.log,yieldBytes:!0});u.log("selected %s as muxer protocol",w);const E=h.get(w);return{stream:b,muxerFactory:E}}catch(b){throw u.log.error("error multiplexing outbound connection",b),new MuxerUnavailableError(String(b))}}async _multiplexInbound(u,h,y){const v=Array.from(h.keys());u.log("inbound handling muxers %s",v);try{const{stream:b,protocol:w}=await handle(u,v,{...y,log:u.log}),E=h.get(w);return{stream:b,muxerFactory:E}}catch(b){throw u.log.error("error multiplexing inbound connection",b),new MuxerUnavailableError(String(b))}}getConnectionEncrypters(){return this.connectionEncrypters}getStreamMuxers(){return this.streamMuxers}}const version$3="2.10.0",name="js-libp2p";function userAgent(g,u){return`${g??name}/${u??version$3} browser/${globalThis.navigator.userAgent}`}class Libp2p extends TypedEventEmitter{peerId;peerStore;contentRouting;peerRouting;metrics;services;logger;status;components;log;constructor(u){super(),this.status="stopped";const h=new TypedEventEmitter,y=h.dispatchEvent.bind(h);h.dispatchEvent=S=>{const A=y(S),R=this.dispatchEvent(new CustomEvent(S.type,{detail:S.detail}));return A||R},this.peerId=u.peerId,this.logger=u.logger??defaultLogger(),this.log=this.logger.forComponent("libp2p"),this.services={};const v=u.nodeInfo?.name??name,b=u.nodeInfo?.version??version$3,w=this.components=defaultComponents({peerId:u.peerId,privateKey:u.privateKey,nodeInfo:{name:v,version:b,userAgent:u.nodeInfo?.userAgent??userAgent(v,b)},logger:this.logger,events:h,datastore:u.datastore??new MemoryDatastore,connectionGater:connectionGater(u.connectionGater),dns:u.dns});u.metrics!=null&&(this.metrics=this.configureComponent("metrics",u.metrics(this.components))),this.peerStore=this.configureComponent("peerStore",persistentPeerStore(w,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...u.peerStore})),w.events.addEventListener("peer:update",S=>{if(S.detail.previous==null){const A={id:S.detail.peer.id,multiaddrs:S.detail.peer.addresses.map(R=>R.multiaddr)};w.events.safeDispatchEvent("peer:discovery",{detail:A})}}),u.connectionProtector!=null&&this.configureComponent("connectionProtector",u.connectionProtector(w)),this.components.upgrader=new Upgrader(this.components,{connectionEncrypters:(u.connectionEncrypters??[]).map((S,A)=>this.configureComponent(`connection-encryption-${A}`,S(this.components))),streamMuxers:(u.streamMuxers??[]).map((S,A)=>this.configureComponent(`stream-muxers-${A}`,S(this.components))),inboundUpgradeTimeout:u.connectionManager?.inboundUpgradeTimeout,inboundStreamProtocolNegotiationTimeout:u.connectionManager?.inboundStreamProtocolNegotiationTimeout??u.connectionManager?.protocolNegotiationTimeout,outboundStreamProtocolNegotiationTimeout:u.connectionManager?.outboundStreamProtocolNegotiationTimeout??u.connectionManager?.protocolNegotiationTimeout}),this.configureComponent("transportManager",new DefaultTransportManager(this.components,u.transportManager)),this.configureComponent("connectionManager",new DefaultConnectionManager(this.components,u.connectionManager)),u.connectionMonitor?.enabled!==!1&&this.configureComponent("connectionMonitor",new ConnectionMonitor(this.components,u.connectionMonitor)),this.configureComponent("registrar",new Registrar(this.components)),this.configureComponent("addressManager",new AddressManager(this.components,u.addresses));const E=(u.peerRouters??[]).map((S,A)=>this.configureComponent(`peer-router-${A}`,S(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new DefaultPeerRouting(this.components,{routers:E}));const _=(u.contentRouters??[]).map((S,A)=>this.configureComponent(`content-router-${A}`,S(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new CompoundContentRouting(this.components,{routers:_})),this.configureComponent("randomWalk",new RandomWalk(this.components)),(u.peerDiscovery??[]).forEach((S,A)=>{this.configureComponent(`peer-discovery-${A}`,S(this.components)).addEventListener("peer",x=>{this.#e(x)})}),u.transports?.forEach((S,A)=>{this.components.transportManager.add(this.configureComponent(`transport-${A}`,S(this.components)))}),u.services!=null)for(const S of Object.keys(u.services)){const A=u.services[S],R=A(this.components);if(R==null){this.log.error("service factory %s returned null or undefined instance",S);continue}this.services[S]=R,this.configureComponent(S,R),R[contentRoutingSymbol]!=null&&(this.log("registering service %s for content routing",S),_.push(R[contentRoutingSymbol])),R[peerRoutingSymbol]!=null&&(this.log("registering service %s for peer routing",S),E.push(R[peerRoutingSymbol])),R[peerDiscoverySymbol]!=null&&(this.log("registering service %s for peer discovery",S),R[peerDiscoverySymbol].addEventListener?.("peer",x=>{this.#e(x)}))}checkServiceDependencies(w)}configureComponent(u,h){return h==null&&this.log.error("component %s was null or undefined",u),this.components[u]=h,h}async start(){if(this.status==="stopped"){this.status="starting",this.log("libp2p is starting");try{await this.components.beforeStart?.(),await this.components.start(),await this.components.afterStart?.(),this.status="started",this.safeDispatchEvent("start",{detail:this}),this.log("libp2p has started")}catch(u){throw this.log.error("An error occurred starting libp2p",u),this.status="started",await this.stop(),u}}}async stop(){this.status==="started"&&(this.log("libp2p is stopping"),this.status="stopping",await this.components.beforeStop?.(),await this.components.stop(),await this.components.afterStop?.(),this.status="stopped",this.safeDispatchEvent("stop",{detail:this}),this.log("libp2p has stopped"))}getConnections(u){return this.components.connectionManager.getConnections(u)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){const u=new PeerSet;for(const h of this.components.connectionManager.getConnections())u.add(h.remotePeer);return Array.from(u)}async dial(u,h={}){return this.components.connectionManager.openConnection(u,{priority:75,...h})}async dialProtocol(u,h,y={}){if(h==null)throw new InvalidParametersError$1("no protocols were provided to open a stream");if(h=Array.isArray(h)?h:[h],h.length===0)throw new InvalidParametersError$1("no protocols were provided to open a stream");return(await this.dial(u,y)).newStream(h,y)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(u,h={}){isMultiaddr(u)&&(u=peerIdFromString$1(u.getPeerId()??"")),await this.components.connectionManager.closeConnections(u,h)}async getPublicKey(u,h={}){if(this.log("getPublicKey %p",u),u.publicKey!=null)return u.publicKey;try{const w=await this.peerStore.get(u,h);if(w.id.publicKey!=null)return w.id.publicKey}catch(w){if(w.name!=="NotFoundError")throw w}const y=concat([fromString("/pk/"),u.toMultihash().bytes]),v=await this.contentRouting.get(y,h),b=publicKeyFromProtobuf(v);return await this.peerStore.patch(u,{publicKey:b},h),b}async handle(u,h,y){Array.isArray(u)||(u=[u]),await Promise.all(u.map(async v=>{await this.components.registrar.handle(v,h,y)}))}async unhandle(u,h){Array.isArray(u)||(u=[u]),await Promise.all(u.map(async y=>{await this.components.registrar.unhandle(y,h)}))}async register(u,h,y){return this.components.registrar.register(u,h,y)}unregister(u){this.components.registrar.unregister(u)}async isDialable(u,h={}){return this.components.connectionManager.isDialable(u,h)}#e(u){const{detail:h}=u;if(h.id.toString()===this.peerId.toString()){this.log.error("peer discovery mechanism discovered self");return}this.components.peerStore.merge(h.id,{multiaddrs:h.multiaddrs}).catch(y=>{this.log.error(y)})}}async function createLibp2p(g={}){g.privateKey??=await generateKeyPair();const u=new Libp2p({...await validateConfig(g),peerId:peerIdFromPrivateKey(g.privateKey)});return g.start!==!1&&await u.start(),u}class QueuelessPushable{readNext;haveNext;ended;nextResult;constructor(){this.ended=!1,this.readNext=pDefer(),this.haveNext=pDefer()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const u=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=pDefer(),u}async throw(u){return this.ended=!0,u!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(u)),{done:!0,value:void 0}}async return(){const u={done:!0,value:void 0};return this.ended=!0,this.nextResult=u,this.haveNext.resolve(),u}async push(u,h){await this._push(u,h)}async end(u,h){u!=null?await this.throw(u):await this._push(void 0,h)}async _push(u,h){if(u!=null&&this.ended)throw new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;u!=null?this.nextResult={done:!1,value:u}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=pDefer(),await raceSignal$1(this.readNext.promise,h?.signal,h)}}function queuelessPushable(){return new QueuelessPushable}class UnexpectedEOFError extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"}class CodeError extends Error{code;constructor(u,h){super(u),this.code=h}}class AbortError extends CodeError{type;constructor(u){super(u,"ABORT_ERR"),this.type="aborted",this.name="AbortError"}}function byteStream(g,u){const h=queuelessPushable();g.sink(h).catch(async w=>{await h.end(w)}),g.sink=async w=>{for await(const E of w)await h.push(E);await h.end()};let y=g.source;g.source[Symbol.iterator]!=null?y=g.source[Symbol.iterator]():g.source[Symbol.asyncIterator]!=null&&(y=g.source[Symbol.asyncIterator]());const v=new Uint8ArrayList;return{read:async(w,E)=>{E?.signal?.throwIfAborted();let _;const S=new Promise((A,R)=>{_=()=>{R(new AbortError("Read aborted"))},E?.signal?.addEventListener("abort",_)});try{if(w==null){const{done:R,value:x}=await Promise.race([y.next(),S]);return R===!0?new Uint8ArrayList:x}for(;v.byteLength<w;){const{value:R,done:x}=await Promise.race([y.next(),S]);if(x===!0)throw new UnexpectedEOFError("unexpected end of input");v.append(R)}const A=v.sublist(0,w);return v.consume(w),A}finally{_!=null&&E?.signal?.removeEventListener("abort",_)}},write:async(w,E)=>{E?.signal?.throwIfAborted(),w instanceof Uint8Array?await h.push(w,E):await h.push(w.subarray(),E)},unwrap:()=>{if(v.byteLength>0){const w=g.source;g.source=(async function*(){u?.yieldBytes===!1?yield v:yield*v,yield*w})()}return g}}}class InvalidMessageLengthError extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"}class InvalidDataLengthError extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"}class InvalidDataLengthLengthError extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"}function lpStream(g,u={}){const h=byteStream(g,u);u.maxDataLength!=null&&u.maxLengthLength==null&&(u.maxLengthLength=encodingLength(u.maxDataLength));const y=u?.lengthDecoder??decode$3,v=u?.lengthEncoder??encode$2;return{read:async w=>{let E=-1;const _=new Uint8ArrayList;for(;;){_.append(await h.read(1,w));try{E=y(_)}catch(S){if(S instanceof RangeError)continue;throw S}if(E<0)throw new InvalidMessageLengthError("Invalid message length");if(u?.maxLengthLength!=null&&_.byteLength>u.maxLengthLength)throw new InvalidDataLengthLengthError("message length length too long");if(E>-1)break}if(u?.maxDataLength!=null&&E>u.maxDataLength)throw new InvalidDataLengthError("message length too long");return h.read(E,w)},write:async(w,E)=>{await h.write(new Uint8ArrayList(v(w.byteLength),w),E)},writeV:async(w,E)=>{const _=new Uint8ArrayList(...w.flatMap(S=>[v(S.byteLength),S]));await h.write(_,E)},unwrap:()=>h.unwrap()}}function pbStream(g,u){const h=lpStream(g,u),y={read:async(v,b)=>{const w=await h.read(b);return v.decode(w)},write:async(v,b,w)=>{await h.write(b.encode(v),w)},writeV:async(v,b,w)=>{await h.writeV(v.map(E=>b.encode(E)),w)},pb:v=>({read:async b=>y.read(v,b),write:async(b,w)=>y.write(b,v,w),writeV:async(b,w)=>y.writeV(b,v,w),unwrap:()=>y}),unwrap:()=>h.unwrap()};return y}var EffectError;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.timestamp!=null&&h.timestamp!==0&&(y.uint32(8),y.uint32(h.timestamp)),h.message!=null&&h.message!==""&&(y.uint32(18),y.string(h.message)),h.code!=null&&h.code!==""&&(y.uint32(26),y.string(h.code)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={timestamp:0,message:"",code:""},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.timestamp=h.uint32();break}case 2:{b.message=h.string();break}case 3:{b.code=h.string();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(EffectError||(EffectError={}));var EffectAcknowledgment;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.timestamp!=null&&h.timestamp!==0&&(y.uint32(8),y.uint32(h.timestamp)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={timestamp:0},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.timestamp=h.uint32();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(EffectAcknowledgment||(EffectAcknowledgment={}));var EffectIdentifyRequest;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.timestamp!=null&&h.timestamp!==0&&(y.uint32(8),y.uint32(h.timestamp)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={timestamp:0},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.timestamp=h.uint32();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(EffectIdentifyRequest||(EffectIdentifyRequest={}));var EffectIdentifyResponse;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.name!=null&&(y.uint32(10),y.string(h.name)),h.version!=null&&h.version!==""&&(y.uint32(18),y.string(h.version)),h.peer!=null&&h.peer.byteLength>0&&(y.uint32(26),y.bytes(h.peer)),h.pubkey!=null&&h.pubkey!==""&&(y.uint32(34),y.string(h.pubkey)),h.batchSize!=null&&h.batchSize!==0&&(y.uint32(40),y.uint32(h.batchSize)),h.taskTimeout!=null&&h.taskTimeout!==0&&(y.uint32(48),y.uint32(h.taskTimeout)),h.requiresRegistration!=null&&h.requiresRegistration!==!1&&(y.uint32(56),y.bool(h.requiresRegistration)),h.isRegistered!=null&&h.isRegistered!==!1&&(y.uint32(64),y.bool(h.isRegistered)),h.isConnected!=null&&h.isConnected!==!1&&(y.uint32(72),y.bool(h.isConnected)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={version:"",peer:alloc$1(0),pubkey:"",batchSize:0,taskTimeout:0,requiresRegistration:!1,isRegistered:!1,isConnected:!1},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.name=h.string();break}case 2:{b.version=h.string();break}case 3:{b.peer=h.bytes();break}case 4:{b.pubkey=h.string();break}case 5:{b.batchSize=h.uint32();break}case 6:{b.taskTimeout=h.uint32();break}case 7:{b.requiresRegistration=h.bool();break}case 8:{b.isRegistered=h.bool();break}case 9:{b.isConnected=h.bool();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(EffectIdentifyResponse||(EffectIdentifyResponse={}));var RequestToWork;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.timestamp!=null&&h.timestamp!==0&&(y.uint32(8),y.uint32(h.timestamp)),h.recipient!=null&&h.recipient!==""&&(y.uint32(18),y.string(h.recipient)),h.nonce!=null&&h.nonce!==0n&&(y.uint32(24),y.uint64(h.nonce)),h.capabilities!=null&&h.capabilities!==""&&(y.uint32(34),y.string(h.capabilities)),h.accessCode!=null&&(y.uint32(42),y.string(h.accessCode)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={timestamp:0,recipient:"",nonce:0n,capabilities:""},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.timestamp=h.uint32();break}case 2:{b.recipient=h.string();break}case 3:{b.nonce=h.uint64();break}case 4:{b.capabilities=h.string();break}case 5:{b.accessCode=h.string();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(RequestToWork||(RequestToWork={}));var RequestToWorkResponse;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.timestamp!=null&&h.timestamp!==0&&(y.uint32(8),y.uint32(h.timestamp)),h.pubkey!=null&&h.pubkey!==""&&(y.uint32(18),y.string(h.pubkey)),h.peer!=null&&h.peer!==""&&(y.uint32(26),y.string(h.peer)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={timestamp:0,pubkey:"",peer:""},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.timestamp=h.uint32();break}case 2:{b.pubkey=h.string();break}case 3:{b.peer=h.string();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(RequestToWorkResponse||(RequestToWorkResponse={}));var EffectProtocolMessage;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h={...h},h.bulkProofRequest!=null&&(h.identifyResponse=void 0,h.identifyRequest=void 0,h.requestToWorkResponse=void 0,h.requestToWork=void 0,h.ack=void 0,h.error=void 0,h.templateResponse=void 0,h.templateRequest=void 0,h.proofResponse=void 0,h.proofRequest=void 0,h.payoutRequest=void 0,h.payment=void 0,h.taskCompleted=void 0,h.taskRejected=void 0,h.taskAccepted=void 0,h.task=void 0),h.identifyResponse!=null&&(h.bulkProofRequest=void 0,h.identifyRequest=void 0,h.requestToWorkResponse=void 0,h.requestToWork=void 0,h.ack=void 0,h.error=void 0,h.templateResponse=void 0,h.templateRequest=void 0,h.proofResponse=void 0,h.proofRequest=void 0,h.payoutRequest=void 0,h.payment=void 0,h.taskCompleted=void 0,h.taskRejected=void 0,h.taskAccepted=void 0,h.task=void 0),h.identifyRequest!=null&&(h.bulkProofRequest=void 0,h.identifyResponse=void 0,h.requestToWorkResponse=void 0,h.requestToWork=void 0,h.ack=void 0,h.error=void 0,h.templateResponse=void 0,h.templateRequest=void 0,h.proofResponse=void 0,h.proofRequest=void 0,h.payoutRequest=void 0,h.payment=void 0,h.taskCompleted=void 0,h.taskRejected=void 0,h.taskAccepted=void 0,h.task=void 0),h.requestToWorkResponse!=null&&(h.bulkProofRequest=void 0,h.identifyResponse=void 0,h.identifyRequest=void 0,h.requestToWork=void 0,h.ack=void 0,h.error=void 0,h.templateResponse=void 0,h.templateRequest=void 0,h.proofResponse=void 0,h.proofRequest=void 0,h.payoutRequest=void 0,h.payment=void 0,h.taskCompleted=void 0,h.taskRejected=void 0,h.taskAccepted=void 0,h.task=void 0),h.requestToWork!=null&&(h.bulkProofRequest=void 0,h.identifyResponse=void 0,h.identifyRequest=void 0,h.requestToWorkResponse=void 0,h.ack=void 0,h.error=void 0,h.templateResponse=void 0,h.templateRequest=void 0,h.proofResponse=void 0,h.proofRequest=void 0,h.payoutRequest=void 0,h.payment=void 0,h.taskCompleted=void 0,h.taskRejected=void 0,h.taskAccepted=void 0,h.task=void 0),h.ack!=null&&(h.bulkProofRequest=void 0,h.identifyResponse=void 0,h.identifyRequest=void 0,h.requestToWorkResponse=void 0,h.requestToWork=void 0,h.error=void 0,h.templateResponse=void 0,h.templateRequest=void 0,h.proofResponse=void 0,h.proofRequest=void 0,h.payoutRequest=void 0,h.payment=void 0,h.taskCompleted=void 0,h.taskRejected=void 0,h.taskAccepted=void 0,h.task=void 0),h.error!=null&&(h.bulkProofRequest=void 0,h.identifyResponse=void 0,h.identifyRequest=void 0,h.requestToWorkResponse=void 0,h.requestToWork=void 0,h.ack=void 0,h.templateResponse=void 0,h.templateRequest=void 0,h.proofResponse=void 0,h.proofRequest=void 0,h.payoutRequest=void 0,h.payment=void 0,h.taskCompleted=void 0,h.taskRejected=void 0,h.taskAccepted=void 0,h.task=void 0),h.templateResponse!=null&&(h.bulkProofRequest=void 0,h.identifyResponse=void 0,h.identifyRequest=void 0,h.requestToWorkResponse=void 0,h.requestToWork=void 0,h.ack=void 0,h.error=void 0,h.templateRequest=void 0,h.proofResponse=void 0,h.proofRequest=void 0,h.payoutRequest=void 0,h.payment=void 0,h.taskCompleted=void 0,h.taskRejected=void 0,h.taskAccepted=void 0,h.task=void 0),h.templateRequest!=null&&(h.bulkProofRequest=void 0,h.identifyResponse=void 0,h.identifyRequest=void 0,h.requestToWorkResponse=void 0,h.requestToWork=void 0,h.ack=void 0,h.error=void 0,h.templateResponse=void 0,h.proofResponse=void 0,h.proofRequest=void 0,h.payoutRequest=void 0,h.payment=void 0,h.taskCompleted=void 0,h.taskRejected=void 0,h.taskAccepted=void 0,h.task=void 0),h.proofResponse!=null&&(h.bulkProofRequest=void 0,h.identifyResponse=void 0,h.identifyRequest=void 0,h.requestToWorkResponse=void 0,h.requestToWork=void 0,h.ack=void 0,h.error=void 0,h.templateResponse=void 0,h.templateRequest=void 0,h.proofRequest=void 0,h.payoutRequest=void 0,h.payment=void 0,h.taskCompleted=void 0,h.taskRejected=void 0,h.taskAccepted=void 0,h.task=void 0),h.proofRequest!=null&&(h.bulkProofRequest=void 0,h.identifyResponse=void 0,h.identifyRequest=void 0,h.requestToWorkResponse=void 0,h.requestToWork=void 0,h.ack=void 0,h.error=void 0,h.templateResponse=void 0,h.templateRequest=void 0,h.proofResponse=void 0,h.payoutRequest=void 0,h.payment=void 0,h.taskCompleted=void 0,h.taskRejected=void 0,h.taskAccepted=void 0,h.task=void 0),h.payoutRequest!=null&&(h.bulkProofRequest=void 0,h.identifyResponse=void 0,h.identifyRequest=void 0,h.requestToWorkResponse=void 0,h.requestToWork=void 0,h.ack=void 0,h.error=void 0,h.templateResponse=void 0,h.templateRequest=void 0,h.proofResponse=void 0,h.proofRequest=void 0,h.payment=void 0,h.taskCompleted=void 0,h.taskRejected=void 0,h.taskAccepted=void 0,h.task=void 0),h.payment!=null&&(h.bulkProofRequest=void 0,h.identifyResponse=void 0,h.identifyRequest=void 0,h.requestToWorkResponse=void 0,h.requestToWork=void 0,h.ack=void 0,h.error=void 0,h.templateResponse=void 0,h.templateRequest=void 0,h.proofResponse=void 0,h.proofRequest=void 0,h.payoutRequest=void 0,h.taskCompleted=void 0,h.taskRejected=void 0,h.taskAccepted=void 0,h.task=void 0),h.taskCompleted!=null&&(h.bulkProofRequest=void 0,h.identifyResponse=void 0,h.identifyRequest=void 0,h.requestToWorkResponse=void 0,h.requestToWork=void 0,h.ack=void 0,h.error=void 0,h.templateResponse=void 0,h.templateRequest=void 0,h.proofResponse=void 0,h.proofRequest=void 0,h.payoutRequest=void 0,h.payment=void 0,h.taskRejected=void 0,h.taskAccepted=void 0,h.task=void 0),h.taskRejected!=null&&(h.bulkProofRequest=void 0,h.identifyResponse=void 0,h.identifyRequest=void 0,h.requestToWorkResponse=void 0,h.requestToWork=void 0,h.ack=void 0,h.error=void 0,h.templateResponse=void 0,h.templateRequest=void 0,h.proofResponse=void 0,h.proofRequest=void 0,h.payoutRequest=void 0,h.payment=void 0,h.taskCompleted=void 0,h.taskAccepted=void 0,h.task=void 0),h.taskAccepted!=null&&(h.bulkProofRequest=void 0,h.identifyResponse=void 0,h.identifyRequest=void 0,h.requestToWorkResponse=void 0,h.requestToWork=void 0,h.ack=void 0,h.error=void 0,h.templateResponse=void 0,h.templateRequest=void 0,h.proofResponse=void 0,h.proofRequest=void 0,h.payoutRequest=void 0,h.payment=void 0,h.taskCompleted=void 0,h.taskRejected=void 0,h.task=void 0),h.task!=null&&(h.bulkProofRequest=void 0,h.identifyResponse=void 0,h.identifyRequest=void 0,h.requestToWorkResponse=void 0,h.requestToWork=void 0,h.ack=void 0,h.error=void 0,h.templateResponse=void 0,h.templateRequest=void 0,h.proofResponse=void 0,h.proofRequest=void 0,h.payoutRequest=void 0,h.payment=void 0,h.taskCompleted=void 0,h.taskRejected=void 0,h.taskAccepted=void 0),h.task!=null&&(y.uint32(10),Task.codec().encode(h.task,y)),h.taskAccepted!=null&&(y.uint32(18),TaskAccepted.codec().encode(h.taskAccepted,y)),h.taskRejected!=null&&(y.uint32(26),TaskRejected.codec().encode(h.taskRejected,y)),h.taskCompleted!=null&&(y.uint32(34),TaskCompleted.codec().encode(h.taskCompleted,y)),h.payment!=null&&(y.uint32(42),Payment.codec().encode(h.payment,y)),h.payoutRequest!=null&&(y.uint32(50),PayoutRequest.codec().encode(h.payoutRequest,y)),h.proofRequest!=null&&(y.uint32(58),ProofRequest.codec().encode(h.proofRequest,y)),h.proofResponse!=null&&(y.uint32(66),ProofResponse.codec().encode(h.proofResponse,y)),h.templateRequest!=null&&(y.uint32(74),TemplateRequest.codec().encode(h.templateRequest,y)),h.templateResponse!=null&&(y.uint32(82),Template.codec().encode(h.templateResponse,y)),h.error!=null&&(y.uint32(90),EffectError.codec().encode(h.error,y)),h.ack!=null&&(y.uint32(98),EffectAcknowledgment.codec().encode(h.ack,y)),h.requestToWork!=null&&(y.uint32(106),RequestToWork.codec().encode(h.requestToWork,y)),h.requestToWorkResponse!=null&&(y.uint32(114),RequestToWorkResponse.codec().encode(h.requestToWorkResponse,y)),h.identifyRequest!=null&&(y.uint32(122),EffectIdentifyRequest.codec().encode(h.identifyRequest,y)),h.identifyResponse!=null&&(y.uint32(130),EffectIdentifyResponse.codec().encode(h.identifyResponse,y)),h.bulkProofRequest!=null&&(y.uint32(138),BulkProofRequest.codec().encode(h.bulkProofRequest,y)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.task=Task.codec().decode(h,h.uint32(),{limits:v.limits?.task});break}case 2:{b.taskAccepted=TaskAccepted.codec().decode(h,h.uint32(),{limits:v.limits?.taskAccepted});break}case 3:{b.taskRejected=TaskRejected.codec().decode(h,h.uint32(),{limits:v.limits?.taskRejected});break}case 4:{b.taskCompleted=TaskCompleted.codec().decode(h,h.uint32(),{limits:v.limits?.taskCompleted});break}case 5:{b.payment=Payment.codec().decode(h,h.uint32(),{limits:v.limits?.payment});break}case 6:{b.payoutRequest=PayoutRequest.codec().decode(h,h.uint32(),{limits:v.limits?.payoutRequest});break}case 7:{b.proofRequest=ProofRequest.codec().decode(h,h.uint32(),{limits:v.limits?.proofRequest});break}case 8:{b.proofResponse=ProofResponse.codec().decode(h,h.uint32(),{limits:v.limits?.proofResponse});break}case 9:{b.templateRequest=TemplateRequest.codec().decode(h,h.uint32(),{limits:v.limits?.templateRequest});break}case 10:{b.templateResponse=Template.codec().decode(h,h.uint32(),{limits:v.limits?.templateResponse});break}case 11:{b.error=EffectError.codec().decode(h,h.uint32(),{limits:v.limits?.error});break}case 12:{b.ack=EffectAcknowledgment.codec().decode(h,h.uint32(),{limits:v.limits?.ack});break}case 13:{b.requestToWork=RequestToWork.codec().decode(h,h.uint32(),{limits:v.limits?.requestToWork});break}case 14:{b.requestToWorkResponse=RequestToWorkResponse.codec().decode(h,h.uint32(),{limits:v.limits?.requestToWorkResponse});break}case 15:{b.identifyRequest=EffectIdentifyRequest.codec().decode(h,h.uint32(),{limits:v.limits?.identifyRequest});break}case 16:{b.identifyResponse=EffectIdentifyResponse.codec().decode(h,h.uint32(),{limits:v.limits?.identifyResponse});break}case 17:{b.bulkProofRequest=BulkProofRequest.codec().decode(h,h.uint32(),{limits:v.limits?.bulkProofRequest});break}default:{h.skipType(E&7);break}}}return b.bulkProofRequest!=null&&(delete b.identifyResponse,delete b.identifyRequest,delete b.requestToWorkResponse,delete b.requestToWork,delete b.ack,delete b.error,delete b.templateResponse,delete b.templateRequest,delete b.proofResponse,delete b.proofRequest,delete b.payoutRequest,delete b.payment,delete b.taskCompleted,delete b.taskRejected,delete b.taskAccepted,delete b.task),b.identifyResponse!=null&&(delete b.bulkProofRequest,delete b.identifyRequest,delete b.requestToWorkResponse,delete b.requestToWork,delete b.ack,delete b.error,delete b.templateResponse,delete b.templateRequest,delete b.proofResponse,delete b.proofRequest,delete b.payoutRequest,delete b.payment,delete b.taskCompleted,delete b.taskRejected,delete b.taskAccepted,delete b.task),b.identifyRequest!=null&&(delete b.bulkProofRequest,delete b.identifyResponse,delete b.requestToWorkResponse,delete b.requestToWork,delete b.ack,delete b.error,delete b.templateResponse,delete b.templateRequest,delete b.proofResponse,delete b.proofRequest,delete b.payoutRequest,delete b.payment,delete b.taskCompleted,delete b.taskRejected,delete b.taskAccepted,delete b.task),b.requestToWorkResponse!=null&&(delete b.bulkProofRequest,delete b.identifyResponse,delete b.identifyRequest,delete b.requestToWork,delete b.ack,delete b.error,delete b.templateResponse,delete b.templateRequest,delete b.proofResponse,delete b.proofRequest,delete b.payoutRequest,delete b.payment,delete b.taskCompleted,delete b.taskRejected,delete b.taskAccepted,delete b.task),b.requestToWork!=null&&(delete b.bulkProofRequest,delete b.identifyResponse,delete b.identifyRequest,delete b.requestToWorkResponse,delete b.ack,delete b.error,delete b.templateResponse,delete b.templateRequest,delete b.proofResponse,delete b.proofRequest,delete b.payoutRequest,delete b.payment,delete b.taskCompleted,delete b.taskRejected,delete b.taskAccepted,delete b.task),b.ack!=null&&(delete b.bulkProofRequest,delete b.identifyResponse,delete b.identifyRequest,delete b.requestToWorkResponse,delete b.requestToWork,delete b.error,delete b.templateResponse,delete b.templateRequest,delete b.proofResponse,delete b.proofRequest,delete b.payoutRequest,delete b.payment,delete b.taskCompleted,delete b.taskRejected,delete b.taskAccepted,delete b.task),b.error!=null&&(delete b.bulkProofRequest,delete b.identifyResponse,delete b.identifyRequest,delete b.requestToWorkResponse,delete b.requestToWork,delete b.ack,delete b.templateResponse,delete b.templateRequest,delete b.proofResponse,delete b.proofRequest,delete b.payoutRequest,delete b.payment,delete b.taskCompleted,delete b.taskRejected,delete b.taskAccepted,delete b.task),b.templateResponse!=null&&(delete b.bulkProofRequest,delete b.identifyResponse,delete b.identifyRequest,delete b.requestToWorkResponse,delete b.requestToWork,delete b.ack,delete b.error,delete b.templateRequest,delete b.proofResponse,delete b.proofRequest,delete b.payoutRequest,delete b.payment,delete b.taskCompleted,delete b.taskRejected,delete b.taskAccepted,delete b.task),b.templateRequest!=null&&(delete b.bulkProofRequest,delete b.identifyResponse,delete b.identifyRequest,delete b.requestToWorkResponse,delete b.requestToWork,delete b.ack,delete b.error,delete b.templateResponse,delete b.proofResponse,delete b.proofRequest,delete b.payoutRequest,delete b.payment,delete b.taskCompleted,delete b.taskRejected,delete b.taskAccepted,delete b.task),b.proofResponse!=null&&(delete b.bulkProofRequest,delete b.identifyResponse,delete b.identifyRequest,delete b.requestToWorkResponse,delete b.requestToWork,delete b.ack,delete b.error,delete b.templateResponse,delete b.templateRequest,delete b.proofRequest,delete b.payoutRequest,delete b.payment,delete b.taskCompleted,delete b.taskRejected,delete b.taskAccepted,delete b.task),b.proofRequest!=null&&(delete b.bulkProofRequest,delete b.identifyResponse,delete b.identifyRequest,delete b.requestToWorkResponse,delete b.requestToWork,delete b.ack,delete b.error,delete b.templateResponse,delete b.templateRequest,delete b.proofResponse,delete b.payoutRequest,delete b.payment,delete b.taskCompleted,delete b.taskRejected,delete b.taskAccepted,delete b.task),b.payoutRequest!=null&&(delete b.bulkProofRequest,delete b.identifyResponse,delete b.identifyRequest,delete b.requestToWorkResponse,delete b.requestToWork,delete b.ack,delete b.error,delete b.templateResponse,delete b.templateRequest,delete b.proofResponse,delete b.proofRequest,delete b.payment,delete b.taskCompleted,delete b.taskRejected,delete b.taskAccepted,delete b.task),b.payment!=null&&(delete b.bulkProofRequest,delete b.identifyResponse,delete b.identifyRequest,delete b.requestToWorkResponse,delete b.requestToWork,delete b.ack,delete b.error,delete b.templateResponse,delete b.templateRequest,delete b.proofResponse,delete b.proofRequest,delete b.payoutRequest,delete b.taskCompleted,delete b.taskRejected,delete b.taskAccepted,delete b.task),b.taskCompleted!=null&&(delete b.bulkProofRequest,delete b.identifyResponse,delete b.identifyRequest,delete b.requestToWorkResponse,delete b.requestToWork,delete b.ack,delete b.error,delete b.templateResponse,delete b.templateRequest,delete b.proofResponse,delete b.proofRequest,delete b.payoutRequest,delete b.payment,delete b.taskRejected,delete b.taskAccepted,delete b.task),b.taskRejected!=null&&(delete b.bulkProofRequest,delete b.identifyResponse,delete b.identifyRequest,delete b.requestToWorkResponse,delete b.requestToWork,delete b.ack,delete b.error,delete b.templateResponse,delete b.templateRequest,delete b.proofResponse,delete b.proofRequest,delete b.payoutRequest,delete b.payment,delete b.taskCompleted,delete b.taskAccepted,delete b.task),b.taskAccepted!=null&&(delete b.bulkProofRequest,delete b.identifyResponse,delete b.identifyRequest,delete b.requestToWorkResponse,delete b.requestToWork,delete b.ack,delete b.error,delete b.templateResponse,delete b.templateRequest,delete b.proofResponse,delete b.proofRequest,delete b.payoutRequest,delete b.payment,delete b.taskCompleted,delete b.taskRejected,delete b.task),b.task!=null&&(delete b.bulkProofRequest,delete b.identifyResponse,delete b.identifyRequest,delete b.requestToWorkResponse,delete b.requestToWork,delete b.ack,delete b.error,delete b.templateResponse,delete b.templateRequest,delete b.proofResponse,delete b.proofRequest,delete b.payoutRequest,delete b.payment,delete b.taskCompleted,delete b.taskRejected,delete b.taskAccepted),b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(EffectProtocolMessage||(EffectProtocolMessage={}));var PaymentMessage;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h={...h},h.payoutRequest!=null&&(h.proofResponse=void 0,h.proofRequest=void 0,h.payment=void 0),h.proofResponse!=null&&(h.payoutRequest=void 0,h.proofRequest=void 0,h.payment=void 0),h.proofRequest!=null&&(h.payoutRequest=void 0,h.proofResponse=void 0,h.payment=void 0),h.payment!=null&&(h.payoutRequest=void 0,h.proofResponse=void 0,h.proofRequest=void 0),h.payment!=null&&(y.uint32(10),Payment.codec().encode(h.payment,y)),h.proofRequest!=null&&(y.uint32(42),ProofRequest.codec().encode(h.proofRequest,y)),h.proofResponse!=null&&(y.uint32(50),ProofResponse.codec().encode(h.proofResponse,y)),h.payoutRequest!=null&&(y.uint32(58),PayoutRequest.codec().encode(h.payoutRequest,y)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.payment=Payment.codec().decode(h,h.uint32(),{limits:v.limits?.payment});break}case 5:{b.proofRequest=ProofRequest.codec().decode(h,h.uint32(),{limits:v.limits?.proofRequest});break}case 6:{b.proofResponse=ProofResponse.codec().decode(h,h.uint32(),{limits:v.limits?.proofResponse});break}case 7:{b.payoutRequest=PayoutRequest.codec().decode(h,h.uint32(),{limits:v.limits?.payoutRequest});break}default:{h.skipType(E&7);break}}}return b.payoutRequest!=null&&(delete b.proofResponse,delete b.proofRequest,delete b.payment),b.proofResponse!=null&&(delete b.payoutRequest,delete b.proofRequest,delete b.payment),b.proofRequest!=null&&(delete b.payoutRequest,delete b.proofResponse,delete b.payment),b.payment!=null&&(delete b.payoutRequest,delete b.proofResponse,delete b.proofRequest),b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(PaymentMessage||(PaymentMessage={}));var Payment;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.id!=null&&h.id!==""&&(y.uint32(10),y.string(h.id)),h.version!=null&&h.version!==0&&(y.uint32(16),y.uint32(h.version)),h.amount!=null&&h.amount!==0n&&(y.uint32(24),y.uint64(h.amount)),h.recipient!=null&&h.recipient!==""&&(y.uint32(34),y.string(h.recipient)),h.paymentAccount!=null&&h.paymentAccount!==""&&(y.uint32(42),y.string(h.paymentAccount)),h.nonce!=null&&h.nonce!==0n&&(y.uint32(48),y.uint64(h.nonce)),h.publicKey!=null&&h.publicKey!==""&&(y.uint32(58),y.string(h.publicKey)),h.signature!=null&&(y.uint32(66),PaymentSignature.codec().encode(h.signature,y)),h.label!=null&&(y.uint32(74),y.string(h.label)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={id:"",version:0,amount:0n,recipient:"",paymentAccount:"",nonce:0n,publicKey:""},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.id=h.string();break}case 2:{b.version=h.uint32();break}case 3:{b.amount=h.uint64();break}case 4:{b.recipient=h.string();break}case 5:{b.paymentAccount=h.string();break}case 6:{b.nonce=h.uint64();break}case 7:{b.publicKey=h.string();break}case 8:{b.signature=PaymentSignature.codec().decode(h,h.uint32(),{limits:v.limits?.signature});break}case 9:{b.label=h.string();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(Payment||(Payment={}));var Point;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.R8_1!=null&&h.R8_1!==""&&(y.uint32(10),y.string(h.R8_1)),h.R8_2!=null&&h.R8_2!==""&&(y.uint32(18),y.string(h.R8_2)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={R8_1:"",R8_2:""},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.R8_1=h.string();break}case 2:{b.R8_2=h.string();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(Point||(Point={}));var PaymentSignature;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.R8!=null&&(y.uint32(10),Point.codec().encode(h.R8,y)),h.S!=null&&h.S!==""&&(y.uint32(18),y.string(h.S)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={S:""},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.R8=Point.codec().decode(h,h.uint32(),{limits:v.limits?.R8});break}case 2:{b.S=h.string();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(PaymentSignature||(PaymentSignature={}));var Signals;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.minNonce!=null&&h.minNonce!==""&&(y.uint32(10),y.string(h.minNonce)),h.maxNonce!=null&&h.maxNonce!==""&&(y.uint32(18),y.string(h.maxNonce)),h.amount!=null&&h.amount!==""&&(y.uint32(26),y.string(h.amount)),h.recipient!=null&&h.recipient!==""&&(y.uint32(34),y.string(h.recipient)),h.paymentAccount!=null&&h.paymentAccount!==""&&(y.uint32(42),y.string(h.paymentAccount)),h.pubX!=null&&h.pubX!==""&&(y.uint32(50),y.string(h.pubX)),h.pubY!=null&&h.pubY!==""&&(y.uint32(58),y.string(h.pubY)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={minNonce:"",maxNonce:"",amount:"",recipient:"",paymentAccount:"",pubX:"",pubY:""},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.minNonce=h.string();break}case 2:{b.maxNonce=h.string();break}case 3:{b.amount=h.string();break}case 4:{b.recipient=h.string();break}case 5:{b.paymentAccount=h.string();break}case 6:{b.pubX=h.string();break}case 7:{b.pubY=h.string();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(Signals||(Signals={}));var ProofResponse;(function(g){(function(h){let y;h.codec=()=>(y==null&&(y=message((v,b,w={})=>{if(w.lengthDelimited!==!1&&b.fork(),v.row!=null)for(const E of v.row)b.uint32(10),b.string(E);w.lengthDelimited!==!1&&b.ldelim()},(v,b,w={})=>{const E={row:[]},_=b==null?v.len:v.pos+b;for(;v.pos<_;){const S=v.uint32();switch(S>>>3){case 1:{if(w.limits?.row!=null&&E.row.length===w.limits.row)throw new MaxLengthError('Decode error - map field "row" had too many elements');E.row.push(v.string());break}default:{v.skipType(S&7);break}}}return E})),y),h.encode=v=>encodeMessage(v,h.codec()),h.decode=(v,b)=>decodeMessage(v,h.codec(),b)})(g.Matrix||(g.Matrix={}));let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{if(v.lengthDelimited!==!1&&y.fork(),h.piA!=null)for(const b of h.piA)y.uint32(10),y.string(b);if(h.piB!=null)for(const b of h.piB)y.uint32(18),g.Matrix.codec().encode(b,y);if(h.piC!=null)for(const b of h.piC)y.uint32(26),y.string(b);h.protocol!=null&&h.protocol!==""&&(y.uint32(34),y.string(h.protocol)),h.curve!=null&&h.curve!==""&&(y.uint32(42),y.string(h.curve)),h.signals!=null&&(y.uint32(50),Signals.codec().encode(h.signals,y)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={piA:[],piB:[],piC:[],protocol:"",curve:""},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{if(v.limits?.piA!=null&&b.piA.length===v.limits.piA)throw new MaxLengthError('Decode error - map field "piA" had too many elements');b.piA.push(h.string());break}case 2:{if(v.limits?.piB!=null&&b.piB.length===v.limits.piB)throw new MaxLengthError('Decode error - map field "piB" had too many elements');b.piB.push(g.Matrix.codec().decode(h,h.uint32(),{limits:v.limits?.piB$}));break}case 3:{if(v.limits?.piC!=null&&b.piC.length===v.limits.piC)throw new MaxLengthError('Decode error - map field "piC" had too many elements');b.piC.push(h.string());break}case 4:{b.protocol=h.string();break}case 5:{b.curve=h.string();break}case 6:{b.signals=Signals.codec().decode(h,h.uint32(),{limits:v.limits?.signals});break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(ProofResponse||(ProofResponse={}));var BulkProofRequest;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{if(v.lengthDelimited!==!1&&y.fork(),h.recipient!=null&&h.recipient!==""&&(y.uint32(10),y.string(h.recipient)),h.paymentAccount!=null&&h.paymentAccount!==""&&(y.uint32(18),y.string(h.paymentAccount)),h.proofs!=null)for(const b of h.proofs)y.uint32(26),ProofResponse.codec().encode(b,y);v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={recipient:"",paymentAccount:"",proofs:[]},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.recipient=h.string();break}case 2:{b.paymentAccount=h.string();break}case 3:{if(v.limits?.proofs!=null&&b.proofs.length===v.limits.proofs)throw new MaxLengthError('Decode error - map field "proofs" had too many elements');b.proofs.push(ProofResponse.codec().decode(h,h.uint32(),{limits:v.limits?.proofs$}));break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(BulkProofRequest||(BulkProofRequest={}));var ProofRequest;(function(g){(function(h){let y;h.codec=()=>(y==null&&(y=message((v,b,w={})=>{w.lengthDelimited!==!1&&b.fork(),v.signature!=null&&(b.uint32(10),PaymentSignature.codec().encode(v.signature,b)),v.amount!=null&&v.amount!==0n&&(b.uint32(16),b.uint64(v.amount)),v.nonce!=null&&v.nonce!==0n&&(b.uint32(24),b.uint64(v.nonce)),w.lengthDelimited!==!1&&b.ldelim()},(v,b,w={})=>{const E={amount:0n,nonce:0n},_=b==null?v.len:v.pos+b;for(;v.pos<_;){const S=v.uint32();switch(S>>>3){case 1:{E.signature=PaymentSignature.codec().decode(v,v.uint32(),{limits:w.limits?.signature});break}case 2:{E.amount=v.uint64();break}case 3:{E.nonce=v.uint64();break}default:{v.skipType(S&7);break}}}return E})),y),h.encode=v=>encodeMessage(v,h.codec()),h.decode=(v,b)=>decodeMessage(v,h.codec(),b)})(g.PaymentProof||(g.PaymentProof={}));let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{if(v.lengthDelimited!==!1&&y.fork(),h.recipient!=null&&h.recipient!==""&&(y.uint32(10),y.string(h.recipient)),h.paymentAccount!=null&&h.paymentAccount!==""&&(y.uint32(18),y.string(h.paymentAccount)),h.publicKey!=null&&h.publicKey!==""&&(y.uint32(26),y.string(h.publicKey)),h.payments!=null)for(const b of h.payments)y.uint32(34),g.PaymentProof.codec().encode(b,y);v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={recipient:"",paymentAccount:"",publicKey:"",payments:[]},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.recipient=h.string();break}case 2:{b.paymentAccount=h.string();break}case 3:{b.publicKey=h.string();break}case 4:{if(v.limits?.payments!=null&&b.payments.length===v.limits.payments)throw new MaxLengthError('Decode error - map field "payments" had too many elements');b.payments.push(g.PaymentProof.codec().decode(h,h.uint32(),{limits:v.limits?.payments$}));break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(ProofRequest||(ProofRequest={}));var PayoutRequest;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.peerId!=null&&h.peerId!==""&&(y.uint32(10),y.string(h.peerId)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={peerId:""},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.peerId=h.string();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(PayoutRequest||(PayoutRequest={}));var TaskMessage;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h={...h},h.template!=null&&(h.taskCompleted=void 0,h.taskRejected=void 0,h.taskAccepted=void 0,h.task=void 0),h.taskCompleted!=null&&(h.template=void 0,h.taskRejected=void 0,h.taskAccepted=void 0,h.task=void 0),h.taskRejected!=null&&(h.template=void 0,h.taskCompleted=void 0,h.taskAccepted=void 0,h.task=void 0),h.taskAccepted!=null&&(h.template=void 0,h.taskCompleted=void 0,h.taskRejected=void 0,h.task=void 0),h.task!=null&&(h.template=void 0,h.taskCompleted=void 0,h.taskRejected=void 0,h.taskAccepted=void 0),h.taskId!=null&&h.taskId!==""&&(y.uint32(10),y.string(h.taskId)),h.task!=null&&(y.uint32(18),Task.codec().encode(h.task,y)),h.taskAccepted!=null&&(y.uint32(26),TaskAccepted.codec().encode(h.taskAccepted,y)),h.taskRejected!=null&&(y.uint32(34),TaskRejected.codec().encode(h.taskRejected,y)),h.taskCompleted!=null&&(y.uint32(42),TaskCompleted.codec().encode(h.taskCompleted,y)),h.template!=null&&(y.uint32(50),Template.codec().encode(h.template,y)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={taskId:""},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.taskId=h.string();break}case 2:{b.task=Task.codec().decode(h,h.uint32(),{limits:v.limits?.task});break}case 3:{b.taskAccepted=TaskAccepted.codec().decode(h,h.uint32(),{limits:v.limits?.taskAccepted});break}case 4:{b.taskRejected=TaskRejected.codec().decode(h,h.uint32(),{limits:v.limits?.taskRejected});break}case 5:{b.taskCompleted=TaskCompleted.codec().decode(h,h.uint32(),{limits:v.limits?.taskCompleted});break}case 6:{b.template=Template.codec().decode(h,h.uint32(),{limits:v.limits?.template});break}default:{h.skipType(E&7);break}}}return b.template!=null&&(delete b.taskCompleted,delete b.taskRejected,delete b.taskAccepted,delete b.task),b.taskCompleted!=null&&(delete b.template,delete b.taskRejected,delete b.taskAccepted,delete b.task),b.taskRejected!=null&&(delete b.template,delete b.taskCompleted,delete b.taskAccepted,delete b.task),b.taskAccepted!=null&&(delete b.template,delete b.taskCompleted,delete b.taskRejected,delete b.task),b.task!=null&&(delete b.template,delete b.taskCompleted,delete b.taskRejected,delete b.taskAccepted),b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(TaskMessage||(TaskMessage={}));var TaskStatus;(function(g){g.PENDING="PENDING",g.ASSIGNED="ASSIGNED",g.ACCEPTED="ACCEPTED",g.REJECTED="REJECTED",g.COMPLETED="COMPLETED"})(TaskStatus||(TaskStatus={}));var __TaskStatusValues;(function(g){g[g.PENDING=0]="PENDING",g[g.ASSIGNED=1]="ASSIGNED",g[g.ACCEPTED=2]="ACCEPTED",g[g.REJECTED=3]="REJECTED",g[g.COMPLETED=4]="COMPLETED"})(__TaskStatusValues||(__TaskStatusValues={}));(function(g){g.codec=()=>enumeration(__TaskStatusValues)})(TaskStatus||(TaskStatus={}));var Task;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.id!=null&&h.id!==""&&(y.uint32(10),y.string(h.id)),h.title!=null&&h.title!==""&&(y.uint32(18),y.string(h.title)),h.reward!=null&&h.reward!==0n&&(y.uint32(24),y.uint64(h.reward)),h.timeLimitSeconds!=null&&h.timeLimitSeconds!==0&&(y.uint32(32),y.uint32(h.timeLimitSeconds)),h.templateId!=null&&h.templateId!==""&&(y.uint32(42),y.string(h.templateId)),h.templateData!=null&&h.templateData!==""&&(y.uint32(50),y.string(h.templateData)),h.capability!=null&&(y.uint32(58),y.string(h.capability)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={id:"",title:"",reward:0n,timeLimitSeconds:0,templateId:"",templateData:""},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.id=h.string();break}case 2:{b.title=h.string();break}case 3:{b.reward=h.uint64();break}case 4:{b.timeLimitSeconds=h.uint32();break}case 5:{b.templateId=h.string();break}case 6:{b.templateData=h.string();break}case 7:{b.capability=h.string();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(Task||(Task={}));var TaskAssignment;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.peerId!=null&&h.peerId!==""&&(y.uint32(10),y.string(h.peerId)),h.assignedAt!=null&&(y.uint32(16),y.uint32(h.assignedAt)),h.acceptedAt!=null&&(y.uint32(24),y.uint32(h.acceptedAt)),h.completedAt!=null&&(y.uint32(32),y.uint32(h.completedAt)),h.rejectedAt!=null&&(y.uint32(40),y.uint32(h.rejectedAt)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={peerId:""},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.peerId=h.string();break}case 2:{b.assignedAt=h.uint32();break}case 3:{b.acceptedAt=h.uint32();break}case 4:{b.completedAt=h.uint32();break}case 5:{b.rejectedAt=h.uint32();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(TaskAssignment||(TaskAssignment={}));var TaskAccepted;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.taskId!=null&&h.taskId!==""&&(y.uint32(10),y.string(h.taskId)),h.worker!=null&&h.worker!==""&&(y.uint32(18),y.string(h.worker)),h.timestamp!=null&&h.timestamp!==0&&(y.uint32(24),y.uint32(h.timestamp)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={taskId:"",worker:"",timestamp:0},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.taskId=h.string();break}case 2:{b.worker=h.string();break}case 3:{b.timestamp=h.uint32();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(TaskAccepted||(TaskAccepted={}));var TaskRejected;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.taskId!=null&&h.taskId!==""&&(y.uint32(10),y.string(h.taskId)),h.worker!=null&&h.worker!==""&&(y.uint32(18),y.string(h.worker)),h.reason!=null&&h.reason!==""&&(y.uint32(26),y.string(h.reason)),h.timestamp!=null&&h.timestamp!==0&&(y.uint32(32),y.uint32(h.timestamp)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={taskId:"",worker:"",reason:"",timestamp:0},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.taskId=h.string();break}case 2:{b.worker=h.string();break}case 3:{b.reason=h.string();break}case 4:{b.timestamp=h.uint32();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(TaskRejected||(TaskRejected={}));var TaskCompleted;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.taskId!=null&&h.taskId!==""&&(y.uint32(10),y.string(h.taskId)),h.worker!=null&&h.worker!==""&&(y.uint32(18),y.string(h.worker)),h.result!=null&&h.result!==""&&(y.uint32(26),y.string(h.result)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={taskId:"",worker:"",result:""},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.taskId=h.string();break}case 2:{b.worker=h.string();break}case 3:{b.result=h.string();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(TaskCompleted||(TaskCompleted={}));var TemplateRequest;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.templateId!=null&&h.templateId!==""&&(y.uint32(10),y.string(h.templateId)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={templateId:""},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.templateId=h.string();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(TemplateRequest||(TemplateRequest={}));var Template;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.templateId!=null&&h.templateId!==""&&(y.uint32(10),y.string(h.templateId)),h.title!=null&&(y.uint32(18),y.string(h.title)),h.description!=null&&(y.uint32(26),y.string(h.description)),h.createdAt!=null&&h.createdAt!==0&&(y.uint32(32),y.uint32(h.createdAt)),h.data!=null&&h.data!==""&&(y.uint32(42),y.string(h.data)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={templateId:"",createdAt:0,data:""},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.templateId=h.string();break}case 2:{b.title=h.string();break}case 3:{b.description=h.string();break}case 4:{b.createdAt=h.uint32();break}case 5:{b.data=h.string();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(Template||(Template={}));var DEFAULT_LIBP2P_OPTIONS={autoStart:!0,bootstrap:[]},Libp2pTransport=class{constructor(g){this.options=g,this.options={...DEFAULT_LIBP2P_OPTIONS,...g}}#e=null;#t=null;messageHandlers=new Map;get libp2p(){if(!this.#t)throw new Error("Libp2p node is not initialized");return this.#t}get entity(){if(!this.#e)throw new Error("Entity not initialized");return this.#e}async initialize(g){this.#e=g,this.#t=await this.createLibp2pNode(),this.setupProtocolHandler()}getMethods(){return{sendMessage:this.sendMessage.bind(this),onMessage:this.onMessage.bind(this),getPeerId:()=>this.libp2p.peerId,getMultiAddress:()=>this.libp2p.getMultiaddrs(),connect:g=>this.libp2p.dial(g),node:this.libp2p}}async start(){await this.libp2p.start()}async stop(){await this.libp2p.stop()}async createLibp2pNode(){return createLibp2p({start:this.options.autoStart,...this.options.privateKey&&{privateKey:this.options.privateKey},addresses:{listen:this.options.listen||[],announce:this.options.announce||[]},connectionGater:{denyDialMultiaddr:async()=>!1,denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1},connectionManager:{maxConnections:1e3,maxParallelDials:100,dialTimeout:3e4,inboundStreamProtocolNegotiationTimeout:1e4,inboundUpgradeTimeout:1e4,outboundStreamProtocolNegotiationTimeout:1e4,outboundUpgradeTimeout:1e4},transports:this.options.transports,streamMuxers:[yamux()],connectionEncrypters:[noise()],datastore:this.options.datastore,services:{ping:ping(),identify:identify(),...this.options.services}})}setupProtocolHandler(){this.libp2p.handle(`/${this.entity.protocol.name}/${this.entity.protocol.version}`,async({stream:g,connection:u})=>{await this.handleIncomingStream(g,u)},{runOnLimitedConnection:!1,maxInboundStreams:1e3,maxOutboundStreams:1e3})}async handleIncomingStream(g,u){const h=pbStream(g).pb(this.entity.protocol.scheme);try{const y=await this.readMessage(h);if(!y)return;const v=await this.processIncomingMessage(y,u);await this.sendResponse(h,v)}catch(y){await this.sendErrorResponse(h,y)}finally{await g.close()}}async readMessage(g){try{return await g.read()}catch(u){return console.error("Failed to read message:",u),null}}async processIncomingMessage(g,u){const{type:h,payload:y}=extractMessageType(g),v=this.messageHandlers.get(h);if(!v)return console.error("No handler for message type:",h),null;try{return await v(y,{peerId:u.remotePeer,connection:u})||null}catch(b){throw console.error(`Handler failed for ${h}`),b}}async sendResponse(g,u){await g.write(u||this.createAckMessage())}createAckMessage(){return{ack:{timestamp:Math.floor(Date.now()/1e3)}}}async sendErrorResponse(g,u){try{await g.write({error:{timestamp:Math.floor(Date.now()/1e3),code:"500",message:u instanceof EffectProtocolError?u.message:"Internal server error"}})}catch(h){console.error("Failed to send error response:",h)}}onMessage(g,u){if(this.messageHandlers.has(g))throw new Error(`Handler for ${g} already exists`);if(!this.entity)throw new Error("Entity not initialized");return this.messageHandlers.set(g,u),this.entity}async sendMessage(g,u,h={}){const{timeout:y=1e4,existingStream:v}=h,b=shouldExpectResponse(u);let w,E=!1;try{const _=await this.prepareStream(g,v);w=_.stream,E=_.shouldClose;const S=pbStream(w).pb(EffectProtocolMessage);if(await S.write(u),!b)return[null,new EffectProtocolError("UNEXPECTED_RESPONSE","Received response for fire-and-forget message")];const A=await this.readResponseWithTimeout(S,y);if(A.error)return[null,new EffectProtocolError(A.error.code,A.error.message)];const{payload:R}=extractMessageType(A);return[R,null]}catch(_){return console.error("Failed to send message:",_),_ instanceof EffectProtocolError?[null,_]:_ instanceof Error?[null,_ instanceof EffectProtocolError?_:new EffectProtocolError("NETWORK_ERROR",_.message)]:[null,new EffectProtocolError("UNKNOWN_ERROR","Unknown error")]}finally{if(E&&w)try{await w.close()}catch(_){console.warn("Failed to close stream:",_)}}}async prepareStream(g,u){if(u)return{stream:u,shouldClose:!1};if(isMultiaddr(g))return{stream:await(await this.libp2p.dial(g)).newStream(`/${this.entity.protocol.name}/${this.entity.protocol.version}`),shouldClose:!0};let h=this.libp2p.getConnections(g)[0];return h||(h=await this.libp2p.dial(g)),{stream:await h.newStream(`/${this.entity.protocol.name}/${this.entity.protocol.version}`),shouldClose:!0}}async readResponseWithTimeout(g,u){return Promise.race([g.read(),new Promise((h,y)=>setTimeout(()=>y(new Error("Response timeout")),u))])}},createEntityStore=({datastore:g,defaultPrefix:u="entities",parse:h=JSON.parse,stringify:y=JSON.stringify})=>{const v=I=>new Key(`/${u}/${I}`),b=async({entityId:I})=>g.has(v(I)),w=async({entityId:I})=>{const L=await g.get(v(I));return h(new TextDecoder().decode(L))},E=async({entityId:I})=>{try{return await w({entityId:I})}catch(L){if(L instanceof Error&&L?.message?.includes("NotFound"))return null;throw console.error(`Error getting entity ${I}:`,L),L}},_=async({entityId:I,record:L})=>{const $=y(L),B=new TextEncoder().encode($);return g.put(v(I),B)};return{has:b,get:w,put:_,delete:async({entityId:I})=>{await g.delete(v(I))},all:async({filters:I=void 0,limit:L=void 0,offset:$=void 0,prefix:B=u}={})=>{const U=[];for await(const z of g.query({limit:L,filters:I,offset:$,prefix:`/${B}/`}))U.push(h(new TextDecoder().decode(z.value)));return U},rollback:async({entityId:I})=>{const L=await w({entityId:I});if(L.events.length===0)throw new Error("No events to rollback");L.events.pop(),await _({entityId:I,record:L})},rollbackEvent:async({entityId:I,eventType:L})=>{const $=await w({entityId:I}),B=$.events.findIndex(U=>U.type===L);if(B===-1)throw new Error("Event not found");B===$.events.length-1&&($.events.splice(B,1),await _({entityId:I,record:$}))},datastore:g,getSafe:E,getMany:async({keys:I})=>{try{const L=g.getMany(I),$=[];for await(const B of L)B.value&&$.push(h(new TextDecoder().decode(B.value)));return $}catch(L){throw L instanceof NotFoundError$1?console.error("Entity not found"):console.error("Error getting entity",L),L}},paginatedQuery:async({prefix:I,page:L,perPage:$=25,orders:B})=>{const U={prefix:I,offset:(L-1)*$,limit:$,orders:B},z=[];for await(const Y of g.query(U))z.push(Y);let ne=0;const ue={prefix:I};for await(const Y of g.queryKeys(ue))ne++;return{items:z.map(Y=>{try{return h(new TextDecoder().decode(Y.value))}catch(X){return console.error("Failed to parse task",X),null}}).filter(Boolean),total:ne,page:L,perPage:$,hasNext:L*$<ne,hasPrevious:L>1}}}};const ENCODING="0123456789ABCDEFGHJKMNPQRSTVWXYZ",ENCODING_LEN=32,RANDOM_LEN=16,TIME_LEN=10,TIME_MAX=0xffffffffffff;var ULIDErrorCode;(function(g){g.Base32IncorrectEncoding="B32_ENC_INVALID",g.DecodeTimeInvalidCharacter="DEC_TIME_CHAR",g.DecodeTimeValueMalformed="DEC_TIME_MALFORMED",g.EncodeTimeNegative="ENC_TIME_NEG",g.EncodeTimeSizeExceeded="ENC_TIME_SIZE_EXCEED",g.EncodeTimeValueMalformed="ENC_TIME_MALFORMED",g.PRNGDetectFailure="PRNG_DETECT",g.ULIDInvalid="ULID_INVALID",g.Unexpected="UNEXPECTED",g.UUIDInvalid="UUID_INVALID"})(ULIDErrorCode||(ULIDErrorCode={}));class ULIDError extends Error{constructor(u,h){super(`${h} (${u})`),this.name="ULIDError",this.code=u}}function decodeTime(g){if(g.length!==TIME_LEN+RANDOM_LEN)throw new ULIDError(ULIDErrorCode.DecodeTimeValueMalformed,"Malformed ULID");const u=g.substr(0,TIME_LEN).toUpperCase().split("").reverse().reduce((h,y,v)=>{const b=ENCODING.indexOf(y);if(b===-1)throw new ULIDError(ULIDErrorCode.DecodeTimeInvalidCharacter,`Time decode error: Invalid character: ${y}`);return h+=b*Math.pow(ENCODING_LEN,v)},0);if(u>TIME_MAX)throw new ULIDError(ULIDErrorCode.DecodeTimeValueMalformed,`Malformed ULID: timestamp too large: ${u}`);return u}function isValid(g){return typeof g=="string"&&g.length===TIME_LEN+RANDOM_LEN&&g.toUpperCase().split("").every(u=>ENCODING.indexOf(u)!==-1)}var parsePaymentRecord=g=>{const u=parseWithBigInt(g);return{events:u.events,state:{...u.state}}},createPaymentStore=({datastore:g})=>{const u=createEntityStore({datastore:g,defaultPrefix:"payments",stringify:_=>stringifyWithBigInt(_),parse:_=>parsePaymentRecord(_)}),h=async({peerId:_})=>{let S=0;for await(const A of g.query({prefix:`/payments/${_}/`}))S+=Number.parseFloat(parsePaymentRecord(new TextDecoder().decode(A.value)).state.amount.toString());return S},y=async({peerId:_,publicKey:S,recipient:A,nonce:R})=>{const x=[];for await(const T of g.query({prefix:`/payments/${_}/${S}/${A}/`,filters:[C=>{const I=C.key.toString().split("/"),L=I[I.length-1];return Number.parseInt(L,10)>=R}]}))x.push(parsePaymentRecord(new TextDecoder().decode(T.value)));return x},v=async({peerId:_,recipient:S,managerPublicKey:A})=>{const R=`/payments/${_}/${A}/${S}/`,x=I=>{const L=I.toString().split("/"),$=L[L.length-1];return BigInt($)},T=(I,L)=>{const $=x(I),B=x(L);return $>B?-1:$<B?1:0};let C=0n;for await(const I of g.queryKeys({prefix:R,orders:[T]}))return x(I);return C},b=(_,S)=>{if(!S.signature||!S.signature.R8)throw new Error("Payment signature is required");return`${_}/${S.publicKey}/${S.recipient}/${S.nonce}`};return{...u,create:async({peerId:_,payment:S})=>{const A={events:[{timestamp:Math.floor(Date.now()/1e3),type:"create"}],state:S};if(!isValid(S.id))throw new Error("Payment id is not a valid ulid");const R=b(_,S);return await u.put({entityId:R,record:A}),A},getHighestNonce:v,getFrom:y,countAmount:h,getPaginatedPayments:async({perPage:_,page:S,prefix:A})=>await u.paginatedQuery({prefix:A,page:S,perPage:_})}},createTemplateStore=({datastore:g})=>{const u=createEntityStore({datastore:g,defaultPrefix:"templates",stringify:y=>JSON.stringify(y),parse:y=>JSON.parse(y)});return{...u,create:async({template:y,createdByPeer:v})=>{const b={events:[{timestamp:Math.floor(Date.now()/1e3),type:"create",createdByPeer:v}],state:y};return await u.put({entityId:y.templateId,record:b}),b}}},TASK_ACCEPTANCE_TIME=1e3*60*10,PROTOCOL_NAME="effectai",PROTOCOL_VERSION="0.0.2",browser$e={exports:{}},quickFormatUnescaped,hasRequiredQuickFormatUnescaped;function requireQuickFormatUnescaped(){if(hasRequiredQuickFormatUnescaped)return quickFormatUnescaped;hasRequiredQuickFormatUnescaped=1;function g(h){try{return JSON.stringify(h)}catch{return'"[Circular]"'}}quickFormatUnescaped=u;function u(h,y,v){var b=v&&v.stringify||g,w=1;if(typeof h=="object"&&h!==null){var E=y.length+w;if(E===1)return h;var _=new Array(E);_[0]=b(h);for(var S=1;S<E;S++)_[S]=b(y[S]);return _.join(" ")}if(typeof h!="string")return h;var A=y.length;if(A===0)return h;for(var R="",x=1-w,T=-1,C=h&&h.length||0,I=0;I<C;){if(h.charCodeAt(I)===37&&I+1<C){switch(T=T>-1?T:0,h.charCodeAt(I+1)){case 100:case 102:if(x>=A||y[x]==null)break;T<I&&(R+=h.slice(T,I)),R+=Number(y[x]),T=I+2,I++;break;case 105:if(x>=A||y[x]==null)break;T<I&&(R+=h.slice(T,I)),R+=Math.floor(Number(y[x])),T=I+2,I++;break;case 79:case 111:case 106:if(x>=A||y[x]===void 0)break;T<I&&(R+=h.slice(T,I));var L=typeof y[x];if(L==="string"){R+="'"+y[x]+"'",T=I+2,I++;break}if(L==="function"){R+=y[x].name||"<anonymous>",T=I+2,I++;break}R+=b(y[x]),T=I+2,I++;break;case 115:if(x>=A)break;T<I&&(R+=h.slice(T,I)),R+=String(y[x]),T=I+2,I++;break;case 37:T<I&&(R+=h.slice(T,I)),R+="%",T=I+2,I++,x--;break}++x}++I}return T===-1?h:(T<C&&(R+=h.slice(T)),R)}return quickFormatUnescaped}var hasRequiredBrowser$d;function requireBrowser$d(){if(hasRequiredBrowser$d)return browser$e.exports;hasRequiredBrowser$d=1;const g=requireQuickFormatUnescaped();browser$e.exports=A;const u=P().console||{},h={mapHttpRequest:he,mapHttpResponse:he,wrapRequestSerializer:Y,wrapResponseSerializer:Y,wrapErrorSerializer:Y,req:he,res:he,err:ne,errWithCause:ne};function y(O,k){return O==="silent"?1/0:k.levels.values[O]}const v=Symbol("pino.logFuncs"),b=Symbol("pino.hierarchy"),w={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function E(O,k){const q={logger:k,parent:O[b]};k[b]=q}function _(O,k,q){const F={};k.forEach(H=>{F[H]=q[H]?q[H]:u[H]||u[w[H]||"log"]||X}),O[v]=F}function S(O,k){return Array.isArray(O)?O.filter(function(F){return F!=="!stdSerializers.err"}):O===!0?Object.keys(k):!1}function A(O){O=O||{},O.browser=O.browser||{};const k=O.browser.transmit;if(k&&typeof k.send!="function")throw Error("pino: transmit option must have a send function");const q=O.browser.write||u;O.browser.write&&(O.browser.asObject=!0);const F=O.serializers||{},H=S(O.browser.serialize,F);let D=O.browser.serialize;Array.isArray(O.browser.serialize)&&O.browser.serialize.indexOf("!stdSerializers.err")>-1&&(D=!1);const G=Object.keys(O.customLevels||{}),W=["error","fatal","warn","info","debug","trace"].concat(G);typeof q=="function"&&W.forEach(function(Ee){q[Ee]=q}),(O.enabled===!1||O.browser.disabled)&&(O.level="silent");const K=O.level||"info",Z=Object.create(q);Z.log||(Z.log=X),_(Z,W,q),E({},Z),Object.defineProperty(Z,"levelVal",{get:le}),Object.defineProperty(Z,"level",{get:te,set:ce});const ae={transmit:k,serialize:H,asObject:O.browser.asObject,formatters:O.browser.formatters,levels:W,timestamp:ue(O),messageKey:O.messageKey||"msg",onChild:O.onChild||X};Z.levels=R(O),Z.level=K,Z.setMaxListeners=Z.getMaxListeners=Z.emit=Z.addListener=Z.on=Z.prependListener=Z.once=Z.prependOnceListener=Z.removeListener=Z.removeAllListeners=Z.listeners=Z.listenerCount=Z.eventNames=Z.write=Z.flush=X,Z.serializers=F,Z._serialize=H,Z._stdErrSerialize=D,Z.child=function(...Ee){return ge.call(this,ae,...Ee)},k&&(Z._logEvent=z());function le(){return y(this.level,this)}function te(){return this._level}function ce(Ee){if(Ee!=="silent"&&!this.levels.values[Ee])throw Error("unknown level "+Ee);this._level=Ee,C(this,ae,Z,"error"),C(this,ae,Z,"fatal"),C(this,ae,Z,"warn"),C(this,ae,Z,"info"),C(this,ae,Z,"debug"),C(this,ae,Z,"trace"),G.forEach(pe=>{C(this,ae,Z,pe)})}function ge(Ee,pe,de){if(!pe)throw new Error("missing bindings for child Pino");de=de||{},H&&pe.serializers&&(de.serializers=pe.serializers);const me=de.serializers;if(H&&me){var _e=Object.assign({},F,me),Ae=O.browser.serialize===!0?Object.keys(_e):H;delete pe.serializers,B([pe],Ae,_e,this._stdErrSerialize)}function Pe(Ne){this._childLevel=(Ne._childLevel|0)+1,this.bindings=pe,_e&&(this.serializers=_e,this._serialize=Ae),k&&(this._logEvent=z([].concat(Ne._logEvent.bindings,pe)))}Pe.prototype=this;const Me=new Pe(this);return E(this,Me),Me.child=function(...Ne){return ge.call(this,Ee,...Ne)},Me.level=de.level||this.level,Ee.onChild(Me),Me}return Z}function R(O){const k=O.customLevels||{},q=Object.assign({},A.levels.values,k),F=Object.assign({},A.levels.labels,x(k));return{values:q,labels:F}}function x(O){const k={};return Object.keys(O).forEach(function(q){k[O[q]]=q}),k}A.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},A.stdSerializers=h,A.stdTimeFunctions=Object.assign({},{nullTime:J,epochTime:j,unixTime:M,isoTime:N});function T(O){const k=[];O.bindings&&k.push(O.bindings);let q=O[b];for(;q.parent;)q=q.parent,q.logger.bindings&&k.push(q.logger.bindings);return k.reverse()}function C(O,k,q,F){if(Object.defineProperty(O,F,{value:y(O.level,q)>y(F,q)?X:q[v][F],writable:!0,enumerable:!0,configurable:!0}),O[F]===X){if(!k.transmit)return;const D=k.transmit.level||O.level,G=y(D,q);if(y(F,q)<G)return}O[F]=L(O,k,q,F);const H=T(O);H.length!==0&&(O[F]=I(H,O[F]))}function I(O,k){return function(){return k.apply(this,[...O,...arguments])}}function L(O,k,q,F){return(function(H){return function(){const G=k.timestamp(),W=new Array(arguments.length),K=Object.getPrototypeOf&&Object.getPrototypeOf(this)===u?u:this;for(var Z=0;Z<W.length;Z++)W[Z]=arguments[Z];var ae=!1;if(k.serialize&&(B(W,this._serialize,this.serializers,this._stdErrSerialize),ae=!0),k.asObject||k.formatters?H.call(K,$(this,F,W,G,k)):H.apply(K,W),k.transmit){const le=k.transmit.level||O._level,te=y(le,q),ce=y(F,q);if(ce<te)return;U(this,{ts:G,methodLevel:F,methodValue:ce,transmitValue:q.levels.values[k.transmit.level||O._level],send:k.transmit.send,val:y(O._level,q)},W,ae)}}})(O[v][F])}function $(O,k,q,F,H){const{level:D,log:G=te=>te}=H.formatters||{},W=q.slice();let K=W[0];const Z={};if(F&&(Z.time=F),D){const te=D(k,O.levels.values[k]);Object.assign(Z,te)}else Z.level=O.levels.values[k];let ae=(O._childLevel|0)+1;if(ae<1&&(ae=1),K!==null&&typeof K=="object"){for(;ae--&&typeof W[0]=="object";)Object.assign(Z,W.shift());K=W.length?g(W.shift(),W):void 0}else typeof K=="string"&&(K=g(W.shift(),W));return K!==void 0&&(Z[H.messageKey]=K),G(Z)}function B(O,k,q,F){for(const H in O)if(F&&O[H]instanceof Error)O[H]=A.stdSerializers.err(O[H]);else if(typeof O[H]=="object"&&!Array.isArray(O[H])&&k)for(const D in O[H])k.indexOf(D)>-1&&D in q&&(O[H][D]=q[D](O[H][D]))}function U(O,k,q,F=!1){const H=k.send,D=k.ts,G=k.methodLevel,W=k.methodValue,K=k.val,Z=O._logEvent.bindings;F||B(q,O._serialize||Object.keys(O.serializers),O.serializers,O._stdErrSerialize===void 0?!0:O._stdErrSerialize),O._logEvent.ts=D,O._logEvent.messages=q.filter(function(ae){return Z.indexOf(ae)===-1}),O._logEvent.level.label=G,O._logEvent.level.value=W,H(G,O._logEvent,K),O._logEvent=z(Z)}function z(O){return{ts:0,messages:[],bindings:O||[],level:{label:"",value:0}}}function ne(O){const k={type:O.constructor.name,msg:O.message,stack:O.stack};for(const q in O)k[q]===void 0&&(k[q]=O[q]);return k}function ue(O){return typeof O.timestamp=="function"?O.timestamp:O.timestamp===!1?J:j}function he(){return{}}function Y(O){return O}function X(){}function J(){return!1}function j(){return Date.now()}function M(){return Math.round(Date.now()/1e3)}function N(){return new Date(Date.now()).toISOString()}function P(){function O(k){return typeof k<"u"&&k}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return O(self)||O(window)||O(this)||{}}}return browser$e.exports.default=A,browser$e.exports.pino=A,browser$e.exports}requireBrowser$d();async function createEffectEntity(g){const u={transports:[],protocol:g.protocol};await Promise.all(g.transports.map(h=>h.initialize(u)));for(const h of g.transports){u.transports.push(h);const y=h.getMethods();Object.assign(u,y)}return u}const ASSUME_HTTP_CODES=[CODE_TCP,CODE_DNS,CODE_DNSADDR,CODE_DNS4,CODE_DNS6];function extractSNI(g){return extractTuple("sni",g)?.value}function extractPort(g){const u=extractTuple("tcp",g)?.value;return u==null?"":`:${u}`}function extractTuple(g,u){return u.find(h=>h.name===g)}function hasTLS(g){return g.some(({code:u})=>u===CODE_TLS)}function interpretNext(g,u){const h=interpreters[g.name];if(h==null)throw new Error(`Can't interpret protocol ${g.name}`);const y=h(g,u);return g.code===CODE_IP6?`[${y}]`:y}const interpreters={ip4:(g,u)=>g.value,ip6:(g,u)=>u.length===0?g.value:`[${g.value}]`,tcp:(g,u)=>{const h=u.pop();if(h==null)throw new Error("Unexpected end of multiaddr");return`tcp://${interpretNext(h,u)}:${g.value}`},udp:(g,u)=>{const h=u.pop();if(h==null)throw new Error("Unexpected end of multiaddr");return`udp://${interpretNext(h,u)}:${g.value}`},dnsaddr:(g,u)=>g.value,dns4:(g,u)=>g.value,dns6:(g,u)=>g.value,dns:(g,u)=>g.value,ipfs:(g,u)=>{const h=u.pop();if(h==null)throw new Error("Unexpected end of multiaddr");return`${interpretNext(h,u)}`},p2p:(g,u)=>{const h=u.pop();if(h==null)throw new Error("Unexpected end of multiaddr");return`${interpretNext(h,u)}`},http:(g,u)=>{const h=hasTLS(u),y=extractSNI(u),v=extractPort(u);if(h&&y!=null)return`https://${y}${v}`;const b=h?"https://":"http://",w=u.pop();if(w==null)throw new Error("Unexpected end of multiaddr");let E=interpretNext(w,u);return E=E?.replace("tcp://",""),`${b}${E}`},"http-path":(g,u)=>{const h=u.pop();if(h==null)throw new Error("Unexpected end of multiaddr");const y=interpretNext(h,u),v=decodeURIComponent(g.value??"");return`${y}${v}`},tls:(g,u)=>{const h=u.pop();if(h==null)throw new Error("Unexpected end of multiaddr");return interpretNext(h,u)},sni:(g,u)=>{const h=u.pop();if(h==null)throw new Error("Unexpected end of multiaddr");return interpretNext(h,u)},https:(g,u)=>{const h=u.pop();if(h==null)throw new Error("Unexpected end of multiaddr");let y=interpretNext(h,u);return y=y?.replace("tcp://",""),`https://${y}`},ws:(g,u)=>{const h=hasTLS(u),y=extractSNI(u),v=extractPort(u);if(h&&y!=null)return`wss://${y}${v}`;const b=h?"wss://":"ws://",w=u.pop();if(w==null)throw new Error("Unexpected end of multiaddr");let E=interpretNext(w,u);return E=E?.replace("tcp://",""),`${b}${E}`},wss:(g,u)=>{const h=u.pop();if(h==null)throw new Error("Unexpected end of multiaddr");let y=interpretNext(h,u);return y=y?.replace("tcp://",""),`wss://${y}`}};function multiaddrToUri(g,u){const y=multiaddr(g).getComponents(),v=y.pop();if(v==null)throw new Error("Unexpected end of multiaddr");const b=interpreters[v.name];if(b==null)throw new Error(`No interpreter found for ${v.name}`);let w=b(v,y)??"";return ASSUME_HTTP_CODES.includes(v.code)&&(w=w.replace(/^.*:\/\//,""),v.value==="443"?w=`https://${w}`:w=`http://${w}`),(w.startsWith("http://")||w.startsWith("https://")||w.startsWith("ws://")||w.startsWith("wss://"))&&(w=new URL(w).toString(),w.endsWith("/")&&(w=w.substring(0,w.length-1))),w}const ready=async g=>{if(g.readyState>=2)throw new Error("socket closed");g.readyState!==1&&await new Promise((u,h)=>{function y(){g.removeEventListener("open",v),g.removeEventListener("error",b)}function v(){y(),u()}function b(w){y(),h(w.error??new Error(`connect ECONNREFUSED ${g.url}`))}g.addEventListener("open",v),g.addEventListener("error",b)})},sink=(g,u)=>(u=u??{},u.closeOnEnd=u.closeOnEnd!==!1,async y=>{for await(const v of y){try{await ready(g)}catch(b){if(b.message==="socket closed")break;throw b}if(g.readyState===g.CLOSING||g.readyState===g.CLOSED)break;g.send(v)}u.closeOnEnd!=null&&g.readyState<=1&&await new Promise((v,b)=>{g.addEventListener("close",w=>{if(w.wasClean||w.code===1006)v();else{const E=Object.assign(new Error("ws error"),{event:w});b(E)}}),setTimeout(()=>{g.close()})})});var dom={},eventIterator={},hasRequiredEventIterator;function requireEventIterator(){if(hasRequiredEventIterator)return eventIterator;hasRequiredEventIterator=1,Object.defineProperty(eventIterator,"__esModule",{value:!0});class g{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(y){if(this.isStopped)return;const v={value:y,done:!1};if(this.pullQueue.length){const b=this.pullQueue.shift();b&&b.resolve(v)}else this.pushQueue.push(Promise.resolve(v)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const y of this.pullQueue)y.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(y){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const v of this.pullQueue)v.reject(y);this.pullQueue.length=0}else{const v=Promise.reject(y);v.catch(()=>{}),this.pushQueue.push(v)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:y=>{const v=this.pushQueue.shift();return v?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),v):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((b,w)=>{this.pullQueue.push({resolve:b,reject:w})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}class u{constructor(y,{highWaterMark:v=100,lowWaterMark:b=1}={}){const w=new g;w.highWaterMark=v,w.lowWaterMark=b,w.removeCallback=y({push:E=>w.push(E),stop:()=>w.stop(),fail:E=>w.fail(E),on:(E,_)=>{w.eventHandlers[E]=_}})||(()=>{}),this[Symbol.asyncIterator]=()=>w[Symbol.asyncIterator](),Object.freeze(this)}}return eventIterator.EventIterator=u,eventIterator.default=u,eventIterator}var hasRequiredDom;function requireDom(){if(hasRequiredDom)return dom;hasRequiredDom=1,Object.defineProperty(dom,"__esModule",{value:!0});const g=requireEventIterator();dom.EventIterator=g.EventIterator;function u(h,y,v){return new g.EventIterator(({push:b})=>(this.addEventListener(h,b,y),()=>this.removeEventListener(h,b,y)),v)}return dom.subscribe=u,dom.default=g.EventIterator,dom}var domExports=requireDom();function isArrayBuffer(g){return g instanceof ArrayBuffer||g?.constructor?.name==="ArrayBuffer"&&typeof g?.byteLength=="number"}const source=g=>{g.binaryType="arraybuffer";const u=async()=>{await new Promise((b,w)=>{if(y){b();return}if(v!=null){w(v);return}const E=A=>{g.removeEventListener("open",_),g.removeEventListener("error",S),A()},_=()=>{E(b)},S=A=>{E(()=>{w(A.error??new Error(`connect ECONNREFUSED ${g.url}`))})};g.addEventListener("open",_),g.addEventListener("error",S)})},h=(async function*(){const b=new domExports.EventIterator(({push:w,stop:E,fail:_})=>{const S=R=>{let x=null;typeof R.data=="string"&&(x=fromString(R.data)),isArrayBuffer(R.data)&&(x=new Uint8Array(R.data)),R.data instanceof Uint8Array&&(x=R.data),x!=null&&w(x)},A=R=>{_(R.error??new Error("Socket error"))};return g.addEventListener("message",S),g.addEventListener("error",A),g.addEventListener("close",E),()=>{g.removeEventListener("message",S),g.removeEventListener("error",A),g.removeEventListener("close",E)}},{highWaterMark:1/0});await u();for await(const w of b)yield isArrayBuffer(w)?new Uint8Array(w):w})();let y=g.readyState===1,v;return g.addEventListener("open",()=>{y=!0,v=null}),g.addEventListener("close",()=>{y=!1,v=null}),g.addEventListener("error",b=>{y||(v=b.error??new Error(`connect ECONNREFUSED ${g.url}`))}),Object.assign(h,{connected:u})},duplex$1=(g,u)=>{u=u??{};const h=source(g);let y=u.remoteAddress,v=u.remotePort;if(g.url!=null)try{const w=new URL(g.url);y=w.hostname,v=parseInt(w.port,10)}catch{}if(y==null||v==null)throw new Error("Remote connection did not have address and/or port");return{sink:sink(g,u),source:h,connected:async()=>{await h.connected()},close:async()=>{(g.readyState===g.CONNECTING||g.readyState===g.OPEN)&&await new Promise(w=>{g.addEventListener("close",()=>{w()}),g.close()})},destroy:()=>{g.terminate!=null?g.terminate():g.close()},remoteAddress:y,remotePort:v,socket:g}},WebSocket$1=WebSocket,map={"http:":"ws:","https:":"wss:"},defaultProtocol="ws:",wsurl=(g,u)=>{if(g.startsWith("//")&&(g=`${u?.protocol??defaultProtocol}${g}`),g.startsWith("/")&&u!=null){const y=u.protocol??defaultProtocol,v=u.host,b=u.port!=null&&v?.endsWith(`:${u.port}`)!==!0?`:${u.port}`:"";g=`${y}//${v}${b}${g}`}const h=new URL(g);for(const[y,v]of Object.entries(map))h.protocol===y&&(h.protocol=v);return h};function connect(g,u){const h=typeof window>"u"?void 0:window.location;u=u??{};const y=wsurl(g,h),v=new WebSocket$1(y.toString(),u.websocket);return duplex$1(v,u)}function all(g){return g.filter(u=>WebSocketsSecure.exactMatch(u)||WebSockets$1.exactMatch(u))}function createListener$1(){throw new Error("WebSocket Servers can not be created in the browser!")}const CLOSE_TIMEOUT=500;function socketToMaConn(g,u,h){const y=h.metrics,v=h.metricPrefix??"",b={log:h.logger.forComponent("libp2p:websockets:connection"),async sink(_){try{await g.sink((async function*(){for await(const S of _)S instanceof Uint8Array?yield S:yield S.subarray()})())}catch(S){S.type!=="aborted"&&b.log.error(S)}},source:g.source,remoteAddr:u,timeline:{open:Date.now()},async close(_={}){const S=Date.now();if(_.signal==null){const R=AbortSignal.timeout(CLOSE_TIMEOUT);_={..._,signal:R}}const A=()=>{const{host:R,port:x}=b.remoteAddr.toOptions();b.log("timeout closing stream to %s:%s after %dms, destroying it manually",R,x,Date.now()-S),this.abort(new AbortError$6("Socket close timeout"))};_.signal?.addEventListener("abort",A);try{await g.close()}catch(R){b.log.error("error closing WebSocket gracefully - %e",R),this.abort(R)}finally{_.signal?.removeEventListener("abort",A),b.timeline.close=Date.now()}},abort(_){b.log.error("destroying WebSocket after error - %e",_),g.destroy(),b.timeline.close=Date.now(),y?.increment({[`${v}error`]:!0})}};let w=!1;const E=g.socket.close.bind(g.socket);return g.socket.close=(..._)=>(w=!0,E(..._)),g.socket.addEventListener("close",_=>{if(b.log('closed %s, code %d, reason "%s", wasClean %s',w?"locally":"by remote",_.code,_.reason,_.wasClean),!_.wasClean){b.abort(new ConnectionFailedError(`${w?"Local":"Remote"} did not close WebSocket cleanly`));return}y?.increment({[`${v}close`]:!0}),b.timeline.close=Date.now()},{once:!0}),b}class WebSockets{log;init;logger;metrics;components;constructor(u,h={}){this.log=u.logger.forComponent("libp2p:websockets"),this.logger=u.logger,this.components=u,this.init=h,u.metrics!=null&&(this.metrics={dialerEvents:u.metrics.registerCounterGroup("libp2p_websockets_dialer_events_total",{label:"event",help:"Total count of WebSockets dialer events by type"})})}[transportSymbol]=!0;[Symbol.toStringTag]="@libp2p/websockets";[serviceCapabilities]=["@libp2p/transport"];async dial(u,h){this.log("dialing %s",u),h=h??{};const y=await this._connect(u,h),v=socketToMaConn(y,u,{logger:this.logger,metrics:this.metrics?.dialerEvents});this.log("new outbound connection %s",v.remoteAddr);const b=await h.upgrader.upgradeOutbound(v,h);return this.log("outbound connection %s upgraded",v.remoteAddr),b}async _connect(u,h){h?.signal?.throwIfAborted();const y=u.toOptions();this.log("dialing %s:%s",y.host,y.port);const v=pDefer(),b=connect(multiaddrToUri(u),this.init);b.socket.addEventListener("error",()=>{const w=new ConnectionFailedError(`Could not connect to ${u.toString()}`);this.log.error("connection error:",w),this.metrics?.dialerEvents.increment({error:!0}),v.reject(w)});try{h.onProgress?.(new CustomProgressEvent("websockets:open-connection")),await raceSignal$1(Promise.race([b.connected(),v.promise]),h.signal)}catch(w){throw h.signal?.aborted&&this.metrics?.dialerEvents.increment({abort:!0}),b.close().catch(E=>{this.log.error("error closing raw socket",E)}),w}return this.log("connected %s",u),this.metrics?.dialerEvents.increment({connect:!0}),b}createListener(u){return createListener$1({logger:this.logger,events:this.components.events,metrics:this.components.metrics},{...this.init,...u})}listenFilter(u){return u=Array.isArray(u)?u:[u],this.init?.filter!=null?this.init?.filter(u):all(u)}dialFilter(u){return this.listenFilter(u)}}function webSockets(g={}){return u=>new WebSockets(u,g)}const CIRCUIT_PROTO_CODE=290,DEFAULT_RESERVATION_CONCURRENCY=1,DEFAULT_RESERVATION_COMPLETION_TIMEOUT=2e3,DEFAULT_MAX_RESERVATION_QUEUE_LENGTH=100,KEEP_ALIVE_TAG=`${KEEP_ALIVE}-circuit-relay`;BigInt(1<<17);const RELAY_V2_HOP_CODEC="/libp2p/circuit/relay/0.2.0/hop",RELAY_V2_STOP_CODEC="/libp2p/circuit/relay/0.2.0/stop",MAX_CONNECTIONS=300,DEFAULT_DISCOVERY_FILTER_SIZE=4096,DEFAULT_DISCOVERY_FILTER_ERROR_RATE=.001;var HopMessage;(function(g){(function(y){y.RESERVE="RESERVE",y.CONNECT="CONNECT",y.STATUS="STATUS"})(g.Type||(g.Type={}));let u;(function(y){y[y.RESERVE=0]="RESERVE",y[y.CONNECT=1]="CONNECT",y[y.STATUS=2]="STATUS"})(u||(u={})),(function(y){y.codec=()=>enumeration(u)})(g.Type||(g.Type={}));let h;g.codec=()=>(h==null&&(h=message((y,v,b={})=>{b.lengthDelimited!==!1&&v.fork(),y.type!=null&&(v.uint32(8),g.Type.codec().encode(y.type,v)),y.peer!=null&&(v.uint32(18),Peer.codec().encode(y.peer,v)),y.reservation!=null&&(v.uint32(26),Reservation.codec().encode(y.reservation,v)),y.limit!=null&&(v.uint32(34),Limit.codec().encode(y.limit,v)),y.status!=null&&(v.uint32(40),Status.codec().encode(y.status,v)),b.lengthDelimited!==!1&&v.ldelim()},(y,v,b={})=>{const w={},E=v==null?y.len:y.pos+v;for(;y.pos<E;){const _=y.uint32();switch(_>>>3){case 1:{w.type=g.Type.codec().decode(y);break}case 2:{w.peer=Peer.codec().decode(y,y.uint32(),{limits:b.limits?.peer});break}case 3:{w.reservation=Reservation.codec().decode(y,y.uint32(),{limits:b.limits?.reservation});break}case 4:{w.limit=Limit.codec().decode(y,y.uint32(),{limits:b.limits?.limit});break}case 5:{w.status=Status.codec().decode(y);break}default:{y.skipType(_&7);break}}}return w})),h),g.encode=y=>encodeMessage(y,g.codec()),g.decode=(y,v)=>decodeMessage(y,g.codec(),v)})(HopMessage||(HopMessage={}));var StopMessage;(function(g){(function(y){y.CONNECT="CONNECT",y.STATUS="STATUS"})(g.Type||(g.Type={}));let u;(function(y){y[y.CONNECT=0]="CONNECT",y[y.STATUS=1]="STATUS"})(u||(u={})),(function(y){y.codec=()=>enumeration(u)})(g.Type||(g.Type={}));let h;g.codec=()=>(h==null&&(h=message((y,v,b={})=>{b.lengthDelimited!==!1&&v.fork(),y.type!=null&&(v.uint32(8),g.Type.codec().encode(y.type,v)),y.peer!=null&&(v.uint32(18),Peer.codec().encode(y.peer,v)),y.limit!=null&&(v.uint32(26),Limit.codec().encode(y.limit,v)),y.status!=null&&(v.uint32(32),Status.codec().encode(y.status,v)),b.lengthDelimited!==!1&&v.ldelim()},(y,v,b={})=>{const w={},E=v==null?y.len:y.pos+v;for(;y.pos<E;){const _=y.uint32();switch(_>>>3){case 1:{w.type=g.Type.codec().decode(y);break}case 2:{w.peer=Peer.codec().decode(y,y.uint32(),{limits:b.limits?.peer});break}case 3:{w.limit=Limit.codec().decode(y,y.uint32(),{limits:b.limits?.limit});break}case 4:{w.status=Status.codec().decode(y);break}default:{y.skipType(_&7);break}}}return w})),h),g.encode=y=>encodeMessage(y,g.codec()),g.decode=(y,v)=>decodeMessage(y,g.codec(),v)})(StopMessage||(StopMessage={}));var Peer;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{if(v.lengthDelimited!==!1&&y.fork(),h.id!=null&&h.id.byteLength>0&&(y.uint32(10),y.bytes(h.id)),h.addrs!=null)for(const b of h.addrs)y.uint32(18),y.bytes(b);v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={id:alloc$1(0),addrs:[]},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.id=h.bytes();break}case 2:{if(v.limits?.addrs!=null&&b.addrs.length===v.limits.addrs)throw new MaxLengthError('Decode error - map field "addrs" had too many elements');b.addrs.push(h.bytes());break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(Peer||(Peer={}));var Reservation;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{if(v.lengthDelimited!==!1&&y.fork(),h.expire!=null&&h.expire!==0n&&(y.uint32(8),y.uint64(h.expire)),h.addrs!=null)for(const b of h.addrs)y.uint32(18),y.bytes(b);h.voucher!=null&&(y.uint32(26),Envelope.codec().encode(h.voucher,y)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={expire:0n,addrs:[]},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.expire=h.uint64();break}case 2:{if(v.limits?.addrs!=null&&b.addrs.length===v.limits.addrs)throw new MaxLengthError('Decode error - map field "addrs" had too many elements');b.addrs.push(h.bytes());break}case 3:{b.voucher=Envelope.codec().decode(h,h.uint32(),{limits:v.limits?.voucher});break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(Reservation||(Reservation={}));var Limit;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.duration!=null&&(y.uint32(8),y.uint32(h.duration)),h.data!=null&&(y.uint32(16),y.uint64(h.data)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.duration=h.uint32();break}case 2:{b.data=h.uint64();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(Limit||(Limit={}));var Status;(function(g){g.UNUSED="UNUSED",g.OK="OK",g.RESERVATION_REFUSED="RESERVATION_REFUSED",g.RESOURCE_LIMIT_EXCEEDED="RESOURCE_LIMIT_EXCEEDED",g.PERMISSION_DENIED="PERMISSION_DENIED",g.CONNECTION_FAILED="CONNECTION_FAILED",g.NO_RESERVATION="NO_RESERVATION",g.MALFORMED_MESSAGE="MALFORMED_MESSAGE",g.UNEXPECTED_MESSAGE="UNEXPECTED_MESSAGE"})(Status||(Status={}));var __StatusValues;(function(g){g[g.UNUSED=0]="UNUSED",g[g.OK=100]="OK",g[g.RESERVATION_REFUSED=200]="RESERVATION_REFUSED",g[g.RESOURCE_LIMIT_EXCEEDED=201]="RESOURCE_LIMIT_EXCEEDED",g[g.PERMISSION_DENIED=202]="PERMISSION_DENIED",g[g.CONNECTION_FAILED=203]="CONNECTION_FAILED",g[g.NO_RESERVATION=204]="NO_RESERVATION",g[g.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE",g[g.UNEXPECTED_MESSAGE=401]="UNEXPECTED_MESSAGE"})(__StatusValues||(__StatusValues={}));(function(g){g.codec=()=>enumeration(__StatusValues)})(Status||(Status={}));var ReservationVoucher;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.relay!=null&&h.relay.byteLength>0&&(y.uint32(10),y.bytes(h.relay)),h.peer!=null&&h.peer.byteLength>0&&(y.uint32(18),y.bytes(h.peer)),h.expiration!=null&&h.expiration!==0n&&(y.uint32(24),y.uint64(h.expiration)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={relay:alloc$1(0),peer:alloc$1(0),expiration:0n},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.relay=h.bytes();break}case 2:{b.peer=h.bytes();break}case 3:{b.expiration=h.uint64();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(ReservationVoucher||(ReservationVoucher={}));var Envelope;(function(g){let u;g.codec=()=>(u==null&&(u=message((h,y,v={})=>{v.lengthDelimited!==!1&&y.fork(),h.publicKey!=null&&h.publicKey.byteLength>0&&(y.uint32(10),y.bytes(h.publicKey)),h.payloadType!=null&&h.payloadType.byteLength>0&&(y.uint32(18),y.bytes(h.payloadType)),h.payload!=null&&(y.uint32(26),ReservationVoucher.codec().encode(h.payload,y)),h.signature!=null&&h.signature.byteLength>0&&(y.uint32(42),y.bytes(h.signature)),v.lengthDelimited!==!1&&y.ldelim()},(h,y,v={})=>{const b={publicKey:alloc$1(0),payloadType:alloc$1(0),signature:alloc$1(0)},w=y==null?h.len:h.pos+y;for(;h.pos<w;){const E=h.uint32();switch(E>>>3){case 1:{b.publicKey=h.bytes();break}case 2:{b.payloadType=h.bytes();break}case 3:{b.payload=ReservationVoucher.codec().decode(h,h.uint32(),{limits:v.limits?.payload});break}case 5:{b.signature=h.bytes();break}default:{h.skipType(E&7);break}}}return b})),u),g.encode=h=>encodeMessage(h,g.codec()),g.decode=(h,y)=>decodeMessage(h,g.codec(),y)})(Envelope||(Envelope={}));class HadEnoughRelaysError extends Error{static name="HadEnoughRelaysError";name="HadEnoughRelaysError"}class DoubleRelayError extends Error{static name="DoubleRelayError";name="DoubleRelayError"}class RelayQueueFullError extends Error{static name="RelayQueueFullError";name="RelayQueueFullError"}function getExpirationMilliseconds(g){const u=g*BigInt(1e3),h=new Date().getTime();return Number(u-BigInt(h))}class LimitTracker{expires;bytes;constructor(u){u?.duration!=null&&u?.duration!==0&&(this.expires=Date.now()+u.duration*1e3),this.bytes=u?.data,this.bytes===0n&&(this.bytes=void 0),this.onData=this.onData.bind(this)}onData(u){this.bytes!=null&&(this.bytes-=BigInt(u.byteLength),this.bytes<0n&&(this.bytes=0n))}getLimits(){if(this.expires==null&&this.bytes==null)return;const u={};if(this.bytes!=null){const h=this;Object.defineProperty(u,"bytes",{get(){return h.bytes}})}if(this.expires!=null){const h=this;Object.defineProperty(u,"seconds",{get(){return Math.round(((h.expires??0)-Date.now())/1e3)}})}return u}}const CircuitListen=fmt(and(P2P.matchers[0],code(CODE_P2P_CIRCUIT))),CircuitSearch=fmt(code(CODE_P2P_CIRCUIT));function streamToMaConnection(g){const{stream:u,remoteAddr:h,log:y,onDataRead:v,onDataWrite:b}=g;let w=!1,E=!1;const _=u.close.bind(u);u.close=async T=>{await _(T),x(!0)};const S=u.abort.bind(u);u.abort=T=>{S(T),x(!0)};const A=u.sink.bind(u);u.sink=async T=>{try{await A(pipe(T,C=>forEach$1(C,I=>b?.(I))))}catch(C){R.log.error("errored - %e",C),C.type!=="aborted"&&R.log.error("%s error in sink - %e",h,C)}finally{E=!0,x()}};const R={log:y.newScope("stream-to-maconn"),sink:u.sink,source:(async function*(){try{for await(const T of u.source)v?.(T),yield T}finally{w=!0,x()}})(),remoteAddr:h,timeline:{open:Date.now(),close:void 0},close:u.close,abort:u.abort};function x(T){T===!0&&(w=!0,E=!0),w&&E&&R.timeline.close==null&&(R.timeline.close=Date.now())}return R}class RelayDiscovery extends TypedEventEmitter{components;started;running;topologyId;log;discoveryController;filter;queue;constructor(u,h={}){super(),this.log=u.logger.forComponent("libp2p:circuit-relay:discover-relays"),this.components=u,this.started=!1,this.running=!1,this.filter=h.filter,this.discoveryController=new AbortController,this.discoveryController.signal,this.dialPeer=this.dialPeer.bind(this),this.onPeer=this.onPeer.bind(this)}isStarted(){return this.started}async start(){this.topologyId=await this.components.registrar.register(RELAY_V2_HOP_CODEC,{filter:this.filter,onConnect:u=>{this.log.trace("discovered relay %p queue (length: %d, active %d)",u,this.queue?.size,this.queue?.running),this.safeDispatchEvent("relay:discover",{detail:u})}}),this.started=!0}stop(){this.topologyId!=null&&this.components.registrar.unregister(this.topologyId),this.running&&this.stopDiscovery(),this.started=!1}startDiscovery(){this.running||(this.log("start discovery"),this.running=!0,this.discoveryController=new AbortController,this.discoveryController.signal,this.components.events.addEventListener("peer:discovery",this.onPeer),Promise.resolve().then(async()=>{this.log("searching peer store for relays");const u=await this.components.peerStore.all({filters:[y=>y.protocols.includes(RELAY_V2_HOP_CODEC)],orders:[()=>Math.random()<.5?1:-1,(y,v)=>{const b=getLastDial(y),w=getLastDial(v);return b>w?-1:w>b?1:0}]});for(const y of u)this.log.trace("found relay peer %p in peer store",y.id),this.safeDispatchEvent("relay:discover",{detail:y.id});this.log("found %d relay peers in peer store",u.length);const h=this.queue=new PeerQueue({concurrency:5});this.log("start random walk");for await(const y of this.components.randomWalk.walk({signal:this.discoveryController.signal})){if(this.log.trace("found random peer %p",y.id),h.has(y.id)){this.log.trace("random peer %p was already in queue",y.id);continue}if(this.components.connectionManager.getConnections(y.id)?.length>0){this.log.trace("random peer %p was already connected",y.id);continue}if(!await this.components.connectionManager.isDialable(y.multiaddrs)){this.log.trace("random peer %p was not dialable",y.id,y.multiaddrs.map(v=>v.toString()));continue}h.queued>10&&(this.log.trace("wait for space in queue for %p",y.id),await h.onSizeLessThan(10,{signal:this.discoveryController.signal})),this.log("adding random peer %p to dial queue (length: %d, active %d)",y.id,h.size,h.running),h.add(this.dialPeer,{peerId:y.id,signal:this.discoveryController.signal}).catch(v=>{this.log.error("error opening connection to random peer %p",y.id,v)})}this.log("stop random walk"),await h.onIdle()}).catch(u=>{this.discoveryController.signal.aborted||this.log.error("failed when finding relays on the network",u)}))}stopDiscovery(){this.log("stop discovery"),this.running=!1,this.discoveryController?.abort(),this.queue?.clear(),this.components.events.removeEventListener("peer:discovery",this.onPeer)}onPeer(u){this.log.trace("maybe dialing discovered peer %p - %e",u.detail.id),this.maybeDialPeer(u).catch(h=>{this.log.trace("error dialing discovered peer %p - %e",u.detail.id,h)})}async maybeDialPeer(u){if(this.queue==null)return;const h=u.detail.id,y=u.detail.multiaddrs;if(this.queue.has(h)){this.log.trace("random peer %p was already in queue",h);return}if(this.components.connectionManager.getConnections(h)?.length>0){this.log.trace("random peer %p was already connected",h);return}if(!await this.components.connectionManager.isDialable(y)){this.log.trace("random peer %p was not dialable",h);return}this.queue?.add(this.dialPeer,{peerId:u.detail.id,signal:this.discoveryController.signal}).catch(v=>{this.log.error("error opening connection to discovered peer %p",u.detail.id,v)})}async dialPeer({peerId:u,signal:h}){const y=anySignal([AbortSignal.timeout(5e3),h]);try{await this.components.connectionManager.openConnection(u,{signal:y})}finally{y.clear()}}}function getLastDial(g){const u=g.metadata.get("last-dial-success");return u==null?0:new Date(toString$1(u)).getTime()}class CircuitRelayTransportListener extends TypedEventEmitter{connectionManager;addressManager;reservationStore;listeningAddrs;log;listenTimeout;reservationId;relay;constructor(u,h={}){super(),this.log=u.logger.forComponent("libp2p:circuit-relay:transport:listener"),this.connectionManager=u.connectionManager,this.addressManager=u.addressManager,this.reservationStore=u.reservationStore,this.listeningAddrs=[],this.listenTimeout=h.listenTimeout??DEFAULT_RESERVATION_COMPLETION_TIMEOUT,this.reservationStore.addEventListener("relay:removed",this._onRemoveRelayPeer),this.reservationStore.addEventListener("relay:created-reservation",this._onAddRelayPeer)}_onRemoveRelayPeer=u=>{this.log("relay removed %p our relay %p",u.detail.relay,this.relay,this.relay?.equals(u.detail.relay)),this.relay?.equals(u.detail.relay)===!0&&(this.log("relay peer removed %p",u.detail.relay),this.listeningAddrs.forEach(h=>{this.addressManager.removeObservedAddr(h)}),this.listeningAddrs=[],this.safeDispatchEvent("listening"))};_onAddRelayPeer=u=>{const{details:h}=u.detail;h.type!=="configured"&&h.id===this.reservationId&&this.addedRelay(u.detail)};async listen(u){if(CircuitSearch.exactMatch(u))this.log("searching for circuit relay servers"),this.reservationId=this.reservationStore.reserveRelay();else if(CircuitListen.exactMatch(u)){this.log("listen on specific relay server %a",u);const h=AbortSignal.timeout(this.listenTimeout),y=u.decapsulate("/p2p-circuit"),v=await this.connectionManager.openConnection(y,{signal:h});if(!this.reservationStore.hasReservation(v.remotePeer)){this.log("making reservation on peer %p",v.remotePeer);const b=await this.reservationStore.addRelay(v.remotePeer,"configured");this.addedRelay(b)}}else throw new ListenError(`Could not listen on p2p-circuit address "${u}"`)}getAddrs(){return[...this.listeningAddrs.values()].flat()}updateAnnounceAddrs(){}async close(){this.reservationStore.cancelReservations(),this.listeningAddrs=[],this.reservationStore.removeEventListener("relay:removed",this._onRemoveRelayPeer),queueMicrotask(()=>{this.safeDispatchEvent("close")})}addedRelay(u){this.log("relay peer added %p",u.relay),this.relay=u.relay,this.listeningAddrs=u.details.reservation.addrs.map(h=>multiaddr(h).encapsulate("/p2p-circuit")),this.listeningAddrs.forEach(h=>{this.addressManager.confirmObservedAddr(h,{type:"transport"})}),queueMicrotask(()=>{this.safeDispatchEvent("listening")})}}function createListener(g){return new CircuitRelayTransportListener(g)}const urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let nanoid=(g=21)=>{let u="",h=crypto.getRandomValues(new Uint8Array(g|=0));for(;g--;)u+=urlAlphabet[h[g]&63];return u};const REFRESH_WINDOW=60*1e3*10,REFRESH_TIMEOUT=60*1e3*5,REFRESH_TIMEOUT_MIN=30*1e3;class ReservationStore extends TypedEventEmitter{peerId;connectionManager;peerStore;events;reserveQueue;reservations;pendingReservations;maxReservationQueueLength;reservationCompletionTimeout;started;log;relayFilter;constructor(u,h){super(),this.log=u.logger.forComponent("libp2p:circuit-relay:transport:reservation-store"),this.peerId=u.peerId,this.connectionManager=u.connectionManager,this.peerStore=u.peerStore,this.events=u.events,this.reservations=new PeerMap,this.pendingReservations=[],this.maxReservationQueueLength=h?.maxReservationQueueLength??DEFAULT_MAX_RESERVATION_QUEUE_LENGTH,this.reservationCompletionTimeout=h?.reservationCompletionTimeout??DEFAULT_RESERVATION_COMPLETION_TIMEOUT,this.started=!1,this.relayFilter=createScalableCuckooFilter(100),this.reserveQueue=new PeerQueue({concurrency:h?.reservationConcurrency??DEFAULT_RESERVATION_CONCURRENCY,metricName:"libp2p_relay_reservation_queue",metrics:u.metrics}),this.events.addEventListener("connection:close",y=>{[...this.reservations.values()].find(b=>b.connection===y.detail.id)!=null&&this.#t(y.detail.remotePeer).catch(b=>{this.log("could not remove relay %p - %e",y.detail,b)})})}isStarted(){return this.started}start(){this.started=!0}afterStart(){Promise.resolve().then(async()=>{const u=await this.peerStore.all({filters:[h=>h.tags.has(KEEP_ALIVE_TAG)]});this.log("removing tag from %d old relays",u.length),await Promise.all(u.map(async h=>{await this.peerStore.merge(h.id,{tags:{[KEEP_ALIVE_TAG]:void 0}})})),this.log("redialing %d old relays",u.length),await Promise.all(u.map(async h=>this.addRelay(h.id,"discovered"))),this.#r()}).catch(u=>{this.log.error(u)})}stop(){this.reserveQueue.clear(),this.reservations.forEach(({timeout:u})=>{clearTimeout(u)}),this.reservations.clear(),this.started=!1}reserveRelay(){const u=nanoid();return this.pendingReservations.push(u),this.#r(),u}async addRelay(u,h){if(this.peerId.equals(u))throw this.log.trace("not trying to use self as relay"),new ListenError("Cannot use self as relay");if(this.reserveQueue.size>this.maxReservationQueueLength)throw new RelayQueueFullError("The reservation queue is full");const y=this.reserveQueue.find(u);if(y!=null)return this.log.trace("potential relay peer %p is already in the reservation queue",u),y.join();if(this.relayFilter.has(u.toMultihash().bytes))throw new ListenError("The relay was previously invalid");return this.log.trace("try to reserve relay slot with %p",u),this.reserveQueue.add(async()=>{const v=Date.now();try{const b=this.reservations.get(u);if(b!=null){const C=this.connectionManager.getConnections(u);let I=!1;if(C.length===0&&this.log("already have relay reservation with %p but we are no longer connected",u),C.map(L=>L.id).includes(b.connection)&&(this.log("already have relay reservation with %p and the original connection is still open",u),I=!0),I&&getExpirationMilliseconds(b.reservation.expire)>REFRESH_WINDOW)return this.log("already have relay reservation with %p but we are still connected and it does not expire soon",u),{relay:u,details:b};await this.#t(u)}if(h==="discovered"&&this.pendingReservations.length===0)throw new HadEnoughRelaysError("Not making reservation on discovered relay because we do not need any more relays");const w=AbortSignal.timeout(this.reservationCompletionTimeout);const E=await this.connectionManager.openConnection(u,{signal:w});if(Circuit$1.matches(E.remoteAddr))throw new DoubleRelayError("not creating reservation over relayed connection");const _=await this.#e(E,{signal:w}),S=getExpirationMilliseconds(_.expire);this.log("created reservation on relay peer %p, expiry date is %s",u,new Date(Date.now()+S).toString());const A=Math.min(Math.max(S-REFRESH_TIMEOUT,REFRESH_TIMEOUT_MIN),Math.pow(2,31)-1),R=setTimeout(()=>{this.log("refresh reservation to relay %p",u),this.addRelay(u,h).catch(async C=>{this.log.error("could not refresh reservation to relay %p - %e",u,C),await this.#t(u)}).catch(C=>{this.log.error("could not remove expired reservation to relay %p - %e",u,C)})},A);let x;if(h==="discovered"){const C=this.pendingReservations.pop();if(C==null)throw new HadEnoughRelaysError("Made reservation on relay but did not need any more discovered relays");x={timeout:R,reservation:_,type:h,connection:E.id,id:C}}else x={timeout:R,reservation:_,type:h,connection:E.id};this.reservations.set(u,x),await this.peerStore.merge(u,{tags:{[KEEP_ALIVE_TAG]:{value:1,ttl:S}}}),this.#r();const T={relay:u,details:x};return this.safeDispatchEvent("relay:created-reservation",{detail:T}),T}catch(b){throw h==="discovered"&&b.name==="HadEnoughRelaysError"||this.log.error("could not reserve slot on %p after %dms - %e",u,Date.now()-v,b),(b.name==="DialError"||b.name==="UnsupportedProtocolError")&&this.relayFilter.add(u.toMultihash().bytes),this.#t(u).catch(w=>{this.log.error("could not remove reservation on %p after reserving slot failed - %e",u,w)}),b}},{peerId:u})}hasReservation(u){return this.reservations.has(u)}getReservation(u){return this.reservations.get(u)?.reservation}reservationCount(u){return u==null?this.reservations.size:[...this.reservations.values()].reduce((h,y)=>(y.type===u&&h++,h),0)}cancelReservations(){[...this.reservations.values()].forEach(u=>{clearTimeout(u.timeout)}),this.reservations.clear()}async#e(u,h){h.signal?.throwIfAborted(),this.log("requesting reservation from %p",u.remotePeer);const y=await u.newStream(RELAY_V2_HOP_CODEC,h),b=pbStream$1(y).pb(HopMessage);this.log.trace("send RESERVE to %p",u.remotePeer),await b.write({type:HopMessage.Type.RESERVE},h);let w;try{this.log.trace("reading response from %p",u.remotePeer),w=await b.read(h)}catch(_){throw y.abort(_),_}finally{y.status!=="closed"&&await y.close(h)}if(this.log.trace("read response %o",w),w.status===Status.OK&&w.reservation!=null){const _=new Set;_.add(u.remoteAddr.toString());for(const S of w.reservation.addrs){let A=multiaddr(S);A.getPeerId()==null&&(A=A.encapsulate(`/p2p/${u.remotePeer}`)),A=multiaddr(A.toString().replace(`/p2p/${u.remotePeer}/p2p/${u.remotePeer}`,`/p2p/${u.remotePeer}`)),_.add(A.toString())}return w.reservation.addrs=[..._].map(S=>multiaddr(S).bytes),w.reservation}const E=`reservation failed with status ${w.status??"undefined"}`;throw this.log.error(E),new Error(E)}async#t(u){const h=this.reservations.get(u);h!=null&&(this.log("removing relay reservation with %p from local store",u),clearTimeout(h.timeout),this.reservations.delete(u),h.type==="discovered"&&this.pendingReservations.push(h.id),await this.peerStore.merge(u,{tags:{[KEEP_ALIVE_TAG]:void 0}}),this.safeDispatchEvent("relay:removed",{detail:{relay:u,details:h}}),this.#r())}#r(){if(this.pendingReservations.length===0){this.log.trace("have discovered enough relays"),this.reserveQueue.clear(),this.safeDispatchEvent("relay:found-enough-relays");return}this.relayFilter=createScalableCuckooFilter(100),this.log("not discovered enough relays %d/%d",this.reservations.size,this.pendingReservations.length),this.safeDispatchEvent("relay:not-enough-relays")}}const isValidStop=g=>{if(g.peer==null)return!1;try{g.peer.addrs.forEach(multiaddr)}catch{return!1}return!0},defaults={maxInboundStopStreams:MAX_CONNECTIONS,maxOutboundStopStreams:MAX_CONNECTIONS};class CircuitRelayTransport{discovery;registrar;peerStore;connectionManager;transportManager;peerId;upgrader;addressManager;connectionGater;reservationStore;logger;maxInboundStopStreams;maxOutboundStopStreams;started;log;shutdownController;constructor(u,h={}){this.log=u.logger.forComponent("libp2p:circuit-relay:transport"),this.registrar=u.registrar,this.peerStore=u.peerStore,this.connectionManager=u.connectionManager,this.transportManager=u.transportManager,this.logger=u.logger,this.peerId=u.peerId,this.upgrader=u.upgrader,this.addressManager=u.addressManager,this.connectionGater=u.connectionGater,this.maxInboundStopStreams=h.maxInboundStopStreams??defaults.maxInboundStopStreams,this.maxOutboundStopStreams=h.maxOutboundStopStreams??defaults.maxOutboundStopStreams,this.shutdownController=new AbortController,this.discovery=new RelayDiscovery(u,{filter:h.discoveryFilter??peerFilter(DEFAULT_DISCOVERY_FILTER_SIZE,DEFAULT_DISCOVERY_FILTER_ERROR_RATE)}),this.discovery.addEventListener("relay:discover",y=>{this.reservationStore.addRelay(y.detail,"discovered").catch(v=>{v.name!=="HadEnoughRelaysError"&&v.name!=="RelayQueueFullError"&&this.log.error("could not add discovered relay %p",y.detail,v)})}),this.reservationStore=new ReservationStore(u,h),this.reservationStore.addEventListener("relay:not-enough-relays",()=>{this.discovery?.startDiscovery()}),this.reservationStore.addEventListener("relay:found-enough-relays",()=>{this.discovery?.stopDiscovery()}),this.started=!1}[Symbol.toStringTag]="@libp2p/circuit-relay-v2-transport";[serviceCapabilities]=["@libp2p/transport","@libp2p/circuit-relay-v2-transport"];get[serviceDependencies](){return this.discovery!=null?["@libp2p/identify"]:[]}[transportSymbol]=!0;isStarted(){return this.started}async start(){this.shutdownController=new AbortController,this.shutdownController.signal,await this.registrar.handle(RELAY_V2_STOP_CODEC,u=>{const h=this.upgrader.createInboundAbortSignal(this.shutdownController.signal);this.onStop(u,h).catch(y=>{this.log.error("error while handling STOP protocol",y),u.stream.abort(y)}).finally(()=>{h.clear()})},{maxInboundStreams:this.maxInboundStopStreams,maxOutboundStreams:this.maxOutboundStopStreams,runOnLimitedConnection:!0}),await start(this.discovery,this.reservationStore),this.started=!0}async stop(){this.shutdownController.abort(),await stop(this.discovery,this.reservationStore),await this.registrar.unhandle(RELAY_V2_STOP_CODEC),this.started=!1}async dial(u,h){if(u.protoCodes().filter(T=>T===CIRCUIT_PROTO_CODE).length!==1){const T="Invalid circuit relay address";throw this.log.error(T,u),new DialError(T)}const y=u.toString().split("/p2p-circuit"),v=multiaddr(y[0]),b=multiaddr(y[y.length-1]),w=v.getPeerId(),E=b.getPeerId();if(w==null||E==null){const T=`ircuit relay dial to ${u.toString()} failed as address did not have both relay and destination PeerIDs`;throw this.log.error(`c${T}`),new DialError(`C${T}`)}const _=peerIdFromString$1(w),S=peerIdFromString$1(E);let R=this.connectionManager.getConnections(_)[0];R==null?(await this.peerStore.merge(_,{multiaddrs:[v]}),h.onProgress?.(new CustomProgressEvent("circuit-relay:open-connection")),R=await this.connectionManager.openConnection(_,h)):h.onProgress?.(new CustomProgressEvent("circuit-relay:reuse-connection"));let x;try{h.onProgress?.(new CustomProgressEvent("circuit-relay:open-hop-stream")),x=await R.newStream(RELAY_V2_HOP_CODEC,h);const T=pbStream$1(x),C=T.pb(HopMessage);h.onProgress?.(new CustomProgressEvent("circuit-relay:write-connect-message")),await C.write({type:HopMessage.Type.CONNECT,peer:{id:S.toMultihash().bytes,addrs:[multiaddr(b).bytes]}},h),h.onProgress?.(new CustomProgressEvent("circuit-relay:read-connect-response"));const I=await C.read(h);if(I.status!==Status.OK)throw new InvalidMessageError(`failed to connect via relay with status ${I?.status?.toString()??"undefined"}`);const L=new LimitTracker(I.limit),$=streamToMaConnection({stream:T.unwrap(),remoteAddr:u,localAddr:v.encapsulate(`/p2p-circuit/p2p/${this.peerId.toString()}`),log:this.log,onDataRead:L.onData,onDataWrite:L.onData}),B=await this.upgrader.upgradeOutbound($,{...h,limits:L.getLimits()});return B.log("outbound relayed connection established to %p with limits %o, over connection %s",B.remotePeer,I.limit??"none",R.id),B}catch(T){throw this.log.error("circuit relay dial to destination %p via relay %p failed",S,_,T),x?.abort(T),T}}createListener(u){return createListener({peerId:this.peerId,connectionManager:this.connectionManager,addressManager:this.addressManager,reservationStore:this.reservationStore,logger:this.logger})}listenFilter(u){return u=Array.isArray(u)?u:[u],u.filter(h=>CircuitListen.exactMatch(h)||CircuitSearch.exactMatch(h))}dialFilter(u){return u=Array.isArray(u)?u:[u],u.filter(h=>Circuit$1.exactMatch(h))}async onStop({connection:u,stream:h},y){if(!this.reservationStore.hasReservation(u.remotePeer))try{this.log("dialed via relay we did not have a reservation on, start listening on that relay address"),await this.transportManager.listen([u.remoteAddr.encapsulate("/p2p-circuit")])}catch(A){this.log.error("failed to listen on a relay peer we were dialed via but did not have a reservation on",A)}const v=pbStream$1(h).pb(StopMessage),b=await v.read({signal:y});if(this.log("new circuit relay v2 stop stream from %p with type %s",u.remotePeer,b.type),b?.type===void 0){this.log.error("type was missing from circuit v2 stop protocol request from %s",u.remotePeer),await v.write({type:StopMessage.Type.STATUS,status:Status.MALFORMED_MESSAGE},{signal:y}),await h.close();return}if(b.type!==StopMessage.Type.CONNECT){this.log.error("invalid stop connect request via peer %p",u.remotePeer),await v.write({type:StopMessage.Type.STATUS,status:Status.UNEXPECTED_MESSAGE},{signal:y}),await h.close();return}if(!isValidStop(b)){this.log.error("invalid stop connect request via peer %p",u.remotePeer),await v.write({type:StopMessage.Type.STATUS,status:Status.MALFORMED_MESSAGE},{signal:y}),await h.close({signal:y});return}const w=peerIdFromMultihash(decode$5(b.peer.id));if(await this.connectionGater.denyInboundRelayedConnection?.(u.remotePeer,w)===!0){this.log.error("connection gater denied inbound relayed connection from %p",u.remotePeer),await v.write({type:StopMessage.Type.STATUS,status:Status.PERMISSION_DENIED},{signal:y}),await h.close({signal:y});return}this.log.trace("sending success response to %p",u.remotePeer),await v.write({type:StopMessage.Type.STATUS,status:Status.OK},{signal:y});const E=new LimitTracker(b.limit),_=u.remoteAddr.encapsulate(`/p2p-circuit/p2p/${w.toString()}`);this.addressManager.getAddresses()[0];const S=streamToMaConnection({stream:v.unwrap().unwrap(),remoteAddr:_,log:this.log,onDataRead:E.onData,onDataWrite:E.onData});await this.upgrader.upgradeInbound(S,{limits:E.getLimits(),signal:y}),S.log("inbound relayed connection established to %p with limits %o, over connection %s",w,b.limit??"none",u.id)}}function circuitRelayTransport(g={}){return u=>new CircuitRelayTransport(u,g)}function createPaymentWorker({paymentStore:g,entity:u,events:h}){const y=async({payment:x,managerPeerId:T})=>(await g.create({peerId:T.toString(),payment:x}),h.safeDispatchEvent("payment:created",{detail:x}),x);return{createPayment:y,requestPayout:async({managerPeerIdStr:x})=>{const T=peerIdFromString$1(x),C={payoutRequest:{peerId:u.getPeerId().toString()}},[I,L]=await u.sendMessage(T,C);if(!I||L)throw new Error(`Error requesting payout: ${L}`);return await y({payment:I,managerPeerId:T}),I},getPayments:async({prefix:x,limit:T})=>await g.all({prefix:x,limit:T}),getPaginatedPayments:async({perPage:x,page:T,prefix:C})=>await g.getPaginatedPayments({prefix:C,page:T,perPage:x}),requestPaymentProof:async(x,T)=>{if(T.length===0)throw new Error("No payments to request proof for");const C={recipient:T[0].recipient,paymentAccount:T[0].paymentAccount,publicKey:T[0].publicKey,payments:T};return await u.sendMessage(peerIdFromString$1(x),{proofRequest:{...C}},{timeout:6e4})},getMaxNonce:async({managerPeerIdStr:x,managerPublicKey:T,recipient:C})=>await g.getHighestNonce({recipient:C,managerPublicKey:T,peerId:x}),getPaymentsFromNonce:async({nonce:x,peerId:T,publicKey:C,recipient:I})=>await g.getFrom({peerId:T,nonce:x,publicKey:C,recipient:I}),countPaymentAmount:async({managerPeerIdStr:x})=>await g.countAmount({peerId:x}),requestBulkProofs:async(x,T,C,I)=>{const L={paymentAccount:C,recipient:T,proofs:I};return await u.sendMessage(peerIdFromString$1(x),{bulkProofRequest:{...L}},{timeout:6e4})}}}function createTaskWorker({entity:g,taskStore:u,events:h,templateWorker:y}){const v=T=>({managerPeer:T.events.find(I=>I.type==="create")?.managerPeer});return{getTask:async({taskId:T,index:C="active"})=>{const I=await u.get({entityId:`${C}/${T}`});if(!I)throw new Error("Task not found");return I},getTasks:async({prefix:T=void 0,limit:C})=>{try{return await u.all({prefix:T,limit:C})}catch(I){throw console.error("Error getting tasks:",I),new Error("Failed to get tasks")}},createTask:async({task:T,managerPeerId:C})=>{await u.create({task:T,managerPeerId:C}),h.safeDispatchEvent("task:created",{detail:T})},completeTask:async({taskId:T,result:C})=>{try{const I=await u.complete({entityId:T,result:C}),{managerPeer:L}=v(I);if(!L)throw new Error("no manager peer found");const[$,B]=await g.sendMessage(peerIdFromString$1(L),{taskCompleted:{taskId:I.state.id,worker:g.toString(),result:C}});if(B)throw console.error("Error sending task completed message:",B),new Error("Failed to send task completed message");h.safeDispatchEvent("task:completed",{detail:I})}catch(I){I instanceof Error?(console.error("Error completing task:",I.message),await u.rollbackEvent({entityId:T,eventType:"complete"})):console.error("Error completing task:",I)}},acceptTask:async({taskId:T})=>{const C=await u.accept({entityId:T}),{managerPeer:I}=v(C);if(!I)throw new Error("no manager peer..");return await g.sendMessage(peerIdFromString$1(I),{taskAccepted:{timestamp:Math.floor(Date.now()/1e3),taskId:T,worker:g.node.peerId.toString()}}),h.safeDispatchEvent("task:accepted",{detail:C.state}),C},rejectTask:async({taskId:T,reason:C})=>{const I=await u.reject({entityId:T,reason:C}),{managerPeer:L}=v(I);if(!L)throw new Error("no manager peer found");const[$,B]=await g.sendMessage(peerIdFromString$1(L),{taskRejected:{timestamp:Math.floor(Date.now()/1e3),worker:g.toString(),taskId:T,reason:C}});h.safeDispatchEvent("task:rejected",{detail:{taskId:T,reason:C}})},renderTask:async({taskRecord:T})=>{const C=await y.getOrFetchTemplate({taskRecord:T,templateId:T.state.templateId});if(!C)throw new Error("Template not found");try{const I=JSON.parse(T.state.templateData);return C.data.replace(/\$\{([^}]+)\}/g,($,B)=>{const U=B.trim(),z=I[U];return z===void 0?"":typeof z=="string"?z.replace(/\\/g,"\\\\").replace(/"/g,'\\"'):z})}catch(I){throw console.error("Error parsing template data:",I),new Error("Failed to parse template data")}},cleanup:async()=>{const T=await u.all({prefix:"tasks/active"}),C=Math.floor(Date.now()/1e3),I=T.filter(L=>{const $=L.events[L.events.length-1];if($.type==="accept"){const B=$.timestamp;return C-B>L.state.timeLimitSeconds}if($.type==="create"){const B=$.timestamp;return C-B>600}return!1});for(const L of I)await u.expire({entityId:L.state.id}),h.safeDispatchEvent("task:expired",{detail:L})}}}function createTemplateWorker({entity:g,templateStore:u}){const h=async({taskRecord:E,templateId:_})=>{const S=await y(_);if(S)return S;const A=v(E);if(!A)throw new Error("Manager peer not found in task record");return b(_,A)},y=async E=>{try{return(await u.get({entityId:E}))?.state||null}catch{return null}},v=E=>E.events.find(_=>_.type==="create")?.managerPeer,b=async(E,_)=>{const S=peerIdFromString$1(_),A={templateId:E};try{const[R,x]=await g.sendMessage(S,{templateRequest:A});if(!R)throw new Error("No template returned from manager");return await w(R,_),R}catch{throw new Error("Template fetch failed")}},w=async(E,_)=>{try{await u.create({template:E,createdByPeer:_})}catch(S){console.error("Failed to cache template:",S)}};return{getOrFetchTemplate:h,cacheTemplate:w}}var createWorkerTaskStore=({datastore:g})=>{const u=createEntityStore({datastore:g,defaultPrefix:"tasks",stringify:S=>stringifyWithBigInt(S),parse:S=>parseWithBigInt(S)}),h=async({entityId:S,index:A="active"})=>{const R=await u.get({entityId:`${A}/${S}`});if(!R)throw new Error("Task not found");return R},y=async({entityId:S,record:A,index:R="active"})=>{await u.put({entityId:`${R}/${S}`,record:A})};return{...u,create:async({task:S,managerPeerId:A})=>{const R={events:[{timestamp:Math.floor(Date.now()/1e3),type:"create",managerPeer:A.toString()}],state:S};return await y({entityId:S.id,record:R}),R},complete:async({entityId:S,result:A})=>{const R=await h({entityId:S});if(R.events.some(C=>C.type==="complete"))throw new TaskValidationError("Task is already completed");const x=R.events[R.events.length-1];if(x.type!=="accept")throw new TaskValidationError("Task was not accepted..");if(Date.now()/1e3-x.timestamp>=R.state.timeLimitSeconds)throw new TaskExpiredError("Task has expired.");R.events.push({timestamp:Math.floor(Date.now()/1e3),type:"complete",result:A});const T=u.datastore.batch();return T.put(new Key(`/tasks/completed/${S}`),Buffer.from(stringifyWithBigInt(R))),T.delete(new Key(`/tasks/active/${S}`)),await T.commit(),R},accept:async({entityId:S})=>{const A=await h({entityId:S}),R=A.events.find(T=>T.type==="create");if(!R)throw new Error("Task not created.");if(Date.now()/1e3-R.timestamp>=TASK_ACCEPTANCE_TIME)throw new TaskExpiredError("Task has expired.");const x={timestamp:Math.floor(Date.now()/1e3),type:"accept"};return A.events.push(x),await y({entityId:S,record:A}),A},reject:async({entityId:S,reason:A})=>{const R=await h({entityId:S});if(R.events[R.events.length-1].type!=="create")throw new TaskValidationError("Task was not created.");R.events.push({timestamp:Math.floor(Date.now()/1e3),type:"reject",reason:A});const T=u.datastore.batch();return T.put(new Key(`/tasks/rejected/${S}`),Buffer.from(stringifyWithBigInt(R))),T.delete(new Key(`/tasks/active/${S}`)),await T.commit(),R},expire:async({entityId:S})=>{const A=await h({entityId:S});A.events.push({timestamp:Math.floor(Date.now()/1e3),type:"expire"});const R=u.datastore.batch();R.put(new Key(`/tasks/expired/${S}`),Buffer.from(stringifyWithBigInt(A))),R.delete(new Key(`/tasks/active/${S}`)),await R.commit()}}},Message$1;(function(g){(function(y){y.FIN="FIN",y.STOP_SENDING="STOP_SENDING",y.RESET="RESET",y.FIN_ACK="FIN_ACK"})(g.Flag||(g.Flag={}));let u;(function(y){y[y.FIN=0]="FIN",y[y.STOP_SENDING=1]="STOP_SENDING",y[y.RESET=2]="RESET",y[y.FIN_ACK=3]="FIN_ACK"})(u||(u={})),(function(y){y.codec=()=>enumeration(u)})(g.Flag||(g.Flag={}));let h;g.codec=()=>(h==null&&(h=message((y,v,b={})=>{b.lengthDelimited!==!1&&v.fork(),y.flag!=null&&(v.uint32(8),g.Flag.codec().encode(y.flag,v)),y.message!=null&&(v.uint32(18),v.bytes(y.message)),b.lengthDelimited!==!1&&v.ldelim()},(y,v,b={})=>{const w={},E=v==null?y.len:y.pos+v;for(;y.pos<E;){const _=y.uint32();switch(_>>>3){case 1:{w.flag=g.Flag.codec().decode(y);break}case 2:{w.message=y.bytes();break}default:{y.skipType(_&7);break}}}return w})),h),g.encode=y=>encodeMessage(y,g.codec()),g.decode=(y,v)=>decodeMessage(y,g.codec(),v)})(Message$1||(Message$1={}));const DEFAULT_ICE_SERVERS=["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478","stun:stun.cloudflare.com:3478","stun:stun.services.mozilla.com:3478"];Array.from("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890");const MAX_BUFFERED_AMOUNT=2*1024*1024,BUFFERED_AMOUNT_LOW_TIMEOUT=30*1e3,MAX_MESSAGE_SIZE=16*1024;function calculateProtobufOverhead(g=MAX_MESSAGE_SIZE){const u=encodingLength(g-encodingLength(g)),h=1+encodingLength(Object.keys(Message$1.Flag).length-1),y=1,v=g-u-h-y,b=encodingLength(v);return u+h+y+b}const PROTOBUF_OVERHEAD=calculateProtobufOverhead(),FIN_ACK_TIMEOUT=5e3,OPEN_TIMEOUT=5e3,DATA_CHANNEL_DRAIN_TIMEOUT=3e4,MUXER_PROTOCOL="/webrtc",SIGNALING_PROTOCOL="/webrtc-signaling/0.0.1";var __spreadArray=function(g,u,h){if(h||arguments.length===2)for(var y=0,v=u.length,b;y<v;y++)(b||!(y in u))&&(b||(b=Array.prototype.slice.call(u,0,y)),b[y]=u[y]);return g.concat(b||Array.prototype.slice.call(u))},BrowserInfo=(function(){function g(u,h,y){this.name=u,this.version=h,this.os=y,this.type="browser"}return g})(),NodeInfo=(function(){function g(u){this.version=u,this.type="node",this.name="node",this.os=process$1.platform}return g})(),SearchBotDeviceInfo=(function(){function g(u,h,y,v){this.name=u,this.version=h,this.os=y,this.bot=v,this.type="bot-device"}return g})(),BotInfo=(function(){function g(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return g})(),ReactNativeInfo=(function(){function g(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return g})(),SEARCHBOX_UA_REGEX=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,SEARCHBOT_OS_REGEX=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,REQUIRED_VERSION_PARTS=3,userAgentRules=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",SEARCHBOX_UA_REGEX]],operatingSystemRules=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function detect(g){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new ReactNativeInfo:typeof navigator<"u"?parseUserAgent(navigator.userAgent):getNodeVersion()}function matchUserAgent(g){return g!==""&&userAgentRules.reduce(function(u,h){var y=h[0],v=h[1];if(u)return u;var b=v.exec(g);return!!b&&[y,b]},!1)}function parseUserAgent(g){var u=matchUserAgent(g);if(!u)return null;var h=u[0],y=u[1];if(h==="searchbot")return new BotInfo;var v=y[1]&&y[1].split(".").join("_").split("_").slice(0,3);v?v.length<REQUIRED_VERSION_PARTS&&(v=__spreadArray(__spreadArray([],v,!0),createVersionParts(REQUIRED_VERSION_PARTS-v.length),!0)):v=[];var b=v.join("."),w=detectOS(g),E=SEARCHBOT_OS_REGEX.exec(g);return E&&E[1]?new SearchBotDeviceInfo(h,b,w,E[1]):new BrowserInfo(h,b,w)}function detectOS(g){for(var u=0,h=operatingSystemRules.length;u<h;u++){var y=operatingSystemRules[u],v=y[0],b=y[1],w=b.exec(g);if(w)return v}return null}function getNodeVersion(){var g=typeof process$1<"u"&&process$1.version;return g?new NodeInfo(process$1.version.slice(1)):null}function createVersionParts(g){for(var u=[],h=0;h<g;h++)u.push("0");return u}const browser$d=detect(),isFirefox=browser$d!=null&&browser$d.name==="firefox",nopSource=async function*(){},nopSink=async g=>{};function drainAndClose(g,u,h=DATA_CHANNEL_DRAIN_TIMEOUT,y){g.readyState==="open"&&Promise.resolve().then(async()=>{if(g.bufferedAmount>0){y.log("%s drain channel with %d buffered bytes",u,g.bufferedAmount);const v=pDefer();let b=!1;g.bufferedAmountLowThreshold=0;const w=()=>{b||(y.log("%s drain channel closed before drain",u),v.resolve())};g.addEventListener("close",w,{once:!0}),g.addEventListener("bufferedamountlow",()=>{b=!0,g.removeEventListener("close",w),v.resolve()}),await pTimeout(v.promise,{milliseconds:h})}}).then(async()=>{g.readyState==="open"&&g.close()}).catch(v=>{y.log.error("error closing outbound stream",v)})}async function getRtcConfiguration(g){return g=g??{},typeof g=="function"&&(g=await g()),g.iceServers=g.iceServers??DEFAULT_ICE_SERVERS.map(u=>({urls:[u]})),g}class WebRTCMultiaddrConnection{log;peerConnection;remoteAddr;timeline;metrics;source=nopSource();sink=nopSink;constructor(u,h){this.log=u.logger.forComponent("libp2p:webrtc:maconn"),this.remoteAddr=h.remoteAddr,this.timeline=h.timeline,this.peerConnection=h.peerConnection;const y=this.peerConnection,v=y.connectionState;this.peerConnection.onconnectionstatechange=()=>{this.log.trace("peer connection state change",y.connectionState,"initial state",v),(y.connectionState==="disconnected"||y.connectionState==="failed"||y.connectionState==="closed")&&(this.timeline.close=Date.now())}}async close(u){this.log.trace("closing connection"),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({close:!0})}abort(u){this.log.error("closing connection due to error",u),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({abort:!0})}}class WebRTCStream extends AbstractStream{channel;incomingData;maxBufferedAmount;bufferedAmountLowEventTimeout;maxMessageSize;receiveFinAck;finAckTimeout;openTimeout;closeController;constructor(u){const h=u.onEnd;switch(u.onEnd=v=>{this.log.trace('readable and writeable ends closed with status "%s"',this.status),Promise.resolve(async()=>{if(!(this.timeline.abort!=null||this.timeline.reset!==null))try{await pTimeout(this.receiveFinAck.promise,{milliseconds:this.finAckTimeout})}catch(b){this.log.error("error receiving FIN_ACK",b)}}).then(()=>{this.incomingData.end(),h?.(v)}).catch(b=>{this.log.error("error ending stream",b)}).finally(()=>{this.channel.close()})},super(u),this.channel=u.channel,this.channel.binaryType="arraybuffer",this.incomingData=pushable(),this.bufferedAmountLowEventTimeout=u.bufferedAmountLowEventTimeout??BUFFERED_AMOUNT_LOW_TIMEOUT,this.maxBufferedAmount=u.maxBufferedAmount??MAX_BUFFERED_AMOUNT,this.maxMessageSize=(u.maxMessageSize??MAX_MESSAGE_SIZE)-PROTOBUF_OVERHEAD,this.receiveFinAck=pDefer(),this.finAckTimeout=u.closeTimeout??FIN_ACK_TIMEOUT,this.openTimeout=u.openTimeout??OPEN_TIMEOUT,this.closeController=new AbortController,this.channel.readyState){case"open":this.timeline.open=new Date().getTime();break;case"closed":case"closing":(this.timeline.close===void 0||this.timeline.close===0)&&(this.timeline.close=Date.now());break;case"connecting":break;default:throw this.log.error("unknown datachannel state %s",this.channel.readyState),new StreamStateError("Unknown datachannel state")}this.channel.onopen=v=>{this.timeline.open=new Date().getTime()},this.channel.onclose=v=>{this.log.trace("received onclose event"),this.closeController.abort(),this.receiveFinAck.resolve(),this.close().catch(b=>{this.log.error("error closing stream after channel closed",b)})},this.channel.onerror=v=>{this.log.trace("received onerror event"),this.closeController.abort();const b=v.error;this.abort(b)},this.channel.onmessage=async v=>{const{data:b}=v;b===null||b.byteLength===0||this.incomingData.push(new Uint8Array(b,0,b.byteLength))};const y=this;Promise.resolve().then(async()=>{for await(const v of decode$2(this.incomingData)){const b=y.processIncomingProtobuf(v);b!=null&&y.sourcePush(new Uint8ArrayList(b))}}).catch(v=>{this.log.error("error processing incoming data channel messages",v)})}sendNewStream(){}async _sendMessage(u,h=!0){if(this.channel.readyState==="closed"||this.channel.readyState==="closing")throw new StreamStateError(`Invalid datachannel state - ${this.channel.readyState}`);if(this.channel.readyState!=="open"){const y=AbortSignal.timeout(this.openTimeout),v=anySignal([this.closeController.signal,y]);try{this.log('channel state is "%s" and not "open", waiting for "open" event before sending data',this.channel.readyState),await raceEvent(this.channel,"open",v)}finally{v.clear()}this.log('channel state is now "%s", sending data',this.channel.readyState)}if(h&&this.channel.bufferedAmount>this.maxBufferedAmount){const y=AbortSignal.timeout(this.bufferedAmountLowEventTimeout),v=anySignal([this.closeController.signal,y]);try{this.log('channel buffer is %d, wait for "bufferedamountlow" event',this.channel.bufferedAmount),await raceEvent(this.channel,"bufferedamountlow",v)}catch(b){throw y.aborted?new TimeoutError$1(`Timed out waiting for DataChannel buffer to clear after ${this.bufferedAmountLowEventTimeout}ms`):b}finally{v.clear()}}try{this.log.trace('sending message, channel state "%s"',this.channel.readyState),this.channel.send(u.subarray())}catch(y){this.log.error("error while sending message",y)}}async sendData(u){const h=u.byteLength;for(u=u.sublist();u.byteLength>0;){const y=Math.min(u.byteLength,this.maxMessageSize),v=u.subarray(0,y),b=Message$1.encode({message:v}),w=encode$1.single(b);this.log.trace("sending %d/%d bytes on channel",v.byteLength,h),await this._sendMessage(w),u.consume(y)}this.log.trace('finished sending data, channel state "%s"',this.channel.readyState)}async sendReset(){try{await this._sendFlag(Message$1.Flag.RESET)}catch(u){this.log.error("failed to send reset - %e",u)}finally{this.channel.close()}}async sendCloseWrite(u){if(this.channel.readyState!=="open"){this.receiveFinAck.resolve();return}if(await this._sendFlag(Message$1.Flag.FIN)){this.log.trace("awaiting FIN_ACK");try{await raceSignal$1(this.receiveFinAck.promise,u?.signal,{errorMessage:"sending close-write was aborted before FIN_ACK was received",errorName:"FinAckNotReceivedError"})}catch(y){this.log.error("failed to await FIN_ACK",y)}}else this.log.trace("sending FIN failed, not awaiting FIN_ACK");this.receiveFinAck.resolve()}async sendCloseRead(){this.channel.readyState==="open"&&await this._sendFlag(Message$1.Flag.STOP_SENDING)}processIncomingProtobuf(u){const h=Message$1.decode(u);if(h.flag!==void 0&&(this.log.trace('incoming flag %s, write status "%s", read status "%s"',h.flag,this.writeStatus,this.readStatus),h.flag===Message$1.Flag.FIN&&(this.remoteCloseWrite(),this.log.trace("sending FIN_ACK"),this._sendFlag(Message$1.Flag.FIN_ACK).catch(y=>{this.log.error("error sending FIN_ACK immediately",y)})),h.flag===Message$1.Flag.RESET&&this.reset(),h.flag===Message$1.Flag.STOP_SENDING&&this.remoteCloseRead(),h.flag===Message$1.Flag.FIN_ACK&&(this.log.trace("received FIN_ACK"),this.receiveFinAck.resolve())),this.readStatus==="ready")return h.message}async _sendFlag(u){if(this.channel.readyState!=="open")return this.log.trace('not sending flag %s because channel is "%s" and not "open"',u.toString(),this.channel.readyState),!1;this.log.trace("sending flag %s",u.toString());const h=Message$1.encode({flag:u}),y=encode$1.single(h);try{return await this._sendMessage(y,!1),!0}catch(v){this.log.error("could not send flag %s - %e",u.toString(),v)}return!1}}function createStream(g){const{channel:u,direction:h,handshake:y}=g;return new WebRTCStream({...g,id:`${u.id}`,log:g.log.newScope(`${y===!0?"handshake":h}:${u.id}`)})}class DataChannelMuxerFactory{protocol;peerConnection;bufferedStreams=[];metrics;dataChannelOptions;components;log;constructor(u,h){this.components=u,this.peerConnection=h.peerConnection,this.metrics=h.metrics,this.protocol=h.protocol??MUXER_PROTOCOL,this.dataChannelOptions=h.dataChannelOptions??{},this.log=u.logger.forComponent("libp2p:webrtc:muxerfactory"),this.peerConnection.ondatachannel=({channel:y})=>{if(this.log.trace('incoming early datachannel with channel id %d and label "%s"',y.id),y.label==="init"){this.log.trace("closing early init channel"),y.close();return}const v={},b=createStream({channel:y,direction:"inbound",onEnd:w=>{v.onEnd(w)},log:this.log,...this.dataChannelOptions});v.stream=b,v.channel=y,v.onEnd=()=>{this.bufferedStreams=this.bufferedStreams.filter(w=>w.stream.id!==b.id)},this.bufferedStreams.push(v)}}createStreamMuxer(u){return new DataChannelMuxer(this.components,{...u,peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,streams:this.bufferedStreams,protocol:this.protocol})}}class DataChannelMuxer{init;streams;protocol;log;peerConnection;dataChannelOptions;metrics;logger;constructor(u,h){this.init=h,this.log=h.log?.newScope("muxer")??u.logger.forComponent("libp2p:webrtc:muxer"),this.logger=u.logger,this.streams=h.streams.map(y=>y.stream),this.peerConnection=h.peerConnection,this.protocol=h.protocol??MUXER_PROTOCOL,this.metrics=h.metrics,this.dataChannelOptions=h.dataChannelOptions??{},this.peerConnection.ondatachannel=({channel:y})=>{if(this.log.trace("incoming datachannel with channel id %d",y.id),y.label==="init"){this.log.trace("closing init channel"),y.close();return}const v=y.id,b=createStream({channel:y,direction:"inbound",onEnd:()=>{this.#e(b,y),this.log("incoming channel %s ended",v)},log:this.log,...this.dataChannelOptions});this.streams.push(b),this.metrics?.increment({incoming_stream:!0}),h?.onIncomingStream?.(b)},this.init.streams.length>0&&queueMicrotask(()=>{this.init.streams.forEach(y=>{y.onEnd=()=>{this.log("incoming early channel %s ended with state %s",y.channel.id,y.channel.readyState),this.#e(y.stream,y.channel)},this.metrics?.increment({incoming_stream:!0}),this.init?.onIncomingStream?.(y.stream)})})}#e(u,h){this.log.trace("stream %s %s %s onEnd",u.direction,u.id,u.protocol),drainAndClose(h,`${u.direction} ${u.id} ${u.protocol}`,this.dataChannelOptions.drainTimeout,{log:this.log}),this.streams=this.streams.filter(y=>y.id!==u.id),this.metrics?.increment({stream_end:!0}),this.init?.onStreamEnd?.(u)}async close(u){try{await Promise.all(this.streams.map(async h=>h.close(u)))}catch(h){this.abort(h)}}abort(u){for(const h of this.streams)h.abort(u)}source=nopSource();sink=nopSink;newStream(){const u=this.peerConnection.createDataChannel(""),h=u.id;this.log.trace("opened outgoing datachannel with channel id %s",h);const y=createStream({channel:u,direction:"outbound",onEnd:()=>{this.#e(y,u),this.log("outgoing channel %s ended",h)},log:this.log,...this.dataChannelOptions});return this.streams.push(y),this.metrics?.increment({outgoing_stream:!0}),y}}const RTCPeerConnection=globalThis.RTCPeerConnection,RTCSessionDescription=globalThis.RTCSessionDescription,RTCIceCandidate=globalThis.RTCIceCandidate;class WebRTCTransportError extends Error{constructor(u){super(`WebRTC transport error: ${u}`),this.name="WebRTCTransportError"}}class SDPHandshakeFailedError extends WebRTCTransportError{constructor(u="SDP handshake failed"){super(u),this.name="SDPHandshakeFailedError"}}var Message;(function(g){(function(y){y.SDP_OFFER="SDP_OFFER",y.SDP_ANSWER="SDP_ANSWER",y.ICE_CANDIDATE="ICE_CANDIDATE"})(g.Type||(g.Type={}));let u;(function(y){y[y.SDP_OFFER=0]="SDP_OFFER",y[y.SDP_ANSWER=1]="SDP_ANSWER",y[y.ICE_CANDIDATE=2]="ICE_CANDIDATE"})(u||(u={})),(function(y){y.codec=()=>enumeration(u)})(g.Type||(g.Type={}));let h;g.codec=()=>(h==null&&(h=message((y,v,b={})=>{b.lengthDelimited!==!1&&v.fork(),y.type!=null&&(v.uint32(8),g.Type.codec().encode(y.type,v)),y.data!=null&&(v.uint32(18),v.string(y.data)),b.lengthDelimited!==!1&&v.ldelim()},(y,v,b={})=>{const w={},E=v==null?y.len:y.pos+v;for(;y.pos<E;){const _=y.uint32();switch(_>>>3){case 1:{w.type=g.Type.codec().decode(y);break}case 2:{w.data=y.string();break}default:{y.skipType(_&7);break}}}return w})),h),g.encode=y=>encodeMessage(y,g.codec()),g.decode=(y,v)=>decodeMessage(y,g.codec(),v)})(Message||(Message={}));const readCandidatesUntilConnected=async(g,u,h)=>{try{const y=pDefer();for(resolveOnConnected(g,y);;){const v=await Promise.race([y.promise,u.read({signal:h.signal}).catch(()=>{})]);if(v==null){h.signal?.throwIfAborted();break}if(v.type!==Message.Type.ICE_CANDIDATE)throw new InvalidMessageError("ICE candidate message expected");const b=JSON.parse(v.data??"null");if(b===""||b===null){h.onProgress?.(new CustomProgressEvent("webrtc:end-of-ice-candidates")),h.log.trace("end-of-candidates received");continue}const w=new RTCIceCandidate(b);h.log.trace("%s received new ICE candidate %o",h.direction,b);try{h.onProgress?.(new CustomProgressEvent("webrtc:add-ice-candidate",w.candidate)),await g.addIceCandidate(w)}catch(E){h.log.error("%s bad candidate received",h.direction,b,E)}}}catch(y){if(h.log.error("%s error parsing ICE candidate",h.direction,y),h.signal?.aborted===!0&&getConnectionState(g)!=="connected")throw y}};function getConnectionState(g){return isFirefox?g.iceConnectionState:g.connectionState}function resolveOnConnected(g,u){g[isFirefox?"oniceconnectionstatechange":"onconnectionstatechange"]=h=>{switch(getConnectionState(g)){case"connected":u.resolve();break;case"failed":case"disconnected":case"closed":u.reject(new ConnectionFailedError("RTCPeerConnection was closed"));break}}}async function initiateConnection({rtcConfiguration:g,dataChannel:u,signal:h,metrics:y,multiaddr:v,connectionManager:b,transportManager:w,log:E,logger:_,onProgress:S}){const{circuitAddress:A,targetPeer:R}=splitAddr(v);y?.dialerEvents.increment({open:!0}),E.trace("dialing circuit address: %a",A);const x=b.getConnections(R);let T;x.length===0?(S?.(new CustomProgressEvent("webrtc:dial-relay")),T=await w.dial(A,{signal:h,onProgress:S})):(S?.(new CustomProgressEvent("webrtc:reuse-relay-connection")),T=x[0]),S?.(new CustomProgressEvent("webrtc:open-signaling-stream"));const C=await T.newStream(SIGNALING_PROTOCOL,{signal:h,runOnLimitedConnection:!0}),I=pbStream$1(C).pb(Message),L=new RTCPeerConnection(g),$=new DataChannelMuxerFactory({logger:_},{peerConnection:L,dataChannelOptions:u});try{const B=L.createDataChannel("init");L.onicecandidate=({candidate:ue})=>{const he=JSON.stringify(ue?.toJSON()??null);E.trace("initiator sending ICE candidate %o",ue),I.write({type:Message.Type.ICE_CANDIDATE,data:he},{signal:h}).catch(Y=>{E.error("error sending ICE candidate",Y)})},L.onicecandidateerror=ue=>{E.error("initiator ICE candidate error",ue)};const U=await L.createOffer().catch(ue=>{throw E.error("could not execute createOffer",ue),new SDPHandshakeFailedError("Failed to set createOffer")});E.trace("initiator send SDP offer %s",U.sdp),S?.(new CustomProgressEvent("webrtc:send-sdp-offer")),await I.write({type:Message.Type.SDP_OFFER,data:U.sdp},{signal:h}),await L.setLocalDescription(U).catch(ue=>{throw E.error("could not execute setLocalDescription",ue),new SDPHandshakeFailedError("Failed to set localDescription")}),S?.(new CustomProgressEvent("webrtc:read-sdp-answer")),E.trace("initiator read SDP answer");const z=await I.read({signal:h});if(z.type!==Message.Type.SDP_ANSWER)throw new SDPHandshakeFailedError("Remote should send an SDP answer");E.trace("initiator received SDP answer %s",z.data);const ne=new RTCSessionDescription({type:"answer",sdp:z.data});return await L.setRemoteDescription(ne).catch(ue=>{throw E.error("could not execute setRemoteDescription",ue),new SDPHandshakeFailedError("Failed to set remoteDescription")}),E.trace("initiator read candidates until connected"),S?.(new CustomProgressEvent("webrtc:read-ice-candidates")),await readCandidatesUntilConnected(L,I,{direction:"initiator",signal:h,log:E,onProgress:S}),E.trace("initiator connected, closing init channel"),B.close(),S?.(new CustomProgressEvent("webrtc:close-signaling-stream")),E.trace("closing signaling channel"),await C.close({signal:h}),E.trace("initiator connected to remote address %s",v),{remoteAddress:v,peerConnection:L,muxerFactory:$}}catch(B){throw E.error("outgoing signaling error",B),L.close(),C.abort(B),B}finally{L.onicecandidate=null,L.onicecandidateerror=null}}const Circuit=fmt(P2P.matchers[0],code(CODE_P2P_CIRCUIT));class WebRTCPeerListener extends TypedEventEmitter{transportManager;shutdownController;events;constructor(u,h){super(),this.transportManager=u.transportManager,this.events=u.events,this.shutdownController=h.shutdownController,this.onTransportListening=this.onTransportListening.bind(this)}async listen(){this.events.addEventListener("transport:listening",this.onTransportListening)}onTransportListening(u){u.detail.getAddrs().filter(y=>Circuit.exactMatch(y)).map(y=>y.encapsulate("/webrtc")).length>0&&this.safeDispatchEvent("listening")}getAddrs(){return this.transportManager.getListeners().filter(u=>!(u instanceof WebRTCPeerListener)).map(u=>u.getAddrs().filter(h=>Circuit.exactMatch(h)).map(h=>h.encapsulate("/webrtc"))).flat()}updateAnnounceAddrs(){}async close(){this.events.removeEventListener("transport:listening",this.onTransportListening),this.shutdownController.abort(),queueMicrotask(()=>{this.safeDispatchEvent("close")})}}async function handleIncomingStream({peerConnection:g,stream:u,signal:h,connection:y,log:v}){v.trace("new inbound signaling stream");const b=pbStream$1(u).pb(Message);try{g.onicecandidate=({candidate:A})=>{const R=JSON.stringify(A?.toJSON()??null);v.trace("recipient sending ICE candidate %s",R),b.write({type:Message.Type.ICE_CANDIDATE,data:R},{signal:h}).catch(x=>{v.error("error sending ICE candidate",x)})},v.trace("recipient read SDP offer");const E=await b.read({signal:h});if(E.type!==Message.Type.SDP_OFFER)throw new SDPHandshakeFailedError(`expected message type SDP_OFFER, received: ${E.type??"undefined"} `);v.trace("recipient received SDP offer %s",E.data);const _=new RTCSessionDescription({type:"offer",sdp:E.data});await g.setRemoteDescription(_).catch(A=>{throw v.error("could not execute setRemoteDescription",A),new SDPHandshakeFailedError("Failed to set remoteDescription")});const S=await g.createAnswer().catch(A=>{throw v.error("could not execute createAnswer",A),new SDPHandshakeFailedError("Failed to create answer")});v.trace("recipient send SDP answer %s",S.sdp),await b.write({type:Message.Type.SDP_ANSWER,data:S.sdp},{signal:h}),await g.setLocalDescription(S).catch(A=>{throw v.error("could not execute setLocalDescription",A),new SDPHandshakeFailedError("Failed to set localDescription")}),v.trace("recipient read candidates until connected"),await readCandidatesUntilConnected(g,b,{direction:"recipient",signal:h,log:v})}catch(E){if(getConnectionState(g)!=="connected")throw v.error("error while handling signaling stream from peer %a",y.remoteAddr,E),g.close(),E;v("error while handling signaling stream from peer %a, ignoring as the RTCPeerConnection is already connected",y.remoteAddr,E)}const w=multiaddr(`/webrtc/p2p/${y.remoteAddr.getPeerId()}`);return v.trace("recipient connected to remote address %s",w),{remoteAddress:w}}class WebRTCTransport{components;init;log;_started=!1;metrics;shutdownController;constructor(u,h={}){this.components=u,this.init=h,this.log=u.logger.forComponent("libp2p:webrtc"),this.shutdownController=new AbortController,this.shutdownController.signal,u.metrics!=null&&(this.metrics={dialerEvents:u.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dialer events by type"}),listenerEvents:u.metrics.registerCounterGroup("libp2p_webrtc_listener_events_total",{label:"event",help:"Total count of WebRTC listener events by type"})})}[transportSymbol]=!0;[Symbol.toStringTag]="@libp2p/webrtc";[serviceCapabilities]=["@libp2p/transport"];[serviceDependencies]=["@libp2p/identify","@libp2p/circuit-relay-v2-transport"];isStarted(){return this._started}async start(){await this.components.registrar.handle(SIGNALING_PROTOCOL,u=>{const h=this.components.upgrader.createInboundAbortSignal(this.shutdownController.signal);this._onProtocol(u,h).catch(y=>{this.log.error("failed to handle incoming connect from %p",u.connection.remotePeer,y)}).finally(()=>{h.clear()})},{runOnLimitedConnection:!0}),this._started=!0}async stop(){await this.components.registrar.unhandle(SIGNALING_PROTOCOL),this._started=!1}createListener(u){return new WebRTCPeerListener(this.components,{shutdownController:this.shutdownController})}listenFilter(u){return u.filter(WebRTC.exactMatch)}dialFilter(u){return this.listenFilter(u)}async dial(u,h){this.log.trace("dialing address: %a",u);const{remoteAddress:y,peerConnection:v,muxerFactory:b}=await initiateConnection({rtcConfiguration:await getRtcConfiguration(this.init.rtcConfiguration),dataChannel:this.init.dataChannel,multiaddr:u,dataChannelOptions:this.init.dataChannel,signal:h.signal,connectionManager:this.components.connectionManager,transportManager:this.components.transportManager,log:this.log,logger:this.components.logger,onProgress:h.onProgress}),w=new WebRTCMultiaddrConnection(this.components,{peerConnection:v,timeline:{open:Date.now()},remoteAddr:y,metrics:this.metrics?.dialerEvents}),E=await h.upgrader.upgradeOutbound(w,{skipProtection:!0,skipEncryption:!0,muxerFactory:b,onProgress:h.onProgress,signal:h.signal});return this._closeOnShutdown(v,w),E}async _onProtocol({connection:u,stream:h},y){const v=new RTCPeerConnection(await getRtcConfiguration(this.init.rtcConfiguration)),b=new DataChannelMuxerFactory(this.components,{peerConnection:v,dataChannelOptions:this.init.dataChannel});try{const{remoteAddress:w}=await handleIncomingStream({peerConnection:v,connection:u,stream:h,signal:y,log:this.log});await h.close({signal:y});const E=new WebRTCMultiaddrConnection(this.components,{peerConnection:v,timeline:{open:new Date().getTime()},remoteAddr:w,metrics:this.metrics?.listenerEvents});await this.components.upgrader.upgradeInbound(E,{skipEncryption:!0,skipProtection:!0,muxerFactory:b,signal:y}),this._closeOnShutdown(v,E)}catch(w){throw this.log.error("incoming signaling error",w),v.close(),h.abort(w),w}}_closeOnShutdown(u,h){const y=()=>{h.close().catch(v=>{this.log.error("could not close WebRTCMultiaddrConnection",v)})};this.shutdownController.signal.addEventListener("abort",y),u.addEventListener("close",()=>{this.shutdownController.signal.removeEventListener("abort",y)})}}function splitAddr(g){const u=g.getComponents().filter(({name:y})=>y==="p2p").map(({value:y})=>y).pop();if(u==null)throw new InvalidParametersError$1("Destination peer id was missing");return{circuitAddress:multiaddr(g.getComponents().filter(({name:y})=>y!=="webrtc")),targetPeer:peerIdFromString$1(u)}}function webRTC(g){return u=>new WebRTCTransport(u,g)}const setInterval$1=globalThis.setInterval;var createWorkerEntity=async({datastore:g,privateKey:u})=>await createEffectEntity({protocol:{name:PROTOCOL_NAME,version:PROTOCOL_VERSION,scheme:EffectProtocolMessage},transports:[new Libp2pTransport({privateKey:u,datastore:g,autoStart:!1,listen:["/p2p-circuit","/webrtc"],announce:[],transports:[webSockets(),webRTC(),circuitRelayTransport()]})]}),createWorker=async({datastore:g,privateKey:u,autoExpire:h=!0})=>{const y=u instanceof Uint8Array?await generateKeyPairFromSeed("Ed25519",u):u,v=new TypedEventEmitter,b=await createWorkerEntity({datastore:g,privateKey:y}),w=createWorkerTaskStore({datastore:g}),E=createPaymentStore({datastore:g}),_=createTemplateStore({datastore:g}),S=createTemplateWorker({entity:b,templateStore:_}),{createPayment:A,getPayments:R,getPaginatedPayments:x,countPaymentAmount:T,requestPayout:C,getPaymentsFromNonce:I,requestPaymentProof:L,requestBulkProofs:$,getMaxNonce:B}=createPaymentWorker({entity:b,events:v,paymentStore:E}),{createTask:U,acceptTask:z,rejectTask:ne,completeTask:ue,renderTask:he,getTask:Y,getTasks:X,cleanup:J}=createTaskWorker({entity:b,events:v,taskStore:w,templateWorker:S});b.onMessage("task",async(k,{peerId:q})=>{await U({task:k,managerPeerId:q})}).onMessage("payment",async(k,{peerId:q})=>{await A({payment:k,managerPeerId:q})});const j=async()=>{await b.node.start()},M=async()=>{await b.node.stop()},N=async k=>{const[q,F]=await b.sendMessage(k,{identifyRequest:{timestamp:Math.floor(Date.now()/1e3)}});if(!q)throw new Error("Failed to identify manager");return q},P=async(k,{recipient:q,nonce:F,capabilities:H,accessCode:D})=>{const[G,W]=await b.sendMessage(k,{requestToWork:{timestamp:Math.floor(Date.now()/1e3),recipient:q,nonce:F,capabilities:H.join(","),accessCode:D}});if(W)throw new Error(`Failed to connect to manager: ${W}`);return G},O=async k=>await b.node.services.ping.ping(k);return h&&setInterval$1(async()=>{await J()},1e3),{entity:b,events:v,taskStore:w,getTask:Y,getTasks:X,acceptTask:z,rejectTask:ne,completeTask:ue,renderTask:he,getMaxNonce:B,getPayments:R,getPaymentsFromNonce:I,getPaginatedPayments:x,countPaymentAmount:T,requestPayout:C,requestPaymentProof:L,requestBulkProofs:$,identify:N,connect:P,start:j,stop:M,ping:O}};const SHARDING_FN="SHARDING";new Key(SHARDING_FN);logger("datastore:core:tiered");const instanceOfAny=(g,u)=>u.some(h=>g instanceof h);let idbProxyableTypes,cursorAdvanceMethods;function getIdbProxyableTypes(){return idbProxyableTypes||(idbProxyableTypes=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function getCursorAdvanceMethods(){return cursorAdvanceMethods||(cursorAdvanceMethods=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const transactionDoneMap=new WeakMap,transformCache=new WeakMap,reverseTransformCache=new WeakMap;function promisifyRequest(g){const u=new Promise((h,y)=>{const v=()=>{g.removeEventListener("success",b),g.removeEventListener("error",w)},b=()=>{h(wrap(g.result)),v()},w=()=>{y(g.error),v()};g.addEventListener("success",b),g.addEventListener("error",w)});return reverseTransformCache.set(u,g),u}function cacheDonePromiseForTransaction(g){if(transactionDoneMap.has(g))return;const u=new Promise((h,y)=>{const v=()=>{g.removeEventListener("complete",b),g.removeEventListener("error",w),g.removeEventListener("abort",w)},b=()=>{h(),v()},w=()=>{y(g.error||new DOMException("AbortError","AbortError")),v()};g.addEventListener("complete",b),g.addEventListener("error",w),g.addEventListener("abort",w)});transactionDoneMap.set(g,u)}let idbProxyTraps={get(g,u,h){if(g instanceof IDBTransaction){if(u==="done")return transactionDoneMap.get(g);if(u==="store")return h.objectStoreNames[1]?void 0:h.objectStore(h.objectStoreNames[0])}return wrap(g[u])},set(g,u,h){return g[u]=h,!0},has(g,u){return g instanceof IDBTransaction&&(u==="done"||u==="store")?!0:u in g}};function replaceTraps(g){idbProxyTraps=g(idbProxyTraps)}function wrapFunction(g){return getCursorAdvanceMethods().includes(g)?function(...u){return g.apply(unwrap(this),u),wrap(this.request)}:function(...u){return wrap(g.apply(unwrap(this),u))}}function transformCachableValue(g){return typeof g=="function"?wrapFunction(g):(g instanceof IDBTransaction&&cacheDonePromiseForTransaction(g),instanceOfAny(g,getIdbProxyableTypes())?new Proxy(g,idbProxyTraps):g)}function wrap(g){if(g instanceof IDBRequest)return promisifyRequest(g);if(transformCache.has(g))return transformCache.get(g);const u=transformCachableValue(g);return u!==g&&(transformCache.set(g,u),reverseTransformCache.set(u,g)),u}const unwrap=g=>reverseTransformCache.get(g);function openDB(g,u,{blocked:h,upgrade:y,blocking:v,terminated:b}={}){const w=indexedDB.open(g,u),E=wrap(w);return y&&w.addEventListener("upgradeneeded",_=>{y(wrap(w.result),_.oldVersion,_.newVersion,wrap(w.transaction),_)}),h&&w.addEventListener("blocked",_=>h(_.oldVersion,_.newVersion,_)),E.then(_=>{b&&_.addEventListener("close",()=>b()),v&&_.addEventListener("versionchange",S=>v(S.oldVersion,S.newVersion,S))}).catch(()=>{}),E}function deleteDB(g,{blocked:u}={}){const h=indexedDB.deleteDatabase(g);return u&&h.addEventListener("blocked",y=>u(y.oldVersion,y)),wrap(h).then(()=>{})}const readMethods=["get","getKey","getAll","getAllKeys","count"],writeMethods=["put","add","delete","clear"],cachedMethods=new Map;function getMethod(g,u){if(!(g instanceof IDBDatabase&&!(u in g)&&typeof u=="string"))return;if(cachedMethods.get(u))return cachedMethods.get(u);const h=u.replace(/FromIndex$/,""),y=u!==h,v=writeMethods.includes(h);if(!(h in(y?IDBIndex:IDBObjectStore).prototype)||!(v||readMethods.includes(h)))return;const b=async function(w,...E){const _=this.transaction(w,v?"readwrite":"readonly");let S=_.store;return y&&(S=S.index(E.shift())),(await Promise.all([S[h](...E),v&&_.done]))[0]};return cachedMethods.set(u,b),b}replaceTraps(g=>({...g,get:(u,h,y)=>getMethod(u,h)||g.get(u,h,y),has:(u,h)=>!!getMethod(u,h)||g.has(u,h)}));const advanceMethodProps=["continue","continuePrimaryKey","advance"],methodMap={},advanceResults=new WeakMap,ittrProxiedCursorToOriginalProxy=new WeakMap,cursorIteratorTraps={get(g,u){if(!advanceMethodProps.includes(u))return g[u];let h=methodMap[u];return h||(h=methodMap[u]=function(...y){advanceResults.set(this,ittrProxiedCursorToOriginalProxy.get(this)[u](...y))}),h}};async function*iterate(...g){let u=this;if(u instanceof IDBCursor||(u=await u.openCursor(...g)),!u)return;u=u;const h=new Proxy(u,cursorIteratorTraps);for(ittrProxiedCursorToOriginalProxy.set(h,u),reverseTransformCache.set(h,unwrap(u));u;)yield h,u=await(advanceResults.get(h)||u.continue()),advanceResults.delete(h)}function isIteratorProp(g,u){return u===Symbol.asyncIterator&&instanceOfAny(g,[IDBIndex,IDBObjectStore,IDBCursor])||u==="iterate"&&instanceOfAny(g,[IDBIndex,IDBObjectStore])}replaceTraps(g=>({...g,get(u,h,y){return isIteratorProp(u,h)?iterate:g.get(u,h,y)},has(u,h){return isIteratorProp(u,h)||g.has(u,h)}}));function defaultTranslate(g){return g.reason}async function raceSignal(g,u,h){if(u==null)return g;const y=defaultTranslate;if(u.aborted)return g.catch(()=>{}),Promise.reject(y(u));let v;try{return await Promise.race([g,new Promise((b,w)=>{v=()=>{w(y(u))},u.addEventListener("abort",v)})])}finally{v!=null&&u.removeEventListener("abort",v)}}class IDBDatastore extends BaseDatastore{location;version;db;constructor(u,h={}){super(),this.location=`${h.prefix??""}${u}`,this.version=h.version??1}async open(){try{const u=this.location;this.db=await openDB(u,this.version,{upgrade(h){h.createObjectStore(u)}})}catch(u){throw new OpenFailedError(String(u))}}async close(){this.db?.close()}async put(u,h,y){if(this.db==null)throw new Error("Datastore needs to be opened.");try{y?.signal?.throwIfAborted(),await raceSignal(this.db.put(this.location,h,u.toString()),y?.signal)}catch(v){throw new PutFailedError(String(v))}return u}async get(u,h){if(this.db==null)throw new Error("Datastore needs to be opened.");let y;try{h?.signal?.throwIfAborted(),y=await raceSignal(this.db.get(this.location,u.toString()),h?.signal)}catch(v){throw new GetFailedError(String(v))}if(y===void 0)throw new NotFoundError;return y}async has(u,h){if(this.db==null)throw new Error("Datastore needs to be opened.");try{return h?.signal?.throwIfAborted(),!!await raceSignal(this.db.getKey(this.location,u.toString()))}catch(y){throw new GetFailedError(String(y))}}async delete(u,h){if(this.db==null)throw new Error("Datastore needs to be opened.");try{h?.signal?.throwIfAborted(),await raceSignal(this.db.delete(this.location,u.toString()),h?.signal)}catch(y){throw new DeleteFailedError(String(y))}}batch(){const u=[],h=[];return{put(y,v){u.push({key:y,value:v})},delete(y){h.push(y)},commit:async y=>{if(this.db==null)throw new Error("Datastore needs to be opened.");y?.signal?.throwIfAborted();const v=this.db.transaction(this.location,"readwrite");try{const b=u.filter(({key:w})=>h.find(E=>E.toString()===w.toString())==null).map(w=>async()=>{await v.store.put(w.value,w.key.toString())}).concat(h.map(w=>async()=>{await v.store.delete(w.toString())})).concat(async()=>{await v.done});y?.signal?.throwIfAborted(),await raceSignal(Promise.all(b.map(async w=>{await w()})),y?.signal)}catch{v.abort()}}}}async*query(u,h){let y=this.#e(u,(v,b)=>({key:v,value:b}),h);Array.isArray(u.filters)&&(y=u.filters.reduce((v,b)=>filter(v,b),y)),Array.isArray(u.orders)&&(y=u.orders.reduce((v,b)=>sort(v,b),y)),yield*y}async*queryKeys(u,h){let y=this.#e(u,v=>v,h);Array.isArray(u.filters)&&(y=u.filters.reduce((v,b)=>filter(v,b),y)),Array.isArray(u.orders)&&(y=u.orders.reduce((v,b)=>sort(v,b),y)),yield*y}async*#e(u,h,y){if(this.db==null)throw new Error("Datastore needs to be opened.");let v=0,b=-1;y?.signal?.throwIfAborted();for(const w of await this.db.getAllKeys(this.location)){if(y?.signal?.throwIfAborted(),u.prefix!=null&&!w.toString().startsWith(u.prefix))continue;if(u.limit!=null&&v===u.limit)return;if(b++,u.offset!=null&&b<u.offset)continue;const E=new Key(w.toString());let _;try{_=await this.get(E,y)}catch(S){if(S.name!=="NotFoundError")throw S;continue}_!=null&&(yield h(E,_),y?.signal?.throwIfAborted(),v++)}}async destroy(){await deleteDB(this.location)}}const useWorkerStore=defineStore("worker",()=>{const g=ref$1(null),u=ref$1("idle"),h=ref$1(null),y=shallowRef(null),v=computed(()=>h.value?peerIdFromPrivateKey(h.value):null),b=computed(()=>u.value==="active"&&g.value!==null);return{instance:g,peerId:v,status:u,initialize:async _=>{b.value||(u.value="initializing",h.value=await generateKeyPairFromSeed("Ed25519",_),y.value=new IDBDatastore(`/effect-ai/v4/worker/${v.value?.toString()}`),await y.value.open(),g.value=await createWorker({datastore:y.value,privateKey:h.value,autoExpire:!0}),await g.value.start(),u.value="active")},isInitialized:b,destroy:async()=>{g.value&&(await g.value.stop(),g.value=null),y.value&&(y.value=null)},datastore:y,keypair:h}});function ownKeys(g,u){var h=Object.keys(g);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(g);u&&(y=y.filter(function(v){return Object.getOwnPropertyDescriptor(g,v).enumerable})),h.push.apply(h,y)}return h}function _objectSpread2(g){for(var u=1;u<arguments.length;u++){var h=arguments[u]!=null?arguments[u]:{};u%2?ownKeys(Object(h),!0).forEach(function(y){_defineProperty(g,y,h[y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(h)):ownKeys(Object(h)).forEach(function(y){Object.defineProperty(g,y,Object.getOwnPropertyDescriptor(h,y))})}return g}function number(g){if(!Number.isSafeInteger(g)||g<0)throw new Error(`positive integer expected, not ${g}`)}function bool(g){if(typeof g!="boolean")throw new Error(`boolean expected, not ${g}`)}function isBytes$1(g){return g instanceof Uint8Array||g!=null&&typeof g=="object"&&g.constructor.name==="Uint8Array"}function bytes(g,...u){if(!isBytes$1(g))throw new Error("Uint8Array expected");if(u.length>0&&!u.includes(g.length))throw new Error(`Uint8Array expected of length ${u}, not of length=${g.length}`)}function hash$2(g){if(typeof g!="function"||typeof g.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number(g.outputLen),number(g.blockLen)}function exists(g,u=!0){if(g.destroyed)throw new Error("Hash instance has been destroyed");if(u&&g.finished)throw new Error("Hash#digest() has already been called")}function output(g,u){bytes(g);const h=u.outputLen;if(g.length<h)throw new Error(`digestInto() expects output buffer of length at least ${h}`)}const assert$1={number,bool,bytes,hash:hash$2,exists,output},crypto$1=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const u32=g=>new Uint32Array(g.buffer,g.byteOffset,Math.floor(g.byteLength/4)),createView=g=>new DataView(g.buffer,g.byteOffset,g.byteLength),rotr=(g,u)=>g<<32-u|g>>>u,isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68,byteSwap=g=>g<<24&4278190080|g<<8&16711680|g>>>8&65280|g>>>24&255;function byteSwap32(g){for(let u=0;u<g.length;u++)g[u]=byteSwap(g[u])}function utf8ToBytes$1(g){if(typeof g!="string")throw new Error(`utf8ToBytes expected string, got ${typeof g}`);return new Uint8Array(new TextEncoder().encode(g))}function toBytes(g){return typeof g=="string"&&(g=utf8ToBytes$1(g)),bytes(g),g}function concatBytes$1(...g){let u=0;for(let y=0;y<g.length;y++){const v=g[y];bytes(v),u+=v.length}const h=new Uint8Array(u);for(let y=0,v=0;y<g.length;y++){const b=g[y];h.set(b,v),v+=b.length}return h}class Hash{clone(){return this._cloneInto()}}function wrapConstructor(g){const u=y=>g().update(toBytes(y)).digest(),h=g();return u.outputLen=h.outputLen,u.blockLen=h.blockLen,u.create=()=>g(),u}function randomBytes$1(g=32){if(crypto$1&&typeof crypto$1.getRandomValues=="function")return crypto$1.getRandomValues(new Uint8Array(g));throw new Error("crypto.getRandomValues must be defined")}class HMAC extends Hash{constructor(u,h){super(),this.finished=!1,this.destroyed=!1,hash$2(u);const y=toBytes(h);if(this.iHash=u.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const v=this.blockLen,b=new Uint8Array(v);b.set(y.length>v?u.create().update(y).digest():y);for(let w=0;w<b.length;w++)b[w]^=54;this.iHash.update(b),this.oHash=u.create();for(let w=0;w<b.length;w++)b[w]^=106;this.oHash.update(b),b.fill(0)}update(u){return exists(this),this.iHash.update(u),this}digestInto(u){exists(this),bytes(u,this.outputLen),this.finished=!0,this.iHash.digestInto(u),this.oHash.update(u),this.oHash.digestInto(u),this.destroy()}digest(){const u=new Uint8Array(this.oHash.outputLen);return this.digestInto(u),u}_cloneInto(u){u||(u=Object.create(Object.getPrototypeOf(this),{}));const{oHash:h,iHash:y,finished:v,destroyed:b,blockLen:w,outputLen:E}=this;return u=u,u.finished=v,u.destroyed=b,u.blockLen=w,u.outputLen=E,u.oHash=h._cloneInto(u.oHash),u.iHash=y._cloneInto(u.iHash),u}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const hmac$1=(g,u,h)=>new HMAC(g,u).update(h).digest();hmac$1.create=(g,u)=>new HMAC(g,u);function setBigUint64(g,u,h,y){if(typeof g.setBigUint64=="function")return g.setBigUint64(u,h,y);const v=BigInt(32),b=BigInt(4294967295),w=Number(h>>v&b),E=Number(h&b),_=y?4:0,S=y?0:4;g.setUint32(u+_,w,y),g.setUint32(u+S,E,y)}const Chi=(g,u,h)=>g&u^~g&h,Maj=(g,u,h)=>g&u^g&h^u&h;class HashMD extends Hash{constructor(u,h,y,v){super(),this.blockLen=u,this.outputLen=h,this.padOffset=y,this.isLE=v,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(u),this.view=createView(this.buffer)}update(u){exists(this);const{view:h,buffer:y,blockLen:v}=this;u=toBytes(u);const b=u.length;for(let w=0;w<b;){const E=Math.min(v-this.pos,b-w);if(E===v){const _=createView(u);for(;v<=b-w;w+=v)this.process(_,w);continue}y.set(u.subarray(w,w+E),this.pos),this.pos+=E,w+=E,this.pos===v&&(this.process(h,0),this.pos=0)}return this.length+=u.length,this.roundClean(),this}digestInto(u){exists(this),output(u,this),this.finished=!0;const{buffer:h,view:y,blockLen:v,isLE:b}=this;let{pos:w}=this;h[w++]=128,this.buffer.subarray(w).fill(0),this.padOffset>v-w&&(this.process(y,0),w=0);for(let R=w;R<v;R++)h[R]=0;setBigUint64(y,v-8,BigInt(this.length*8),b),this.process(y,0);const E=createView(u),_=this.outputLen;if(_%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const S=_/4,A=this.get();if(S>A.length)throw new Error("_sha2: outputLen bigger than state");for(let R=0;R<S;R++)E.setUint32(4*R,A[R],b)}digest(){const{buffer:u,outputLen:h}=this;this.digestInto(u);const y=u.slice(0,h);return this.destroy(),y}_cloneInto(u){u||(u=new this.constructor),u.set(...this.get());const{blockLen:h,buffer:y,length:v,finished:b,destroyed:w,pos:E}=this;return u.length=v,u.pos=E,u.finished=b,u.destroyed=w,v%h&&u.buffer.set(y),u}}const SHA256_K=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_IV=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W=new Uint32Array(64);class SHA256 extends HashMD{constructor(){super(64,32,8,!1),this.A=SHA256_IV[0]|0,this.B=SHA256_IV[1]|0,this.C=SHA256_IV[2]|0,this.D=SHA256_IV[3]|0,this.E=SHA256_IV[4]|0,this.F=SHA256_IV[5]|0,this.G=SHA256_IV[6]|0,this.H=SHA256_IV[7]|0}get(){const{A:u,B:h,C:y,D:v,E:b,F:w,G:E,H:_}=this;return[u,h,y,v,b,w,E,_]}set(u,h,y,v,b,w,E,_){this.A=u|0,this.B=h|0,this.C=y|0,this.D=v|0,this.E=b|0,this.F=w|0,this.G=E|0,this.H=_|0}process(u,h){for(let R=0;R<16;R++,h+=4)SHA256_W[R]=u.getUint32(h,!1);for(let R=16;R<64;R++){const x=SHA256_W[R-15],T=SHA256_W[R-2],C=rotr(x,7)^rotr(x,18)^x>>>3,I=rotr(T,17)^rotr(T,19)^T>>>10;SHA256_W[R]=I+SHA256_W[R-7]+C+SHA256_W[R-16]|0}let{A:y,B:v,C:b,D:w,E,F:_,G:S,H:A}=this;for(let R=0;R<64;R++){const x=rotr(E,6)^rotr(E,11)^rotr(E,25),T=A+x+Chi(E,_,S)+SHA256_K[R]+SHA256_W[R]|0,I=(rotr(y,2)^rotr(y,13)^rotr(y,22))+Maj(y,v,b)|0;A=S,S=_,_=E,E=w+T|0,w=b,b=v,v=y,y=T+I|0}y=y+this.A|0,v=v+this.B|0,b=b+this.C|0,w=w+this.D|0,E=E+this.E|0,_=_+this.F|0,S=S+this.G|0,A=A+this.H|0,this.set(y,v,b,w,E,_,S,A)}roundClean(){SHA256_W.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const sha256$2=wrapConstructor(()=>new SHA256),U32_MASK64=BigInt(2**32-1),_32n=BigInt(32);function fromBig(g,u=!1){return u?{h:Number(g&U32_MASK64),l:Number(g>>_32n&U32_MASK64)}:{h:Number(g>>_32n&U32_MASK64)|0,l:Number(g&U32_MASK64)|0}}function split(g,u=!1){let h=new Uint32Array(g.length),y=new Uint32Array(g.length);for(let v=0;v<g.length;v++){const{h:b,l:w}=fromBig(g[v],u);[h[v],y[v]]=[b,w]}return[h,y]}const rotlSH=(g,u,h)=>g<<h|u>>>32-h,rotlSL=(g,u,h)=>u<<h|g>>>32-h,rotlBH=(g,u,h)=>u<<h-32|g>>>64-h,rotlBL=(g,u,h)=>g<<h-32|u>>>64-h;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$4=BigInt(0),_1n$5=BigInt(1),_2n$3=BigInt(2);function isBytes(g){return g instanceof Uint8Array||g!=null&&typeof g=="object"&&g.constructor.name==="Uint8Array"}function abytes(g){if(!isBytes(g))throw new Error("Uint8Array expected")}const hexes=Array.from({length:256},(g,u)=>u.toString(16).padStart(2,"0"));function bytesToHex(g){abytes(g);let u="";for(let h=0;h<g.length;h++)u+=hexes[g[h]];return u}function numberToHexUnpadded(g){const u=g.toString(16);return u.length&1?`0${u}`:u}function hexToNumber(g){if(typeof g!="string")throw new Error("hex string expected, got "+typeof g);return BigInt(g===""?"0":`0x${g}`)}const asciis={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function asciiToBase16(g){if(g>=asciis._0&&g<=asciis._9)return g-asciis._0;if(g>=asciis._A&&g<=asciis._F)return g-(asciis._A-10);if(g>=asciis._a&&g<=asciis._f)return g-(asciis._a-10)}function hexToBytes$1(g){if(typeof g!="string")throw new Error("hex string expected, got "+typeof g);const u=g.length,h=u/2;if(u%2)throw new Error("padded hex string expected, got unpadded hex of length "+u);const y=new Uint8Array(h);for(let v=0,b=0;v<h;v++,b+=2){const w=asciiToBase16(g.charCodeAt(b)),E=asciiToBase16(g.charCodeAt(b+1));if(w===void 0||E===void 0){const _=g[b]+g[b+1];throw new Error('hex string expected, got non-hex character "'+_+'" at index '+b)}y[v]=w*16+E}return y}function bytesToNumberBE(g){return hexToNumber(bytesToHex(g))}function bytesToNumberLE(g){return abytes(g),hexToNumber(bytesToHex(Uint8Array.from(g).reverse()))}function numberToBytesBE(g,u){return hexToBytes$1(g.toString(16).padStart(u*2,"0"))}function numberToBytesLE(g,u){return numberToBytesBE(g,u).reverse()}function numberToVarBytesBE(g){return hexToBytes$1(numberToHexUnpadded(g))}function ensureBytes(g,u,h){let y;if(typeof u=="string")try{y=hexToBytes$1(u)}catch(b){throw new Error(`${g} must be valid hex string, got "${u}". Cause: ${b}`)}else if(isBytes(u))y=Uint8Array.from(u);else throw new Error(`${g} must be hex string or Uint8Array`);const v=y.length;if(typeof h=="number"&&v!==h)throw new Error(`${g} expected ${h} bytes, got ${v}`);return y}function concatBytes(...g){let u=0;for(let y=0;y<g.length;y++){const v=g[y];abytes(v),u+=v.length}const h=new Uint8Array(u);for(let y=0,v=0;y<g.length;y++){const b=g[y];h.set(b,v),v+=b.length}return h}function equalBytes(g,u){if(g.length!==u.length)return!1;let h=0;for(let y=0;y<g.length;y++)h|=g[y]^u[y];return h===0}function utf8ToBytes(g){if(typeof g!="string")throw new Error(`utf8ToBytes expected string, got ${typeof g}`);return new Uint8Array(new TextEncoder().encode(g))}function bitLen(g){let u;for(u=0;g>_0n$4;g>>=_1n$5,u+=1);return u}function bitGet(g,u){return g>>BigInt(u)&_1n$5}function bitSet(g,u,h){return g|(h?_1n$5:_0n$4)<<BigInt(u)}const bitMask=g=>(_2n$3<<BigInt(g-1))-_1n$5,u8n=g=>new Uint8Array(g),u8fr=g=>Uint8Array.from(g);function createHmacDrbg(g,u,h){if(typeof g!="number"||g<2)throw new Error("hashLen must be a number");if(typeof u!="number"||u<2)throw new Error("qByteLen must be a number");if(typeof h!="function")throw new Error("hmacFn must be a function");let y=u8n(g),v=u8n(g),b=0;const w=()=>{y.fill(1),v.fill(0),b=0},E=(...R)=>h(v,y,...R),_=(R=u8n())=>{v=E(u8fr([0]),R),y=E(),R.length!==0&&(v=E(u8fr([1]),R),y=E())},S=()=>{if(b++>=1e3)throw new Error("drbg: tried 1000 values");let R=0;const x=[];for(;R<u;){y=E();const T=y.slice();x.push(T),R+=y.length}return concatBytes(...x)};return(R,x)=>{w(),_(R);let T;for(;!(T=x(S()));)_();return w(),T}}const validatorFns={bigint:g=>typeof g=="bigint",function:g=>typeof g=="function",boolean:g=>typeof g=="boolean",string:g=>typeof g=="string",stringOrUint8Array:g=>typeof g=="string"||isBytes(g),isSafeInteger:g=>Number.isSafeInteger(g),array:g=>Array.isArray(g),field:(g,u)=>u.Fp.isValid(g),hash:g=>typeof g=="function"&&Number.isSafeInteger(g.outputLen)};function validateObject(g,u,h={}){const y=(v,b,w)=>{const E=validatorFns[b];if(typeof E!="function")throw new Error(`Invalid validator "${b}", expected function`);const _=g[v];if(!(w&&_===void 0)&&!E(_,g))throw new Error(`Invalid param ${String(v)}=${_} (${typeof _}), expected ${b}`)};for(const[v,b]of Object.entries(u))y(v,b,!1);for(const[v,b]of Object.entries(h))y(v,b,!0);return g}const ut=Object.freeze(Object.defineProperty({__proto__:null,abytes,bitGet,bitLen,bitMask,bitSet,bytesToHex,bytesToNumberBE,bytesToNumberLE,concatBytes,createHmacDrbg,ensureBytes,equalBytes,hexToBytes:hexToBytes$1,hexToNumber,isBytes,numberToBytesBE,numberToBytesLE,numberToHexUnpadded,numberToVarBytesBE,utf8ToBytes,validateObject},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$3=BigInt(0),_1n$4=BigInt(1),_2n$2=BigInt(2),_3n$1=BigInt(3),_4n=BigInt(4),_5n=BigInt(5),_8n=BigInt(8);BigInt(9);BigInt(16);function mod(g,u){const h=g%u;return h>=_0n$3?h:u+h}function pow$1(g,u,h){if(h<=_0n$3||u<_0n$3)throw new Error("Expected power/modulo > 0");if(h===_1n$4)return _0n$3;let y=_1n$4;for(;u>_0n$3;)u&_1n$4&&(y=y*g%h),g=g*g%h,u>>=_1n$4;return y}function pow2(g,u,h){let y=g;for(;u-- >_0n$3;)y*=y,y%=h;return y}function invert(g,u){if(g===_0n$3||u<=_0n$3)throw new Error(`invert: expected positive integers, got n=${g} mod=${u}`);let h=mod(g,u),y=u,v=_0n$3,b=_1n$4;for(;h!==_0n$3;){const E=y/h,_=y%h,S=v-b*E;y=h,h=_,v=b,b=S}if(y!==_1n$4)throw new Error("invert: does not exist");return mod(v,u)}function tonelliShanks(g){const u=(g-_1n$4)/_2n$2;let h,y,v;for(h=g-_1n$4,y=0;h%_2n$2===_0n$3;h/=_2n$2,y++);for(v=_2n$2;v<g&&pow$1(v,u,g)!==g-_1n$4;v++);if(y===1){const w=(g+_1n$4)/_4n;return function(_,S){const A=_.pow(S,w);if(!_.eql(_.sqr(A),S))throw new Error("Cannot find square root");return A}}const b=(h+_1n$4)/_2n$2;return function(E,_){if(E.pow(_,u)===E.neg(E.ONE))throw new Error("Cannot find square root");let S=y,A=E.pow(E.mul(E.ONE,v),h),R=E.pow(_,b),x=E.pow(_,h);for(;!E.eql(x,E.ONE);){if(E.eql(x,E.ZERO))return E.ZERO;let T=1;for(let I=E.sqr(x);T<S&&!E.eql(I,E.ONE);T++)I=E.sqr(I);const C=E.pow(A,_1n$4<<BigInt(S-T-1));A=E.sqr(C),R=E.mul(R,C),x=E.mul(x,A),S=T}return R}}function FpSqrt(g){if(g%_4n===_3n$1){const u=(g+_1n$4)/_4n;return function(y,v){const b=y.pow(v,u);if(!y.eql(y.sqr(b),v))throw new Error("Cannot find square root");return b}}if(g%_8n===_5n){const u=(g-_5n)/_8n;return function(y,v){const b=y.mul(v,_2n$2),w=y.pow(b,u),E=y.mul(v,w),_=y.mul(y.mul(E,_2n$2),w),S=y.mul(E,y.sub(_,y.ONE));if(!y.eql(y.sqr(S),v))throw new Error("Cannot find square root");return S}}return tonelliShanks(g)}const FIELD_FIELDS=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField(g){const u={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},h=FIELD_FIELDS.reduce((y,v)=>(y[v]="function",y),u);return validateObject(g,h)}function FpPow(g,u,h){if(h<_0n$3)throw new Error("Expected power > 0");if(h===_0n$3)return g.ONE;if(h===_1n$4)return u;let y=g.ONE,v=u;for(;h>_0n$3;)h&_1n$4&&(y=g.mul(y,v)),v=g.sqr(v),h>>=_1n$4;return y}function FpInvertBatch(g,u){const h=new Array(u.length),y=u.reduce((b,w,E)=>g.is0(w)?b:(h[E]=b,g.mul(b,w)),g.ONE),v=g.inv(y);return u.reduceRight((b,w,E)=>g.is0(w)?b:(h[E]=g.mul(b,h[E]),g.mul(b,w)),v),h}function nLength(g,u){const h=u!==void 0?u:g.toString(2).length,y=Math.ceil(h/8);return{nBitLength:h,nByteLength:y}}function Field(g,u,h=!1,y={}){if(g<=_0n$3)throw new Error(`Expected Field ORDER > 0, got ${g}`);const{nBitLength:v,nByteLength:b}=nLength(g,u);if(b>2048)throw new Error("Field lengths over 2048 bytes are not supported");const w=FpSqrt(g),E=Object.freeze({ORDER:g,BITS:v,BYTES:b,MASK:bitMask(v),ZERO:_0n$3,ONE:_1n$4,create:_=>mod(_,g),isValid:_=>{if(typeof _!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof _}`);return _0n$3<=_&&_<g},is0:_=>_===_0n$3,isOdd:_=>(_&_1n$4)===_1n$4,neg:_=>mod(-_,g),eql:(_,S)=>_===S,sqr:_=>mod(_*_,g),add:(_,S)=>mod(_+S,g),sub:(_,S)=>mod(_-S,g),mul:(_,S)=>mod(_*S,g),pow:(_,S)=>FpPow(E,_,S),div:(_,S)=>mod(_*invert(S,g),g),sqrN:_=>_*_,addN:(_,S)=>_+S,subN:(_,S)=>_-S,mulN:(_,S)=>_*S,inv:_=>invert(_,g),sqrt:y.sqrt||(_=>w(E,_)),invertBatch:_=>FpInvertBatch(E,_),cmov:(_,S,A)=>A?S:_,toBytes:_=>h?numberToBytesLE(_,b):numberToBytesBE(_,b),fromBytes:_=>{if(_.length!==b)throw new Error(`Fp.fromBytes: expected ${b}, got ${_.length}`);return h?bytesToNumberLE(_):bytesToNumberBE(_)}});return Object.freeze(E)}function getFieldBytesLength(g){if(typeof g!="bigint")throw new Error("field order must be bigint");const u=g.toString(2).length;return Math.ceil(u/8)}function getMinHashLength(g){const u=getFieldBytesLength(g);return u+Math.ceil(u/2)}function mapHashToField(g,u,h=!1){const y=g.length,v=getFieldBytesLength(u),b=getMinHashLength(u);if(y<16||y<b||y>1024)throw new Error(`expected ${b}-1024 bytes of input, got ${y}`);const w=h?bytesToNumberBE(g):bytesToNumberLE(g),E=mod(w,u-_1n$4)+_1n$4;return h?numberToBytesLE(E,v):numberToBytesBE(E,v)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$2=BigInt(0),_1n$3=BigInt(1);function wNAF(g,u){const h=(v,b)=>{const w=b.negate();return v?w:b},y=v=>{const b=Math.ceil(u/v)+1,w=2**(v-1);return{windows:b,windowSize:w}};return{constTimeNegate:h,unsafeLadder(v,b){let w=g.ZERO,E=v;for(;b>_0n$2;)b&_1n$3&&(w=w.add(E)),E=E.double(),b>>=_1n$3;return w},precomputeWindow(v,b){const{windows:w,windowSize:E}=y(b),_=[];let S=v,A=S;for(let R=0;R<w;R++){A=S,_.push(A);for(let x=1;x<E;x++)A=A.add(S),_.push(A);S=A.double()}return _},wNAF(v,b,w){const{windows:E,windowSize:_}=y(v);let S=g.ZERO,A=g.BASE;const R=BigInt(2**v-1),x=2**v,T=BigInt(v);for(let C=0;C<E;C++){const I=C*_;let L=Number(w&R);w>>=T,L>_&&(L-=x,w+=_1n$3);const $=I,B=I+Math.abs(L)-1,U=C%2!==0,z=L<0;L===0?A=A.add(h(U,b[$])):S=S.add(h(z,b[B]))}return{p:S,f:A}},wNAFCached(v,b,w,E){const _=v._WINDOW_SIZE||1;let S=b.get(v);return S||(S=this.precomputeWindow(v,_),_!==1&&b.set(v,E(S))),this.wNAF(_,S,w)}}}function validateBasic(g){return validateField(g.Fp),validateObject(g,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nLength(g.n,g.nBitLength),...g,p:g.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function validatePointOpts(g){const u=validateBasic(g);validateObject(u,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:h,Fp:y,a:v}=u;if(h){if(!y.eql(v,y.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof h!="object"||typeof h.beta!="bigint"||typeof h.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...u})}const{bytesToNumberBE:b2n,hexToBytes:h2b}=ut,DER={Err:class extends Error{constructor(u=""){super(u)}},_parseInt(g){const{Err:u}=DER;if(g.length<2||g[0]!==2)throw new u("Invalid signature integer tag");const h=g[1],y=g.subarray(2,h+2);if(!h||y.length!==h)throw new u("Invalid signature integer: wrong length");if(y[0]&128)throw new u("Invalid signature integer: negative");if(y[0]===0&&!(y[1]&128))throw new u("Invalid signature integer: unnecessary leading zero");return{d:b2n(y),l:g.subarray(h+2)}},toSig(g){const{Err:u}=DER,h=typeof g=="string"?h2b(g):g;abytes(h);let y=h.length;if(y<2||h[0]!=48)throw new u("Invalid signature tag");if(h[1]!==y-2)throw new u("Invalid signature: incorrect length");const{d:v,l:b}=DER._parseInt(h.subarray(2)),{d:w,l:E}=DER._parseInt(b);if(E.length)throw new u("Invalid signature: left bytes after parsing");return{r:v,s:w}},hexFromSig(g){const u=S=>Number.parseInt(S[0],16)&8?"00"+S:S,h=S=>{const A=S.toString(16);return A.length&1?`0${A}`:A},y=u(h(g.s)),v=u(h(g.r)),b=y.length/2,w=v.length/2,E=h(b),_=h(w);return`30${h(w+b+4)}02${_}${v}02${E}${y}`}},_0n$1=BigInt(0),_1n$2=BigInt(1);BigInt(2);const _3n=BigInt(3);BigInt(4);function weierstrassPoints(g){const u=validatePointOpts(g),{Fp:h}=u,y=u.toBytes||((C,I,L)=>{const $=I.toAffine();return concatBytes(Uint8Array.from([4]),h.toBytes($.x),h.toBytes($.y))}),v=u.fromBytes||(C=>{const I=C.subarray(1),L=h.fromBytes(I.subarray(0,h.BYTES)),$=h.fromBytes(I.subarray(h.BYTES,2*h.BYTES));return{x:L,y:$}});function b(C){const{a:I,b:L}=u,$=h.sqr(C),B=h.mul($,C);return h.add(h.add(B,h.mul(C,I)),L)}if(!h.eql(h.sqr(u.Gy),b(u.Gx)))throw new Error("bad generator point: equation left != right");function w(C){return typeof C=="bigint"&&_0n$1<C&&C<u.n}function E(C){if(!w(C))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function _(C){const{allowedPrivateKeyLengths:I,nByteLength:L,wrapPrivateKey:$,n:B}=u;if(I&&typeof C!="bigint"){if(isBytes(C)&&(C=bytesToHex(C)),typeof C!="string"||!I.includes(C.length))throw new Error("Invalid key");C=C.padStart(L*2,"0")}let U;try{U=typeof C=="bigint"?C:bytesToNumberBE(ensureBytes("private key",C,L))}catch{throw new Error(`private key must be ${L} bytes, hex or bigint, not ${typeof C}`)}return $&&(U=mod(U,B)),E(U),U}const S=new Map;function A(C){if(!(C instanceof R))throw new Error("ProjectivePoint expected")}class R{constructor(I,L,$){if(this.px=I,this.py=L,this.pz=$,I==null||!h.isValid(I))throw new Error("x required");if(L==null||!h.isValid(L))throw new Error("y required");if($==null||!h.isValid($))throw new Error("z required")}static fromAffine(I){const{x:L,y:$}=I||{};if(!I||!h.isValid(L)||!h.isValid($))throw new Error("invalid affine point");if(I instanceof R)throw new Error("projective point not allowed");const B=U=>h.eql(U,h.ZERO);return B(L)&&B($)?R.ZERO:new R(L,$,h.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(I){const L=h.invertBatch(I.map($=>$.pz));return I.map(($,B)=>$.toAffine(L[B])).map(R.fromAffine)}static fromHex(I){const L=R.fromAffine(v(ensureBytes("pointHex",I)));return L.assertValidity(),L}static fromPrivateKey(I){return R.BASE.multiply(_(I))}_setWindowSize(I){this._WINDOW_SIZE=I,S.delete(this)}assertValidity(){if(this.is0()){if(u.allowInfinityPoint&&!h.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:I,y:L}=this.toAffine();if(!h.isValid(I)||!h.isValid(L))throw new Error("bad point: x or y not FE");const $=h.sqr(L),B=b(I);if(!h.eql($,B))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:I}=this.toAffine();if(h.isOdd)return!h.isOdd(I);throw new Error("Field doesn't support isOdd")}equals(I){A(I);const{px:L,py:$,pz:B}=this,{px:U,py:z,pz:ne}=I,ue=h.eql(h.mul(L,ne),h.mul(U,B)),he=h.eql(h.mul($,ne),h.mul(z,B));return ue&&he}negate(){return new R(this.px,h.neg(this.py),this.pz)}double(){const{a:I,b:L}=u,$=h.mul(L,_3n),{px:B,py:U,pz:z}=this;let ne=h.ZERO,ue=h.ZERO,he=h.ZERO,Y=h.mul(B,B),X=h.mul(U,U),J=h.mul(z,z),j=h.mul(B,U);return j=h.add(j,j),he=h.mul(B,z),he=h.add(he,he),ne=h.mul(I,he),ue=h.mul($,J),ue=h.add(ne,ue),ne=h.sub(X,ue),ue=h.add(X,ue),ue=h.mul(ne,ue),ne=h.mul(j,ne),he=h.mul($,he),J=h.mul(I,J),j=h.sub(Y,J),j=h.mul(I,j),j=h.add(j,he),he=h.add(Y,Y),Y=h.add(he,Y),Y=h.add(Y,J),Y=h.mul(Y,j),ue=h.add(ue,Y),J=h.mul(U,z),J=h.add(J,J),Y=h.mul(J,j),ne=h.sub(ne,Y),he=h.mul(J,X),he=h.add(he,he),he=h.add(he,he),new R(ne,ue,he)}add(I){A(I);const{px:L,py:$,pz:B}=this,{px:U,py:z,pz:ne}=I;let ue=h.ZERO,he=h.ZERO,Y=h.ZERO;const X=u.a,J=h.mul(u.b,_3n);let j=h.mul(L,U),M=h.mul($,z),N=h.mul(B,ne),P=h.add(L,$),O=h.add(U,z);P=h.mul(P,O),O=h.add(j,M),P=h.sub(P,O),O=h.add(L,B);let k=h.add(U,ne);return O=h.mul(O,k),k=h.add(j,N),O=h.sub(O,k),k=h.add($,B),ue=h.add(z,ne),k=h.mul(k,ue),ue=h.add(M,N),k=h.sub(k,ue),Y=h.mul(X,O),ue=h.mul(J,N),Y=h.add(ue,Y),ue=h.sub(M,Y),Y=h.add(M,Y),he=h.mul(ue,Y),M=h.add(j,j),M=h.add(M,j),N=h.mul(X,N),O=h.mul(J,O),M=h.add(M,N),N=h.sub(j,N),N=h.mul(X,N),O=h.add(O,N),j=h.mul(M,O),he=h.add(he,j),j=h.mul(k,O),ue=h.mul(P,ue),ue=h.sub(ue,j),j=h.mul(P,M),Y=h.mul(k,Y),Y=h.add(Y,j),new R(ue,he,Y)}subtract(I){return this.add(I.negate())}is0(){return this.equals(R.ZERO)}wNAF(I){return T.wNAFCached(this,S,I,L=>{const $=h.invertBatch(L.map(B=>B.pz));return L.map((B,U)=>B.toAffine($[U])).map(R.fromAffine)})}multiplyUnsafe(I){const L=R.ZERO;if(I===_0n$1)return L;if(E(I),I===_1n$2)return this;const{endo:$}=u;if(!$)return T.unsafeLadder(this,I);let{k1neg:B,k1:U,k2neg:z,k2:ne}=$.splitScalar(I),ue=L,he=L,Y=this;for(;U>_0n$1||ne>_0n$1;)U&_1n$2&&(ue=ue.add(Y)),ne&_1n$2&&(he=he.add(Y)),Y=Y.double(),U>>=_1n$2,ne>>=_1n$2;return B&&(ue=ue.negate()),z&&(he=he.negate()),he=new R(h.mul(he.px,$.beta),he.py,he.pz),ue.add(he)}multiply(I){E(I);let L=I,$,B;const{endo:U}=u;if(U){const{k1neg:z,k1:ne,k2neg:ue,k2:he}=U.splitScalar(L);let{p:Y,f:X}=this.wNAF(ne),{p:J,f:j}=this.wNAF(he);Y=T.constTimeNegate(z,Y),J=T.constTimeNegate(ue,J),J=new R(h.mul(J.px,U.beta),J.py,J.pz),$=Y.add(J),B=X.add(j)}else{const{p:z,f:ne}=this.wNAF(L);$=z,B=ne}return R.normalizeZ([$,B])[0]}multiplyAndAddUnsafe(I,L,$){const B=R.BASE,U=(ne,ue)=>ue===_0n$1||ue===_1n$2||!ne.equals(B)?ne.multiplyUnsafe(ue):ne.multiply(ue),z=U(this,L).add(U(I,$));return z.is0()?void 0:z}toAffine(I){const{px:L,py:$,pz:B}=this,U=this.is0();I==null&&(I=U?h.ONE:h.inv(B));const z=h.mul(L,I),ne=h.mul($,I),ue=h.mul(B,I);if(U)return{x:h.ZERO,y:h.ZERO};if(!h.eql(ue,h.ONE))throw new Error("invZ was invalid");return{x:z,y:ne}}isTorsionFree(){const{h:I,isTorsionFree:L}=u;if(I===_1n$2)return!0;if(L)return L(R,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:I,clearCofactor:L}=u;return I===_1n$2?this:L?L(R,this):this.multiplyUnsafe(u.h)}toRawBytes(I=!0){return this.assertValidity(),y(R,this,I)}toHex(I=!0){return bytesToHex(this.toRawBytes(I))}}R.BASE=new R(u.Gx,u.Gy,h.ONE),R.ZERO=new R(h.ZERO,h.ONE,h.ZERO);const x=u.nBitLength,T=wNAF(R,u.endo?Math.ceil(x/2):x);return{CURVE:u,ProjectivePoint:R,normPrivateKeyToScalar:_,weierstrassEquation:b,isWithinCurveOrder:w}}function validateOpts(g){const u=validateBasic(g);return validateObject(u,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...u})}function weierstrass(g){const u=validateOpts(g),{Fp:h,n:y}=u,v=h.BYTES+1,b=2*h.BYTES+1;function w(O){return _0n$1<O&&O<h.ORDER}function E(O){return mod(O,y)}function _(O){return invert(O,y)}const{ProjectivePoint:S,normPrivateKeyToScalar:A,weierstrassEquation:R,isWithinCurveOrder:x}=weierstrassPoints({...u,toBytes(O,k,q){const F=k.toAffine(),H=h.toBytes(F.x),D=concatBytes;return q?D(Uint8Array.from([k.hasEvenY()?2:3]),H):D(Uint8Array.from([4]),H,h.toBytes(F.y))},fromBytes(O){const k=O.length,q=O[0],F=O.subarray(1);if(k===v&&(q===2||q===3)){const H=bytesToNumberBE(F);if(!w(H))throw new Error("Point is not on curve");const D=R(H);let G;try{G=h.sqrt(D)}catch(Z){const ae=Z instanceof Error?": "+Z.message:"";throw new Error("Point is not on curve"+ae)}const W=(G&_1n$2)===_1n$2;return(q&1)===1!==W&&(G=h.neg(G)),{x:H,y:G}}else if(k===b&&q===4){const H=h.fromBytes(F.subarray(0,h.BYTES)),D=h.fromBytes(F.subarray(h.BYTES,2*h.BYTES));return{x:H,y:D}}else throw new Error(`Point of length ${k} was invalid. Expected ${v} compressed bytes or ${b} uncompressed bytes`)}}),T=O=>bytesToHex(numberToBytesBE(O,u.nByteLength));function C(O){const k=y>>_1n$2;return O>k}function I(O){return C(O)?E(-O):O}const L=(O,k,q)=>bytesToNumberBE(O.slice(k,q));class ${constructor(k,q,F){this.r=k,this.s=q,this.recovery=F,this.assertValidity()}static fromCompact(k){const q=u.nByteLength;return k=ensureBytes("compactSignature",k,q*2),new $(L(k,0,q),L(k,q,2*q))}static fromDER(k){const{r:q,s:F}=DER.toSig(ensureBytes("DER",k));return new $(q,F)}assertValidity(){if(!x(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!x(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(k){return new $(this.r,this.s,k)}recoverPublicKey(k){const{r:q,s:F,recovery:H}=this,D=he(ensureBytes("msgHash",k));if(H==null||![0,1,2,3].includes(H))throw new Error("recovery id invalid");const G=H===2||H===3?q+u.n:q;if(G>=h.ORDER)throw new Error("recovery id 2 or 3 invalid");const W=(H&1)===0?"02":"03",K=S.fromHex(W+T(G)),Z=_(G),ae=E(-D*Z),le=E(F*Z),te=S.BASE.multiplyAndAddUnsafe(K,ae,le);if(!te)throw new Error("point at infinify");return te.assertValidity(),te}hasHighS(){return C(this.s)}normalizeS(){return this.hasHighS()?new $(this.r,E(-this.s),this.recovery):this}toDERRawBytes(){return hexToBytes$1(this.toDERHex())}toDERHex(){return DER.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hexToBytes$1(this.toCompactHex())}toCompactHex(){return T(this.r)+T(this.s)}}const B={isValidPrivateKey(O){try{return A(O),!0}catch{return!1}},normPrivateKeyToScalar:A,randomPrivateKey:()=>{const O=getMinHashLength(u.n);return mapHashToField(u.randomBytes(O),u.n)},precompute(O=8,k=S.BASE){return k._setWindowSize(O),k.multiply(BigInt(3)),k}};function U(O,k=!0){return S.fromPrivateKey(O).toRawBytes(k)}function z(O){const k=isBytes(O),q=typeof O=="string",F=(k||q)&&O.length;return k?F===v||F===b:q?F===2*v||F===2*b:O instanceof S}function ne(O,k,q=!0){if(z(O))throw new Error("first arg must be private key");if(!z(k))throw new Error("second arg must be public key");return S.fromHex(k).multiply(A(O)).toRawBytes(q)}const ue=u.bits2int||function(O){const k=bytesToNumberBE(O),q=O.length*8-u.nBitLength;return q>0?k>>BigInt(q):k},he=u.bits2int_modN||function(O){return E(ue(O))},Y=bitMask(u.nBitLength);function X(O){if(typeof O!="bigint")throw new Error("bigint expected");if(!(_0n$1<=O&&O<Y))throw new Error(`bigint expected < 2^${u.nBitLength}`);return numberToBytesBE(O,u.nByteLength)}function J(O,k,q=j){if(["recovered","canonical"].some(ge=>ge in q))throw new Error("sign() legacy options not supported");const{hash:F,randomBytes:H}=u;let{lowS:D,prehash:G,extraEntropy:W}=q;D==null&&(D=!0),O=ensureBytes("msgHash",O),G&&(O=ensureBytes("prehashed msgHash",F(O)));const K=he(O),Z=A(k),ae=[X(Z),X(K)];if(W!=null&&W!==!1){const ge=W===!0?H(h.BYTES):W;ae.push(ensureBytes("extraEntropy",ge))}const le=concatBytes(...ae),te=K;function ce(ge){const Ee=ue(ge);if(!x(Ee))return;const pe=_(Ee),de=S.BASE.multiply(Ee).toAffine(),me=E(de.x);if(me===_0n$1)return;const _e=E(pe*E(te+me*Z));if(_e===_0n$1)return;let Ae=(de.x===me?0:2)|Number(de.y&_1n$2),Pe=_e;return D&&C(_e)&&(Pe=I(_e),Ae^=1),new $(me,Pe,Ae)}return{seed:le,k2sig:ce}}const j={lowS:u.lowS,prehash:!1},M={lowS:u.lowS,prehash:!1};function N(O,k,q=j){const{seed:F,k2sig:H}=J(O,k,q),D=u;return createHmacDrbg(D.hash.outputLen,D.nByteLength,D.hmac)(F,H)}S.BASE._setWindowSize(8);function P(O,k,q,F=M){const H=O;if(k=ensureBytes("msgHash",k),q=ensureBytes("publicKey",q),"strict"in F)throw new Error("options.strict was renamed to lowS");const{lowS:D,prehash:G}=F;let W,K;try{if(typeof H=="string"||isBytes(H))try{W=$.fromDER(H)}catch(de){if(!(de instanceof DER.Err))throw de;W=$.fromCompact(H)}else if(typeof H=="object"&&typeof H.r=="bigint"&&typeof H.s=="bigint"){const{r:de,s:me}=H;W=new $(de,me)}else throw new Error("PARSE");K=S.fromHex(q)}catch(de){if(de.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(D&&W.hasHighS())return!1;G&&(k=u.hash(k));const{r:Z,s:ae}=W,le=he(k),te=_(ae),ce=E(le*te),ge=E(Z*te),Ee=S.BASE.multiplyAndAddUnsafe(K,ce,ge)?.toAffine();return Ee?E(Ee.x)===Z:!1}return{CURVE:u,getPublicKey:U,getSharedSecret:ne,sign:N,verify:P,ProjectivePoint:S,Signature:$,utils:B}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function getHash(g){return{hash:g,hmac:(u,...h)=>hmac$1(g,u,concatBytes$1(...h)),randomBytes:randomBytes$1}}function createCurve(g,u){const h=y=>weierstrass({...g,...getHash(y)});return Object.freeze({...h(u),create:h})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1P=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),secp256k1N=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_1n$1=BigInt(1),_2n$1=BigInt(2),divNearest=(g,u)=>(g+u/_2n$1)/u;function sqrtMod(g){const u=secp256k1P,h=BigInt(3),y=BigInt(6),v=BigInt(11),b=BigInt(22),w=BigInt(23),E=BigInt(44),_=BigInt(88),S=g*g*g%u,A=S*S*g%u,R=pow2(A,h,u)*A%u,x=pow2(R,h,u)*A%u,T=pow2(x,_2n$1,u)*S%u,C=pow2(T,v,u)*T%u,I=pow2(C,b,u)*C%u,L=pow2(I,E,u)*I%u,$=pow2(L,_,u)*L%u,B=pow2($,E,u)*I%u,U=pow2(B,h,u)*A%u,z=pow2(U,w,u)*C%u,ne=pow2(z,y,u)*S%u,ue=pow2(ne,_2n$1,u);if(!Fp.eql(Fp.sqr(ue),g))throw new Error("Cannot find square root");return ue}const Fp=Field(secp256k1P,void 0,void 0,{sqrt:sqrtMod}),secp256k1$1=createCurve({a:BigInt(0),b:BigInt(7),Fp,n:secp256k1N,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:g=>{const u=secp256k1N,h=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),y=-_1n$1*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),v=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),b=h,w=BigInt("0x100000000000000000000000000000000"),E=divNearest(b*g,u),_=divNearest(-y*g,u);let S=mod(g-E*h-_*v,u),A=mod(-E*y-_*b,u);const R=S>w,x=A>w;if(R&&(S=u-S),x&&(A=u-A),S>w||A>w)throw new Error("splitScalar: Endomorphism failed, k="+g);return{k1neg:R,k1:S,k2neg:x,k2:A}}}},sha256$2);BigInt(0);secp256k1$1.ProjectivePoint;var hash$1={},utils$4={},minimalisticAssert,hasRequiredMinimalisticAssert;function requireMinimalisticAssert(){if(hasRequiredMinimalisticAssert)return minimalisticAssert;hasRequiredMinimalisticAssert=1,minimalisticAssert=g;function g(u,h){if(!u)throw new Error(h||"Assertion failed")}return g.equal=function(h,y,v){if(h!=y)throw new Error(v||"Assertion failed: "+h+" != "+y)},minimalisticAssert}var inherits_browser={exports:{}},hasRequiredInherits_browser;function requireInherits_browser(){return hasRequiredInherits_browser||(hasRequiredInherits_browser=1,typeof Object.create=="function"?inherits_browser.exports=function(u,h){h&&(u.super_=h,u.prototype=Object.create(h.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}))}:inherits_browser.exports=function(u,h){if(h){u.super_=h;var y=function(){};y.prototype=h.prototype,u.prototype=new y,u.prototype.constructor=u}}),inherits_browser.exports}var hasRequiredUtils$4;function requireUtils$4(){if(hasRequiredUtils$4)return utils$4;hasRequiredUtils$4=1;var g=requireMinimalisticAssert(),u=requireInherits_browser();utils$4.inherits=u;function h(M,N){return(M.charCodeAt(N)&64512)!==55296||N<0||N+1>=M.length?!1:(M.charCodeAt(N+1)&64512)===56320}function y(M,N){if(Array.isArray(M))return M.slice();if(!M)return[];var P=[];if(typeof M=="string")if(N){if(N==="hex")for(M=M.replace(/[^a-z0-9]+/ig,""),M.length%2!==0&&(M="0"+M),k=0;k<M.length;k+=2)P.push(parseInt(M[k]+M[k+1],16))}else for(var O=0,k=0;k<M.length;k++){var q=M.charCodeAt(k);q<128?P[O++]=q:q<2048?(P[O++]=q>>6|192,P[O++]=q&63|128):h(M,k)?(q=65536+((q&1023)<<10)+(M.charCodeAt(++k)&1023),P[O++]=q>>18|240,P[O++]=q>>12&63|128,P[O++]=q>>6&63|128,P[O++]=q&63|128):(P[O++]=q>>12|224,P[O++]=q>>6&63|128,P[O++]=q&63|128)}else for(k=0;k<M.length;k++)P[k]=M[k]|0;return P}utils$4.toArray=y;function v(M){for(var N="",P=0;P<M.length;P++)N+=E(M[P].toString(16));return N}utils$4.toHex=v;function b(M){var N=M>>>24|M>>>8&65280|M<<8&16711680|(M&255)<<24;return N>>>0}utils$4.htonl=b;function w(M,N){for(var P="",O=0;O<M.length;O++){var k=M[O];N==="little"&&(k=b(k)),P+=_(k.toString(16))}return P}utils$4.toHex32=w;function E(M){return M.length===1?"0"+M:M}utils$4.zero2=E;function _(M){return M.length===7?"0"+M:M.length===6?"00"+M:M.length===5?"000"+M:M.length===4?"0000"+M:M.length===3?"00000"+M:M.length===2?"000000"+M:M.length===1?"0000000"+M:M}utils$4.zero8=_;function S(M,N,P,O){var k=P-N;g(k%4===0);for(var q=new Array(k/4),F=0,H=N;F<q.length;F++,H+=4){var D;O==="big"?D=M[H]<<24|M[H+1]<<16|M[H+2]<<8|M[H+3]:D=M[H+3]<<24|M[H+2]<<16|M[H+1]<<8|M[H],q[F]=D>>>0}return q}utils$4.join32=S;function A(M,N){for(var P=new Array(M.length*4),O=0,k=0;O<M.length;O++,k+=4){var q=M[O];N==="big"?(P[k]=q>>>24,P[k+1]=q>>>16&255,P[k+2]=q>>>8&255,P[k+3]=q&255):(P[k+3]=q>>>24,P[k+2]=q>>>16&255,P[k+1]=q>>>8&255,P[k]=q&255)}return P}utils$4.split32=A;function R(M,N){return M>>>N|M<<32-N}utils$4.rotr32=R;function x(M,N){return M<<N|M>>>32-N}utils$4.rotl32=x;function T(M,N){return M+N>>>0}utils$4.sum32=T;function C(M,N,P){return M+N+P>>>0}utils$4.sum32_3=C;function I(M,N,P,O){return M+N+P+O>>>0}utils$4.sum32_4=I;function L(M,N,P,O,k){return M+N+P+O+k>>>0}utils$4.sum32_5=L;function $(M,N,P,O){var k=M[N],q=M[N+1],F=O+q>>>0,H=(F<O?1:0)+P+k;M[N]=H>>>0,M[N+1]=F}utils$4.sum64=$;function B(M,N,P,O){var k=N+O>>>0,q=(k<N?1:0)+M+P;return q>>>0}utils$4.sum64_hi=B;function U(M,N,P,O){var k=N+O;return k>>>0}utils$4.sum64_lo=U;function z(M,N,P,O,k,q,F,H){var D=0,G=N;G=G+O>>>0,D+=G<N?1:0,G=G+q>>>0,D+=G<q?1:0,G=G+H>>>0,D+=G<H?1:0;var W=M+P+k+F+D;return W>>>0}utils$4.sum64_4_hi=z;function ne(M,N,P,O,k,q,F,H){var D=N+O+q+H;return D>>>0}utils$4.sum64_4_lo=ne;function ue(M,N,P,O,k,q,F,H,D,G){var W=0,K=N;K=K+O>>>0,W+=K<N?1:0,K=K+q>>>0,W+=K<q?1:0,K=K+H>>>0,W+=K<H?1:0,K=K+G>>>0,W+=K<G?1:0;var Z=M+P+k+F+D+W;return Z>>>0}utils$4.sum64_5_hi=ue;function he(M,N,P,O,k,q,F,H,D,G){var W=N+O+q+H+G;return W>>>0}utils$4.sum64_5_lo=he;function Y(M,N,P){var O=N<<32-P|M>>>P;return O>>>0}utils$4.rotr64_hi=Y;function X(M,N,P){var O=M<<32-P|N>>>P;return O>>>0}utils$4.rotr64_lo=X;function J(M,N,P){return M>>>P}utils$4.shr64_hi=J;function j(M,N,P){var O=M<<32-P|N>>>P;return O>>>0}return utils$4.shr64_lo=j,utils$4}var common$1={},hasRequiredCommon$1;function requireCommon$1(){if(hasRequiredCommon$1)return common$1;hasRequiredCommon$1=1;var g=requireUtils$4(),u=requireMinimalisticAssert();function h(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}return common$1.BlockHash=h,h.prototype.update=function(v,b){if(v=g.toArray(v,b),this.pending?this.pending=this.pending.concat(v):this.pending=v,this.pendingTotal+=v.length,this.pending.length>=this._delta8){v=this.pending;var w=v.length%this._delta8;this.pending=v.slice(v.length-w,v.length),this.pending.length===0&&(this.pending=null),v=g.join32(v,0,v.length-w,this.endian);for(var E=0;E<v.length;E+=this._delta32)this._update(v,E,E+this._delta32)}return this},h.prototype.digest=function(v){return this.update(this._pad()),u(this.pending===null),this._digest(v)},h.prototype._pad=function(){var v=this.pendingTotal,b=this._delta8,w=b-(v+this.padLength)%b,E=new Array(w+this.padLength);E[0]=128;for(var _=1;_<w;_++)E[_]=0;if(v<<=3,this.endian==="big"){for(var S=8;S<this.padLength;S++)E[_++]=0;E[_++]=0,E[_++]=0,E[_++]=0,E[_++]=0,E[_++]=v>>>24&255,E[_++]=v>>>16&255,E[_++]=v>>>8&255,E[_++]=v&255}else for(E[_++]=v&255,E[_++]=v>>>8&255,E[_++]=v>>>16&255,E[_++]=v>>>24&255,E[_++]=0,E[_++]=0,E[_++]=0,E[_++]=0,S=8;S<this.padLength;S++)E[_++]=0;return E},common$1}var sha$1={},common={},hasRequiredCommon;function requireCommon(){if(hasRequiredCommon)return common;hasRequiredCommon=1;var g=requireUtils$4(),u=g.rotr32;function h(A,R,x,T){if(A===0)return y(R,x,T);if(A===1||A===3)return b(R,x,T);if(A===2)return v(R,x,T)}common.ft_1=h;function y(A,R,x){return A&R^~A&x}common.ch32=y;function v(A,R,x){return A&R^A&x^R&x}common.maj32=v;function b(A,R,x){return A^R^x}common.p32=b;function w(A){return u(A,2)^u(A,13)^u(A,22)}common.s0_256=w;function E(A){return u(A,6)^u(A,11)^u(A,25)}common.s1_256=E;function _(A){return u(A,7)^u(A,18)^A>>>3}common.g0_256=_;function S(A){return u(A,17)^u(A,19)^A>>>10}return common.g1_256=S,common}var _1,hasRequired_1;function require_1(){if(hasRequired_1)return _1;hasRequired_1=1;var g=requireUtils$4(),u=requireCommon$1(),h=requireCommon(),y=g.rotl32,v=g.sum32,b=g.sum32_5,w=h.ft_1,E=u.BlockHash,_=[1518500249,1859775393,2400959708,3395469782];function S(){if(!(this instanceof S))return new S;E.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}return g.inherits(S,E),_1=S,S.blockSize=512,S.outSize=160,S.hmacStrength=80,S.padLength=64,S.prototype._update=function(R,x){for(var T=this.W,C=0;C<16;C++)T[C]=R[x+C];for(;C<T.length;C++)T[C]=y(T[C-3]^T[C-8]^T[C-14]^T[C-16],1);var I=this.h[0],L=this.h[1],$=this.h[2],B=this.h[3],U=this.h[4];for(C=0;C<T.length;C++){var z=~~(C/20),ne=b(y(I,5),w(z,L,$,B),U,T[C],_[z]);U=B,B=$,$=y(L,30),L=I,I=ne}this.h[0]=v(this.h[0],I),this.h[1]=v(this.h[1],L),this.h[2]=v(this.h[2],$),this.h[3]=v(this.h[3],B),this.h[4]=v(this.h[4],U)},S.prototype._digest=function(R){return R==="hex"?g.toHex32(this.h,"big"):g.split32(this.h,"big")},_1}var _256,hasRequired_256;function require_256(){if(hasRequired_256)return _256;hasRequired_256=1;var g=requireUtils$4(),u=requireCommon$1(),h=requireCommon(),y=requireMinimalisticAssert(),v=g.sum32,b=g.sum32_4,w=g.sum32_5,E=h.ch32,_=h.maj32,S=h.s0_256,A=h.s1_256,R=h.g0_256,x=h.g1_256,T=u.BlockHash,C=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function I(){if(!(this instanceof I))return new I;T.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=C,this.W=new Array(64)}return g.inherits(I,T),_256=I,I.blockSize=512,I.outSize=256,I.hmacStrength=192,I.padLength=64,I.prototype._update=function($,B){for(var U=this.W,z=0;z<16;z++)U[z]=$[B+z];for(;z<U.length;z++)U[z]=b(x(U[z-2]),U[z-7],R(U[z-15]),U[z-16]);var ne=this.h[0],ue=this.h[1],he=this.h[2],Y=this.h[3],X=this.h[4],J=this.h[5],j=this.h[6],M=this.h[7];for(y(this.k.length===U.length),z=0;z<U.length;z++){var N=w(M,A(X),E(X,J,j),this.k[z],U[z]),P=v(S(ne),_(ne,ue,he));M=j,j=J,J=X,X=v(Y,N),Y=he,he=ue,ue=ne,ne=v(N,P)}this.h[0]=v(this.h[0],ne),this.h[1]=v(this.h[1],ue),this.h[2]=v(this.h[2],he),this.h[3]=v(this.h[3],Y),this.h[4]=v(this.h[4],X),this.h[5]=v(this.h[5],J),this.h[6]=v(this.h[6],j),this.h[7]=v(this.h[7],M)},I.prototype._digest=function($){return $==="hex"?g.toHex32(this.h,"big"):g.split32(this.h,"big")},_256}var _224,hasRequired_224;function require_224(){if(hasRequired_224)return _224;hasRequired_224=1;var g=requireUtils$4(),u=require_256();function h(){if(!(this instanceof h))return new h;u.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}return g.inherits(h,u),_224=h,h.blockSize=512,h.outSize=224,h.hmacStrength=192,h.padLength=64,h.prototype._digest=function(v){return v==="hex"?g.toHex32(this.h.slice(0,7),"big"):g.split32(this.h.slice(0,7),"big")},_224}var _512,hasRequired_512;function require_512(){if(hasRequired_512)return _512;hasRequired_512=1;var g=requireUtils$4(),u=requireCommon$1(),h=requireMinimalisticAssert(),y=g.rotr64_hi,v=g.rotr64_lo,b=g.shr64_hi,w=g.shr64_lo,E=g.sum64,_=g.sum64_hi,S=g.sum64_lo,A=g.sum64_4_hi,R=g.sum64_4_lo,x=g.sum64_5_hi,T=g.sum64_5_lo,C=u.BlockHash,I=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function L(){if(!(this instanceof L))return new L;C.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=I,this.W=new Array(160)}g.inherits(L,C),_512=L,L.blockSize=1024,L.outSize=512,L.hmacStrength=192,L.padLength=128,L.prototype._prepareBlock=function(P,O){for(var k=this.W,q=0;q<32;q++)k[q]=P[O+q];for(;q<k.length;q+=2){var F=j(k[q-4],k[q-3]),H=M(k[q-4],k[q-3]),D=k[q-14],G=k[q-13],W=X(k[q-30],k[q-29]),K=J(k[q-30],k[q-29]),Z=k[q-32],ae=k[q-31];k[q]=A(F,H,D,G,W,K,Z,ae),k[q+1]=R(F,H,D,G,W,K,Z,ae)}},L.prototype._update=function(P,O){this._prepareBlock(P,O);var k=this.W,q=this.h[0],F=this.h[1],H=this.h[2],D=this.h[3],G=this.h[4],W=this.h[5],K=this.h[6],Z=this.h[7],ae=this.h[8],le=this.h[9],te=this.h[10],ce=this.h[11],ge=this.h[12],Ee=this.h[13],pe=this.h[14],de=this.h[15];h(this.k.length===k.length);for(var me=0;me<k.length;me+=2){var _e=pe,Ae=de,Pe=he(ae,le),Me=Y(ae,le),Ne=$(ae,le,te,ce,ge),we=B(ae,le,te,ce,ge,Ee),Le=this.k[me],Oe=this.k[me+1],Ce=k[me],We=k[me+1],ze=x(_e,Ae,Pe,Me,Ne,we,Le,Oe,Ce,We),Xe=T(_e,Ae,Pe,Me,Ne,we,Le,Oe,Ce,We);_e=ne(q,F),Ae=ue(q,F),Pe=U(q,F,H,D,G),Me=z(q,F,H,D,G,W);var it=_(_e,Ae,Pe,Me),Je=S(_e,Ae,Pe,Me);pe=ge,de=Ee,ge=te,Ee=ce,te=ae,ce=le,ae=_(K,Z,ze,Xe),le=S(Z,Z,ze,Xe),K=G,Z=W,G=H,W=D,H=q,D=F,q=_(ze,Xe,it,Je),F=S(ze,Xe,it,Je)}E(this.h,0,q,F),E(this.h,2,H,D),E(this.h,4,G,W),E(this.h,6,K,Z),E(this.h,8,ae,le),E(this.h,10,te,ce),E(this.h,12,ge,Ee),E(this.h,14,pe,de)},L.prototype._digest=function(P){return P==="hex"?g.toHex32(this.h,"big"):g.split32(this.h,"big")};function $(N,P,O,k,q){var F=N&O^~N&q;return F<0&&(F+=4294967296),F}function B(N,P,O,k,q,F){var H=P&k^~P&F;return H<0&&(H+=4294967296),H}function U(N,P,O,k,q){var F=N&O^N&q^O&q;return F<0&&(F+=4294967296),F}function z(N,P,O,k,q,F){var H=P&k^P&F^k&F;return H<0&&(H+=4294967296),H}function ne(N,P){var O=y(N,P,28),k=y(P,N,2),q=y(P,N,7),F=O^k^q;return F<0&&(F+=4294967296),F}function ue(N,P){var O=v(N,P,28),k=v(P,N,2),q=v(P,N,7),F=O^k^q;return F<0&&(F+=4294967296),F}function he(N,P){var O=y(N,P,14),k=y(N,P,18),q=y(P,N,9),F=O^k^q;return F<0&&(F+=4294967296),F}function Y(N,P){var O=v(N,P,14),k=v(N,P,18),q=v(P,N,9),F=O^k^q;return F<0&&(F+=4294967296),F}function X(N,P){var O=y(N,P,1),k=y(N,P,8),q=b(N,P,7),F=O^k^q;return F<0&&(F+=4294967296),F}function J(N,P){var O=v(N,P,1),k=v(N,P,8),q=w(N,P,7),F=O^k^q;return F<0&&(F+=4294967296),F}function j(N,P){var O=y(N,P,19),k=y(P,N,29),q=b(N,P,6),F=O^k^q;return F<0&&(F+=4294967296),F}function M(N,P){var O=v(N,P,19),k=v(P,N,29),q=w(N,P,6),F=O^k^q;return F<0&&(F+=4294967296),F}return _512}var _384,hasRequired_384;function require_384(){if(hasRequired_384)return _384;hasRequired_384=1;var g=requireUtils$4(),u=require_512();function h(){if(!(this instanceof h))return new h;u.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}return g.inherits(h,u),_384=h,h.blockSize=1024,h.outSize=384,h.hmacStrength=192,h.padLength=128,h.prototype._digest=function(v){return v==="hex"?g.toHex32(this.h.slice(0,12),"big"):g.split32(this.h.slice(0,12),"big")},_384}var hasRequiredSha$1;function requireSha$1(){return hasRequiredSha$1||(hasRequiredSha$1=1,sha$1.sha1=require_1(),sha$1.sha224=require_224(),sha$1.sha256=require_256(),sha$1.sha384=require_384(),sha$1.sha512=require_512()),sha$1}var ripemd={},hasRequiredRipemd;function requireRipemd(){if(hasRequiredRipemd)return ripemd;hasRequiredRipemd=1;var g=requireUtils$4(),u=requireCommon$1(),h=g.rotl32,y=g.sum32,v=g.sum32_3,b=g.sum32_4,w=u.BlockHash;function E(){if(!(this instanceof E))return new E;w.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}g.inherits(E,w),ripemd.ripemd160=E,E.blockSize=512,E.outSize=160,E.hmacStrength=192,E.padLength=64,E.prototype._update=function(L,$){for(var B=this.h[0],U=this.h[1],z=this.h[2],ne=this.h[3],ue=this.h[4],he=B,Y=U,X=z,J=ne,j=ue,M=0;M<80;M++){var N=y(h(b(B,_(M,U,z,ne),L[R[M]+$],S(M)),T[M]),ue);B=ue,ue=ne,ne=h(z,10),z=U,U=N,N=y(h(b(he,_(79-M,Y,X,J),L[x[M]+$],A(M)),C[M]),j),he=j,j=J,J=h(X,10),X=Y,Y=N}N=v(this.h[1],z,J),this.h[1]=v(this.h[2],ne,j),this.h[2]=v(this.h[3],ue,he),this.h[3]=v(this.h[4],B,Y),this.h[4]=v(this.h[0],U,X),this.h[0]=N},E.prototype._digest=function(L){return L==="hex"?g.toHex32(this.h,"little"):g.split32(this.h,"little")};function _(I,L,$,B){return I<=15?L^$^B:I<=31?L&$|~L&B:I<=47?(L|~$)^B:I<=63?L&B|$&~B:L^($|~B)}function S(I){return I<=15?0:I<=31?1518500249:I<=47?1859775393:I<=63?2400959708:2840853838}function A(I){return I<=15?1352829926:I<=31?1548603684:I<=47?1836072691:I<=63?2053994217:0}var R=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],x=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],T=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],C=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11];return ripemd}var hmac,hasRequiredHmac;function requireHmac(){if(hasRequiredHmac)return hmac;hasRequiredHmac=1;var g=requireUtils$4(),u=requireMinimalisticAssert();function h(y,v,b){if(!(this instanceof h))return new h(y,v,b);this.Hash=y,this.blockSize=y.blockSize/8,this.outSize=y.outSize/8,this.inner=null,this.outer=null,this._init(g.toArray(v,b))}return hmac=h,h.prototype._init=function(v){v.length>this.blockSize&&(v=new this.Hash().update(v).digest()),u(v.length<=this.blockSize);for(var b=v.length;b<this.blockSize;b++)v.push(0);for(b=0;b<v.length;b++)v[b]^=54;for(this.inner=new this.Hash().update(v),b=0;b<v.length;b++)v[b]^=106;this.outer=new this.Hash().update(v)},h.prototype.update=function(v,b){return this.inner.update(v,b),this},h.prototype.digest=function(v){return this.outer.update(this.inner.digest()),this.outer.digest(v)},hmac}var hasRequiredHash$1;function requireHash$1(){return hasRequiredHash$1||(hasRequiredHash$1=1,(function(g){var u=g;u.utils=requireUtils$4(),u.common=requireCommon$1(),u.sha=requireSha$1(),u.ripemd=requireRipemd(),u.hmac=requireHmac(),u.sha1=u.sha.sha1,u.sha256=u.sha.sha256,u.sha224=u.sha.sha224,u.sha384=u.sha.sha384,u.sha512=u.sha.sha512,u.ripemd160=u.ripemd.ripemd160})(hash$1)),hash$1}var util$2={},types={},shams$1,hasRequiredShams$1;function requireShams$1(){return hasRequiredShams$1||(hasRequiredShams$1=1,shams$1=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var u={},h=Symbol("test"),y=Object(h);if(typeof h=="string"||Object.prototype.toString.call(h)!=="[object Symbol]"||Object.prototype.toString.call(y)!=="[object Symbol]")return!1;var v=42;u[h]=v;for(var b in u)return!1;if(typeof Object.keys=="function"&&Object.keys(u).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(u).length!==0)return!1;var w=Object.getOwnPropertySymbols(u);if(w.length!==1||w[0]!==h||!Object.prototype.propertyIsEnumerable.call(u,h))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var E=Object.getOwnPropertyDescriptor(u,h);if(E.value!==v||E.enumerable!==!0)return!1}return!0}),shams$1}var shams,hasRequiredShams;function requireShams(){if(hasRequiredShams)return shams;hasRequiredShams=1;var g=requireShams$1();return shams=function(){return g()&&!!Symbol.toStringTag},shams}var esObjectAtoms,hasRequiredEsObjectAtoms;function requireEsObjectAtoms(){return hasRequiredEsObjectAtoms||(hasRequiredEsObjectAtoms=1,esObjectAtoms=Object),esObjectAtoms}var esErrors,hasRequiredEsErrors;function requireEsErrors(){return hasRequiredEsErrors||(hasRequiredEsErrors=1,esErrors=Error),esErrors}var _eval,hasRequired_eval;function require_eval(){return hasRequired_eval||(hasRequired_eval=1,_eval=EvalError),_eval}var range,hasRequiredRange;function requireRange(){return hasRequiredRange||(hasRequiredRange=1,range=RangeError),range}var ref,hasRequiredRef;function requireRef(){return hasRequiredRef||(hasRequiredRef=1,ref=ReferenceError),ref}var syntax,hasRequiredSyntax;function requireSyntax(){return hasRequiredSyntax||(hasRequiredSyntax=1,syntax=SyntaxError),syntax}var type,hasRequiredType;function requireType(){return hasRequiredType||(hasRequiredType=1,type=TypeError),type}var uri,hasRequiredUri;function requireUri(){return hasRequiredUri||(hasRequiredUri=1,uri=URIError),uri}var abs,hasRequiredAbs;function requireAbs(){return hasRequiredAbs||(hasRequiredAbs=1,abs=Math.abs),abs}var floor,hasRequiredFloor;function requireFloor(){return hasRequiredFloor||(hasRequiredFloor=1,floor=Math.floor),floor}var max,hasRequiredMax;function requireMax(){return hasRequiredMax||(hasRequiredMax=1,max=Math.max),max}var min,hasRequiredMin;function requireMin(){return hasRequiredMin||(hasRequiredMin=1,min=Math.min),min}var pow,hasRequiredPow;function requirePow(){return hasRequiredPow||(hasRequiredPow=1,pow=Math.pow),pow}var round,hasRequiredRound;function requireRound(){return hasRequiredRound||(hasRequiredRound=1,round=Math.round),round}var _isNaN,hasRequired_isNaN;function require_isNaN(){return hasRequired_isNaN||(hasRequired_isNaN=1,_isNaN=Number.isNaN||function(u){return u!==u}),_isNaN}var sign$2,hasRequiredSign$1;function requireSign$1(){if(hasRequiredSign$1)return sign$2;hasRequiredSign$1=1;var g=require_isNaN();return sign$2=function(h){return g(h)||h===0?h:h<0?-1:1},sign$2}var gOPD,hasRequiredGOPD;function requireGOPD(){return hasRequiredGOPD||(hasRequiredGOPD=1,gOPD=Object.getOwnPropertyDescriptor),gOPD}var gopd,hasRequiredGopd;function requireGopd(){if(hasRequiredGopd)return gopd;hasRequiredGopd=1;var g=requireGOPD();if(g)try{g([],"length")}catch{g=null}return gopd=g,gopd}var esDefineProperty,hasRequiredEsDefineProperty;function requireEsDefineProperty(){if(hasRequiredEsDefineProperty)return esDefineProperty;hasRequiredEsDefineProperty=1;var g=Object.defineProperty||!1;if(g)try{g({},"a",{value:1})}catch{g=!1}return esDefineProperty=g,esDefineProperty}var hasSymbols,hasRequiredHasSymbols;function requireHasSymbols(){if(hasRequiredHasSymbols)return hasSymbols;hasRequiredHasSymbols=1;var g=typeof Symbol<"u"&&Symbol,u=requireShams$1();return hasSymbols=function(){return typeof g!="function"||typeof Symbol!="function"||typeof g("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:u()},hasSymbols}var Reflect_getPrototypeOf,hasRequiredReflect_getPrototypeOf;function requireReflect_getPrototypeOf(){return hasRequiredReflect_getPrototypeOf||(hasRequiredReflect_getPrototypeOf=1,Reflect_getPrototypeOf=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Reflect_getPrototypeOf}var Object_getPrototypeOf,hasRequiredObject_getPrototypeOf;function requireObject_getPrototypeOf(){if(hasRequiredObject_getPrototypeOf)return Object_getPrototypeOf;hasRequiredObject_getPrototypeOf=1;var g=requireEsObjectAtoms();return Object_getPrototypeOf=g.getPrototypeOf||null,Object_getPrototypeOf}var implementation$1,hasRequiredImplementation$1;function requireImplementation$1(){if(hasRequiredImplementation$1)return implementation$1;hasRequiredImplementation$1=1;var g="Function.prototype.bind called on incompatible ",u=Object.prototype.toString,h=Math.max,y="[object Function]",v=function(_,S){for(var A=[],R=0;R<_.length;R+=1)A[R]=_[R];for(var x=0;x<S.length;x+=1)A[x+_.length]=S[x];return A},b=function(_,S){for(var A=[],R=S,x=0;R<_.length;R+=1,x+=1)A[x]=_[R];return A},w=function(E,_){for(var S="",A=0;A<E.length;A+=1)S+=E[A],A+1<E.length&&(S+=_);return S};return implementation$1=function(_){var S=this;if(typeof S!="function"||u.apply(S)!==y)throw new TypeError(g+S);for(var A=b(arguments,1),R,x=function(){if(this instanceof R){var $=S.apply(this,v(A,arguments));return Object($)===$?$:this}return S.apply(_,v(A,arguments))},T=h(0,S.length-A.length),C=[],I=0;I<T;I++)C[I]="$"+I;if(R=Function("binder","return function ("+w(C,",")+"){ return binder.apply(this,arguments); }")(x),S.prototype){var L=function(){};L.prototype=S.prototype,R.prototype=new L,L.prototype=null}return R},implementation$1}var functionBind,hasRequiredFunctionBind;function requireFunctionBind(){if(hasRequiredFunctionBind)return functionBind;hasRequiredFunctionBind=1;var g=requireImplementation$1();return functionBind=Function.prototype.bind||g,functionBind}var functionCall,hasRequiredFunctionCall;function requireFunctionCall(){return hasRequiredFunctionCall||(hasRequiredFunctionCall=1,functionCall=Function.prototype.call),functionCall}var functionApply,hasRequiredFunctionApply;function requireFunctionApply(){return hasRequiredFunctionApply||(hasRequiredFunctionApply=1,functionApply=Function.prototype.apply),functionApply}var reflectApply,hasRequiredReflectApply;function requireReflectApply(){return hasRequiredReflectApply||(hasRequiredReflectApply=1,reflectApply=typeof Reflect<"u"&&Reflect&&Reflect.apply),reflectApply}var actualApply,hasRequiredActualApply;function requireActualApply(){if(hasRequiredActualApply)return actualApply;hasRequiredActualApply=1;var g=requireFunctionBind(),u=requireFunctionApply(),h=requireFunctionCall(),y=requireReflectApply();return actualApply=y||g.call(h,u),actualApply}var callBindApplyHelpers,hasRequiredCallBindApplyHelpers;function requireCallBindApplyHelpers(){if(hasRequiredCallBindApplyHelpers)return callBindApplyHelpers;hasRequiredCallBindApplyHelpers=1;var g=requireFunctionBind(),u=requireType(),h=requireFunctionCall(),y=requireActualApply();return callBindApplyHelpers=function(b){if(b.length<1||typeof b[0]!="function")throw new u("a function is required");return y(g,h,b)},callBindApplyHelpers}var get$1,hasRequiredGet;function requireGet(){if(hasRequiredGet)return get$1;hasRequiredGet=1;var g=requireCallBindApplyHelpers(),u=requireGopd(),h;try{h=[].__proto__===Array.prototype}catch(w){if(!w||typeof w!="object"||!("code"in w)||w.code!=="ERR_PROTO_ACCESS")throw w}var y=!!h&&u&&u(Object.prototype,"__proto__"),v=Object,b=v.getPrototypeOf;return get$1=y&&typeof y.get=="function"?g([y.get]):typeof b=="function"?function(E){return b(E==null?E:v(E))}:!1,get$1}var getProto,hasRequiredGetProto;function requireGetProto(){if(hasRequiredGetProto)return getProto;hasRequiredGetProto=1;var g=requireReflect_getPrototypeOf(),u=requireObject_getPrototypeOf(),h=requireGet();return getProto=g?function(v){return g(v)}:u?function(v){if(!v||typeof v!="object"&&typeof v!="function")throw new TypeError("getProto: not an object");return u(v)}:h?function(v){return h(v)}:null,getProto}var hasown,hasRequiredHasown;function requireHasown(){if(hasRequiredHasown)return hasown;hasRequiredHasown=1;var g=Function.prototype.call,u=Object.prototype.hasOwnProperty,h=requireFunctionBind();return hasown=h.call(g,u),hasown}var getIntrinsic,hasRequiredGetIntrinsic;function requireGetIntrinsic(){if(hasRequiredGetIntrinsic)return getIntrinsic;hasRequiredGetIntrinsic=1;var g,u=requireEsObjectAtoms(),h=requireEsErrors(),y=require_eval(),v=requireRange(),b=requireRef(),w=requireSyntax(),E=requireType(),_=requireUri(),S=requireAbs(),A=requireFloor(),R=requireMax(),x=requireMin(),T=requirePow(),C=requireRound(),I=requireSign$1(),L=Function,$=function(ge){try{return L('"use strict"; return ('+ge+").constructor;")()}catch{}},B=requireGopd(),U=requireEsDefineProperty(),z=function(){throw new E},ne=B?(function(){try{return arguments.callee,z}catch{try{return B(arguments,"callee").get}catch{return z}}})():z,ue=requireHasSymbols()(),he=requireGetProto(),Y=requireObject_getPrototypeOf(),X=requireReflect_getPrototypeOf(),J=requireFunctionApply(),j=requireFunctionCall(),M={},N=typeof Uint8Array>"u"||!he?g:he(Uint8Array),P={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?g:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?g:ArrayBuffer,"%ArrayIteratorPrototype%":ue&&he?he([][Symbol.iterator]()):g,"%AsyncFromSyncIteratorPrototype%":g,"%AsyncFunction%":M,"%AsyncGenerator%":M,"%AsyncGeneratorFunction%":M,"%AsyncIteratorPrototype%":M,"%Atomics%":typeof Atomics>"u"?g:Atomics,"%BigInt%":typeof BigInt>"u"?g:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?g:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?g:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?g:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":h,"%eval%":eval,"%EvalError%":y,"%Float16Array%":typeof Float16Array>"u"?g:Float16Array,"%Float32Array%":typeof Float32Array>"u"?g:Float32Array,"%Float64Array%":typeof Float64Array>"u"?g:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?g:FinalizationRegistry,"%Function%":L,"%GeneratorFunction%":M,"%Int8Array%":typeof Int8Array>"u"?g:Int8Array,"%Int16Array%":typeof Int16Array>"u"?g:Int16Array,"%Int32Array%":typeof Int32Array>"u"?g:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":ue&&he?he(he([][Symbol.iterator]())):g,"%JSON%":typeof JSON=="object"?JSON:g,"%Map%":typeof Map>"u"?g:Map,"%MapIteratorPrototype%":typeof Map>"u"||!ue||!he?g:he(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":u,"%Object.getOwnPropertyDescriptor%":B,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?g:Promise,"%Proxy%":typeof Proxy>"u"?g:Proxy,"%RangeError%":v,"%ReferenceError%":b,"%Reflect%":typeof Reflect>"u"?g:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?g:Set,"%SetIteratorPrototype%":typeof Set>"u"||!ue||!he?g:he(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?g:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":ue&&he?he(""[Symbol.iterator]()):g,"%Symbol%":ue?Symbol:g,"%SyntaxError%":w,"%ThrowTypeError%":ne,"%TypedArray%":N,"%TypeError%":E,"%Uint8Array%":typeof Uint8Array>"u"?g:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?g:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?g:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?g:Uint32Array,"%URIError%":_,"%WeakMap%":typeof WeakMap>"u"?g:WeakMap,"%WeakRef%":typeof WeakRef>"u"?g:WeakRef,"%WeakSet%":typeof WeakSet>"u"?g:WeakSet,"%Function.prototype.call%":j,"%Function.prototype.apply%":J,"%Object.defineProperty%":U,"%Object.getPrototypeOf%":Y,"%Math.abs%":S,"%Math.floor%":A,"%Math.max%":R,"%Math.min%":x,"%Math.pow%":T,"%Math.round%":C,"%Math.sign%":I,"%Reflect.getPrototypeOf%":X};if(he)try{null.error}catch(ge){var O=he(he(ge));P["%Error.prototype%"]=O}var k=function ge(Ee){var pe;if(Ee==="%AsyncFunction%")pe=$("async function () {}");else if(Ee==="%GeneratorFunction%")pe=$("function* () {}");else if(Ee==="%AsyncGeneratorFunction%")pe=$("async function* () {}");else if(Ee==="%AsyncGenerator%"){var de=ge("%AsyncGeneratorFunction%");de&&(pe=de.prototype)}else if(Ee==="%AsyncIteratorPrototype%"){var me=ge("%AsyncGenerator%");me&&he&&(pe=he(me.prototype))}return P[Ee]=pe,pe},q={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},F=requireFunctionBind(),H=requireHasown(),D=F.call(j,Array.prototype.concat),G=F.call(J,Array.prototype.splice),W=F.call(j,String.prototype.replace),K=F.call(j,String.prototype.slice),Z=F.call(j,RegExp.prototype.exec),ae=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,le=/\\(\\)?/g,te=function(Ee){var pe=K(Ee,0,1),de=K(Ee,-1);if(pe==="%"&&de!=="%")throw new w("invalid intrinsic syntax, expected closing `%`");if(de==="%"&&pe!=="%")throw new w("invalid intrinsic syntax, expected opening `%`");var me=[];return W(Ee,ae,function(_e,Ae,Pe,Me){me[me.length]=Pe?W(Me,le,"$1"):Ae||_e}),me},ce=function(Ee,pe){var de=Ee,me;if(H(q,de)&&(me=q[de],de="%"+me[0]+"%"),H(P,de)){var _e=P[de];if(_e===M&&(_e=k(de)),typeof _e>"u"&&!pe)throw new E("intrinsic "+Ee+" exists, but is not available. Please file an issue!");return{alias:me,name:de,value:_e}}throw new w("intrinsic "+Ee+" does not exist!")};return getIntrinsic=function(Ee,pe){if(typeof Ee!="string"||Ee.length===0)throw new E("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof pe!="boolean")throw new E('"allowMissing" argument must be a boolean');if(Z(/^%?[^%]*%?$/,Ee)===null)throw new w("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var de=te(Ee),me=de.length>0?de[0]:"",_e=ce("%"+me+"%",pe),Ae=_e.name,Pe=_e.value,Me=!1,Ne=_e.alias;Ne&&(me=Ne[0],G(de,D([0,1],Ne)));for(var we=1,Le=!0;we<de.length;we+=1){var Oe=de[we],Ce=K(Oe,0,1),We=K(Oe,-1);if((Ce==='"'||Ce==="'"||Ce==="`"||We==='"'||We==="'"||We==="`")&&Ce!==We)throw new w("property names with quotes must have matching quotes");if((Oe==="constructor"||!Le)&&(Me=!0),me+="."+Oe,Ae="%"+me+"%",H(P,Ae))Pe=P[Ae];else if(Pe!=null){if(!(Oe in Pe)){if(!pe)throw new E("base intrinsic for "+Ee+" exists, but the property is not available.");return}if(B&&we+1>=de.length){var ze=B(Pe,Oe);Le=!!ze,Le&&"get"in ze&&!("originalValue"in ze.get)?Pe=ze.get:Pe=Pe[Oe]}else Le=H(Pe,Oe),Pe=Pe[Oe];Le&&!Me&&(P[Ae]=Pe)}}return Pe},getIntrinsic}var callBound,hasRequiredCallBound;function requireCallBound(){if(hasRequiredCallBound)return callBound;hasRequiredCallBound=1;var g=requireGetIntrinsic(),u=requireCallBindApplyHelpers(),h=u([g("%String.prototype.indexOf%")]);return callBound=function(v,b){var w=g(v,!!b);return typeof w=="function"&&h(v,".prototype.")>-1?u([w]):w},callBound}var isArguments$1,hasRequiredIsArguments$1;function requireIsArguments$1(){if(hasRequiredIsArguments$1)return isArguments$1;hasRequiredIsArguments$1=1;var g=requireShams()(),u=requireCallBound(),h=u("Object.prototype.toString"),y=function(E){return g&&E&&typeof E=="object"&&Symbol.toStringTag in E?!1:h(E)==="[object Arguments]"},v=function(E){return y(E)?!0:E!==null&&typeof E=="object"&&"length"in E&&typeof E.length=="number"&&E.length>=0&&h(E)!=="[object Array]"&&"callee"in E&&h(E.callee)==="[object Function]"},b=(function(){return y(arguments)})();return y.isLegacyArguments=v,isArguments$1=b?y:v,isArguments$1}var isRegex,hasRequiredIsRegex;function requireIsRegex(){if(hasRequiredIsRegex)return isRegex;hasRequiredIsRegex=1;var g=requireCallBound(),u=requireShams()(),h=requireHasown(),y=requireGopd(),v;if(u){var b=g("RegExp.prototype.exec"),w={},E=function(){throw w},_={toString:E,valueOf:E};typeof Symbol.toPrimitive=="symbol"&&(_[Symbol.toPrimitive]=E),v=function(x){if(!x||typeof x!="object")return!1;var T=y(x,"lastIndex"),C=T&&h(T,"value");if(!C)return!1;try{b(x,_)}catch(I){return I===w}}}else{var S=g("Object.prototype.toString"),A="[object RegExp]";v=function(x){return!x||typeof x!="object"&&typeof x!="function"?!1:S(x)===A}}return isRegex=v,isRegex}var safeRegexTest,hasRequiredSafeRegexTest;function requireSafeRegexTest(){if(hasRequiredSafeRegexTest)return safeRegexTest;hasRequiredSafeRegexTest=1;var g=requireCallBound(),u=requireIsRegex(),h=g("RegExp.prototype.exec"),y=requireType();return safeRegexTest=function(b){if(!u(b))throw new y("`regex` must be a RegExp");return function(E){return h(b,E)!==null}},safeRegexTest}var isGeneratorFunction,hasRequiredIsGeneratorFunction;function requireIsGeneratorFunction(){if(hasRequiredIsGeneratorFunction)return isGeneratorFunction;hasRequiredIsGeneratorFunction=1;var g=requireCallBound(),u=requireSafeRegexTest(),h=u(/^\s*(?:function)?\*/),y=requireShams()(),v=requireGetProto(),b=g("Object.prototype.toString"),w=g("Function.prototype.toString"),E=function(){if(!y)return!1;try{return Function("return function*() {}")()}catch{}},_;return isGeneratorFunction=function(A){if(typeof A!="function")return!1;if(h(w(A)))return!0;if(!y){var R=b(A);return R==="[object GeneratorFunction]"}if(!v)return!1;if(typeof _>"u"){var x=E();_=x?v(x):!1}return v(A)===_},isGeneratorFunction}var isCallable,hasRequiredIsCallable;function requireIsCallable(){if(hasRequiredIsCallable)return isCallable;hasRequiredIsCallable=1;var g=Function.prototype.toString,u=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,h,y;if(typeof u=="function"&&typeof Object.defineProperty=="function")try{h=Object.defineProperty({},"length",{get:function(){throw y}}),y={},u(function(){throw 42},null,h)}catch(B){B!==y&&(u=null)}else u=null;var v=/^\s*class\b/,b=function(U){try{var z=g.call(U);return v.test(z)}catch{return!1}},w=function(U){try{return b(U)?!1:(g.call(U),!0)}catch{return!1}},E=Object.prototype.toString,_="[object Object]",S="[object Function]",A="[object GeneratorFunction]",R="[object HTMLAllCollection]",x="[object HTML document.all class]",T="[object HTMLCollection]",C=typeof Symbol=="function"&&!!Symbol.toStringTag,I=!(0 in[,]),L=function(){return!1};if(typeof document=="object"){var $=document.all;E.call($)===E.call(document.all)&&(L=function(U){if((I||!U)&&(typeof U>"u"||typeof U=="object"))try{var z=E.call(U);return(z===R||z===x||z===T||z===_)&&U("")==null}catch{}return!1})}return isCallable=u?function(U){if(L(U))return!0;if(!U||typeof U!="function"&&typeof U!="object")return!1;try{u(U,null,h)}catch(z){if(z!==y)return!1}return!b(U)&&w(U)}:function(U){if(L(U))return!0;if(!U||typeof U!="function"&&typeof U!="object")return!1;if(C)return w(U);if(b(U))return!1;var z=E.call(U);return z!==S&&z!==A&&!/^\[object HTML/.test(z)?!1:w(U)},isCallable}var forEach,hasRequiredForEach;function requireForEach(){if(hasRequiredForEach)return forEach;hasRequiredForEach=1;var g=requireIsCallable(),u=Object.prototype.toString,h=Object.prototype.hasOwnProperty,y=function(_,S,A){for(var R=0,x=_.length;R<x;R++)h.call(_,R)&&(A==null?S(_[R],R,_):S.call(A,_[R],R,_))},v=function(_,S,A){for(var R=0,x=_.length;R<x;R++)A==null?S(_.charAt(R),R,_):S.call(A,_.charAt(R),R,_)},b=function(_,S,A){for(var R in _)h.call(_,R)&&(A==null?S(_[R],R,_):S.call(A,_[R],R,_))};function w(E){return u.call(E)==="[object Array]"}return forEach=function(_,S,A){if(!g(S))throw new TypeError("iterator must be a function");var R;arguments.length>=3&&(R=A),w(_)?y(_,S,R):typeof _=="string"?v(_,S,R):b(_,S,R)},forEach}var possibleTypedArrayNames,hasRequiredPossibleTypedArrayNames;function requirePossibleTypedArrayNames(){return hasRequiredPossibleTypedArrayNames||(hasRequiredPossibleTypedArrayNames=1,possibleTypedArrayNames=["Float16Array","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"]),possibleTypedArrayNames}var availableTypedArrays,hasRequiredAvailableTypedArrays;function requireAvailableTypedArrays(){if(hasRequiredAvailableTypedArrays)return availableTypedArrays;hasRequiredAvailableTypedArrays=1;var g=requirePossibleTypedArrayNames(),u=globalThis;return availableTypedArrays=function(){for(var y=[],v=0;v<g.length;v++)typeof u[g[v]]=="function"&&(y[y.length]=g[v]);return y},availableTypedArrays}var callBind={exports:{}},defineDataProperty,hasRequiredDefineDataProperty;function requireDefineDataProperty(){if(hasRequiredDefineDataProperty)return defineDataProperty;hasRequiredDefineDataProperty=1;var g=requireEsDefineProperty(),u=requireSyntax(),h=requireType(),y=requireGopd();return defineDataProperty=function(b,w,E){if(!b||typeof b!="object"&&typeof b!="function")throw new h("`obj` must be an object or a function`");if(typeof w!="string"&&typeof w!="symbol")throw new h("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new h("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new h("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new h("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new h("`loose`, if provided, must be a boolean");var _=arguments.length>3?arguments[3]:null,S=arguments.length>4?arguments[4]:null,A=arguments.length>5?arguments[5]:null,R=arguments.length>6?arguments[6]:!1,x=!!y&&y(b,w);if(g)g(b,w,{configurable:A===null&&x?x.configurable:!A,enumerable:_===null&&x?x.enumerable:!_,value:E,writable:S===null&&x?x.writable:!S});else if(R||!_&&!S&&!A)b[w]=E;else throw new u("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},defineDataProperty}var hasPropertyDescriptors_1,hasRequiredHasPropertyDescriptors;function requireHasPropertyDescriptors(){if(hasRequiredHasPropertyDescriptors)return hasPropertyDescriptors_1;hasRequiredHasPropertyDescriptors=1;var g=requireEsDefineProperty(),u=function(){return!!g};return u.hasArrayLengthDefineBug=function(){if(!g)return null;try{return g([],"length",{value:1}).length!==1}catch{return!0}},hasPropertyDescriptors_1=u,hasPropertyDescriptors_1}var setFunctionLength,hasRequiredSetFunctionLength;function requireSetFunctionLength(){if(hasRequiredSetFunctionLength)return setFunctionLength;hasRequiredSetFunctionLength=1;var g=requireGetIntrinsic(),u=requireDefineDataProperty(),h=requireHasPropertyDescriptors()(),y=requireGopd(),v=requireType(),b=g("%Math.floor%");return setFunctionLength=function(E,_){if(typeof E!="function")throw new v("`fn` is not a function");if(typeof _!="number"||_<0||_>4294967295||b(_)!==_)throw new v("`length` must be a positive 32-bit integer");var S=arguments.length>2&&!!arguments[2],A=!0,R=!0;if("length"in E&&y){var x=y(E,"length");x&&!x.configurable&&(A=!1),x&&!x.writable&&(R=!1)}return(A||R||!S)&&(h?u(E,"length",_,!0,!0):u(E,"length",_)),E},setFunctionLength}var applyBind,hasRequiredApplyBind;function requireApplyBind(){if(hasRequiredApplyBind)return applyBind;hasRequiredApplyBind=1;var g=requireFunctionBind(),u=requireFunctionApply(),h=requireActualApply();return applyBind=function(){return h(g,u,arguments)},applyBind}var hasRequiredCallBind;function requireCallBind(){return hasRequiredCallBind||(hasRequiredCallBind=1,(function(g){var u=requireSetFunctionLength(),h=requireEsDefineProperty(),y=requireCallBindApplyHelpers(),v=requireApplyBind();g.exports=function(w){var E=y(arguments),_=w.length-(arguments.length-1);return u(E,1+(_>0?_:0),!0)},h?h(g.exports,"apply",{value:v}):g.exports.apply=v})(callBind)),callBind.exports}var whichTypedArray,hasRequiredWhichTypedArray;function requireWhichTypedArray(){if(hasRequiredWhichTypedArray)return whichTypedArray;hasRequiredWhichTypedArray=1;var g=requireForEach(),u=requireAvailableTypedArrays(),h=requireCallBind(),y=requireCallBound(),v=requireGopd(),b=requireGetProto(),w=y("Object.prototype.toString"),E=requireShams()(),_=globalThis,S=u(),A=y("String.prototype.slice"),R=y("Array.prototype.indexOf",!0)||function(L,$){for(var B=0;B<L.length;B+=1)if(L[B]===$)return B;return-1},x={__proto__:null};E&&v&&b?g(S,function(I){var L=new _[I];if(Symbol.toStringTag in L&&b){var $=b(L),B=v($,Symbol.toStringTag);if(!B&&$){var U=b($);B=v(U,Symbol.toStringTag)}x["$"+I]=h(B.get)}}):g(S,function(I){var L=new _[I],$=L.slice||L.set;$&&(x["$"+I]=h($))});var T=function(L){var $=!1;return g(x,function(B,U){if(!$)try{"$"+B(L)===U&&($=A(U,1))}catch{}}),$},C=function(L){var $=!1;return g(x,function(B,U){if(!$)try{B(L),$=A(U,1)}catch{}}),$};return whichTypedArray=function(L){if(!L||typeof L!="object")return!1;if(!E){var $=A(w(L),8,-1);return R(S,$)>-1?$:$!=="Object"?!1:C(L)}return v?T(L):null},whichTypedArray}var isTypedArray,hasRequiredIsTypedArray;function requireIsTypedArray(){if(hasRequiredIsTypedArray)return isTypedArray;hasRequiredIsTypedArray=1;var g=requireWhichTypedArray();return isTypedArray=function(h){return!!g(h)},isTypedArray}var hasRequiredTypes;function requireTypes(){return hasRequiredTypes||(hasRequiredTypes=1,(function(g){var u=requireIsArguments$1(),h=requireIsGeneratorFunction(),y=requireWhichTypedArray(),v=requireIsTypedArray();function b(we){return we.call.bind(we)}var w=typeof BigInt<"u",E=typeof Symbol<"u",_=b(Object.prototype.toString),S=b(Number.prototype.valueOf),A=b(String.prototype.valueOf),R=b(Boolean.prototype.valueOf);if(w)var x=b(BigInt.prototype.valueOf);if(E)var T=b(Symbol.prototype.valueOf);function C(we,Le){if(typeof we!="object")return!1;try{return Le(we),!0}catch{return!1}}g.isArgumentsObject=u,g.isGeneratorFunction=h,g.isTypedArray=v;function I(we){return typeof Promise<"u"&&we instanceof Promise||we!==null&&typeof we=="object"&&typeof we.then=="function"&&typeof we.catch=="function"}g.isPromise=I;function L(we){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(we):v(we)||K(we)}g.isArrayBufferView=L;function $(we){return y(we)==="Uint8Array"}g.isUint8Array=$;function B(we){return y(we)==="Uint8ClampedArray"}g.isUint8ClampedArray=B;function U(we){return y(we)==="Uint16Array"}g.isUint16Array=U;function z(we){return y(we)==="Uint32Array"}g.isUint32Array=z;function ne(we){return y(we)==="Int8Array"}g.isInt8Array=ne;function ue(we){return y(we)==="Int16Array"}g.isInt16Array=ue;function he(we){return y(we)==="Int32Array"}g.isInt32Array=he;function Y(we){return y(we)==="Float32Array"}g.isFloat32Array=Y;function X(we){return y(we)==="Float64Array"}g.isFloat64Array=X;function J(we){return y(we)==="BigInt64Array"}g.isBigInt64Array=J;function j(we){return y(we)==="BigUint64Array"}g.isBigUint64Array=j;function M(we){return _(we)==="[object Map]"}M.working=typeof Map<"u"&&M(new Map);function N(we){return typeof Map>"u"?!1:M.working?M(we):we instanceof Map}g.isMap=N;function P(we){return _(we)==="[object Set]"}P.working=typeof Set<"u"&&P(new Set);function O(we){return typeof Set>"u"?!1:P.working?P(we):we instanceof Set}g.isSet=O;function k(we){return _(we)==="[object WeakMap]"}k.working=typeof WeakMap<"u"&&k(new WeakMap);function q(we){return typeof WeakMap>"u"?!1:k.working?k(we):we instanceof WeakMap}g.isWeakMap=q;function F(we){return _(we)==="[object WeakSet]"}F.working=typeof WeakSet<"u"&&F(new WeakSet);function H(we){return F(we)}g.isWeakSet=H;function D(we){return _(we)==="[object ArrayBuffer]"}D.working=typeof ArrayBuffer<"u"&&D(new ArrayBuffer);function G(we){return typeof ArrayBuffer>"u"?!1:D.working?D(we):we instanceof ArrayBuffer}g.isArrayBuffer=G;function W(we){return _(we)==="[object DataView]"}W.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&W(new DataView(new ArrayBuffer(1),0,1));function K(we){return typeof DataView>"u"?!1:W.working?W(we):we instanceof DataView}g.isDataView=K;var Z=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function ae(we){return _(we)==="[object SharedArrayBuffer]"}function le(we){return typeof Z>"u"?!1:(typeof ae.working>"u"&&(ae.working=ae(new Z)),ae.working?ae(we):we instanceof Z)}g.isSharedArrayBuffer=le;function te(we){return _(we)==="[object AsyncFunction]"}g.isAsyncFunction=te;function ce(we){return _(we)==="[object Map Iterator]"}g.isMapIterator=ce;function ge(we){return _(we)==="[object Set Iterator]"}g.isSetIterator=ge;function Ee(we){return _(we)==="[object Generator]"}g.isGeneratorObject=Ee;function pe(we){return _(we)==="[object WebAssembly.Module]"}g.isWebAssemblyCompiledModule=pe;function de(we){return C(we,S)}g.isNumberObject=de;function me(we){return C(we,A)}g.isStringObject=me;function _e(we){return C(we,R)}g.isBooleanObject=_e;function Ae(we){return w&&C(we,x)}g.isBigIntObject=Ae;function Pe(we){return E&&C(we,T)}g.isSymbolObject=Pe;function Me(we){return de(we)||me(we)||_e(we)||Ae(we)||Pe(we)}g.isBoxedPrimitive=Me;function Ne(we){return typeof Uint8Array<"u"&&(G(we)||le(we))}g.isAnyArrayBuffer=Ne,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(we){Object.defineProperty(g,we,{enumerable:!1,value:function(){throw new Error(we+" is not supported in userland")}})})})(types)),types}var isBufferBrowser,hasRequiredIsBufferBrowser;function requireIsBufferBrowser(){return hasRequiredIsBufferBrowser||(hasRequiredIsBufferBrowser=1,isBufferBrowser=function(u){return u&&typeof u=="object"&&typeof u.copy=="function"&&typeof u.fill=="function"&&typeof u.readUInt8=="function"}),isBufferBrowser}var hasRequiredUtil$2;function requireUtil$2(){return hasRequiredUtil$2||(hasRequiredUtil$2=1,(function(g){var u={},h=Object.getOwnPropertyDescriptors||function(Z){for(var ae=Object.keys(Z),le={},te=0;te<ae.length;te++)le[ae[te]]=Object.getOwnPropertyDescriptor(Z,ae[te]);return le},y=/%[sdj%]/g;g.format=function(K){if(!ue(K)){for(var Z=[],ae=0;ae<arguments.length;ae++)Z.push(E(arguments[ae]));return Z.join(" ")}for(var ae=1,le=arguments,te=le.length,ce=String(K).replace(y,function(Ee){if(Ee==="%%")return"%";if(ae>=te)return Ee;switch(Ee){case"%s":return String(le[ae++]);case"%d":return Number(le[ae++]);case"%j":try{return JSON.stringify(le[ae++])}catch{return"[Circular]"}default:return Ee}}),ge=le[ae];ae<te;ge=le[++ae])U(ge)||!J(ge)?ce+=" "+ge:ce+=" "+E(ge);return ce},g.deprecate=function(K,Z){if(typeof process$1<"u"&&process$1.noDeprecation===!0)return K;if(typeof process$1>"u")return function(){return g.deprecate(K,Z).apply(this,arguments)};var ae=!1;function le(){if(!ae){if(process$1.throwDeprecation)throw new Error(Z);process$1.traceDeprecation?console.trace(Z):console.error(Z),ae=!0}return K.apply(this,arguments)}return le};var v={},b=/^$/;if(u.NODE_DEBUG){var w=u.NODE_DEBUG;w=w.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),b=new RegExp("^"+w+"$","i")}g.debuglog=function(K){if(K=K.toUpperCase(),!v[K])if(b.test(K)){var Z=process$1.pid;v[K]=function(){var ae=g.format.apply(g,arguments);console.error("%s %d: %s",K,Z,ae)}}else v[K]=function(){};return v[K]};function E(K,Z){var ae={seen:[],stylize:S};return arguments.length>=3&&(ae.depth=arguments[2]),arguments.length>=4&&(ae.colors=arguments[3]),B(Z)?ae.showHidden=Z:Z&&g._extend(ae,Z),Y(ae.showHidden)&&(ae.showHidden=!1),Y(ae.depth)&&(ae.depth=2),Y(ae.colors)&&(ae.colors=!1),Y(ae.customInspect)&&(ae.customInspect=!0),ae.colors&&(ae.stylize=_),R(ae,K,ae.depth)}g.inspect=E,E.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},E.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function _(K,Z){var ae=E.styles[Z];return ae?"\x1B["+E.colors[ae][0]+"m"+K+"\x1B["+E.colors[ae][1]+"m":K}function S(K,Z){return K}function A(K){var Z={};return K.forEach(function(ae,le){Z[ae]=!0}),Z}function R(K,Z,ae){if(K.customInspect&&Z&&N(Z.inspect)&&Z.inspect!==g.inspect&&!(Z.constructor&&Z.constructor.prototype===Z)){var le=Z.inspect(ae,K);return ue(le)||(le=R(K,le,ae)),le}var te=x(K,Z);if(te)return te;var ce=Object.keys(Z),ge=A(ce);if(K.showHidden&&(ce=Object.getOwnPropertyNames(Z)),M(Z)&&(ce.indexOf("message")>=0||ce.indexOf("description")>=0))return T(Z);if(ce.length===0){if(N(Z)){var Ee=Z.name?": "+Z.name:"";return K.stylize("[Function"+Ee+"]","special")}if(X(Z))return K.stylize(RegExp.prototype.toString.call(Z),"regexp");if(j(Z))return K.stylize(Date.prototype.toString.call(Z),"date");if(M(Z))return T(Z)}var pe="",de=!1,me=["{","}"];if($(Z)&&(de=!0,me=["[","]"]),N(Z)){var _e=Z.name?": "+Z.name:"";pe=" [Function"+_e+"]"}if(X(Z)&&(pe=" "+RegExp.prototype.toString.call(Z)),j(Z)&&(pe=" "+Date.prototype.toUTCString.call(Z)),M(Z)&&(pe=" "+T(Z)),ce.length===0&&(!de||Z.length==0))return me[0]+pe+me[1];if(ae<0)return X(Z)?K.stylize(RegExp.prototype.toString.call(Z),"regexp"):K.stylize("[Object]","special");K.seen.push(Z);var Ae;return de?Ae=C(K,Z,ae,ge,ce):Ae=ce.map(function(Pe){return I(K,Z,ae,ge,Pe,de)}),K.seen.pop(),L(Ae,pe,me)}function x(K,Z){if(Y(Z))return K.stylize("undefined","undefined");if(ue(Z)){var ae="'"+JSON.stringify(Z).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return K.stylize(ae,"string")}if(ne(Z))return K.stylize(""+Z,"number");if(B(Z))return K.stylize(""+Z,"boolean");if(U(Z))return K.stylize("null","null")}function T(K){return"["+Error.prototype.toString.call(K)+"]"}function C(K,Z,ae,le,te){for(var ce=[],ge=0,Ee=Z.length;ge<Ee;++ge)H(Z,String(ge))?ce.push(I(K,Z,ae,le,String(ge),!0)):ce.push("");return te.forEach(function(pe){pe.match(/^\d+$/)||ce.push(I(K,Z,ae,le,pe,!0))}),ce}function I(K,Z,ae,le,te,ce){var ge,Ee,pe;if(pe=Object.getOwnPropertyDescriptor(Z,te)||{value:Z[te]},pe.get?pe.set?Ee=K.stylize("[Getter/Setter]","special"):Ee=K.stylize("[Getter]","special"):pe.set&&(Ee=K.stylize("[Setter]","special")),H(le,te)||(ge="["+te+"]"),Ee||(K.seen.indexOf(pe.value)<0?(U(ae)?Ee=R(K,pe.value,null):Ee=R(K,pe.value,ae-1),Ee.indexOf(`
`)>-1&&(ce?Ee=Ee.split(`
`).map(function(de){return"  "+de}).join(`
`).slice(2):Ee=`
`+Ee.split(`
`).map(function(de){return"   "+de}).join(`
`))):Ee=K.stylize("[Circular]","special")),Y(ge)){if(ce&&te.match(/^\d+$/))return Ee;ge=JSON.stringify(""+te),ge.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(ge=ge.slice(1,-1),ge=K.stylize(ge,"name")):(ge=ge.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),ge=K.stylize(ge,"string"))}return ge+": "+Ee}function L(K,Z,ae){var le=K.reduce(function(te,ce){return ce.indexOf(`
`)>=0,te+ce.replace(/\u001b\[\d\d?m/g,"").length+1},0);return le>60?ae[0]+(Z===""?"":Z+`
 `)+" "+K.join(`,
  `)+" "+ae[1]:ae[0]+Z+" "+K.join(", ")+" "+ae[1]}g.types=requireTypes();function $(K){return Array.isArray(K)}g.isArray=$;function B(K){return typeof K=="boolean"}g.isBoolean=B;function U(K){return K===null}g.isNull=U;function z(K){return K==null}g.isNullOrUndefined=z;function ne(K){return typeof K=="number"}g.isNumber=ne;function ue(K){return typeof K=="string"}g.isString=ue;function he(K){return typeof K=="symbol"}g.isSymbol=he;function Y(K){return K===void 0}g.isUndefined=Y;function X(K){return J(K)&&O(K)==="[object RegExp]"}g.isRegExp=X,g.types.isRegExp=X;function J(K){return typeof K=="object"&&K!==null}g.isObject=J;function j(K){return J(K)&&O(K)==="[object Date]"}g.isDate=j,g.types.isDate=j;function M(K){return J(K)&&(O(K)==="[object Error]"||K instanceof Error)}g.isError=M,g.types.isNativeError=M;function N(K){return typeof K=="function"}g.isFunction=N;function P(K){return K===null||typeof K=="boolean"||typeof K=="number"||typeof K=="string"||typeof K=="symbol"||typeof K>"u"}g.isPrimitive=P,g.isBuffer=requireIsBufferBrowser();function O(K){return Object.prototype.toString.call(K)}function k(K){return K<10?"0"+K.toString(10):K.toString(10)}var q=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function F(){var K=new Date,Z=[k(K.getHours()),k(K.getMinutes()),k(K.getSeconds())].join(":");return[K.getDate(),q[K.getMonth()],Z].join(" ")}g.log=function(){console.log("%s - %s",F(),g.format.apply(g,arguments))},g.inherits=requireInherits_browser(),g._extend=function(K,Z){if(!Z||!J(Z))return K;for(var ae=Object.keys(Z),le=ae.length;le--;)K[ae[le]]=Z[ae[le]];return K};function H(K,Z){return Object.prototype.hasOwnProperty.call(K,Z)}var D=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;g.promisify=function(Z){if(typeof Z!="function")throw new TypeError('The "original" argument must be of type Function');if(D&&Z[D]){var ae=Z[D];if(typeof ae!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(ae,D,{value:ae,enumerable:!1,writable:!1,configurable:!0}),ae}function ae(){for(var le,te,ce=new Promise(function(pe,de){le=pe,te=de}),ge=[],Ee=0;Ee<arguments.length;Ee++)ge.push(arguments[Ee]);ge.push(function(pe,de){pe?te(pe):le(de)});try{Z.apply(this,ge)}catch(pe){te(pe)}return ce}return Object.setPrototypeOf(ae,Object.getPrototypeOf(Z)),D&&Object.defineProperty(ae,D,{value:ae,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(ae,h(Z))},g.promisify.custom=D;function G(K,Z){if(!K){var ae=new Error("Promise was rejected with a falsy value");ae.reason=K,K=ae}return Z(K)}function W(K){if(typeof K!="function")throw new TypeError('The "original" argument must be of type Function');function Z(){for(var ae=[],le=0;le<arguments.length;le++)ae.push(arguments[le]);var te=ae.pop();if(typeof te!="function")throw new TypeError("The last argument must be of type Function");var ce=this,ge=function(){return te.apply(ce,arguments)};K.apply(this,ae).then(function(Ee){process$1.nextTick(ge.bind(null,null,Ee))},function(Ee){process$1.nextTick(G.bind(null,Ee,ge))})}return Object.setPrototypeOf(Z,Object.getPrototypeOf(K)),Object.defineProperties(Z,h(K)),Z}g.callbackify=W})(util$2)),util$2}var isArguments,hasRequiredIsArguments;function requireIsArguments(){if(hasRequiredIsArguments)return isArguments;hasRequiredIsArguments=1;var g=Object.prototype.toString;return isArguments=function(h){var y=g.call(h),v=y==="[object Arguments]";return v||(v=y!=="[object Array]"&&h!==null&&typeof h=="object"&&typeof h.length=="number"&&h.length>=0&&g.call(h.callee)==="[object Function]"),v},isArguments}var implementation,hasRequiredImplementation;function requireImplementation(){if(hasRequiredImplementation)return implementation;hasRequiredImplementation=1;var g;if(!Object.keys){var u=Object.prototype.hasOwnProperty,h=Object.prototype.toString,y=requireIsArguments(),v=Object.prototype.propertyIsEnumerable,b=!v.call({toString:null},"toString"),w=v.call(function(){},"prototype"),E=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],_=function(x){var T=x.constructor;return T&&T.prototype===x},S={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},A=(function(){if(typeof window>"u")return!1;for(var x in window)try{if(!S["$"+x]&&u.call(window,x)&&window[x]!==null&&typeof window[x]=="object")try{_(window[x])}catch{return!0}}catch{return!0}return!1})(),R=function(x){if(typeof window>"u"||!A)return _(x);try{return _(x)}catch{return!1}};g=function(T){var C=T!==null&&typeof T=="object",I=h.call(T)==="[object Function]",L=y(T),$=C&&h.call(T)==="[object String]",B=[];if(!C&&!I&&!L)throw new TypeError("Object.keys called on a non-object");var U=w&&I;if($&&T.length>0&&!u.call(T,0))for(var z=0;z<T.length;++z)B.push(String(z));if(L&&T.length>0)for(var ne=0;ne<T.length;++ne)B.push(String(ne));else for(var ue in T)!(U&&ue==="prototype")&&u.call(T,ue)&&B.push(String(ue));if(b)for(var he=R(T),Y=0;Y<E.length;++Y)!(he&&E[Y]==="constructor")&&u.call(T,E[Y])&&B.push(E[Y]);return B}}return implementation=g,implementation}var objectKeys,hasRequiredObjectKeys;function requireObjectKeys(){if(hasRequiredObjectKeys)return objectKeys;hasRequiredObjectKeys=1;var g=Array.prototype.slice,u=requireIsArguments(),h=Object.keys,y=h?function(w){return h(w)}:requireImplementation(),v=Object.keys;return y.shim=function(){if(Object.keys){var w=(function(){var E=Object.keys(arguments);return E&&E.length===arguments.length})(1,2);w||(Object.keys=function(_){return u(_)?v(g.call(_)):v(_)})}else Object.keys=y;return Object.keys||y},objectKeys=y,objectKeys}var elliptic={};const version$2="6.6.1",require$$0$1={version:version$2};var utils$3={},bn$1={exports:{}},bn=bn$1.exports,hasRequiredBn;function requireBn(){return hasRequiredBn||(hasRequiredBn=1,(function(g){(function(u,h){function y(j,M){if(!j)throw new Error(M||"Assertion failed")}function v(j,M){j.super_=M;var N=function(){};N.prototype=M.prototype,j.prototype=new N,j.prototype.constructor=j}function b(j,M,N){if(b.isBN(j))return j;this.negative=0,this.words=null,this.length=0,this.red=null,j!==null&&((M==="le"||M==="be")&&(N=M,M=10),this._init(j||0,M||10,N||"be"))}typeof u=="object"?u.exports=b:h.BN=b,b.BN=b,b.wordSize=26;var w;try{typeof window<"u"&&typeof window.Buffer<"u"?w=window.Buffer:w=requireDist$1().Buffer}catch{}b.isBN=function(M){return M instanceof b?!0:M!==null&&typeof M=="object"&&M.constructor.wordSize===b.wordSize&&Array.isArray(M.words)},b.max=function(M,N){return M.cmp(N)>0?M:N},b.min=function(M,N){return M.cmp(N)<0?M:N},b.prototype._init=function(M,N,P){if(typeof M=="number")return this._initNumber(M,N,P);if(typeof M=="object")return this._initArray(M,N,P);N==="hex"&&(N=16),y(N===(N|0)&&N>=2&&N<=36),M=M.toString().replace(/\s+/g,"");var O=0;M[0]==="-"&&(O++,this.negative=1),O<M.length&&(N===16?this._parseHex(M,O,P):(this._parseBase(M,N,O),P==="le"&&this._initArray(this.toArray(),N,P)))},b.prototype._initNumber=function(M,N,P){M<0&&(this.negative=1,M=-M),M<67108864?(this.words=[M&67108863],this.length=1):M<4503599627370496?(this.words=[M&67108863,M/67108864&67108863],this.length=2):(y(M<9007199254740992),this.words=[M&67108863,M/67108864&67108863,1],this.length=3),P==="le"&&this._initArray(this.toArray(),N,P)},b.prototype._initArray=function(M,N,P){if(y(typeof M.length=="number"),M.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(M.length/3),this.words=new Array(this.length);for(var O=0;O<this.length;O++)this.words[O]=0;var k,q,F=0;if(P==="be")for(O=M.length-1,k=0;O>=0;O-=3)q=M[O]|M[O-1]<<8|M[O-2]<<16,this.words[k]|=q<<F&67108863,this.words[k+1]=q>>>26-F&67108863,F+=24,F>=26&&(F-=26,k++);else if(P==="le")for(O=0,k=0;O<M.length;O+=3)q=M[O]|M[O+1]<<8|M[O+2]<<16,this.words[k]|=q<<F&67108863,this.words[k+1]=q>>>26-F&67108863,F+=24,F>=26&&(F-=26,k++);return this.strip()};function E(j,M){var N=j.charCodeAt(M);return N>=65&&N<=70?N-55:N>=97&&N<=102?N-87:N-48&15}function _(j,M,N){var P=E(j,N);return N-1>=M&&(P|=E(j,N-1)<<4),P}b.prototype._parseHex=function(M,N,P){this.length=Math.ceil((M.length-N)/6),this.words=new Array(this.length);for(var O=0;O<this.length;O++)this.words[O]=0;var k=0,q=0,F;if(P==="be")for(O=M.length-1;O>=N;O-=2)F=_(M,N,O)<<k,this.words[q]|=F&67108863,k>=18?(k-=18,q+=1,this.words[q]|=F>>>26):k+=8;else{var H=M.length-N;for(O=H%2===0?N+1:N;O<M.length;O+=2)F=_(M,N,O)<<k,this.words[q]|=F&67108863,k>=18?(k-=18,q+=1,this.words[q]|=F>>>26):k+=8}this.strip()};function S(j,M,N,P){for(var O=0,k=Math.min(j.length,N),q=M;q<k;q++){var F=j.charCodeAt(q)-48;O*=P,F>=49?O+=F-49+10:F>=17?O+=F-17+10:O+=F}return O}b.prototype._parseBase=function(M,N,P){this.words=[0],this.length=1;for(var O=0,k=1;k<=67108863;k*=N)O++;O--,k=k/N|0;for(var q=M.length-P,F=q%O,H=Math.min(q,q-F)+P,D=0,G=P;G<H;G+=O)D=S(M,G,G+O,N),this.imuln(k),this.words[0]+D<67108864?this.words[0]+=D:this._iaddn(D);if(F!==0){var W=1;for(D=S(M,G,M.length,N),G=0;G<F;G++)W*=N;this.imuln(W),this.words[0]+D<67108864?this.words[0]+=D:this._iaddn(D)}this.strip()},b.prototype.copy=function(M){M.words=new Array(this.length);for(var N=0;N<this.length;N++)M.words[N]=this.words[N];M.length=this.length,M.negative=this.negative,M.red=this.red},b.prototype.clone=function(){var M=new b(null);return this.copy(M),M},b.prototype._expand=function(M){for(;this.length<M;)this.words[this.length++]=0;return this},b.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},b.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},b.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var A=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],R=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],x=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];b.prototype.toString=function(M,N){M=M||10,N=N|0||1;var P;if(M===16||M==="hex"){P="";for(var O=0,k=0,q=0;q<this.length;q++){var F=this.words[q],H=((F<<O|k)&16777215).toString(16);k=F>>>24-O&16777215,O+=2,O>=26&&(O-=26,q--),k!==0||q!==this.length-1?P=A[6-H.length]+H+P:P=H+P}for(k!==0&&(P=k.toString(16)+P);P.length%N!==0;)P="0"+P;return this.negative!==0&&(P="-"+P),P}if(M===(M|0)&&M>=2&&M<=36){var D=R[M],G=x[M];P="";var W=this.clone();for(W.negative=0;!W.isZero();){var K=W.modn(G).toString(M);W=W.idivn(G),W.isZero()?P=K+P:P=A[D-K.length]+K+P}for(this.isZero()&&(P="0"+P);P.length%N!==0;)P="0"+P;return this.negative!==0&&(P="-"+P),P}y(!1,"Base should be between 2 and 36")},b.prototype.toNumber=function(){var M=this.words[0];return this.length===2?M+=this.words[1]*67108864:this.length===3&&this.words[2]===1?M+=4503599627370496+this.words[1]*67108864:this.length>2&&y(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-M:M},b.prototype.toJSON=function(){return this.toString(16)},b.prototype.toBuffer=function(M,N){return y(typeof w<"u"),this.toArrayLike(w,M,N)},b.prototype.toArray=function(M,N){return this.toArrayLike(Array,M,N)},b.prototype.toArrayLike=function(M,N,P){var O=this.byteLength(),k=P||Math.max(1,O);y(O<=k,"byte array longer than desired length"),y(k>0,"Requested array length <= 0"),this.strip();var q=N==="le",F=new M(k),H,D,G=this.clone();if(q){for(D=0;!G.isZero();D++)H=G.andln(255),G.iushrn(8),F[D]=H;for(;D<k;D++)F[D]=0}else{for(D=0;D<k-O;D++)F[D]=0;for(D=0;!G.isZero();D++)H=G.andln(255),G.iushrn(8),F[k-D-1]=H}return F},Math.clz32?b.prototype._countBits=function(M){return 32-Math.clz32(M)}:b.prototype._countBits=function(M){var N=M,P=0;return N>=4096&&(P+=13,N>>>=13),N>=64&&(P+=7,N>>>=7),N>=8&&(P+=4,N>>>=4),N>=2&&(P+=2,N>>>=2),P+N},b.prototype._zeroBits=function(M){if(M===0)return 26;var N=M,P=0;return(N&8191)===0&&(P+=13,N>>>=13),(N&127)===0&&(P+=7,N>>>=7),(N&15)===0&&(P+=4,N>>>=4),(N&3)===0&&(P+=2,N>>>=2),(N&1)===0&&P++,P},b.prototype.bitLength=function(){var M=this.words[this.length-1],N=this._countBits(M);return(this.length-1)*26+N};function T(j){for(var M=new Array(j.bitLength()),N=0;N<M.length;N++){var P=N/26|0,O=N%26;M[N]=(j.words[P]&1<<O)>>>O}return M}b.prototype.zeroBits=function(){if(this.isZero())return 0;for(var M=0,N=0;N<this.length;N++){var P=this._zeroBits(this.words[N]);if(M+=P,P!==26)break}return M},b.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},b.prototype.toTwos=function(M){return this.negative!==0?this.abs().inotn(M).iaddn(1):this.clone()},b.prototype.fromTwos=function(M){return this.testn(M-1)?this.notn(M).iaddn(1).ineg():this.clone()},b.prototype.isNeg=function(){return this.negative!==0},b.prototype.neg=function(){return this.clone().ineg()},b.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},b.prototype.iuor=function(M){for(;this.length<M.length;)this.words[this.length++]=0;for(var N=0;N<M.length;N++)this.words[N]=this.words[N]|M.words[N];return this.strip()},b.prototype.ior=function(M){return y((this.negative|M.negative)===0),this.iuor(M)},b.prototype.or=function(M){return this.length>M.length?this.clone().ior(M):M.clone().ior(this)},b.prototype.uor=function(M){return this.length>M.length?this.clone().iuor(M):M.clone().iuor(this)},b.prototype.iuand=function(M){var N;this.length>M.length?N=M:N=this;for(var P=0;P<N.length;P++)this.words[P]=this.words[P]&M.words[P];return this.length=N.length,this.strip()},b.prototype.iand=function(M){return y((this.negative|M.negative)===0),this.iuand(M)},b.prototype.and=function(M){return this.length>M.length?this.clone().iand(M):M.clone().iand(this)},b.prototype.uand=function(M){return this.length>M.length?this.clone().iuand(M):M.clone().iuand(this)},b.prototype.iuxor=function(M){var N,P;this.length>M.length?(N=this,P=M):(N=M,P=this);for(var O=0;O<P.length;O++)this.words[O]=N.words[O]^P.words[O];if(this!==N)for(;O<N.length;O++)this.words[O]=N.words[O];return this.length=N.length,this.strip()},b.prototype.ixor=function(M){return y((this.negative|M.negative)===0),this.iuxor(M)},b.prototype.xor=function(M){return this.length>M.length?this.clone().ixor(M):M.clone().ixor(this)},b.prototype.uxor=function(M){return this.length>M.length?this.clone().iuxor(M):M.clone().iuxor(this)},b.prototype.inotn=function(M){y(typeof M=="number"&&M>=0);var N=Math.ceil(M/26)|0,P=M%26;this._expand(N),P>0&&N--;for(var O=0;O<N;O++)this.words[O]=~this.words[O]&67108863;return P>0&&(this.words[O]=~this.words[O]&67108863>>26-P),this.strip()},b.prototype.notn=function(M){return this.clone().inotn(M)},b.prototype.setn=function(M,N){y(typeof M=="number"&&M>=0);var P=M/26|0,O=M%26;return this._expand(P+1),N?this.words[P]=this.words[P]|1<<O:this.words[P]=this.words[P]&~(1<<O),this.strip()},b.prototype.iadd=function(M){var N;if(this.negative!==0&&M.negative===0)return this.negative=0,N=this.isub(M),this.negative^=1,this._normSign();if(this.negative===0&&M.negative!==0)return M.negative=0,N=this.isub(M),M.negative=1,N._normSign();var P,O;this.length>M.length?(P=this,O=M):(P=M,O=this);for(var k=0,q=0;q<O.length;q++)N=(P.words[q]|0)+(O.words[q]|0)+k,this.words[q]=N&67108863,k=N>>>26;for(;k!==0&&q<P.length;q++)N=(P.words[q]|0)+k,this.words[q]=N&67108863,k=N>>>26;if(this.length=P.length,k!==0)this.words[this.length]=k,this.length++;else if(P!==this)for(;q<P.length;q++)this.words[q]=P.words[q];return this},b.prototype.add=function(M){var N;return M.negative!==0&&this.negative===0?(M.negative=0,N=this.sub(M),M.negative^=1,N):M.negative===0&&this.negative!==0?(this.negative=0,N=M.sub(this),this.negative=1,N):this.length>M.length?this.clone().iadd(M):M.clone().iadd(this)},b.prototype.isub=function(M){if(M.negative!==0){M.negative=0;var N=this.iadd(M);return M.negative=1,N._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(M),this.negative=1,this._normSign();var P=this.cmp(M);if(P===0)return this.negative=0,this.length=1,this.words[0]=0,this;var O,k;P>0?(O=this,k=M):(O=M,k=this);for(var q=0,F=0;F<k.length;F++)N=(O.words[F]|0)-(k.words[F]|0)+q,q=N>>26,this.words[F]=N&67108863;for(;q!==0&&F<O.length;F++)N=(O.words[F]|0)+q,q=N>>26,this.words[F]=N&67108863;if(q===0&&F<O.length&&O!==this)for(;F<O.length;F++)this.words[F]=O.words[F];return this.length=Math.max(this.length,F),O!==this&&(this.negative=1),this.strip()},b.prototype.sub=function(M){return this.clone().isub(M)};function C(j,M,N){N.negative=M.negative^j.negative;var P=j.length+M.length|0;N.length=P,P=P-1|0;var O=j.words[0]|0,k=M.words[0]|0,q=O*k,F=q&67108863,H=q/67108864|0;N.words[0]=F;for(var D=1;D<P;D++){for(var G=H>>>26,W=H&67108863,K=Math.min(D,M.length-1),Z=Math.max(0,D-j.length+1);Z<=K;Z++){var ae=D-Z|0;O=j.words[ae]|0,k=M.words[Z]|0,q=O*k+W,G+=q/67108864|0,W=q&67108863}N.words[D]=W|0,H=G|0}return H!==0?N.words[D]=H|0:N.length--,N.strip()}var I=function(M,N,P){var O=M.words,k=N.words,q=P.words,F=0,H,D,G,W=O[0]|0,K=W&8191,Z=W>>>13,ae=O[1]|0,le=ae&8191,te=ae>>>13,ce=O[2]|0,ge=ce&8191,Ee=ce>>>13,pe=O[3]|0,de=pe&8191,me=pe>>>13,_e=O[4]|0,Ae=_e&8191,Pe=_e>>>13,Me=O[5]|0,Ne=Me&8191,we=Me>>>13,Le=O[6]|0,Oe=Le&8191,Ce=Le>>>13,We=O[7]|0,ze=We&8191,Xe=We>>>13,it=O[8]|0,Je=it&8191,bt=it>>>13,Et=O[9]|0,lt=Et&8191,wt=Et>>>13,qt=k[0]|0,pt=qt&8191,Tt=qt>>>13,Pt=k[1]|0,gt=Pt&8191,kt=Pt>>>13,Mt=k[2]|0,ft=Mt&8191,Ut=Mt>>>13,Dt=k[3]|0,dt=Dt&8191,Ot=Dt>>>13,It=k[4]|0,rt=It&8191,_t=It>>>13,Se=k[5]|0,se=Se&8191,ee=Se>>>13,oe=k[6]|0,be=oe&8191,xe=oe>>>13,ie=k[7]|0,fe=ie&8191,ye=ie>>>13,Q=k[8]|0,ve=Q&8191,Te=Q>>>13,Ie=k[9]|0,$e=Ie&8191,De=Ie>>>13;P.negative=M.negative^N.negative,P.length=19,H=Math.imul(K,pt),D=Math.imul(K,Tt),D=D+Math.imul(Z,pt)|0,G=Math.imul(Z,Tt);var Ve=(F+H|0)+((D&8191)<<13)|0;F=(G+(D>>>13)|0)+(Ve>>>26)|0,Ve&=67108863,H=Math.imul(le,pt),D=Math.imul(le,Tt),D=D+Math.imul(te,pt)|0,G=Math.imul(te,Tt),H=H+Math.imul(K,gt)|0,D=D+Math.imul(K,kt)|0,D=D+Math.imul(Z,gt)|0,G=G+Math.imul(Z,kt)|0;var Ke=(F+H|0)+((D&8191)<<13)|0;F=(G+(D>>>13)|0)+(Ke>>>26)|0,Ke&=67108863,H=Math.imul(ge,pt),D=Math.imul(ge,Tt),D=D+Math.imul(Ee,pt)|0,G=Math.imul(Ee,Tt),H=H+Math.imul(le,gt)|0,D=D+Math.imul(le,kt)|0,D=D+Math.imul(te,gt)|0,G=G+Math.imul(te,kt)|0,H=H+Math.imul(K,ft)|0,D=D+Math.imul(K,Ut)|0,D=D+Math.imul(Z,ft)|0,G=G+Math.imul(Z,Ut)|0;var vt=(F+H|0)+((D&8191)<<13)|0;F=(G+(D>>>13)|0)+(vt>>>26)|0,vt&=67108863,H=Math.imul(de,pt),D=Math.imul(de,Tt),D=D+Math.imul(me,pt)|0,G=Math.imul(me,Tt),H=H+Math.imul(ge,gt)|0,D=D+Math.imul(ge,kt)|0,D=D+Math.imul(Ee,gt)|0,G=G+Math.imul(Ee,kt)|0,H=H+Math.imul(le,ft)|0,D=D+Math.imul(le,Ut)|0,D=D+Math.imul(te,ft)|0,G=G+Math.imul(te,Ut)|0,H=H+Math.imul(K,dt)|0,D=D+Math.imul(K,Ot)|0,D=D+Math.imul(Z,dt)|0,G=G+Math.imul(Z,Ot)|0;var Ge=(F+H|0)+((D&8191)<<13)|0;F=(G+(D>>>13)|0)+(Ge>>>26)|0,Ge&=67108863,H=Math.imul(Ae,pt),D=Math.imul(Ae,Tt),D=D+Math.imul(Pe,pt)|0,G=Math.imul(Pe,Tt),H=H+Math.imul(de,gt)|0,D=D+Math.imul(de,kt)|0,D=D+Math.imul(me,gt)|0,G=G+Math.imul(me,kt)|0,H=H+Math.imul(ge,ft)|0,D=D+Math.imul(ge,Ut)|0,D=D+Math.imul(Ee,ft)|0,G=G+Math.imul(Ee,Ut)|0,H=H+Math.imul(le,dt)|0,D=D+Math.imul(le,Ot)|0,D=D+Math.imul(te,dt)|0,G=G+Math.imul(te,Ot)|0,H=H+Math.imul(K,rt)|0,D=D+Math.imul(K,_t)|0,D=D+Math.imul(Z,rt)|0,G=G+Math.imul(Z,_t)|0;var nt=(F+H|0)+((D&8191)<<13)|0;F=(G+(D>>>13)|0)+(nt>>>26)|0,nt&=67108863,H=Math.imul(Ne,pt),D=Math.imul(Ne,Tt),D=D+Math.imul(we,pt)|0,G=Math.imul(we,Tt),H=H+Math.imul(Ae,gt)|0,D=D+Math.imul(Ae,kt)|0,D=D+Math.imul(Pe,gt)|0,G=G+Math.imul(Pe,kt)|0,H=H+Math.imul(de,ft)|0,D=D+Math.imul(de,Ut)|0,D=D+Math.imul(me,ft)|0,G=G+Math.imul(me,Ut)|0,H=H+Math.imul(ge,dt)|0,D=D+Math.imul(ge,Ot)|0,D=D+Math.imul(Ee,dt)|0,G=G+Math.imul(Ee,Ot)|0,H=H+Math.imul(le,rt)|0,D=D+Math.imul(le,_t)|0,D=D+Math.imul(te,rt)|0,G=G+Math.imul(te,_t)|0,H=H+Math.imul(K,se)|0,D=D+Math.imul(K,ee)|0,D=D+Math.imul(Z,se)|0,G=G+Math.imul(Z,ee)|0;var st=(F+H|0)+((D&8191)<<13)|0;F=(G+(D>>>13)|0)+(st>>>26)|0,st&=67108863,H=Math.imul(Oe,pt),D=Math.imul(Oe,Tt),D=D+Math.imul(Ce,pt)|0,G=Math.imul(Ce,Tt),H=H+Math.imul(Ne,gt)|0,D=D+Math.imul(Ne,kt)|0,D=D+Math.imul(we,gt)|0,G=G+Math.imul(we,kt)|0,H=H+Math.imul(Ae,ft)|0,D=D+Math.imul(Ae,Ut)|0,D=D+Math.imul(Pe,ft)|0,G=G+Math.imul(Pe,Ut)|0,H=H+Math.imul(de,dt)|0,D=D+Math.imul(de,Ot)|0,D=D+Math.imul(me,dt)|0,G=G+Math.imul(me,Ot)|0,H=H+Math.imul(ge,rt)|0,D=D+Math.imul(ge,_t)|0,D=D+Math.imul(Ee,rt)|0,G=G+Math.imul(Ee,_t)|0,H=H+Math.imul(le,se)|0,D=D+Math.imul(le,ee)|0,D=D+Math.imul(te,se)|0,G=G+Math.imul(te,ee)|0,H=H+Math.imul(K,be)|0,D=D+Math.imul(K,xe)|0,D=D+Math.imul(Z,be)|0,G=G+Math.imul(Z,xe)|0;var mt=(F+H|0)+((D&8191)<<13)|0;F=(G+(D>>>13)|0)+(mt>>>26)|0,mt&=67108863,H=Math.imul(ze,pt),D=Math.imul(ze,Tt),D=D+Math.imul(Xe,pt)|0,G=Math.imul(Xe,Tt),H=H+Math.imul(Oe,gt)|0,D=D+Math.imul(Oe,kt)|0,D=D+Math.imul(Ce,gt)|0,G=G+Math.imul(Ce,kt)|0,H=H+Math.imul(Ne,ft)|0,D=D+Math.imul(Ne,Ut)|0,D=D+Math.imul(we,ft)|0,G=G+Math.imul(we,Ut)|0,H=H+Math.imul(Ae,dt)|0,D=D+Math.imul(Ae,Ot)|0,D=D+Math.imul(Pe,dt)|0,G=G+Math.imul(Pe,Ot)|0,H=H+Math.imul(de,rt)|0,D=D+Math.imul(de,_t)|0,D=D+Math.imul(me,rt)|0,G=G+Math.imul(me,_t)|0,H=H+Math.imul(ge,se)|0,D=D+Math.imul(ge,ee)|0,D=D+Math.imul(Ee,se)|0,G=G+Math.imul(Ee,ee)|0,H=H+Math.imul(le,be)|0,D=D+Math.imul(le,xe)|0,D=D+Math.imul(te,be)|0,G=G+Math.imul(te,xe)|0,H=H+Math.imul(K,fe)|0,D=D+Math.imul(K,ye)|0,D=D+Math.imul(Z,fe)|0,G=G+Math.imul(Z,ye)|0;var yt=(F+H|0)+((D&8191)<<13)|0;F=(G+(D>>>13)|0)+(yt>>>26)|0,yt&=67108863,H=Math.imul(Je,pt),D=Math.imul(Je,Tt),D=D+Math.imul(bt,pt)|0,G=Math.imul(bt,Tt),H=H+Math.imul(ze,gt)|0,D=D+Math.imul(ze,kt)|0,D=D+Math.imul(Xe,gt)|0,G=G+Math.imul(Xe,kt)|0,H=H+Math.imul(Oe,ft)|0,D=D+Math.imul(Oe,Ut)|0,D=D+Math.imul(Ce,ft)|0,G=G+Math.imul(Ce,Ut)|0,H=H+Math.imul(Ne,dt)|0,D=D+Math.imul(Ne,Ot)|0,D=D+Math.imul(we,dt)|0,G=G+Math.imul(we,Ot)|0,H=H+Math.imul(Ae,rt)|0,D=D+Math.imul(Ae,_t)|0,D=D+Math.imul(Pe,rt)|0,G=G+Math.imul(Pe,_t)|0,H=H+Math.imul(de,se)|0,D=D+Math.imul(de,ee)|0,D=D+Math.imul(me,se)|0,G=G+Math.imul(me,ee)|0,H=H+Math.imul(ge,be)|0,D=D+Math.imul(ge,xe)|0,D=D+Math.imul(Ee,be)|0,G=G+Math.imul(Ee,xe)|0,H=H+Math.imul(le,fe)|0,D=D+Math.imul(le,ye)|0,D=D+Math.imul(te,fe)|0,G=G+Math.imul(te,ye)|0,H=H+Math.imul(K,ve)|0,D=D+Math.imul(K,Te)|0,D=D+Math.imul(Z,ve)|0,G=G+Math.imul(Z,Te)|0;var ot=(F+H|0)+((D&8191)<<13)|0;F=(G+(D>>>13)|0)+(ot>>>26)|0,ot&=67108863,H=Math.imul(lt,pt),D=Math.imul(lt,Tt),D=D+Math.imul(wt,pt)|0,G=Math.imul(wt,Tt),H=H+Math.imul(Je,gt)|0,D=D+Math.imul(Je,kt)|0,D=D+Math.imul(bt,gt)|0,G=G+Math.imul(bt,kt)|0,H=H+Math.imul(ze,ft)|0,D=D+Math.imul(ze,Ut)|0,D=D+Math.imul(Xe,ft)|0,G=G+Math.imul(Xe,Ut)|0,H=H+Math.imul(Oe,dt)|0,D=D+Math.imul(Oe,Ot)|0,D=D+Math.imul(Ce,dt)|0,G=G+Math.imul(Ce,Ot)|0,H=H+Math.imul(Ne,rt)|0,D=D+Math.imul(Ne,_t)|0,D=D+Math.imul(we,rt)|0,G=G+Math.imul(we,_t)|0,H=H+Math.imul(Ae,se)|0,D=D+Math.imul(Ae,ee)|0,D=D+Math.imul(Pe,se)|0,G=G+Math.imul(Pe,ee)|0,H=H+Math.imul(de,be)|0,D=D+Math.imul(de,xe)|0,D=D+Math.imul(me,be)|0,G=G+Math.imul(me,xe)|0,H=H+Math.imul(ge,fe)|0,D=D+Math.imul(ge,ye)|0,D=D+Math.imul(Ee,fe)|0,G=G+Math.imul(Ee,ye)|0,H=H+Math.imul(le,ve)|0,D=D+Math.imul(le,Te)|0,D=D+Math.imul(te,ve)|0,G=G+Math.imul(te,Te)|0,H=H+Math.imul(K,$e)|0,D=D+Math.imul(K,De)|0,D=D+Math.imul(Z,$e)|0,G=G+Math.imul(Z,De)|0;var ct=(F+H|0)+((D&8191)<<13)|0;F=(G+(D>>>13)|0)+(ct>>>26)|0,ct&=67108863,H=Math.imul(lt,gt),D=Math.imul(lt,kt),D=D+Math.imul(wt,gt)|0,G=Math.imul(wt,kt),H=H+Math.imul(Je,ft)|0,D=D+Math.imul(Je,Ut)|0,D=D+Math.imul(bt,ft)|0,G=G+Math.imul(bt,Ut)|0,H=H+Math.imul(ze,dt)|0,D=D+Math.imul(ze,Ot)|0,D=D+Math.imul(Xe,dt)|0,G=G+Math.imul(Xe,Ot)|0,H=H+Math.imul(Oe,rt)|0,D=D+Math.imul(Oe,_t)|0,D=D+Math.imul(Ce,rt)|0,G=G+Math.imul(Ce,_t)|0,H=H+Math.imul(Ne,se)|0,D=D+Math.imul(Ne,ee)|0,D=D+Math.imul(we,se)|0,G=G+Math.imul(we,ee)|0,H=H+Math.imul(Ae,be)|0,D=D+Math.imul(Ae,xe)|0,D=D+Math.imul(Pe,be)|0,G=G+Math.imul(Pe,xe)|0,H=H+Math.imul(de,fe)|0,D=D+Math.imul(de,ye)|0,D=D+Math.imul(me,fe)|0,G=G+Math.imul(me,ye)|0,H=H+Math.imul(ge,ve)|0,D=D+Math.imul(ge,Te)|0,D=D+Math.imul(Ee,ve)|0,G=G+Math.imul(Ee,Te)|0,H=H+Math.imul(le,$e)|0,D=D+Math.imul(le,De)|0,D=D+Math.imul(te,$e)|0,G=G+Math.imul(te,De)|0;var at=(F+H|0)+((D&8191)<<13)|0;F=(G+(D>>>13)|0)+(at>>>26)|0,at&=67108863,H=Math.imul(lt,ft),D=Math.imul(lt,Ut),D=D+Math.imul(wt,ft)|0,G=Math.imul(wt,Ut),H=H+Math.imul(Je,dt)|0,D=D+Math.imul(Je,Ot)|0,D=D+Math.imul(bt,dt)|0,G=G+Math.imul(bt,Ot)|0,H=H+Math.imul(ze,rt)|0,D=D+Math.imul(ze,_t)|0,D=D+Math.imul(Xe,rt)|0,G=G+Math.imul(Xe,_t)|0,H=H+Math.imul(Oe,se)|0,D=D+Math.imul(Oe,ee)|0,D=D+Math.imul(Ce,se)|0,G=G+Math.imul(Ce,ee)|0,H=H+Math.imul(Ne,be)|0,D=D+Math.imul(Ne,xe)|0,D=D+Math.imul(we,be)|0,G=G+Math.imul(we,xe)|0,H=H+Math.imul(Ae,fe)|0,D=D+Math.imul(Ae,ye)|0,D=D+Math.imul(Pe,fe)|0,G=G+Math.imul(Pe,ye)|0,H=H+Math.imul(de,ve)|0,D=D+Math.imul(de,Te)|0,D=D+Math.imul(me,ve)|0,G=G+Math.imul(me,Te)|0,H=H+Math.imul(ge,$e)|0,D=D+Math.imul(ge,De)|0,D=D+Math.imul(Ee,$e)|0,G=G+Math.imul(Ee,De)|0;var Ze=(F+H|0)+((D&8191)<<13)|0;F=(G+(D>>>13)|0)+(Ze>>>26)|0,Ze&=67108863,H=Math.imul(lt,dt),D=Math.imul(lt,Ot),D=D+Math.imul(wt,dt)|0,G=Math.imul(wt,Ot),H=H+Math.imul(Je,rt)|0,D=D+Math.imul(Je,_t)|0,D=D+Math.imul(bt,rt)|0,G=G+Math.imul(bt,_t)|0,H=H+Math.imul(ze,se)|0,D=D+Math.imul(ze,ee)|0,D=D+Math.imul(Xe,se)|0,G=G+Math.imul(Xe,ee)|0,H=H+Math.imul(Oe,be)|0,D=D+Math.imul(Oe,xe)|0,D=D+Math.imul(Ce,be)|0,G=G+Math.imul(Ce,xe)|0,H=H+Math.imul(Ne,fe)|0,D=D+Math.imul(Ne,ye)|0,D=D+Math.imul(we,fe)|0,G=G+Math.imul(we,ye)|0,H=H+Math.imul(Ae,ve)|0,D=D+Math.imul(Ae,Te)|0,D=D+Math.imul(Pe,ve)|0,G=G+Math.imul(Pe,Te)|0,H=H+Math.imul(de,$e)|0,D=D+Math.imul(de,De)|0,D=D+Math.imul(me,$e)|0,G=G+Math.imul(me,De)|0;var tt=(F+H|0)+((D&8191)<<13)|0;F=(G+(D>>>13)|0)+(tt>>>26)|0,tt&=67108863,H=Math.imul(lt,rt),D=Math.imul(lt,_t),D=D+Math.imul(wt,rt)|0,G=Math.imul(wt,_t),H=H+Math.imul(Je,se)|0,D=D+Math.imul(Je,ee)|0,D=D+Math.imul(bt,se)|0,G=G+Math.imul(bt,ee)|0,H=H+Math.imul(ze,be)|0,D=D+Math.imul(ze,xe)|0,D=D+Math.imul(Xe,be)|0,G=G+Math.imul(Xe,xe)|0,H=H+Math.imul(Oe,fe)|0,D=D+Math.imul(Oe,ye)|0,D=D+Math.imul(Ce,fe)|0,G=G+Math.imul(Ce,ye)|0,H=H+Math.imul(Ne,ve)|0,D=D+Math.imul(Ne,Te)|0,D=D+Math.imul(we,ve)|0,G=G+Math.imul(we,Te)|0,H=H+Math.imul(Ae,$e)|0,D=D+Math.imul(Ae,De)|0,D=D+Math.imul(Pe,$e)|0,G=G+Math.imul(Pe,De)|0;var Ye=(F+H|0)+((D&8191)<<13)|0;F=(G+(D>>>13)|0)+(Ye>>>26)|0,Ye&=67108863,H=Math.imul(lt,se),D=Math.imul(lt,ee),D=D+Math.imul(wt,se)|0,G=Math.imul(wt,ee),H=H+Math.imul(Je,be)|0,D=D+Math.imul(Je,xe)|0,D=D+Math.imul(bt,be)|0,G=G+Math.imul(bt,xe)|0,H=H+Math.imul(ze,fe)|0,D=D+Math.imul(ze,ye)|0,D=D+Math.imul(Xe,fe)|0,G=G+Math.imul(Xe,ye)|0,H=H+Math.imul(Oe,ve)|0,D=D+Math.imul(Oe,Te)|0,D=D+Math.imul(Ce,ve)|0,G=G+Math.imul(Ce,Te)|0,H=H+Math.imul(Ne,$e)|0,D=D+Math.imul(Ne,De)|0,D=D+Math.imul(we,$e)|0,G=G+Math.imul(we,De)|0;var Qe=(F+H|0)+((D&8191)<<13)|0;F=(G+(D>>>13)|0)+(Qe>>>26)|0,Qe&=67108863,H=Math.imul(lt,be),D=Math.imul(lt,xe),D=D+Math.imul(wt,be)|0,G=Math.imul(wt,xe),H=H+Math.imul(Je,fe)|0,D=D+Math.imul(Je,ye)|0,D=D+Math.imul(bt,fe)|0,G=G+Math.imul(bt,ye)|0,H=H+Math.imul(ze,ve)|0,D=D+Math.imul(ze,Te)|0,D=D+Math.imul(Xe,ve)|0,G=G+Math.imul(Xe,Te)|0,H=H+Math.imul(Oe,$e)|0,D=D+Math.imul(Oe,De)|0,D=D+Math.imul(Ce,$e)|0,G=G+Math.imul(Ce,De)|0;var et=(F+H|0)+((D&8191)<<13)|0;F=(G+(D>>>13)|0)+(et>>>26)|0,et&=67108863,H=Math.imul(lt,fe),D=Math.imul(lt,ye),D=D+Math.imul(wt,fe)|0,G=Math.imul(wt,ye),H=H+Math.imul(Je,ve)|0,D=D+Math.imul(Je,Te)|0,D=D+Math.imul(bt,ve)|0,G=G+Math.imul(bt,Te)|0,H=H+Math.imul(ze,$e)|0,D=D+Math.imul(ze,De)|0,D=D+Math.imul(Xe,$e)|0,G=G+Math.imul(Xe,De)|0;var je=(F+H|0)+((D&8191)<<13)|0;F=(G+(D>>>13)|0)+(je>>>26)|0,je&=67108863,H=Math.imul(lt,ve),D=Math.imul(lt,Te),D=D+Math.imul(wt,ve)|0,G=Math.imul(wt,Te),H=H+Math.imul(Je,$e)|0,D=D+Math.imul(Je,De)|0,D=D+Math.imul(bt,$e)|0,G=G+Math.imul(bt,De)|0;var Be=(F+H|0)+((D&8191)<<13)|0;F=(G+(D>>>13)|0)+(Be>>>26)|0,Be&=67108863,H=Math.imul(lt,$e),D=Math.imul(lt,De),D=D+Math.imul(wt,$e)|0,G=Math.imul(wt,De);var ke=(F+H|0)+((D&8191)<<13)|0;return F=(G+(D>>>13)|0)+(ke>>>26)|0,ke&=67108863,q[0]=Ve,q[1]=Ke,q[2]=vt,q[3]=Ge,q[4]=nt,q[5]=st,q[6]=mt,q[7]=yt,q[8]=ot,q[9]=ct,q[10]=at,q[11]=Ze,q[12]=tt,q[13]=Ye,q[14]=Qe,q[15]=et,q[16]=je,q[17]=Be,q[18]=ke,F!==0&&(q[19]=F,P.length++),P};Math.imul||(I=C);function L(j,M,N){N.negative=M.negative^j.negative,N.length=j.length+M.length;for(var P=0,O=0,k=0;k<N.length-1;k++){var q=O;O=0;for(var F=P&67108863,H=Math.min(k,M.length-1),D=Math.max(0,k-j.length+1);D<=H;D++){var G=k-D,W=j.words[G]|0,K=M.words[D]|0,Z=W*K,ae=Z&67108863;q=q+(Z/67108864|0)|0,ae=ae+F|0,F=ae&67108863,q=q+(ae>>>26)|0,O+=q>>>26,q&=67108863}N.words[k]=F,P=q,q=O}return P!==0?N.words[k]=P:N.length--,N.strip()}function $(j,M,N){var P=new B;return P.mulp(j,M,N)}b.prototype.mulTo=function(M,N){var P,O=this.length+M.length;return this.length===10&&M.length===10?P=I(this,M,N):O<63?P=C(this,M,N):O<1024?P=L(this,M,N):P=$(this,M,N),P};function B(j,M){this.x=j,this.y=M}B.prototype.makeRBT=function(M){for(var N=new Array(M),P=b.prototype._countBits(M)-1,O=0;O<M;O++)N[O]=this.revBin(O,P,M);return N},B.prototype.revBin=function(M,N,P){if(M===0||M===P-1)return M;for(var O=0,k=0;k<N;k++)O|=(M&1)<<N-k-1,M>>=1;return O},B.prototype.permute=function(M,N,P,O,k,q){for(var F=0;F<q;F++)O[F]=N[M[F]],k[F]=P[M[F]]},B.prototype.transform=function(M,N,P,O,k,q){this.permute(q,M,N,P,O,k);for(var F=1;F<k;F<<=1)for(var H=F<<1,D=Math.cos(2*Math.PI/H),G=Math.sin(2*Math.PI/H),W=0;W<k;W+=H)for(var K=D,Z=G,ae=0;ae<F;ae++){var le=P[W+ae],te=O[W+ae],ce=P[W+ae+F],ge=O[W+ae+F],Ee=K*ce-Z*ge;ge=K*ge+Z*ce,ce=Ee,P[W+ae]=le+ce,O[W+ae]=te+ge,P[W+ae+F]=le-ce,O[W+ae+F]=te-ge,ae!==H&&(Ee=D*K-G*Z,Z=D*Z+G*K,K=Ee)}},B.prototype.guessLen13b=function(M,N){var P=Math.max(N,M)|1,O=P&1,k=0;for(P=P/2|0;P;P=P>>>1)k++;return 1<<k+1+O},B.prototype.conjugate=function(M,N,P){if(!(P<=1))for(var O=0;O<P/2;O++){var k=M[O];M[O]=M[P-O-1],M[P-O-1]=k,k=N[O],N[O]=-N[P-O-1],N[P-O-1]=-k}},B.prototype.normalize13b=function(M,N){for(var P=0,O=0;O<N/2;O++){var k=Math.round(M[2*O+1]/N)*8192+Math.round(M[2*O]/N)+P;M[O]=k&67108863,k<67108864?P=0:P=k/67108864|0}return M},B.prototype.convert13b=function(M,N,P,O){for(var k=0,q=0;q<N;q++)k=k+(M[q]|0),P[2*q]=k&8191,k=k>>>13,P[2*q+1]=k&8191,k=k>>>13;for(q=2*N;q<O;++q)P[q]=0;y(k===0),y((k&-8192)===0)},B.prototype.stub=function(M){for(var N=new Array(M),P=0;P<M;P++)N[P]=0;return N},B.prototype.mulp=function(M,N,P){var O=2*this.guessLen13b(M.length,N.length),k=this.makeRBT(O),q=this.stub(O),F=new Array(O),H=new Array(O),D=new Array(O),G=new Array(O),W=new Array(O),K=new Array(O),Z=P.words;Z.length=O,this.convert13b(M.words,M.length,F,O),this.convert13b(N.words,N.length,G,O),this.transform(F,q,H,D,O,k),this.transform(G,q,W,K,O,k);for(var ae=0;ae<O;ae++){var le=H[ae]*W[ae]-D[ae]*K[ae];D[ae]=H[ae]*K[ae]+D[ae]*W[ae],H[ae]=le}return this.conjugate(H,D,O),this.transform(H,D,Z,q,O,k),this.conjugate(Z,q,O),this.normalize13b(Z,O),P.negative=M.negative^N.negative,P.length=M.length+N.length,P.strip()},b.prototype.mul=function(M){var N=new b(null);return N.words=new Array(this.length+M.length),this.mulTo(M,N)},b.prototype.mulf=function(M){var N=new b(null);return N.words=new Array(this.length+M.length),$(this,M,N)},b.prototype.imul=function(M){return this.clone().mulTo(M,this)},b.prototype.imuln=function(M){y(typeof M=="number"),y(M<67108864);for(var N=0,P=0;P<this.length;P++){var O=(this.words[P]|0)*M,k=(O&67108863)+(N&67108863);N>>=26,N+=O/67108864|0,N+=k>>>26,this.words[P]=k&67108863}return N!==0&&(this.words[P]=N,this.length++),this.length=M===0?1:this.length,this},b.prototype.muln=function(M){return this.clone().imuln(M)},b.prototype.sqr=function(){return this.mul(this)},b.prototype.isqr=function(){return this.imul(this.clone())},b.prototype.pow=function(M){var N=T(M);if(N.length===0)return new b(1);for(var P=this,O=0;O<N.length&&N[O]===0;O++,P=P.sqr());if(++O<N.length)for(var k=P.sqr();O<N.length;O++,k=k.sqr())N[O]!==0&&(P=P.mul(k));return P},b.prototype.iushln=function(M){y(typeof M=="number"&&M>=0);var N=M%26,P=(M-N)/26,O=67108863>>>26-N<<26-N,k;if(N!==0){var q=0;for(k=0;k<this.length;k++){var F=this.words[k]&O,H=(this.words[k]|0)-F<<N;this.words[k]=H|q,q=F>>>26-N}q&&(this.words[k]=q,this.length++)}if(P!==0){for(k=this.length-1;k>=0;k--)this.words[k+P]=this.words[k];for(k=0;k<P;k++)this.words[k]=0;this.length+=P}return this.strip()},b.prototype.ishln=function(M){return y(this.negative===0),this.iushln(M)},b.prototype.iushrn=function(M,N,P){y(typeof M=="number"&&M>=0);var O;N?O=(N-N%26)/26:O=0;var k=M%26,q=Math.min((M-k)/26,this.length),F=67108863^67108863>>>k<<k,H=P;if(O-=q,O=Math.max(0,O),H){for(var D=0;D<q;D++)H.words[D]=this.words[D];H.length=q}if(q!==0)if(this.length>q)for(this.length-=q,D=0;D<this.length;D++)this.words[D]=this.words[D+q];else this.words[0]=0,this.length=1;var G=0;for(D=this.length-1;D>=0&&(G!==0||D>=O);D--){var W=this.words[D]|0;this.words[D]=G<<26-k|W>>>k,G=W&F}return H&&G!==0&&(H.words[H.length++]=G),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},b.prototype.ishrn=function(M,N,P){return y(this.negative===0),this.iushrn(M,N,P)},b.prototype.shln=function(M){return this.clone().ishln(M)},b.prototype.ushln=function(M){return this.clone().iushln(M)},b.prototype.shrn=function(M){return this.clone().ishrn(M)},b.prototype.ushrn=function(M){return this.clone().iushrn(M)},b.prototype.testn=function(M){y(typeof M=="number"&&M>=0);var N=M%26,P=(M-N)/26,O=1<<N;if(this.length<=P)return!1;var k=this.words[P];return!!(k&O)},b.prototype.imaskn=function(M){y(typeof M=="number"&&M>=0);var N=M%26,P=(M-N)/26;if(y(this.negative===0,"imaskn works only with positive numbers"),this.length<=P)return this;if(N!==0&&P++,this.length=Math.min(P,this.length),N!==0){var O=67108863^67108863>>>N<<N;this.words[this.length-1]&=O}return this.strip()},b.prototype.maskn=function(M){return this.clone().imaskn(M)},b.prototype.iaddn=function(M){return y(typeof M=="number"),y(M<67108864),M<0?this.isubn(-M):this.negative!==0?this.length===1&&(this.words[0]|0)<M?(this.words[0]=M-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(M),this.negative=1,this):this._iaddn(M)},b.prototype._iaddn=function(M){this.words[0]+=M;for(var N=0;N<this.length&&this.words[N]>=67108864;N++)this.words[N]-=67108864,N===this.length-1?this.words[N+1]=1:this.words[N+1]++;return this.length=Math.max(this.length,N+1),this},b.prototype.isubn=function(M){if(y(typeof M=="number"),y(M<67108864),M<0)return this.iaddn(-M);if(this.negative!==0)return this.negative=0,this.iaddn(M),this.negative=1,this;if(this.words[0]-=M,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var N=0;N<this.length&&this.words[N]<0;N++)this.words[N]+=67108864,this.words[N+1]-=1;return this.strip()},b.prototype.addn=function(M){return this.clone().iaddn(M)},b.prototype.subn=function(M){return this.clone().isubn(M)},b.prototype.iabs=function(){return this.negative=0,this},b.prototype.abs=function(){return this.clone().iabs()},b.prototype._ishlnsubmul=function(M,N,P){var O=M.length+P,k;this._expand(O);var q,F=0;for(k=0;k<M.length;k++){q=(this.words[k+P]|0)+F;var H=(M.words[k]|0)*N;q-=H&67108863,F=(q>>26)-(H/67108864|0),this.words[k+P]=q&67108863}for(;k<this.length-P;k++)q=(this.words[k+P]|0)+F,F=q>>26,this.words[k+P]=q&67108863;if(F===0)return this.strip();for(y(F===-1),F=0,k=0;k<this.length;k++)q=-(this.words[k]|0)+F,F=q>>26,this.words[k]=q&67108863;return this.negative=1,this.strip()},b.prototype._wordDiv=function(M,N){var P=this.length-M.length,O=this.clone(),k=M,q=k.words[k.length-1]|0,F=this._countBits(q);P=26-F,P!==0&&(k=k.ushln(P),O.iushln(P),q=k.words[k.length-1]|0);var H=O.length-k.length,D;if(N!=="mod"){D=new b(null),D.length=H+1,D.words=new Array(D.length);for(var G=0;G<D.length;G++)D.words[G]=0}var W=O.clone()._ishlnsubmul(k,1,H);W.negative===0&&(O=W,D&&(D.words[H]=1));for(var K=H-1;K>=0;K--){var Z=(O.words[k.length+K]|0)*67108864+(O.words[k.length+K-1]|0);for(Z=Math.min(Z/q|0,67108863),O._ishlnsubmul(k,Z,K);O.negative!==0;)Z--,O.negative=0,O._ishlnsubmul(k,1,K),O.isZero()||(O.negative^=1);D&&(D.words[K]=Z)}return D&&D.strip(),O.strip(),N!=="div"&&P!==0&&O.iushrn(P),{div:D||null,mod:O}},b.prototype.divmod=function(M,N,P){if(y(!M.isZero()),this.isZero())return{div:new b(0),mod:new b(0)};var O,k,q;return this.negative!==0&&M.negative===0?(q=this.neg().divmod(M,N),N!=="mod"&&(O=q.div.neg()),N!=="div"&&(k=q.mod.neg(),P&&k.negative!==0&&k.iadd(M)),{div:O,mod:k}):this.negative===0&&M.negative!==0?(q=this.divmod(M.neg(),N),N!=="mod"&&(O=q.div.neg()),{div:O,mod:q.mod}):(this.negative&M.negative)!==0?(q=this.neg().divmod(M.neg(),N),N!=="div"&&(k=q.mod.neg(),P&&k.negative!==0&&k.isub(M)),{div:q.div,mod:k}):M.length>this.length||this.cmp(M)<0?{div:new b(0),mod:this}:M.length===1?N==="div"?{div:this.divn(M.words[0]),mod:null}:N==="mod"?{div:null,mod:new b(this.modn(M.words[0]))}:{div:this.divn(M.words[0]),mod:new b(this.modn(M.words[0]))}:this._wordDiv(M,N)},b.prototype.div=function(M){return this.divmod(M,"div",!1).div},b.prototype.mod=function(M){return this.divmod(M,"mod",!1).mod},b.prototype.umod=function(M){return this.divmod(M,"mod",!0).mod},b.prototype.divRound=function(M){var N=this.divmod(M);if(N.mod.isZero())return N.div;var P=N.div.negative!==0?N.mod.isub(M):N.mod,O=M.ushrn(1),k=M.andln(1),q=P.cmp(O);return q<0||k===1&&q===0?N.div:N.div.negative!==0?N.div.isubn(1):N.div.iaddn(1)},b.prototype.modn=function(M){y(M<=67108863);for(var N=(1<<26)%M,P=0,O=this.length-1;O>=0;O--)P=(N*P+(this.words[O]|0))%M;return P},b.prototype.idivn=function(M){y(M<=67108863);for(var N=0,P=this.length-1;P>=0;P--){var O=(this.words[P]|0)+N*67108864;this.words[P]=O/M|0,N=O%M}return this.strip()},b.prototype.divn=function(M){return this.clone().idivn(M)},b.prototype.egcd=function(M){y(M.negative===0),y(!M.isZero());var N=this,P=M.clone();N.negative!==0?N=N.umod(M):N=N.clone();for(var O=new b(1),k=new b(0),q=new b(0),F=new b(1),H=0;N.isEven()&&P.isEven();)N.iushrn(1),P.iushrn(1),++H;for(var D=P.clone(),G=N.clone();!N.isZero();){for(var W=0,K=1;(N.words[0]&K)===0&&W<26;++W,K<<=1);if(W>0)for(N.iushrn(W);W-- >0;)(O.isOdd()||k.isOdd())&&(O.iadd(D),k.isub(G)),O.iushrn(1),k.iushrn(1);for(var Z=0,ae=1;(P.words[0]&ae)===0&&Z<26;++Z,ae<<=1);if(Z>0)for(P.iushrn(Z);Z-- >0;)(q.isOdd()||F.isOdd())&&(q.iadd(D),F.isub(G)),q.iushrn(1),F.iushrn(1);N.cmp(P)>=0?(N.isub(P),O.isub(q),k.isub(F)):(P.isub(N),q.isub(O),F.isub(k))}return{a:q,b:F,gcd:P.iushln(H)}},b.prototype._invmp=function(M){y(M.negative===0),y(!M.isZero());var N=this,P=M.clone();N.negative!==0?N=N.umod(M):N=N.clone();for(var O=new b(1),k=new b(0),q=P.clone();N.cmpn(1)>0&&P.cmpn(1)>0;){for(var F=0,H=1;(N.words[0]&H)===0&&F<26;++F,H<<=1);if(F>0)for(N.iushrn(F);F-- >0;)O.isOdd()&&O.iadd(q),O.iushrn(1);for(var D=0,G=1;(P.words[0]&G)===0&&D<26;++D,G<<=1);if(D>0)for(P.iushrn(D);D-- >0;)k.isOdd()&&k.iadd(q),k.iushrn(1);N.cmp(P)>=0?(N.isub(P),O.isub(k)):(P.isub(N),k.isub(O))}var W;return N.cmpn(1)===0?W=O:W=k,W.cmpn(0)<0&&W.iadd(M),W},b.prototype.gcd=function(M){if(this.isZero())return M.abs();if(M.isZero())return this.abs();var N=this.clone(),P=M.clone();N.negative=0,P.negative=0;for(var O=0;N.isEven()&&P.isEven();O++)N.iushrn(1),P.iushrn(1);do{for(;N.isEven();)N.iushrn(1);for(;P.isEven();)P.iushrn(1);var k=N.cmp(P);if(k<0){var q=N;N=P,P=q}else if(k===0||P.cmpn(1)===0)break;N.isub(P)}while(!0);return P.iushln(O)},b.prototype.invm=function(M){return this.egcd(M).a.umod(M)},b.prototype.isEven=function(){return(this.words[0]&1)===0},b.prototype.isOdd=function(){return(this.words[0]&1)===1},b.prototype.andln=function(M){return this.words[0]&M},b.prototype.bincn=function(M){y(typeof M=="number");var N=M%26,P=(M-N)/26,O=1<<N;if(this.length<=P)return this._expand(P+1),this.words[P]|=O,this;for(var k=O,q=P;k!==0&&q<this.length;q++){var F=this.words[q]|0;F+=k,k=F>>>26,F&=67108863,this.words[q]=F}return k!==0&&(this.words[q]=k,this.length++),this},b.prototype.isZero=function(){return this.length===1&&this.words[0]===0},b.prototype.cmpn=function(M){var N=M<0;if(this.negative!==0&&!N)return-1;if(this.negative===0&&N)return 1;this.strip();var P;if(this.length>1)P=1;else{N&&(M=-M),y(M<=67108863,"Number is too big");var O=this.words[0]|0;P=O===M?0:O<M?-1:1}return this.negative!==0?-P|0:P},b.prototype.cmp=function(M){if(this.negative!==0&&M.negative===0)return-1;if(this.negative===0&&M.negative!==0)return 1;var N=this.ucmp(M);return this.negative!==0?-N|0:N},b.prototype.ucmp=function(M){if(this.length>M.length)return 1;if(this.length<M.length)return-1;for(var N=0,P=this.length-1;P>=0;P--){var O=this.words[P]|0,k=M.words[P]|0;if(O!==k){O<k?N=-1:O>k&&(N=1);break}}return N},b.prototype.gtn=function(M){return this.cmpn(M)===1},b.prototype.gt=function(M){return this.cmp(M)===1},b.prototype.gten=function(M){return this.cmpn(M)>=0},b.prototype.gte=function(M){return this.cmp(M)>=0},b.prototype.ltn=function(M){return this.cmpn(M)===-1},b.prototype.lt=function(M){return this.cmp(M)===-1},b.prototype.lten=function(M){return this.cmpn(M)<=0},b.prototype.lte=function(M){return this.cmp(M)<=0},b.prototype.eqn=function(M){return this.cmpn(M)===0},b.prototype.eq=function(M){return this.cmp(M)===0},b.red=function(M){return new X(M)},b.prototype.toRed=function(M){return y(!this.red,"Already a number in reduction context"),y(this.negative===0,"red works only with positives"),M.convertTo(this)._forceRed(M)},b.prototype.fromRed=function(){return y(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},b.prototype._forceRed=function(M){return this.red=M,this},b.prototype.forceRed=function(M){return y(!this.red,"Already a number in reduction context"),this._forceRed(M)},b.prototype.redAdd=function(M){return y(this.red,"redAdd works only with red numbers"),this.red.add(this,M)},b.prototype.redIAdd=function(M){return y(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,M)},b.prototype.redSub=function(M){return y(this.red,"redSub works only with red numbers"),this.red.sub(this,M)},b.prototype.redISub=function(M){return y(this.red,"redISub works only with red numbers"),this.red.isub(this,M)},b.prototype.redShl=function(M){return y(this.red,"redShl works only with red numbers"),this.red.shl(this,M)},b.prototype.redMul=function(M){return y(this.red,"redMul works only with red numbers"),this.red._verify2(this,M),this.red.mul(this,M)},b.prototype.redIMul=function(M){return y(this.red,"redMul works only with red numbers"),this.red._verify2(this,M),this.red.imul(this,M)},b.prototype.redSqr=function(){return y(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},b.prototype.redISqr=function(){return y(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},b.prototype.redSqrt=function(){return y(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},b.prototype.redInvm=function(){return y(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},b.prototype.redNeg=function(){return y(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},b.prototype.redPow=function(M){return y(this.red&&!M.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,M)};var U={k256:null,p224:null,p192:null,p25519:null};function z(j,M){this.name=j,this.p=new b(M,16),this.n=this.p.bitLength(),this.k=new b(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}z.prototype._tmp=function(){var M=new b(null);return M.words=new Array(Math.ceil(this.n/13)),M},z.prototype.ireduce=function(M){var N=M,P;do this.split(N,this.tmp),N=this.imulK(N),N=N.iadd(this.tmp),P=N.bitLength();while(P>this.n);var O=P<this.n?-1:N.ucmp(this.p);return O===0?(N.words[0]=0,N.length=1):O>0?N.isub(this.p):N.strip!==void 0?N.strip():N._strip(),N},z.prototype.split=function(M,N){M.iushrn(this.n,0,N)},z.prototype.imulK=function(M){return M.imul(this.k)};function ne(){z.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}v(ne,z),ne.prototype.split=function(M,N){for(var P=4194303,O=Math.min(M.length,9),k=0;k<O;k++)N.words[k]=M.words[k];if(N.length=O,M.length<=9){M.words[0]=0,M.length=1;return}var q=M.words[9];for(N.words[N.length++]=q&P,k=10;k<M.length;k++){var F=M.words[k]|0;M.words[k-10]=(F&P)<<4|q>>>22,q=F}q>>>=22,M.words[k-10]=q,q===0&&M.length>10?M.length-=10:M.length-=9},ne.prototype.imulK=function(M){M.words[M.length]=0,M.words[M.length+1]=0,M.length+=2;for(var N=0,P=0;P<M.length;P++){var O=M.words[P]|0;N+=O*977,M.words[P]=N&67108863,N=O*64+(N/67108864|0)}return M.words[M.length-1]===0&&(M.length--,M.words[M.length-1]===0&&M.length--),M};function ue(){z.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}v(ue,z);function he(){z.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}v(he,z);function Y(){z.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}v(Y,z),Y.prototype.imulK=function(M){for(var N=0,P=0;P<M.length;P++){var O=(M.words[P]|0)*19+N,k=O&67108863;O>>>=26,M.words[P]=k,N=O}return N!==0&&(M.words[M.length++]=N),M},b._prime=function(M){if(U[M])return U[M];var N;if(M==="k256")N=new ne;else if(M==="p224")N=new ue;else if(M==="p192")N=new he;else if(M==="p25519")N=new Y;else throw new Error("Unknown prime "+M);return U[M]=N,N};function X(j){if(typeof j=="string"){var M=b._prime(j);this.m=M.p,this.prime=M}else y(j.gtn(1),"modulus must be greater than 1"),this.m=j,this.prime=null}X.prototype._verify1=function(M){y(M.negative===0,"red works only with positives"),y(M.red,"red works only with red numbers")},X.prototype._verify2=function(M,N){y((M.negative|N.negative)===0,"red works only with positives"),y(M.red&&M.red===N.red,"red works only with red numbers")},X.prototype.imod=function(M){return this.prime?this.prime.ireduce(M)._forceRed(this):M.umod(this.m)._forceRed(this)},X.prototype.neg=function(M){return M.isZero()?M.clone():this.m.sub(M)._forceRed(this)},X.prototype.add=function(M,N){this._verify2(M,N);var P=M.add(N);return P.cmp(this.m)>=0&&P.isub(this.m),P._forceRed(this)},X.prototype.iadd=function(M,N){this._verify2(M,N);var P=M.iadd(N);return P.cmp(this.m)>=0&&P.isub(this.m),P},X.prototype.sub=function(M,N){this._verify2(M,N);var P=M.sub(N);return P.cmpn(0)<0&&P.iadd(this.m),P._forceRed(this)},X.prototype.isub=function(M,N){this._verify2(M,N);var P=M.isub(N);return P.cmpn(0)<0&&P.iadd(this.m),P},X.prototype.shl=function(M,N){return this._verify1(M),this.imod(M.ushln(N))},X.prototype.imul=function(M,N){return this._verify2(M,N),this.imod(M.imul(N))},X.prototype.mul=function(M,N){return this._verify2(M,N),this.imod(M.mul(N))},X.prototype.isqr=function(M){return this.imul(M,M.clone())},X.prototype.sqr=function(M){return this.mul(M,M)},X.prototype.sqrt=function(M){if(M.isZero())return M.clone();var N=this.m.andln(3);if(y(N%2===1),N===3){var P=this.m.add(new b(1)).iushrn(2);return this.pow(M,P)}for(var O=this.m.subn(1),k=0;!O.isZero()&&O.andln(1)===0;)k++,O.iushrn(1);y(!O.isZero());var q=new b(1).toRed(this),F=q.redNeg(),H=this.m.subn(1).iushrn(1),D=this.m.bitLength();for(D=new b(2*D*D).toRed(this);this.pow(D,H).cmp(F)!==0;)D.redIAdd(F);for(var G=this.pow(D,O),W=this.pow(M,O.addn(1).iushrn(1)),K=this.pow(M,O),Z=k;K.cmp(q)!==0;){for(var ae=K,le=0;ae.cmp(q)!==0;le++)ae=ae.redSqr();y(le<Z);var te=this.pow(G,new b(1).iushln(Z-le-1));W=W.redMul(te),G=te.redSqr(),K=K.redMul(G),Z=le}return W},X.prototype.invm=function(M){var N=M._invmp(this.m);return N.negative!==0?(N.negative=0,this.imod(N).redNeg()):this.imod(N)},X.prototype.pow=function(M,N){if(N.isZero())return new b(1).toRed(this);if(N.cmpn(1)===0)return M.clone();var P=4,O=new Array(1<<P);O[0]=new b(1).toRed(this),O[1]=M;for(var k=2;k<O.length;k++)O[k]=this.mul(O[k-1],M);var q=O[0],F=0,H=0,D=N.bitLength()%26;for(D===0&&(D=26),k=N.length-1;k>=0;k--){for(var G=N.words[k],W=D-1;W>=0;W--){var K=G>>W&1;if(q!==O[0]&&(q=this.sqr(q)),K===0&&F===0){H=0;continue}F<<=1,F|=K,H++,!(H!==P&&(k!==0||W!==0))&&(q=this.mul(q,O[F]),H=0,F=0)}D=26}return q},X.prototype.convertTo=function(M){var N=M.umod(this.m);return N===M?N.clone():N},X.prototype.convertFrom=function(M){var N=M.clone();return N.red=null,N},b.mont=function(M){return new J(M)};function J(j){X.call(this,j),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new b(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}v(J,X),J.prototype.convertTo=function(M){return this.imod(M.ushln(this.shift))},J.prototype.convertFrom=function(M){var N=this.imod(M.mul(this.rinv));return N.red=null,N},J.prototype.imul=function(M,N){if(M.isZero()||N.isZero())return M.words[0]=0,M.length=1,M;var P=M.imul(N),O=P.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),k=P.isub(O).iushrn(this.shift),q=k;return k.cmp(this.m)>=0?q=k.isub(this.m):k.cmpn(0)<0&&(q=k.iadd(this.m)),q._forceRed(this)},J.prototype.mul=function(M,N){if(M.isZero()||N.isZero())return new b(0)._forceRed(this);var P=M.mul(N),O=P.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),k=P.isub(O).iushrn(this.shift),q=k;return k.cmp(this.m)>=0?q=k.isub(this.m):k.cmpn(0)<0&&(q=k.iadd(this.m)),q._forceRed(this)},J.prototype.invm=function(M){var N=this.imod(M._invmp(this.m).mul(this.r2));return N._forceRed(this)}})(g,bn)})(bn$1)),bn$1.exports}var utils$2={},hasRequiredUtils$3;function requireUtils$3(){return hasRequiredUtils$3||(hasRequiredUtils$3=1,(function(g){var u=g;function h(b,w){if(Array.isArray(b))return b.slice();if(!b)return[];var E=[];if(typeof b!="string"){for(var _=0;_<b.length;_++)E[_]=b[_]|0;return E}if(w==="hex"){b=b.replace(/[^a-z0-9]+/ig,""),b.length%2!==0&&(b="0"+b);for(var _=0;_<b.length;_+=2)E.push(parseInt(b[_]+b[_+1],16))}else for(var _=0;_<b.length;_++){var S=b.charCodeAt(_),A=S>>8,R=S&255;A?E.push(A,R):E.push(R)}return E}u.toArray=h;function y(b){return b.length===1?"0"+b:b}u.zero2=y;function v(b){for(var w="",E=0;E<b.length;E++)w+=y(b[E].toString(16));return w}u.toHex=v,u.encode=function(w,E){return E==="hex"?v(w):w}})(utils$2)),utils$2}var hasRequiredUtils$2;function requireUtils$2(){return hasRequiredUtils$2||(hasRequiredUtils$2=1,(function(g){var u=g,h=requireBn(),y=requireMinimalisticAssert(),v=requireUtils$3();u.assert=y,u.toArray=v.toArray,u.zero2=v.zero2,u.toHex=v.toHex,u.encode=v.encode;function b(A,R,x){var T=new Array(Math.max(A.bitLength(),x)+1),C;for(C=0;C<T.length;C+=1)T[C]=0;var I=1<<R+1,L=A.clone();for(C=0;C<T.length;C++){var $,B=L.andln(I-1);L.isOdd()?(B>(I>>1)-1?$=(I>>1)-B:$=B,L.isubn($)):$=0,T[C]=$,L.iushrn(1)}return T}u.getNAF=b;function w(A,R){var x=[[],[]];A=A.clone(),R=R.clone();for(var T=0,C=0,I;A.cmpn(-T)>0||R.cmpn(-C)>0;){var L=A.andln(3)+T&3,$=R.andln(3)+C&3;L===3&&(L=-1),$===3&&($=-1);var B;(L&1)===0?B=0:(I=A.andln(7)+T&7,(I===3||I===5)&&$===2?B=-L:B=L),x[0].push(B);var U;($&1)===0?U=0:(I=R.andln(7)+C&7,(I===3||I===5)&&L===2?U=-$:U=$),x[1].push(U),2*T===B+1&&(T=1-T),2*C===U+1&&(C=1-C),A.iushrn(1),R.iushrn(1)}return x}u.getJSF=w;function E(A,R,x){var T="_"+R;A.prototype[R]=function(){return this[T]!==void 0?this[T]:this[T]=x.call(this)}}u.cachedProperty=E;function _(A){return typeof A=="string"?u.toArray(A,"hex"):A}u.parseBytes=_;function S(A){return new h(A,"hex","le")}u.intFromLE=S})(utils$3)),utils$3}var brorand={exports:{}},cryptoBrowserify={},browser$c={exports:{}},hasRequiredBrowser$c;function requireBrowser$c(){if(hasRequiredBrowser$c)return browser$c.exports;hasRequiredBrowser$c=1;var g=65536,u=4294967295;function h(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}var y=requireSafeBuffer$1().Buffer,v=globalThis.crypto||globalThis.msCrypto;v&&v.getRandomValues?browser$c.exports=b:browser$c.exports=h;function b(w,E){if(w>u)throw new RangeError("requested too many random bytes");var _=y.allocUnsafe(w);if(w>0)if(w>g)for(var S=0;S<w;S+=g)v.getRandomValues(_.slice(S,S+g));else v.getRandomValues(_);return typeof E=="function"?process$1.nextTick(function(){E(null,_)}):_}return browser$c.exports}var events={exports:{}},hasRequiredEvents;function requireEvents(){if(hasRequiredEvents)return events.exports;hasRequiredEvents=1;var g=typeof Reflect=="object"?Reflect:null,u=g&&typeof g.apply=="function"?g.apply:function(ne,ue,he){return Function.prototype.apply.call(ne,ue,he)},h;g&&typeof g.ownKeys=="function"?h=g.ownKeys:Object.getOwnPropertySymbols?h=function(ne){return Object.getOwnPropertyNames(ne).concat(Object.getOwnPropertySymbols(ne))}:h=function(ne){return Object.getOwnPropertyNames(ne)};function y(z){console&&console.warn&&console.warn(z)}var v=Number.isNaN||function(ne){return ne!==ne};function b(){b.init.call(this)}events.exports=b,events.exports.once=$,b.EventEmitter=b,b.prototype._events=void 0,b.prototype._eventsCount=0,b.prototype._maxListeners=void 0;var w=10;function E(z){if(typeof z!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof z)}Object.defineProperty(b,"defaultMaxListeners",{enumerable:!0,get:function(){return w},set:function(z){if(typeof z!="number"||z<0||v(z))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+z+".");w=z}}),b.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},b.prototype.setMaxListeners=function(ne){if(typeof ne!="number"||ne<0||v(ne))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+ne+".");return this._maxListeners=ne,this};function _(z){return z._maxListeners===void 0?b.defaultMaxListeners:z._maxListeners}b.prototype.getMaxListeners=function(){return _(this)},b.prototype.emit=function(ne){for(var ue=[],he=1;he<arguments.length;he++)ue.push(arguments[he]);var Y=ne==="error",X=this._events;if(X!==void 0)Y=Y&&X.error===void 0;else if(!Y)return!1;if(Y){var J;if(ue.length>0&&(J=ue[0]),J instanceof Error)throw J;var j=new Error("Unhandled error."+(J?" ("+J.message+")":""));throw j.context=J,j}var M=X[ne];if(M===void 0)return!1;if(typeof M=="function")u(M,this,ue);else for(var N=M.length,P=C(M,N),he=0;he<N;++he)u(P[he],this,ue);return!0};function S(z,ne,ue,he){var Y,X,J;if(E(ue),X=z._events,X===void 0?(X=z._events=Object.create(null),z._eventsCount=0):(X.newListener!==void 0&&(z.emit("newListener",ne,ue.listener?ue.listener:ue),X=z._events),J=X[ne]),J===void 0)J=X[ne]=ue,++z._eventsCount;else if(typeof J=="function"?J=X[ne]=he?[ue,J]:[J,ue]:he?J.unshift(ue):J.push(ue),Y=_(z),Y>0&&J.length>Y&&!J.warned){J.warned=!0;var j=new Error("Possible EventEmitter memory leak detected. "+J.length+" "+String(ne)+" listeners added. Use emitter.setMaxListeners() to increase limit");j.name="MaxListenersExceededWarning",j.emitter=z,j.type=ne,j.count=J.length,y(j)}return z}b.prototype.addListener=function(ne,ue){return S(this,ne,ue,!1)},b.prototype.on=b.prototype.addListener,b.prototype.prependListener=function(ne,ue){return S(this,ne,ue,!0)};function A(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function R(z,ne,ue){var he={fired:!1,wrapFn:void 0,target:z,type:ne,listener:ue},Y=A.bind(he);return Y.listener=ue,he.wrapFn=Y,Y}b.prototype.once=function(ne,ue){return E(ue),this.on(ne,R(this,ne,ue)),this},b.prototype.prependOnceListener=function(ne,ue){return E(ue),this.prependListener(ne,R(this,ne,ue)),this},b.prototype.removeListener=function(ne,ue){var he,Y,X,J,j;if(E(ue),Y=this._events,Y===void 0)return this;if(he=Y[ne],he===void 0)return this;if(he===ue||he.listener===ue)--this._eventsCount===0?this._events=Object.create(null):(delete Y[ne],Y.removeListener&&this.emit("removeListener",ne,he.listener||ue));else if(typeof he!="function"){for(X=-1,J=he.length-1;J>=0;J--)if(he[J]===ue||he[J].listener===ue){j=he[J].listener,X=J;break}if(X<0)return this;X===0?he.shift():I(he,X),he.length===1&&(Y[ne]=he[0]),Y.removeListener!==void 0&&this.emit("removeListener",ne,j||ue)}return this},b.prototype.off=b.prototype.removeListener,b.prototype.removeAllListeners=function(ne){var ue,he,Y;if(he=this._events,he===void 0)return this;if(he.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):he[ne]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete he[ne]),this;if(arguments.length===0){var X=Object.keys(he),J;for(Y=0;Y<X.length;++Y)J=X[Y],J!=="removeListener"&&this.removeAllListeners(J);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(ue=he[ne],typeof ue=="function")this.removeListener(ne,ue);else if(ue!==void 0)for(Y=ue.length-1;Y>=0;Y--)this.removeListener(ne,ue[Y]);return this};function x(z,ne,ue){var he=z._events;if(he===void 0)return[];var Y=he[ne];return Y===void 0?[]:typeof Y=="function"?ue?[Y.listener||Y]:[Y]:ue?L(Y):C(Y,Y.length)}b.prototype.listeners=function(ne){return x(this,ne,!0)},b.prototype.rawListeners=function(ne){return x(this,ne,!1)},b.listenerCount=function(z,ne){return typeof z.listenerCount=="function"?z.listenerCount(ne):T.call(z,ne)},b.prototype.listenerCount=T;function T(z){var ne=this._events;if(ne!==void 0){var ue=ne[z];if(typeof ue=="function")return 1;if(ue!==void 0)return ue.length}return 0}b.prototype.eventNames=function(){return this._eventsCount>0?h(this._events):[]};function C(z,ne){for(var ue=new Array(ne),he=0;he<ne;++he)ue[he]=z[he];return ue}function I(z,ne){for(;ne+1<z.length;ne++)z[ne]=z[ne+1];z.pop()}function L(z){for(var ne=new Array(z.length),ue=0;ue<ne.length;++ue)ne[ue]=z[ue].listener||z[ue];return ne}function $(z,ne){return new Promise(function(ue,he){function Y(J){z.removeListener(ne,X),he(J)}function X(){typeof z.removeListener=="function"&&z.removeListener("error",Y),ue([].slice.call(arguments))}U(z,ne,X,{once:!0}),ne!=="error"&&B(z,Y,{once:!0})})}function B(z,ne,ue){typeof z.on=="function"&&U(z,"error",ne,ue)}function U(z,ne,ue,he){if(typeof z.on=="function")he.once?z.once(ne,ue):z.on(ne,ue);else if(typeof z.addEventListener=="function")z.addEventListener(ne,function Y(X){he.once&&z.removeEventListener(ne,Y),ue(X)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof z)}return events.exports}var streamBrowser$1,hasRequiredStreamBrowser$1;function requireStreamBrowser$1(){return hasRequiredStreamBrowser$1||(hasRequiredStreamBrowser$1=1,streamBrowser$1=requireEvents().EventEmitter),streamBrowser$1}var buffer_list$1,hasRequiredBuffer_list$1;function requireBuffer_list$1(){if(hasRequiredBuffer_list$1)return buffer_list$1;hasRequiredBuffer_list$1=1;function g(C,I){var L=Object.keys(C);if(Object.getOwnPropertySymbols){var $=Object.getOwnPropertySymbols(C);I&&($=$.filter(function(B){return Object.getOwnPropertyDescriptor(C,B).enumerable})),L.push.apply(L,$)}return L}function u(C){for(var I=1;I<arguments.length;I++){var L=arguments[I]!=null?arguments[I]:{};I%2?g(Object(L),!0).forEach(function($){h(C,$,L[$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(C,Object.getOwnPropertyDescriptors(L)):g(Object(L)).forEach(function($){Object.defineProperty(C,$,Object.getOwnPropertyDescriptor(L,$))})}return C}function h(C,I,L){return I=w(I),I in C?Object.defineProperty(C,I,{value:L,enumerable:!0,configurable:!0,writable:!0}):C[I]=L,C}function y(C,I){if(!(C instanceof I))throw new TypeError("Cannot call a class as a function")}function v(C,I){for(var L=0;L<I.length;L++){var $=I[L];$.enumerable=$.enumerable||!1,$.configurable=!0,"value"in $&&($.writable=!0),Object.defineProperty(C,w($.key),$)}}function b(C,I,L){return I&&v(C.prototype,I),Object.defineProperty(C,"prototype",{writable:!1}),C}function w(C){var I=E(C,"string");return typeof I=="symbol"?I:String(I)}function E(C,I){if(typeof C!="object"||C===null)return C;var L=C[Symbol.toPrimitive];if(L!==void 0){var $=L.call(C,I);if(typeof $!="object")return $;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(C)}var _=requireDist$1(),S=_.Buffer,A=requireUtil$2(),R=A.inspect,x=R&&R.custom||"inspect";function T(C,I,L){S.prototype.copy.call(C,I,L)}return buffer_list$1=(function(){function C(){y(this,C),this.head=null,this.tail=null,this.length=0}return b(C,[{key:"push",value:function(L){var $={data:L,next:null};this.length>0?this.tail.next=$:this.head=$,this.tail=$,++this.length}},{key:"unshift",value:function(L){var $={data:L,next:this.head};this.length===0&&(this.tail=$),this.head=$,++this.length}},{key:"shift",value:function(){if(this.length!==0){var L=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,L}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(L){if(this.length===0)return"";for(var $=this.head,B=""+$.data;$=$.next;)B+=L+$.data;return B}},{key:"concat",value:function(L){if(this.length===0)return S.alloc(0);for(var $=S.allocUnsafe(L>>>0),B=this.head,U=0;B;)T(B.data,$,U),U+=B.data.length,B=B.next;return $}},{key:"consume",value:function(L,$){var B;return L<this.head.data.length?(B=this.head.data.slice(0,L),this.head.data=this.head.data.slice(L)):L===this.head.data.length?B=this.shift():B=$?this._getString(L):this._getBuffer(L),B}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(L){var $=this.head,B=1,U=$.data;for(L-=U.length;$=$.next;){var z=$.data,ne=L>z.length?z.length:L;if(ne===z.length?U+=z:U+=z.slice(0,L),L-=ne,L===0){ne===z.length?(++B,$.next?this.head=$.next:this.head=this.tail=null):(this.head=$,$.data=z.slice(ne));break}++B}return this.length-=B,U}},{key:"_getBuffer",value:function(L){var $=S.allocUnsafe(L),B=this.head,U=1;for(B.data.copy($),L-=B.data.length;B=B.next;){var z=B.data,ne=L>z.length?z.length:L;if(z.copy($,$.length-L,0,ne),L-=ne,L===0){ne===z.length?(++U,B.next?this.head=B.next:this.head=this.tail=null):(this.head=B,B.data=z.slice(ne));break}++U}return this.length-=U,$}},{key:x,value:function(L,$){return R(this,u(u({},$),{},{depth:0,customInspect:!1}))}}]),C})(),buffer_list$1}var destroy_1$2,hasRequiredDestroy$2;function requireDestroy$2(){if(hasRequiredDestroy$2)return destroy_1$2;hasRequiredDestroy$2=1;function g(w,E){var _=this,S=this._readableState&&this._readableState.destroyed,A=this._writableState&&this._writableState.destroyed;return S||A?(E?E(w):w&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process$1.nextTick(v,this,w)):process$1.nextTick(v,this,w)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(w||null,function(R){!E&&R?_._writableState?_._writableState.errorEmitted?process$1.nextTick(h,_):(_._writableState.errorEmitted=!0,process$1.nextTick(u,_,R)):process$1.nextTick(u,_,R):E?(process$1.nextTick(h,_),E(R)):process$1.nextTick(h,_)}),this)}function u(w,E){v(w,E),h(w)}function h(w){w._writableState&&!w._writableState.emitClose||w._readableState&&!w._readableState.emitClose||w.emit("close")}function y(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function v(w,E){w.emit("error",E)}function b(w,E){var _=w._readableState,S=w._writableState;_&&_.autoDestroy||S&&S.autoDestroy?w.destroy(E):w.emit("error",E)}return destroy_1$2={destroy:g,undestroy:y,errorOrDestroy:b},destroy_1$2}var errorsBrowser={},hasRequiredErrorsBrowser;function requireErrorsBrowser(){if(hasRequiredErrorsBrowser)return errorsBrowser;hasRequiredErrorsBrowser=1;function g(E,_){E.prototype=Object.create(_.prototype),E.prototype.constructor=E,E.__proto__=_}var u={};function h(E,_,S){S||(S=Error);function A(x,T,C){return typeof _=="string"?_:_(x,T,C)}var R=(function(x){g(T,x);function T(C,I,L){return x.call(this,A(C,I,L))||this}return T})(S);R.prototype.name=S.name,R.prototype.code=E,u[E]=R}function y(E,_){if(Array.isArray(E)){var S=E.length;return E=E.map(function(A){return String(A)}),S>2?"one of ".concat(_," ").concat(E.slice(0,S-1).join(", "),", or ")+E[S-1]:S===2?"one of ".concat(_," ").concat(E[0]," or ").concat(E[1]):"of ".concat(_," ").concat(E[0])}else return"of ".concat(_," ").concat(String(E))}function v(E,_,S){return E.substr(0,_.length)===_}function b(E,_,S){return(S===void 0||S>E.length)&&(S=E.length),E.substring(S-_.length,S)===_}function w(E,_,S){return typeof S!="number"&&(S=0),S+_.length>E.length?!1:E.indexOf(_,S)!==-1}return h("ERR_INVALID_OPT_VALUE",function(E,_){return'The value "'+_+'" is invalid for option "'+E+'"'},TypeError),h("ERR_INVALID_ARG_TYPE",function(E,_,S){var A;typeof _=="string"&&v(_,"not ")?(A="must not be",_=_.replace(/^not /,"")):A="must be";var R;if(b(E," argument"))R="The ".concat(E," ").concat(A," ").concat(y(_,"type"));else{var x=w(E,".")?"property":"argument";R='The "'.concat(E,'" ').concat(x," ").concat(A," ").concat(y(_,"type"))}return R+=". Received type ".concat(typeof S),R},TypeError),h("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),h("ERR_METHOD_NOT_IMPLEMENTED",function(E){return"The "+E+" method is not implemented"}),h("ERR_STREAM_PREMATURE_CLOSE","Premature close"),h("ERR_STREAM_DESTROYED",function(E){return"Cannot call "+E+" after a stream was destroyed"}),h("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),h("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),h("ERR_STREAM_WRITE_AFTER_END","write after end"),h("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),h("ERR_UNKNOWN_ENCODING",function(E){return"Unknown encoding: "+E},TypeError),h("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),errorsBrowser.codes=u,errorsBrowser}var state$1,hasRequiredState$1;function requireState$1(){if(hasRequiredState$1)return state$1;hasRequiredState$1=1;var g=requireErrorsBrowser().codes.ERR_INVALID_OPT_VALUE;function u(y,v,b){return y.highWaterMark!=null?y.highWaterMark:v?y[b]:null}function h(y,v,b,w){var E=u(v,w,b);if(E!=null){if(!(isFinite(E)&&Math.floor(E)===E)||E<0){var _=w?b:"highWaterMark";throw new g(_,E)}return Math.floor(E)}return y.objectMode?16:16*1024}return state$1={getHighWaterMark:h},state$1}var browser$b,hasRequiredBrowser$b;function requireBrowser$b(){if(hasRequiredBrowser$b)return browser$b;hasRequiredBrowser$b=1,browser$b=g;function g(h,y){if(u("noDeprecation"))return h;var v=!1;function b(){if(!v){if(u("throwDeprecation"))throw new Error(y);u("traceDeprecation")?console.trace(y):console.warn(y),v=!0}return h.apply(this,arguments)}return b}function u(h){try{if(!globalThis.localStorage)return!1}catch{return!1}var y=globalThis.localStorage[h];return y==null?!1:String(y).toLowerCase()==="true"}return browser$b}var _stream_writable$1,hasRequired_stream_writable$1;function require_stream_writable$1(){if(hasRequired_stream_writable$1)return _stream_writable$1;hasRequired_stream_writable$1=1,_stream_writable$1=Y;function g(le){var te=this;this.next=null,this.entry=null,this.finish=function(){ae(te,le)}}var u;Y.WritableState=ue;var h={deprecate:requireBrowser$b()},y=requireStreamBrowser$1(),v=requireDist$1().Buffer,b=(typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function w(le){return v.from(le)}function E(le){return v.isBuffer(le)||le instanceof b}var _=requireDestroy$2(),S=requireState$1(),A=S.getHighWaterMark,R=requireErrorsBrowser().codes,x=R.ERR_INVALID_ARG_TYPE,T=R.ERR_METHOD_NOT_IMPLEMENTED,C=R.ERR_MULTIPLE_CALLBACK,I=R.ERR_STREAM_CANNOT_PIPE,L=R.ERR_STREAM_DESTROYED,$=R.ERR_STREAM_NULL_VALUES,B=R.ERR_STREAM_WRITE_AFTER_END,U=R.ERR_UNKNOWN_ENCODING,z=_.errorOrDestroy;requireInherits_browser()(Y,y);function ne(){}function ue(le,te,ce){u=u||require_stream_duplex$1(),le=le||{},typeof ce!="boolean"&&(ce=te instanceof u),this.objectMode=!!le.objectMode,ce&&(this.objectMode=this.objectMode||!!le.writableObjectMode),this.highWaterMark=A(this,le,"writableHighWaterMark",ce),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var ge=le.decodeStrings===!1;this.decodeStrings=!ge,this.defaultEncoding=le.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(Ee){k(te,Ee)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=le.emitClose!==!1,this.autoDestroy=!!le.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new g(this)}ue.prototype.getBuffer=function(){for(var te=this.bufferedRequest,ce=[];te;)ce.push(te),te=te.next;return ce},(function(){try{Object.defineProperty(ue.prototype,"buffer",{get:h.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var he;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(he=Function.prototype[Symbol.hasInstance],Object.defineProperty(Y,Symbol.hasInstance,{value:function(te){return he.call(this,te)?!0:this!==Y?!1:te&&te._writableState instanceof ue}})):he=function(te){return te instanceof this};function Y(le){u=u||require_stream_duplex$1();var te=this instanceof u;if(!te&&!he.call(Y,this))return new Y(le);this._writableState=new ue(le,this,te),this.writable=!0,le&&(typeof le.write=="function"&&(this._write=le.write),typeof le.writev=="function"&&(this._writev=le.writev),typeof le.destroy=="function"&&(this._destroy=le.destroy),typeof le.final=="function"&&(this._final=le.final)),y.call(this)}Y.prototype.pipe=function(){z(this,new I)};function X(le,te){var ce=new B;z(le,ce),process$1.nextTick(te,ce)}function J(le,te,ce,ge){var Ee;return ce===null?Ee=new $:typeof ce!="string"&&!te.objectMode&&(Ee=new x("chunk",["string","Buffer"],ce)),Ee?(z(le,Ee),process$1.nextTick(ge,Ee),!1):!0}Y.prototype.write=function(le,te,ce){var ge=this._writableState,Ee=!1,pe=!ge.objectMode&&E(le);return pe&&!v.isBuffer(le)&&(le=w(le)),typeof te=="function"&&(ce=te,te=null),pe?te="buffer":te||(te=ge.defaultEncoding),typeof ce!="function"&&(ce=ne),ge.ending?X(this,ce):(pe||J(this,ge,le,ce))&&(ge.pendingcb++,Ee=M(this,ge,pe,le,te,ce)),Ee},Y.prototype.cork=function(){this._writableState.corked++},Y.prototype.uncork=function(){var le=this._writableState;le.corked&&(le.corked--,!le.writing&&!le.corked&&!le.bufferProcessing&&le.bufferedRequest&&H(this,le))},Y.prototype.setDefaultEncoding=function(te){if(typeof te=="string"&&(te=te.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((te+"").toLowerCase())>-1))throw new U(te);return this._writableState.defaultEncoding=te,this},Object.defineProperty(Y.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function j(le,te,ce){return!le.objectMode&&le.decodeStrings!==!1&&typeof te=="string"&&(te=v.from(te,ce)),te}Object.defineProperty(Y.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function M(le,te,ce,ge,Ee,pe){if(!ce){var de=j(te,ge,Ee);ge!==de&&(ce=!0,Ee="buffer",ge=de)}var me=te.objectMode?1:ge.length;te.length+=me;var _e=te.length<te.highWaterMark;if(_e||(te.needDrain=!0),te.writing||te.corked){var Ae=te.lastBufferedRequest;te.lastBufferedRequest={chunk:ge,encoding:Ee,isBuf:ce,callback:pe,next:null},Ae?Ae.next=te.lastBufferedRequest:te.bufferedRequest=te.lastBufferedRequest,te.bufferedRequestCount+=1}else N(le,te,!1,me,ge,Ee,pe);return _e}function N(le,te,ce,ge,Ee,pe,de){te.writelen=ge,te.writecb=de,te.writing=!0,te.sync=!0,te.destroyed?te.onwrite(new L("write")):ce?le._writev(Ee,te.onwrite):le._write(Ee,pe,te.onwrite),te.sync=!1}function P(le,te,ce,ge,Ee){--te.pendingcb,ce?(process$1.nextTick(Ee,ge),process$1.nextTick(K,le,te),le._writableState.errorEmitted=!0,z(le,ge)):(Ee(ge),le._writableState.errorEmitted=!0,z(le,ge),K(le,te))}function O(le){le.writing=!1,le.writecb=null,le.length-=le.writelen,le.writelen=0}function k(le,te){var ce=le._writableState,ge=ce.sync,Ee=ce.writecb;if(typeof Ee!="function")throw new C;if(O(ce),te)P(le,ce,ge,te,Ee);else{var pe=D(ce)||le.destroyed;!pe&&!ce.corked&&!ce.bufferProcessing&&ce.bufferedRequest&&H(le,ce),ge?process$1.nextTick(q,le,ce,pe,Ee):q(le,ce,pe,Ee)}}function q(le,te,ce,ge){ce||F(le,te),te.pendingcb--,ge(),K(le,te)}function F(le,te){te.length===0&&te.needDrain&&(te.needDrain=!1,le.emit("drain"))}function H(le,te){te.bufferProcessing=!0;var ce=te.bufferedRequest;if(le._writev&&ce&&ce.next){var ge=te.bufferedRequestCount,Ee=new Array(ge),pe=te.corkedRequestsFree;pe.entry=ce;for(var de=0,me=!0;ce;)Ee[de]=ce,ce.isBuf||(me=!1),ce=ce.next,de+=1;Ee.allBuffers=me,N(le,te,!0,te.length,Ee,"",pe.finish),te.pendingcb++,te.lastBufferedRequest=null,pe.next?(te.corkedRequestsFree=pe.next,pe.next=null):te.corkedRequestsFree=new g(te),te.bufferedRequestCount=0}else{for(;ce;){var _e=ce.chunk,Ae=ce.encoding,Pe=ce.callback,Me=te.objectMode?1:_e.length;if(N(le,te,!1,Me,_e,Ae,Pe),ce=ce.next,te.bufferedRequestCount--,te.writing)break}ce===null&&(te.lastBufferedRequest=null)}te.bufferedRequest=ce,te.bufferProcessing=!1}Y.prototype._write=function(le,te,ce){ce(new T("_write()"))},Y.prototype._writev=null,Y.prototype.end=function(le,te,ce){var ge=this._writableState;return typeof le=="function"?(ce=le,le=null,te=null):typeof te=="function"&&(ce=te,te=null),le!=null&&this.write(le,te),ge.corked&&(ge.corked=1,this.uncork()),ge.ending||Z(this,ge,ce),this},Object.defineProperty(Y.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function D(le){return le.ending&&le.length===0&&le.bufferedRequest===null&&!le.finished&&!le.writing}function G(le,te){le._final(function(ce){te.pendingcb--,ce&&z(le,ce),te.prefinished=!0,le.emit("prefinish"),K(le,te)})}function W(le,te){!te.prefinished&&!te.finalCalled&&(typeof le._final=="function"&&!te.destroyed?(te.pendingcb++,te.finalCalled=!0,process$1.nextTick(G,le,te)):(te.prefinished=!0,le.emit("prefinish")))}function K(le,te){var ce=D(te);if(ce&&(W(le,te),te.pendingcb===0&&(te.finished=!0,le.emit("finish"),te.autoDestroy))){var ge=le._readableState;(!ge||ge.autoDestroy&&ge.endEmitted)&&le.destroy()}return ce}function Z(le,te,ce){te.ending=!0,K(le,te),ce&&(te.finished?process$1.nextTick(ce):le.once("finish",ce)),te.ended=!0,le.writable=!1}function ae(le,te,ce){var ge=le.entry;for(le.entry=null;ge;){var Ee=ge.callback;te.pendingcb--,Ee(ce),ge=ge.next}te.corkedRequestsFree.next=le}return Object.defineProperty(Y.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(te){this._writableState&&(this._writableState.destroyed=te)}}),Y.prototype.destroy=_.destroy,Y.prototype._undestroy=_.undestroy,Y.prototype._destroy=function(le,te){te(le)},_stream_writable$1}var _stream_duplex$1,hasRequired_stream_duplex$1;function require_stream_duplex$1(){if(hasRequired_stream_duplex$1)return _stream_duplex$1;hasRequired_stream_duplex$1=1;var g=Object.keys||function(S){var A=[];for(var R in S)A.push(R);return A};_stream_duplex$1=w;var u=require_stream_readable$1(),h=require_stream_writable$1();requireInherits_browser()(w,u);for(var y=g(h.prototype),v=0;v<y.length;v++){var b=y[v];w.prototype[b]||(w.prototype[b]=h.prototype[b])}function w(S){if(!(this instanceof w))return new w(S);u.call(this,S),h.call(this,S),this.allowHalfOpen=!0,S&&(S.readable===!1&&(this.readable=!1),S.writable===!1&&(this.writable=!1),S.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",E)))}Object.defineProperty(w.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(w.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(w.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function E(){this._writableState.ended||process$1.nextTick(_,this)}function _(S){S.end()}return Object.defineProperty(w.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(A){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=A,this._writableState.destroyed=A)}}),_stream_duplex$1}var string_decoder={},hasRequiredString_decoder;function requireString_decoder(){if(hasRequiredString_decoder)return string_decoder;hasRequiredString_decoder=1;var g=requireSafeBuffer$1().Buffer,u=g.isEncoding||function($){switch($=""+$,$&&$.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function h($){if(!$)return"utf8";for(var B;;)switch($){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return $;default:if(B)return;$=(""+$).toLowerCase(),B=!0}}function y($){var B=h($);if(typeof B!="string"&&(g.isEncoding===u||!u($)))throw new Error("Unknown encoding: "+$);return B||$}string_decoder.StringDecoder=v;function v($){this.encoding=y($);var B;switch(this.encoding){case"utf16le":this.text=R,this.end=x,B=4;break;case"utf8":this.fillLast=_,B=4;break;case"base64":this.text=T,this.end=C,B=3;break;default:this.write=I,this.end=L;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=g.allocUnsafe(B)}v.prototype.write=function($){if($.length===0)return"";var B,U;if(this.lastNeed){if(B=this.fillLast($),B===void 0)return"";U=this.lastNeed,this.lastNeed=0}else U=0;return U<$.length?B?B+this.text($,U):this.text($,U):B||""},v.prototype.end=A,v.prototype.text=S,v.prototype.fillLast=function($){if(this.lastNeed<=$.length)return $.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);$.copy(this.lastChar,this.lastTotal-this.lastNeed,0,$.length),this.lastNeed-=$.length};function b($){return $<=127?0:$>>5===6?2:$>>4===14?3:$>>3===30?4:$>>6===2?-1:-2}function w($,B,U){var z=B.length-1;if(z<U)return 0;var ne=b(B[z]);return ne>=0?(ne>0&&($.lastNeed=ne-1),ne):--z<U||ne===-2?0:(ne=b(B[z]),ne>=0?(ne>0&&($.lastNeed=ne-2),ne):--z<U||ne===-2?0:(ne=b(B[z]),ne>=0?(ne>0&&(ne===2?ne=0:$.lastNeed=ne-3),ne):0))}function E($,B,U){if((B[0]&192)!==128)return $.lastNeed=0,"";if($.lastNeed>1&&B.length>1){if((B[1]&192)!==128)return $.lastNeed=1,"";if($.lastNeed>2&&B.length>2&&(B[2]&192)!==128)return $.lastNeed=2,""}}function _($){var B=this.lastTotal-this.lastNeed,U=E(this,$);if(U!==void 0)return U;if(this.lastNeed<=$.length)return $.copy(this.lastChar,B,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);$.copy(this.lastChar,B,0,$.length),this.lastNeed-=$.length}function S($,B){var U=w(this,$,B);if(!this.lastNeed)return $.toString("utf8",B);this.lastTotal=U;var z=$.length-(U-this.lastNeed);return $.copy(this.lastChar,0,z),$.toString("utf8",B,z)}function A($){var B=$&&$.length?this.write($):"";return this.lastNeed?B+"":B}function R($,B){if(($.length-B)%2===0){var U=$.toString("utf16le",B);if(U){var z=U.charCodeAt(U.length-1);if(z>=55296&&z<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=$[$.length-2],this.lastChar[1]=$[$.length-1],U.slice(0,-1)}return U}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=$[$.length-1],$.toString("utf16le",B,$.length-1)}function x($){var B=$&&$.length?this.write($):"";if(this.lastNeed){var U=this.lastTotal-this.lastNeed;return B+this.lastChar.toString("utf16le",0,U)}return B}function T($,B){var U=($.length-B)%3;return U===0?$.toString("base64",B):(this.lastNeed=3-U,this.lastTotal=3,U===1?this.lastChar[0]=$[$.length-1]:(this.lastChar[0]=$[$.length-2],this.lastChar[1]=$[$.length-1]),$.toString("base64",B,$.length-U))}function C($){var B=$&&$.length?this.write($):"";return this.lastNeed?B+this.lastChar.toString("base64",0,3-this.lastNeed):B}function I($){return $.toString(this.encoding)}function L($){return $&&$.length?this.write($):""}return string_decoder}var endOfStream$2,hasRequiredEndOfStream$2;function requireEndOfStream$2(){if(hasRequiredEndOfStream$2)return endOfStream$2;hasRequiredEndOfStream$2=1;var g=requireErrorsBrowser().codes.ERR_STREAM_PREMATURE_CLOSE;function u(b){var w=!1;return function(){if(!w){w=!0;for(var E=arguments.length,_=new Array(E),S=0;S<E;S++)_[S]=arguments[S];b.apply(this,_)}}}function h(){}function y(b){return b.setHeader&&typeof b.abort=="function"}function v(b,w,E){if(typeof w=="function")return v(b,null,w);w||(w={}),E=u(E||h);var _=w.readable||w.readable!==!1&&b.readable,S=w.writable||w.writable!==!1&&b.writable,A=function(){b.writable||x()},R=b._writableState&&b._writableState.finished,x=function(){S=!1,R=!0,_||E.call(b)},T=b._readableState&&b._readableState.endEmitted,C=function(){_=!1,T=!0,S||E.call(b)},I=function(U){E.call(b,U)},L=function(){var U;if(_&&!T)return(!b._readableState||!b._readableState.ended)&&(U=new g),E.call(b,U);if(S&&!R)return(!b._writableState||!b._writableState.ended)&&(U=new g),E.call(b,U)},$=function(){b.req.on("finish",x)};return y(b)?(b.on("complete",x),b.on("abort",L),b.req?$():b.on("request",$)):S&&!b._writableState&&(b.on("end",A),b.on("close",A)),b.on("end",C),b.on("finish",x),w.error!==!1&&b.on("error",I),b.on("close",L),function(){b.removeListener("complete",x),b.removeListener("abort",L),b.removeListener("request",$),b.req&&b.req.removeListener("finish",x),b.removeListener("end",A),b.removeListener("close",A),b.removeListener("finish",x),b.removeListener("end",C),b.removeListener("error",I),b.removeListener("close",L)}}return endOfStream$2=v,endOfStream$2}var async_iterator,hasRequiredAsync_iterator;function requireAsync_iterator(){if(hasRequiredAsync_iterator)return async_iterator;hasRequiredAsync_iterator=1;var g;function u(U,z,ne){return z=h(z),z in U?Object.defineProperty(U,z,{value:ne,enumerable:!0,configurable:!0,writable:!0}):U[z]=ne,U}function h(U){var z=y(U,"string");return typeof z=="symbol"?z:String(z)}function y(U,z){if(typeof U!="object"||U===null)return U;var ne=U[Symbol.toPrimitive];if(ne!==void 0){var ue=ne.call(U,z);if(typeof ue!="object")return ue;throw new TypeError("@@toPrimitive must return a primitive value.")}return(z==="string"?String:Number)(U)}var v=requireEndOfStream$2(),b=Symbol("lastResolve"),w=Symbol("lastReject"),E=Symbol("error"),_=Symbol("ended"),S=Symbol("lastPromise"),A=Symbol("handlePromise"),R=Symbol("stream");function x(U,z){return{value:U,done:z}}function T(U){var z=U[b];if(z!==null){var ne=U[R].read();ne!==null&&(U[S]=null,U[b]=null,U[w]=null,z(x(ne,!1)))}}function C(U){process$1.nextTick(T,U)}function I(U,z){return function(ne,ue){U.then(function(){if(z[_]){ne(x(void 0,!0));return}z[A](ne,ue)},ue)}}var L=Object.getPrototypeOf(function(){}),$=Object.setPrototypeOf((g={get stream(){return this[R]},next:function(){var z=this,ne=this[E];if(ne!==null)return Promise.reject(ne);if(this[_])return Promise.resolve(x(void 0,!0));if(this[R].destroyed)return new Promise(function(X,J){process$1.nextTick(function(){z[E]?J(z[E]):X(x(void 0,!0))})});var ue=this[S],he;if(ue)he=new Promise(I(ue,this));else{var Y=this[R].read();if(Y!==null)return Promise.resolve(x(Y,!1));he=new Promise(this[A])}return this[S]=he,he}},u(g,Symbol.asyncIterator,function(){return this}),u(g,"return",function(){var z=this;return new Promise(function(ne,ue){z[R].destroy(null,function(he){if(he){ue(he);return}ne(x(void 0,!0))})})}),g),L),B=function(z){var ne,ue=Object.create($,(ne={},u(ne,R,{value:z,writable:!0}),u(ne,b,{value:null,writable:!0}),u(ne,w,{value:null,writable:!0}),u(ne,E,{value:null,writable:!0}),u(ne,_,{value:z._readableState.endEmitted,writable:!0}),u(ne,A,{value:function(Y,X){var J=ue[R].read();J?(ue[S]=null,ue[b]=null,ue[w]=null,Y(x(J,!1))):(ue[b]=Y,ue[w]=X)},writable:!0}),ne));return ue[S]=null,v(z,function(he){if(he&&he.code!=="ERR_STREAM_PREMATURE_CLOSE"){var Y=ue[w];Y!==null&&(ue[S]=null,ue[b]=null,ue[w]=null,Y(he)),ue[E]=he;return}var X=ue[b];X!==null&&(ue[S]=null,ue[b]=null,ue[w]=null,X(x(void 0,!0))),ue[_]=!0}),z.on("readable",C.bind(null,ue)),ue};return async_iterator=B,async_iterator}var fromBrowser,hasRequiredFromBrowser;function requireFromBrowser(){return hasRequiredFromBrowser||(hasRequiredFromBrowser=1,fromBrowser=function(){throw new Error("Readable.from is not available in the browser")}),fromBrowser}var _stream_readable$1,hasRequired_stream_readable$1;function require_stream_readable$1(){if(hasRequired_stream_readable$1)return _stream_readable$1;hasRequired_stream_readable$1=1,_stream_readable$1=X;var g;X.ReadableState=Y,requireEvents().EventEmitter;var u=function(de,me){return de.listeners(me).length},h=requireStreamBrowser$1(),y=requireDist$1().Buffer,v=(typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function b(pe){return y.from(pe)}function w(pe){return y.isBuffer(pe)||pe instanceof v}var E=requireUtil$2(),_;E&&E.debuglog?_=E.debuglog("stream"):_=function(){};var S=requireBuffer_list$1(),A=requireDestroy$2(),R=requireState$1(),x=R.getHighWaterMark,T=requireErrorsBrowser().codes,C=T.ERR_INVALID_ARG_TYPE,I=T.ERR_STREAM_PUSH_AFTER_EOF,L=T.ERR_METHOD_NOT_IMPLEMENTED,$=T.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,B,U,z;requireInherits_browser()(X,h);var ne=A.errorOrDestroy,ue=["error","close","destroy","pause","resume"];function he(pe,de,me){if(typeof pe.prependListener=="function")return pe.prependListener(de,me);!pe._events||!pe._events[de]?pe.on(de,me):Array.isArray(pe._events[de])?pe._events[de].unshift(me):pe._events[de]=[me,pe._events[de]]}function Y(pe,de,me){g=g||require_stream_duplex$1(),pe=pe||{},typeof me!="boolean"&&(me=de instanceof g),this.objectMode=!!pe.objectMode,me&&(this.objectMode=this.objectMode||!!pe.readableObjectMode),this.highWaterMark=x(this,pe,"readableHighWaterMark",me),this.buffer=new S,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=pe.emitClose!==!1,this.autoDestroy=!!pe.autoDestroy,this.destroyed=!1,this.defaultEncoding=pe.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,pe.encoding&&(B||(B=requireString_decoder().StringDecoder),this.decoder=new B(pe.encoding),this.encoding=pe.encoding)}function X(pe){if(g=g||require_stream_duplex$1(),!(this instanceof X))return new X(pe);var de=this instanceof g;this._readableState=new Y(pe,this,de),this.readable=!0,pe&&(typeof pe.read=="function"&&(this._read=pe.read),typeof pe.destroy=="function"&&(this._destroy=pe.destroy)),h.call(this)}Object.defineProperty(X.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(de){this._readableState&&(this._readableState.destroyed=de)}}),X.prototype.destroy=A.destroy,X.prototype._undestroy=A.undestroy,X.prototype._destroy=function(pe,de){de(pe)},X.prototype.push=function(pe,de){var me=this._readableState,_e;return me.objectMode?_e=!0:typeof pe=="string"&&(de=de||me.defaultEncoding,de!==me.encoding&&(pe=y.from(pe,de),de=""),_e=!0),J(this,pe,de,!1,_e)},X.prototype.unshift=function(pe){return J(this,pe,null,!0,!1)};function J(pe,de,me,_e,Ae){_("readableAddChunk",de);var Pe=pe._readableState;if(de===null)Pe.reading=!1,k(pe,Pe);else{var Me;if(Ae||(Me=M(Pe,de)),Me)ne(pe,Me);else if(Pe.objectMode||de&&de.length>0)if(typeof de!="string"&&!Pe.objectMode&&Object.getPrototypeOf(de)!==y.prototype&&(de=b(de)),_e)Pe.endEmitted?ne(pe,new $):j(pe,Pe,de,!0);else if(Pe.ended)ne(pe,new I);else{if(Pe.destroyed)return!1;Pe.reading=!1,Pe.decoder&&!me?(de=Pe.decoder.write(de),Pe.objectMode||de.length!==0?j(pe,Pe,de,!1):H(pe,Pe)):j(pe,Pe,de,!1)}else _e||(Pe.reading=!1,H(pe,Pe))}return!Pe.ended&&(Pe.length<Pe.highWaterMark||Pe.length===0)}function j(pe,de,me,_e){de.flowing&&de.length===0&&!de.sync?(de.awaitDrain=0,pe.emit("data",me)):(de.length+=de.objectMode?1:me.length,_e?de.buffer.unshift(me):de.buffer.push(me),de.needReadable&&q(pe)),H(pe,de)}function M(pe,de){var me;return!w(de)&&typeof de!="string"&&de!==void 0&&!pe.objectMode&&(me=new C("chunk",["string","Buffer","Uint8Array"],de)),me}X.prototype.isPaused=function(){return this._readableState.flowing===!1},X.prototype.setEncoding=function(pe){B||(B=requireString_decoder().StringDecoder);var de=new B(pe);this._readableState.decoder=de,this._readableState.encoding=this._readableState.decoder.encoding;for(var me=this._readableState.buffer.head,_e="";me!==null;)_e+=de.write(me.data),me=me.next;return this._readableState.buffer.clear(),_e!==""&&this._readableState.buffer.push(_e),this._readableState.length=_e.length,this};var N=1073741824;function P(pe){return pe>=N?pe=N:(pe--,pe|=pe>>>1,pe|=pe>>>2,pe|=pe>>>4,pe|=pe>>>8,pe|=pe>>>16,pe++),pe}function O(pe,de){return pe<=0||de.length===0&&de.ended?0:de.objectMode?1:pe!==pe?de.flowing&&de.length?de.buffer.head.data.length:de.length:(pe>de.highWaterMark&&(de.highWaterMark=P(pe)),pe<=de.length?pe:de.ended?de.length:(de.needReadable=!0,0))}X.prototype.read=function(pe){_("read",pe),pe=parseInt(pe,10);var de=this._readableState,me=pe;if(pe!==0&&(de.emittedReadable=!1),pe===0&&de.needReadable&&((de.highWaterMark!==0?de.length>=de.highWaterMark:de.length>0)||de.ended))return _("read: emitReadable",de.length,de.ended),de.length===0&&de.ended?ce(this):q(this),null;if(pe=O(pe,de),pe===0&&de.ended)return de.length===0&&ce(this),null;var _e=de.needReadable;_("need readable",_e),(de.length===0||de.length-pe<de.highWaterMark)&&(_e=!0,_("length less than watermark",_e)),de.ended||de.reading?(_e=!1,_("reading or ended",_e)):_e&&(_("do read"),de.reading=!0,de.sync=!0,de.length===0&&(de.needReadable=!0),this._read(de.highWaterMark),de.sync=!1,de.reading||(pe=O(me,de)));var Ae;return pe>0?Ae=te(pe,de):Ae=null,Ae===null?(de.needReadable=de.length<=de.highWaterMark,pe=0):(de.length-=pe,de.awaitDrain=0),de.length===0&&(de.ended||(de.needReadable=!0),me!==pe&&de.ended&&ce(this)),Ae!==null&&this.emit("data",Ae),Ae};function k(pe,de){if(_("onEofChunk"),!de.ended){if(de.decoder){var me=de.decoder.end();me&&me.length&&(de.buffer.push(me),de.length+=de.objectMode?1:me.length)}de.ended=!0,de.sync?q(pe):(de.needReadable=!1,de.emittedReadable||(de.emittedReadable=!0,F(pe)))}}function q(pe){var de=pe._readableState;_("emitReadable",de.needReadable,de.emittedReadable),de.needReadable=!1,de.emittedReadable||(_("emitReadable",de.flowing),de.emittedReadable=!0,process$1.nextTick(F,pe))}function F(pe){var de=pe._readableState;_("emitReadable_",de.destroyed,de.length,de.ended),!de.destroyed&&(de.length||de.ended)&&(pe.emit("readable"),de.emittedReadable=!1),de.needReadable=!de.flowing&&!de.ended&&de.length<=de.highWaterMark,le(pe)}function H(pe,de){de.readingMore||(de.readingMore=!0,process$1.nextTick(D,pe,de))}function D(pe,de){for(;!de.reading&&!de.ended&&(de.length<de.highWaterMark||de.flowing&&de.length===0);){var me=de.length;if(_("maybeReadMore read 0"),pe.read(0),me===de.length)break}de.readingMore=!1}X.prototype._read=function(pe){ne(this,new L("_read()"))},X.prototype.pipe=function(pe,de){var me=this,_e=this._readableState;switch(_e.pipesCount){case 0:_e.pipes=pe;break;case 1:_e.pipes=[_e.pipes,pe];break;default:_e.pipes.push(pe);break}_e.pipesCount+=1,_("pipe count=%d opts=%j",_e.pipesCount,de);var Ae=(!de||de.end!==!1)&&pe!==process$1.stdout&&pe!==process$1.stderr,Pe=Ae?Ne:it;_e.endEmitted?process$1.nextTick(Pe):me.once("end",Pe),pe.on("unpipe",Me);function Me(Je,bt){_("onunpipe"),Je===me&&bt&&bt.hasUnpiped===!1&&(bt.hasUnpiped=!0,Oe())}function Ne(){_("onend"),pe.end()}var we=G(me);pe.on("drain",we);var Le=!1;function Oe(){_("cleanup"),pe.removeListener("close",ze),pe.removeListener("finish",Xe),pe.removeListener("drain",we),pe.removeListener("error",We),pe.removeListener("unpipe",Me),me.removeListener("end",Ne),me.removeListener("end",it),me.removeListener("data",Ce),Le=!0,_e.awaitDrain&&(!pe._writableState||pe._writableState.needDrain)&&we()}me.on("data",Ce);function Ce(Je){_("ondata");var bt=pe.write(Je);_("dest.write",bt),bt===!1&&((_e.pipesCount===1&&_e.pipes===pe||_e.pipesCount>1&&Ee(_e.pipes,pe)!==-1)&&!Le&&(_("false write response, pause",_e.awaitDrain),_e.awaitDrain++),me.pause())}function We(Je){_("onerror",Je),it(),pe.removeListener("error",We),u(pe,"error")===0&&ne(pe,Je)}he(pe,"error",We);function ze(){pe.removeListener("finish",Xe),it()}pe.once("close",ze);function Xe(){_("onfinish"),pe.removeListener("close",ze),it()}pe.once("finish",Xe);function it(){_("unpipe"),me.unpipe(pe)}return pe.emit("pipe",me),_e.flowing||(_("pipe resume"),me.resume()),pe};function G(pe){return function(){var me=pe._readableState;_("pipeOnDrain",me.awaitDrain),me.awaitDrain&&me.awaitDrain--,me.awaitDrain===0&&u(pe,"data")&&(me.flowing=!0,le(pe))}}X.prototype.unpipe=function(pe){var de=this._readableState,me={hasUnpiped:!1};if(de.pipesCount===0)return this;if(de.pipesCount===1)return pe&&pe!==de.pipes?this:(pe||(pe=de.pipes),de.pipes=null,de.pipesCount=0,de.flowing=!1,pe&&pe.emit("unpipe",this,me),this);if(!pe){var _e=de.pipes,Ae=de.pipesCount;de.pipes=null,de.pipesCount=0,de.flowing=!1;for(var Pe=0;Pe<Ae;Pe++)_e[Pe].emit("unpipe",this,{hasUnpiped:!1});return this}var Me=Ee(de.pipes,pe);return Me===-1?this:(de.pipes.splice(Me,1),de.pipesCount-=1,de.pipesCount===1&&(de.pipes=de.pipes[0]),pe.emit("unpipe",this,me),this)},X.prototype.on=function(pe,de){var me=h.prototype.on.call(this,pe,de),_e=this._readableState;return pe==="data"?(_e.readableListening=this.listenerCount("readable")>0,_e.flowing!==!1&&this.resume()):pe==="readable"&&!_e.endEmitted&&!_e.readableListening&&(_e.readableListening=_e.needReadable=!0,_e.flowing=!1,_e.emittedReadable=!1,_("on readable",_e.length,_e.reading),_e.length?q(this):_e.reading||process$1.nextTick(K,this)),me},X.prototype.addListener=X.prototype.on,X.prototype.removeListener=function(pe,de){var me=h.prototype.removeListener.call(this,pe,de);return pe==="readable"&&process$1.nextTick(W,this),me},X.prototype.removeAllListeners=function(pe){var de=h.prototype.removeAllListeners.apply(this,arguments);return(pe==="readable"||pe===void 0)&&process$1.nextTick(W,this),de};function W(pe){var de=pe._readableState;de.readableListening=pe.listenerCount("readable")>0,de.resumeScheduled&&!de.paused?de.flowing=!0:pe.listenerCount("data")>0&&pe.resume()}function K(pe){_("readable nexttick read 0"),pe.read(0)}X.prototype.resume=function(){var pe=this._readableState;return pe.flowing||(_("resume"),pe.flowing=!pe.readableListening,Z(this,pe)),pe.paused=!1,this};function Z(pe,de){de.resumeScheduled||(de.resumeScheduled=!0,process$1.nextTick(ae,pe,de))}function ae(pe,de){_("resume",de.reading),de.reading||pe.read(0),de.resumeScheduled=!1,pe.emit("resume"),le(pe),de.flowing&&!de.reading&&pe.read(0)}X.prototype.pause=function(){return _("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(_("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function le(pe){var de=pe._readableState;for(_("flow",de.flowing);de.flowing&&pe.read()!==null;);}X.prototype.wrap=function(pe){var de=this,me=this._readableState,_e=!1;pe.on("end",function(){if(_("wrapped end"),me.decoder&&!me.ended){var Me=me.decoder.end();Me&&Me.length&&de.push(Me)}de.push(null)}),pe.on("data",function(Me){if(_("wrapped data"),me.decoder&&(Me=me.decoder.write(Me)),!(me.objectMode&&Me==null)&&!(!me.objectMode&&(!Me||!Me.length))){var Ne=de.push(Me);Ne||(_e=!0,pe.pause())}});for(var Ae in pe)this[Ae]===void 0&&typeof pe[Ae]=="function"&&(this[Ae]=(function(Ne){return function(){return pe[Ne].apply(pe,arguments)}})(Ae));for(var Pe=0;Pe<ue.length;Pe++)pe.on(ue[Pe],this.emit.bind(this,ue[Pe]));return this._read=function(Me){_("wrapped _read",Me),_e&&(_e=!1,pe.resume())},this},typeof Symbol=="function"&&(X.prototype[Symbol.asyncIterator]=function(){return U===void 0&&(U=requireAsync_iterator()),U(this)}),Object.defineProperty(X.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(X.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(X.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(de){this._readableState&&(this._readableState.flowing=de)}}),X._fromList=te,Object.defineProperty(X.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function te(pe,de){if(de.length===0)return null;var me;return de.objectMode?me=de.buffer.shift():!pe||pe>=de.length?(de.decoder?me=de.buffer.join(""):de.buffer.length===1?me=de.buffer.first():me=de.buffer.concat(de.length),de.buffer.clear()):me=de.buffer.consume(pe,de.decoder),me}function ce(pe){var de=pe._readableState;_("endReadable",de.endEmitted),de.endEmitted||(de.ended=!0,process$1.nextTick(ge,de,pe))}function ge(pe,de){if(_("endReadableNT",pe.endEmitted,pe.length),!pe.endEmitted&&pe.length===0&&(pe.endEmitted=!0,de.readable=!1,de.emit("end"),pe.autoDestroy)){var me=de._writableState;(!me||me.autoDestroy&&me.finished)&&de.destroy()}}typeof Symbol=="function"&&(X.from=function(pe,de){return z===void 0&&(z=requireFromBrowser()),z(X,pe,de)});function Ee(pe,de){for(var me=0,_e=pe.length;me<_e;me++)if(pe[me]===de)return me;return-1}return _stream_readable$1}var _stream_transform$1,hasRequired_stream_transform$1;function require_stream_transform$1(){if(hasRequired_stream_transform$1)return _stream_transform$1;hasRequired_stream_transform$1=1,_stream_transform$1=E;var g=requireErrorsBrowser().codes,u=g.ERR_METHOD_NOT_IMPLEMENTED,h=g.ERR_MULTIPLE_CALLBACK,y=g.ERR_TRANSFORM_ALREADY_TRANSFORMING,v=g.ERR_TRANSFORM_WITH_LENGTH_0,b=require_stream_duplex$1();requireInherits_browser()(E,b);function w(A,R){var x=this._transformState;x.transforming=!1;var T=x.writecb;if(T===null)return this.emit("error",new h);x.writechunk=null,x.writecb=null,R!=null&&this.push(R),T(A);var C=this._readableState;C.reading=!1,(C.needReadable||C.length<C.highWaterMark)&&this._read(C.highWaterMark)}function E(A){if(!(this instanceof E))return new E(A);b.call(this,A),this._transformState={afterTransform:w.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,A&&(typeof A.transform=="function"&&(this._transform=A.transform),typeof A.flush=="function"&&(this._flush=A.flush)),this.on("prefinish",_)}function _(){var A=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(R,x){S(A,R,x)}):S(this,null,null)}E.prototype.push=function(A,R){return this._transformState.needTransform=!1,b.prototype.push.call(this,A,R)},E.prototype._transform=function(A,R,x){x(new u("_transform()"))},E.prototype._write=function(A,R,x){var T=this._transformState;if(T.writecb=x,T.writechunk=A,T.writeencoding=R,!T.transforming){var C=this._readableState;(T.needTransform||C.needReadable||C.length<C.highWaterMark)&&this._read(C.highWaterMark)}},E.prototype._read=function(A){var R=this._transformState;R.writechunk!==null&&!R.transforming?(R.transforming=!0,this._transform(R.writechunk,R.writeencoding,R.afterTransform)):R.needTransform=!0},E.prototype._destroy=function(A,R){b.prototype._destroy.call(this,A,function(x){R(x)})};function S(A,R,x){if(R)return A.emit("error",R);if(x!=null&&A.push(x),A._writableState.length)throw new v;if(A._transformState.transforming)throw new y;return A.push(null)}return _stream_transform$1}var _stream_passthrough$1,hasRequired_stream_passthrough$1;function require_stream_passthrough$1(){if(hasRequired_stream_passthrough$1)return _stream_passthrough$1;hasRequired_stream_passthrough$1=1,_stream_passthrough$1=u;var g=require_stream_transform$1();requireInherits_browser()(u,g);function u(h){if(!(this instanceof u))return new u(h);g.call(this,h)}return u.prototype._transform=function(h,y,v){v(null,h)},_stream_passthrough$1}var pipeline_1$1,hasRequiredPipeline$1;function requirePipeline$1(){if(hasRequiredPipeline$1)return pipeline_1$1;hasRequiredPipeline$1=1;var g;function u(x){var T=!1;return function(){T||(T=!0,x.apply(void 0,arguments))}}var h=requireErrorsBrowser().codes,y=h.ERR_MISSING_ARGS,v=h.ERR_STREAM_DESTROYED;function b(x){if(x)throw x}function w(x){return x.setHeader&&typeof x.abort=="function"}function E(x,T,C,I){I=u(I);var L=!1;x.on("close",function(){L=!0}),g===void 0&&(g=requireEndOfStream$2()),g(x,{readable:T,writable:C},function(B){if(B)return I(B);L=!0,I()});var $=!1;return function(B){if(!L&&!$){if($=!0,w(x))return x.abort();if(typeof x.destroy=="function")return x.destroy();I(B||new v("pipe"))}}}function _(x){x()}function S(x,T){return x.pipe(T)}function A(x){return!x.length||typeof x[x.length-1]!="function"?b:x.pop()}function R(){for(var x=arguments.length,T=new Array(x),C=0;C<x;C++)T[C]=arguments[C];var I=A(T);if(Array.isArray(T[0])&&(T=T[0]),T.length<2)throw new y("streams");var L,$=T.map(function(B,U){var z=U<T.length-1,ne=U>0;return E(B,z,ne,function(ue){L||(L=ue),ue&&$.forEach(_),!z&&($.forEach(_),I(L))})});return T.reduce(S)}return pipeline_1$1=R,pipeline_1$1}var streamBrowserify,hasRequiredStreamBrowserify;function requireStreamBrowserify(){if(hasRequiredStreamBrowserify)return streamBrowserify;hasRequiredStreamBrowserify=1,streamBrowserify=h;var g=requireEvents().EventEmitter,u=requireInherits_browser();u(h,g),h.Readable=require_stream_readable$1(),h.Writable=require_stream_writable$1(),h.Duplex=require_stream_duplex$1(),h.Transform=require_stream_transform$1(),h.PassThrough=require_stream_passthrough$1(),h.finished=requireEndOfStream$2(),h.pipeline=requirePipeline$1(),h.Stream=h;function h(){g.call(this)}return h.prototype.pipe=function(y,v){var b=this;function w(T){y.writable&&y.write(T)===!1&&b.pause&&b.pause()}b.on("data",w);function E(){b.readable&&b.resume&&b.resume()}y.on("drain",E),!y._isStdio&&(!v||v.end!==!1)&&(b.on("end",S),b.on("close",A));var _=!1;function S(){_||(_=!0,y.end())}function A(){_||(_=!0,typeof y.destroy=="function"&&y.destroy())}function R(T){if(x(),g.listenerCount(this,"error")===0)throw T}b.on("error",R),y.on("error",R);function x(){b.removeListener("data",w),y.removeListener("drain",E),b.removeListener("end",S),b.removeListener("close",A),b.removeListener("error",R),y.removeListener("error",R),b.removeListener("end",x),b.removeListener("close",x),y.removeListener("close",x)}return b.on("end",x),b.on("close",x),y.on("close",x),y.emit("pipe",b),y},streamBrowserify}var hashBase$1,hasRequiredHashBase$1;function requireHashBase$1(){if(hasRequiredHashBase$1)return hashBase$1;hasRequiredHashBase$1=1;var g=requireSafeBuffer$1().Buffer,u=requireStreamBrowserify().Transform,h=requireInherits_browser();function y(E){u.call(this),this._block=g.allocUnsafe(E),this._blockSize=E,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}h(y,u),y.prototype._transform=function(E,_,S){var A=null;try{this.update(E,_)}catch(R){A=R}S(A)},y.prototype._flush=function(E){var _=null;try{this.push(this.digest())}catch(S){_=S}E(_)};var v=typeof Uint8Array<"u",b=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&ArrayBuffer.isView&&(g.prototype instanceof Uint8Array||g.TYPED_ARRAY_SUPPORT);function w(E,_){if(E instanceof g)return E;if(typeof E=="string")return g.from(E,_);if(b&&ArrayBuffer.isView(E)){if(E.byteLength===0)return g.alloc(0);var S=g.from(E.buffer,E.byteOffset,E.byteLength);if(S.byteLength===E.byteLength)return S}if(v&&E instanceof Uint8Array||g.isBuffer(E)&&E.constructor&&typeof E.constructor.isBuffer=="function"&&E.constructor.isBuffer(E))return g.from(E);throw new TypeError('The "data" argument must be of type string or an instance of Buffer, TypedArray, or DataView.')}return y.prototype.update=function(E,_){if(this._finalized)throw new Error("Digest already called");E=w(E,_);for(var S=this._block,A=0;this._blockOffset+E.length-A>=this._blockSize;){for(var R=this._blockOffset;R<this._blockSize;)S[R++]=E[A++];this._update(),this._blockOffset=0}for(;A<E.length;)S[this._blockOffset++]=E[A++];for(var x=0,T=E.length*8;T>0;++x)this._length[x]+=T,T=this._length[x]/4294967296|0,T>0&&(this._length[x]-=4294967296*T);return this},y.prototype._update=function(){throw new Error("_update is not implemented")},y.prototype.digest=function(E){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var _=this._digest();E!==void 0&&(_=_.toString(E)),this._block.fill(0),this._blockOffset=0;for(var S=0;S<4;++S)this._length[S]=0;return _},y.prototype._digest=function(){throw new Error("_digest is not implemented")},hashBase$1=y,hashBase$1}var md5_js,hasRequiredMd5_js;function requireMd5_js(){if(hasRequiredMd5_js)return md5_js;hasRequiredMd5_js=1;var g=requireInherits_browser(),u=requireHashBase$1(),h=requireSafeBuffer$1().Buffer,y=new Array(16);function v(){u.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878}g(v,u),v.prototype._update=function(){for(var A=y,R=0;R<16;++R)A[R]=this._block.readInt32LE(R*4);var x=this._a,T=this._b,C=this._c,I=this._d;x=w(x,T,C,I,A[0],3614090360,7),I=w(I,x,T,C,A[1],3905402710,12),C=w(C,I,x,T,A[2],606105819,17),T=w(T,C,I,x,A[3],3250441966,22),x=w(x,T,C,I,A[4],4118548399,7),I=w(I,x,T,C,A[5],1200080426,12),C=w(C,I,x,T,A[6],2821735955,17),T=w(T,C,I,x,A[7],4249261313,22),x=w(x,T,C,I,A[8],1770035416,7),I=w(I,x,T,C,A[9],2336552879,12),C=w(C,I,x,T,A[10],4294925233,17),T=w(T,C,I,x,A[11],2304563134,22),x=w(x,T,C,I,A[12],1804603682,7),I=w(I,x,T,C,A[13],4254626195,12),C=w(C,I,x,T,A[14],2792965006,17),T=w(T,C,I,x,A[15],1236535329,22),x=E(x,T,C,I,A[1],4129170786,5),I=E(I,x,T,C,A[6],3225465664,9),C=E(C,I,x,T,A[11],643717713,14),T=E(T,C,I,x,A[0],3921069994,20),x=E(x,T,C,I,A[5],3593408605,5),I=E(I,x,T,C,A[10],38016083,9),C=E(C,I,x,T,A[15],3634488961,14),T=E(T,C,I,x,A[4],3889429448,20),x=E(x,T,C,I,A[9],568446438,5),I=E(I,x,T,C,A[14],3275163606,9),C=E(C,I,x,T,A[3],4107603335,14),T=E(T,C,I,x,A[8],1163531501,20),x=E(x,T,C,I,A[13],2850285829,5),I=E(I,x,T,C,A[2],4243563512,9),C=E(C,I,x,T,A[7],1735328473,14),T=E(T,C,I,x,A[12],2368359562,20),x=_(x,T,C,I,A[5],4294588738,4),I=_(I,x,T,C,A[8],2272392833,11),C=_(C,I,x,T,A[11],1839030562,16),T=_(T,C,I,x,A[14],4259657740,23),x=_(x,T,C,I,A[1],2763975236,4),I=_(I,x,T,C,A[4],1272893353,11),C=_(C,I,x,T,A[7],4139469664,16),T=_(T,C,I,x,A[10],3200236656,23),x=_(x,T,C,I,A[13],681279174,4),I=_(I,x,T,C,A[0],3936430074,11),C=_(C,I,x,T,A[3],3572445317,16),T=_(T,C,I,x,A[6],76029189,23),x=_(x,T,C,I,A[9],3654602809,4),I=_(I,x,T,C,A[12],3873151461,11),C=_(C,I,x,T,A[15],530742520,16),T=_(T,C,I,x,A[2],3299628645,23),x=S(x,T,C,I,A[0],4096336452,6),I=S(I,x,T,C,A[7],1126891415,10),C=S(C,I,x,T,A[14],2878612391,15),T=S(T,C,I,x,A[5],4237533241,21),x=S(x,T,C,I,A[12],1700485571,6),I=S(I,x,T,C,A[3],2399980690,10),C=S(C,I,x,T,A[10],4293915773,15),T=S(T,C,I,x,A[1],2240044497,21),x=S(x,T,C,I,A[8],1873313359,6),I=S(I,x,T,C,A[15],4264355552,10),C=S(C,I,x,T,A[6],2734768916,15),T=S(T,C,I,x,A[13],1309151649,21),x=S(x,T,C,I,A[4],4149444226,6),I=S(I,x,T,C,A[11],3174756917,10),C=S(C,I,x,T,A[2],718787259,15),T=S(T,C,I,x,A[9],3951481745,21),this._a=this._a+x|0,this._b=this._b+T|0,this._c=this._c+C|0,this._d=this._d+I|0},v.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var A=h.allocUnsafe(16);return A.writeInt32LE(this._a,0),A.writeInt32LE(this._b,4),A.writeInt32LE(this._c,8),A.writeInt32LE(this._d,12),A};function b(A,R){return A<<R|A>>>32-R}function w(A,R,x,T,C,I,L){return b(A+(R&x|~R&T)+C+I|0,L)+R|0}function E(A,R,x,T,C,I,L){return b(A+(R&T|x&~T)+C+I|0,L)+R|0}function _(A,R,x,T,C,I,L){return b(A+(R^x^T)+C+I|0,L)+R|0}function S(A,R,x,T,C,I,L){return b(A+(x^(R|~T))+C+I|0,L)+R|0}return md5_js=v,md5_js}var ripemd160$1,hasRequiredRipemd160$1;function requireRipemd160$1(){if(hasRequiredRipemd160$1)return ripemd160$1;hasRequiredRipemd160$1=1;var g=requireDist$1().Buffer,u=requireInherits_browser(),h=requireHashBase$1(),y=new Array(16),v=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],b=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],w=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],E=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],_=[0,1518500249,1859775393,2400959708,2840853838],S=[1352829926,1548603684,1836072691,2053994217,0];function A(){h.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520}u(A,h),A.prototype._update=function(){for(var $=y,B=0;B<16;++B)$[B]=this._block.readInt32LE(B*4);for(var U=this._a|0,z=this._b|0,ne=this._c|0,ue=this._d|0,he=this._e|0,Y=this._a|0,X=this._b|0,J=this._c|0,j=this._d|0,M=this._e|0,N=0;N<80;N+=1){var P,O;N<16?(P=x(U,z,ne,ue,he,$[v[N]],_[0],w[N]),O=L(Y,X,J,j,M,$[b[N]],S[0],E[N])):N<32?(P=T(U,z,ne,ue,he,$[v[N]],_[1],w[N]),O=I(Y,X,J,j,M,$[b[N]],S[1],E[N])):N<48?(P=C(U,z,ne,ue,he,$[v[N]],_[2],w[N]),O=C(Y,X,J,j,M,$[b[N]],S[2],E[N])):N<64?(P=I(U,z,ne,ue,he,$[v[N]],_[3],w[N]),O=T(Y,X,J,j,M,$[b[N]],S[3],E[N])):(P=L(U,z,ne,ue,he,$[v[N]],_[4],w[N]),O=x(Y,X,J,j,M,$[b[N]],S[4],E[N])),U=he,he=ue,ue=R(ne,10),ne=z,z=P,Y=M,M=j,j=R(J,10),J=X,X=O}var k=this._b+ne+j|0;this._b=this._c+ue+M|0,this._c=this._d+he+Y|0,this._d=this._e+U+X|0,this._e=this._a+z+J|0,this._a=k},A.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var $=g.alloc?g.alloc(20):new g(20);return $.writeInt32LE(this._a,0),$.writeInt32LE(this._b,4),$.writeInt32LE(this._c,8),$.writeInt32LE(this._d,12),$.writeInt32LE(this._e,16),$};function R($,B){return $<<B|$>>>32-B}function x($,B,U,z,ne,ue,he,Y){return R($+(B^U^z)+ue+he|0,Y)+ne|0}function T($,B,U,z,ne,ue,he,Y){return R($+(B&U|~B&z)+ue+he|0,Y)+ne|0}function C($,B,U,z,ne,ue,he,Y){return R($+((B|~U)^z)+ue+he|0,Y)+ne|0}function I($,B,U,z,ne,ue,he,Y){return R($+(B&z|U&~z)+ue+he|0,Y)+ne|0}function L($,B,U,z,ne,ue,he,Y){return R($+(B^(U|~z))+ue+he|0,Y)+ne|0}return ripemd160$1=A,ripemd160$1}var sha_js={exports:{}},isarray$1,hasRequiredIsarray$1;function requireIsarray$1(){if(hasRequiredIsarray$1)return isarray$1;hasRequiredIsarray$1=1;var g={}.toString;return isarray$1=Array.isArray||function(u){return g.call(u)=="[object Array]"},isarray$1}var typedArrayBuffer,hasRequiredTypedArrayBuffer;function requireTypedArrayBuffer(){if(hasRequiredTypedArrayBuffer)return typedArrayBuffer;hasRequiredTypedArrayBuffer=1;var g=requireType(),u=requireCallBound(),h=u("TypedArray.prototype.buffer",!0),y=requireIsTypedArray();return typedArrayBuffer=h||function(b){if(!y(b))throw new g("Not a Typed Array");return b.buffer},typedArrayBuffer}var toBuffer,hasRequiredToBuffer$1;function requireToBuffer$1(){if(hasRequiredToBuffer$1)return toBuffer;hasRequiredToBuffer$1=1;var g=requireSafeBuffer$1().Buffer,u=requireIsarray$1(),h=requireTypedArrayBuffer(),y=ArrayBuffer.isView||function(_){try{return h(_),!0}catch{return!1}},v=typeof Uint8Array<"u",b=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",w=b&&(g.prototype instanceof Uint8Array||g.TYPED_ARRAY_SUPPORT);return toBuffer=function(_,S){if(_ instanceof g)return _;if(typeof _=="string")return g.from(_,S);if(b&&y(_)){if(_.byteLength===0)return g.alloc(0);if(w){var A=g.from(_.buffer,_.byteOffset,_.byteLength);if(A.byteLength===_.byteLength)return A}var R=_ instanceof Uint8Array?_:new Uint8Array(_.buffer,_.byteOffset,_.byteLength),x=g.from(R);if(x.length===_.byteLength)return x}if(v&&_ instanceof Uint8Array)return g.from(_);var T=u(_);if(T)for(var C=0;C<_.length;C+=1){var I=_[C];if(typeof I!="number"||I<0||I>255||~~I!==I)throw new RangeError("Array items must be numbers in the range 0-255.")}if(T||g.isBuffer(_)&&_.constructor&&typeof _.constructor.isBuffer=="function"&&_.constructor.isBuffer(_))return g.from(_);throw new TypeError('The "data" argument must be a string, an Array, a Buffer, a Uint8Array, or a DataView.')},toBuffer}var hash,hasRequiredHash;function requireHash(){if(hasRequiredHash)return hash;hasRequiredHash=1;var g=requireSafeBuffer$1().Buffer,u=requireToBuffer$1();function h(y,v){this._block=g.alloc(y),this._finalSize=v,this._blockSize=y,this._len=0}return h.prototype.update=function(y,v){y=u(y,v||"utf8");for(var b=this._block,w=this._blockSize,E=y.length,_=this._len,S=0;S<E;){for(var A=_%w,R=Math.min(E-S,w-A),x=0;x<R;x++)b[A+x]=y[S+x];_+=R,S+=R,_%w===0&&this._update(b)}return this._len+=E,this},h.prototype.digest=function(y){var v=this._len%this._blockSize;this._block[v]=128,this._block.fill(0,v+1),v>=this._finalSize&&(this._update(this._block),this._block.fill(0));var b=this._len*8;if(b<=4294967295)this._block.writeUInt32BE(b,this._blockSize-4);else{var w=(b&4294967295)>>>0,E=(b-w)/4294967296;this._block.writeUInt32BE(E,this._blockSize-8),this._block.writeUInt32BE(w,this._blockSize-4)}this._update(this._block);var _=this._hash();return y?_.toString(y):_},h.prototype._update=function(){throw new Error("_update must be implemented by subclass")},hash=h,hash}var sha,hasRequiredSha;function requireSha(){if(hasRequiredSha)return sha;hasRequiredSha=1;var g=requireInherits_browser(),u=requireHash(),h=requireSafeBuffer$1().Buffer,y=[1518500249,1859775393,-1894007588,-899497514],v=new Array(80);function b(){this.init(),this._w=v,u.call(this,64,56)}g(b,u),b.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function w(S){return S<<5|S>>>27}function E(S){return S<<30|S>>>2}function _(S,A,R,x){return S===0?A&R|~A&x:S===2?A&R|A&x|R&x:A^R^x}return b.prototype._update=function(S){for(var A=this._w,R=this._a|0,x=this._b|0,T=this._c|0,C=this._d|0,I=this._e|0,L=0;L<16;++L)A[L]=S.readInt32BE(L*4);for(;L<80;++L)A[L]=A[L-3]^A[L-8]^A[L-14]^A[L-16];for(var $=0;$<80;++$){var B=~~($/20),U=w(R)+_(B,x,T,C)+I+A[$]+y[B]|0;I=C,C=T,T=E(x),x=R,R=U}this._a=R+this._a|0,this._b=x+this._b|0,this._c=T+this._c|0,this._d=C+this._d|0,this._e=I+this._e|0},b.prototype._hash=function(){var S=h.allocUnsafe(20);return S.writeInt32BE(this._a|0,0),S.writeInt32BE(this._b|0,4),S.writeInt32BE(this._c|0,8),S.writeInt32BE(this._d|0,12),S.writeInt32BE(this._e|0,16),S},sha=b,sha}var sha1,hasRequiredSha1;function requireSha1(){if(hasRequiredSha1)return sha1;hasRequiredSha1=1;var g=requireInherits_browser(),u=requireHash(),h=requireSafeBuffer$1().Buffer,y=[1518500249,1859775393,-1894007588,-899497514],v=new Array(80);function b(){this.init(),this._w=v,u.call(this,64,56)}g(b,u),b.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function w(A){return A<<1|A>>>31}function E(A){return A<<5|A>>>27}function _(A){return A<<30|A>>>2}function S(A,R,x,T){return A===0?R&x|~R&T:A===2?R&x|R&T|x&T:R^x^T}return b.prototype._update=function(A){for(var R=this._w,x=this._a|0,T=this._b|0,C=this._c|0,I=this._d|0,L=this._e|0,$=0;$<16;++$)R[$]=A.readInt32BE($*4);for(;$<80;++$)R[$]=w(R[$-3]^R[$-8]^R[$-14]^R[$-16]);for(var B=0;B<80;++B){var U=~~(B/20),z=E(x)+S(U,T,C,I)+L+R[B]+y[U]|0;L=I,I=C,C=_(T),T=x,x=z}this._a=x+this._a|0,this._b=T+this._b|0,this._c=C+this._c|0,this._d=I+this._d|0,this._e=L+this._e|0},b.prototype._hash=function(){var A=h.allocUnsafe(20);return A.writeInt32BE(this._a|0,0),A.writeInt32BE(this._b|0,4),A.writeInt32BE(this._c|0,8),A.writeInt32BE(this._d|0,12),A.writeInt32BE(this._e|0,16),A},sha1=b,sha1}var sha256$1,hasRequiredSha256;function requireSha256(){if(hasRequiredSha256)return sha256$1;hasRequiredSha256=1;var g=requireInherits_browser(),u=requireHash(),h=requireSafeBuffer$1().Buffer,y=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],v=new Array(64);function b(){this.init(),this._w=v,u.call(this,64,56)}g(b,u),b.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this};function w(x,T,C){return C^x&(T^C)}function E(x,T,C){return x&T|C&(x|T)}function _(x){return(x>>>2|x<<30)^(x>>>13|x<<19)^(x>>>22|x<<10)}function S(x){return(x>>>6|x<<26)^(x>>>11|x<<21)^(x>>>25|x<<7)}function A(x){return(x>>>7|x<<25)^(x>>>18|x<<14)^x>>>3}function R(x){return(x>>>17|x<<15)^(x>>>19|x<<13)^x>>>10}return b.prototype._update=function(x){for(var T=this._w,C=this._a|0,I=this._b|0,L=this._c|0,$=this._d|0,B=this._e|0,U=this._f|0,z=this._g|0,ne=this._h|0,ue=0;ue<16;++ue)T[ue]=x.readInt32BE(ue*4);for(;ue<64;++ue)T[ue]=R(T[ue-2])+T[ue-7]+A(T[ue-15])+T[ue-16]|0;for(var he=0;he<64;++he){var Y=ne+S(B)+w(B,U,z)+y[he]+T[he]|0,X=_(C)+E(C,I,L)|0;ne=z,z=U,U=B,B=$+Y|0,$=L,L=I,I=C,C=Y+X|0}this._a=C+this._a|0,this._b=I+this._b|0,this._c=L+this._c|0,this._d=$+this._d|0,this._e=B+this._e|0,this._f=U+this._f|0,this._g=z+this._g|0,this._h=ne+this._h|0},b.prototype._hash=function(){var x=h.allocUnsafe(32);return x.writeInt32BE(this._a,0),x.writeInt32BE(this._b,4),x.writeInt32BE(this._c,8),x.writeInt32BE(this._d,12),x.writeInt32BE(this._e,16),x.writeInt32BE(this._f,20),x.writeInt32BE(this._g,24),x.writeInt32BE(this._h,28),x},sha256$1=b,sha256$1}var sha224$1,hasRequiredSha224;function requireSha224(){if(hasRequiredSha224)return sha224$1;hasRequiredSha224=1;var g=requireInherits_browser(),u=requireSha256(),h=requireHash(),y=requireSafeBuffer$1().Buffer,v=new Array(64);function b(){this.init(),this._w=v,h.call(this,64,56)}return g(b,u),b.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},b.prototype._hash=function(){var w=y.allocUnsafe(28);return w.writeInt32BE(this._a,0),w.writeInt32BE(this._b,4),w.writeInt32BE(this._c,8),w.writeInt32BE(this._d,12),w.writeInt32BE(this._e,16),w.writeInt32BE(this._f,20),w.writeInt32BE(this._g,24),w},sha224$1=b,sha224$1}var sha512$2,hasRequiredSha512;function requireSha512(){if(hasRequiredSha512)return sha512$2;hasRequiredSha512=1;var g=requireInherits_browser(),u=requireHash(),h=requireSafeBuffer$1().Buffer,y=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],v=new Array(160);function b(){this.init(),this._w=v,u.call(this,128,112)}g(b,u),b.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this};function w(I,L,$){return $^I&(L^$)}function E(I,L,$){return I&L|$&(I|L)}function _(I,L){return(I>>>28|L<<4)^(L>>>2|I<<30)^(L>>>7|I<<25)}function S(I,L){return(I>>>14|L<<18)^(I>>>18|L<<14)^(L>>>9|I<<23)}function A(I,L){return(I>>>1|L<<31)^(I>>>8|L<<24)^I>>>7}function R(I,L){return(I>>>1|L<<31)^(I>>>8|L<<24)^(I>>>7|L<<25)}function x(I,L){return(I>>>19|L<<13)^(L>>>29|I<<3)^I>>>6}function T(I,L){return(I>>>19|L<<13)^(L>>>29|I<<3)^(I>>>6|L<<26)}function C(I,L){return I>>>0<L>>>0?1:0}return b.prototype._update=function(I){for(var L=this._w,$=this._ah|0,B=this._bh|0,U=this._ch|0,z=this._dh|0,ne=this._eh|0,ue=this._fh|0,he=this._gh|0,Y=this._hh|0,X=this._al|0,J=this._bl|0,j=this._cl|0,M=this._dl|0,N=this._el|0,P=this._fl|0,O=this._gl|0,k=this._hl|0,q=0;q<32;q+=2)L[q]=I.readInt32BE(q*4),L[q+1]=I.readInt32BE(q*4+4);for(;q<160;q+=2){var F=L[q-30],H=L[q-30+1],D=A(F,H),G=R(H,F);F=L[q-4],H=L[q-4+1];var W=x(F,H),K=T(H,F),Z=L[q-14],ae=L[q-14+1],le=L[q-32],te=L[q-32+1],ce=G+ae|0,ge=D+Z+C(ce,G)|0;ce=ce+K|0,ge=ge+W+C(ce,K)|0,ce=ce+te|0,ge=ge+le+C(ce,te)|0,L[q]=ge,L[q+1]=ce}for(var Ee=0;Ee<160;Ee+=2){ge=L[Ee],ce=L[Ee+1];var pe=E($,B,U),de=E(X,J,j),me=_($,X),_e=_(X,$),Ae=S(ne,N),Pe=S(N,ne),Me=y[Ee],Ne=y[Ee+1],we=w(ne,ue,he),Le=w(N,P,O),Oe=k+Pe|0,Ce=Y+Ae+C(Oe,k)|0;Oe=Oe+Le|0,Ce=Ce+we+C(Oe,Le)|0,Oe=Oe+Ne|0,Ce=Ce+Me+C(Oe,Ne)|0,Oe=Oe+ce|0,Ce=Ce+ge+C(Oe,ce)|0;var We=_e+de|0,ze=me+pe+C(We,_e)|0;Y=he,k=O,he=ue,O=P,ue=ne,P=N,N=M+Oe|0,ne=z+Ce+C(N,M)|0,z=U,M=j,U=B,j=J,B=$,J=X,X=Oe+We|0,$=Ce+ze+C(X,Oe)|0}this._al=this._al+X|0,this._bl=this._bl+J|0,this._cl=this._cl+j|0,this._dl=this._dl+M|0,this._el=this._el+N|0,this._fl=this._fl+P|0,this._gl=this._gl+O|0,this._hl=this._hl+k|0,this._ah=this._ah+$+C(this._al,X)|0,this._bh=this._bh+B+C(this._bl,J)|0,this._ch=this._ch+U+C(this._cl,j)|0,this._dh=this._dh+z+C(this._dl,M)|0,this._eh=this._eh+ne+C(this._el,N)|0,this._fh=this._fh+ue+C(this._fl,P)|0,this._gh=this._gh+he+C(this._gl,O)|0,this._hh=this._hh+Y+C(this._hl,k)|0},b.prototype._hash=function(){var I=h.allocUnsafe(64);function L($,B,U){I.writeInt32BE($,U),I.writeInt32BE(B,U+4)}return L(this._ah,this._al,0),L(this._bh,this._bl,8),L(this._ch,this._cl,16),L(this._dh,this._dl,24),L(this._eh,this._el,32),L(this._fh,this._fl,40),L(this._gh,this._gl,48),L(this._hh,this._hl,56),I},sha512$2=b,sha512$2}var sha384$1,hasRequiredSha384;function requireSha384(){if(hasRequiredSha384)return sha384$1;hasRequiredSha384=1;var g=requireInherits_browser(),u=requireSha512(),h=requireHash(),y=requireSafeBuffer$1().Buffer,v=new Array(160);function b(){this.init(),this._w=v,h.call(this,128,112)}return g(b,u),b.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},b.prototype._hash=function(){var w=y.allocUnsafe(48);function E(_,S,A){w.writeInt32BE(_,A),w.writeInt32BE(S,A+4)}return E(this._ah,this._al,0),E(this._bh,this._bl,8),E(this._ch,this._cl,16),E(this._dh,this._dl,24),E(this._eh,this._el,32),E(this._fh,this._fl,40),w},sha384$1=b,sha384$1}var hasRequiredSha_js;function requireSha_js(){return hasRequiredSha_js||(hasRequiredSha_js=1,(function(g){g.exports=function(h){var y=h.toLowerCase(),v=g.exports[y];if(!v)throw new Error(y+" is not supported (we accept pull requests)");return new v},g.exports.sha=requireSha(),g.exports.sha1=requireSha1(),g.exports.sha224=requireSha224(),g.exports.sha256=requireSha256(),g.exports.sha384=requireSha384(),g.exports.sha512=requireSha512()})(sha_js)),sha_js.exports}var cipherBase,hasRequiredCipherBase;function requireCipherBase(){if(hasRequiredCipherBase)return cipherBase;hasRequiredCipherBase=1;var g=requireSafeBuffer$1().Buffer,u=requireStreamBrowserify().Transform,h=requireString_decoder().StringDecoder,y=requireInherits_browser();function v(_){u.call(this),this.hashMode=typeof _=="string",this.hashMode?this[_]=this._finalOrDigest:this.final=this._finalOrDigest,this._final&&(this.__final=this._final,this._final=null),this._decoder=null,this._encoding=null}y(v,u);var b=typeof Uint8Array<"u",w=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&ArrayBuffer.isView&&(g.prototype instanceof Uint8Array||g.TYPED_ARRAY_SUPPORT);function E(_,S){if(_ instanceof g)return _;if(typeof _=="string")return g.from(_,S);if(w&&ArrayBuffer.isView(_)){if(_.byteLength===0)return g.alloc(0);var A=g.from(_.buffer,_.byteOffset,_.byteLength);if(A.byteLength===_.byteLength)return A}if(b&&_ instanceof Uint8Array||g.isBuffer(_)&&_.constructor&&typeof _.constructor.isBuffer=="function"&&_.constructor.isBuffer(_))return g.from(_);throw new TypeError('The "data" argument must be of type string or an instance of Buffer, TypedArray, or DataView.')}return v.prototype.update=function(_,S,A){var R=E(_,S),x=this._update(R);return this.hashMode?this:(A&&(x=this._toString(x,A)),x)},v.prototype.setAutoPadding=function(){},v.prototype.getAuthTag=function(){throw new Error("trying to get auth tag in unsupported state")},v.prototype.setAuthTag=function(){throw new Error("trying to set auth tag in unsupported state")},v.prototype.setAAD=function(){throw new Error("trying to set aad in unsupported state")},v.prototype._transform=function(_,S,A){var R;try{this.hashMode?this._update(_):this.push(this._update(_))}catch(x){R=x}finally{A(R)}},v.prototype._flush=function(_){var S;try{this.push(this.__final())}catch(A){S=A}_(S)},v.prototype._finalOrDigest=function(_){var S=this.__final()||g.alloc(0);return _&&(S=this._toString(S,_,!0)),S},v.prototype._toString=function(_,S,A){if(this._decoder||(this._decoder=new h(S),this._encoding=S),this._encoding!==S)throw new Error("cant switch encodings");var R=this._decoder.write(_);return A&&(R+=this._decoder.end()),R},cipherBase=v,cipherBase}var browser$a,hasRequiredBrowser$a;function requireBrowser$a(){if(hasRequiredBrowser$a)return browser$a;hasRequiredBrowser$a=1;var g=requireInherits_browser(),u=requireMd5_js(),h=requireRipemd160$1(),y=requireSha_js(),v=requireCipherBase();function b(w){v.call(this,"digest"),this._hash=w}return g(b,v),b.prototype._update=function(w){this._hash.update(w)},b.prototype._final=function(){return this._hash.digest()},browser$a=function(E){return E=E.toLowerCase(),E==="md5"?new u:E==="rmd160"||E==="ripemd160"?new h:new b(y(E))},browser$a}var legacy$1,hasRequiredLegacy$1;function requireLegacy$1(){if(hasRequiredLegacy$1)return legacy$1;hasRequiredLegacy$1=1;var g=requireInherits_browser(),u=requireSafeBuffer$1().Buffer,h=requireCipherBase(),y=u.alloc(128),v=64;function b(w,E){h.call(this,"digest"),typeof E=="string"&&(E=u.from(E)),this._alg=w,this._key=E,E.length>v?E=w(E):E.length<v&&(E=u.concat([E,y],v));for(var _=this._ipad=u.allocUnsafe(v),S=this._opad=u.allocUnsafe(v),A=0;A<v;A++)_[A]=E[A]^54,S[A]=E[A]^92;this._hash=[_]}return g(b,h),b.prototype._update=function(w){this._hash.push(w)},b.prototype._final=function(){var w=this._alg(u.concat(this._hash));return this._alg(u.concat([this._opad,w]))},legacy$1=b,legacy$1}var md5$1,hasRequiredMd5$1;function requireMd5$1(){if(hasRequiredMd5$1)return md5$1;hasRequiredMd5$1=1;var g=requireMd5_js();return md5$1=function(u){return new g().update(u).digest()},md5$1}var browser$9,hasRequiredBrowser$9;function requireBrowser$9(){if(hasRequiredBrowser$9)return browser$9;hasRequiredBrowser$9=1;var g=requireInherits_browser(),u=requireLegacy$1(),h=requireCipherBase(),y=requireSafeBuffer$1().Buffer,v=requireMd5$1(),b=requireRipemd160$1(),w=requireSha_js(),E=y.alloc(128);function _(S,A){h.call(this,"digest"),typeof A=="string"&&(A=y.from(A));var R=S==="sha512"||S==="sha384"?128:64;if(this._alg=S,this._key=A,A.length>R){var x=S==="rmd160"?new b:w(S);A=x.update(A).digest()}else A.length<R&&(A=y.concat([A,E],R));for(var T=this._ipad=y.allocUnsafe(R),C=this._opad=y.allocUnsafe(R),I=0;I<R;I++)T[I]=A[I]^54,C[I]=A[I]^92;this._hash=S==="rmd160"?new b:w(S),this._hash.update(T)}return g(_,h),_.prototype._update=function(S){this._hash.update(S)},_.prototype._final=function(){var S=this._hash.digest(),A=this._alg==="rmd160"?new b:w(this._alg);return A.update(this._opad).update(S).digest()},browser$9=function(A,R){return A=A.toLowerCase(),A==="rmd160"||A==="ripemd160"?new _("rmd160",R):A==="md5"?new u(v,R):new _(A,R)},browser$9}const sha224WithRSAEncryption={sign:"rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},sha256WithRSAEncryption={sign:"rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},sha384WithRSAEncryption={sign:"rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},sha512WithRSAEncryption={sign:"rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},sha256={sign:"ecdsa",hash:"sha256",id:""},sha224={sign:"ecdsa",hash:"sha224",id:""},sha384={sign:"ecdsa",hash:"sha384",id:""},sha512$1={sign:"ecdsa",hash:"sha512",id:""},DSA={sign:"dsa",hash:"sha1",id:""},ripemd160WithRSA={sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},md5WithRSAEncryption={sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"},require$$6={sha224WithRSAEncryption,"RSA-SHA224":{sign:"ecdsa/rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},sha256WithRSAEncryption,"RSA-SHA256":{sign:"ecdsa/rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},sha384WithRSAEncryption,"RSA-SHA384":{sign:"ecdsa/rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},sha512WithRSAEncryption,"RSA-SHA512":{sign:"ecdsa/rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},"RSA-SHA1":{sign:"rsa",hash:"sha1",id:"3021300906052b0e03021a05000414"},"ecdsa-with-SHA1":{sign:"ecdsa",hash:"sha1",id:""},sha256,sha224,sha384,sha512:sha512$1,"DSA-SHA":{sign:"dsa",hash:"sha1",id:""},"DSA-SHA1":{sign:"dsa",hash:"sha1",id:""},DSA,"DSA-WITH-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-WITH-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-WITH-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-WITH-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-RIPEMD160":{sign:"dsa",hash:"rmd160",id:""},ripemd160WithRSA,"RSA-RIPEMD160":{sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},md5WithRSAEncryption,"RSA-MD5":{sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"}};var algos,hasRequiredAlgos;function requireAlgos(){return hasRequiredAlgos||(hasRequiredAlgos=1,algos=require$$6),algos}var browser$8={},precondition,hasRequiredPrecondition;function requirePrecondition(){if(hasRequiredPrecondition)return precondition;hasRequiredPrecondition=1;var g=Math.pow(2,30)-1;return precondition=function(u,h){if(typeof u!="number")throw new TypeError("Iterations not a number");if(u<0)throw new TypeError("Bad iterations");if(typeof h!="number")throw new TypeError("Key length not a number");if(h<0||h>g||h!==h)throw new TypeError("Bad key length")},precondition}var defaultEncoding_1,hasRequiredDefaultEncoding;function requireDefaultEncoding(){if(hasRequiredDefaultEncoding)return defaultEncoding_1;hasRequiredDefaultEncoding=1;var g;if(globalThis.process&&globalThis.process.browser)g="utf-8";else if(globalThis.process&&globalThis.process.version){var u=parseInt(process$1.version.split(".")[0].slice(1),10);g=u>=6?"utf-8":"binary"}else g="utf-8";return defaultEncoding_1=g,defaultEncoding_1}var makeHash,hasRequiredMakeHash;function requireMakeHash(){if(hasRequiredMakeHash)return makeHash;hasRequiredMakeHash=1;var g=4,u=new Buffer(g);u.fill(0);var h=8,y=16;function v(b){if(b.length%g!==0){var w=b.length+(g-b.length%g);b=Buffer.concat([b,u],w)}for(var E=new Array(b.length>>>2),_=0,S=0;_<b.length;_+=g,S++)E[S]=b.readInt32LE(_);return E}return makeHash=function(w,E){var _=E(v(w),w.length*h);w=new Buffer(y);for(var S=0;S<_.length;S++)w.writeInt32LE(_[S],S<<2,!0);return w},makeHash}var md5,hasRequiredMd5;function requireMd5(){if(hasRequiredMd5)return md5;hasRequiredMd5=1;var g=requireMakeHash();function u(S,A){S[A>>5]|=128<<A%32,S[(A+64>>>9<<4)+14]=A;for(var R=1732584193,x=-271733879,T=-1732584194,C=271733878,I=0;I<S.length;I+=16){var L=R,$=x,B=T,U=C;R=y(R,x,T,C,S[I+0],7,-680876936),C=y(C,R,x,T,S[I+1],12,-389564586),T=y(T,C,R,x,S[I+2],17,606105819),x=y(x,T,C,R,S[I+3],22,-1044525330),R=y(R,x,T,C,S[I+4],7,-176418897),C=y(C,R,x,T,S[I+5],12,1200080426),T=y(T,C,R,x,S[I+6],17,-1473231341),x=y(x,T,C,R,S[I+7],22,-45705983),R=y(R,x,T,C,S[I+8],7,1770035416),C=y(C,R,x,T,S[I+9],12,-1958414417),T=y(T,C,R,x,S[I+10],17,-42063),x=y(x,T,C,R,S[I+11],22,-1990404162),R=y(R,x,T,C,S[I+12],7,1804603682),C=y(C,R,x,T,S[I+13],12,-40341101),T=y(T,C,R,x,S[I+14],17,-1502002290),x=y(x,T,C,R,S[I+15],22,1236535329),R=v(R,x,T,C,S[I+1],5,-165796510),C=v(C,R,x,T,S[I+6],9,-1069501632),T=v(T,C,R,x,S[I+11],14,643717713),x=v(x,T,C,R,S[I+0],20,-373897302),R=v(R,x,T,C,S[I+5],5,-701558691),C=v(C,R,x,T,S[I+10],9,38016083),T=v(T,C,R,x,S[I+15],14,-660478335),x=v(x,T,C,R,S[I+4],20,-405537848),R=v(R,x,T,C,S[I+9],5,568446438),C=v(C,R,x,T,S[I+14],9,-1019803690),T=v(T,C,R,x,S[I+3],14,-187363961),x=v(x,T,C,R,S[I+8],20,1163531501),R=v(R,x,T,C,S[I+13],5,-1444681467),C=v(C,R,x,T,S[I+2],9,-51403784),T=v(T,C,R,x,S[I+7],14,1735328473),x=v(x,T,C,R,S[I+12],20,-1926607734),R=b(R,x,T,C,S[I+5],4,-378558),C=b(C,R,x,T,S[I+8],11,-2022574463),T=b(T,C,R,x,S[I+11],16,1839030562),x=b(x,T,C,R,S[I+14],23,-35309556),R=b(R,x,T,C,S[I+1],4,-1530992060),C=b(C,R,x,T,S[I+4],11,1272893353),T=b(T,C,R,x,S[I+7],16,-155497632),x=b(x,T,C,R,S[I+10],23,-1094730640),R=b(R,x,T,C,S[I+13],4,681279174),C=b(C,R,x,T,S[I+0],11,-358537222),T=b(T,C,R,x,S[I+3],16,-722521979),x=b(x,T,C,R,S[I+6],23,76029189),R=b(R,x,T,C,S[I+9],4,-640364487),C=b(C,R,x,T,S[I+12],11,-421815835),T=b(T,C,R,x,S[I+15],16,530742520),x=b(x,T,C,R,S[I+2],23,-995338651),R=w(R,x,T,C,S[I+0],6,-198630844),C=w(C,R,x,T,S[I+7],10,1126891415),T=w(T,C,R,x,S[I+14],15,-1416354905),x=w(x,T,C,R,S[I+5],21,-57434055),R=w(R,x,T,C,S[I+12],6,1700485571),C=w(C,R,x,T,S[I+3],10,-1894986606),T=w(T,C,R,x,S[I+10],15,-1051523),x=w(x,T,C,R,S[I+1],21,-2054922799),R=w(R,x,T,C,S[I+8],6,1873313359),C=w(C,R,x,T,S[I+15],10,-30611744),T=w(T,C,R,x,S[I+6],15,-1560198380),x=w(x,T,C,R,S[I+13],21,1309151649),R=w(R,x,T,C,S[I+4],6,-145523070),C=w(C,R,x,T,S[I+11],10,-1120210379),T=w(T,C,R,x,S[I+2],15,718787259),x=w(x,T,C,R,S[I+9],21,-343485551),R=E(R,L),x=E(x,$),T=E(T,B),C=E(C,U)}return[R,x,T,C]}function h(S,A,R,x,T,C){return E(_(E(E(A,S),E(x,C)),T),R)}function y(S,A,R,x,T,C,I){return h(A&R|~A&x,S,A,T,C,I)}function v(S,A,R,x,T,C,I){return h(A&x|R&~x,S,A,T,C,I)}function b(S,A,R,x,T,C,I){return h(A^R^x,S,A,T,C,I)}function w(S,A,R,x,T,C,I){return h(R^(A|~x),S,A,T,C,I)}function E(S,A){var R=(S&65535)+(A&65535),x=(S>>16)+(A>>16)+(R>>16);return x<<16|R&65535}function _(S,A){return S<<A|S>>>32-A}return md5=function(A){return g(A,u)},md5}var hashBase,hasRequiredHashBase;function requireHashBase(){if(hasRequiredHashBase)return hashBase;hasRequiredHashBase=1;var g=requireStreamBrowserify().Transform,u=requireInherits_browser();function h(y){g.call(this),this._block=new Buffer(y),this._blockSize=y,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}return u(h,g),h.prototype._transform=function(y,v,b){var w=null;try{v!=="buffer"&&(y=new Buffer(y,v)),this.update(y)}catch(E){w=E}b(w)},h.prototype._flush=function(y){var v=null;try{this.push(this._digest())}catch(b){v=b}y(v)},h.prototype.update=function(y,v){if(!Buffer.isBuffer(y)&&typeof y!="string")throw new TypeError("Data must be a string or a buffer");if(this._finalized)throw new Error("Digest already called");Buffer.isBuffer(y)||(y=new Buffer(y,v||"binary"));for(var b=this._block,w=0;this._blockOffset+y.length-w>=this._blockSize;){for(var E=this._blockOffset;E<this._blockSize;)b[E++]=y[w++];this._update(),this._blockOffset=0}for(;w<y.length;)b[this._blockOffset++]=y[w++];for(var _=0,S=y.length*8;S>0;++_)this._length[_]+=S,S=this._length[_]/4294967296|0,S>0&&(this._length[_]-=4294967296*S);return this},h.prototype._update=function(y){throw new Error("_update is not implemented")},h.prototype.digest=function(y){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var v=this._digest();return y!==void 0&&(v=v.toString(y)),v},h.prototype._digest=function(){throw new Error("_digest is not implemented")},hashBase=h,hashBase}var ripemd160,hasRequiredRipemd160;function requireRipemd160(){if(hasRequiredRipemd160)return ripemd160;hasRequiredRipemd160=1;var g=requireInherits_browser(),u=requireHashBase();function h(){u.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520}g(h,u),h.prototype._update=function(){for(var S=new Array(16),A=0;A<16;++A)S[A]=this._block.readInt32LE(A*4);var R=this._a,x=this._b,T=this._c,C=this._d,I=this._e;R=v(R,x,T,C,I,S[0],0,11),T=y(T,10),I=v(I,R,x,T,C,S[1],0,14),x=y(x,10),C=v(C,I,R,x,T,S[2],0,15),R=y(R,10),T=v(T,C,I,R,x,S[3],0,12),I=y(I,10),x=v(x,T,C,I,R,S[4],0,5),C=y(C,10),R=v(R,x,T,C,I,S[5],0,8),T=y(T,10),I=v(I,R,x,T,C,S[6],0,7),x=y(x,10),C=v(C,I,R,x,T,S[7],0,9),R=y(R,10),T=v(T,C,I,R,x,S[8],0,11),I=y(I,10),x=v(x,T,C,I,R,S[9],0,13),C=y(C,10),R=v(R,x,T,C,I,S[10],0,14),T=y(T,10),I=v(I,R,x,T,C,S[11],0,15),x=y(x,10),C=v(C,I,R,x,T,S[12],0,6),R=y(R,10),T=v(T,C,I,R,x,S[13],0,7),I=y(I,10),x=v(x,T,C,I,R,S[14],0,9),C=y(C,10),R=v(R,x,T,C,I,S[15],0,8),T=y(T,10),I=b(I,R,x,T,C,S[7],1518500249,7),x=y(x,10),C=b(C,I,R,x,T,S[4],1518500249,6),R=y(R,10),T=b(T,C,I,R,x,S[13],1518500249,8),I=y(I,10),x=b(x,T,C,I,R,S[1],1518500249,13),C=y(C,10),R=b(R,x,T,C,I,S[10],1518500249,11),T=y(T,10),I=b(I,R,x,T,C,S[6],1518500249,9),x=y(x,10),C=b(C,I,R,x,T,S[15],1518500249,7),R=y(R,10),T=b(T,C,I,R,x,S[3],1518500249,15),I=y(I,10),x=b(x,T,C,I,R,S[12],1518500249,7),C=y(C,10),R=b(R,x,T,C,I,S[0],1518500249,12),T=y(T,10),I=b(I,R,x,T,C,S[9],1518500249,15),x=y(x,10),C=b(C,I,R,x,T,S[5],1518500249,9),R=y(R,10),T=b(T,C,I,R,x,S[2],1518500249,11),I=y(I,10),x=b(x,T,C,I,R,S[14],1518500249,7),C=y(C,10),R=b(R,x,T,C,I,S[11],1518500249,13),T=y(T,10),I=b(I,R,x,T,C,S[8],1518500249,12),x=y(x,10),C=w(C,I,R,x,T,S[3],1859775393,11),R=y(R,10),T=w(T,C,I,R,x,S[10],1859775393,13),I=y(I,10),x=w(x,T,C,I,R,S[14],1859775393,6),C=y(C,10),R=w(R,x,T,C,I,S[4],1859775393,7),T=y(T,10),I=w(I,R,x,T,C,S[9],1859775393,14),x=y(x,10),C=w(C,I,R,x,T,S[15],1859775393,9),R=y(R,10),T=w(T,C,I,R,x,S[8],1859775393,13),I=y(I,10),x=w(x,T,C,I,R,S[1],1859775393,15),C=y(C,10),R=w(R,x,T,C,I,S[2],1859775393,14),T=y(T,10),I=w(I,R,x,T,C,S[7],1859775393,8),x=y(x,10),C=w(C,I,R,x,T,S[0],1859775393,13),R=y(R,10),T=w(T,C,I,R,x,S[6],1859775393,6),I=y(I,10),x=w(x,T,C,I,R,S[13],1859775393,5),C=y(C,10),R=w(R,x,T,C,I,S[11],1859775393,12),T=y(T,10),I=w(I,R,x,T,C,S[5],1859775393,7),x=y(x,10),C=w(C,I,R,x,T,S[12],1859775393,5),R=y(R,10),T=E(T,C,I,R,x,S[1],2400959708,11),I=y(I,10),x=E(x,T,C,I,R,S[9],2400959708,12),C=y(C,10),R=E(R,x,T,C,I,S[11],2400959708,14),T=y(T,10),I=E(I,R,x,T,C,S[10],2400959708,15),x=y(x,10),C=E(C,I,R,x,T,S[0],2400959708,14),R=y(R,10),T=E(T,C,I,R,x,S[8],2400959708,15),I=y(I,10),x=E(x,T,C,I,R,S[12],2400959708,9),C=y(C,10),R=E(R,x,T,C,I,S[4],2400959708,8),T=y(T,10),I=E(I,R,x,T,C,S[13],2400959708,9),x=y(x,10),C=E(C,I,R,x,T,S[3],2400959708,14),R=y(R,10),T=E(T,C,I,R,x,S[7],2400959708,5),I=y(I,10),x=E(x,T,C,I,R,S[15],2400959708,6),C=y(C,10),R=E(R,x,T,C,I,S[14],2400959708,8),T=y(T,10),I=E(I,R,x,T,C,S[5],2400959708,6),x=y(x,10),C=E(C,I,R,x,T,S[6],2400959708,5),R=y(R,10),T=E(T,C,I,R,x,S[2],2400959708,12),I=y(I,10),x=_(x,T,C,I,R,S[4],2840853838,9),C=y(C,10),R=_(R,x,T,C,I,S[0],2840853838,15),T=y(T,10),I=_(I,R,x,T,C,S[5],2840853838,5),x=y(x,10),C=_(C,I,R,x,T,S[9],2840853838,11),R=y(R,10),T=_(T,C,I,R,x,S[7],2840853838,6),I=y(I,10),x=_(x,T,C,I,R,S[12],2840853838,8),C=y(C,10),R=_(R,x,T,C,I,S[2],2840853838,13),T=y(T,10),I=_(I,R,x,T,C,S[10],2840853838,12),x=y(x,10),C=_(C,I,R,x,T,S[14],2840853838,5),R=y(R,10),T=_(T,C,I,R,x,S[1],2840853838,12),I=y(I,10),x=_(x,T,C,I,R,S[3],2840853838,13),C=y(C,10),R=_(R,x,T,C,I,S[8],2840853838,14),T=y(T,10),I=_(I,R,x,T,C,S[11],2840853838,11),x=y(x,10),C=_(C,I,R,x,T,S[6],2840853838,8),R=y(R,10),T=_(T,C,I,R,x,S[15],2840853838,5),I=y(I,10),x=_(x,T,C,I,R,S[13],2840853838,6),C=y(C,10);var L=this._a,$=this._b,B=this._c,U=this._d,z=this._e;L=_(L,$,B,U,z,S[5],1352829926,8),B=y(B,10),z=_(z,L,$,B,U,S[14],1352829926,9),$=y($,10),U=_(U,z,L,$,B,S[7],1352829926,9),L=y(L,10),B=_(B,U,z,L,$,S[0],1352829926,11),z=y(z,10),$=_($,B,U,z,L,S[9],1352829926,13),U=y(U,10),L=_(L,$,B,U,z,S[2],1352829926,15),B=y(B,10),z=_(z,L,$,B,U,S[11],1352829926,15),$=y($,10),U=_(U,z,L,$,B,S[4],1352829926,5),L=y(L,10),B=_(B,U,z,L,$,S[13],1352829926,7),z=y(z,10),$=_($,B,U,z,L,S[6],1352829926,7),U=y(U,10),L=_(L,$,B,U,z,S[15],1352829926,8),B=y(B,10),z=_(z,L,$,B,U,S[8],1352829926,11),$=y($,10),U=_(U,z,L,$,B,S[1],1352829926,14),L=y(L,10),B=_(B,U,z,L,$,S[10],1352829926,14),z=y(z,10),$=_($,B,U,z,L,S[3],1352829926,12),U=y(U,10),L=_(L,$,B,U,z,S[12],1352829926,6),B=y(B,10),z=E(z,L,$,B,U,S[6],1548603684,9),$=y($,10),U=E(U,z,L,$,B,S[11],1548603684,13),L=y(L,10),B=E(B,U,z,L,$,S[3],1548603684,15),z=y(z,10),$=E($,B,U,z,L,S[7],1548603684,7),U=y(U,10),L=E(L,$,B,U,z,S[0],1548603684,12),B=y(B,10),z=E(z,L,$,B,U,S[13],1548603684,8),$=y($,10),U=E(U,z,L,$,B,S[5],1548603684,9),L=y(L,10),B=E(B,U,z,L,$,S[10],1548603684,11),z=y(z,10),$=E($,B,U,z,L,S[14],1548603684,7),U=y(U,10),L=E(L,$,B,U,z,S[15],1548603684,7),B=y(B,10),z=E(z,L,$,B,U,S[8],1548603684,12),$=y($,10),U=E(U,z,L,$,B,S[12],1548603684,7),L=y(L,10),B=E(B,U,z,L,$,S[4],1548603684,6),z=y(z,10),$=E($,B,U,z,L,S[9],1548603684,15),U=y(U,10),L=E(L,$,B,U,z,S[1],1548603684,13),B=y(B,10),z=E(z,L,$,B,U,S[2],1548603684,11),$=y($,10),U=w(U,z,L,$,B,S[15],1836072691,9),L=y(L,10),B=w(B,U,z,L,$,S[5],1836072691,7),z=y(z,10),$=w($,B,U,z,L,S[1],1836072691,15),U=y(U,10),L=w(L,$,B,U,z,S[3],1836072691,11),B=y(B,10),z=w(z,L,$,B,U,S[7],1836072691,8),$=y($,10),U=w(U,z,L,$,B,S[14],1836072691,6),L=y(L,10),B=w(B,U,z,L,$,S[6],1836072691,6),z=y(z,10),$=w($,B,U,z,L,S[9],1836072691,14),U=y(U,10),L=w(L,$,B,U,z,S[11],1836072691,12),B=y(B,10),z=w(z,L,$,B,U,S[8],1836072691,13),$=y($,10),U=w(U,z,L,$,B,S[12],1836072691,5),L=y(L,10),B=w(B,U,z,L,$,S[2],1836072691,14),z=y(z,10),$=w($,B,U,z,L,S[10],1836072691,13),U=y(U,10),L=w(L,$,B,U,z,S[0],1836072691,13),B=y(B,10),z=w(z,L,$,B,U,S[4],1836072691,7),$=y($,10),U=w(U,z,L,$,B,S[13],1836072691,5),L=y(L,10),B=b(B,U,z,L,$,S[8],2053994217,15),z=y(z,10),$=b($,B,U,z,L,S[6],2053994217,5),U=y(U,10),L=b(L,$,B,U,z,S[4],2053994217,8),B=y(B,10),z=b(z,L,$,B,U,S[1],2053994217,11),$=y($,10),U=b(U,z,L,$,B,S[3],2053994217,14),L=y(L,10),B=b(B,U,z,L,$,S[11],2053994217,14),z=y(z,10),$=b($,B,U,z,L,S[15],2053994217,6),U=y(U,10),L=b(L,$,B,U,z,S[0],2053994217,14),B=y(B,10),z=b(z,L,$,B,U,S[5],2053994217,6),$=y($,10),U=b(U,z,L,$,B,S[12],2053994217,9),L=y(L,10),B=b(B,U,z,L,$,S[2],2053994217,12),z=y(z,10),$=b($,B,U,z,L,S[13],2053994217,9),U=y(U,10),L=b(L,$,B,U,z,S[9],2053994217,12),B=y(B,10),z=b(z,L,$,B,U,S[7],2053994217,5),$=y($,10),U=b(U,z,L,$,B,S[10],2053994217,15),L=y(L,10),B=b(B,U,z,L,$,S[14],2053994217,8),z=y(z,10),$=v($,B,U,z,L,S[12],0,8),U=y(U,10),L=v(L,$,B,U,z,S[15],0,5),B=y(B,10),z=v(z,L,$,B,U,S[10],0,12),$=y($,10),U=v(U,z,L,$,B,S[4],0,9),L=y(L,10),B=v(B,U,z,L,$,S[1],0,12),z=y(z,10),$=v($,B,U,z,L,S[5],0,5),U=y(U,10),L=v(L,$,B,U,z,S[8],0,14),B=y(B,10),z=v(z,L,$,B,U,S[7],0,6),$=y($,10),U=v(U,z,L,$,B,S[6],0,8),L=y(L,10),B=v(B,U,z,L,$,S[2],0,13),z=y(z,10),$=v($,B,U,z,L,S[13],0,6),U=y(U,10),L=v(L,$,B,U,z,S[14],0,5),B=y(B,10),z=v(z,L,$,B,U,S[0],0,15),$=y($,10),U=v(U,z,L,$,B,S[3],0,13),L=y(L,10),B=v(B,U,z,L,$,S[9],0,11),z=y(z,10),$=v($,B,U,z,L,S[11],0,11),U=y(U,10);var ne=this._b+T+U|0;this._b=this._c+C+z|0,this._c=this._d+I+L|0,this._d=this._e+R+$|0,this._e=this._a+x+B|0,this._a=ne},h.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var S=new Buffer(20);return S.writeInt32LE(this._a,0),S.writeInt32LE(this._b,4),S.writeInt32LE(this._c,8),S.writeInt32LE(this._d,12),S.writeInt32LE(this._e,16),S};function y(S,A){return S<<A|S>>>32-A}function v(S,A,R,x,T,C,I,L){return y(S+(A^R^x)+C+I|0,L)+T|0}function b(S,A,R,x,T,C,I,L){return y(S+(A&R|~A&x)+C+I|0,L)+T|0}function w(S,A,R,x,T,C,I,L){return y(S+((A|~R)^x)+C+I|0,L)+T|0}function E(S,A,R,x,T,C,I,L){return y(S+(A&x|R&~x)+C+I|0,L)+T|0}function _(S,A,R,x,T,C,I,L){return y(S+(A^(R|~x))+C+I|0,L)+T|0}return ripemd160=h,ripemd160}var toBuffer_1,hasRequiredToBuffer;function requireToBuffer(){if(hasRequiredToBuffer)return toBuffer_1;hasRequiredToBuffer=1;var g=requireSafeBuffer$1().Buffer,u=requireToBuffer$1(),h=typeof Uint8Array<"u",y=h&&typeof ArrayBuffer<"u",v=y&&ArrayBuffer.isView;return toBuffer_1=function(b,w,E){if(typeof b=="string"||g.isBuffer(b)||h&&b instanceof Uint8Array||v&&v(b))return u(b,w);throw new TypeError(E+" must be a string, a Buffer, a Uint8Array, or a DataView")},toBuffer_1}var syncBrowser,hasRequiredSyncBrowser;function requireSyncBrowser(){if(hasRequiredSyncBrowser)return syncBrowser;hasRequiredSyncBrowser=1;var g=requireMd5(),u=requireRipemd160(),h=requireSha_js(),y=requireSafeBuffer$1().Buffer,v=requirePrecondition(),b=requireDefaultEncoding(),w=requireToBuffer(),E=y.alloc(128),_={__proto__:null,md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,"sha512-256":32,ripemd160:20,rmd160:20},S={__proto__:null,"sha-1":"sha1","sha-224":"sha224","sha-256":"sha256","sha-384":"sha384","sha-512":"sha512","ripemd-160":"ripemd160"};function A(C){return new u().update(C).digest()}function R(C){function I(L){return h(C).update(L).digest()}return C==="rmd160"||C==="ripemd160"?A:C==="md5"?g:I}function x(C,I,L){var $=R(C),B=C==="sha512"||C==="sha384"?128:64;I.length>B?I=$(I):I.length<B&&(I=y.concat([I,E],B));for(var U=y.allocUnsafe(B+_[C]),z=y.allocUnsafe(B+_[C]),ne=0;ne<B;ne++)U[ne]=I[ne]^54,z[ne]=I[ne]^92;var ue=y.allocUnsafe(B+L+4);U.copy(ue,0,0,B),this.ipad1=ue,this.ipad2=U,this.opad=z,this.alg=C,this.blocksize=B,this.hash=$,this.size=_[C]}x.prototype.run=function(C,I){C.copy(I,this.blocksize);var L=this.hash(I);return L.copy(this.opad,this.blocksize),this.hash(this.opad)};function T(C,I,L,$,B){v(L,$),C=w(C,b,"Password"),I=w(I,b,"Salt");var U=(B||"sha1").toLowerCase(),z=S[U]||U,ne=_[z];if(typeof ne!="number"||!ne)throw new TypeError("Digest algorithm not supported: "+B);var ue=new x(z,C,I.length),he=y.allocUnsafe($),Y=y.allocUnsafe(I.length+4);I.copy(Y,0,0,I.length);for(var X=0,J=ne,j=Math.ceil($/J),M=1;M<=j;M++){Y.writeUInt32BE(M,I.length);for(var N=ue.run(Y,ue.ipad1),P=N,O=1;O<L;O++){P=ue.run(P,ue.ipad2);for(var k=0;k<J;k++)N[k]^=P[k]}N.copy(he,X),X+=J}return he}return syncBrowser=T,syncBrowser}var async,hasRequiredAsync;function requireAsync(){if(hasRequiredAsync)return async;hasRequiredAsync=1;var g=requireSafeBuffer$1().Buffer,u=requirePrecondition(),h=requireDefaultEncoding(),y=requireSyncBrowser(),v=requireToBuffer(),b,w=globalThis.crypto&&globalThis.crypto.subtle,E={sha:"SHA-1","sha-1":"SHA-1",sha1:"SHA-1",sha256:"SHA-256","sha-256":"SHA-256",sha384:"SHA-384","sha-384":"SHA-384","sha-512":"SHA-512",sha512:"SHA-512"},_=[],S;function A(){return S||(globalThis.process&&globalThis.process.nextTick?S=globalThis.process.nextTick:globalThis.queueMicrotask?S=globalThis.queueMicrotask:globalThis.setImmediate?S=globalThis.setImmediate:S=globalThis.setTimeout,S)}function R(C,I,L,$,B){return w.importKey("raw",C,{name:"PBKDF2"},!1,["deriveBits"]).then(function(U){return w.deriveBits({name:"PBKDF2",salt:I,iterations:L,hash:{name:B}},U,$<<3)}).then(function(U){return g.from(U)})}function x(C){if(globalThis.process&&!globalThis.process.browser||!w||!w.importKey||!w.deriveBits)return Promise.resolve(!1);if(_[C]!==void 0)return _[C];b=b||g.alloc(8);var I=R(b,b,10,128,C).then(function(){return!0},function(){return!1});return _[C]=I,I}function T(C,I){C.then(function(L){A()(function(){I(null,L)})},function(L){A()(function(){I(L)})})}return async=function(C,I,L,$,B,U){typeof B=="function"&&(U=B,B=void 0),B=B||"sha1";var z=E[B.toLowerCase()];if(!z||typeof globalThis.Promise!="function"){A()(function(){var ne;try{ne=y(C,I,L,$,B)}catch(ue){U(ue);return}U(null,ne)});return}if(u(L,$),C=v(C,h,"Password"),I=v(I,h,"Salt"),typeof U!="function")throw new Error("No callback provided to pbkdf2");T(x(z).then(function(ne){return ne?R(C,I,L,$,z):y(C,I,L,$,B)}),U)},async}var hasRequiredBrowser$8;function requireBrowser$8(){return hasRequiredBrowser$8||(hasRequiredBrowser$8=1,browser$8.pbkdf2=requireAsync(),browser$8.pbkdf2Sync=requireSyncBrowser()),browser$8}var browser$7={},des$1={},utils$1={},hasRequiredUtils$1;function requireUtils$1(){if(hasRequiredUtils$1)return utils$1;hasRequiredUtils$1=1,utils$1.readUInt32BE=function(v,b){var w=v[0+b]<<24|v[1+b]<<16|v[2+b]<<8|v[3+b];return w>>>0},utils$1.writeUInt32BE=function(v,b,w){v[0+w]=b>>>24,v[1+w]=b>>>16&255,v[2+w]=b>>>8&255,v[3+w]=b&255},utils$1.ip=function(v,b,w,E){for(var _=0,S=0,A=6;A>=0;A-=2){for(var R=0;R<=24;R+=8)_<<=1,_|=b>>>R+A&1;for(var R=0;R<=24;R+=8)_<<=1,_|=v>>>R+A&1}for(var A=6;A>=0;A-=2){for(var R=1;R<=25;R+=8)S<<=1,S|=b>>>R+A&1;for(var R=1;R<=25;R+=8)S<<=1,S|=v>>>R+A&1}w[E+0]=_>>>0,w[E+1]=S>>>0},utils$1.rip=function(v,b,w,E){for(var _=0,S=0,A=0;A<4;A++)for(var R=24;R>=0;R-=8)_<<=1,_|=b>>>R+A&1,_<<=1,_|=v>>>R+A&1;for(var A=4;A<8;A++)for(var R=24;R>=0;R-=8)S<<=1,S|=b>>>R+A&1,S<<=1,S|=v>>>R+A&1;w[E+0]=_>>>0,w[E+1]=S>>>0},utils$1.pc1=function(v,b,w,E){for(var _=0,S=0,A=7;A>=5;A--){for(var R=0;R<=24;R+=8)_<<=1,_|=b>>R+A&1;for(var R=0;R<=24;R+=8)_<<=1,_|=v>>R+A&1}for(var R=0;R<=24;R+=8)_<<=1,_|=b>>R+A&1;for(var A=1;A<=3;A++){for(var R=0;R<=24;R+=8)S<<=1,S|=b>>R+A&1;for(var R=0;R<=24;R+=8)S<<=1,S|=v>>R+A&1}for(var R=0;R<=24;R+=8)S<<=1,S|=v>>R+A&1;w[E+0]=_>>>0,w[E+1]=S>>>0},utils$1.r28shl=function(v,b){return v<<b&268435455|v>>>28-b};var g=[14,11,17,4,27,23,25,0,13,22,7,18,5,9,16,24,2,20,12,21,1,8,15,26,15,4,25,19,9,1,26,16,5,11,23,8,12,7,17,0,22,3,10,14,6,20,27,24];utils$1.pc2=function(v,b,w,E){for(var _=0,S=0,A=g.length>>>1,R=0;R<A;R++)_<<=1,_|=v>>>g[R]&1;for(var R=A;R<g.length;R++)S<<=1,S|=b>>>g[R]&1;w[E+0]=_>>>0,w[E+1]=S>>>0},utils$1.expand=function(v,b,w){var E=0,_=0;E=(v&1)<<5|v>>>27;for(var S=23;S>=15;S-=4)E<<=6,E|=v>>>S&63;for(var S=11;S>=3;S-=4)_|=v>>>S&63,_<<=6;_|=(v&31)<<1|v>>>31,b[w+0]=E>>>0,b[w+1]=_>>>0};var u=[14,0,4,15,13,7,1,4,2,14,15,2,11,13,8,1,3,10,10,6,6,12,12,11,5,9,9,5,0,3,7,8,4,15,1,12,14,8,8,2,13,4,6,9,2,1,11,7,15,5,12,11,9,3,7,14,3,10,10,0,5,6,0,13,15,3,1,13,8,4,14,7,6,15,11,2,3,8,4,14,9,12,7,0,2,1,13,10,12,6,0,9,5,11,10,5,0,13,14,8,7,10,11,1,10,3,4,15,13,4,1,2,5,11,8,6,12,7,6,12,9,0,3,5,2,14,15,9,10,13,0,7,9,0,14,9,6,3,3,4,15,6,5,10,1,2,13,8,12,5,7,14,11,12,4,11,2,15,8,1,13,1,6,10,4,13,9,0,8,6,15,9,3,8,0,7,11,4,1,15,2,14,12,3,5,11,10,5,14,2,7,12,7,13,13,8,14,11,3,5,0,6,6,15,9,0,10,3,1,4,2,7,8,2,5,12,11,1,12,10,4,14,15,9,10,3,6,15,9,0,0,6,12,10,11,1,7,13,13,8,15,9,1,4,3,5,14,11,5,12,2,7,8,2,4,14,2,14,12,11,4,2,1,12,7,4,10,7,11,13,6,1,8,5,5,0,3,15,15,10,13,3,0,9,14,8,9,6,4,11,2,8,1,12,11,7,10,1,13,14,7,2,8,13,15,6,9,15,12,0,5,9,6,10,3,4,0,5,14,3,12,10,1,15,10,4,15,2,9,7,2,12,6,9,8,5,0,6,13,1,3,13,4,14,14,0,7,11,5,3,11,8,9,4,14,3,15,2,5,12,2,9,8,5,12,15,3,10,7,11,0,14,4,1,10,7,1,6,13,0,11,8,6,13,4,13,11,0,2,11,14,7,15,4,0,9,8,1,13,10,3,14,12,3,9,5,7,12,5,2,10,15,6,8,1,6,1,6,4,11,11,13,13,8,12,1,3,4,7,10,14,7,10,9,15,5,6,0,8,15,0,14,5,2,9,3,2,12,13,1,2,15,8,13,4,8,6,10,15,3,11,7,1,4,10,12,9,5,3,6,14,11,5,0,0,14,12,9,7,2,7,2,11,1,4,14,1,7,9,4,12,10,14,8,2,13,0,15,6,12,10,9,13,0,15,3,3,5,5,6,8,11];utils$1.substitute=function(v,b){for(var w=0,E=0;E<4;E++){var _=v>>>18-E*6&63,S=u[E*64+_];w<<=4,w|=S}for(var E=0;E<4;E++){var _=b>>>18-E*6&63,S=u[256+E*64+_];w<<=4,w|=S}return w>>>0};var h=[16,25,12,11,3,20,4,15,31,17,9,6,27,14,1,22,30,24,8,18,0,5,29,23,13,19,2,26,10,21,28,7];return utils$1.permute=function(v){for(var b=0,w=0;w<h.length;w++)b<<=1,b|=v>>>h[w]&1;return b>>>0},utils$1.padSplit=function(v,b,w){for(var E=v.toString(2);E.length<b;)E="0"+E;for(var _=[],S=0;S<b;S+=w)_.push(E.slice(S,S+w));return _.join(" ")},utils$1}var cipher,hasRequiredCipher;function requireCipher(){if(hasRequiredCipher)return cipher;hasRequiredCipher=1;var g=requireMinimalisticAssert();function u(h){this.options=h,this.type=this.options.type,this.blockSize=8,this._init(),this.buffer=new Array(this.blockSize),this.bufferOff=0,this.padding=h.padding!==!1}return cipher=u,u.prototype._init=function(){},u.prototype.update=function(y){return y.length===0?[]:this.type==="decrypt"?this._updateDecrypt(y):this._updateEncrypt(y)},u.prototype._buffer=function(y,v){for(var b=Math.min(this.buffer.length-this.bufferOff,y.length-v),w=0;w<b;w++)this.buffer[this.bufferOff+w]=y[v+w];return this.bufferOff+=b,b},u.prototype._flushBuffer=function(y,v){return this._update(this.buffer,0,y,v),this.bufferOff=0,this.blockSize},u.prototype._updateEncrypt=function(y){var v=0,b=0,w=(this.bufferOff+y.length)/this.blockSize|0,E=new Array(w*this.blockSize);this.bufferOff!==0&&(v+=this._buffer(y,v),this.bufferOff===this.buffer.length&&(b+=this._flushBuffer(E,b)));for(var _=y.length-(y.length-v)%this.blockSize;v<_;v+=this.blockSize)this._update(y,v,E,b),b+=this.blockSize;for(;v<y.length;v++,this.bufferOff++)this.buffer[this.bufferOff]=y[v];return E},u.prototype._updateDecrypt=function(y){for(var v=0,b=0,w=Math.ceil((this.bufferOff+y.length)/this.blockSize)-1,E=new Array(w*this.blockSize);w>0;w--)v+=this._buffer(y,v),b+=this._flushBuffer(E,b);return v+=this._buffer(y,v),E},u.prototype.final=function(y){var v;y&&(v=this.update(y));var b;return this.type==="encrypt"?b=this._finalEncrypt():b=this._finalDecrypt(),v?v.concat(b):b},u.prototype._pad=function(y,v){if(v===0)return!1;for(;v<y.length;)y[v++]=0;return!0},u.prototype._finalEncrypt=function(){if(!this._pad(this.buffer,this.bufferOff))return[];var y=new Array(this.blockSize);return this._update(this.buffer,0,y,0),y},u.prototype._unpad=function(y){return y},u.prototype._finalDecrypt=function(){g.equal(this.bufferOff,this.blockSize,"Not enough data to decrypt");var y=new Array(this.blockSize);return this._flushBuffer(y,0),this._unpad(y)},cipher}var des,hasRequiredDes$1;function requireDes$1(){if(hasRequiredDes$1)return des;hasRequiredDes$1=1;var g=requireMinimalisticAssert(),u=requireInherits_browser(),h=requireUtils$1(),y=requireCipher();function v(){this.tmp=new Array(2),this.keys=null}function b(E){y.call(this,E);var _=new v;this._desState=_,this.deriveKeys(_,E.key)}u(b,y),des=b,b.create=function(_){return new b(_)};var w=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];return b.prototype.deriveKeys=function(_,S){_.keys=new Array(32),g.equal(S.length,this.blockSize,"Invalid key length");var A=h.readUInt32BE(S,0),R=h.readUInt32BE(S,4);h.pc1(A,R,_.tmp,0),A=_.tmp[0],R=_.tmp[1];for(var x=0;x<_.keys.length;x+=2){var T=w[x>>>1];A=h.r28shl(A,T),R=h.r28shl(R,T),h.pc2(A,R,_.keys,x)}},b.prototype._update=function(_,S,A,R){var x=this._desState,T=h.readUInt32BE(_,S),C=h.readUInt32BE(_,S+4);h.ip(T,C,x.tmp,0),T=x.tmp[0],C=x.tmp[1],this.type==="encrypt"?this._encrypt(x,T,C,x.tmp,0):this._decrypt(x,T,C,x.tmp,0),T=x.tmp[0],C=x.tmp[1],h.writeUInt32BE(A,T,R),h.writeUInt32BE(A,C,R+4)},b.prototype._pad=function(_,S){if(this.padding===!1)return!1;for(var A=_.length-S,R=S;R<_.length;R++)_[R]=A;return!0},b.prototype._unpad=function(_){if(this.padding===!1)return _;for(var S=_[_.length-1],A=_.length-S;A<_.length;A++)g.equal(_[A],S);return _.slice(0,_.length-S)},b.prototype._encrypt=function(_,S,A,R,x){for(var T=S,C=A,I=0;I<_.keys.length;I+=2){var L=_.keys[I],$=_.keys[I+1];h.expand(C,_.tmp,0),L^=_.tmp[0],$^=_.tmp[1];var B=h.substitute(L,$),U=h.permute(B),z=C;C=(T^U)>>>0,T=z}h.rip(C,T,R,x)},b.prototype._decrypt=function(_,S,A,R,x){for(var T=A,C=S,I=_.keys.length-2;I>=0;I-=2){var L=_.keys[I],$=_.keys[I+1];h.expand(T,_.tmp,0),L^=_.tmp[0],$^=_.tmp[1];var B=h.substitute(L,$),U=h.permute(B),z=T;T=(C^U)>>>0,C=z}h.rip(T,C,R,x)},des}var cbc$1={},hasRequiredCbc$1;function requireCbc$1(){if(hasRequiredCbc$1)return cbc$1;hasRequiredCbc$1=1;var g=requireMinimalisticAssert(),u=requireInherits_browser(),h={};function y(b){g.equal(b.length,8,"Invalid IV length"),this.iv=new Array(8);for(var w=0;w<this.iv.length;w++)this.iv[w]=b[w]}function v(b){function w(A){b.call(this,A),this._cbcInit()}u(w,b);for(var E=Object.keys(h),_=0;_<E.length;_++){var S=E[_];w.prototype[S]=h[S]}return w.create=function(R){return new w(R)},w}return cbc$1.instantiate=v,h._cbcInit=function(){var w=new y(this.options.iv);this._cbcState=w},h._update=function(w,E,_,S){var A=this._cbcState,R=this.constructor.super_.prototype,x=A.iv;if(this.type==="encrypt"){for(var T=0;T<this.blockSize;T++)x[T]^=w[E+T];R._update.call(this,x,0,_,S);for(var T=0;T<this.blockSize;T++)x[T]=_[S+T]}else{R._update.call(this,w,E,_,S);for(var T=0;T<this.blockSize;T++)_[S+T]^=x[T];for(var T=0;T<this.blockSize;T++)x[T]=w[E+T]}},cbc$1}var ede,hasRequiredEde;function requireEde(){if(hasRequiredEde)return ede;hasRequiredEde=1;var g=requireMinimalisticAssert(),u=requireInherits_browser(),h=requireCipher(),y=requireDes$1();function v(w,E){g.equal(E.length,24,"Invalid key length");var _=E.slice(0,8),S=E.slice(8,16),A=E.slice(16,24);w==="encrypt"?this.ciphers=[y.create({type:"encrypt",key:_}),y.create({type:"decrypt",key:S}),y.create({type:"encrypt",key:A})]:this.ciphers=[y.create({type:"decrypt",key:A}),y.create({type:"encrypt",key:S}),y.create({type:"decrypt",key:_})]}function b(w){h.call(this,w);var E=new v(this.type,this.options.key);this._edeState=E}return u(b,h),ede=b,b.create=function(E){return new b(E)},b.prototype._update=function(E,_,S,A){var R=this._edeState;R.ciphers[0]._update(E,_,S,A),R.ciphers[1]._update(S,A,S,A),R.ciphers[2]._update(S,A,S,A)},b.prototype._pad=y.prototype._pad,b.prototype._unpad=y.prototype._unpad,ede}var hasRequiredDes;function requireDes(){return hasRequiredDes||(hasRequiredDes=1,des$1.utils=requireUtils$1(),des$1.Cipher=requireCipher(),des$1.DES=requireDes$1(),des$1.CBC=requireCbc$1(),des$1.EDE=requireEde()),des$1}var browserifyDes,hasRequiredBrowserifyDes;function requireBrowserifyDes(){if(hasRequiredBrowserifyDes)return browserifyDes;hasRequiredBrowserifyDes=1;var g=requireCipherBase(),u=requireDes(),h=requireInherits_browser(),y=requireSafeBuffer$1().Buffer,v={"des-ede3-cbc":u.CBC.instantiate(u.EDE),"des-ede3":u.EDE,"des-ede-cbc":u.CBC.instantiate(u.EDE),"des-ede":u.EDE,"des-cbc":u.CBC.instantiate(u.DES),"des-ecb":u.DES};v.des=v["des-cbc"],v.des3=v["des-ede3-cbc"],browserifyDes=b,h(b,g);function b(w){g.call(this);var E=w.mode.toLowerCase(),_=v[E],S;w.decrypt?S="decrypt":S="encrypt";var A=w.key;y.isBuffer(A)||(A=y.from(A)),(E==="des-ede"||E==="des-ede-cbc")&&(A=y.concat([A,A.slice(0,8)]));var R=w.iv;y.isBuffer(R)||(R=y.from(R)),this._des=_.create({key:A,iv:R,type:S})}return b.prototype._update=function(w){return y.from(this._des.update(w))},b.prototype._final=function(){return y.from(this._des.final())},browserifyDes}var browser$6={},encrypter={},ecb={},hasRequiredEcb;function requireEcb(){return hasRequiredEcb||(hasRequiredEcb=1,ecb.encrypt=function(g,u){return g._cipher.encryptBlock(u)},ecb.decrypt=function(g,u){return g._cipher.decryptBlock(u)}),ecb}var cbc={},bufferXor,hasRequiredBufferXor;function requireBufferXor(){return hasRequiredBufferXor||(hasRequiredBufferXor=1,bufferXor=function(u,h){for(var y=Math.min(u.length,h.length),v=new Buffer(y),b=0;b<y;++b)v[b]=u[b]^h[b];return v}),bufferXor}var hasRequiredCbc;function requireCbc(){if(hasRequiredCbc)return cbc;hasRequiredCbc=1;var g=requireBufferXor();return cbc.encrypt=function(u,h){var y=g(h,u._prev);return u._prev=u._cipher.encryptBlock(y),u._prev},cbc.decrypt=function(u,h){var y=u._prev;u._prev=h;var v=u._cipher.decryptBlock(h);return g(v,y)},cbc}var cfb={},hasRequiredCfb;function requireCfb(){if(hasRequiredCfb)return cfb;hasRequiredCfb=1;var g=requireSafeBuffer$1().Buffer,u=requireBufferXor();function h(y,v,b){var w=v.length,E=u(v,y._cache);return y._cache=y._cache.slice(w),y._prev=g.concat([y._prev,b?v:E]),E}return cfb.encrypt=function(y,v,b){for(var w=g.allocUnsafe(0),E;v.length;)if(y._cache.length===0&&(y._cache=y._cipher.encryptBlock(y._prev),y._prev=g.allocUnsafe(0)),y._cache.length<=v.length)E=y._cache.length,w=g.concat([w,h(y,v.slice(0,E),b)]),v=v.slice(E);else{w=g.concat([w,h(y,v,b)]);break}return w},cfb}var cfb8={},hasRequiredCfb8;function requireCfb8(){if(hasRequiredCfb8)return cfb8;hasRequiredCfb8=1;var g=requireSafeBuffer$1().Buffer;function u(h,y,v){var b=h._cipher.encryptBlock(h._prev),w=b[0]^y;return h._prev=g.concat([h._prev.slice(1),g.from([v?y:w])]),w}return cfb8.encrypt=function(h,y,v){for(var b=y.length,w=g.allocUnsafe(b),E=-1;++E<b;)w[E]=u(h,y[E],v);return w},cfb8}var cfb1={},hasRequiredCfb1;function requireCfb1(){if(hasRequiredCfb1)return cfb1;hasRequiredCfb1=1;var g=requireSafeBuffer$1().Buffer;function u(y,v,b){for(var w,E=-1,_=8,S=0,A,R;++E<_;)w=y._cipher.encryptBlock(y._prev),A=v&1<<7-E?128:0,R=w[0]^A,S+=(R&128)>>E%8,y._prev=h(y._prev,b?A:R);return S}function h(y,v){var b=y.length,w=-1,E=g.allocUnsafe(y.length);for(y=g.concat([y,g.from([v])]);++w<b;)E[w]=y[w]<<1|y[w+1]>>7;return E}return cfb1.encrypt=function(y,v,b){for(var w=v.length,E=g.allocUnsafe(w),_=-1;++_<w;)E[_]=u(y,v[_],b);return E},cfb1}var ofb={},hasRequiredOfb;function requireOfb(){if(hasRequiredOfb)return ofb;hasRequiredOfb=1;var g=requireBufferXor();function u(h){return h._prev=h._cipher.encryptBlock(h._prev),h._prev}return ofb.encrypt=function(h,y){for(;h._cache.length<y.length;)h._cache=Buffer.concat([h._cache,u(h)]);var v=h._cache.slice(0,y.length);return h._cache=h._cache.slice(y.length),g(y,v)},ofb}var ctr={},incr32_1,hasRequiredIncr32;function requireIncr32(){if(hasRequiredIncr32)return incr32_1;hasRequiredIncr32=1;function g(u){for(var h=u.length,y;h--;)if(y=u.readUInt8(h),y===255)u.writeUInt8(0,h);else{y++,u.writeUInt8(y,h);break}}return incr32_1=g,incr32_1}var hasRequiredCtr;function requireCtr(){if(hasRequiredCtr)return ctr;hasRequiredCtr=1;var g=requireBufferXor(),u=requireSafeBuffer$1().Buffer,h=requireIncr32();function y(b){var w=b._cipher.encryptBlockRaw(b._prev);return h(b._prev),w}var v=16;return ctr.encrypt=function(b,w){var E=Math.ceil(w.length/v),_=b._cache.length;b._cache=u.concat([b._cache,u.allocUnsafe(E*v)]);for(var S=0;S<E;S++){var A=y(b),R=_+S*v;b._cache.writeUInt32BE(A[0],R+0),b._cache.writeUInt32BE(A[1],R+4),b._cache.writeUInt32BE(A[2],R+8),b._cache.writeUInt32BE(A[3],R+12)}var x=b._cache.slice(0,w.length);return b._cache=b._cache.slice(w.length),g(w,x)},ctr}const aes128={cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},aes192={cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},aes256={cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},require$$2={"aes-128-ecb":{cipher:"AES",key:128,iv:0,mode:"ECB",type:"block"},"aes-192-ecb":{cipher:"AES",key:192,iv:0,mode:"ECB",type:"block"},"aes-256-ecb":{cipher:"AES",key:256,iv:0,mode:"ECB",type:"block"},"aes-128-cbc":{cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},"aes-192-cbc":{cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},"aes-256-cbc":{cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},aes128,aes192,aes256,"aes-128-cfb":{cipher:"AES",key:128,iv:16,mode:"CFB",type:"stream"},"aes-192-cfb":{cipher:"AES",key:192,iv:16,mode:"CFB",type:"stream"},"aes-256-cfb":{cipher:"AES",key:256,iv:16,mode:"CFB",type:"stream"},"aes-128-cfb8":{cipher:"AES",key:128,iv:16,mode:"CFB8",type:"stream"},"aes-192-cfb8":{cipher:"AES",key:192,iv:16,mode:"CFB8",type:"stream"},"aes-256-cfb8":{cipher:"AES",key:256,iv:16,mode:"CFB8",type:"stream"},"aes-128-cfb1":{cipher:"AES",key:128,iv:16,mode:"CFB1",type:"stream"},"aes-192-cfb1":{cipher:"AES",key:192,iv:16,mode:"CFB1",type:"stream"},"aes-256-cfb1":{cipher:"AES",key:256,iv:16,mode:"CFB1",type:"stream"},"aes-128-ofb":{cipher:"AES",key:128,iv:16,mode:"OFB",type:"stream"},"aes-192-ofb":{cipher:"AES",key:192,iv:16,mode:"OFB",type:"stream"},"aes-256-ofb":{cipher:"AES",key:256,iv:16,mode:"OFB",type:"stream"},"aes-128-ctr":{cipher:"AES",key:128,iv:16,mode:"CTR",type:"stream"},"aes-192-ctr":{cipher:"AES",key:192,iv:16,mode:"CTR",type:"stream"},"aes-256-ctr":{cipher:"AES",key:256,iv:16,mode:"CTR",type:"stream"},"aes-128-gcm":{cipher:"AES",key:128,iv:12,mode:"GCM",type:"auth"},"aes-192-gcm":{cipher:"AES",key:192,iv:12,mode:"GCM",type:"auth"},"aes-256-gcm":{cipher:"AES",key:256,iv:12,mode:"GCM",type:"auth"}};var modes_1,hasRequiredModes$1;function requireModes$1(){if(hasRequiredModes$1)return modes_1;hasRequiredModes$1=1;var g={ECB:requireEcb(),CBC:requireCbc(),CFB:requireCfb(),CFB8:requireCfb8(),CFB1:requireCfb1(),OFB:requireOfb(),CTR:requireCtr(),GCM:requireCtr()},u=require$$2;for(var h in u)u[h].module=g[u[h].mode];return modes_1=u,modes_1}var aes={},hasRequiredAes;function requireAes(){if(hasRequiredAes)return aes;hasRequiredAes=1;var g=requireSafeBuffer$1().Buffer;function u(E){g.isBuffer(E)||(E=g.from(E));for(var _=E.length/4|0,S=new Array(_),A=0;A<_;A++)S[A]=E.readUInt32BE(A*4);return S}function h(E){for(var _=0;_<E.length;E++)E[_]=0}function y(E,_,S,A,R){for(var x=S[0],T=S[1],C=S[2],I=S[3],L=E[0]^_[0],$=E[1]^_[1],B=E[2]^_[2],U=E[3]^_[3],z,ne,ue,he,Y=4,X=1;X<R;X++)z=x[L>>>24]^T[$>>>16&255]^C[B>>>8&255]^I[U&255]^_[Y++],ne=x[$>>>24]^T[B>>>16&255]^C[U>>>8&255]^I[L&255]^_[Y++],ue=x[B>>>24]^T[U>>>16&255]^C[L>>>8&255]^I[$&255]^_[Y++],he=x[U>>>24]^T[L>>>16&255]^C[$>>>8&255]^I[B&255]^_[Y++],L=z,$=ne,B=ue,U=he;return z=(A[L>>>24]<<24|A[$>>>16&255]<<16|A[B>>>8&255]<<8|A[U&255])^_[Y++],ne=(A[$>>>24]<<24|A[B>>>16&255]<<16|A[U>>>8&255]<<8|A[L&255])^_[Y++],ue=(A[B>>>24]<<24|A[U>>>16&255]<<16|A[L>>>8&255]<<8|A[$&255])^_[Y++],he=(A[U>>>24]<<24|A[L>>>16&255]<<16|A[$>>>8&255]<<8|A[B&255])^_[Y++],z=z>>>0,ne=ne>>>0,ue=ue>>>0,he=he>>>0,[z,ne,ue,he]}var v=[0,1,2,4,8,16,32,64,128,27,54],b=(function(){for(var E=new Array(256),_=0;_<256;_++)_<128?E[_]=_<<1:E[_]=_<<1^283;for(var S=[],A=[],R=[[],[],[],[]],x=[[],[],[],[]],T=0,C=0,I=0;I<256;++I){var L=C^C<<1^C<<2^C<<3^C<<4;L=L>>>8^L&255^99,S[T]=L,A[L]=T;var $=E[T],B=E[$],U=E[B],z=E[L]*257^L*16843008;R[0][T]=z<<24|z>>>8,R[1][T]=z<<16|z>>>16,R[2][T]=z<<8|z>>>24,R[3][T]=z,z=U*16843009^B*65537^$*257^T*16843008,x[0][L]=z<<24|z>>>8,x[1][L]=z<<16|z>>>16,x[2][L]=z<<8|z>>>24,x[3][L]=z,T===0?T=C=1:(T=$^E[E[E[U^$]]],C^=E[E[C]])}return{SBOX:S,INV_SBOX:A,SUB_MIX:R,INV_SUB_MIX:x}})();function w(E){this._key=u(E),this._reset()}return w.blockSize=16,w.keySize=256/8,w.prototype.blockSize=w.blockSize,w.prototype.keySize=w.keySize,w.prototype._reset=function(){for(var E=this._key,_=E.length,S=_+6,A=(S+1)*4,R=[],x=0;x<_;x++)R[x]=E[x];for(x=_;x<A;x++){var T=R[x-1];x%_===0?(T=T<<8|T>>>24,T=b.SBOX[T>>>24]<<24|b.SBOX[T>>>16&255]<<16|b.SBOX[T>>>8&255]<<8|b.SBOX[T&255],T^=v[x/_|0]<<24):_>6&&x%_===4&&(T=b.SBOX[T>>>24]<<24|b.SBOX[T>>>16&255]<<16|b.SBOX[T>>>8&255]<<8|b.SBOX[T&255]),R[x]=R[x-_]^T}for(var C=[],I=0;I<A;I++){var L=A-I,$=R[L-(I%4?0:4)];I<4||L<=4?C[I]=$:C[I]=b.INV_SUB_MIX[0][b.SBOX[$>>>24]]^b.INV_SUB_MIX[1][b.SBOX[$>>>16&255]]^b.INV_SUB_MIX[2][b.SBOX[$>>>8&255]]^b.INV_SUB_MIX[3][b.SBOX[$&255]]}this._nRounds=S,this._keySchedule=R,this._invKeySchedule=C},w.prototype.encryptBlockRaw=function(E){return E=u(E),y(E,this._keySchedule,b.SUB_MIX,b.SBOX,this._nRounds)},w.prototype.encryptBlock=function(E){var _=this.encryptBlockRaw(E),S=g.allocUnsafe(16);return S.writeUInt32BE(_[0],0),S.writeUInt32BE(_[1],4),S.writeUInt32BE(_[2],8),S.writeUInt32BE(_[3],12),S},w.prototype.decryptBlock=function(E){E=u(E);var _=E[1];E[1]=E[3],E[3]=_;var S=y(E,this._invKeySchedule,b.INV_SUB_MIX,b.INV_SBOX,this._nRounds),A=g.allocUnsafe(16);return A.writeUInt32BE(S[0],0),A.writeUInt32BE(S[3],4),A.writeUInt32BE(S[2],8),A.writeUInt32BE(S[1],12),A},w.prototype.scrub=function(){h(this._keySchedule),h(this._invKeySchedule),h(this._key)},aes.AES=w,aes}var ghash,hasRequiredGhash;function requireGhash(){if(hasRequiredGhash)return ghash;hasRequiredGhash=1;var g=requireSafeBuffer$1().Buffer,u=g.alloc(16,0);function h(b){return[b.readUInt32BE(0),b.readUInt32BE(4),b.readUInt32BE(8),b.readUInt32BE(12)]}function y(b){var w=g.allocUnsafe(16);return w.writeUInt32BE(b[0]>>>0,0),w.writeUInt32BE(b[1]>>>0,4),w.writeUInt32BE(b[2]>>>0,8),w.writeUInt32BE(b[3]>>>0,12),w}function v(b){this.h=b,this.state=g.alloc(16,0),this.cache=g.allocUnsafe(0)}return v.prototype.ghash=function(b){for(var w=-1;++w<b.length;)this.state[w]^=b[w];this._multiply()},v.prototype._multiply=function(){for(var b=h(this.h),w=[0,0,0,0],E,_,S,A=-1;++A<128;){for(_=(this.state[~~(A/8)]&1<<7-A%8)!==0,_&&(w[0]^=b[0],w[1]^=b[1],w[2]^=b[2],w[3]^=b[3]),S=(b[3]&1)!==0,E=3;E>0;E--)b[E]=b[E]>>>1|(b[E-1]&1)<<31;b[0]=b[0]>>>1,S&&(b[0]=b[0]^225<<24)}this.state=y(w)},v.prototype.update=function(b){this.cache=g.concat([this.cache,b]);for(var w;this.cache.length>=16;)w=this.cache.slice(0,16),this.cache=this.cache.slice(16),this.ghash(w)},v.prototype.final=function(b,w){return this.cache.length&&this.ghash(g.concat([this.cache,u],16)),this.ghash(y([0,b,0,w])),this.state},ghash=v,ghash}var authCipher,hasRequiredAuthCipher;function requireAuthCipher(){if(hasRequiredAuthCipher)return authCipher;hasRequiredAuthCipher=1;var g=requireAes(),u=requireSafeBuffer$1().Buffer,h=requireCipherBase(),y=requireInherits_browser(),v=requireGhash(),b=requireBufferXor(),w=requireIncr32();function E(A,R){var x=0;A.length!==R.length&&x++;for(var T=Math.min(A.length,R.length),C=0;C<T;++C)x+=A[C]^R[C];return x}function _(A,R,x){if(R.length===12)return A._finID=u.concat([R,u.from([0,0,0,1])]),u.concat([R,u.from([0,0,0,2])]);var T=new v(x),C=R.length,I=C%16;T.update(R),I&&(I=16-I,T.update(u.alloc(I,0))),T.update(u.alloc(8,0));var L=C*8,$=u.alloc(8);$.writeUIntBE(L,0,8),T.update($),A._finID=T.state;var B=u.from(A._finID);return w(B),B}function S(A,R,x,T){h.call(this);var C=u.alloc(4,0);this._cipher=new g.AES(R);var I=this._cipher.encryptBlock(C);this._ghash=new v(I),x=_(this,x,I),this._prev=u.from(x),this._cache=u.allocUnsafe(0),this._secCache=u.allocUnsafe(0),this._decrypt=T,this._alen=0,this._len=0,this._mode=A,this._authTag=null,this._called=!1}return y(S,h),S.prototype._update=function(A){if(!this._called&&this._alen){var R=16-this._alen%16;R<16&&(R=u.alloc(R,0),this._ghash.update(R))}this._called=!0;var x=this._mode.encrypt(this,A);return this._decrypt?this._ghash.update(A):this._ghash.update(x),this._len+=A.length,x},S.prototype._final=function(){if(this._decrypt&&!this._authTag)throw new Error("Unsupported state or unable to authenticate data");var A=b(this._ghash.final(this._alen*8,this._len*8),this._cipher.encryptBlock(this._finID));if(this._decrypt&&E(A,this._authTag))throw new Error("Unsupported state or unable to authenticate data");this._authTag=A,this._cipher.scrub()},S.prototype.getAuthTag=function(){if(this._decrypt||!u.isBuffer(this._authTag))throw new Error("Attempting to get auth tag in unsupported state");return this._authTag},S.prototype.setAuthTag=function(R){if(!this._decrypt)throw new Error("Attempting to set auth tag in unsupported state");this._authTag=R},S.prototype.setAAD=function(R){if(this._called)throw new Error("Attempting to set AAD in unsupported state");this._ghash.update(R),this._alen+=R.length},authCipher=S,authCipher}var streamCipher,hasRequiredStreamCipher;function requireStreamCipher(){if(hasRequiredStreamCipher)return streamCipher;hasRequiredStreamCipher=1;var g=requireAes(),u=requireSafeBuffer$1().Buffer,h=requireCipherBase(),y=requireInherits_browser();function v(b,w,E,_){h.call(this),this._cipher=new g.AES(w),this._prev=u.from(E),this._cache=u.allocUnsafe(0),this._secCache=u.allocUnsafe(0),this._decrypt=_,this._mode=b}return y(v,h),v.prototype._update=function(b){return this._mode.encrypt(this,b,this._decrypt)},v.prototype._final=function(){this._cipher.scrub()},streamCipher=v,streamCipher}var evp_bytestokey,hasRequiredEvp_bytestokey;function requireEvp_bytestokey(){if(hasRequiredEvp_bytestokey)return evp_bytestokey;hasRequiredEvp_bytestokey=1;var g=requireSafeBuffer$1().Buffer,u=requireMd5_js();function h(y,v,b,w){if(g.isBuffer(y)||(y=g.from(y,"binary")),v&&(g.isBuffer(v)||(v=g.from(v,"binary")),v.length!==8))throw new RangeError("salt should be Buffer with 8 byte length");for(var E=b/8,_=g.alloc(E),S=g.alloc(w||0),A=g.alloc(0);E>0||w>0;){var R=new u;R.update(A),R.update(y),v&&R.update(v),A=R.digest();var x=0;if(E>0){var T=_.length-E;x=Math.min(E,A.length),A.copy(_,T,0,x),E-=x}if(x<A.length&&w>0){var C=S.length-w,I=Math.min(w,A.length-x);A.copy(S,C,x,x+I),w-=I}}return A.fill(0),{key:_,iv:S}}return evp_bytestokey=h,evp_bytestokey}var hasRequiredEncrypter;function requireEncrypter(){if(hasRequiredEncrypter)return encrypter;hasRequiredEncrypter=1;var g=requireModes$1(),u=requireAuthCipher(),h=requireSafeBuffer$1().Buffer,y=requireStreamCipher(),v=requireCipherBase(),b=requireAes(),w=requireEvp_bytestokey(),E=requireInherits_browser();function _(T,C,I){v.call(this),this._cache=new A,this._cipher=new b.AES(C),this._prev=h.from(I),this._mode=T,this._autopadding=!0}E(_,v),_.prototype._update=function(T){this._cache.add(T);for(var C,I,L=[];C=this._cache.get();)I=this._mode.encrypt(this,C),L.push(I);return h.concat(L)};var S=h.alloc(16,16);_.prototype._final=function(){var T=this._cache.flush();if(this._autopadding)return T=this._mode.encrypt(this,T),this._cipher.scrub(),T;if(!T.equals(S))throw this._cipher.scrub(),new Error("data not multiple of block length")},_.prototype.setAutoPadding=function(T){return this._autopadding=!!T,this};function A(){this.cache=h.allocUnsafe(0)}A.prototype.add=function(T){this.cache=h.concat([this.cache,T])},A.prototype.get=function(){if(this.cache.length>15){var T=this.cache.slice(0,16);return this.cache=this.cache.slice(16),T}return null},A.prototype.flush=function(){for(var T=16-this.cache.length,C=h.allocUnsafe(T),I=-1;++I<T;)C.writeUInt8(T,I);return h.concat([this.cache,C])};function R(T,C,I){var L=g[T.toLowerCase()];if(!L)throw new TypeError("invalid suite type");if(typeof C=="string"&&(C=h.from(C)),C.length!==L.key/8)throw new TypeError("invalid key length "+C.length);if(typeof I=="string"&&(I=h.from(I)),L.mode!=="GCM"&&I.length!==L.iv)throw new TypeError("invalid iv length "+I.length);return L.type==="stream"?new y(L.module,C,I):L.type==="auth"?new u(L.module,C,I):new _(L.module,C,I)}function x(T,C){var I=g[T.toLowerCase()];if(!I)throw new TypeError("invalid suite type");var L=w(C,!1,I.key,I.iv);return R(T,L.key,L.iv)}return encrypter.createCipheriv=R,encrypter.createCipher=x,encrypter}var decrypter={},hasRequiredDecrypter;function requireDecrypter(){if(hasRequiredDecrypter)return decrypter;hasRequiredDecrypter=1;var g=requireAuthCipher(),u=requireSafeBuffer$1().Buffer,h=requireModes$1(),y=requireStreamCipher(),v=requireCipherBase(),b=requireAes(),w=requireEvp_bytestokey(),E=requireInherits_browser();function _(T,C,I){v.call(this),this._cache=new S,this._last=void 0,this._cipher=new b.AES(C),this._prev=u.from(I),this._mode=T,this._autopadding=!0}E(_,v),_.prototype._update=function(T){this._cache.add(T);for(var C,I,L=[];C=this._cache.get(this._autopadding);)I=this._mode.decrypt(this,C),L.push(I);return u.concat(L)},_.prototype._final=function(){var T=this._cache.flush();if(this._autopadding)return A(this._mode.decrypt(this,T));if(T)throw new Error("data not multiple of block length")},_.prototype.setAutoPadding=function(T){return this._autopadding=!!T,this};function S(){this.cache=u.allocUnsafe(0)}S.prototype.add=function(T){this.cache=u.concat([this.cache,T])},S.prototype.get=function(T){var C;if(T){if(this.cache.length>16)return C=this.cache.slice(0,16),this.cache=this.cache.slice(16),C}else if(this.cache.length>=16)return C=this.cache.slice(0,16),this.cache=this.cache.slice(16),C;return null},S.prototype.flush=function(){if(this.cache.length)return this.cache};function A(T){var C=T[15];if(C<1||C>16)throw new Error("unable to decrypt data");for(var I=-1;++I<C;)if(T[I+(16-C)]!==C)throw new Error("unable to decrypt data");if(C!==16)return T.slice(0,16-C)}function R(T,C,I){var L=h[T.toLowerCase()];if(!L)throw new TypeError("invalid suite type");if(typeof I=="string"&&(I=u.from(I)),L.mode!=="GCM"&&I.length!==L.iv)throw new TypeError("invalid iv length "+I.length);if(typeof C=="string"&&(C=u.from(C)),C.length!==L.key/8)throw new TypeError("invalid key length "+C.length);return L.type==="stream"?new y(L.module,C,I,!0):L.type==="auth"?new g(L.module,C,I,!0):new _(L.module,C,I)}function x(T,C){var I=h[T.toLowerCase()];if(!I)throw new TypeError("invalid suite type");var L=w(C,!1,I.key,I.iv);return R(T,L.key,L.iv)}return decrypter.createDecipher=x,decrypter.createDecipheriv=R,decrypter}var hasRequiredBrowser$7;function requireBrowser$7(){if(hasRequiredBrowser$7)return browser$6;hasRequiredBrowser$7=1;var g=requireEncrypter(),u=requireDecrypter(),h=require$$2;function y(){return Object.keys(h)}return browser$6.createCipher=browser$6.Cipher=g.createCipher,browser$6.createCipheriv=browser$6.Cipheriv=g.createCipheriv,browser$6.createDecipher=browser$6.Decipher=u.createDecipher,browser$6.createDecipheriv=browser$6.Decipheriv=u.createDecipheriv,browser$6.listCiphers=browser$6.getCiphers=y,browser$6}var modes={},hasRequiredModes;function requireModes(){return hasRequiredModes||(hasRequiredModes=1,(function(g){g["des-ecb"]={key:8,iv:0},g["des-cbc"]=g.des={key:8,iv:8},g["des-ede3-cbc"]=g.des3={key:24,iv:8},g["des-ede3"]={key:24,iv:0},g["des-ede-cbc"]={key:16,iv:8},g["des-ede"]={key:16,iv:0}})(modes)),modes}var hasRequiredBrowser$6;function requireBrowser$6(){if(hasRequiredBrowser$6)return browser$7;hasRequiredBrowser$6=1;var g=requireBrowserifyDes(),u=requireBrowser$7(),h=requireModes$1(),y=requireModes(),v=requireEvp_bytestokey();function b(A,R){A=A.toLowerCase();var x,T;if(h[A])x=h[A].key,T=h[A].iv;else if(y[A])x=y[A].key*8,T=y[A].iv;else throw new TypeError("invalid suite type");var C=v(R,!1,x,T);return E(A,C.key,C.iv)}function w(A,R){A=A.toLowerCase();var x,T;if(h[A])x=h[A].key,T=h[A].iv;else if(y[A])x=y[A].key*8,T=y[A].iv;else throw new TypeError("invalid suite type");var C=v(R,!1,x,T);return _(A,C.key,C.iv)}function E(A,R,x){if(A=A.toLowerCase(),h[A])return u.createCipheriv(A,R,x);if(y[A])return new g({key:R,iv:x,mode:A});throw new TypeError("invalid suite type")}function _(A,R,x){if(A=A.toLowerCase(),h[A])return u.createDecipheriv(A,R,x);if(y[A])return new g({key:R,iv:x,mode:A,decrypt:!0});throw new TypeError("invalid suite type")}function S(){return Object.keys(y).concat(u.getCiphers())}return browser$7.createCipher=browser$7.Cipher=b,browser$7.createCipheriv=browser$7.Cipheriv=E,browser$7.createDecipher=browser$7.Decipher=w,browser$7.createDecipheriv=browser$7.Decipheriv=_,browser$7.listCiphers=browser$7.getCiphers=S,browser$7}var browser$5={},mr,hasRequiredMr;function requireMr(){if(hasRequiredMr)return mr;hasRequiredMr=1;var g=requireBn(),u=requireBrorand();function h(y){this.rand=y||new u.Rand}return mr=h,h.create=function(v){return new h(v)},h.prototype._randbelow=function(v){var b=v.bitLength(),w=Math.ceil(b/8);do var E=new g(this.rand.generate(w));while(E.cmp(v)>=0);return E},h.prototype._randrange=function(v,b){var w=b.sub(v);return v.add(this._randbelow(w))},h.prototype.test=function(v,b,w){var E=v.bitLength(),_=g.mont(v),S=new g(1).toRed(_);b||(b=Math.max(1,E/48|0));for(var A=v.subn(1),R=0;!A.testn(R);R++);for(var x=v.shrn(R),T=A.toRed(_),C=!0;b>0;b--){var I=this._randrange(new g(2),A);w&&w(I);var L=I.toRed(_).redPow(x);if(!(L.cmp(S)===0||L.cmp(T)===0)){for(var $=1;$<R;$++){if(L=L.redSqr(),L.cmp(S)===0)return!1;if(L.cmp(T)===0)break}if($===R)return!1}}return C},h.prototype.getDivisor=function(v,b){var w=v.bitLength(),E=g.mont(v),_=new g(1).toRed(E);b||(b=Math.max(1,w/48|0));for(var S=v.subn(1),A=0;!S.testn(A);A++);for(var R=v.shrn(A),x=S.toRed(E);b>0;b--){var T=this._randrange(new g(2),S),C=v.gcd(T);if(C.cmpn(1)!==0)return C;var I=T.toRed(E).redPow(R);if(!(I.cmp(_)===0||I.cmp(x)===0)){for(var L=1;L<A;L++){if(I=I.redSqr(),I.cmp(_)===0)return I.fromRed().subn(1).gcd(v);if(I.cmp(x)===0)break}if(L===A)return I=I.redSqr(),I.fromRed().subn(1).gcd(v)}}return!1},mr}var generatePrime,hasRequiredGeneratePrime;function requireGeneratePrime(){if(hasRequiredGeneratePrime)return generatePrime;hasRequiredGeneratePrime=1;var g=requireBrowser$c();generatePrime=L,L.simpleSieve=C,L.fermatTest=I;var u=requireBn(),h=new u(24),y=requireMr(),v=new y,b=new u(1),w=new u(2),E=new u(5);new u(16),new u(8);var _=new u(10),S=new u(3);new u(7);var A=new u(11),R=new u(4);new u(12);var x=null;function T(){if(x!==null)return x;var $=1048576,B=[];B[0]=2;for(var U=1,z=3;z<$;z+=2){for(var ne=Math.ceil(Math.sqrt(z)),ue=0;ue<U&&B[ue]<=ne&&z%B[ue]!==0;ue++);U!==ue&&B[ue]<=ne||(B[U++]=z)}return x=B,B}function C($){for(var B=T(),U=0;U<B.length;U++)if($.modn(B[U])===0)return $.cmpn(B[U])===0;return!0}function I($){var B=u.mont($);return w.toRed(B).redPow($.subn(1)).fromRed().cmpn(1)===0}function L($,B){if($<16)return B===2||B===5?new u([140,123]):new u([140,39]);B=new u(B);for(var U,z;;){for(U=new u(g(Math.ceil($/8)));U.bitLength()>$;)U.ishrn(1);if(U.isEven()&&U.iadd(b),U.testn(1)||U.iadd(w),B.cmp(w)){if(!B.cmp(E))for(;U.mod(_).cmp(S);)U.iadd(R)}else for(;U.mod(h).cmp(A);)U.iadd(R);if(z=U.shrn(1),C(z)&&C(U)&&I(z)&&I(U)&&v.test(z)&&v.test(U))return U}}return generatePrime}const modp1={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"},modp2={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"},modp5={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"},modp14={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"},modp15={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"},modp16={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"},modp17={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"},modp18={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"},require$$1$1={modp1,modp2,modp5,modp14,modp15,modp16,modp17,modp18};var dh,hasRequiredDh;function requireDh(){if(hasRequiredDh)return dh;hasRequiredDh=1;var g=requireBn(),u=requireMr(),h=new u,y=new g(24),v=new g(11),b=new g(10),w=new g(3),E=new g(7),_=requireGeneratePrime(),S=requireBrowser$c();dh=C;function A(L,$){return $=$||"utf8",Buffer.isBuffer(L)||(L=new Buffer(L,$)),this._pub=new g(L),this}function R(L,$){return $=$||"utf8",Buffer.isBuffer(L)||(L=new Buffer(L,$)),this._priv=new g(L),this}var x={};function T(L,$){var B=$.toString("hex"),U=[B,L.toString(16)].join("_");if(U in x)return x[U];var z=0;if(L.isEven()||!_.simpleSieve||!_.fermatTest(L)||!h.test(L))return z+=1,B==="02"||B==="05"?z+=8:z+=4,x[U]=z,z;h.test(L.shrn(1))||(z+=2);var ne;switch(B){case"02":L.mod(y).cmp(v)&&(z+=8);break;case"05":ne=L.mod(b),ne.cmp(w)&&ne.cmp(E)&&(z+=8);break;default:z+=4}return x[U]=z,z}function C(L,$,B){this.setGenerator($),this.__prime=new g(L),this._prime=g.mont(this.__prime),this._primeLen=L.length,this._pub=void 0,this._priv=void 0,this._primeCode=void 0,B?(this.setPublicKey=A,this.setPrivateKey=R):this._primeCode=8}Object.defineProperty(C.prototype,"verifyError",{enumerable:!0,get:function(){return typeof this._primeCode!="number"&&(this._primeCode=T(this.__prime,this.__gen)),this._primeCode}}),C.prototype.generateKeys=function(){return this._priv||(this._priv=new g(S(this._primeLen))),this._pub=this._gen.toRed(this._prime).redPow(this._priv).fromRed(),this.getPublicKey()},C.prototype.computeSecret=function(L){L=new g(L),L=L.toRed(this._prime);var $=L.redPow(this._priv).fromRed(),B=new Buffer($.toArray()),U=this.getPrime();if(B.length<U.length){var z=new Buffer(U.length-B.length);z.fill(0),B=Buffer.concat([z,B])}return B},C.prototype.getPublicKey=function($){return I(this._pub,$)},C.prototype.getPrivateKey=function($){return I(this._priv,$)},C.prototype.getPrime=function(L){return I(this.__prime,L)},C.prototype.getGenerator=function(L){return I(this._gen,L)},C.prototype.setGenerator=function(L,$){return $=$||"utf8",Buffer.isBuffer(L)||(L=new Buffer(L,$)),this.__gen=L,this._gen=new g(L),this};function I(L,$){var B=new Buffer(L.toArray());return $?B.toString($):B}return dh}var hasRequiredBrowser$5;function requireBrowser$5(){if(hasRequiredBrowser$5)return browser$5;hasRequiredBrowser$5=1;var g=requireGeneratePrime(),u=require$$1$1,h=requireDh();function y(w){var E=new Buffer(u[w].prime,"hex"),_=new Buffer(u[w].gen,"hex");return new h(E,_)}var v={binary:!0,hex:!0,base64:!0};function b(w,E,_,S){return Buffer.isBuffer(E)||v[E]===void 0?b(w,"binary",E,_):(E=E||"binary",S=S||"binary",_=_||new Buffer([2]),Buffer.isBuffer(_)||(_=new Buffer(_,S)),typeof w=="number"?new h(g(w,_),_,!0):(Buffer.isBuffer(w)||(w=new Buffer(w,E)),new h(w,_,!0)))}return browser$5.DiffieHellmanGroup=browser$5.createDiffieHellmanGroup=browser$5.getDiffieHellman=y,browser$5.createDiffieHellman=browser$5.DiffieHellman=b,browser$5}var readableBrowser={exports:{}},processNextickArgs={exports:{}},hasRequiredProcessNextickArgs;function requireProcessNextickArgs(){if(hasRequiredProcessNextickArgs)return processNextickArgs.exports;hasRequiredProcessNextickArgs=1,typeof process$1>"u"||!process$1.version||process$1.version.indexOf("v0.")===0||process$1.version.indexOf("v1.")===0&&process$1.version.indexOf("v1.8.")!==0?processNextickArgs.exports={nextTick:g}:processNextickArgs.exports=process$1;function g(u,h,y,v){if(typeof u!="function")throw new TypeError('"callback" argument must be a function');var b=arguments.length,w,E;switch(b){case 0:case 1:return process$1.nextTick(u);case 2:return process$1.nextTick(function(){u.call(null,h)});case 3:return process$1.nextTick(function(){u.call(null,h,y)});case 4:return process$1.nextTick(function(){u.call(null,h,y,v)});default:for(w=new Array(b-1),E=0;E<w.length;)w[E++]=arguments[E];return process$1.nextTick(function(){u.apply(null,w)})}}return processNextickArgs.exports}var isarray,hasRequiredIsarray;function requireIsarray(){if(hasRequiredIsarray)return isarray;hasRequiredIsarray=1;var g={}.toString;return isarray=Array.isArray||function(u){return g.call(u)=="[object Array]"},isarray}var streamBrowser,hasRequiredStreamBrowser;function requireStreamBrowser(){return hasRequiredStreamBrowser||(hasRequiredStreamBrowser=1,streamBrowser=requireEvents().EventEmitter),streamBrowser}var safeBuffer={exports:{}},hasRequiredSafeBuffer;function requireSafeBuffer(){return hasRequiredSafeBuffer||(hasRequiredSafeBuffer=1,(function(g,u){var h=requireDist$1(),y=h.Buffer;function v(w,E){for(var _ in w)E[_]=w[_]}y.from&&y.alloc&&y.allocUnsafe&&y.allocUnsafeSlow?g.exports=h:(v(h,u),u.Buffer=b);function b(w,E,_){return y(w,E,_)}v(y,b),b.from=function(w,E,_){if(typeof w=="number")throw new TypeError("Argument must not be a number");return y(w,E,_)},b.alloc=function(w,E,_){if(typeof w!="number")throw new TypeError("Argument must be a number");var S=y(w);return E!==void 0?typeof _=="string"?S.fill(E,_):S.fill(E):S.fill(0),S},b.allocUnsafe=function(w){if(typeof w!="number")throw new TypeError("Argument must be a number");return y(w)},b.allocUnsafeSlow=function(w){if(typeof w!="number")throw new TypeError("Argument must be a number");return h.SlowBuffer(w)}})(safeBuffer,safeBuffer.exports)),safeBuffer.exports}var util$1={},hasRequiredUtil$1;function requireUtil$1(){if(hasRequiredUtil$1)return util$1;hasRequiredUtil$1=1;function g(I){return Array.isArray?Array.isArray(I):C(I)==="[object Array]"}util$1.isArray=g;function u(I){return typeof I=="boolean"}util$1.isBoolean=u;function h(I){return I===null}util$1.isNull=h;function y(I){return I==null}util$1.isNullOrUndefined=y;function v(I){return typeof I=="number"}util$1.isNumber=v;function b(I){return typeof I=="string"}util$1.isString=b;function w(I){return typeof I=="symbol"}util$1.isSymbol=w;function E(I){return I===void 0}util$1.isUndefined=E;function _(I){return C(I)==="[object RegExp]"}util$1.isRegExp=_;function S(I){return typeof I=="object"&&I!==null}util$1.isObject=S;function A(I){return C(I)==="[object Date]"}util$1.isDate=A;function R(I){return C(I)==="[object Error]"||I instanceof Error}util$1.isError=R;function x(I){return typeof I=="function"}util$1.isFunction=x;function T(I){return I===null||typeof I=="boolean"||typeof I=="number"||typeof I=="string"||typeof I=="symbol"||typeof I>"u"}util$1.isPrimitive=T,util$1.isBuffer=requireDist$1().Buffer.isBuffer;function C(I){return Object.prototype.toString.call(I)}return util$1}var BufferList={exports:{}},hasRequiredBufferList;function requireBufferList(){return hasRequiredBufferList||(hasRequiredBufferList=1,(function(g){function u(b,w){if(!(b instanceof w))throw new TypeError("Cannot call a class as a function")}var h=requireSafeBuffer().Buffer,y=requireUtil$2();function v(b,w,E){b.copy(w,E)}g.exports=(function(){function b(){u(this,b),this.head=null,this.tail=null,this.length=0}return b.prototype.push=function(E){var _={data:E,next:null};this.length>0?this.tail.next=_:this.head=_,this.tail=_,++this.length},b.prototype.unshift=function(E){var _={data:E,next:this.head};this.length===0&&(this.tail=_),this.head=_,++this.length},b.prototype.shift=function(){if(this.length!==0){var E=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,E}},b.prototype.clear=function(){this.head=this.tail=null,this.length=0},b.prototype.join=function(E){if(this.length===0)return"";for(var _=this.head,S=""+_.data;_=_.next;)S+=E+_.data;return S},b.prototype.concat=function(E){if(this.length===0)return h.alloc(0);for(var _=h.allocUnsafe(E>>>0),S=this.head,A=0;S;)v(S.data,_,A),A+=S.data.length,S=S.next;return _},b})(),y&&y.inspect&&y.inspect.custom&&(g.exports.prototype[y.inspect.custom]=function(){var b=y.inspect({length:this.length});return this.constructor.name+" "+b})})(BufferList)),BufferList.exports}var destroy_1$1,hasRequiredDestroy$1;function requireDestroy$1(){if(hasRequiredDestroy$1)return destroy_1$1;hasRequiredDestroy$1=1;var g=requireProcessNextickArgs();function u(v,b){var w=this,E=this._readableState&&this._readableState.destroyed,_=this._writableState&&this._writableState.destroyed;return E||_?(b?b(v):v&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,g.nextTick(y,this,v)):g.nextTick(y,this,v)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(v||null,function(S){!b&&S?w._writableState?w._writableState.errorEmitted||(w._writableState.errorEmitted=!0,g.nextTick(y,w,S)):g.nextTick(y,w,S):b&&b(S)}),this)}function h(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function y(v,b){v.emit("error",b)}return destroy_1$1={destroy:u,undestroy:h},destroy_1$1}var _stream_writable,hasRequired_stream_writable;function require_stream_writable(){if(hasRequired_stream_writable)return _stream_writable;hasRequired_stream_writable=1;var g=requireProcessNextickArgs();_stream_writable=I;function u(q){var F=this;this.next=null,this.entry=null,this.finish=function(){k(F,q)}}var h=g.nextTick,y;I.WritableState=T;var v=Object.create(requireUtil$1());v.inherits=requireInherits_browser();var b={deprecate:requireBrowser$b()},w=requireStreamBrowser(),E=requireSafeBuffer().Buffer,_=(typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function S(q){return E.from(q)}function A(q){return E.isBuffer(q)||q instanceof _}var R=requireDestroy$1();v.inherits(I,w);function x(){}function T(q,F){y=y||require_stream_duplex(),q=q||{};var H=F instanceof y;this.objectMode=!!q.objectMode,H&&(this.objectMode=this.objectMode||!!q.writableObjectMode);var D=q.highWaterMark,G=q.writableHighWaterMark,W=this.objectMode?16:16*1024;D||D===0?this.highWaterMark=D:H&&(G||G===0)?this.highWaterMark=G:this.highWaterMark=W,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var K=q.decodeStrings===!1;this.decodeStrings=!K,this.defaultEncoding=q.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(Z){he(F,Z)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new u(this)}T.prototype.getBuffer=function(){for(var F=this.bufferedRequest,H=[];F;)H.push(F),F=F.next;return H},(function(){try{Object.defineProperty(T.prototype,"buffer",{get:b.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var C;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(C=Function.prototype[Symbol.hasInstance],Object.defineProperty(I,Symbol.hasInstance,{value:function(q){return C.call(this,q)?!0:this!==I?!1:q&&q._writableState instanceof T}})):C=function(q){return q instanceof this};function I(q){if(y=y||require_stream_duplex(),!C.call(I,this)&&!(this instanceof y))return new I(q);this._writableState=new T(q,this),this.writable=!0,q&&(typeof q.write=="function"&&(this._write=q.write),typeof q.writev=="function"&&(this._writev=q.writev),typeof q.destroy=="function"&&(this._destroy=q.destroy),typeof q.final=="function"&&(this._final=q.final)),w.call(this)}I.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function L(q,F){var H=new Error("write after end");q.emit("error",H),g.nextTick(F,H)}function $(q,F,H,D){var G=!0,W=!1;return H===null?W=new TypeError("May not write null values to stream"):typeof H!="string"&&H!==void 0&&!F.objectMode&&(W=new TypeError("Invalid non-string/buffer chunk")),W&&(q.emit("error",W),g.nextTick(D,W),G=!1),G}I.prototype.write=function(q,F,H){var D=this._writableState,G=!1,W=!D.objectMode&&A(q);return W&&!E.isBuffer(q)&&(q=S(q)),typeof F=="function"&&(H=F,F=null),W?F="buffer":F||(F=D.defaultEncoding),typeof H!="function"&&(H=x),D.ended?L(this,H):(W||$(this,D,q,H))&&(D.pendingcb++,G=U(this,D,W,q,F,H)),G},I.prototype.cork=function(){var q=this._writableState;q.corked++},I.prototype.uncork=function(){var q=this._writableState;q.corked&&(q.corked--,!q.writing&&!q.corked&&!q.bufferProcessing&&q.bufferedRequest&&J(this,q))},I.prototype.setDefaultEncoding=function(F){if(typeof F=="string"&&(F=F.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((F+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+F);return this._writableState.defaultEncoding=F,this};function B(q,F,H){return!q.objectMode&&q.decodeStrings!==!1&&typeof F=="string"&&(F=E.from(F,H)),F}Object.defineProperty(I.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function U(q,F,H,D,G,W){if(!H){var K=B(F,D,G);D!==K&&(H=!0,G="buffer",D=K)}var Z=F.objectMode?1:D.length;F.length+=Z;var ae=F.length<F.highWaterMark;if(ae||(F.needDrain=!0),F.writing||F.corked){var le=F.lastBufferedRequest;F.lastBufferedRequest={chunk:D,encoding:G,isBuf:H,callback:W,next:null},le?le.next=F.lastBufferedRequest:F.bufferedRequest=F.lastBufferedRequest,F.bufferedRequestCount+=1}else z(q,F,!1,Z,D,G,W);return ae}function z(q,F,H,D,G,W,K){F.writelen=D,F.writecb=K,F.writing=!0,F.sync=!0,H?q._writev(G,F.onwrite):q._write(G,W,F.onwrite),F.sync=!1}function ne(q,F,H,D,G){--F.pendingcb,H?(g.nextTick(G,D),g.nextTick(P,q,F),q._writableState.errorEmitted=!0,q.emit("error",D)):(G(D),q._writableState.errorEmitted=!0,q.emit("error",D),P(q,F))}function ue(q){q.writing=!1,q.writecb=null,q.length-=q.writelen,q.writelen=0}function he(q,F){var H=q._writableState,D=H.sync,G=H.writecb;if(ue(H),F)ne(q,H,D,F,G);else{var W=j(H);!W&&!H.corked&&!H.bufferProcessing&&H.bufferedRequest&&J(q,H),D?h(Y,q,H,W,G):Y(q,H,W,G)}}function Y(q,F,H,D){H||X(q,F),F.pendingcb--,D(),P(q,F)}function X(q,F){F.length===0&&F.needDrain&&(F.needDrain=!1,q.emit("drain"))}function J(q,F){F.bufferProcessing=!0;var H=F.bufferedRequest;if(q._writev&&H&&H.next){var D=F.bufferedRequestCount,G=new Array(D),W=F.corkedRequestsFree;W.entry=H;for(var K=0,Z=!0;H;)G[K]=H,H.isBuf||(Z=!1),H=H.next,K+=1;G.allBuffers=Z,z(q,F,!0,F.length,G,"",W.finish),F.pendingcb++,F.lastBufferedRequest=null,W.next?(F.corkedRequestsFree=W.next,W.next=null):F.corkedRequestsFree=new u(F),F.bufferedRequestCount=0}else{for(;H;){var ae=H.chunk,le=H.encoding,te=H.callback,ce=F.objectMode?1:ae.length;if(z(q,F,!1,ce,ae,le,te),H=H.next,F.bufferedRequestCount--,F.writing)break}H===null&&(F.lastBufferedRequest=null)}F.bufferedRequest=H,F.bufferProcessing=!1}I.prototype._write=function(q,F,H){H(new Error("_write() is not implemented"))},I.prototype._writev=null,I.prototype.end=function(q,F,H){var D=this._writableState;typeof q=="function"?(H=q,q=null,F=null):typeof F=="function"&&(H=F,F=null),q!=null&&this.write(q,F),D.corked&&(D.corked=1,this.uncork()),D.ending||O(this,D,H)};function j(q){return q.ending&&q.length===0&&q.bufferedRequest===null&&!q.finished&&!q.writing}function M(q,F){q._final(function(H){F.pendingcb--,H&&q.emit("error",H),F.prefinished=!0,q.emit("prefinish"),P(q,F)})}function N(q,F){!F.prefinished&&!F.finalCalled&&(typeof q._final=="function"?(F.pendingcb++,F.finalCalled=!0,g.nextTick(M,q,F)):(F.prefinished=!0,q.emit("prefinish")))}function P(q,F){var H=j(F);return H&&(N(q,F),F.pendingcb===0&&(F.finished=!0,q.emit("finish"))),H}function O(q,F,H){F.ending=!0,P(q,F),H&&(F.finished?g.nextTick(H):q.once("finish",H)),F.ended=!0,q.writable=!1}function k(q,F,H){var D=q.entry;for(q.entry=null;D;){var G=D.callback;F.pendingcb--,G(H),D=D.next}F.corkedRequestsFree.next=q}return Object.defineProperty(I.prototype,"destroyed",{get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(q){this._writableState&&(this._writableState.destroyed=q)}}),I.prototype.destroy=R.destroy,I.prototype._undestroy=R.undestroy,I.prototype._destroy=function(q,F){this.end(),F(q)},_stream_writable}var _stream_duplex,hasRequired_stream_duplex;function require_stream_duplex(){if(hasRequired_stream_duplex)return _stream_duplex;hasRequired_stream_duplex=1;var g=requireProcessNextickArgs(),u=Object.keys||function(R){var x=[];for(var T in R)x.push(T);return x};_stream_duplex=_;var h=Object.create(requireUtil$1());h.inherits=requireInherits_browser();var y=require_stream_readable(),v=require_stream_writable();h.inherits(_,y);for(var b=u(v.prototype),w=0;w<b.length;w++){var E=b[w];_.prototype[E]||(_.prototype[E]=v.prototype[E])}function _(R){if(!(this instanceof _))return new _(R);y.call(this,R),v.call(this,R),R&&R.readable===!1&&(this.readable=!1),R&&R.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,R&&R.allowHalfOpen===!1&&(this.allowHalfOpen=!1),this.once("end",S)}Object.defineProperty(_.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function S(){this.allowHalfOpen||this._writableState.ended||g.nextTick(A,this)}function A(R){R.end()}return Object.defineProperty(_.prototype,"destroyed",{get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(R){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=R,this._writableState.destroyed=R)}}),_.prototype._destroy=function(R,x){this.push(null),this.end(),g.nextTick(x,R)},_stream_duplex}var _stream_readable,hasRequired_stream_readable;function require_stream_readable(){if(hasRequired_stream_readable)return _stream_readable;hasRequired_stream_readable=1;var g=requireProcessNextickArgs();_stream_readable=B;var u=requireIsarray(),h;B.ReadableState=$,requireEvents().EventEmitter;var y=function(te,ce){return te.listeners(ce).length},v=requireStreamBrowser(),b=requireSafeBuffer().Buffer,w=(typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function E(te){return b.from(te)}function _(te){return b.isBuffer(te)||te instanceof w}var S=Object.create(requireUtil$1());S.inherits=requireInherits_browser();var A=requireUtil$2(),R=void 0;A&&A.debuglog?R=A.debuglog("stream"):R=function(){};var x=requireBufferList(),T=requireDestroy$1(),C;S.inherits(B,v);var I=["error","close","destroy","pause","resume"];function L(te,ce,ge){if(typeof te.prependListener=="function")return te.prependListener(ce,ge);!te._events||!te._events[ce]?te.on(ce,ge):u(te._events[ce])?te._events[ce].unshift(ge):te._events[ce]=[ge,te._events[ce]]}function $(te,ce){h=h||require_stream_duplex(),te=te||{};var ge=ce instanceof h;this.objectMode=!!te.objectMode,ge&&(this.objectMode=this.objectMode||!!te.readableObjectMode);var Ee=te.highWaterMark,pe=te.readableHighWaterMark,de=this.objectMode?16:16*1024;Ee||Ee===0?this.highWaterMark=Ee:ge&&(pe||pe===0)?this.highWaterMark=pe:this.highWaterMark=de,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new x,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=te.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,te.encoding&&(C||(C=requireString_decoder().StringDecoder),this.decoder=new C(te.encoding),this.encoding=te.encoding)}function B(te){if(h=h||require_stream_duplex(),!(this instanceof B))return new B(te);this._readableState=new $(te,this),this.readable=!0,te&&(typeof te.read=="function"&&(this._read=te.read),typeof te.destroy=="function"&&(this._destroy=te.destroy)),v.call(this)}Object.defineProperty(B.prototype,"destroyed",{get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(te){this._readableState&&(this._readableState.destroyed=te)}}),B.prototype.destroy=T.destroy,B.prototype._undestroy=T.undestroy,B.prototype._destroy=function(te,ce){this.push(null),ce(te)},B.prototype.push=function(te,ce){var ge=this._readableState,Ee;return ge.objectMode?Ee=!0:typeof te=="string"&&(ce=ce||ge.defaultEncoding,ce!==ge.encoding&&(te=b.from(te,ce),ce=""),Ee=!0),U(this,te,ce,!1,Ee)},B.prototype.unshift=function(te){return U(this,te,null,!0,!1)};function U(te,ce,ge,Ee,pe){var de=te._readableState;if(ce===null)de.reading=!1,J(te,de);else{var me;pe||(me=ne(de,ce)),me?te.emit("error",me):de.objectMode||ce&&ce.length>0?(typeof ce!="string"&&!de.objectMode&&Object.getPrototypeOf(ce)!==b.prototype&&(ce=E(ce)),Ee?de.endEmitted?te.emit("error",new Error("stream.unshift() after end event")):z(te,de,ce,!0):de.ended?te.emit("error",new Error("stream.push() after EOF")):(de.reading=!1,de.decoder&&!ge?(ce=de.decoder.write(ce),de.objectMode||ce.length!==0?z(te,de,ce,!1):N(te,de)):z(te,de,ce,!1))):Ee||(de.reading=!1)}return ue(de)}function z(te,ce,ge,Ee){ce.flowing&&ce.length===0&&!ce.sync?(te.emit("data",ge),te.read(0)):(ce.length+=ce.objectMode?1:ge.length,Ee?ce.buffer.unshift(ge):ce.buffer.push(ge),ce.needReadable&&j(te)),N(te,ce)}function ne(te,ce){var ge;return!_(ce)&&typeof ce!="string"&&ce!==void 0&&!te.objectMode&&(ge=new TypeError("Invalid non-string/buffer chunk")),ge}function ue(te){return!te.ended&&(te.needReadable||te.length<te.highWaterMark||te.length===0)}B.prototype.isPaused=function(){return this._readableState.flowing===!1},B.prototype.setEncoding=function(te){return C||(C=requireString_decoder().StringDecoder),this._readableState.decoder=new C(te),this._readableState.encoding=te,this};var he=8388608;function Y(te){return te>=he?te=he:(te--,te|=te>>>1,te|=te>>>2,te|=te>>>4,te|=te>>>8,te|=te>>>16,te++),te}function X(te,ce){return te<=0||ce.length===0&&ce.ended?0:ce.objectMode?1:te!==te?ce.flowing&&ce.length?ce.buffer.head.data.length:ce.length:(te>ce.highWaterMark&&(ce.highWaterMark=Y(te)),te<=ce.length?te:ce.ended?ce.length:(ce.needReadable=!0,0))}B.prototype.read=function(te){R("read",te),te=parseInt(te,10);var ce=this._readableState,ge=te;if(te!==0&&(ce.emittedReadable=!1),te===0&&ce.needReadable&&(ce.length>=ce.highWaterMark||ce.ended))return R("read: emitReadable",ce.length,ce.ended),ce.length===0&&ce.ended?Z(this):j(this),null;if(te=X(te,ce),te===0&&ce.ended)return ce.length===0&&Z(this),null;var Ee=ce.needReadable;R("need readable",Ee),(ce.length===0||ce.length-te<ce.highWaterMark)&&(Ee=!0,R("length less than watermark",Ee)),ce.ended||ce.reading?(Ee=!1,R("reading or ended",Ee)):Ee&&(R("do read"),ce.reading=!0,ce.sync=!0,ce.length===0&&(ce.needReadable=!0),this._read(ce.highWaterMark),ce.sync=!1,ce.reading||(te=X(ge,ce)));var pe;return te>0?pe=D(te,ce):pe=null,pe===null?(ce.needReadable=!0,te=0):ce.length-=te,ce.length===0&&(ce.ended||(ce.needReadable=!0),ge!==te&&ce.ended&&Z(this)),pe!==null&&this.emit("data",pe),pe};function J(te,ce){if(!ce.ended){if(ce.decoder){var ge=ce.decoder.end();ge&&ge.length&&(ce.buffer.push(ge),ce.length+=ce.objectMode?1:ge.length)}ce.ended=!0,j(te)}}function j(te){var ce=te._readableState;ce.needReadable=!1,ce.emittedReadable||(R("emitReadable",ce.flowing),ce.emittedReadable=!0,ce.sync?g.nextTick(M,te):M(te))}function M(te){R("emit readable"),te.emit("readable"),H(te)}function N(te,ce){ce.readingMore||(ce.readingMore=!0,g.nextTick(P,te,ce))}function P(te,ce){for(var ge=ce.length;!ce.reading&&!ce.flowing&&!ce.ended&&ce.length<ce.highWaterMark&&(R("maybeReadMore read 0"),te.read(0),ge!==ce.length);)ge=ce.length;ce.readingMore=!1}B.prototype._read=function(te){this.emit("error",new Error("_read() is not implemented"))},B.prototype.pipe=function(te,ce){var ge=this,Ee=this._readableState;switch(Ee.pipesCount){case 0:Ee.pipes=te;break;case 1:Ee.pipes=[Ee.pipes,te];break;default:Ee.pipes.push(te);break}Ee.pipesCount+=1,R("pipe count=%d opts=%j",Ee.pipesCount,ce);var pe=(!ce||ce.end!==!1)&&te!==process$1.stdout&&te!==process$1.stderr,de=pe?_e:We;Ee.endEmitted?g.nextTick(de):ge.once("end",de),te.on("unpipe",me);function me(ze,Xe){R("onunpipe"),ze===ge&&Xe&&Xe.hasUnpiped===!1&&(Xe.hasUnpiped=!0,Me())}function _e(){R("onend"),te.end()}var Ae=O(ge);te.on("drain",Ae);var Pe=!1;function Me(){R("cleanup"),te.removeListener("close",Oe),te.removeListener("finish",Ce),te.removeListener("drain",Ae),te.removeListener("error",Le),te.removeListener("unpipe",me),ge.removeListener("end",_e),ge.removeListener("end",We),ge.removeListener("data",we),Pe=!0,Ee.awaitDrain&&(!te._writableState||te._writableState.needDrain)&&Ae()}var Ne=!1;ge.on("data",we);function we(ze){R("ondata"),Ne=!1;var Xe=te.write(ze);Xe===!1&&!Ne&&((Ee.pipesCount===1&&Ee.pipes===te||Ee.pipesCount>1&&le(Ee.pipes,te)!==-1)&&!Pe&&(R("false write response, pause",Ee.awaitDrain),Ee.awaitDrain++,Ne=!0),ge.pause())}function Le(ze){R("onerror",ze),We(),te.removeListener("error",Le),y(te,"error")===0&&te.emit("error",ze)}L(te,"error",Le);function Oe(){te.removeListener("finish",Ce),We()}te.once("close",Oe);function Ce(){R("onfinish"),te.removeListener("close",Oe),We()}te.once("finish",Ce);function We(){R("unpipe"),ge.unpipe(te)}return te.emit("pipe",ge),Ee.flowing||(R("pipe resume"),ge.resume()),te};function O(te){return function(){var ce=te._readableState;R("pipeOnDrain",ce.awaitDrain),ce.awaitDrain&&ce.awaitDrain--,ce.awaitDrain===0&&y(te,"data")&&(ce.flowing=!0,H(te))}}B.prototype.unpipe=function(te){var ce=this._readableState,ge={hasUnpiped:!1};if(ce.pipesCount===0)return this;if(ce.pipesCount===1)return te&&te!==ce.pipes?this:(te||(te=ce.pipes),ce.pipes=null,ce.pipesCount=0,ce.flowing=!1,te&&te.emit("unpipe",this,ge),this);if(!te){var Ee=ce.pipes,pe=ce.pipesCount;ce.pipes=null,ce.pipesCount=0,ce.flowing=!1;for(var de=0;de<pe;de++)Ee[de].emit("unpipe",this,{hasUnpiped:!1});return this}var me=le(ce.pipes,te);return me===-1?this:(ce.pipes.splice(me,1),ce.pipesCount-=1,ce.pipesCount===1&&(ce.pipes=ce.pipes[0]),te.emit("unpipe",this,ge),this)},B.prototype.on=function(te,ce){var ge=v.prototype.on.call(this,te,ce);if(te==="data")this._readableState.flowing!==!1&&this.resume();else if(te==="readable"){var Ee=this._readableState;!Ee.endEmitted&&!Ee.readableListening&&(Ee.readableListening=Ee.needReadable=!0,Ee.emittedReadable=!1,Ee.reading?Ee.length&&j(this):g.nextTick(k,this))}return ge},B.prototype.addListener=B.prototype.on;function k(te){R("readable nexttick read 0"),te.read(0)}B.prototype.resume=function(){var te=this._readableState;return te.flowing||(R("resume"),te.flowing=!0,q(this,te)),this};function q(te,ce){ce.resumeScheduled||(ce.resumeScheduled=!0,g.nextTick(F,te,ce))}function F(te,ce){ce.reading||(R("resume read 0"),te.read(0)),ce.resumeScheduled=!1,ce.awaitDrain=0,te.emit("resume"),H(te),ce.flowing&&!ce.reading&&te.read(0)}B.prototype.pause=function(){return R("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(R("pause"),this._readableState.flowing=!1,this.emit("pause")),this};function H(te){var ce=te._readableState;for(R("flow",ce.flowing);ce.flowing&&te.read()!==null;);}B.prototype.wrap=function(te){var ce=this,ge=this._readableState,Ee=!1;te.on("end",function(){if(R("wrapped end"),ge.decoder&&!ge.ended){var me=ge.decoder.end();me&&me.length&&ce.push(me)}ce.push(null)}),te.on("data",function(me){if(R("wrapped data"),ge.decoder&&(me=ge.decoder.write(me)),!(ge.objectMode&&me==null)&&!(!ge.objectMode&&(!me||!me.length))){var _e=ce.push(me);_e||(Ee=!0,te.pause())}});for(var pe in te)this[pe]===void 0&&typeof te[pe]=="function"&&(this[pe]=(function(me){return function(){return te[me].apply(te,arguments)}})(pe));for(var de=0;de<I.length;de++)te.on(I[de],this.emit.bind(this,I[de]));return this._read=function(me){R("wrapped _read",me),Ee&&(Ee=!1,te.resume())},this},Object.defineProperty(B.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),B._fromList=D;function D(te,ce){if(ce.length===0)return null;var ge;return ce.objectMode?ge=ce.buffer.shift():!te||te>=ce.length?(ce.decoder?ge=ce.buffer.join(""):ce.buffer.length===1?ge=ce.buffer.head.data:ge=ce.buffer.concat(ce.length),ce.buffer.clear()):ge=G(te,ce.buffer,ce.decoder),ge}function G(te,ce,ge){var Ee;return te<ce.head.data.length?(Ee=ce.head.data.slice(0,te),ce.head.data=ce.head.data.slice(te)):te===ce.head.data.length?Ee=ce.shift():Ee=ge?W(te,ce):K(te,ce),Ee}function W(te,ce){var ge=ce.head,Ee=1,pe=ge.data;for(te-=pe.length;ge=ge.next;){var de=ge.data,me=te>de.length?de.length:te;if(me===de.length?pe+=de:pe+=de.slice(0,te),te-=me,te===0){me===de.length?(++Ee,ge.next?ce.head=ge.next:ce.head=ce.tail=null):(ce.head=ge,ge.data=de.slice(me));break}++Ee}return ce.length-=Ee,pe}function K(te,ce){var ge=b.allocUnsafe(te),Ee=ce.head,pe=1;for(Ee.data.copy(ge),te-=Ee.data.length;Ee=Ee.next;){var de=Ee.data,me=te>de.length?de.length:te;if(de.copy(ge,ge.length-te,0,me),te-=me,te===0){me===de.length?(++pe,Ee.next?ce.head=Ee.next:ce.head=ce.tail=null):(ce.head=Ee,Ee.data=de.slice(me));break}++pe}return ce.length-=pe,ge}function Z(te){var ce=te._readableState;if(ce.length>0)throw new Error('"endReadable()" called on non-empty stream');ce.endEmitted||(ce.ended=!0,g.nextTick(ae,ce,te))}function ae(te,ce){!te.endEmitted&&te.length===0&&(te.endEmitted=!0,ce.readable=!1,ce.emit("end"))}function le(te,ce){for(var ge=0,Ee=te.length;ge<Ee;ge++)if(te[ge]===ce)return ge;return-1}return _stream_readable}var _stream_transform,hasRequired_stream_transform;function require_stream_transform(){if(hasRequired_stream_transform)return _stream_transform;hasRequired_stream_transform=1,_stream_transform=y;var g=require_stream_duplex(),u=Object.create(requireUtil$1());u.inherits=requireInherits_browser(),u.inherits(y,g);function h(w,E){var _=this._transformState;_.transforming=!1;var S=_.writecb;if(!S)return this.emit("error",new Error("write callback called multiple times"));_.writechunk=null,_.writecb=null,E!=null&&this.push(E),S(w);var A=this._readableState;A.reading=!1,(A.needReadable||A.length<A.highWaterMark)&&this._read(A.highWaterMark)}function y(w){if(!(this instanceof y))return new y(w);g.call(this,w),this._transformState={afterTransform:h.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,w&&(typeof w.transform=="function"&&(this._transform=w.transform),typeof w.flush=="function"&&(this._flush=w.flush)),this.on("prefinish",v)}function v(){var w=this;typeof this._flush=="function"?this._flush(function(E,_){b(w,E,_)}):b(this,null,null)}y.prototype.push=function(w,E){return this._transformState.needTransform=!1,g.prototype.push.call(this,w,E)},y.prototype._transform=function(w,E,_){throw new Error("_transform() is not implemented")},y.prototype._write=function(w,E,_){var S=this._transformState;if(S.writecb=_,S.writechunk=w,S.writeencoding=E,!S.transforming){var A=this._readableState;(S.needTransform||A.needReadable||A.length<A.highWaterMark)&&this._read(A.highWaterMark)}},y.prototype._read=function(w){var E=this._transformState;E.writechunk!==null&&E.writecb&&!E.transforming?(E.transforming=!0,this._transform(E.writechunk,E.writeencoding,E.afterTransform)):E.needTransform=!0},y.prototype._destroy=function(w,E){var _=this;g.prototype._destroy.call(this,w,function(S){E(S),_.emit("close")})};function b(w,E,_){if(E)return w.emit("error",E);if(_!=null&&w.push(_),w._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(w._transformState.transforming)throw new Error("Calling transform done when still transforming");return w.push(null)}return _stream_transform}var _stream_passthrough,hasRequired_stream_passthrough;function require_stream_passthrough(){if(hasRequired_stream_passthrough)return _stream_passthrough;hasRequired_stream_passthrough=1,_stream_passthrough=h;var g=require_stream_transform(),u=Object.create(requireUtil$1());u.inherits=requireInherits_browser(),u.inherits(h,g);function h(y){if(!(this instanceof h))return new h(y);g.call(this,y)}return h.prototype._transform=function(y,v,b){b(null,y)},_stream_passthrough}var hasRequiredReadableBrowser;function requireReadableBrowser(){return hasRequiredReadableBrowser||(hasRequiredReadableBrowser=1,(function(g,u){u=g.exports=require_stream_readable(),u.Stream=u,u.Readable=u,u.Writable=require_stream_writable(),u.Duplex=require_stream_duplex(),u.Transform=require_stream_transform(),u.PassThrough=require_stream_passthrough()})(readableBrowser,readableBrowser.exports)),readableBrowser.exports}var sign$1={exports:{}},browserifyRsa,hasRequiredBrowserifyRsa;function requireBrowserifyRsa(){if(hasRequiredBrowserifyRsa)return browserifyRsa;hasRequiredBrowserifyRsa=1;var g=requireBn$1(),u=requireBrowser$c(),h=requireSafeBuffer$1().Buffer;function y(w){var E=w.modulus.byteLength(),_;do _=new g(u(E));while(_.cmp(w.modulus)>=0||!_.umod(w.prime1)||!_.umod(w.prime2));return _}function v(w){var E=y(w),_=E.toRed(g.mont(w.modulus)).redPow(new g(w.publicExponent)).fromRed();return{blinder:_,unblinder:E.invm(w.modulus)}}function b(w,E){var _=v(E),S=E.modulus.byteLength(),A=new g(w).mul(_.blinder).umod(E.modulus),R=A.toRed(g.mont(E.prime1)),x=A.toRed(g.mont(E.prime2)),T=E.coefficient,C=E.prime1,I=E.prime2,L=R.redPow(E.exponent1).fromRed(),$=x.redPow(E.exponent2).fromRed(),B=L.isub($).imul(T).umod(C).imul(I);return $.iadd(B).imul(_.unblinder).umod(E.modulus).toArrayLike(h,"be",S)}return b.getr=y,browserifyRsa=b,browserifyRsa}var asn1$1={},asn1={},api={},vmBrowserify={},hasRequiredVmBrowserify;function requireVmBrowserify(){return hasRequiredVmBrowserify||(hasRequiredVmBrowserify=1,(function(exports){var indexOf=function(g,u){if(g.indexOf)return g.indexOf(u);for(var h=0;h<g.length;h++)if(g[h]===u)return h;return-1},Object_keys=function(g){if(Object.keys)return Object.keys(g);var u=[];for(var h in g)u.push(h);return u},forEach=function(g,u){if(g.forEach)return g.forEach(u);for(var h=0;h<g.length;h++)u(g[h],h,g)},defineProp=(function(){try{return Object.defineProperty({},"_",{}),function(g,u,h){Object.defineProperty(g,u,{writable:!0,enumerable:!1,configurable:!0,value:h})}}catch{return function(u,h,y){u[h]=y}}})(),globals=["Array","Boolean","Date","Error","EvalError","Function","Infinity","JSON","Math","NaN","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","eval","isFinite","isNaN","parseFloat","parseInt","undefined","unescape"];function Context(){}Context.prototype={};var Script=exports.Script=function(u){if(!(this instanceof Script))return new Script(u);this.code=u};Script.prototype.runInContext=function(g){if(!(g instanceof Context))throw new TypeError("needs a 'context' argument.");var u=document.createElement("iframe");u.style||(u.style={}),u.style.display="none",document.body.appendChild(u);var h=u.contentWindow,y=h.eval,v=h.execScript;!y&&v&&(v.call(h,"null"),y=h.eval),forEach(Object_keys(g),function(E){h[E]=g[E]}),forEach(globals,function(E){g[E]&&(h[E]=g[E])});var b=Object_keys(h),w=y.call(h,this.code);return forEach(Object_keys(h),function(E){(E in g||indexOf(b,E)===-1)&&(g[E]=h[E])}),forEach(globals,function(E){E in g||defineProp(g,E,h[E])}),document.body.removeChild(u),w},Script.prototype.runInThisContext=function(){return eval(this.code)},Script.prototype.runInNewContext=function(g){var u=Script.createContext(g),h=this.runInContext(u);return g&&forEach(Object_keys(u),function(y){g[y]=u[y]}),h},forEach(Object_keys(Script.prototype),function(g){exports[g]=Script[g]=function(u){var h=Script(u);return h[g].apply(h,[].slice.call(arguments,1))}}),exports.isContext=function(g){return g instanceof Context},exports.createScript=function(g){return exports.Script(g)},exports.createContext=Script.createContext=function(g){var u=new Context;return typeof g=="object"&&forEach(Object_keys(g),function(h){u[h]=g[h]}),u}})(vmBrowserify)),vmBrowserify}var hasRequiredApi;function requireApi(){return hasRequiredApi||(hasRequiredApi=1,(function(g){var u=requireAsn1$1(),h=requireInherits_browser(),y=g;y.define=function(w,E){return new v(w,E)};function v(b,w){this.name=b,this.body=w,this.decoders={},this.encoders={}}v.prototype._createNamed=function(w){var E;try{E=requireVmBrowserify().runInThisContext("(function "+this.name+`(entity) {
  this._initNamed(entity);
})`)}catch{E=function(S){this._initNamed(S)}}return h(E,w),E.prototype._initNamed=function(S){w.call(this,S)},new E(this)},v.prototype._getDecoder=function(w){return w=w||"der",this.decoders.hasOwnProperty(w)||(this.decoders[w]=this._createNamed(u.decoders[w])),this.decoders[w]},v.prototype.decode=function(w,E,_){return this._getDecoder(E).decode(w,_)},v.prototype._getEncoder=function(w){return w=w||"der",this.encoders.hasOwnProperty(w)||(this.encoders[w]=this._createNamed(u.encoders[w])),this.encoders[w]},v.prototype.encode=function(w,E,_){return this._getEncoder(E).encode(w,_)}})(api)),api}var base$1={},reporter={},hasRequiredReporter;function requireReporter(){if(hasRequiredReporter)return reporter;hasRequiredReporter=1;var g=requireInherits_browser();function u(y){this._reporterState={obj:null,path:[],options:y||{},errors:[]}}reporter.Reporter=u,u.prototype.isError=function(v){return v instanceof h},u.prototype.save=function(){var v=this._reporterState;return{obj:v.obj,pathLen:v.path.length}},u.prototype.restore=function(v){var b=this._reporterState;b.obj=v.obj,b.path=b.path.slice(0,v.pathLen)},u.prototype.enterKey=function(v){return this._reporterState.path.push(v)},u.prototype.exitKey=function(v){var b=this._reporterState;b.path=b.path.slice(0,v-1)},u.prototype.leaveKey=function(v,b,w){var E=this._reporterState;this.exitKey(v),E.obj!==null&&(E.obj[b]=w)},u.prototype.path=function(){return this._reporterState.path.join("/")},u.prototype.enterObject=function(){var v=this._reporterState,b=v.obj;return v.obj={},b},u.prototype.leaveObject=function(v){var b=this._reporterState,w=b.obj;return b.obj=v,w},u.prototype.error=function(v){var b,w=this._reporterState,E=v instanceof h;if(E?b=v:b=new h(w.path.map(function(_){return"["+JSON.stringify(_)+"]"}).join(""),v.message||v,v.stack),!w.options.partial)throw b;return E||w.errors.push(b),b},u.prototype.wrapResult=function(v){var b=this._reporterState;return b.options.partial?{result:this.isError(v)?null:v,errors:b.errors}:v};function h(y,v){this.path=y,this.rethrow(v)}return g(h,Error),h.prototype.rethrow=function(v){if(this.message=v+" at: "+(this.path||"(shallow)"),Error.captureStackTrace&&Error.captureStackTrace(this,h),!this.stack)try{throw new Error(this.message)}catch(b){this.stack=b.stack}return this},reporter}var buffer={},hasRequiredBuffer;function requireBuffer(){if(hasRequiredBuffer)return buffer;hasRequiredBuffer=1;var g=requireInherits_browser(),u=requireBase$1().Reporter,h=requireDist$1().Buffer;function y(b,w){if(u.call(this,w),!h.isBuffer(b)){this.error("Input not Buffer");return}this.base=b,this.offset=0,this.length=b.length}g(y,u),buffer.DecoderBuffer=y,y.prototype.save=function(){return{offset:this.offset,reporter:u.prototype.save.call(this)}},y.prototype.restore=function(w){var E=new y(this.base);return E.offset=w.offset,E.length=this.offset,this.offset=w.offset,u.prototype.restore.call(this,w.reporter),E},y.prototype.isEmpty=function(){return this.offset===this.length},y.prototype.readUInt8=function(w){return this.offset+1<=this.length?this.base.readUInt8(this.offset++,!0):this.error(w||"DecoderBuffer overrun")},y.prototype.skip=function(w,E){if(!(this.offset+w<=this.length))return this.error(E||"DecoderBuffer overrun");var _=new y(this.base);return _._reporterState=this._reporterState,_.offset=this.offset,_.length=this.offset+w,this.offset+=w,_},y.prototype.raw=function(w){return this.base.slice(w?w.offset:this.offset,this.length)};function v(b,w){if(Array.isArray(b))this.length=0,this.value=b.map(function(E){return E instanceof v||(E=new v(E,w)),this.length+=E.length,E},this);else if(typeof b=="number"){if(!(0<=b&&b<=255))return w.error("non-byte EncoderBuffer value");this.value=b,this.length=1}else if(typeof b=="string")this.value=b,this.length=h.byteLength(b);else if(h.isBuffer(b))this.value=b,this.length=b.length;else return w.error("Unsupported type: "+typeof b)}return buffer.EncoderBuffer=v,v.prototype.join=function(w,E){return w||(w=new h(this.length)),E||(E=0),this.length===0||(Array.isArray(this.value)?this.value.forEach(function(_){_.join(w,E),E+=_.length}):(typeof this.value=="number"?w[E]=this.value:typeof this.value=="string"?w.write(this.value,E):h.isBuffer(this.value)&&this.value.copy(w,E),E+=this.length)),w},buffer}var node,hasRequiredNode;function requireNode(){if(hasRequiredNode)return node;hasRequiredNode=1;var g=requireBase$1().Reporter,u=requireBase$1().EncoderBuffer,h=requireBase$1().DecoderBuffer,y=requireMinimalisticAssert(),v=["seq","seqof","set","setof","objid","bool","gentime","utctime","null_","enum","int","objDesc","bitstr","bmpstr","charstr","genstr","graphstr","ia5str","iso646str","numstr","octstr","printstr","t61str","unistr","utf8str","videostr"],b=["key","obj","use","optional","explicit","implicit","def","choice","any","contains"].concat(v),w=["_peekTag","_decodeTag","_use","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeInt","_decodeBool","_decodeList","_encodeComposite","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool"];function E(S,A){var R={};this._baseState=R,R.enc=S,R.parent=A||null,R.children=null,R.tag=null,R.args=null,R.reverseArgs=null,R.choice=null,R.optional=!1,R.any=!1,R.obj=!1,R.use=null,R.useDecoder=null,R.key=null,R.default=null,R.explicit=null,R.implicit=null,R.contains=null,R.parent||(R.children=[],this._wrap())}node=E;var _=["enc","parent","children","tag","args","reverseArgs","choice","optional","any","obj","use","alteredUse","key","default","explicit","implicit","contains"];return E.prototype.clone=function(){var A=this._baseState,R={};_.forEach(function(T){R[T]=A[T]});var x=new this.constructor(R.parent);return x._baseState=R,x},E.prototype._wrap=function(){var A=this._baseState;b.forEach(function(R){this[R]=function(){var T=new this.constructor(this);return A.children.push(T),T[R].apply(T,arguments)}},this)},E.prototype._init=function(A){var R=this._baseState;y(R.parent===null),A.call(this),R.children=R.children.filter(function(x){return x._baseState.parent===this},this),y.equal(R.children.length,1,"Root node can have only one child")},E.prototype._useArgs=function(A){var R=this._baseState,x=A.filter(function(T){return T instanceof this.constructor},this);A=A.filter(function(T){return!(T instanceof this.constructor)},this),x.length!==0&&(y(R.children===null),R.children=x,x.forEach(function(T){T._baseState.parent=this},this)),A.length!==0&&(y(R.args===null),R.args=A,R.reverseArgs=A.map(function(T){if(typeof T!="object"||T.constructor!==Object)return T;var C={};return Object.keys(T).forEach(function(I){I==(I|0)&&(I|=0);var L=T[I];C[L]=I}),C}))},w.forEach(function(S){E.prototype[S]=function(){var R=this._baseState;throw new Error(S+" not implemented for encoding: "+R.enc)}}),v.forEach(function(S){E.prototype[S]=function(){var R=this._baseState,x=Array.prototype.slice.call(arguments);return y(R.tag===null),R.tag=S,this._useArgs(x),this}}),E.prototype.use=function(A){y(A);var R=this._baseState;return y(R.use===null),R.use=A,this},E.prototype.optional=function(){var A=this._baseState;return A.optional=!0,this},E.prototype.def=function(A){var R=this._baseState;return y(R.default===null),R.default=A,R.optional=!0,this},E.prototype.explicit=function(A){var R=this._baseState;return y(R.explicit===null&&R.implicit===null),R.explicit=A,this},E.prototype.implicit=function(A){var R=this._baseState;return y(R.explicit===null&&R.implicit===null),R.implicit=A,this},E.prototype.obj=function(){var A=this._baseState,R=Array.prototype.slice.call(arguments);return A.obj=!0,R.length!==0&&this._useArgs(R),this},E.prototype.key=function(A){var R=this._baseState;return y(R.key===null),R.key=A,this},E.prototype.any=function(){var A=this._baseState;return A.any=!0,this},E.prototype.choice=function(A){var R=this._baseState;return y(R.choice===null),R.choice=A,this._useArgs(Object.keys(A).map(function(x){return A[x]})),this},E.prototype.contains=function(A){var R=this._baseState;return y(R.use===null),R.contains=A,this},E.prototype._decode=function(A,R){var x=this._baseState;if(x.parent===null)return A.wrapResult(x.children[0]._decode(A,R));var T=x.default,C=!0,I=null;if(x.key!==null&&(I=A.enterKey(x.key)),x.optional){var L=null;if(x.explicit!==null?L=x.explicit:x.implicit!==null?L=x.implicit:x.tag!==null&&(L=x.tag),L===null&&!x.any){var $=A.save();try{x.choice===null?this._decodeGeneric(x.tag,A,R):this._decodeChoice(A,R),C=!0}catch{C=!1}A.restore($)}else if(C=this._peekTag(A,L,x.any),A.isError(C))return C}var B;if(x.obj&&C&&(B=A.enterObject()),C){if(x.explicit!==null){var U=this._decodeTag(A,x.explicit);if(A.isError(U))return U;A=U}var z=A.offset;if(x.use===null&&x.choice===null){if(x.any)var $=A.save();var ne=this._decodeTag(A,x.implicit!==null?x.implicit:x.tag,x.any);if(A.isError(ne))return ne;x.any?T=A.raw($):A=ne}if(R&&R.track&&x.tag!==null&&R.track(A.path(),z,A.length,"tagged"),R&&R.track&&x.tag!==null&&R.track(A.path(),A.offset,A.length,"content"),x.any?T=T:x.choice===null?T=this._decodeGeneric(x.tag,A,R):T=this._decodeChoice(A,R),A.isError(T))return T;if(!x.any&&x.choice===null&&x.children!==null&&x.children.forEach(function(Y){Y._decode(A,R)}),x.contains&&(x.tag==="octstr"||x.tag==="bitstr")){var ue=new h(T);T=this._getUse(x.contains,A._reporterState.obj)._decode(ue,R)}}return x.obj&&C&&(T=A.leaveObject(B)),x.key!==null&&(T!==null||C===!0)?A.leaveKey(I,x.key,T):I!==null&&A.exitKey(I),T},E.prototype._decodeGeneric=function(A,R,x){var T=this._baseState;return A==="seq"||A==="set"?null:A==="seqof"||A==="setof"?this._decodeList(R,A,T.args[0],x):/str$/.test(A)?this._decodeStr(R,A,x):A==="objid"&&T.args?this._decodeObjid(R,T.args[0],T.args[1],x):A==="objid"?this._decodeObjid(R,null,null,x):A==="gentime"||A==="utctime"?this._decodeTime(R,A,x):A==="null_"?this._decodeNull(R,x):A==="bool"?this._decodeBool(R,x):A==="objDesc"?this._decodeStr(R,A,x):A==="int"||A==="enum"?this._decodeInt(R,T.args&&T.args[0],x):T.use!==null?this._getUse(T.use,R._reporterState.obj)._decode(R,x):R.error("unknown tag: "+A)},E.prototype._getUse=function(A,R){var x=this._baseState;return x.useDecoder=this._use(A,R),y(x.useDecoder._baseState.parent===null),x.useDecoder=x.useDecoder._baseState.children[0],x.implicit!==x.useDecoder._baseState.implicit&&(x.useDecoder=x.useDecoder.clone(),x.useDecoder._baseState.implicit=x.implicit),x.useDecoder},E.prototype._decodeChoice=function(A,R){var x=this._baseState,T=null,C=!1;return Object.keys(x.choice).some(function(I){var L=A.save(),$=x.choice[I];try{var B=$._decode(A,R);if(A.isError(B))return!1;T={type:I,value:B},C=!0}catch{return A.restore(L),!1}return!0},this),C?T:A.error("Choice not matched")},E.prototype._createEncoderBuffer=function(A){return new u(A,this.reporter)},E.prototype._encode=function(A,R,x){var T=this._baseState;if(!(T.default!==null&&T.default===A)){var C=this._encodeValue(A,R,x);if(C!==void 0&&!this._skipDefault(C,R,x))return C}},E.prototype._encodeValue=function(A,R,x){var T=this._baseState;if(T.parent===null)return T.children[0]._encode(A,R||new g);var $=null;if(this.reporter=R,T.optional&&A===void 0)if(T.default!==null)A=T.default;else return;var C=null,I=!1;if(T.any)$=this._createEncoderBuffer(A);else if(T.choice)$=this._encodeChoice(A,R);else if(T.contains)C=this._getUse(T.contains,x)._encode(A,R),I=!0;else if(T.children)C=T.children.map(function(z){if(z._baseState.tag==="null_")return z._encode(null,R,A);if(z._baseState.key===null)return R.error("Child should have a key");var ne=R.enterKey(z._baseState.key);if(typeof A!="object")return R.error("Child expected, but input is not object");var ue=z._encode(A[z._baseState.key],R,A);return R.leaveKey(ne),ue},this).filter(function(z){return z}),C=this._createEncoderBuffer(C);else if(T.tag==="seqof"||T.tag==="setof"){if(!(T.args&&T.args.length===1))return R.error("Too many args for : "+T.tag);if(!Array.isArray(A))return R.error("seqof/setof, but data is not Array");var L=this.clone();L._baseState.implicit=null,C=this._createEncoderBuffer(A.map(function(z){var ne=this._baseState;return this._getUse(ne.args[0],A)._encode(z,R)},L))}else T.use!==null?$=this._getUse(T.use,x)._encode(A,R):(C=this._encodePrimitive(T.tag,A),I=!0);var $;if(!T.any&&T.choice===null){var B=T.implicit!==null?T.implicit:T.tag,U=T.implicit===null?"universal":"context";B===null?T.use===null&&R.error("Tag could be omitted only for .use()"):T.use===null&&($=this._encodeComposite(B,I,U,C))}return T.explicit!==null&&($=this._encodeComposite(T.explicit,!1,"context",$)),$},E.prototype._encodeChoice=function(A,R){var x=this._baseState,T=x.choice[A.type];return T||y(!1,A.type+" not found in "+JSON.stringify(Object.keys(x.choice))),T._encode(A.value,R)},E.prototype._encodePrimitive=function(A,R){var x=this._baseState;if(/str$/.test(A))return this._encodeStr(R,A);if(A==="objid"&&x.args)return this._encodeObjid(R,x.reverseArgs[0],x.args[1]);if(A==="objid")return this._encodeObjid(R,null,null);if(A==="gentime"||A==="utctime")return this._encodeTime(R,A);if(A==="null_")return this._encodeNull();if(A==="int"||A==="enum")return this._encodeInt(R,x.args&&x.reverseArgs[0]);if(A==="bool")return this._encodeBool(R);if(A==="objDesc")return this._encodeStr(R,A);throw new Error("Unsupported tag: "+A)},E.prototype._isNumstr=function(A){return/^[0-9 ]*$/.test(A)},E.prototype._isPrintstr=function(A){return/^[A-Za-z0-9 '\(\)\+,\-\.\/:=\?]*$/.test(A)},node}var hasRequiredBase$1;function requireBase$1(){return hasRequiredBase$1||(hasRequiredBase$1=1,(function(g){var u=g;u.Reporter=requireReporter().Reporter,u.DecoderBuffer=requireBuffer().DecoderBuffer,u.EncoderBuffer=requireBuffer().EncoderBuffer,u.Node=requireNode()})(base$1)),base$1}var constants={},der={},hasRequiredDer$2;function requireDer$2(){return hasRequiredDer$2||(hasRequiredDer$2=1,(function(g){var u=requireConstants();g.tagClass={0:"universal",1:"application",2:"context",3:"private"},g.tagClassByName=u._reverse(g.tagClass),g.tag={0:"end",1:"bool",2:"int",3:"bitstr",4:"octstr",5:"null_",6:"objid",7:"objDesc",8:"external",9:"real",10:"enum",11:"embed",12:"utf8str",13:"relativeOid",16:"seq",17:"set",18:"numstr",19:"printstr",20:"t61str",21:"videostr",22:"ia5str",23:"utctime",24:"gentime",25:"graphstr",26:"iso646str",27:"genstr",28:"unistr",29:"charstr",30:"bmpstr"},g.tagByName=u._reverse(g.tag)})(der)),der}var hasRequiredConstants;function requireConstants(){return hasRequiredConstants||(hasRequiredConstants=1,(function(g){var u=g;u._reverse=function(y){var v={};return Object.keys(y).forEach(function(b){(b|0)==b&&(b=b|0);var w=y[b];v[w]=b}),v},u.der=requireDer$2()})(constants)),constants}var decoders={},der_1$1,hasRequiredDer$1;function requireDer$1(){if(hasRequiredDer$1)return der_1$1;hasRequiredDer$1=1;var g=requireInherits_browser(),u=requireAsn1$1(),h=u.base,y=u.bignum,v=u.constants.der;function b(S){this.enc="der",this.name=S.name,this.entity=S,this.tree=new w,this.tree._init(S.body)}der_1$1=b,b.prototype.decode=function(A,R){return A instanceof h.DecoderBuffer||(A=new h.DecoderBuffer(A,R)),this.tree._decode(A,R)};function w(S){h.Node.call(this,"der",S)}g(w,h.Node),w.prototype._peekTag=function(A,R,x){if(A.isEmpty())return!1;var T=A.save(),C=E(A,'Failed to peek tag: "'+R+'"');return A.isError(C)?C:(A.restore(T),C.tag===R||C.tagStr===R||C.tagStr+"of"===R||x)},w.prototype._decodeTag=function(A,R,x){var T=E(A,'Failed to decode tag of "'+R+'"');if(A.isError(T))return T;var C=_(A,T.primitive,'Failed to get length of "'+R+'"');if(A.isError(C))return C;if(!x&&T.tag!==R&&T.tagStr!==R&&T.tagStr+"of"!==R)return A.error('Failed to match tag: "'+R+'"');if(T.primitive||C!==null)return A.skip(C,'Failed to match body of: "'+R+'"');var I=A.save(),L=this._skipUntilEnd(A,'Failed to skip indefinite length body: "'+this.tag+'"');return A.isError(L)?L:(C=A.offset-I.offset,A.restore(I),A.skip(C,'Failed to match body of: "'+R+'"'))},w.prototype._skipUntilEnd=function(A,R){for(;;){var x=E(A,R);if(A.isError(x))return x;var T=_(A,x.primitive,R);if(A.isError(T))return T;var C;if(x.primitive||T!==null?C=A.skip(T):C=this._skipUntilEnd(A,R),A.isError(C))return C;if(x.tagStr==="end")break}},w.prototype._decodeList=function(A,R,x,T){for(var C=[];!A.isEmpty();){var I=this._peekTag(A,"end");if(A.isError(I))return I;var L=x.decode(A,"der",T);if(A.isError(L)&&I)break;C.push(L)}return C},w.prototype._decodeStr=function(A,R){if(R==="bitstr"){var x=A.readUInt8();return A.isError(x)?x:{unused:x,data:A.raw()}}else if(R==="bmpstr"){var T=A.raw();if(T.length%2===1)return A.error("Decoding of string type: bmpstr length mismatch");for(var C="",I=0;I<T.length/2;I++)C+=String.fromCharCode(T.readUInt16BE(I*2));return C}else if(R==="numstr"){var L=A.raw().toString("ascii");return this._isNumstr(L)?L:A.error("Decoding of string type: numstr unsupported characters")}else{if(R==="octstr")return A.raw();if(R==="objDesc")return A.raw();if(R==="printstr"){var $=A.raw().toString("ascii");return this._isPrintstr($)?$:A.error("Decoding of string type: printstr unsupported characters")}else return/str$/.test(R)?A.raw().toString():A.error("Decoding of string type: "+R+" unsupported")}},w.prototype._decodeObjid=function(A,R,x){for(var T,C=[],I=0;!A.isEmpty();){var L=A.readUInt8();I<<=7,I|=L&127,(L&128)===0&&(C.push(I),I=0)}L&128&&C.push(I);var $=C[0]/40|0,B=C[0]%40;if(x?T=C:T=[$,B].concat(C.slice(1)),R){var U=R[T.join(" ")];U===void 0&&(U=R[T.join(".")]),U!==void 0&&(T=U)}return T},w.prototype._decodeTime=function(A,R){var x=A.raw().toString();if(R==="gentime")var T=x.slice(0,4)|0,C=x.slice(4,6)|0,I=x.slice(6,8)|0,L=x.slice(8,10)|0,$=x.slice(10,12)|0,B=x.slice(12,14)|0;else if(R==="utctime"){var T=x.slice(0,2)|0,C=x.slice(2,4)|0,I=x.slice(4,6)|0,L=x.slice(6,8)|0,$=x.slice(8,10)|0,B=x.slice(10,12)|0;T<70?T=2e3+T:T=1900+T}else return A.error("Decoding "+R+" time is not supported yet");return Date.UTC(T,C-1,I,L,$,B,0)},w.prototype._decodeNull=function(A){return null},w.prototype._decodeBool=function(A){var R=A.readUInt8();return A.isError(R)?R:R!==0},w.prototype._decodeInt=function(A,R){var x=A.raw(),T=new y(x);return R&&(T=R[T.toString(10)]||T),T},w.prototype._use=function(A,R){return typeof A=="function"&&(A=A(R)),A._getDecoder("der").tree};function E(S,A){var R=S.readUInt8(A);if(S.isError(R))return R;var x=v.tagClass[R>>6],T=(R&32)===0;if((R&31)===31){var C=R;for(R=0;(C&128)===128;){if(C=S.readUInt8(A),S.isError(C))return C;R<<=7,R|=C&127}}else R&=31;var I=v.tag[R];return{cls:x,primitive:T,tag:R,tagStr:I}}function _(S,A,R){var x=S.readUInt8(R);if(S.isError(x))return x;if(!A&&x===128)return null;if((x&128)===0)return x;var T=x&127;if(T>4)return S.error("length octect is too long");x=0;for(var C=0;C<T;C++){x<<=8;var I=S.readUInt8(R);if(S.isError(I))return I;x|=I}return x}return der_1$1}var pem$1,hasRequiredPem$1;function requirePem$1(){if(hasRequiredPem$1)return pem$1;hasRequiredPem$1=1;var g=requireInherits_browser(),u=requireDist$1().Buffer,h=requireDer$1();function y(v){h.call(this,v),this.enc="pem"}return g(y,h),pem$1=y,y.prototype.decode=function(b,w){for(var E=b.toString().split(/[\r\n]+/g),_=w.label.toUpperCase(),S=/^-----(BEGIN|END) ([^-]+)-----$/,A=-1,R=-1,x=0;x<E.length;x++){var T=E[x].match(S);if(T!==null&&T[2]===_)if(A===-1){if(T[1]!=="BEGIN")break;A=x}else{if(T[1]!=="END")break;R=x;break}}if(A===-1||R===-1)throw new Error("PEM section not found for: "+_);var C=E.slice(A+1,R).join("");C.replace(/[^a-z0-9\+\/=]+/gi,"");var I=new u(C,"base64");return h.prototype.decode.call(this,I,w)},pem$1}var hasRequiredDecoders;function requireDecoders(){return hasRequiredDecoders||(hasRequiredDecoders=1,(function(g){var u=g;u.der=requireDer$1(),u.pem=requirePem$1()})(decoders)),decoders}var encoders={},der_1,hasRequiredDer;function requireDer(){if(hasRequiredDer)return der_1;hasRequiredDer=1;var g=requireInherits_browser(),u=requireDist$1().Buffer,h=requireAsn1$1(),y=h.base,v=h.constants.der;function b(S){this.enc="der",this.name=S.name,this.entity=S,this.tree=new w,this.tree._init(S.body)}der_1=b,b.prototype.encode=function(A,R){return this.tree._encode(A,R).join()};function w(S){y.Node.call(this,"der",S)}g(w,y.Node),w.prototype._encodeComposite=function(A,R,x,T){var C=_(A,R,x,this.reporter);if(T.length<128){var $=new u(2);return $[0]=C,$[1]=T.length,this._createEncoderBuffer([$,T])}for(var I=1,L=T.length;L>=256;L>>=8)I++;var $=new u(2+I);$[0]=C,$[1]=128|I;for(var L=1+I,B=T.length;B>0;L--,B>>=8)$[L]=B&255;return this._createEncoderBuffer([$,T])},w.prototype._encodeStr=function(A,R){if(R==="bitstr")return this._createEncoderBuffer([A.unused|0,A.data]);if(R==="bmpstr"){for(var x=new u(A.length*2),T=0;T<A.length;T++)x.writeUInt16BE(A.charCodeAt(T),T*2);return this._createEncoderBuffer(x)}else return R==="numstr"?this._isNumstr(A)?this._createEncoderBuffer(A):this.reporter.error("Encoding of string type: numstr supports only digits and space"):R==="printstr"?this._isPrintstr(A)?this._createEncoderBuffer(A):this.reporter.error("Encoding of string type: printstr supports only latin upper and lower case letters, digits, space, apostrophe, left and rigth parenthesis, plus sign, comma, hyphen, dot, slash, colon, equal sign, question mark"):/str$/.test(R)?this._createEncoderBuffer(A):R==="objDesc"?this._createEncoderBuffer(A):this.reporter.error("Encoding of string type: "+R+" unsupported")},w.prototype._encodeObjid=function(A,R,x){if(typeof A=="string"){if(!R)return this.reporter.error("string objid given, but no values map found");if(!R.hasOwnProperty(A))return this.reporter.error("objid not found in values map");A=R[A].split(/[\s\.]+/g);for(var T=0;T<A.length;T++)A[T]|=0}else if(Array.isArray(A)){A=A.slice();for(var T=0;T<A.length;T++)A[T]|=0}if(!Array.isArray(A))return this.reporter.error("objid() should be either array or string, got: "+JSON.stringify(A));if(!x){if(A[1]>=40)return this.reporter.error("Second objid identifier OOB");A.splice(0,2,A[0]*40+A[1])}for(var C=0,T=0;T<A.length;T++){var I=A[T];for(C++;I>=128;I>>=7)C++}for(var L=new u(C),$=L.length-1,T=A.length-1;T>=0;T--){var I=A[T];for(L[$--]=I&127;(I>>=7)>0;)L[$--]=128|I&127}return this._createEncoderBuffer(L)};function E(S){return S<10?"0"+S:S}w.prototype._encodeTime=function(A,R){var x,T=new Date(A);return R==="gentime"?x=[E(T.getFullYear()),E(T.getUTCMonth()+1),E(T.getUTCDate()),E(T.getUTCHours()),E(T.getUTCMinutes()),E(T.getUTCSeconds()),"Z"].join(""):R==="utctime"?x=[E(T.getFullYear()%100),E(T.getUTCMonth()+1),E(T.getUTCDate()),E(T.getUTCHours()),E(T.getUTCMinutes()),E(T.getUTCSeconds()),"Z"].join(""):this.reporter.error("Encoding "+R+" time is not supported yet"),this._encodeStr(x,"octstr")},w.prototype._encodeNull=function(){return this._createEncoderBuffer("")},w.prototype._encodeInt=function(A,R){if(typeof A=="string"){if(!R)return this.reporter.error("String int or enum given, but no values map");if(!R.hasOwnProperty(A))return this.reporter.error("Values map doesn't contain: "+JSON.stringify(A));A=R[A]}if(typeof A!="number"&&!u.isBuffer(A)){var x=A.toArray();!A.sign&&x[0]&128&&x.unshift(0),A=new u(x)}if(u.isBuffer(A)){var T=A.length;A.length===0&&T++;var I=new u(T);return A.copy(I),A.length===0&&(I[0]=0),this._createEncoderBuffer(I)}if(A<128)return this._createEncoderBuffer(A);if(A<256)return this._createEncoderBuffer([0,A]);for(var T=1,C=A;C>=256;C>>=8)T++;for(var I=new Array(T),C=I.length-1;C>=0;C--)I[C]=A&255,A>>=8;return I[0]&128&&I.unshift(0),this._createEncoderBuffer(new u(I))},w.prototype._encodeBool=function(A){return this._createEncoderBuffer(A?255:0)},w.prototype._use=function(A,R){return typeof A=="function"&&(A=A(R)),A._getEncoder("der").tree},w.prototype._skipDefault=function(A,R,x){var T=this._baseState,C;if(T.default===null)return!1;var I=A.join();if(T.defaultBuffer===void 0&&(T.defaultBuffer=this._encodeValue(T.default,R,x).join()),I.length!==T.defaultBuffer.length)return!1;for(C=0;C<I.length;C++)if(I[C]!==T.defaultBuffer[C])return!1;return!0};function _(S,A,R,x){var T;if(S==="seqof"?S="seq":S==="setof"&&(S="set"),v.tagByName.hasOwnProperty(S))T=v.tagByName[S];else if(typeof S=="number"&&(S|0)===S)T=S;else return x.error("Unknown tag: "+S);return T>=31?x.error("Multi-octet tag encoding unsupported"):(A||(T|=32),T|=v.tagClassByName[R||"universal"]<<6,T)}return der_1}var pem,hasRequiredPem;function requirePem(){if(hasRequiredPem)return pem;hasRequiredPem=1;var g=requireInherits_browser(),u=requireDer();function h(y){u.call(this,y),this.enc="pem"}return g(h,u),pem=h,h.prototype.encode=function(v,b){for(var w=u.prototype.encode.call(this,v),E=w.toString("base64"),_=["-----BEGIN "+b.label+"-----"],S=0;S<E.length;S+=64)_.push(E.slice(S,S+64));return _.push("-----END "+b.label+"-----"),_.join(`
`)},pem}var hasRequiredEncoders;function requireEncoders(){return hasRequiredEncoders||(hasRequiredEncoders=1,(function(g){var u=g;u.der=requireDer(),u.pem=requirePem()})(encoders)),encoders}var hasRequiredAsn1$1;function requireAsn1$1(){return hasRequiredAsn1$1||(hasRequiredAsn1$1=1,(function(g){var u=g;u.bignum=requireBn(),u.define=requireApi().define,u.base=requireBase$1(),u.constants=requireConstants(),u.decoders=requireDecoders(),u.encoders=requireEncoders()})(asn1)),asn1}var certificate,hasRequiredCertificate;function requireCertificate(){if(hasRequiredCertificate)return certificate;hasRequiredCertificate=1;var g=requireAsn1$1(),u=g.define("Time",function(){this.choice({utcTime:this.utctime(),generalTime:this.gentime()})}),h=g.define("AttributeTypeValue",function(){this.seq().obj(this.key("type").objid(),this.key("value").any())}),y=g.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("parameters").optional(),this.key("curve").objid().optional())}),v=g.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(y),this.key("subjectPublicKey").bitstr())}),b=g.define("RelativeDistinguishedName",function(){this.setof(h)}),w=g.define("RDNSequence",function(){this.seqof(b)}),E=g.define("Name",function(){this.choice({rdnSequence:this.use(w)})}),_=g.define("Validity",function(){this.seq().obj(this.key("notBefore").use(u),this.key("notAfter").use(u))}),S=g.define("Extension",function(){this.seq().obj(this.key("extnID").objid(),this.key("critical").bool().def(!1),this.key("extnValue").octstr())}),A=g.define("TBSCertificate",function(){this.seq().obj(this.key("version").explicit(0).int().optional(),this.key("serialNumber").int(),this.key("signature").use(y),this.key("issuer").use(E),this.key("validity").use(_),this.key("subject").use(E),this.key("subjectPublicKeyInfo").use(v),this.key("issuerUniqueID").implicit(1).bitstr().optional(),this.key("subjectUniqueID").implicit(2).bitstr().optional(),this.key("extensions").explicit(3).seqof(S).optional())}),R=g.define("X509Certificate",function(){this.seq().obj(this.key("tbsCertificate").use(A),this.key("signatureAlgorithm").use(y),this.key("signatureValue").bitstr())});return certificate=R,certificate}var hasRequiredAsn1;function requireAsn1(){if(hasRequiredAsn1)return asn1$1;hasRequiredAsn1=1;var g=requireAsn1$1();asn1$1.certificate=requireCertificate();var u=g.define("RSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("modulus").int(),this.key("publicExponent").int(),this.key("privateExponent").int(),this.key("prime1").int(),this.key("prime2").int(),this.key("exponent1").int(),this.key("exponent2").int(),this.key("coefficient").int())});asn1$1.RSAPrivateKey=u;var h=g.define("RSAPublicKey",function(){this.seq().obj(this.key("modulus").int(),this.key("publicExponent").int())});asn1$1.RSAPublicKey=h;var y=g.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("none").null_().optional(),this.key("curve").objid().optional(),this.key("params").seq().obj(this.key("p").int(),this.key("q").int(),this.key("g").int()).optional())}),v=g.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(y),this.key("subjectPublicKey").bitstr())});asn1$1.PublicKey=v;var b=g.define("PrivateKeyInfo",function(){this.seq().obj(this.key("version").int(),this.key("algorithm").use(y),this.key("subjectPrivateKey").octstr())});asn1$1.PrivateKey=b;var w=g.define("EncryptedPrivateKeyInfo",function(){this.seq().obj(this.key("algorithm").seq().obj(this.key("id").objid(),this.key("decrypt").seq().obj(this.key("kde").seq().obj(this.key("id").objid(),this.key("kdeparams").seq().obj(this.key("salt").octstr(),this.key("iters").int())),this.key("cipher").seq().obj(this.key("algo").objid(),this.key("iv").octstr()))),this.key("subjectPrivateKey").octstr())});asn1$1.EncryptedPrivateKey=w;var E=g.define("DSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("p").int(),this.key("q").int(),this.key("g").int(),this.key("pub_key").int(),this.key("priv_key").int())});asn1$1.DSAPrivateKey=E,asn1$1.DSAparam=g.define("DSAparam",function(){this.int()});var _=g.define("ECParameters",function(){this.choice({namedCurve:this.objid()})}),S=g.define("ECPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).use(_),this.key("publicKey").optional().explicit(1).bitstr())});return asn1$1.ECPrivateKey=S,asn1$1.signature=g.define("signature",function(){this.seq().obj(this.key("r").int(),this.key("s").int())}),asn1$1}const require$$1={"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"};var fixProc,hasRequiredFixProc;function requireFixProc(){if(hasRequiredFixProc)return fixProc;hasRequiredFixProc=1;var g=/Proc-Type: 4,ENCRYPTED[\n\r]+DEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)[\n\r]+([0-9A-z\n\r+/=]+)[\n\r]+/m,u=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----/m,h=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----([0-9A-z\n\r+/=]+)-----END \1-----$/m,y=requireEvp_bytestokey(),v=requireBrowser$7(),b=requireSafeBuffer$1().Buffer;return fixProc=function(w,E){var _=w.toString(),S=_.match(g),A;if(S){var x="aes"+S[1],T=b.from(S[2],"hex"),C=b.from(S[3].replace(/[\r\n]/g,""),"base64"),I=y(E,T.slice(0,8),parseInt(S[1],10)).key,L=[],$=v.createDecipheriv(x,I,T);L.push($.update(C)),L.push($.final()),A=b.concat(L)}else{var R=_.match(h);A=b.from(R[2].replace(/[\r\n]/g,""),"base64")}var B=_.match(u)[1];return{tag:B,data:A}},fixProc}var parseAsn1,hasRequiredParseAsn1;function requireParseAsn1(){if(hasRequiredParseAsn1)return parseAsn1;hasRequiredParseAsn1=1;var g=requireAsn1(),u=require$$1,h=requireFixProc(),y=requireBrowser$7(),v=requireBrowser$8(),b=requireSafeBuffer$1().Buffer;function w(_,S){var A=_.algorithm.decrypt.kde.kdeparams.salt,R=parseInt(_.algorithm.decrypt.kde.kdeparams.iters.toString(),10),x=u[_.algorithm.decrypt.cipher.algo.join(".")],T=_.algorithm.decrypt.cipher.iv,C=_.subjectPrivateKey,I=parseInt(x.split("-")[1],10)/8,L=v.pbkdf2Sync(S,A,R,I,"sha1"),$=y.createDecipheriv(x,L,T),B=[];return B.push($.update(C)),B.push($.final()),b.concat(B)}function E(_){var S;typeof _=="object"&&!b.isBuffer(_)&&(S=_.passphrase,_=_.key),typeof _=="string"&&(_=b.from(_));var A=h(_,S),R=A.tag,x=A.data,T,C;switch(R){case"CERTIFICATE":C=g.certificate.decode(x,"der").tbsCertificate.subjectPublicKeyInfo;case"PUBLIC KEY":switch(C||(C=g.PublicKey.decode(x,"der")),T=C.algorithm.algorithm.join("."),T){case"1.2.840.113549.1.1.1":return g.RSAPublicKey.decode(C.subjectPublicKey.data,"der");case"1.2.840.10045.2.1":return C.subjectPrivateKey=C.subjectPublicKey,{type:"ec",data:C};case"1.2.840.10040.4.1":return C.algorithm.params.pub_key=g.DSAparam.decode(C.subjectPublicKey.data,"der"),{type:"dsa",data:C.algorithm.params};default:throw new Error("unknown key id "+T)}case"ENCRYPTED PRIVATE KEY":x=g.EncryptedPrivateKey.decode(x,"der"),x=w(x,S);case"PRIVATE KEY":switch(C=g.PrivateKey.decode(x,"der"),T=C.algorithm.algorithm.join("."),T){case"1.2.840.113549.1.1.1":return g.RSAPrivateKey.decode(C.subjectPrivateKey,"der");case"1.2.840.10045.2.1":return{curve:C.algorithm.curve,privateKey:g.ECPrivateKey.decode(C.subjectPrivateKey,"der").privateKey};case"1.2.840.10040.4.1":return C.algorithm.params.priv_key=g.DSAparam.decode(C.subjectPrivateKey,"der"),{type:"dsa",params:C.algorithm.params};default:throw new Error("unknown key id "+T)}case"RSA PUBLIC KEY":return g.RSAPublicKey.decode(x,"der");case"RSA PRIVATE KEY":return g.RSAPrivateKey.decode(x,"der");case"DSA PRIVATE KEY":return{type:"dsa",params:g.DSAPrivateKey.decode(x,"der")};case"EC PRIVATE KEY":return x=g.ECPrivateKey.decode(x,"der"),{curve:x.parameters.value,privateKey:x.privateKey};default:throw new Error("unknown key type "+R)}}return E.signature=g.signature,parseAsn1=E,parseAsn1}const require$$4={"1.3.132.0.10":"secp256k1","1.3.132.0.33":"p224","1.2.840.10045.3.1.1":"p192","1.2.840.10045.3.1.7":"p256","1.3.132.0.34":"p384","1.3.132.0.35":"p521"};var hasRequiredSign;function requireSign(){if(hasRequiredSign)return sign$1.exports;hasRequiredSign=1;var g=requireSafeBuffer$1().Buffer,u=requireBrowser$9(),h=requireBrowserifyRsa(),y=requireElliptic().ec,v=requireBn$1(),b=requireParseAsn1(),w=require$$4,E=1;function _($,B,U,z,ne){var ue=b(B);if(ue.curve){if(z!=="ecdsa"&&z!=="ecdsa/rsa")throw new Error("wrong private key type");return S($,ue)}else if(ue.type==="dsa"){if(z!=="dsa")throw new Error("wrong private key type");return A($,ue,U)}if(z!=="rsa"&&z!=="ecdsa/rsa")throw new Error("wrong private key type");if(B.padding!==void 0&&B.padding!==E)throw new Error("illegal or unsupported padding mode");$=g.concat([ne,$]);for(var he=ue.modulus.byteLength(),Y=[0,1];$.length+Y.length+1<he;)Y.push(255);Y.push(0);for(var X=-1;++X<$.length;)Y.push($[X]);var J=h(Y,ue);return J}function S($,B){var U=w[B.curve.join(".")];if(!U)throw new Error("unknown curve "+B.curve.join("."));var z=new y(U),ne=z.keyFromPrivate(B.privateKey),ue=ne.sign($);return g.from(ue.toDER())}function A($,B,U){for(var z=B.params.priv_key,ne=B.params.p,ue=B.params.q,he=B.params.g,Y=new v(0),X,J=T($,ue).mod(ue),j=!1,M=x(z,ue,$,U);j===!1;)X=I(ue,M,U),Y=L(he,X,ne,ue),j=X.invm(ue).imul(J.add(z.mul(Y))).mod(ue),j.cmpn(0)===0&&(j=!1,Y=new v(0));return R(Y,j)}function R($,B){$=$.toArray(),B=B.toArray(),$[0]&128&&($=[0].concat($)),B[0]&128&&(B=[0].concat(B));var U=$.length+B.length+4,z=[48,U,2,$.length];return z=z.concat($,[2,B.length],B),g.from(z)}function x($,B,U,z){if($=g.from($.toArray()),$.length<B.byteLength()){var ne=g.alloc(B.byteLength()-$.length);$=g.concat([ne,$])}var ue=U.length,he=C(U,B),Y=g.alloc(ue);Y.fill(1);var X=g.alloc(ue);return X=u(z,X).update(Y).update(g.from([0])).update($).update(he).digest(),Y=u(z,X).update(Y).digest(),X=u(z,X).update(Y).update(g.from([1])).update($).update(he).digest(),Y=u(z,X).update(Y).digest(),{k:X,v:Y}}function T($,B){var U=new v($),z=($.length<<3)-B.bitLength();return z>0&&U.ishrn(z),U}function C($,B){$=T($,B),$=$.mod(B);var U=g.from($.toArray());if(U.length<B.byteLength()){var z=g.alloc(B.byteLength()-U.length);U=g.concat([z,U])}return U}function I($,B,U){var z,ne;do{for(z=g.alloc(0);z.length*8<$.bitLength();)B.v=u(U,B.k).update(B.v).digest(),z=g.concat([z,B.v]);ne=T(z,$),B.k=u(U,B.k).update(B.v).update(g.from([0])).digest(),B.v=u(U,B.k).update(B.v).digest()}while(ne.cmp($)!==-1);return ne}function L($,B,U,z){return $.toRed(v.mont(U)).redPow(B).fromRed().mod(z)}return sign$1.exports=_,sign$1.exports.getKey=x,sign$1.exports.makeKey=I,sign$1.exports}var verify_1,hasRequiredVerify;function requireVerify(){if(hasRequiredVerify)return verify_1;hasRequiredVerify=1;var g=requireSafeBuffer$1().Buffer,u=requireBn$1(),h=requireElliptic().ec,y=requireParseAsn1(),v=require$$4;function b(S,A,R,x,T){var C=y(R);if(C.type==="ec"){if(x!=="ecdsa"&&x!=="ecdsa/rsa")throw new Error("wrong public key type");return w(S,A,C)}else if(C.type==="dsa"){if(x!=="dsa")throw new Error("wrong public key type");return E(S,A,C)}if(x!=="rsa"&&x!=="ecdsa/rsa")throw new Error("wrong public key type");A=g.concat([T,A]);for(var I=C.modulus.byteLength(),L=[1],$=0;A.length+L.length+2<I;)L.push(255),$+=1;L.push(0);for(var B=-1;++B<A.length;)L.push(A[B]);L=g.from(L);var U=u.mont(C.modulus);S=new u(S).toRed(U),S=S.redPow(new u(C.publicExponent)),S=g.from(S.fromRed().toArray());var z=$<8?1:0;for(I=Math.min(S.length,L.length),S.length!==L.length&&(z=1),B=-1;++B<I;)z|=S[B]^L[B];return z===0}function w(S,A,R){var x=v[R.data.algorithm.curve.join(".")];if(!x)throw new Error("unknown curve "+R.data.algorithm.curve.join("."));var T=new h(x),C=R.data.subjectPrivateKey.data;return T.verify(A,S,C)}function E(S,A,R){var x=R.data.p,T=R.data.q,C=R.data.g,I=R.data.pub_key,L=y.signature.decode(S,"der"),$=L.s,B=L.r;_($,T),_(B,T);var U=u.mont(x),z=$.invm(T),ne=C.toRed(U).redPow(new u(A).mul(z).mod(T)).fromRed().mul(I.toRed(U).redPow(B.mul(z).mod(T)).fromRed()).mod(x).mod(T);return ne.cmp(B)===0}function _(S,A){if(S.cmpn(0)<=0)throw new Error("invalid sig");if(S.cmp(A)>=0)throw new Error("invalid sig")}return verify_1=b,verify_1}var browser$4,hasRequiredBrowser$4;function requireBrowser$4(){if(hasRequiredBrowser$4)return browser$4;hasRequiredBrowser$4=1;var g=requireSafeBuffer$1().Buffer,u=requireBrowser$a(),h=requireReadableBrowser(),y=requireInherits_browser(),v=requireSign(),b=requireVerify(),w=require$$6;Object.keys(w).forEach(function(R){w[R].id=g.from(w[R].id,"hex"),w[R.toLowerCase()]=w[R]});function E(R){h.Writable.call(this);var x=w[R];if(!x)throw new Error("Unknown message digest");this._hashType=x.hash,this._hash=u(x.hash),this._tag=x.id,this._signType=x.sign}y(E,h.Writable),E.prototype._write=function(x,T,C){this._hash.update(x),C()},E.prototype.update=function(x,T){return this._hash.update(typeof x=="string"?g.from(x,T):x),this},E.prototype.sign=function(x,T){this.end();var C=this._hash.digest(),I=v(C,x,this._hashType,this._signType,this._tag);return T?I.toString(T):I};function _(R){h.Writable.call(this);var x=w[R];if(!x)throw new Error("Unknown message digest");this._hash=u(x.hash),this._tag=x.id,this._signType=x.sign}y(_,h.Writable),_.prototype._write=function(x,T,C){this._hash.update(x),C()},_.prototype.update=function(x,T){return this._hash.update(typeof x=="string"?g.from(x,T):x),this},_.prototype.verify=function(x,T,C){var I=typeof T=="string"?g.from(T,C):T;this.end();var L=this._hash.digest();return b(I,L,x,this._signType,this._tag)};function S(R){return new E(R)}function A(R){return new _(R)}return browser$4={Sign:S,Verify:A,createSign:S,createVerify:A},browser$4}var browser$3,hasRequiredBrowser$3;function requireBrowser$3(){if(hasRequiredBrowser$3)return browser$3;hasRequiredBrowser$3=1;var g=requireElliptic(),u=requireBn();browser$3=function(w){return new y(w)};var h={secp256k1:{name:"secp256k1",byteLength:32},secp224r1:{name:"p224",byteLength:28},prime256v1:{name:"p256",byteLength:32},prime192v1:{name:"p192",byteLength:24},ed25519:{name:"ed25519",byteLength:32},secp384r1:{name:"p384",byteLength:48},secp521r1:{name:"p521",byteLength:66}};h.p224=h.secp224r1,h.p256=h.secp256r1=h.prime256v1,h.p192=h.secp192r1=h.prime192v1,h.p384=h.secp384r1,h.p521=h.secp521r1;function y(b){this.curveType=h[b],this.curveType||(this.curveType={name:b}),this.curve=new g.ec(this.curveType.name),this.keys=void 0}y.prototype.generateKeys=function(b,w){return this.keys=this.curve.genKeyPair(),this.getPublicKey(b,w)},y.prototype.computeSecret=function(b,w,E){w=w||"utf8",Buffer.isBuffer(b)||(b=new Buffer(b,w));var _=this.curve.keyFromPublic(b).getPublic(),S=_.mul(this.keys.getPrivate()).getX();return v(S,E,this.curveType.byteLength)},y.prototype.getPublicKey=function(b,w){var E=this.keys.getPublic(w==="compressed",!0);return w==="hybrid"&&(E[E.length-1]%2?E[0]=7:E[0]=6),v(E,b)},y.prototype.getPrivateKey=function(b){return v(this.keys.getPrivate(),b)},y.prototype.setPublicKey=function(b,w){return w=w||"utf8",Buffer.isBuffer(b)||(b=new Buffer(b,w)),this.keys._importPublic(b),this},y.prototype.setPrivateKey=function(b,w){w=w||"utf8",Buffer.isBuffer(b)||(b=new Buffer(b,w));var E=new u(b);return E=E.toString(16),this.keys=this.curve.genKeyPair(),this.keys._importPrivate(E),this};function v(b,w,E){Array.isArray(b)||(b=b.toArray());var _=new Buffer(b);if(E&&_.length<E){var S=new Buffer(E-_.length);S.fill(0),_=Buffer.concat([S,_])}return w?_.toString(w):_}return browser$3}var browser$2={},mgf,hasRequiredMgf;function requireMgf(){if(hasRequiredMgf)return mgf;hasRequiredMgf=1;var g=requireBrowser$a(),u=requireSafeBuffer$1().Buffer;mgf=function(y,v){for(var b=u.alloc(0),w=0,E;b.length<v;)E=h(w++),b=u.concat([b,g("sha1").update(y).update(E).digest()]);return b.slice(0,v)};function h(y){var v=u.allocUnsafe(4);return v.writeUInt32BE(y,0),v}return mgf}var xor,hasRequiredXor;function requireXor(){return hasRequiredXor||(hasRequiredXor=1,xor=function(u,h){for(var y=u.length,v=-1;++v<y;)u[v]^=h[v];return u}),xor}var withPublic_1,hasRequiredWithPublic;function requireWithPublic(){if(hasRequiredWithPublic)return withPublic_1;hasRequiredWithPublic=1;var g=requireBn(),u=requireSafeBuffer$1().Buffer;function h(y,v){return u.from(y.toRed(g.mont(v.modulus)).redPow(new g(v.publicExponent)).fromRed().toArray())}return withPublic_1=h,withPublic_1}var publicEncrypt,hasRequiredPublicEncrypt;function requirePublicEncrypt(){if(hasRequiredPublicEncrypt)return publicEncrypt;hasRequiredPublicEncrypt=1;var g=requireParseAsn1(),u=requireBrowser$c(),h=requireBrowser$a(),y=requireMgf(),v=requireXor(),b=requireBn(),w=requireWithPublic(),E=requireBrowserifyRsa(),_=requireSafeBuffer$1().Buffer;publicEncrypt=function(T,C,I){var L;T.padding?L=T.padding:I?L=1:L=4;var $=g(T),B;if(L===4)B=S($,C);else if(L===1)B=A($,C,I);else if(L===3){if(B=new b(C),B.cmp($.modulus)>=0)throw new Error("data too long for modulus")}else throw new Error("unknown padding");return I?E(B,$):w(B,$)};function S(x,T){var C=x.modulus.byteLength(),I=T.length,L=h("sha1").update(_.alloc(0)).digest(),$=L.length,B=2*$;if(I>C-B-2)throw new Error("message too long");var U=_.alloc(C-I-B-2),z=C-$-1,ne=u($),ue=v(_.concat([L,U,_.alloc(1,1),T],z),y(ne,z)),he=v(ne,y(ue,$));return new b(_.concat([_.alloc(1),he,ue],C))}function A(x,T,C){var I=T.length,L=x.modulus.byteLength();if(I>L-11)throw new Error("message too long");var $;return C?$=_.alloc(L-I-3,255):$=R(L-I-3),new b(_.concat([_.from([0,C?1:2]),$,_.alloc(1),T],L))}function R(x){for(var T=_.allocUnsafe(x),C=0,I=u(x*2),L=0,$;C<x;)L===I.length&&(I=u(x*2),L=0),$=I[L++],$&&(T[C++]=$);return T}return publicEncrypt}var privateDecrypt,hasRequiredPrivateDecrypt;function requirePrivateDecrypt(){if(hasRequiredPrivateDecrypt)return privateDecrypt;hasRequiredPrivateDecrypt=1;var g=requireParseAsn1(),u=requireMgf(),h=requireXor(),y=requireBn(),v=requireBrowserifyRsa(),b=requireBrowser$a(),w=requireWithPublic(),E=requireSafeBuffer$1().Buffer;privateDecrypt=function(x,T,C){var I;x.padding?I=x.padding:C?I=1:I=4;var L=g(x),$=L.modulus.byteLength();if(T.length>$||new y(T).cmp(L.modulus)>=0)throw new Error("decryption error");var B;C?B=w(new y(T),L):B=v(T,L);var U=E.alloc($-B.length);if(B=E.concat([U,B],$),I===4)return _(L,B);if(I===1)return S(L,B,C);if(I===3)return B;throw new Error("unknown padding")};function _(R,x){var T=R.modulus.byteLength(),C=b("sha1").update(E.alloc(0)).digest(),I=C.length;if(x[0]!==0)throw new Error("decryption error");var L=x.slice(1,I+1),$=x.slice(I+1),B=h(L,u($,I)),U=h($,u(B,T-I-1));if(A(C,U.slice(0,I)))throw new Error("decryption error");for(var z=I;U[z]===0;)z++;if(U[z++]!==1)throw new Error("decryption error");return U.slice(z)}function S(R,x,T){for(var C=x.slice(0,2),I=2,L=0;x[I++]!==0;)if(I>=x.length){L++;break}var $=x.slice(2,I-1);if((C.toString("hex")!=="0002"&&!T||C.toString("hex")!=="0001"&&T)&&L++,$.length<8&&L++,L)throw new Error("decryption error");return x.slice(I)}function A(R,x){R=E.from(R),x=E.from(x);var T=0,C=R.length;R.length!==x.length&&(T++,C=Math.min(R.length,x.length));for(var I=-1;++I<C;)T+=R[I]^x[I];return T}return privateDecrypt}var hasRequiredBrowser$2;function requireBrowser$2(){return hasRequiredBrowser$2||(hasRequiredBrowser$2=1,(function(g){g.publicEncrypt=requirePublicEncrypt(),g.privateDecrypt=requirePrivateDecrypt(),g.privateEncrypt=function(h,y){return g.publicEncrypt(h,y,!0)},g.publicDecrypt=function(h,y){return g.privateDecrypt(h,y,!0)}})(browser$2)),browser$2}var browser$1={},hasRequiredBrowser$1;function requireBrowser$1(){if(hasRequiredBrowser$1)return browser$1;hasRequiredBrowser$1=1;function g(){throw new Error(`secure random number generation not supported by this browser
use chrome, FireFox or Internet Explorer 11`)}var u=requireSafeBuffer$1();requireBrowser$c();var h=u.Buffer,y=u.kMaxLength,v=globalThis.crypto||globalThis.msCrypto,b=Math.pow(2,32)-1;function w(R,x){if(typeof R!="number"||R!==R)throw new TypeError("offset must be a number");if(R>b||R<0)throw new TypeError("offset must be a uint32");if(R>y||R>x)throw new RangeError("offset out of range")}function E(R,x,T){if(typeof R!="number"||R!==R)throw new TypeError("size must be a number");if(R>b||R<0)throw new TypeError("size must be a uint32");if(R+x>T||R>y)throw new RangeError("buffer too small")}v&&v.getRandomValues?(exports.randomFill=_,exports.randomFillSync=A):(browser$1.randomFill=g,browser$1.randomFillSync=g);function _(R,x,T,C){if(!h.isBuffer(R)&&!(R instanceof globalThis.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');if(typeof x=="function")C=x,x=0,T=R.length;else if(typeof T=="function")C=T,T=R.length-x;else if(typeof C!="function")throw new TypeError('"cb" argument must be a function');return w(x,R.length),E(T,x,R.length),S(R,x,T,C)}function S(R,x,T,C){{var I=R.buffer,L=new Uint8Array(I,x,T);if(v.getRandomValues(L),C){process$1.nextTick(function(){C(null,R)});return}return R}}function A(R,x,T){if(typeof x>"u"&&(x=0),!h.isBuffer(R)&&!(R instanceof globalThis.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');return w(x,R.length),T===void 0&&(T=R.length-x),E(T,x,R.length),S(R,x,T)}return browser$1}var hasRequiredCryptoBrowserify;function requireCryptoBrowserify(){if(hasRequiredCryptoBrowserify)return cryptoBrowserify;hasRequiredCryptoBrowserify=1,cryptoBrowserify.randomBytes=cryptoBrowserify.rng=cryptoBrowserify.pseudoRandomBytes=cryptoBrowserify.prng=requireBrowser$c(),cryptoBrowserify.createHash=cryptoBrowserify.Hash=requireBrowser$a(),cryptoBrowserify.createHmac=cryptoBrowserify.Hmac=requireBrowser$9();var g=requireAlgos(),u=Object.keys(g),h=["sha1","sha224","sha256","sha384","sha512","md5","rmd160"].concat(u);cryptoBrowserify.getHashes=function(){return h};var y=requireBrowser$8();cryptoBrowserify.pbkdf2=y.pbkdf2,cryptoBrowserify.pbkdf2Sync=y.pbkdf2Sync;var v=requireBrowser$6();cryptoBrowserify.Cipher=v.Cipher,cryptoBrowserify.createCipher=v.createCipher,cryptoBrowserify.Cipheriv=v.Cipheriv,cryptoBrowserify.createCipheriv=v.createCipheriv,cryptoBrowserify.Decipher=v.Decipher,cryptoBrowserify.createDecipher=v.createDecipher,cryptoBrowserify.Decipheriv=v.Decipheriv,cryptoBrowserify.createDecipheriv=v.createDecipheriv,cryptoBrowserify.getCiphers=v.getCiphers,cryptoBrowserify.listCiphers=v.listCiphers;var b=requireBrowser$5();cryptoBrowserify.DiffieHellmanGroup=b.DiffieHellmanGroup,cryptoBrowserify.createDiffieHellmanGroup=b.createDiffieHellmanGroup,cryptoBrowserify.getDiffieHellman=b.getDiffieHellman,cryptoBrowserify.createDiffieHellman=b.createDiffieHellman,cryptoBrowserify.DiffieHellman=b.DiffieHellman;var w=requireBrowser$4();cryptoBrowserify.createSign=w.createSign,cryptoBrowserify.Sign=w.Sign,cryptoBrowserify.createVerify=w.createVerify,cryptoBrowserify.Verify=w.Verify,cryptoBrowserify.createECDH=requireBrowser$3();var E=requireBrowser$2();cryptoBrowserify.publicEncrypt=E.publicEncrypt,cryptoBrowserify.privateEncrypt=E.privateEncrypt,cryptoBrowserify.publicDecrypt=E.publicDecrypt,cryptoBrowserify.privateDecrypt=E.privateDecrypt;var _=requireBrowser$1();return cryptoBrowserify.randomFill=_.randomFill,cryptoBrowserify.randomFillSync=_.randomFillSync,cryptoBrowserify.createCredentials=function(){throw new Error(`sorry, createCredentials is not implemented yet
we accept pull requests
https://github.com/browserify/crypto-browserify`)},cryptoBrowserify.constants={DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,NPN_ENABLED:1,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_SSLV23_PADDING:2,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6},cryptoBrowserify}var hasRequiredBrorand;function requireBrorand(){if(hasRequiredBrorand)return brorand.exports;hasRequiredBrorand=1;var g;brorand.exports=function(v){return g||(g=new u(null)),g.generate(v)};function u(y){this.rand=y}if(brorand.exports.Rand=u,u.prototype.generate=function(v){return this._rand(v)},u.prototype._rand=function(v){if(this.rand.getBytes)return this.rand.getBytes(v);for(var b=new Uint8Array(v),w=0;w<b.length;w++)b[w]=this.rand.getByte();return b},typeof self=="object")self.crypto&&self.crypto.getRandomValues?u.prototype._rand=function(v){var b=new Uint8Array(v);return self.crypto.getRandomValues(b),b}:self.msCrypto&&self.msCrypto.getRandomValues?u.prototype._rand=function(v){var b=new Uint8Array(v);return self.msCrypto.getRandomValues(b),b}:typeof window=="object"&&(u.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var h=requireCryptoBrowserify();if(typeof h.randomBytes!="function")throw new Error("Not supported");u.prototype._rand=function(v){return h.randomBytes(v)}}catch{}return brorand.exports}var curve={},base,hasRequiredBase;function requireBase(){if(hasRequiredBase)return base;hasRequiredBase=1;var g=requireBn(),u=requireUtils$2(),h=u.getNAF,y=u.getJSF,v=u.assert;function b(E,_){this.type=E,this.p=new g(_.p,16),this.red=_.prime?g.red(_.prime):g.mont(this.p),this.zero=new g(0).toRed(this.red),this.one=new g(1).toRed(this.red),this.two=new g(2).toRed(this.red),this.n=_.n&&new g(_.n,16),this.g=_.g&&this.pointFromJSON(_.g,_.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var S=this.n&&this.p.div(this.n);!S||S.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}base=b,b.prototype.point=function(){throw new Error("Not implemented")},b.prototype.validate=function(){throw new Error("Not implemented")},b.prototype._fixedNafMul=function(_,S){v(_.precomputed);var A=_._getDoubles(),R=h(S,1,this._bitLength),x=(1<<A.step+1)-(A.step%2===0?2:1);x/=3;var T=[],C,I;for(C=0;C<R.length;C+=A.step){I=0;for(var L=C+A.step-1;L>=C;L--)I=(I<<1)+R[L];T.push(I)}for(var $=this.jpoint(null,null,null),B=this.jpoint(null,null,null),U=x;U>0;U--){for(C=0;C<T.length;C++)I=T[C],I===U?B=B.mixedAdd(A.points[C]):I===-U&&(B=B.mixedAdd(A.points[C].neg()));$=$.add(B)}return $.toP()},b.prototype._wnafMul=function(_,S){var A=4,R=_._getNAFPoints(A);A=R.wnd;for(var x=R.points,T=h(S,A,this._bitLength),C=this.jpoint(null,null,null),I=T.length-1;I>=0;I--){for(var L=0;I>=0&&T[I]===0;I--)L++;if(I>=0&&L++,C=C.dblp(L),I<0)break;var $=T[I];v($!==0),_.type==="affine"?$>0?C=C.mixedAdd(x[$-1>>1]):C=C.mixedAdd(x[-$-1>>1].neg()):$>0?C=C.add(x[$-1>>1]):C=C.add(x[-$-1>>1].neg())}return _.type==="affine"?C.toP():C},b.prototype._wnafMulAdd=function(_,S,A,R,x){var T=this._wnafT1,C=this._wnafT2,I=this._wnafT3,L=0,$,B,U;for($=0;$<R;$++){U=S[$];var z=U._getNAFPoints(_);T[$]=z.wnd,C[$]=z.points}for($=R-1;$>=1;$-=2){var ne=$-1,ue=$;if(T[ne]!==1||T[ue]!==1){I[ne]=h(A[ne],T[ne],this._bitLength),I[ue]=h(A[ue],T[ue],this._bitLength),L=Math.max(I[ne].length,L),L=Math.max(I[ue].length,L);continue}var he=[S[ne],null,null,S[ue]];S[ne].y.cmp(S[ue].y)===0?(he[1]=S[ne].add(S[ue]),he[2]=S[ne].toJ().mixedAdd(S[ue].neg())):S[ne].y.cmp(S[ue].y.redNeg())===0?(he[1]=S[ne].toJ().mixedAdd(S[ue]),he[2]=S[ne].add(S[ue].neg())):(he[1]=S[ne].toJ().mixedAdd(S[ue]),he[2]=S[ne].toJ().mixedAdd(S[ue].neg()));var Y=[-3,-1,-5,-7,0,7,5,1,3],X=y(A[ne],A[ue]);for(L=Math.max(X[0].length,L),I[ne]=new Array(L),I[ue]=new Array(L),B=0;B<L;B++){var J=X[0][B]|0,j=X[1][B]|0;I[ne][B]=Y[(J+1)*3+(j+1)],I[ue][B]=0,C[ne]=he}}var M=this.jpoint(null,null,null),N=this._wnafT4;for($=L;$>=0;$--){for(var P=0;$>=0;){var O=!0;for(B=0;B<R;B++)N[B]=I[B][$]|0,N[B]!==0&&(O=!1);if(!O)break;P++,$--}if($>=0&&P++,M=M.dblp(P),$<0)break;for(B=0;B<R;B++){var k=N[B];k!==0&&(k>0?U=C[B][k-1>>1]:k<0&&(U=C[B][-k-1>>1].neg()),U.type==="affine"?M=M.mixedAdd(U):M=M.add(U))}}for($=0;$<R;$++)C[$]=null;return x?M:M.toP()};function w(E,_){this.curve=E,this.type=_,this.precomputed=null}return b.BasePoint=w,w.prototype.eq=function(){throw new Error("Not implemented")},w.prototype.validate=function(){return this.curve.validate(this)},b.prototype.decodePoint=function(_,S){_=u.toArray(_,S);var A=this.p.byteLength();if((_[0]===4||_[0]===6||_[0]===7)&&_.length-1===2*A){_[0]===6?v(_[_.length-1]%2===0):_[0]===7&&v(_[_.length-1]%2===1);var R=this.point(_.slice(1,1+A),_.slice(1+A,1+2*A));return R}else if((_[0]===2||_[0]===3)&&_.length-1===A)return this.pointFromX(_.slice(1,1+A),_[0]===3);throw new Error("Unknown point format")},w.prototype.encodeCompressed=function(_){return this.encode(_,!0)},w.prototype._encode=function(_){var S=this.curve.p.byteLength(),A=this.getX().toArray("be",S);return _?[this.getY().isEven()?2:3].concat(A):[4].concat(A,this.getY().toArray("be",S))},w.prototype.encode=function(_,S){return u.encode(this._encode(S),_)},w.prototype.precompute=function(_){if(this.precomputed)return this;var S={doubles:null,naf:null,beta:null};return S.naf=this._getNAFPoints(8),S.doubles=this._getDoubles(4,_),S.beta=this._getBeta(),this.precomputed=S,this},w.prototype._hasDoubles=function(_){if(!this.precomputed)return!1;var S=this.precomputed.doubles;return S?S.points.length>=Math.ceil((_.bitLength()+1)/S.step):!1},w.prototype._getDoubles=function(_,S){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var A=[this],R=this,x=0;x<S;x+=_){for(var T=0;T<_;T++)R=R.dbl();A.push(R)}return{step:_,points:A}},w.prototype._getNAFPoints=function(_){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var S=[this],A=(1<<_)-1,R=A===1?null:this.dbl(),x=1;x<A;x++)S[x]=S[x-1].add(R);return{wnd:_,points:S}},w.prototype._getBeta=function(){return null},w.prototype.dblp=function(_){for(var S=this,A=0;A<_;A++)S=S.dbl();return S},base}var short,hasRequiredShort;function requireShort(){if(hasRequiredShort)return short;hasRequiredShort=1;var g=requireUtils$2(),u=requireBn(),h=requireInherits_browser(),y=requireBase(),v=g.assert;function b(_){y.call(this,"short",_),this.a=new u(_.a,16).toRed(this.red),this.b=new u(_.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=this.a.fromRed().cmpn(0)===0,this.threeA=this.a.fromRed().sub(this.p).cmpn(-3)===0,this.endo=this._getEndomorphism(_),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}h(b,y),short=b,b.prototype._getEndomorphism=function(S){if(!(!this.zeroA||!this.g||!this.n||this.p.modn(3)!==1)){var A,R;if(S.beta)A=new u(S.beta,16).toRed(this.red);else{var x=this._getEndoRoots(this.p);A=x[0].cmp(x[1])<0?x[0]:x[1],A=A.toRed(this.red)}if(S.lambda)R=new u(S.lambda,16);else{var T=this._getEndoRoots(this.n);this.g.mul(T[0]).x.cmp(this.g.x.redMul(A))===0?R=T[0]:(R=T[1],v(this.g.mul(R).x.cmp(this.g.x.redMul(A))===0))}var C;return S.basis?C=S.basis.map(function(I){return{a:new u(I.a,16),b:new u(I.b,16)}}):C=this._getEndoBasis(R),{beta:A,lambda:R,basis:C}}},b.prototype._getEndoRoots=function(S){var A=S===this.p?this.red:u.mont(S),R=new u(2).toRed(A).redInvm(),x=R.redNeg(),T=new u(3).toRed(A).redNeg().redSqrt().redMul(R),C=x.redAdd(T).fromRed(),I=x.redSub(T).fromRed();return[C,I]},b.prototype._getEndoBasis=function(S){for(var A=this.n.ushrn(Math.floor(this.n.bitLength()/2)),R=S,x=this.n.clone(),T=new u(1),C=new u(0),I=new u(0),L=new u(1),$,B,U,z,ne,ue,he,Y=0,X,J;R.cmpn(0)!==0;){var j=x.div(R);X=x.sub(j.mul(R)),J=I.sub(j.mul(T));var M=L.sub(j.mul(C));if(!U&&X.cmp(A)<0)$=he.neg(),B=T,U=X.neg(),z=J;else if(U&&++Y===2)break;he=X,x=R,R=X,I=T,T=J,L=C,C=M}ne=X.neg(),ue=J;var N=U.sqr().add(z.sqr()),P=ne.sqr().add(ue.sqr());return P.cmp(N)>=0&&(ne=$,ue=B),U.negative&&(U=U.neg(),z=z.neg()),ne.negative&&(ne=ne.neg(),ue=ue.neg()),[{a:U,b:z},{a:ne,b:ue}]},b.prototype._endoSplit=function(S){var A=this.endo.basis,R=A[0],x=A[1],T=x.b.mul(S).divRound(this.n),C=R.b.neg().mul(S).divRound(this.n),I=T.mul(R.a),L=C.mul(x.a),$=T.mul(R.b),B=C.mul(x.b),U=S.sub(I).sub(L),z=$.add(B).neg();return{k1:U,k2:z}},b.prototype.pointFromX=function(S,A){S=new u(S,16),S.red||(S=S.toRed(this.red));var R=S.redSqr().redMul(S).redIAdd(S.redMul(this.a)).redIAdd(this.b),x=R.redSqrt();if(x.redSqr().redSub(R).cmp(this.zero)!==0)throw new Error("invalid point");var T=x.fromRed().isOdd();return(A&&!T||!A&&T)&&(x=x.redNeg()),this.point(S,x)},b.prototype.validate=function(S){if(S.inf)return!0;var A=S.x,R=S.y,x=this.a.redMul(A),T=A.redSqr().redMul(A).redIAdd(x).redIAdd(this.b);return R.redSqr().redISub(T).cmpn(0)===0},b.prototype._endoWnafMulAdd=function(S,A,R){for(var x=this._endoWnafT1,T=this._endoWnafT2,C=0;C<S.length;C++){var I=this._endoSplit(A[C]),L=S[C],$=L._getBeta();I.k1.negative&&(I.k1.ineg(),L=L.neg(!0)),I.k2.negative&&(I.k2.ineg(),$=$.neg(!0)),x[C*2]=L,x[C*2+1]=$,T[C*2]=I.k1,T[C*2+1]=I.k2}for(var B=this._wnafMulAdd(1,x,T,C*2,R),U=0;U<C*2;U++)x[U]=null,T[U]=null;return B};function w(_,S,A,R){y.BasePoint.call(this,_,"affine"),S===null&&A===null?(this.x=null,this.y=null,this.inf=!0):(this.x=new u(S,16),this.y=new u(A,16),R&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}h(w,y.BasePoint),b.prototype.point=function(S,A,R){return new w(this,S,A,R)},b.prototype.pointFromJSON=function(S,A){return w.fromJSON(this,S,A)},w.prototype._getBeta=function(){if(this.curve.endo){var S=this.precomputed;if(S&&S.beta)return S.beta;var A=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(S){var R=this.curve,x=function(T){return R.point(T.x.redMul(R.endo.beta),T.y)};S.beta=A,A.precomputed={beta:null,naf:S.naf&&{wnd:S.naf.wnd,points:S.naf.points.map(x)},doubles:S.doubles&&{step:S.doubles.step,points:S.doubles.points.map(x)}}}return A}},w.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},w.fromJSON=function(S,A,R){typeof A=="string"&&(A=JSON.parse(A));var x=S.point(A[0],A[1],R);if(!A[2])return x;function T(I){return S.point(I[0],I[1],R)}var C=A[2];return x.precomputed={beta:null,doubles:C.doubles&&{step:C.doubles.step,points:[x].concat(C.doubles.points.map(T))},naf:C.naf&&{wnd:C.naf.wnd,points:[x].concat(C.naf.points.map(T))}},x},w.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},w.prototype.isInfinity=function(){return this.inf},w.prototype.add=function(S){if(this.inf)return S;if(S.inf)return this;if(this.eq(S))return this.dbl();if(this.neg().eq(S))return this.curve.point(null,null);if(this.x.cmp(S.x)===0)return this.curve.point(null,null);var A=this.y.redSub(S.y);A.cmpn(0)!==0&&(A=A.redMul(this.x.redSub(S.x).redInvm()));var R=A.redSqr().redISub(this.x).redISub(S.x),x=A.redMul(this.x.redSub(R)).redISub(this.y);return this.curve.point(R,x)},w.prototype.dbl=function(){if(this.inf)return this;var S=this.y.redAdd(this.y);if(S.cmpn(0)===0)return this.curve.point(null,null);var A=this.curve.a,R=this.x.redSqr(),x=S.redInvm(),T=R.redAdd(R).redIAdd(R).redIAdd(A).redMul(x),C=T.redSqr().redISub(this.x.redAdd(this.x)),I=T.redMul(this.x.redSub(C)).redISub(this.y);return this.curve.point(C,I)},w.prototype.getX=function(){return this.x.fromRed()},w.prototype.getY=function(){return this.y.fromRed()},w.prototype.mul=function(S){return S=new u(S,16),this.isInfinity()?this:this._hasDoubles(S)?this.curve._fixedNafMul(this,S):this.curve.endo?this.curve._endoWnafMulAdd([this],[S]):this.curve._wnafMul(this,S)},w.prototype.mulAdd=function(S,A,R){var x=[this,A],T=[S,R];return this.curve.endo?this.curve._endoWnafMulAdd(x,T):this.curve._wnafMulAdd(1,x,T,2)},w.prototype.jmulAdd=function(S,A,R){var x=[this,A],T=[S,R];return this.curve.endo?this.curve._endoWnafMulAdd(x,T,!0):this.curve._wnafMulAdd(1,x,T,2,!0)},w.prototype.eq=function(S){return this===S||this.inf===S.inf&&(this.inf||this.x.cmp(S.x)===0&&this.y.cmp(S.y)===0)},w.prototype.neg=function(S){if(this.inf)return this;var A=this.curve.point(this.x,this.y.redNeg());if(S&&this.precomputed){var R=this.precomputed,x=function(T){return T.neg()};A.precomputed={naf:R.naf&&{wnd:R.naf.wnd,points:R.naf.points.map(x)},doubles:R.doubles&&{step:R.doubles.step,points:R.doubles.points.map(x)}}}return A},w.prototype.toJ=function(){if(this.inf)return this.curve.jpoint(null,null,null);var S=this.curve.jpoint(this.x,this.y,this.curve.one);return S};function E(_,S,A,R){y.BasePoint.call(this,_,"jacobian"),S===null&&A===null&&R===null?(this.x=this.curve.one,this.y=this.curve.one,this.z=new u(0)):(this.x=new u(S,16),this.y=new u(A,16),this.z=new u(R,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}return h(E,y.BasePoint),b.prototype.jpoint=function(S,A,R){return new E(this,S,A,R)},E.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var S=this.z.redInvm(),A=S.redSqr(),R=this.x.redMul(A),x=this.y.redMul(A).redMul(S);return this.curve.point(R,x)},E.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},E.prototype.add=function(S){if(this.isInfinity())return S;if(S.isInfinity())return this;var A=S.z.redSqr(),R=this.z.redSqr(),x=this.x.redMul(A),T=S.x.redMul(R),C=this.y.redMul(A.redMul(S.z)),I=S.y.redMul(R.redMul(this.z)),L=x.redSub(T),$=C.redSub(I);if(L.cmpn(0)===0)return $.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var B=L.redSqr(),U=B.redMul(L),z=x.redMul(B),ne=$.redSqr().redIAdd(U).redISub(z).redISub(z),ue=$.redMul(z.redISub(ne)).redISub(C.redMul(U)),he=this.z.redMul(S.z).redMul(L);return this.curve.jpoint(ne,ue,he)},E.prototype.mixedAdd=function(S){if(this.isInfinity())return S.toJ();if(S.isInfinity())return this;var A=this.z.redSqr(),R=this.x,x=S.x.redMul(A),T=this.y,C=S.y.redMul(A).redMul(this.z),I=R.redSub(x),L=T.redSub(C);if(I.cmpn(0)===0)return L.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var $=I.redSqr(),B=$.redMul(I),U=R.redMul($),z=L.redSqr().redIAdd(B).redISub(U).redISub(U),ne=L.redMul(U.redISub(z)).redISub(T.redMul(B)),ue=this.z.redMul(I);return this.curve.jpoint(z,ne,ue)},E.prototype.dblp=function(S){if(S===0)return this;if(this.isInfinity())return this;if(!S)return this.dbl();var A;if(this.curve.zeroA||this.curve.threeA){var R=this;for(A=0;A<S;A++)R=R.dbl();return R}var x=this.curve.a,T=this.curve.tinv,C=this.x,I=this.y,L=this.z,$=L.redSqr().redSqr(),B=I.redAdd(I);for(A=0;A<S;A++){var U=C.redSqr(),z=B.redSqr(),ne=z.redSqr(),ue=U.redAdd(U).redIAdd(U).redIAdd(x.redMul($)),he=C.redMul(z),Y=ue.redSqr().redISub(he.redAdd(he)),X=he.redISub(Y),J=ue.redMul(X);J=J.redIAdd(J).redISub(ne);var j=B.redMul(L);A+1<S&&($=$.redMul(ne)),C=Y,L=j,B=J}return this.curve.jpoint(C,B.redMul(T),L)},E.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},E.prototype._zeroDbl=function(){var S,A,R;if(this.zOne){var x=this.x.redSqr(),T=this.y.redSqr(),C=T.redSqr(),I=this.x.redAdd(T).redSqr().redISub(x).redISub(C);I=I.redIAdd(I);var L=x.redAdd(x).redIAdd(x),$=L.redSqr().redISub(I).redISub(I),B=C.redIAdd(C);B=B.redIAdd(B),B=B.redIAdd(B),S=$,A=L.redMul(I.redISub($)).redISub(B),R=this.y.redAdd(this.y)}else{var U=this.x.redSqr(),z=this.y.redSqr(),ne=z.redSqr(),ue=this.x.redAdd(z).redSqr().redISub(U).redISub(ne);ue=ue.redIAdd(ue);var he=U.redAdd(U).redIAdd(U),Y=he.redSqr(),X=ne.redIAdd(ne);X=X.redIAdd(X),X=X.redIAdd(X),S=Y.redISub(ue).redISub(ue),A=he.redMul(ue.redISub(S)).redISub(X),R=this.y.redMul(this.z),R=R.redIAdd(R)}return this.curve.jpoint(S,A,R)},E.prototype._threeDbl=function(){var S,A,R;if(this.zOne){var x=this.x.redSqr(),T=this.y.redSqr(),C=T.redSqr(),I=this.x.redAdd(T).redSqr().redISub(x).redISub(C);I=I.redIAdd(I);var L=x.redAdd(x).redIAdd(x).redIAdd(this.curve.a),$=L.redSqr().redISub(I).redISub(I);S=$;var B=C.redIAdd(C);B=B.redIAdd(B),B=B.redIAdd(B),A=L.redMul(I.redISub($)).redISub(B),R=this.y.redAdd(this.y)}else{var U=this.z.redSqr(),z=this.y.redSqr(),ne=this.x.redMul(z),ue=this.x.redSub(U).redMul(this.x.redAdd(U));ue=ue.redAdd(ue).redIAdd(ue);var he=ne.redIAdd(ne);he=he.redIAdd(he);var Y=he.redAdd(he);S=ue.redSqr().redISub(Y),R=this.y.redAdd(this.z).redSqr().redISub(z).redISub(U);var X=z.redSqr();X=X.redIAdd(X),X=X.redIAdd(X),X=X.redIAdd(X),A=ue.redMul(he.redISub(S)).redISub(X)}return this.curve.jpoint(S,A,R)},E.prototype._dbl=function(){var S=this.curve.a,A=this.x,R=this.y,x=this.z,T=x.redSqr().redSqr(),C=A.redSqr(),I=R.redSqr(),L=C.redAdd(C).redIAdd(C).redIAdd(S.redMul(T)),$=A.redAdd(A);$=$.redIAdd($);var B=$.redMul(I),U=L.redSqr().redISub(B.redAdd(B)),z=B.redISub(U),ne=I.redSqr();ne=ne.redIAdd(ne),ne=ne.redIAdd(ne),ne=ne.redIAdd(ne);var ue=L.redMul(z).redISub(ne),he=R.redAdd(R).redMul(x);return this.curve.jpoint(U,ue,he)},E.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var S=this.x.redSqr(),A=this.y.redSqr(),R=this.z.redSqr(),x=A.redSqr(),T=S.redAdd(S).redIAdd(S),C=T.redSqr(),I=this.x.redAdd(A).redSqr().redISub(S).redISub(x);I=I.redIAdd(I),I=I.redAdd(I).redIAdd(I),I=I.redISub(C);var L=I.redSqr(),$=x.redIAdd(x);$=$.redIAdd($),$=$.redIAdd($),$=$.redIAdd($);var B=T.redIAdd(I).redSqr().redISub(C).redISub(L).redISub($),U=A.redMul(B);U=U.redIAdd(U),U=U.redIAdd(U);var z=this.x.redMul(L).redISub(U);z=z.redIAdd(z),z=z.redIAdd(z);var ne=this.y.redMul(B.redMul($.redISub(B)).redISub(I.redMul(L)));ne=ne.redIAdd(ne),ne=ne.redIAdd(ne),ne=ne.redIAdd(ne);var ue=this.z.redAdd(I).redSqr().redISub(R).redISub(L);return this.curve.jpoint(z,ne,ue)},E.prototype.mul=function(S,A){return S=new u(S,A),this.curve._wnafMul(this,S)},E.prototype.eq=function(S){if(S.type==="affine")return this.eq(S.toJ());if(this===S)return!0;var A=this.z.redSqr(),R=S.z.redSqr();if(this.x.redMul(R).redISub(S.x.redMul(A)).cmpn(0)!==0)return!1;var x=A.redMul(this.z),T=R.redMul(S.z);return this.y.redMul(T).redISub(S.y.redMul(x)).cmpn(0)===0},E.prototype.eqXToP=function(S){var A=this.z.redSqr(),R=S.toRed(this.curve.red).redMul(A);if(this.x.cmp(R)===0)return!0;for(var x=S.clone(),T=this.curve.redN.redMul(A);;){if(x.iadd(this.curve.n),x.cmp(this.curve.p)>=0)return!1;if(R.redIAdd(T),this.x.cmp(R)===0)return!0}},E.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},E.prototype.isInfinity=function(){return this.z.cmpn(0)===0},short}var mont,hasRequiredMont;function requireMont(){if(hasRequiredMont)return mont;hasRequiredMont=1;var g=requireBn(),u=requireInherits_browser(),h=requireBase(),y=requireUtils$2();function v(w){h.call(this,"mont",w),this.a=new g(w.a,16).toRed(this.red),this.b=new g(w.b,16).toRed(this.red),this.i4=new g(4).toRed(this.red).redInvm(),this.two=new g(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}u(v,h),mont=v,v.prototype.validate=function(E){var _=E.normalize().x,S=_.redSqr(),A=S.redMul(_).redAdd(S.redMul(this.a)).redAdd(_),R=A.redSqrt();return R.redSqr().cmp(A)===0};function b(w,E,_){h.BasePoint.call(this,w,"projective"),E===null&&_===null?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new g(E,16),this.z=new g(_,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}return u(b,h.BasePoint),v.prototype.decodePoint=function(E,_){return this.point(y.toArray(E,_),1)},v.prototype.point=function(E,_){return new b(this,E,_)},v.prototype.pointFromJSON=function(E){return b.fromJSON(this,E)},b.prototype.precompute=function(){},b.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())},b.fromJSON=function(E,_){return new b(E,_[0],_[1]||E.one)},b.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},b.prototype.isInfinity=function(){return this.z.cmpn(0)===0},b.prototype.dbl=function(){var E=this.x.redAdd(this.z),_=E.redSqr(),S=this.x.redSub(this.z),A=S.redSqr(),R=_.redSub(A),x=_.redMul(A),T=R.redMul(A.redAdd(this.curve.a24.redMul(R)));return this.curve.point(x,T)},b.prototype.add=function(){throw new Error("Not supported on Montgomery curve")},b.prototype.diffAdd=function(E,_){var S=this.x.redAdd(this.z),A=this.x.redSub(this.z),R=E.x.redAdd(E.z),x=E.x.redSub(E.z),T=x.redMul(S),C=R.redMul(A),I=_.z.redMul(T.redAdd(C).redSqr()),L=_.x.redMul(T.redISub(C).redSqr());return this.curve.point(I,L)},b.prototype.mul=function(E){for(var _=E.clone(),S=this,A=this.curve.point(null,null),R=this,x=[];_.cmpn(0)!==0;_.iushrn(1))x.push(_.andln(1));for(var T=x.length-1;T>=0;T--)x[T]===0?(S=S.diffAdd(A,R),A=A.dbl()):(A=S.diffAdd(A,R),S=S.dbl());return A},b.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")},b.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")},b.prototype.eq=function(E){return this.getX().cmp(E.getX())===0},b.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this},b.prototype.getX=function(){return this.normalize(),this.x.fromRed()},mont}var edwards,hasRequiredEdwards;function requireEdwards(){if(hasRequiredEdwards)return edwards;hasRequiredEdwards=1;var g=requireUtils$2(),u=requireBn(),h=requireInherits_browser(),y=requireBase(),v=g.assert;function b(E){this.twisted=(E.a|0)!==1,this.mOneA=this.twisted&&(E.a|0)===-1,this.extended=this.mOneA,y.call(this,"edwards",E),this.a=new u(E.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new u(E.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new u(E.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),v(!this.twisted||this.c.fromRed().cmpn(1)===0),this.oneC=(E.c|0)===1}h(b,y),edwards=b,b.prototype._mulA=function(_){return this.mOneA?_.redNeg():this.a.redMul(_)},b.prototype._mulC=function(_){return this.oneC?_:this.c.redMul(_)},b.prototype.jpoint=function(_,S,A,R){return this.point(_,S,A,R)},b.prototype.pointFromX=function(_,S){_=new u(_,16),_.red||(_=_.toRed(this.red));var A=_.redSqr(),R=this.c2.redSub(this.a.redMul(A)),x=this.one.redSub(this.c2.redMul(this.d).redMul(A)),T=R.redMul(x.redInvm()),C=T.redSqrt();if(C.redSqr().redSub(T).cmp(this.zero)!==0)throw new Error("invalid point");var I=C.fromRed().isOdd();return(S&&!I||!S&&I)&&(C=C.redNeg()),this.point(_,C)},b.prototype.pointFromY=function(_,S){_=new u(_,16),_.red||(_=_.toRed(this.red));var A=_.redSqr(),R=A.redSub(this.c2),x=A.redMul(this.d).redMul(this.c2).redSub(this.a),T=R.redMul(x.redInvm());if(T.cmp(this.zero)===0){if(S)throw new Error("invalid point");return this.point(this.zero,_)}var C=T.redSqrt();if(C.redSqr().redSub(T).cmp(this.zero)!==0)throw new Error("invalid point");return C.fromRed().isOdd()!==S&&(C=C.redNeg()),this.point(C,_)},b.prototype.validate=function(_){if(_.isInfinity())return!0;_.normalize();var S=_.x.redSqr(),A=_.y.redSqr(),R=S.redMul(this.a).redAdd(A),x=this.c2.redMul(this.one.redAdd(this.d.redMul(S).redMul(A)));return R.cmp(x)===0};function w(E,_,S,A,R){y.BasePoint.call(this,E,"projective"),_===null&&S===null&&A===null?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new u(_,16),this.y=new u(S,16),this.z=A?new u(A,16):this.curve.one,this.t=R&&new u(R,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}return h(w,y.BasePoint),b.prototype.pointFromJSON=function(_){return w.fromJSON(this,_)},b.prototype.point=function(_,S,A,R){return new w(this,_,S,A,R)},w.fromJSON=function(_,S){return new w(_,S[0],S[1],S[2])},w.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},w.prototype.isInfinity=function(){return this.x.cmpn(0)===0&&(this.y.cmp(this.z)===0||this.zOne&&this.y.cmp(this.curve.c)===0)},w.prototype._extDbl=function(){var _=this.x.redSqr(),S=this.y.redSqr(),A=this.z.redSqr();A=A.redIAdd(A);var R=this.curve._mulA(_),x=this.x.redAdd(this.y).redSqr().redISub(_).redISub(S),T=R.redAdd(S),C=T.redSub(A),I=R.redSub(S),L=x.redMul(C),$=T.redMul(I),B=x.redMul(I),U=C.redMul(T);return this.curve.point(L,$,U,B)},w.prototype._projDbl=function(){var _=this.x.redAdd(this.y).redSqr(),S=this.x.redSqr(),A=this.y.redSqr(),R,x,T,C,I,L;if(this.curve.twisted){C=this.curve._mulA(S);var $=C.redAdd(A);this.zOne?(R=_.redSub(S).redSub(A).redMul($.redSub(this.curve.two)),x=$.redMul(C.redSub(A)),T=$.redSqr().redSub($).redSub($)):(I=this.z.redSqr(),L=$.redSub(I).redISub(I),R=_.redSub(S).redISub(A).redMul(L),x=$.redMul(C.redSub(A)),T=$.redMul(L))}else C=S.redAdd(A),I=this.curve._mulC(this.z).redSqr(),L=C.redSub(I).redSub(I),R=this.curve._mulC(_.redISub(C)).redMul(L),x=this.curve._mulC(C).redMul(S.redISub(A)),T=C.redMul(L);return this.curve.point(R,x,T)},w.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()},w.prototype._extAdd=function(_){var S=this.y.redSub(this.x).redMul(_.y.redSub(_.x)),A=this.y.redAdd(this.x).redMul(_.y.redAdd(_.x)),R=this.t.redMul(this.curve.dd).redMul(_.t),x=this.z.redMul(_.z.redAdd(_.z)),T=A.redSub(S),C=x.redSub(R),I=x.redAdd(R),L=A.redAdd(S),$=T.redMul(C),B=I.redMul(L),U=T.redMul(L),z=C.redMul(I);return this.curve.point($,B,z,U)},w.prototype._projAdd=function(_){var S=this.z.redMul(_.z),A=S.redSqr(),R=this.x.redMul(_.x),x=this.y.redMul(_.y),T=this.curve.d.redMul(R).redMul(x),C=A.redSub(T),I=A.redAdd(T),L=this.x.redAdd(this.y).redMul(_.x.redAdd(_.y)).redISub(R).redISub(x),$=S.redMul(C).redMul(L),B,U;return this.curve.twisted?(B=S.redMul(I).redMul(x.redSub(this.curve._mulA(R))),U=C.redMul(I)):(B=S.redMul(I).redMul(x.redSub(R)),U=this.curve._mulC(C).redMul(I)),this.curve.point($,B,U)},w.prototype.add=function(_){return this.isInfinity()?_:_.isInfinity()?this:this.curve.extended?this._extAdd(_):this._projAdd(_)},w.prototype.mul=function(_){return this._hasDoubles(_)?this.curve._fixedNafMul(this,_):this.curve._wnafMul(this,_)},w.prototype.mulAdd=function(_,S,A){return this.curve._wnafMulAdd(1,[this,S],[_,A],2,!1)},w.prototype.jmulAdd=function(_,S,A){return this.curve._wnafMulAdd(1,[this,S],[_,A],2,!0)},w.prototype.normalize=function(){if(this.zOne)return this;var _=this.z.redInvm();return this.x=this.x.redMul(_),this.y=this.y.redMul(_),this.t&&(this.t=this.t.redMul(_)),this.z=this.curve.one,this.zOne=!0,this},w.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())},w.prototype.getX=function(){return this.normalize(),this.x.fromRed()},w.prototype.getY=function(){return this.normalize(),this.y.fromRed()},w.prototype.eq=function(_){return this===_||this.getX().cmp(_.getX())===0&&this.getY().cmp(_.getY())===0},w.prototype.eqXToP=function(_){var S=_.toRed(this.curve.red).redMul(this.z);if(this.x.cmp(S)===0)return!0;for(var A=_.clone(),R=this.curve.redN.redMul(this.z);;){if(A.iadd(this.curve.n),A.cmp(this.curve.p)>=0)return!1;if(S.redIAdd(R),this.x.cmp(S)===0)return!0}},w.prototype.toP=w.prototype.normalize,w.prototype.mixedAdd=w.prototype.add,edwards}var hasRequiredCurve;function requireCurve(){return hasRequiredCurve||(hasRequiredCurve=1,(function(g){var u=g;u.base=requireBase(),u.short=requireShort(),u.mont=requireMont(),u.edwards=requireEdwards()})(curve)),curve}var curves={},secp256k1,hasRequiredSecp256k1;function requireSecp256k1(){return hasRequiredSecp256k1||(hasRequiredSecp256k1=1,secp256k1={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}),secp256k1}var hasRequiredCurves;function requireCurves(){return hasRequiredCurves||(hasRequiredCurves=1,(function(g){var u=g,h=requireHash$1(),y=requireCurve(),v=requireUtils$2(),b=v.assert;function w(S){S.type==="short"?this.curve=new y.short(S):S.type==="edwards"?this.curve=new y.edwards(S):this.curve=new y.mont(S),this.g=this.curve.g,this.n=this.curve.n,this.hash=S.hash,b(this.g.validate(),"Invalid curve"),b(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}u.PresetCurve=w;function E(S,A){Object.defineProperty(u,S,{configurable:!0,enumerable:!0,get:function(){var R=new w(A);return Object.defineProperty(u,S,{configurable:!0,enumerable:!0,value:R}),R}})}E("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:h.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),E("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:h.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),E("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:h.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),E("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:h.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),E("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:h.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),E("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:h.sha256,gRed:!1,g:["9"]}),E("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:h.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});var _;try{_=requireSecp256k1()}catch{_=void 0}E("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:h.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",_]})})(curves)),curves}var hmacDrbg,hasRequiredHmacDrbg;function requireHmacDrbg(){if(hasRequiredHmacDrbg)return hmacDrbg;hasRequiredHmacDrbg=1;var g=requireHash$1(),u=requireUtils$3(),h=requireMinimalisticAssert();function y(v){if(!(this instanceof y))return new y(v);this.hash=v.hash,this.predResist=!!v.predResist,this.outLen=this.hash.outSize,this.minEntropy=v.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var b=u.toArray(v.entropy,v.entropyEnc||"hex"),w=u.toArray(v.nonce,v.nonceEnc||"hex"),E=u.toArray(v.pers,v.persEnc||"hex");h(b.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(b,w,E)}return hmacDrbg=y,y.prototype._init=function(b,w,E){var _=b.concat(w).concat(E);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var S=0;S<this.V.length;S++)this.K[S]=0,this.V[S]=1;this._update(_),this._reseed=1,this.reseedInterval=281474976710656},y.prototype._hmac=function(){return new g.hmac(this.hash,this.K)},y.prototype._update=function(b){var w=this._hmac().update(this.V).update([0]);b&&(w=w.update(b)),this.K=w.digest(),this.V=this._hmac().update(this.V).digest(),b&&(this.K=this._hmac().update(this.V).update([1]).update(b).digest(),this.V=this._hmac().update(this.V).digest())},y.prototype.reseed=function(b,w,E,_){typeof w!="string"&&(_=E,E=w,w=null),b=u.toArray(b,w),E=u.toArray(E,_),h(b.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(b.concat(E||[])),this._reseed=1},y.prototype.generate=function(b,w,E,_){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");typeof w!="string"&&(_=E,E=w,w=null),E&&(E=u.toArray(E,_||"hex"),this._update(E));for(var S=[];S.length<b;)this.V=this._hmac().update(this.V).digest(),S=S.concat(this.V);var A=S.slice(0,b);return this._update(E),this._reseed++,u.encode(A,w)},hmacDrbg}var key$1,hasRequiredKey$1;function requireKey$1(){if(hasRequiredKey$1)return key$1;hasRequiredKey$1=1;var g=requireBn(),u=requireUtils$2(),h=u.assert;function y(v,b){this.ec=v,this.priv=null,this.pub=null,b.priv&&this._importPrivate(b.priv,b.privEnc),b.pub&&this._importPublic(b.pub,b.pubEnc)}return key$1=y,y.fromPublic=function(b,w,E){return w instanceof y?w:new y(b,{pub:w,pubEnc:E})},y.fromPrivate=function(b,w,E){return w instanceof y?w:new y(b,{priv:w,privEnc:E})},y.prototype.validate=function(){var b=this.getPublic();return b.isInfinity()?{result:!1,reason:"Invalid public key"}:b.validate()?b.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},y.prototype.getPublic=function(b,w){return typeof b=="string"&&(w=b,b=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),w?this.pub.encode(w,b):this.pub},y.prototype.getPrivate=function(b){return b==="hex"?this.priv.toString(16,2):this.priv},y.prototype._importPrivate=function(b,w){this.priv=new g(b,w||16),this.priv=this.priv.umod(this.ec.curve.n)},y.prototype._importPublic=function(b,w){if(b.x||b.y){this.ec.curve.type==="mont"?h(b.x,"Need x coordinate"):(this.ec.curve.type==="short"||this.ec.curve.type==="edwards")&&h(b.x&&b.y,"Need both x and y coordinate"),this.pub=this.ec.curve.point(b.x,b.y);return}this.pub=this.ec.curve.decodePoint(b,w)},y.prototype.derive=function(b){return b.validate()||h(b.validate(),"public point not validated"),b.mul(this.priv).getX()},y.prototype.sign=function(b,w,E){return this.ec.sign(b,this,w,E)},y.prototype.verify=function(b,w,E){return this.ec.verify(b,w,this,void 0,E)},y.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"},key$1}var signature$1,hasRequiredSignature$1;function requireSignature$1(){if(hasRequiredSignature$1)return signature$1;hasRequiredSignature$1=1;var g=requireBn(),u=requireUtils$2(),h=u.assert;function y(_,S){if(_ instanceof y)return _;this._importDER(_,S)||(h(_.r&&_.s,"Signature without r or s"),this.r=new g(_.r,16),this.s=new g(_.s,16),_.recoveryParam===void 0?this.recoveryParam=null:this.recoveryParam=_.recoveryParam)}signature$1=y;function v(){this.place=0}function b(_,S){var A=_[S.place++];if(!(A&128))return A;var R=A&15;if(R===0||R>4||_[S.place]===0)return!1;for(var x=0,T=0,C=S.place;T<R;T++,C++)x<<=8,x|=_[C],x>>>=0;return x<=127?!1:(S.place=C,x)}function w(_){for(var S=0,A=_.length-1;!_[S]&&!(_[S+1]&128)&&S<A;)S++;return S===0?_:_.slice(S)}y.prototype._importDER=function(S,A){S=u.toArray(S,A);var R=new v;if(S[R.place++]!==48)return!1;var x=b(S,R);if(x===!1||x+R.place!==S.length||S[R.place++]!==2)return!1;var T=b(S,R);if(T===!1||(S[R.place]&128)!==0)return!1;var C=S.slice(R.place,T+R.place);if(R.place+=T,S[R.place++]!==2)return!1;var I=b(S,R);if(I===!1||S.length!==I+R.place||(S[R.place]&128)!==0)return!1;var L=S.slice(R.place,I+R.place);if(C[0]===0)if(C[1]&128)C=C.slice(1);else return!1;if(L[0]===0)if(L[1]&128)L=L.slice(1);else return!1;return this.r=new g(C),this.s=new g(L),this.recoveryParam=null,!0};function E(_,S){if(S<128){_.push(S);return}var A=1+(Math.log(S)/Math.LN2>>>3);for(_.push(A|128);--A;)_.push(S>>>(A<<3)&255);_.push(S)}return y.prototype.toDER=function(S){var A=this.r.toArray(),R=this.s.toArray();for(A[0]&128&&(A=[0].concat(A)),R[0]&128&&(R=[0].concat(R)),A=w(A),R=w(R);!R[0]&&!(R[1]&128);)R=R.slice(1);var x=[2];E(x,A.length),x=x.concat(A),x.push(2),E(x,R.length);var T=x.concat(R),C=[48];return E(C,T.length),C=C.concat(T),u.encode(C,S)},signature$1}var ec$2,hasRequiredEc;function requireEc(){if(hasRequiredEc)return ec$2;hasRequiredEc=1;var g=requireBn(),u=requireHmacDrbg(),h=requireUtils$2(),y=requireCurves(),v=requireBrorand(),b=h.assert,w=requireKey$1(),E=requireSignature$1();function _(S){if(!(this instanceof _))return new _(S);typeof S=="string"&&(b(Object.prototype.hasOwnProperty.call(y,S),"Unknown curve "+S),S=y[S]),S instanceof y.PresetCurve&&(S={curve:S}),this.curve=S.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=S.curve.g,this.g.precompute(S.curve.n.bitLength()+1),this.hash=S.hash||S.curve.hash}return ec$2=_,_.prototype.keyPair=function(A){return new w(this,A)},_.prototype.keyFromPrivate=function(A,R){return w.fromPrivate(this,A,R)},_.prototype.keyFromPublic=function(A,R){return w.fromPublic(this,A,R)},_.prototype.genKeyPair=function(A){A||(A={});for(var R=new u({hash:this.hash,pers:A.pers,persEnc:A.persEnc||"utf8",entropy:A.entropy||v(this.hash.hmacStrength),entropyEnc:A.entropy&&A.entropyEnc||"utf8",nonce:this.n.toArray()}),x=this.n.byteLength(),T=this.n.sub(new g(2));;){var C=new g(R.generate(x));if(!(C.cmp(T)>0))return C.iaddn(1),this.keyFromPrivate(C)}},_.prototype._truncateToN=function(A,R,x){var T;if(g.isBN(A)||typeof A=="number")A=new g(A,16),T=A.byteLength();else if(typeof A=="object")T=A.length,A=new g(A,16);else{var C=A.toString();T=C.length+1>>>1,A=new g(C,16)}typeof x!="number"&&(x=T*8);var I=x-this.n.bitLength();return I>0&&(A=A.ushrn(I)),!R&&A.cmp(this.n)>=0?A.sub(this.n):A},_.prototype.sign=function(A,R,x,T){if(typeof x=="object"&&(T=x,x=null),T||(T={}),typeof A!="string"&&typeof A!="number"&&!g.isBN(A)){b(typeof A=="object"&&A&&typeof A.length=="number","Expected message to be an array-like, a hex string, or a BN instance"),b(A.length>>>0===A.length);for(var C=0;C<A.length;C++)b((A[C]&255)===A[C])}R=this.keyFromPrivate(R,x),A=this._truncateToN(A,!1,T.msgBitLength),b(!A.isNeg(),"Can not sign a negative message");var I=this.n.byteLength(),L=R.getPrivate().toArray("be",I),$=A.toArray("be",I);b(new g($).eq(A),"Can not sign message");for(var B=new u({hash:this.hash,entropy:L,nonce:$,pers:T.pers,persEnc:T.persEnc||"utf8"}),U=this.n.sub(new g(1)),z=0;;z++){var ne=T.k?T.k(z):new g(B.generate(this.n.byteLength()));if(ne=this._truncateToN(ne,!0),!(ne.cmpn(1)<=0||ne.cmp(U)>=0)){var ue=this.g.mul(ne);if(!ue.isInfinity()){var he=ue.getX(),Y=he.umod(this.n);if(Y.cmpn(0)!==0){var X=ne.invm(this.n).mul(Y.mul(R.getPrivate()).iadd(A));if(X=X.umod(this.n),X.cmpn(0)!==0){var J=(ue.getY().isOdd()?1:0)|(he.cmp(Y)!==0?2:0);return T.canonical&&X.cmp(this.nh)>0&&(X=this.n.sub(X),J^=1),new E({r:Y,s:X,recoveryParam:J})}}}}}},_.prototype.verify=function(A,R,x,T,C){C||(C={}),A=this._truncateToN(A,!1,C.msgBitLength),x=this.keyFromPublic(x,T),R=new E(R,"hex");var I=R.r,L=R.s;if(I.cmpn(1)<0||I.cmp(this.n)>=0||L.cmpn(1)<0||L.cmp(this.n)>=0)return!1;var $=L.invm(this.n),B=$.mul(A).umod(this.n),U=$.mul(I).umod(this.n),z;return this.curve._maxwellTrick?(z=this.g.jmulAdd(B,x.getPublic(),U),z.isInfinity()?!1:z.eqXToP(I)):(z=this.g.mulAdd(B,x.getPublic(),U),z.isInfinity()?!1:z.getX().umod(this.n).cmp(I)===0)},_.prototype.recoverPubKey=function(S,A,R,x){b((3&R)===R,"The recovery param is more than two bits"),A=new E(A,x);var T=this.n,C=new g(S),I=A.r,L=A.s,$=R&1,B=R>>1;if(I.cmp(this.curve.p.umod(this.curve.n))>=0&&B)throw new Error("Unable to find sencond key candinate");B?I=this.curve.pointFromX(I.add(this.curve.n),$):I=this.curve.pointFromX(I,$);var U=A.r.invm(T),z=T.sub(C).mul(U).umod(T),ne=L.mul(U).umod(T);return this.g.mulAdd(z,I,ne)},_.prototype.getKeyRecoveryParam=function(S,A,R,x){if(A=new E(A,x),A.recoveryParam!==null)return A.recoveryParam;for(var T=0;T<4;T++){var C;try{C=this.recoverPubKey(S,A,T)}catch{continue}if(C.eq(R))return T}throw new Error("Unable to find valid recovery factor")},ec$2}var key,hasRequiredKey;function requireKey(){if(hasRequiredKey)return key;hasRequiredKey=1;var g=requireUtils$2(),u=g.assert,h=g.parseBytes,y=g.cachedProperty;function v(b,w){this.eddsa=b,this._secret=h(w.secret),b.isPoint(w.pub)?this._pub=w.pub:this._pubBytes=h(w.pub)}return v.fromPublic=function(w,E){return E instanceof v?E:new v(w,{pub:E})},v.fromSecret=function(w,E){return E instanceof v?E:new v(w,{secret:E})},v.prototype.secret=function(){return this._secret},y(v,"pubBytes",function(){return this.eddsa.encodePoint(this.pub())}),y(v,"pub",function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())}),y(v,"privBytes",function(){var w=this.eddsa,E=this.hash(),_=w.encodingLength-1,S=E.slice(0,w.encodingLength);return S[0]&=248,S[_]&=127,S[_]|=64,S}),y(v,"priv",function(){return this.eddsa.decodeInt(this.privBytes())}),y(v,"hash",function(){return this.eddsa.hash().update(this.secret()).digest()}),y(v,"messagePrefix",function(){return this.hash().slice(this.eddsa.encodingLength)}),v.prototype.sign=function(w){return u(this._secret,"KeyPair can only verify"),this.eddsa.sign(w,this)},v.prototype.verify=function(w,E){return this.eddsa.verify(w,E,this)},v.prototype.getSecret=function(w){return u(this._secret,"KeyPair is public only"),g.encode(this.secret(),w)},v.prototype.getPublic=function(w){return g.encode(this.pubBytes(),w)},key=v,key}var signature,hasRequiredSignature;function requireSignature(){if(hasRequiredSignature)return signature;hasRequiredSignature=1;var g=requireBn(),u=requireUtils$2(),h=u.assert,y=u.cachedProperty,v=u.parseBytes;function b(w,E){this.eddsa=w,typeof E!="object"&&(E=v(E)),Array.isArray(E)&&(h(E.length===w.encodingLength*2,"Signature has invalid size"),E={R:E.slice(0,w.encodingLength),S:E.slice(w.encodingLength)}),h(E.R&&E.S,"Signature without R or S"),w.isPoint(E.R)&&(this._R=E.R),E.S instanceof g&&(this._S=E.S),this._Rencoded=Array.isArray(E.R)?E.R:E.Rencoded,this._Sencoded=Array.isArray(E.S)?E.S:E.Sencoded}return y(b,"S",function(){return this.eddsa.decodeInt(this.Sencoded())}),y(b,"R",function(){return this.eddsa.decodePoint(this.Rencoded())}),y(b,"Rencoded",function(){return this.eddsa.encodePoint(this.R())}),y(b,"Sencoded",function(){return this.eddsa.encodeInt(this.S())}),b.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())},b.prototype.toHex=function(){return u.encode(this.toBytes(),"hex").toUpperCase()},signature=b,signature}var eddsa,hasRequiredEddsa;function requireEddsa(){if(hasRequiredEddsa)return eddsa;hasRequiredEddsa=1;var g=requireHash$1(),u=requireCurves(),h=requireUtils$2(),y=h.assert,v=h.parseBytes,b=requireKey(),w=requireSignature();function E(_){if(y(_==="ed25519","only tested with ed25519 so far"),!(this instanceof E))return new E(_);_=u[_].curve,this.curve=_,this.g=_.g,this.g.precompute(_.n.bitLength()+1),this.pointClass=_.point().constructor,this.encodingLength=Math.ceil(_.n.bitLength()/8),this.hash=g.sha512}return eddsa=E,E.prototype.sign=function(S,A){S=v(S);var R=this.keyFromSecret(A),x=this.hashInt(R.messagePrefix(),S),T=this.g.mul(x),C=this.encodePoint(T),I=this.hashInt(C,R.pubBytes(),S).mul(R.priv()),L=x.add(I).umod(this.curve.n);return this.makeSignature({R:T,S:L,Rencoded:C})},E.prototype.verify=function(S,A,R){if(S=v(S),A=this.makeSignature(A),A.S().gte(A.eddsa.curve.n)||A.S().isNeg())return!1;var x=this.keyFromPublic(R),T=this.hashInt(A.Rencoded(),x.pubBytes(),S),C=this.g.mul(A.S()),I=A.R().add(x.pub().mul(T));return I.eq(C)},E.prototype.hashInt=function(){for(var S=this.hash(),A=0;A<arguments.length;A++)S.update(arguments[A]);return h.intFromLE(S.digest()).umod(this.curve.n)},E.prototype.keyFromPublic=function(S){return b.fromPublic(this,S)},E.prototype.keyFromSecret=function(S){return b.fromSecret(this,S)},E.prototype.makeSignature=function(S){return S instanceof w?S:new w(this,S)},E.prototype.encodePoint=function(S){var A=S.getY().toArray("le",this.encodingLength);return A[this.encodingLength-1]|=S.getX().isOdd()?128:0,A},E.prototype.decodePoint=function(S){S=h.parseBytes(S);var A=S.length-1,R=S.slice(0,A).concat(S[A]&-129),x=(S[A]&128)!==0,T=h.intFromLE(R);return this.curve.pointFromY(T,x)},E.prototype.encodeInt=function(S){return S.toArray("le",this.encodingLength)},E.prototype.decodeInt=function(S){return h.intFromLE(S)},E.prototype.isPoint=function(S){return S instanceof this.pointClass},eddsa}var hasRequiredElliptic;function requireElliptic(){return hasRequiredElliptic||(hasRequiredElliptic=1,(function(g){var u=g;u.version=require$$0$1.version,u.utils=requireUtils$2(),u.rand=requireBrorand(),u.curve=requireCurve(),u.curves=requireCurves(),u.ec=requireEc(),u.eddsa=requireEddsa()})(elliptic)),elliptic}var ellipticExports=requireElliptic(),loglevel$4={exports:{}},loglevel$3=loglevel$4.exports,hasRequiredLoglevel;function requireLoglevel(){return hasRequiredLoglevel||(hasRequiredLoglevel=1,(function(g){(function(u,h){g.exports?g.exports=h():u.log=h()})(loglevel$3,function(){var u=function(){},h="undefined",y=typeof window!==h&&typeof window.navigator!==h&&/Trident\/|MSIE /.test(window.navigator.userAgent),v=["trace","debug","info","warn","error"],b={},w=null;function E(I,L){var $=I[L];if(typeof $.bind=="function")return $.bind(I);try{return Function.prototype.bind.call($,I)}catch{return function(){return Function.prototype.apply.apply($,[I,arguments])}}}function _(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function S(I){return I==="debug"&&(I="log"),typeof console===h?!1:I==="trace"&&y?_:console[I]!==void 0?E(console,I):console.log!==void 0?E(console,"log"):u}function A(){for(var I=this.getLevel(),L=0;L<v.length;L++){var $=v[L];this[$]=L<I?u:this.methodFactory($,I,this.name)}if(this.log=this.debug,typeof console===h&&I<this.levels.SILENT)return"No console available for logging"}function R(I){return function(){typeof console!==h&&(A.call(this),this[I].apply(this,arguments))}}function x(I,L,$){return S(I)||R.apply(this,arguments)}function T(I,L){var $=this,B,U,z,ne="loglevel";typeof I=="string"?ne+=":"+I:typeof I=="symbol"&&(ne=void 0);function ue(j){var M=(v[j]||"silent").toUpperCase();if(!(typeof window===h||!ne)){try{window.localStorage[ne]=M;return}catch{}try{window.document.cookie=encodeURIComponent(ne)+"="+M+";"}catch{}}}function he(){var j;if(!(typeof window===h||!ne)){try{j=window.localStorage[ne]}catch{}if(typeof j===h)try{var M=window.document.cookie,N=encodeURIComponent(ne),P=M.indexOf(N+"=");P!==-1&&(j=/^([^;]+)/.exec(M.slice(P+N.length+1))[1])}catch{}return $.levels[j]===void 0&&(j=void 0),j}}function Y(){if(!(typeof window===h||!ne)){try{window.localStorage.removeItem(ne)}catch{}try{window.document.cookie=encodeURIComponent(ne)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function X(j){var M=j;if(typeof M=="string"&&$.levels[M.toUpperCase()]!==void 0&&(M=$.levels[M.toUpperCase()]),typeof M=="number"&&M>=0&&M<=$.levels.SILENT)return M;throw new TypeError("log.setLevel() called with invalid level: "+j)}$.name=I,$.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},$.methodFactory=L||x,$.getLevel=function(){return z??U??B},$.setLevel=function(j,M){return z=X(j),M!==!1&&ue(z),A.call($)},$.setDefaultLevel=function(j){U=X(j),he()||$.setLevel(j,!1)},$.resetLevel=function(){z=null,Y(),A.call($)},$.enableAll=function(j){$.setLevel($.levels.TRACE,j)},$.disableAll=function(j){$.setLevel($.levels.SILENT,j)},$.rebuild=function(){if(w!==$&&(B=X(w.getLevel())),A.call($),w===$)for(var j in b)b[j].rebuild()},B=X(w?w.getLevel():"WARN");var J=he();J!=null&&(z=X(J)),A.call($)}w=new T,w.getLogger=function(L){if(typeof L!="symbol"&&typeof L!="string"||L==="")throw new TypeError("You must supply a name when creating a logger.");var $=b[L];return $||($=b[L]=new T(L,w.methodFactory)),$};var C=typeof window!==h?window.log:void 0;return w.noConflict=function(){return typeof window!==h&&window.log===w&&(window.log=C),w},w.getLoggers=function(){return b},w.default=w,w})})(loglevel$4)),loglevel$4.exports}var loglevelExports=requireLoglevel();const loglevel$2=getDefaultExportFromCjs(loglevelExports),loglevel$1=loglevel$2.getLogger("auth");loglevel$1.setLevel("error");const TORUS_LEGACY_NETWORK={MAINNET:"mainnet",TESTNET:"testnet",CYAN:"cyan",AQUA:"aqua",CELESTE:"celeste"},TORUS_SAPPHIRE_NETWORK={SAPPHIRE_DEVNET:"sapphire_devnet",SAPPHIRE_MAINNET:"sapphire_mainnet"};TORUS_LEGACY_NETWORK.MAINNET+"",TORUS_LEGACY_NETWORK.TESTNET+"",TORUS_LEGACY_NETWORK.CYAN+"",TORUS_LEGACY_NETWORK.AQUA+"",TORUS_LEGACY_NETWORK.CELESTE+"";TORUS_LEGACY_NETWORK.AQUA+"",TORUS_SAPPHIRE_NETWORK.SAPPHIRE_MAINNET,TORUS_LEGACY_NETWORK.CELESTE+"",TORUS_SAPPHIRE_NETWORK.SAPPHIRE_MAINNET,TORUS_LEGACY_NETWORK.CYAN+"",TORUS_SAPPHIRE_NETWORK.SAPPHIRE_MAINNET,TORUS_LEGACY_NETWORK.MAINNET+"",TORUS_SAPPHIRE_NETWORK.SAPPHIRE_MAINNET,TORUS_LEGACY_NETWORK.TESTNET+"",TORUS_SAPPHIRE_NETWORK.SAPPHIRE_DEVNET;TORUS_LEGACY_NETWORK.MAINNET+"",TORUS_LEGACY_NETWORK.TESTNET+"",TORUS_LEGACY_NETWORK.CYAN+"",TORUS_LEGACY_NETWORK.AQUA+"",TORUS_LEGACY_NETWORK.CELESTE+"";const SIGNER_MAP={[TORUS_SAPPHIRE_NETWORK.SAPPHIRE_MAINNET]:"https://api.web3auth.io/signer-service",[TORUS_SAPPHIRE_NETWORK.SAPPHIRE_DEVNET]:"https://api.web3auth.io/signer-service",[TORUS_LEGACY_NETWORK.MAINNET]:"https://api.web3auth.io/signer-service",[TORUS_LEGACY_NETWORK.TESTNET]:"https://api.web3auth.io/signer-service",[TORUS_LEGACY_NETWORK.CYAN]:"https://api.web3auth.io/signer-polygon-service",[TORUS_LEGACY_NETWORK.AQUA]:"https://api.web3auth.io/signer-polygon-service",[TORUS_LEGACY_NETWORK.CELESTE]:"https://api.web3auth.io/signer-polygon-service"};TORUS_LEGACY_NETWORK.MAINNET+"",TORUS_LEGACY_NETWORK.TESTNET+"",TORUS_LEGACY_NETWORK.CYAN+"",TORUS_LEGACY_NETWORK.AQUA+"",TORUS_LEGACY_NETWORK.CELESTE+"";const SESSION_SERVER_API_URL="https://api.web3auth.io/session-service",SESSION_SERVER_SOCKET_URL="https://session.web3auth.io";var cjs,hasRequiredCjs;function requireCjs(){if(hasRequiredCjs)return cjs;hasRequiredCjs=1;var g=function(B){return u(B)&&!h(B)};function u($){return!!$&&typeof $=="object"}function h($){var B=Object.prototype.toString.call($);return B==="[object RegExp]"||B==="[object Date]"||b($)}var y=typeof Symbol=="function"&&Symbol.for,v=y?Symbol.for("react.element"):60103;function b($){return $.$$typeof===v}function w($){return Array.isArray($)?[]:{}}function E($,B){return B.clone!==!1&&B.isMergeableObject($)?I(w($),$,B):$}function _($,B,U){return $.concat(B).map(function(z){return E(z,U)})}function S($,B){if(!B.customMerge)return I;var U=B.customMerge($);return typeof U=="function"?U:I}function A($){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols($).filter(function(B){return Object.propertyIsEnumerable.call($,B)}):[]}function R($){return Object.keys($).concat(A($))}function x($,B){try{return B in $}catch{return!1}}function T($,B){return x($,B)&&!(Object.hasOwnProperty.call($,B)&&Object.propertyIsEnumerable.call($,B))}function C($,B,U){var z={};return U.isMergeableObject($)&&R($).forEach(function(ne){z[ne]=E($[ne],U)}),R(B).forEach(function(ne){T($,ne)||(x($,ne)&&U.isMergeableObject(B[ne])?z[ne]=S(ne,U)($[ne],B[ne],U):z[ne]=E(B[ne],U))}),z}function I($,B,U){U=U||{},U.arrayMerge=U.arrayMerge||_,U.isMergeableObject=U.isMergeableObject||g,U.cloneUnlessOtherwiseSpecified=E;var z=Array.isArray(B),ne=Array.isArray($),ue=z===ne;return ue?z?U.arrayMerge($,B,U):C($,B,U):E(B,U)}I.all=function(B,U){if(!Array.isArray(B))throw new Error("first argument should be an array");return B.reduce(function(z,ne){return I(z,ne,U)},{})};var L=I;return cjs=L,cjs}var cjsExports=requireCjs();const deepmerge=getDefaultExportFromCjs(cjsExports),log$2=loglevel$2.getLogger("http-helpers");log$2.setLevel(loglevelExports.levels.INFO);let apiKey="torus-default";const gatewayAuthHeader="x-api-key";function setLogLevel(g){log$2.setLevel(g)}async function fetchAndTrace(g,u){let h=null;try{h=new URL(g)}catch{}return fetch(g,u)}function getApiKeyHeaders(){const g={};return g[gatewayAuthHeader]=apiKey,g}function debugLogResponse(g){log$2.info(`Response: ${g.status} ${g.statusText}`),log$2.info(`Url: ${g.url}`)}function logTracingHeader(g){const u=g.headers.get("x-web3-correlation-id");u&&log$2.info(`Request tracing with traceID = ${u}`)}const promiseTimeout=async(g,u)=>{let h=null;try{const y=new Promise((b,w)=>{h=setTimeout(()=>{w(new Error(`Timed out in ${g}ms`))},g)}),v=await Promise.race([u,y]);return h!=null&&clearTimeout(h),v}catch(y){throw h!=null&&clearTimeout(h),y}},get=async(g,u={},h={})=>{const y={mode:"cors",headers:{}};h.useAPIKey&&(y.headers=_objectSpread2(_objectSpread2({},y.headers),getApiKeyHeaders())),u.method="GET";const v=deepmerge(y,u),b=await fetchAndTrace(g,v);if(b.ok){const w=b.headers.get("content-type");return w!=null&&w.includes("application/json")?b.json():b.text()}throw debugLogResponse(b),b},post=(g,u={},h={},y={})=>{const v={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};y.useAPIKey&&(v.headers=_objectSpread2(_objectSpread2({},v.headers),getApiKeyHeaders())),h.method="POST";const b=deepmerge(v,h);return y.isUrlEncodedData?(b.body=u,b.headers["Content-Type"]==="application/json; charset=utf-8"&&delete b.headers["Content-Type"]):b.body=JSON.stringify(u),promiseTimeout(y.timeout||6e4,fetchAndTrace(g,b).then(w=>{if(y.logTracingHeader&&logTracingHeader(w),w.ok){const E=w.headers.get("content-type");return E!=null&&E.includes("application/json")?w.json():w.text()}throw debugLogResponse(w),w}))},patch=async(g,u={},h={},y={})=>{const v={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};y.useAPIKey&&(v.headers=_objectSpread2(_objectSpread2({},v.headers),getApiKeyHeaders())),h.method="PATCH";const b=deepmerge(v,h);y.isUrlEncodedData?(b.body=u,b.headers["Content-Type"]==="application/json; charset=utf-8"&&delete b.headers["Content-Type"]):b.body=JSON.stringify(u);const w=await fetchAndTrace(g,b);if(w.ok){const E=w.headers.get("content-type");return E!=null&&E.includes("application/json")?w.json():w.text()}throw debugLogResponse(w),w},put=async(g,u={},h={},y={})=>{const v={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};y.useAPIKey&&(v.headers=_objectSpread2(_objectSpread2({},v.headers),getApiKeyHeaders())),h.method="PUT";const b=deepmerge(v,h);y.isUrlEncodedData?(b.body=u,b.headers["Content-Type"]==="application/json; charset=utf-8"&&delete b.headers["Content-Type"]):b.body=JSON.stringify(u);const w=await fetchAndTrace(g,b);if(w.ok){const E=w.headers.get("content-type");return E!=null&&E.includes("application/json")?w.json():w.text()}throw debugLogResponse(w),w},padHexString=g=>g.padStart(64,"0").slice(0,64);class BaseSessionManager{constructor(){_defineProperty(this,"sessionId",void 0)}checkSessionParams(){if(!this.sessionId)throw new Error("Session id is required");this.sessionId=padHexString(this.sessionId)}request({method:u="GET",url:h,data:y={},headers:v={}}){const b={headers:v};switch(u){case"GET":return get(h,b);case"POST":return post(h,y,b);case"PUT":return put(h,y,b);case"PATCH":return patch(h,y,b)}throw new Error("Invalid method type")}}const ec$1=new ellipticExports.ec("secp256k1"),browserCrypto=globalThis.crypto||globalThis.msCrypto||{},subtle=browserCrypto.subtle||browserCrypto.webkitSubtle,EC_GROUP_ORDER=Buffer.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex"),ZERO32=Buffer.alloc(32,0);function assert(g,u){if(!g)throw new Error(u||"Assertion failed")}function isScalar(g){return Buffer.isBuffer(g)&&g.length===32}function isValidPrivateKey(g){return isScalar(g)?g.compare(ZERO32)>0&&g.compare(EC_GROUP_ORDER)<0:!1}function equalConstTime(g,u){if(g.length!==u.length)return!1;let h=0;for(let y=0;y<g.length;y++)h|=g[y]^u[y];return h===0}function randomBytes(g){if(typeof browserCrypto.getRandomValues>"u")return Buffer.from(browserCrypto.randomBytes(g));const u=new Uint8Array(g);return browserCrypto.getRandomValues(u),Buffer.from(u)}async function sha512(g){if(!browserCrypto.createHash){const y=await subtle.digest("SHA-512",g);return new Uint8Array(y)}const h=browserCrypto.createHash("sha512").update(g).digest();return new Uint8Array(h)}function getAes(g){return async function(u,h,y){if(subtle&&subtle[g]&&subtle.importKey){const v={name:"AES-CBC"},b=await subtle.importKey("raw",h,v,!1,[g]),w={name:"AES-CBC",iv:u},E=await subtle[g](w,b,y);return Buffer.from(new Uint8Array(E))}else if(g==="encrypt"&&browserCrypto.createCipheriv){const v=browserCrypto.createCipheriv("aes-256-cbc",h,u),b=v.update(y),w=v.final();return Buffer.concat([b,w])}else if(g==="decrypt"&&browserCrypto.createDecipheriv){const v=browserCrypto.createDecipheriv("aes-256-cbc",h,u),b=v.update(y),w=v.final();return Buffer.concat([b,w])}throw new Error(`Unsupported operation: ${g}`)}}const aesCbcEncrypt=getAes("encrypt"),aesCbcDecrypt=getAes("decrypt");async function hmacSha256Sign(g,u){if(!browserCrypto.createHmac){const v={name:"HMAC",hash:{name:"SHA-256"}},b=await subtle.importKey("raw",new Uint8Array(g),v,!1,["sign","verify"]),w=await subtle.sign("HMAC",b,u);return Buffer.from(new Uint8Array(w))}const h=browserCrypto.createHmac("sha256",Buffer.from(g));return h.update(u),h.digest()}async function hmacSha256Verify(g,u,h){const y=await hmacSha256Sign(g,u);return equalConstTime(y,h)}const generatePrivate=function(){let g=randomBytes(32);for(;!isValidPrivateKey(g);)g=randomBytes(32);return g},getPublic=function(g){return assert(g.length===32,"Bad private key"),assert(isValidPrivateKey(g),"Bad private key"),Buffer.from(ec$1.keyFromPrivate(g).getPublic("array"))},sign=async function(g,u){return assert(g.length===32,"Bad private key"),assert(isValidPrivateKey(g),"Bad private key"),assert(u.length>0,"Message should not be empty"),assert(u.length<=32,"Message is too long"),Buffer.from(ec$1.sign(u,g,{canonical:!0}).toDER())},derive=async function(g,u){assert(Buffer.isBuffer(g),"Bad private key"),assert(Buffer.isBuffer(u),"Bad public key"),assert(g.length===32,"Bad private key"),assert(isValidPrivateKey(g),"Bad private key"),assert(u.length===65||u.length===33,"Bad public key"),u.length===65&&assert(u[0]===4,"Bad public key"),u.length===33&&assert(u[0]===2||u[0]===3,"Bad public key");const h=ec$1.keyFromPrivate(g),y=ec$1.keyFromPublic(u),v=h.derive(y.getPublic());return Buffer.from(v.toArray())},deriveUnpadded=derive,derivePadded=async function(g,u){assert(Buffer.isBuffer(g),"Bad private key"),assert(Buffer.isBuffer(u),"Bad public key"),assert(g.length===32,"Bad private key"),assert(isValidPrivateKey(g),"Bad private key"),assert(u.length===65||u.length===33,"Bad public key"),u.length===65&&assert(u[0]===4,"Bad public key"),u.length===33&&assert(u[0]===2||u[0]===3,"Bad public key");const h=ec$1.keyFromPrivate(g),y=ec$1.keyFromPublic(u),v=h.derive(y.getPublic());return Buffer.from(v.toString(16,64),"hex")},encrypt=async function(g,u,h){h=h||{};let y=h.ephemPrivateKey||randomBytes(32);for(;!isValidPrivateKey(y);)y=h.ephemPrivateKey||randomBytes(32);const v=getPublic(y),b=await deriveUnpadded(y,g),w=await sha512(b),E=h.iv||randomBytes(16),_=w.slice(0,32),S=w.slice(32),R=await aesCbcEncrypt(E,Buffer.from(_),u),x=Buffer.concat([E,v,R]),T=await hmacSha256Sign(Buffer.from(S),x);return{iv:E,ephemPublicKey:v,ciphertext:R,mac:T}},decrypt=async function(g,u,h){const y=h??!1,b=await(y?derivePadded:deriveUnpadded)(g,u.ephemPublicKey),w=await sha512(b),E=w.slice(0,32),_=w.slice(32),S=Buffer.concat([u.iv,u.ephemPublicKey,u.ciphertext]),A=await hmacSha256Verify(Buffer.from(_),S,u.mac);if(!A&&y===!1)return decrypt(g,u,!0);if(!A&&y===!0)throw new Error("bad MAC after trying padded");const R=await aesCbcDecrypt(u.iv,Buffer.from(E),u.ciphertext);return Buffer.from(new Uint8Array(R))};var jsonify={},parse$1,hasRequiredParse;function requireParse(){if(hasRequiredParse)return parse$1;hasRequiredParse=1;var g,u,h={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},y;function v(T){throw{name:"SyntaxError",message:T,at:g,text:y}}function b(T){return T&&T!==u&&v("Expected '"+T+"' instead of '"+u+"'"),u=y.charAt(g),g+=1,u}function w(){var T,C="";for(u==="-"&&(C="-",b("-"));u>="0"&&u<="9";)C+=u,b();if(u===".")for(C+=".";b()&&u>="0"&&u<="9";)C+=u;if(u==="e"||u==="E")for(C+=u,b(),(u==="-"||u==="+")&&(C+=u,b());u>="0"&&u<="9";)C+=u,b();return T=Number(C),isFinite(T)||v("Bad number"),T}function E(){var T,C,I="",L;if(u==='"')for(;b();){if(u==='"')return b(),I;if(u==="\\")if(b(),u==="u"){for(L=0,C=0;C<4&&(T=parseInt(b(),16),!!isFinite(T));C+=1)L=L*16+T;I+=String.fromCharCode(L)}else if(typeof h[u]=="string")I+=h[u];else break;else I+=u}v("Bad string")}function _(){for(;u&&u<=" ";)b()}function S(){switch(u){case"t":return b("t"),b("r"),b("u"),b("e"),!0;case"f":return b("f"),b("a"),b("l"),b("s"),b("e"),!1;case"n":return b("n"),b("u"),b("l"),b("l"),null;default:v("Unexpected '"+u+"'")}}function A(){var T=[];if(u==="["){if(b("["),_(),u==="]")return b("]"),T;for(;u;){if(T.push(x()),_(),u==="]")return b("]"),T;b(","),_()}}v("Bad array")}function R(){var T,C={};if(u==="{"){if(b("{"),_(),u==="}")return b("}"),C;for(;u;){if(T=E(),_(),b(":"),Object.prototype.hasOwnProperty.call(C,T)&&v('Duplicate key "'+T+'"'),C[T]=x(),_(),u==="}")return b("}"),C;b(","),_()}}v("Bad object")}function x(){switch(_(),u){case"{":return R();case"[":return A();case'"':return E();case"-":return w();default:return u>="0"&&u<="9"?w():S()}}return parse$1=function(T,C){var I;return y=T,g=0,u=" ",I=x(),_(),u&&v("Syntax error"),typeof C=="function"?(function L($,B){var U,z,ne=$[B];if(ne&&typeof ne=="object")for(U in x)Object.prototype.hasOwnProperty.call(ne,U)&&(z=L(ne,U),typeof z>"u"?delete ne[U]:ne[U]=z);return C.call($,B,ne)})({"":I},""):I},parse$1}var stringify$1,hasRequiredStringify;function requireStringify(){if(hasRequiredStringify)return stringify$1;hasRequiredStringify=1;var g=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,u,h,y={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},v;function b(E){return g.lastIndex=0,g.test(E)?'"'+E.replace(g,function(_){var S=y[_];return typeof S=="string"?S:"\\u"+("0000"+_.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+E+'"'}function w(E,_){var S,A,R,x,T=u,C,I=_[E];switch(I&&typeof I=="object"&&typeof I.toJSON=="function"&&(I=I.toJSON(E)),typeof v=="function"&&(I=v.call(_,E,I)),typeof I){case"string":return b(I);case"number":return isFinite(I)?String(I):"null";case"boolean":case"null":return String(I);case"object":if(!I)return"null";if(u+=h,C=[],Object.prototype.toString.apply(I)==="[object Array]"){for(x=I.length,S=0;S<x;S+=1)C[S]=w(S,I)||"null";return R=C.length===0?"[]":u?`[
`+u+C.join(`,
`+u)+`
`+T+"]":"["+C.join(",")+"]",u=T,R}if(v&&typeof v=="object")for(x=v.length,S=0;S<x;S+=1)A=v[S],typeof A=="string"&&(R=w(A,I),R&&C.push(b(A)+(u?": ":":")+R));else for(A in I)Object.prototype.hasOwnProperty.call(I,A)&&(R=w(A,I),R&&C.push(b(A)+(u?": ":":")+R));return R=C.length===0?"{}":u?`{
`+u+C.join(`,
`+u)+`
`+T+"}":"{"+C.join(",")+"}",u=T,R}}return stringify$1=function(E,_,S){var A;if(u="",h="",typeof S=="number")for(A=0;A<S;A+=1)h+=" ";else typeof S=="string"&&(h=S);if(v=_,_&&typeof _!="function"&&(typeof _!="object"||typeof _.length!="number"))throw new Error("JSON.stringify");return w("",{"":E})},stringify$1}var hasRequiredJsonify;function requireJsonify(){return hasRequiredJsonify||(hasRequiredJsonify=1,jsonify.parse=requireParse(),jsonify.stringify=requireStringify()),jsonify}var jsonStableStringify,hasRequiredJsonStableStringify;function requireJsonStableStringify(){if(hasRequiredJsonStableStringify)return jsonStableStringify;hasRequiredJsonStableStringify=1;var g=(typeof JSON<"u"?JSON:requireJsonify()).stringify,u=requireIsarray$1(),h=requireObjectKeys(),y=requireCallBind(),v=requireCallBound(),b=v("Array.prototype.join"),w=v("Array.prototype.indexOf"),E=v("Array.prototype.splice"),_=v("Array.prototype.sort"),S=function(x,T){for(var C="",I=0;I<x;I+=1)C+=T;return C},A=function(R,x,T){return T};return jsonStableStringify=function(x){var T=arguments.length>1?arguments[1]:void 0,C=T&&T.space||"";typeof C=="number"&&(C=S(C," "));var I=!!T&&typeof T.cycles=="boolean"&&T.cycles,L=T&&T.replacer?y(T.replacer):A;if(T&&typeof T.collapseEmpty<"u"&&typeof T.collapseEmpty!="boolean")throw new TypeError("`collapseEmpty` must be a boolean, if provided");var $=!!T&&T.collapseEmpty,B=typeof T=="function"?T:T&&T.cmp,U=B&&function(ne){var ue=B.length>2&&function(Y){return ne[Y]};return function(he,Y){return B({key:he,value:ne[he]},{key:Y,value:ne[Y]},ue?{__proto__:null,get:ue}:void 0)}},z=[];return(function ne(ue,he,Y,X){var J=C?`
`+S(X,C):"",j=C?": ":":";if(Y&&Y.toJSON&&typeof Y.toJSON=="function"&&(Y=Y.toJSON()),Y=L(ue,he,Y),Y!==void 0){if(typeof Y!="object"||Y===null)return g(Y);var M=function(H,D){return $&&H.length===0?D:(D==="[]"?"[":"{")+b(H,",")+J+(D==="[]"?"]":"}")};if(u(Y)){for(var k=[],N=0;N<Y.length;N++){var P=ne(Y,N,Y[N],X+1)||g(null);k[k.length]=J+C+P}return M(k,"[]")}if(w(z,Y)!==-1){if(I)return g("__cycle__");throw new TypeError("Converting circular structure to JSON")}else z[z.length]=Y;for(var O=_(h(Y),U&&U(Y)),k=[],N=0;N<O.length;N++){var he=O[N],q=ne(Y,he,Y[he],X+1);if(q){var F=g(he)+j+q;k[k.length]=J+C+F}}return E(z,w(z,Y),1),M(k,"{}")}})({"":x},"",x,0)},jsonStableStringify}var jsonStableStringifyExports=requireJsonStableStringify();const stringify=getDefaultExportFromCjs(jsonStableStringifyExports),SHA3_PI=[],SHA3_ROTL=[],_SHA3_IOTA=[],_0n=BigInt(0),_1n=BigInt(1),_2n=BigInt(2),_7n=BigInt(7),_256n=BigInt(256),_0x71n=BigInt(113);for(let g=0,u=_1n,h=1,y=0;g<24;g++){[h,y]=[y,(2*h+3*y)%5],SHA3_PI.push(2*(5*y+h)),SHA3_ROTL.push((g+1)*(g+2)/2%64);let v=_0n;for(let b=0;b<7;b++)u=(u<<_1n^(u>>_7n)*_0x71n)%_256n,u&_2n&&(v^=_1n<<(_1n<<BigInt(b))-_1n);_SHA3_IOTA.push(v)}const[SHA3_IOTA_H,SHA3_IOTA_L]=split(_SHA3_IOTA,!0),rotlH=(g,u,h)=>h>32?rotlBH(g,u,h):rotlSH(g,u,h),rotlL=(g,u,h)=>h>32?rotlBL(g,u,h):rotlSL(g,u,h);function keccakP(g,u=24){const h=new Uint32Array(10);for(let y=24-u;y<24;y++){for(let w=0;w<10;w++)h[w]=g[w]^g[w+10]^g[w+20]^g[w+30]^g[w+40];for(let w=0;w<10;w+=2){const E=(w+8)%10,_=(w+2)%10,S=h[_],A=h[_+1],R=rotlH(S,A,1)^h[E],x=rotlL(S,A,1)^h[E+1];for(let T=0;T<50;T+=10)g[w+T]^=R,g[w+T+1]^=x}let v=g[2],b=g[3];for(let w=0;w<24;w++){const E=SHA3_ROTL[w],_=rotlH(v,b,E),S=rotlL(v,b,E),A=SHA3_PI[w];v=g[A],b=g[A+1],g[A]=_,g[A+1]=S}for(let w=0;w<50;w+=10){for(let E=0;E<10;E++)h[E]=g[w+E];for(let E=0;E<10;E++)g[w+E]^=~h[(E+2)%10]&h[(E+4)%10]}g[0]^=SHA3_IOTA_H[y],g[1]^=SHA3_IOTA_L[y]}h.fill(0)}class Keccak extends Hash{constructor(u,h,y,v=!1,b=24){if(super(),this.blockLen=u,this.suffix=h,this.outputLen=y,this.enableXOF=v,this.rounds=b,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,number(y),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=u32(this.state)}keccak(){isLE||byteSwap32(this.state32),keccakP(this.state32,this.rounds),isLE||byteSwap32(this.state32),this.posOut=0,this.pos=0}update(u){exists(this);const{blockLen:h,state:y}=this;u=toBytes(u);const v=u.length;for(let b=0;b<v;){const w=Math.min(h-this.pos,v-b);for(let E=0;E<w;E++)y[this.pos++]^=u[b++];this.pos===h&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:u,suffix:h,pos:y,blockLen:v}=this;u[y]^=h,(h&128)!==0&&y===v-1&&this.keccak(),u[v-1]^=128,this.keccak()}writeInto(u){exists(this,!1),bytes(u),this.finish();const h=this.state,{blockLen:y}=this;for(let v=0,b=u.length;v<b;){this.posOut>=y&&this.keccak();const w=Math.min(y-this.posOut,b-v);u.set(h.subarray(this.posOut,this.posOut+w),v),this.posOut+=w,v+=w}return u}xofInto(u){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(u)}xof(u){return number(u),this.xofInto(new Uint8Array(u))}digestInto(u){if(output(u,this),this.finished)throw new Error("digest() was already called");return this.writeInto(u),this.destroy(),u}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(u){const{blockLen:h,suffix:y,outputLen:v,rounds:b,enableXOF:w}=this;return u||(u=new Keccak(h,y,v,w,b)),u.state32.set(this.state32),u.pos=this.pos,u.posOut=this.posOut,u.finished=this.finished,u.rounds=b,u.suffix=y,u.outputLen=v,u.enableXOF=w,u.destroyed=this.destroyed,u}}const gen=(g,u,h)=>wrapConstructor(()=>new Keccak(u,g,h)),keccak_256=gen(1,136,256/8);function wrapHash(g){return u=>(assert$1.bytes(u),g(u))}(()=>{const g=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0,u=typeof module<"u"&&typeof module.require=="function"&&module.require.bind(module);return{node:u&&!g?u("crypto"):void 0,web:g}})();const keccak256$1=(()=>{const g=wrapHash(keccak_256);return g.create=keccak_256.create,g})();function keccak256(g){return Buffer.from(keccak256$1(g))}const ec=new ellipticExports.ec("secp256k1");function encParamsHexToBuf(g){return{iv:Buffer.from(g.iv,"hex"),ephemPublicKey:Buffer.from(g.ephemPublicKey,"hex"),ciphertext:Buffer.from(g.ciphertext,"hex"),mac:Buffer.from(g.mac,"hex")}}function encParamsBufToHex(g){return{iv:Buffer.from(g.iv).toString("hex"),ephemPublicKey:Buffer.from(g.ephemPublicKey).toString("hex"),ciphertext:Buffer.from(g.ciphertext).toString("hex"),mac:Buffer.from(g.mac).toString("hex")}}async function encryptData(g,u){const h=JSON.stringify(u),y=Buffer.from(h,"utf-8"),v=await encrypt(getPublic(Buffer.from(g,"hex")),y),b=encParamsBufToHex(v);return JSON.stringify(b)}async function decryptData(g,u){const h=JSON.parse(u),y=encParamsHexToBuf(h),v=ec.keyFromPrivate(g),w=(await decrypt(Buffer.from(v.getPrivate().toString("hex",64),"hex"),y)).toString("utf-8");return JSON.parse(w)}const DEFAULT_SESSION_TIMEOUT=86400;class SessionManager extends BaseSessionManager{constructor({sessionServerBaseUrl:u,sessionNamespace:h,sessionTime:y,sessionId:v,allowedOrigin:b}={}){super(),_defineProperty(this,"sessionServerBaseUrl",SESSION_SERVER_API_URL),_defineProperty(this,"sessionNamespace",void 0),_defineProperty(this,"allowedOrigin",void 0),_defineProperty(this,"sessionTime",DEFAULT_SESSION_TIMEOUT),_defineProperty(this,"sessionId",""),u&&(this.sessionServerBaseUrl=u),h&&(this.sessionNamespace=h),y&&(this.sessionTime=y),v&&(this.sessionId=padHexString(v)),b?this.allowedOrigin=b:this.allowedOrigin="*"}static generateRandomSessionKey(){return padHexString(generatePrivate().toString("hex"))}async createSession(u,h={}){super.checkSessionParams();const y=Buffer.from(this.sessionId,"hex"),v=getPublic(y).toString("hex"),b=await encryptData(this.sessionId,u),w=(await sign(y,keccak256(Buffer.from(b,"utf8")))).toString("hex"),E={key:v,data:b,signature:w,namespace:this.sessionNamespace,timeout:this.sessionTime,allowedOrigin:this.allowedOrigin};return await super.request({method:"POST",url:`${this.sessionServerBaseUrl}/v2/store/set`,data:E,headers:h}),this.sessionId}async authorizeSession({headers:u}={headers:{}}){super.checkSessionParams();const y={key:getPublic(Buffer.from(this.sessionId,"hex")).toString("hex"),namespace:this.sessionNamespace},v=await super.request({method:"POST",url:`${this.sessionServerBaseUrl}/v2/store/get`,data:y,headers:u});if(!v.message)throw new Error("Session Expired or Invalid public key");const b=await decryptData(this.sessionId,v.message);if(b.error)throw new Error("There was an error decrypting data.");return b}async updateSession(u,h={}){super.checkSessionParams();const y=Buffer.from(this.sessionId,"hex"),v=getPublic(y).toString("hex"),b=await encryptData(this.sessionId,u),w=(await sign(y,keccak256(Buffer.from(b,"utf8")))).toString("hex"),E={key:v,data:b,signature:w,namespace:this.sessionNamespace,allowedOrigin:this.allowedOrigin};await super.request({method:"PUT",url:`${this.sessionServerBaseUrl}/v2/store/update`,data:E,headers:h})}async invalidateSession(u={}){super.checkSessionParams();const h=Buffer.from(this.sessionId,"hex"),y=getPublic(h).toString("hex"),v=await encryptData(this.sessionId,{}),b=(await sign(h,keccak256(Buffer.from(v,"utf8")))).toString("hex"),w={key:y,data:v,signature:b,namespace:this.sessionNamespace,timeout:1};return await super.request({method:"POST",url:`${this.sessionServerBaseUrl}/v2/store/set`,data:w,headers:u}),this.sessionId="",!0}}function fixProto(g,u){var h=Object.setPrototypeOf;h?h(g,u):g.__proto__=u}function fixStack(g,u){u===void 0&&(u=g.constructor);var h=Error.captureStackTrace;h&&h(g,u)}var __extends=(function(){var g=function(h,y){return g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,b){v.__proto__=b}||function(v,b){for(var w in b)Object.prototype.hasOwnProperty.call(b,w)&&(v[w]=b[w])},g(h,y)};return function(u,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");g(u,h);function y(){this.constructor=u}u.prototype=h===null?Object.create(h):(y.prototype=h.prototype,new y)}})(),CustomError=(function(g){__extends(u,g);function u(h,y){var v=this.constructor,b=g.call(this,h,y)||this;return Object.defineProperty(b,"name",{value:v.name,enumerable:!1,configurable:!0}),fixProto(b,v.prototype),fixStack(b),b}return u})(Error);class AuthError extends CustomError{constructor(u,h){super(h),_defineProperty(this,"code",void 0),_defineProperty(this,"message",void 0),this.code=u,this.message=h||"",Object.defineProperty(this,"name",{value:"AuthError"})}toJSON(){return{name:this.name,code:this.code,message:this.message}}toString(){return JSON.stringify(this.toJSON())}}class InitializationError extends AuthError{constructor(u,h){super(u,h),Object.defineProperty(this,"name",{value:"InitializationError"})}static fromCode(u,h=""){return new InitializationError(u,`${InitializationError.messages[u]}, ${h}`)}static invalidParams(u=""){return InitializationError.fromCode(5001,u)}static notInitialized(u=""){return InitializationError.fromCode(5002,u)}}_defineProperty(InitializationError,"messages",{5e3:"Custom",5001:"Invalid constructor params",5002:"SDK not initialized. please call init first"});class LoginError extends AuthError{constructor(u,h){super(u,h),Object.defineProperty(this,"name",{value:"LoginError"})}static fromCode(u,h=""){return new LoginError(u,`${LoginError.messages[u]}, ${h}`)}static invalidLoginParams(u=""){return LoginError.fromCode(5111,u)}static userNotLoggedIn(u=""){return LoginError.fromCode(5112,u)}static popupClosed(u=""){return LoginError.fromCode(5113,u)}static loginFailed(u=""){return LoginError.fromCode(5114,u)}static popupBlocked(u=""){return LoginError.fromCode(5115,u)}static mfaAlreadyEnabled(u=""){return LoginError.fromCode(5116,u)}static mfaNotEnabled(u=""){return LoginError.fromCode(5117,u)}}_defineProperty(LoginError,"messages",{5e3:"Custom",5111:"Invalid login params",5112:"User not logged in.",5113:"login popup has been closed by the user",5114:"Login failed",5115:"Popup was blocked. Please call this function as soon as user clicks button or use redirect mode",5116:"MFA already enabled",5117:"MFA not yet enabled. Please call `enableMFA` first"});const PACKET_TYPES=Object.create(null);PACKET_TYPES.open="0";PACKET_TYPES.close="1";PACKET_TYPES.ping="2";PACKET_TYPES.pong="3";PACKET_TYPES.message="4";PACKET_TYPES.upgrade="5";PACKET_TYPES.noop="6";const PACKET_TYPES_REVERSE=Object.create(null);Object.keys(PACKET_TYPES).forEach(g=>{PACKET_TYPES_REVERSE[PACKET_TYPES[g]]=g});const ERROR_PACKET={type:"error",data:"parser error"},withNativeBlob$1=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",withNativeArrayBuffer$2=typeof ArrayBuffer=="function",isView$1=g=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(g):g&&g.buffer instanceof ArrayBuffer,encodePacket=({type:g,data:u},h,y)=>withNativeBlob$1&&u instanceof Blob?h?y(u):encodeBlobAsBase64(u,y):withNativeArrayBuffer$2&&(u instanceof ArrayBuffer||isView$1(u))?h?y(u):encodeBlobAsBase64(new Blob([u]),y):y(PACKET_TYPES[g]+(u||"")),encodeBlobAsBase64=(g,u)=>{const h=new FileReader;return h.onload=function(){const y=h.result.split(",")[1];u("b"+(y||""))},h.readAsDataURL(g)};function toArray(g){return g instanceof Uint8Array?g:g instanceof ArrayBuffer?new Uint8Array(g):new Uint8Array(g.buffer,g.byteOffset,g.byteLength)}let TEXT_ENCODER;function encodePacketToBinary(g,u){if(withNativeBlob$1&&g.data instanceof Blob)return g.data.arrayBuffer().then(toArray).then(u);if(withNativeArrayBuffer$2&&(g.data instanceof ArrayBuffer||isView$1(g.data)))return u(toArray(g.data));encodePacket(g,!1,h=>{TEXT_ENCODER||(TEXT_ENCODER=new TextEncoder),u(TEXT_ENCODER.encode(h))})}const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup$1=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let g=0;g<chars.length;g++)lookup$1[chars.charCodeAt(g)]=g;const decode$1=g=>{let u=g.length*.75,h=g.length,y,v=0,b,w,E,_;g[g.length-1]==="="&&(u--,g[g.length-2]==="="&&u--);const S=new ArrayBuffer(u),A=new Uint8Array(S);for(y=0;y<h;y+=4)b=lookup$1[g.charCodeAt(y)],w=lookup$1[g.charCodeAt(y+1)],E=lookup$1[g.charCodeAt(y+2)],_=lookup$1[g.charCodeAt(y+3)],A[v++]=b<<2|w>>4,A[v++]=(w&15)<<4|E>>2,A[v++]=(E&3)<<6|_&63;return S},withNativeArrayBuffer$1=typeof ArrayBuffer=="function",decodePacket=(g,u)=>{if(typeof g!="string")return{type:"message",data:mapBinary(g,u)};const h=g.charAt(0);return h==="b"?{type:"message",data:decodeBase64Packet(g.substring(1),u)}:PACKET_TYPES_REVERSE[h]?g.length>1?{type:PACKET_TYPES_REVERSE[h],data:g.substring(1)}:{type:PACKET_TYPES_REVERSE[h]}:ERROR_PACKET},decodeBase64Packet=(g,u)=>{if(withNativeArrayBuffer$1){const h=decode$1(g);return mapBinary(h,u)}else return{base64:!0,data:g}},mapBinary=(g,u)=>{switch(u){case"blob":return g instanceof Blob?g:new Blob([g]);case"arraybuffer":default:return g instanceof ArrayBuffer?g:g.buffer}},SEPARATOR="",encodePayload=(g,u)=>{const h=g.length,y=new Array(h);let v=0;g.forEach((b,w)=>{encodePacket(b,!1,E=>{y[w]=E,++v===h&&u(y.join(SEPARATOR))})})},decodePayload=(g,u)=>{const h=g.split(SEPARATOR),y=[];for(let v=0;v<h.length;v++){const b=decodePacket(h[v],u);if(y.push(b),b.type==="error")break}return y};function createPacketEncoderStream(){return new TransformStream({transform(g,u){encodePacketToBinary(g,h=>{const y=h.length;let v;if(y<126)v=new Uint8Array(1),new DataView(v.buffer).setUint8(0,y);else if(y<65536){v=new Uint8Array(3);const b=new DataView(v.buffer);b.setUint8(0,126),b.setUint16(1,y)}else{v=new Uint8Array(9);const b=new DataView(v.buffer);b.setUint8(0,127),b.setBigUint64(1,BigInt(y))}g.data&&typeof g.data!="string"&&(v[0]|=128),u.enqueue(v),u.enqueue(h)})}})}let TEXT_DECODER;function totalLength(g){return g.reduce((u,h)=>u+h.length,0)}function concatChunks(g,u){if(g[0].length===u)return g.shift();const h=new Uint8Array(u);let y=0;for(let v=0;v<u;v++)h[v]=g[0][y++],y===g[0].length&&(g.shift(),y=0);return g.length&&y<g[0].length&&(g[0]=g[0].slice(y)),h}function createPacketDecoderStream(g,u){TEXT_DECODER||(TEXT_DECODER=new TextDecoder);const h=[];let y=0,v=-1,b=!1;return new TransformStream({transform(w,E){for(h.push(w);;){if(y===0){if(totalLength(h)<1)break;const _=concatChunks(h,1);b=(_[0]&128)===128,v=_[0]&127,v<126?y=3:v===126?y=1:y=2}else if(y===1){if(totalLength(h)<2)break;const _=concatChunks(h,2);v=new DataView(_.buffer,_.byteOffset,_.length).getUint16(0),y=3}else if(y===2){if(totalLength(h)<8)break;const _=concatChunks(h,8),S=new DataView(_.buffer,_.byteOffset,_.length),A=S.getUint32(0);if(A>Math.pow(2,21)-1){E.enqueue(ERROR_PACKET);break}v=A*Math.pow(2,32)+S.getUint32(4),y=3}else{if(totalLength(h)<v)break;const _=concatChunks(h,v);E.enqueue(decodePacket(b?_:TEXT_DECODER.decode(_),u)),y=0}if(v===0||v>g){E.enqueue(ERROR_PACKET);break}}}})}const protocol$1=4;function Emitter(g){if(g)return mixin(g)}function mixin(g){for(var u in Emitter.prototype)g[u]=Emitter.prototype[u];return g}Emitter.prototype.on=Emitter.prototype.addEventListener=function(g,u){return this._callbacks=this._callbacks||{},(this._callbacks["$"+g]=this._callbacks["$"+g]||[]).push(u),this};Emitter.prototype.once=function(g,u){function h(){this.off(g,h),u.apply(this,arguments)}return h.fn=u,this.on(g,h),this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(g,u){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var h=this._callbacks["$"+g];if(!h)return this;if(arguments.length==1)return delete this._callbacks["$"+g],this;for(var y,v=0;v<h.length;v++)if(y=h[v],y===u||y.fn===u){h.splice(v,1);break}return h.length===0&&delete this._callbacks["$"+g],this};Emitter.prototype.emit=function(g){this._callbacks=this._callbacks||{};for(var u=new Array(arguments.length-1),h=this._callbacks["$"+g],y=1;y<arguments.length;y++)u[y-1]=arguments[y];if(h){h=h.slice(0);for(var y=0,v=h.length;y<v;++y)h[y].apply(this,u)}return this};Emitter.prototype.emitReserved=Emitter.prototype.emit;Emitter.prototype.listeners=function(g){return this._callbacks=this._callbacks||{},this._callbacks["$"+g]||[]};Emitter.prototype.hasListeners=function(g){return!!this.listeners(g).length};const nextTick=typeof Promise=="function"&&typeof Promise.resolve=="function"?u=>Promise.resolve().then(u):(u,h)=>h(u,0),globalThisShim=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),defaultBinaryType="arraybuffer";function createCookieJar(){}function pick(g,...u){return u.reduce((h,y)=>(g.hasOwnProperty(y)&&(h[y]=g[y]),h),{})}const NATIVE_SET_TIMEOUT=globalThisShim.setTimeout,NATIVE_CLEAR_TIMEOUT=globalThisShim.clearTimeout;function installTimerFunctions(g,u){u.useNativeTimers?(g.setTimeoutFn=NATIVE_SET_TIMEOUT.bind(globalThisShim),g.clearTimeoutFn=NATIVE_CLEAR_TIMEOUT.bind(globalThisShim)):(g.setTimeoutFn=globalThisShim.setTimeout.bind(globalThisShim),g.clearTimeoutFn=globalThisShim.clearTimeout.bind(globalThisShim))}const BASE64_OVERHEAD=1.33;function byteLength(g){return typeof g=="string"?utf8Length(g):Math.ceil((g.byteLength||g.size)*BASE64_OVERHEAD)}function utf8Length(g){let u=0,h=0;for(let y=0,v=g.length;y<v;y++)u=g.charCodeAt(y),u<128?h+=1:u<2048?h+=2:u<55296||u>=57344?h+=3:(y++,h+=4);return h}function randomString(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function encode(g){let u="";for(let h in g)g.hasOwnProperty(h)&&(u.length&&(u+="&"),u+=encodeURIComponent(h)+"="+encodeURIComponent(g[h]));return u}function decode(g){let u={},h=g.split("&");for(let y=0,v=h.length;y<v;y++){let b=h[y].split("=");u[decodeURIComponent(b[0])]=decodeURIComponent(b[1])}return u}class TransportError extends Error{constructor(u,h,y){super(u),this.description=h,this.context=y,this.type="TransportError"}}class Transport extends Emitter{constructor(u){super(),this.writable=!1,installTimerFunctions(this,u),this.opts=u,this.query=u.query,this.socket=u.socket,this.supportsBinary=!u.forceBase64}onError(u,h,y){return super.emitReserved("error",new TransportError(u,h,y)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(u){this.readyState==="open"&&this.write(u)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(u){const h=decodePacket(u,this.socket.binaryType);this.onPacket(h)}onPacket(u){super.emitReserved("packet",u)}onClose(u){this.readyState="closed",super.emitReserved("close",u)}pause(u){}createUri(u,h={}){return u+"://"+this._hostname()+this._port()+this.opts.path+this._query(h)}_hostname(){const u=this.opts.hostname;return u.indexOf(":")===-1?u:"["+u+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(u){const h=encode(u);return h.length?"?"+h:""}}class Polling extends Transport{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(u){this.readyState="pausing";const h=()=>{this.readyState="paused",u()};if(this._polling||!this.writable){let y=0;this._polling&&(y++,this.once("pollComplete",function(){--y||h()})),this.writable||(y++,this.once("drain",function(){--y||h()}))}else h()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(u){const h=y=>{if(this.readyState==="opening"&&y.type==="open"&&this.onOpen(),y.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(y)};decodePayload(u,this.socket.binaryType).forEach(h),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const u=()=>{this.write([{type:"close"}])};this.readyState==="open"?u():this.once("open",u)}write(u){this.writable=!1,encodePayload(u,h=>{this.doWrite(h,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const u=this.opts.secure?"https":"http",h=this.query||{};return this.opts.timestampRequests!==!1&&(h[this.opts.timestampParam]=randomString()),!this.supportsBinary&&!h.sid&&(h.b64=1),this.createUri(u,h)}}let value=!1;try{value=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch(g){}const hasCORS=value;function empty(){}class BaseXHR extends Polling{constructor(u){if(super(u),typeof location<"u"){const h=location.protocol==="https:";let y=location.port;y||(y=h?"443":"80"),this.xd=typeof location<"u"&&u.hostname!==location.hostname||y!==u.port}}doWrite(u,h){const y=this.request({method:"POST",data:u});y.on("success",h),y.on("error",(v,b)=>{this.onError("xhr post error",v,b)})}doPoll(){const u=this.request();u.on("data",this.onData.bind(this)),u.on("error",(h,y)=>{this.onError("xhr poll error",h,y)}),this.pollXhr=u}}class Request extends Emitter{constructor(u,h,y){super(),this.createRequest=u,installTimerFunctions(this,y),this._opts=y,this._method=y.method||"GET",this._uri=h,this._data=y.data!==void 0?y.data:null,this._create()}_create(){var u;const h=pick(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");h.xdomain=!!this._opts.xd;const y=this._xhr=this.createRequest(h);try{y.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){y.setDisableHeaderCheck&&y.setDisableHeaderCheck(!0);for(let v in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(v)&&y.setRequestHeader(v,this._opts.extraHeaders[v])}}catch{}if(this._method==="POST")try{y.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{y.setRequestHeader("Accept","*/*")}catch{}(u=this._opts.cookieJar)===null||u===void 0||u.addCookies(y),"withCredentials"in y&&(y.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(y.timeout=this._opts.requestTimeout),y.onreadystatechange=()=>{var v;y.readyState===3&&((v=this._opts.cookieJar)===null||v===void 0||v.parseCookies(y.getResponseHeader("set-cookie"))),y.readyState===4&&(y.status===200||y.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof y.status=="number"?y.status:0)},0))},y.send(this._data)}catch(v){this.setTimeoutFn(()=>{this._onError(v)},0);return}typeof document<"u"&&(this._index=Request.requestsCount++,Request.requests[this._index]=this)}_onError(u){this.emitReserved("error",u,this._xhr),this._cleanup(!0)}_cleanup(u){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=empty,u)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Request.requests[this._index],this._xhr=null}}_onLoad(){const u=this._xhr.responseText;u!==null&&(this.emitReserved("data",u),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}Request.requestsCount=0;Request.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",unloadHandler);else if(typeof addEventListener=="function"){const g="onpagehide"in globalThisShim?"pagehide":"unload";addEventListener(g,unloadHandler,!1)}}function unloadHandler(){for(let g in Request.requests)Request.requests.hasOwnProperty(g)&&Request.requests[g].abort()}const hasXHR2=(function(){const g=newRequest({xdomain:!1});return g&&g.responseType!==null})();class XHR extends BaseXHR{constructor(u){super(u);const h=u&&u.forceBase64;this.supportsBinary=hasXHR2&&!h}request(u={}){return Object.assign(u,{xd:this.xd},this.opts),new Request(newRequest,this.uri(),u)}}function newRequest(g){const u=g.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!u||hasCORS))return new XMLHttpRequest}catch{}if(!u)try{return new globalThisShim[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const isReactNative=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class BaseWS extends Transport{get name(){return"websocket"}doOpen(){const u=this.uri(),h=this.opts.protocols,y=isReactNative?{}:pick(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(y.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(u,h,y)}catch(v){return this.emitReserved("error",v)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=u=>this.onClose({description:"websocket connection closed",context:u}),this.ws.onmessage=u=>this.onData(u.data),this.ws.onerror=u=>this.onError("websocket error",u)}write(u){this.writable=!1;for(let h=0;h<u.length;h++){const y=u[h],v=h===u.length-1;encodePacket(y,this.supportsBinary,b=>{try{this.doWrite(y,b)}catch{}v&&nextTick(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const u=this.opts.secure?"wss":"ws",h=this.query||{};return this.opts.timestampRequests&&(h[this.opts.timestampParam]=randomString()),this.supportsBinary||(h.b64=1),this.createUri(u,h)}}const WebSocketCtor=globalThisShim.WebSocket||globalThisShim.MozWebSocket;class WS extends BaseWS{createSocket(u,h,y){return isReactNative?new WebSocketCtor(u,h,y):h?new WebSocketCtor(u,h):new WebSocketCtor(u)}doWrite(u,h){this.ws.send(h)}}class WT extends Transport{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(u){return this.emitReserved("error",u)}this._transport.closed.then(()=>{this.onClose()}).catch(u=>{this.onError("webtransport error",u)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(u=>{const h=createPacketDecoderStream(Number.MAX_SAFE_INTEGER,this.socket.binaryType),y=u.readable.pipeThrough(h).getReader(),v=createPacketEncoderStream();v.readable.pipeTo(u.writable),this._writer=v.writable.getWriter();const b=()=>{y.read().then(({done:E,value:_})=>{E||(this.onPacket(_),b())}).catch(E=>{})};b();const w={type:"open"};this.query.sid&&(w.data=`{"sid":"${this.query.sid}"}`),this._writer.write(w).then(()=>this.onOpen())})})}write(u){this.writable=!1;for(let h=0;h<u.length;h++){const y=u[h],v=h===u.length-1;this._writer.write(y).then(()=>{v&&nextTick(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var u;(u=this._transport)===null||u===void 0||u.close()}}const transports={websocket:WS,webtransport:WT,polling:XHR},re=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function parse(g){if(g.length>8e3)throw"URI too long";const u=g,h=g.indexOf("["),y=g.indexOf("]");h!=-1&&y!=-1&&(g=g.substring(0,h)+g.substring(h,y).replace(/:/g,";")+g.substring(y,g.length));let v=re.exec(g||""),b={},w=14;for(;w--;)b[parts[w]]=v[w]||"";return h!=-1&&y!=-1&&(b.source=u,b.host=b.host.substring(1,b.host.length-1).replace(/;/g,":"),b.authority=b.authority.replace("[","").replace("]","").replace(/;/g,":"),b.ipv6uri=!0),b.pathNames=pathNames(b,b.path),b.queryKey=queryKey(b,b.query),b}function pathNames(g,u){const h=/\/{2,9}/g,y=u.replace(h,"/").split("/");return(u.slice(0,1)=="/"||u.length===0)&&y.splice(0,1),u.slice(-1)=="/"&&y.splice(y.length-1,1),y}function queryKey(g,u){const h={};return u.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(y,v,b){v&&(h[v]=b)}),h}const withEventListeners=typeof addEventListener=="function"&&typeof removeEventListener=="function",OFFLINE_EVENT_LISTENERS=[];withEventListeners&&addEventListener("offline",()=>{OFFLINE_EVENT_LISTENERS.forEach(g=>g())},!1);class SocketWithoutUpgrade extends Emitter{constructor(u,h){if(super(),this.binaryType=defaultBinaryType,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,u&&typeof u=="object"&&(h=u,u=null),u){const y=parse(u);h.hostname=y.host,h.secure=y.protocol==="https"||y.protocol==="wss",h.port=y.port,y.query&&(h.query=y.query)}else h.host&&(h.hostname=parse(h.host).host);installTimerFunctions(this,h),this.secure=h.secure!=null?h.secure:typeof location<"u"&&location.protocol==="https:",h.hostname&&!h.port&&(h.port=this.secure?"443":"80"),this.hostname=h.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=h.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},h.transports.forEach(y=>{const v=y.prototype.name;this.transports.push(v),this._transportsByName[v]=y}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},h),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=decode(this.opts.query)),withEventListeners&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},OFFLINE_EVENT_LISTENERS.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(u){const h=Object.assign({},this.opts.query);h.EIO=protocol$1,h.transport=u,this.id&&(h.sid=this.id);const y=Object.assign({},this.opts,{query:h,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[u]);return new this._transportsByName[u](y)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const u=this.opts.rememberUpgrade&&SocketWithoutUpgrade.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const h=this.createTransport(u);h.open(),this.setTransport(h)}setTransport(u){this.transport&&this.transport.removeAllListeners(),this.transport=u,u.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",h=>this._onClose("transport close",h))}onOpen(){this.readyState="open",SocketWithoutUpgrade.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(u){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",u),this.emitReserved("heartbeat"),u.type){case"open":this.onHandshake(JSON.parse(u.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const h=new Error("server error");h.code=u.data,this._onError(h);break;case"message":this.emitReserved("data",u.data),this.emitReserved("message",u.data);break}}onHandshake(u){this.emitReserved("handshake",u),this.id=u.sid,this.transport.query.sid=u.sid,this._pingInterval=u.pingInterval,this._pingTimeout=u.pingTimeout,this._maxPayload=u.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const u=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+u,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},u),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const u=this._getWritablePackets();this.transport.send(u),this._prevBufferLen=u.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let h=1;for(let y=0;y<this.writeBuffer.length;y++){const v=this.writeBuffer[y].data;if(v&&(h+=byteLength(v)),y>0&&h>this._maxPayload)return this.writeBuffer.slice(0,y);h+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const u=Date.now()>this._pingTimeoutTime;return u&&(this._pingTimeoutTime=0,nextTick(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),u}write(u,h,y){return this._sendPacket("message",u,h,y),this}send(u,h,y){return this._sendPacket("message",u,h,y),this}_sendPacket(u,h,y,v){if(typeof h=="function"&&(v=h,h=void 0),typeof y=="function"&&(v=y,y=null),this.readyState==="closing"||this.readyState==="closed")return;y=y||{},y.compress=y.compress!==!1;const b={type:u,data:h,options:y};this.emitReserved("packetCreate",b),this.writeBuffer.push(b),v&&this.once("flush",v),this.flush()}close(){const u=()=>{this._onClose("forced close"),this.transport.close()},h=()=>{this.off("upgrade",h),this.off("upgradeError",h),u()},y=()=>{this.once("upgrade",h),this.once("upgradeError",h)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?y():u()}):this.upgrading?y():u()),this}_onError(u){if(SocketWithoutUpgrade.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",u),this._onClose("transport error",u)}_onClose(u,h){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),withEventListeners&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const y=OFFLINE_EVENT_LISTENERS.indexOf(this._offlineEventListener);y!==-1&&OFFLINE_EVENT_LISTENERS.splice(y,1)}this.readyState="closed",this.id=null,this.emitReserved("close",u,h),this.writeBuffer=[],this._prevBufferLen=0}}}SocketWithoutUpgrade.protocol=protocol$1;class SocketWithUpgrade extends SocketWithoutUpgrade{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let u=0;u<this._upgrades.length;u++)this._probe(this._upgrades[u])}_probe(u){let h=this.createTransport(u),y=!1;SocketWithoutUpgrade.priorWebsocketSuccess=!1;const v=()=>{y||(h.send([{type:"ping",data:"probe"}]),h.once("packet",R=>{if(!y)if(R.type==="pong"&&R.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",h),!h)return;SocketWithoutUpgrade.priorWebsocketSuccess=h.name==="websocket",this.transport.pause(()=>{y||this.readyState!=="closed"&&(A(),this.setTransport(h),h.send([{type:"upgrade"}]),this.emitReserved("upgrade",h),h=null,this.upgrading=!1,this.flush())})}else{const x=new Error("probe error");x.transport=h.name,this.emitReserved("upgradeError",x)}}))};function b(){y||(y=!0,A(),h.close(),h=null)}const w=R=>{const x=new Error("probe error: "+R);x.transport=h.name,b(),this.emitReserved("upgradeError",x)};function E(){w("transport closed")}function _(){w("socket closed")}function S(R){h&&R.name!==h.name&&b()}const A=()=>{h.removeListener("open",v),h.removeListener("error",w),h.removeListener("close",E),this.off("close",_),this.off("upgrading",S)};h.once("open",v),h.once("error",w),h.once("close",E),this.once("close",_),this.once("upgrading",S),this._upgrades.indexOf("webtransport")!==-1&&u!=="webtransport"?this.setTimeoutFn(()=>{y||h.open()},200):h.open()}onHandshake(u){this._upgrades=this._filterUpgrades(u.upgrades),super.onHandshake(u)}_filterUpgrades(u){const h=[];for(let y=0;y<u.length;y++)~this.transports.indexOf(u[y])&&h.push(u[y]);return h}}let Socket$1=class extends SocketWithUpgrade{constructor(u,h={}){const y=typeof u=="object"?u:h;(!y.transports||y.transports&&typeof y.transports[0]=="string")&&(y.transports=(y.transports||["polling","websocket","webtransport"]).map(v=>transports[v]).filter(v=>!!v)),super(u,y)}};function url(g,u="",h){let y=g;h=h||typeof location<"u"&&location,g==null&&(g=h.protocol+"//"+h.host),typeof g=="string"&&(g.charAt(0)==="/"&&(g.charAt(1)==="/"?g=h.protocol+g:g=h.host+g),/^(https?|wss?):\/\//.test(g)||(typeof h<"u"?g=h.protocol+"//"+g:g="https://"+g),y=parse(g)),y.port||(/^(http|ws)$/.test(y.protocol)?y.port="80":/^(http|ws)s$/.test(y.protocol)&&(y.port="443")),y.path=y.path||"/";const b=y.host.indexOf(":")!==-1?"["+y.host+"]":y.host;return y.id=y.protocol+"://"+b+":"+y.port+u,y.href=y.protocol+"://"+b+(h&&h.port===y.port?"":":"+y.port),y}const withNativeArrayBuffer=typeof ArrayBuffer=="function",isView=g=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(g):g.buffer instanceof ArrayBuffer,toString=Object.prototype.toString,withNativeBlob=typeof Blob=="function"||typeof Blob<"u"&&toString.call(Blob)==="[object BlobConstructor]",withNativeFile=typeof File=="function"||typeof File<"u"&&toString.call(File)==="[object FileConstructor]";function isBinary(g){return withNativeArrayBuffer&&(g instanceof ArrayBuffer||isView(g))||withNativeBlob&&g instanceof Blob||withNativeFile&&g instanceof File}function hasBinary(g,u){if(!g||typeof g!="object")return!1;if(Array.isArray(g)){for(let h=0,y=g.length;h<y;h++)if(hasBinary(g[h]))return!0;return!1}if(isBinary(g))return!0;if(g.toJSON&&typeof g.toJSON=="function"&&arguments.length===1)return hasBinary(g.toJSON(),!0);for(const h in g)if(Object.prototype.hasOwnProperty.call(g,h)&&hasBinary(g[h]))return!0;return!1}function deconstructPacket(g){const u=[],h=g.data,y=g;return y.data=_deconstructPacket(h,u),y.attachments=u.length,{packet:y,buffers:u}}function _deconstructPacket(g,u){if(!g)return g;if(isBinary(g)){const h={_placeholder:!0,num:u.length};return u.push(g),h}else if(Array.isArray(g)){const h=new Array(g.length);for(let y=0;y<g.length;y++)h[y]=_deconstructPacket(g[y],u);return h}else if(typeof g=="object"&&!(g instanceof Date)){const h={};for(const y in g)Object.prototype.hasOwnProperty.call(g,y)&&(h[y]=_deconstructPacket(g[y],u));return h}return g}function reconstructPacket(g,u){return g.data=_reconstructPacket(g.data,u),delete g.attachments,g}function _reconstructPacket(g,u){if(!g)return g;if(g&&g._placeholder===!0){if(typeof g.num=="number"&&g.num>=0&&g.num<u.length)return u[g.num];throw new Error("illegal attachments")}else if(Array.isArray(g))for(let h=0;h<g.length;h++)g[h]=_reconstructPacket(g[h],u);else if(typeof g=="object")for(const h in g)Object.prototype.hasOwnProperty.call(g,h)&&(g[h]=_reconstructPacket(g[h],u));return g}const RESERVED_EVENTS$1=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],protocol=5;var PacketType;(function(g){g[g.CONNECT=0]="CONNECT",g[g.DISCONNECT=1]="DISCONNECT",g[g.EVENT=2]="EVENT",g[g.ACK=3]="ACK",g[g.CONNECT_ERROR=4]="CONNECT_ERROR",g[g.BINARY_EVENT=5]="BINARY_EVENT",g[g.BINARY_ACK=6]="BINARY_ACK"})(PacketType||(PacketType={}));class Encoder{constructor(u){this.replacer=u}encode(u){return(u.type===PacketType.EVENT||u.type===PacketType.ACK)&&hasBinary(u)?this.encodeAsBinary({type:u.type===PacketType.EVENT?PacketType.BINARY_EVENT:PacketType.BINARY_ACK,nsp:u.nsp,data:u.data,id:u.id}):[this.encodeAsString(u)]}encodeAsString(u){let h=""+u.type;return(u.type===PacketType.BINARY_EVENT||u.type===PacketType.BINARY_ACK)&&(h+=u.attachments+"-"),u.nsp&&u.nsp!=="/"&&(h+=u.nsp+","),u.id!=null&&(h+=u.id),u.data!=null&&(h+=JSON.stringify(u.data,this.replacer)),h}encodeAsBinary(u){const h=deconstructPacket(u),y=this.encodeAsString(h.packet),v=h.buffers;return v.unshift(y),v}}function isObject$1(g){return Object.prototype.toString.call(g)==="[object Object]"}class Decoder extends Emitter{constructor(u){super(),this.reviver=u}add(u){let h;if(typeof u=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");h=this.decodeString(u);const y=h.type===PacketType.BINARY_EVENT;y||h.type===PacketType.BINARY_ACK?(h.type=y?PacketType.EVENT:PacketType.ACK,this.reconstructor=new BinaryReconstructor(h),h.attachments===0&&super.emitReserved("decoded",h)):super.emitReserved("decoded",h)}else if(isBinary(u)||u.base64)if(this.reconstructor)h=this.reconstructor.takeBinaryData(u),h&&(this.reconstructor=null,super.emitReserved("decoded",h));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+u)}decodeString(u){let h=0;const y={type:Number(u.charAt(0))};if(PacketType[y.type]===void 0)throw new Error("unknown packet type "+y.type);if(y.type===PacketType.BINARY_EVENT||y.type===PacketType.BINARY_ACK){const b=h+1;for(;u.charAt(++h)!=="-"&&h!=u.length;);const w=u.substring(b,h);if(w!=Number(w)||u.charAt(h)!=="-")throw new Error("Illegal attachments");y.attachments=Number(w)}if(u.charAt(h+1)==="/"){const b=h+1;for(;++h&&!(u.charAt(h)===","||h===u.length););y.nsp=u.substring(b,h)}else y.nsp="/";const v=u.charAt(h+1);if(v!==""&&Number(v)==v){const b=h+1;for(;++h;){const w=u.charAt(h);if(w==null||Number(w)!=w){--h;break}if(h===u.length)break}y.id=Number(u.substring(b,h+1))}if(u.charAt(++h)){const b=this.tryParse(u.substr(h));if(Decoder.isPayloadValid(y.type,b))y.data=b;else throw new Error("invalid payload")}return y}tryParse(u){try{return JSON.parse(u,this.reviver)}catch{return!1}}static isPayloadValid(u,h){switch(u){case PacketType.CONNECT:return isObject$1(h);case PacketType.DISCONNECT:return h===void 0;case PacketType.CONNECT_ERROR:return typeof h=="string"||isObject$1(h);case PacketType.EVENT:case PacketType.BINARY_EVENT:return Array.isArray(h)&&(typeof h[0]=="number"||typeof h[0]=="string"&&RESERVED_EVENTS$1.indexOf(h[0])===-1);case PacketType.ACK:case PacketType.BINARY_ACK:return Array.isArray(h)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class BinaryReconstructor{constructor(u){this.packet=u,this.buffers=[],this.reconPack=u}takeBinaryData(u){if(this.buffers.push(u),this.buffers.length===this.reconPack.attachments){const h=reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),h}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const parser=Object.freeze(Object.defineProperty({__proto__:null,Decoder,Encoder,get PacketType(){return PacketType},protocol},Symbol.toStringTag,{value:"Module"}));function on(g,u,h){return g.on(u,h),function(){g.off(u,h)}}const RESERVED_EVENTS=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Socket extends Emitter{constructor(u,h,y){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=u,this.nsp=h,y&&y.auth&&(this.auth=y.auth),this._opts=Object.assign({},y),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const u=this.io;this.subs=[on(u,"open",this.onopen.bind(this)),on(u,"packet",this.onpacket.bind(this)),on(u,"error",this.onerror.bind(this)),on(u,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...u){return u.unshift("message"),this.emit.apply(this,u),this}emit(u,...h){var y,v,b;if(RESERVED_EVENTS.hasOwnProperty(u))throw new Error('"'+u.toString()+'" is a reserved event name');if(h.unshift(u),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(h),this;const w={type:PacketType.EVENT,data:h};if(w.options={},w.options.compress=this.flags.compress!==!1,typeof h[h.length-1]=="function"){const A=this.ids++,R=h.pop();this._registerAckCallback(A,R),w.id=A}const E=(v=(y=this.io.engine)===null||y===void 0?void 0:y.transport)===null||v===void 0?void 0:v.writable,_=this.connected&&!(!((b=this.io.engine)===null||b===void 0)&&b._hasPingExpired());return this.flags.volatile&&!E||(_?(this.notifyOutgoingListeners(w),this.packet(w)):this.sendBuffer.push(w)),this.flags={},this}_registerAckCallback(u,h){var y;const v=(y=this.flags.timeout)!==null&&y!==void 0?y:this._opts.ackTimeout;if(v===void 0){this.acks[u]=h;return}const b=this.io.setTimeoutFn(()=>{delete this.acks[u];for(let E=0;E<this.sendBuffer.length;E++)this.sendBuffer[E].id===u&&this.sendBuffer.splice(E,1);h.call(this,new Error("operation has timed out"))},v),w=(...E)=>{this.io.clearTimeoutFn(b),h.apply(this,E)};w.withError=!0,this.acks[u]=w}emitWithAck(u,...h){return new Promise((y,v)=>{const b=(w,E)=>w?v(w):y(E);b.withError=!0,h.push(b),this.emit(u,...h)})}_addToQueue(u){let h;typeof u[u.length-1]=="function"&&(h=u.pop());const y={id:this._queueSeq++,tryCount:0,pending:!1,args:u,flags:Object.assign({fromQueue:!0},this.flags)};u.push((v,...b)=>y!==this._queue[0]?void 0:(v!==null?y.tryCount>this._opts.retries&&(this._queue.shift(),h&&h(v)):(this._queue.shift(),h&&h(null,...b)),y.pending=!1,this._drainQueue())),this._queue.push(y),this._drainQueue()}_drainQueue(u=!1){if(!this.connected||this._queue.length===0)return;const h=this._queue[0];h.pending&&!u||(h.pending=!0,h.tryCount++,this.flags=h.flags,this.emit.apply(this,h.args))}packet(u){u.nsp=this.nsp,this.io._packet(u)}onopen(){typeof this.auth=="function"?this.auth(u=>{this._sendConnectPacket(u)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(u){this.packet({type:PacketType.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},u):u})}onerror(u){this.connected||this.emitReserved("connect_error",u)}onclose(u,h){this.connected=!1,delete this.id,this.emitReserved("disconnect",u,h),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(u=>{if(!this.sendBuffer.some(y=>String(y.id)===u)){const y=this.acks[u];delete this.acks[u],y.withError&&y.call(this,new Error("socket has been disconnected"))}})}onpacket(u){if(u.nsp===this.nsp)switch(u.type){case PacketType.CONNECT:u.data&&u.data.sid?this.onconnect(u.data.sid,u.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case PacketType.EVENT:case PacketType.BINARY_EVENT:this.onevent(u);break;case PacketType.ACK:case PacketType.BINARY_ACK:this.onack(u);break;case PacketType.DISCONNECT:this.ondisconnect();break;case PacketType.CONNECT_ERROR:this.destroy();const y=new Error(u.data.message);y.data=u.data.data,this.emitReserved("connect_error",y);break}}onevent(u){const h=u.data||[];u.id!=null&&h.push(this.ack(u.id)),this.connected?this.emitEvent(h):this.receiveBuffer.push(Object.freeze(h))}emitEvent(u){if(this._anyListeners&&this._anyListeners.length){const h=this._anyListeners.slice();for(const y of h)y.apply(this,u)}super.emit.apply(this,u),this._pid&&u.length&&typeof u[u.length-1]=="string"&&(this._lastOffset=u[u.length-1])}ack(u){const h=this;let y=!1;return function(...v){y||(y=!0,h.packet({type:PacketType.ACK,id:u,data:v}))}}onack(u){const h=this.acks[u.id];typeof h=="function"&&(delete this.acks[u.id],h.withError&&u.data.unshift(null),h.apply(this,u.data))}onconnect(u,h){this.id=u,this.recovered=h&&this._pid===h,this._pid=h,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(u=>this.emitEvent(u)),this.receiveBuffer=[],this.sendBuffer.forEach(u=>{this.notifyOutgoingListeners(u),this.packet(u)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(u=>u()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:PacketType.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(u){return this.flags.compress=u,this}get volatile(){return this.flags.volatile=!0,this}timeout(u){return this.flags.timeout=u,this}onAny(u){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(u),this}prependAny(u){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(u),this}offAny(u){if(!this._anyListeners)return this;if(u){const h=this._anyListeners;for(let y=0;y<h.length;y++)if(u===h[y])return h.splice(y,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(u){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(u),this}prependAnyOutgoing(u){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(u),this}offAnyOutgoing(u){if(!this._anyOutgoingListeners)return this;if(u){const h=this._anyOutgoingListeners;for(let y=0;y<h.length;y++)if(u===h[y])return h.splice(y,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(u){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const h=this._anyOutgoingListeners.slice();for(const y of h)y.apply(this,u.data)}}}function Backoff(g){g=g||{},this.ms=g.min||100,this.max=g.max||1e4,this.factor=g.factor||2,this.jitter=g.jitter>0&&g.jitter<=1?g.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var g=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var u=Math.random(),h=Math.floor(u*this.jitter*g);g=(Math.floor(u*10)&1)==0?g-h:g+h}return Math.min(g,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(g){this.ms=g};Backoff.prototype.setMax=function(g){this.max=g};Backoff.prototype.setJitter=function(g){this.jitter=g};class Manager extends Emitter{constructor(u,h){var y;super(),this.nsps={},this.subs=[],u&&typeof u=="object"&&(h=u,u=void 0),h=h||{},h.path=h.path||"/socket.io",this.opts=h,installTimerFunctions(this,h),this.reconnection(h.reconnection!==!1),this.reconnectionAttempts(h.reconnectionAttempts||1/0),this.reconnectionDelay(h.reconnectionDelay||1e3),this.reconnectionDelayMax(h.reconnectionDelayMax||5e3),this.randomizationFactor((y=h.randomizationFactor)!==null&&y!==void 0?y:.5),this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(h.timeout==null?2e4:h.timeout),this._readyState="closed",this.uri=u;const v=h.parser||parser;this.encoder=new v.Encoder,this.decoder=new v.Decoder,this._autoConnect=h.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(u){return arguments.length?(this._reconnection=!!u,u||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(u){return u===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=u,this)}reconnectionDelay(u){var h;return u===void 0?this._reconnectionDelay:(this._reconnectionDelay=u,(h=this.backoff)===null||h===void 0||h.setMin(u),this)}randomizationFactor(u){var h;return u===void 0?this._randomizationFactor:(this._randomizationFactor=u,(h=this.backoff)===null||h===void 0||h.setJitter(u),this)}reconnectionDelayMax(u){var h;return u===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=u,(h=this.backoff)===null||h===void 0||h.setMax(u),this)}timeout(u){return arguments.length?(this._timeout=u,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(u){if(~this._readyState.indexOf("open"))return this;this.engine=new Socket$1(this.uri,this.opts);const h=this.engine,y=this;this._readyState="opening",this.skipReconnect=!1;const v=on(h,"open",function(){y.onopen(),u&&u()}),b=E=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",E),u?u(E):this.maybeReconnectOnOpen()},w=on(h,"error",b);if(this._timeout!==!1){const E=this._timeout,_=this.setTimeoutFn(()=>{v(),b(new Error("timeout")),h.close()},E);this.opts.autoUnref&&_.unref(),this.subs.push(()=>{this.clearTimeoutFn(_)})}return this.subs.push(v),this.subs.push(w),this}connect(u){return this.open(u)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const u=this.engine;this.subs.push(on(u,"ping",this.onping.bind(this)),on(u,"data",this.ondata.bind(this)),on(u,"error",this.onerror.bind(this)),on(u,"close",this.onclose.bind(this)),on(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(u){try{this.decoder.add(u)}catch(h){this.onclose("parse error",h)}}ondecoded(u){nextTick(()=>{this.emitReserved("packet",u)},this.setTimeoutFn)}onerror(u){this.emitReserved("error",u)}socket(u,h){let y=this.nsps[u];return y?this._autoConnect&&!y.active&&y.connect():(y=new Socket(this,u,h),this.nsps[u]=y),y}_destroy(u){const h=Object.keys(this.nsps);for(const y of h)if(this.nsps[y].active)return;this._close()}_packet(u){const h=this.encoder.encode(u);for(let y=0;y<h.length;y++)this.engine.write(h[y],u.options)}cleanup(){this.subs.forEach(u=>u()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(u,h){var y;this.cleanup(),(y=this.engine)===null||y===void 0||y.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",u,h),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const u=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const h=this.backoff.duration();this._reconnecting=!0;const y=this.setTimeoutFn(()=>{u.skipReconnect||(this.emitReserved("reconnect_attempt",u.backoff.attempts),!u.skipReconnect&&u.open(v=>{v?(u._reconnecting=!1,u.reconnect(),this.emitReserved("reconnect_error",v)):u.onreconnect()}))},h);this.opts.autoUnref&&y.unref(),this.subs.push(()=>{this.clearTimeoutFn(y)})}}onreconnect(){const u=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",u)}}const cache={};function lookup(g,u){typeof g=="object"&&(u=g,g=void 0),u=u||{};const h=url(g,u.path||"/socket.io"),y=h.source,v=h.id,b=h.path,w=cache[v]&&b in cache[v].nsps,E=u.forceNew||u["force new connection"]||u.multiplex===!1||w;let _;return E?_=new Manager(y,u):(cache[v]||(cache[v]=new Manager(y,u)),_=cache[v]),h.query&&!u.query&&(u.query=h.queryKey),_.socket(h.path,u)}Object.assign(lookup,{Manager,Socket,io:lookup,connect:lookup});var log$1=loglevel$2.getLogger("SecurePubSub");class SecurePubSub{constructor(u={}){_defineProperty(this,"options",void 0),_defineProperty(this,"SOCKET_CONN",null),this.options=u,this.options.timeout=u.timeout||600,this.options.serverUrl=u.serverUrl||SESSION_SERVER_API_URL,this.options.socketUrl=u.socketUrl||SESSION_SERVER_SOCKET_URL,this.options.enableLogging=u.enableLogging||!1,this.options.namespace=u.namespace||"",this.options.sameIpCheck=u.sameIpCheck||!1,this.options.sameOriginCheck=u.sameOriginCheck||!1,this.options.enableLogging?log$1.enableAll():log$1.disableAll()}static setLogLevel(u){log$1.setLevel(u),setLogLevel(u)}async publish(u,h){const y=keccak256(Buffer.from(u,"utf8")),v=await encryptData(y.toString("hex"),h),b=await sign(y,keccak256(Buffer.from(v,"utf8"))),w={key:getPublic(y).toString("hex"),data:v,signature:b.toString("hex"),timeout:this.options.timeout,namespace:this.options.namespace,sameIpCheck:this.options.sameIpCheck,sameOriginCheck:this.options.sameOriginCheck};return post(`${this.options.serverUrl}/channel/set`,w)}async subscribe(u){let h=!0;const y=keccak256(Buffer.from(u,"utf8")),v=getPublic(y).toString("hex"),b=this.getSocketConnection();b.connected?(log$1.debug("already connected with socket"),b.emit("check_auth_status",v,{namespace:this.options.namespace,sameIpCheck:this.options.sameIpCheck,sameOriginCheck:this.options.sameOriginCheck})):b.once("connect",()=>{log$1.debug("connected with socket"),b.emit("check_auth_status",v,{namespace:this.options.namespace,sameIpCheck:this.options.sameIpCheck,sameOriginCheck:this.options.sameOriginCheck})});const w=()=>{b.once("connect",async()=>{log$1.debug("connected with socket using reconnect"),h&&b.emit("check_auth_status",v,{namespace:this.options.namespace,sameIpCheck:this.options.sameIpCheck,sameOriginCheck:this.options.sameOriginCheck})})},E=()=>{h||document.removeEventListener("visibilitychange",E),!b.connected&&document.visibilityState==="visible"&&w()},_=()=>{log$1.debug("socket disconnected",h),h?(log$1.error("socket disconnected unexpectedly, reconnecting socket"),w()):b.removeListener("disconnect",_)};b.on("disconnect",_);const S=new Promise((A,R)=>{const x=async T=>{try{const C=await decryptData(y.toString("hex"),T);log$1.info("got data",C),A(C)}catch(C){log$1.error(C),R(C)}finally{h=!1,document.removeEventListener("visibilitychange",E)}};log$1.info("listening to",`${v}_success`),b.once(`${v}_success`,x)});return typeof document<"u"&&document.addEventListener("visibilitychange",E),S}cleanup(){this.SOCKET_CONN&&(this.SOCKET_CONN.disconnect(),this.SOCKET_CONN=null)}getSocketConnection(){if(this.SOCKET_CONN)return this.SOCKET_CONN;const u=lookup(this.options.socketUrl,{transports:["websocket","polling"],withCredentials:!0,reconnectionDelayMax:1e4,reconnectionAttempts:10});return u.on("connect_error",h=>{u.io.opts.transports=["polling","websocket"],log$1.error("connect error",h)}),u.on("connect",async()=>{const{engine:h}=u.io;log$1.debug("initially connected to",h.transport.name),h.once("upgrade",()=>{log$1.debug("upgraded",h.transport.name)}),h.once("close",y=>{log$1.debug("connection closed",y)})}),u.on("error",h=>{log$1.error("socket errored",h),u.disconnect()}),this.SOCKET_CONN=u,this.SOCKET_CONN}}var eventsExports=requireEvents();const BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast","Pale Moon":"pale_moon",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",pale_moon:"Pale Moon",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv",bot:"bot"},OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"};class Utils{static getFirstMatch(u,h){const y=h.match(u);return y&&y.length>0&&y[1]||""}static getSecondMatch(u,h){const y=h.match(u);return y&&y.length>1&&y[2]||""}static matchAndReturnConst(u,h,y){if(u.test(h))return y}static getWindowsVersionName(u){switch(u){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}static getMacOSVersionName(u){const h=u.split(".").splice(0,2).map(y=>parseInt(y,10)||0);if(h.push(0),h[0]===10)switch(h[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}}static getAndroidVersionName(u){const h=u.split(".").splice(0,2).map(y=>parseInt(y,10)||0);if(h.push(0),!(h[0]===1&&h[1]<5)){if(h[0]===1&&h[1]<6)return"Cupcake";if(h[0]===1&&h[1]>=6)return"Donut";if(h[0]===2&&h[1]<2)return"Eclair";if(h[0]===2&&h[1]===2)return"Froyo";if(h[0]===2&&h[1]>2)return"Gingerbread";if(h[0]===3)return"Honeycomb";if(h[0]===4&&h[1]<1)return"Ice Cream Sandwich";if(h[0]===4&&h[1]<4)return"Jelly Bean";if(h[0]===4&&h[1]>=4)return"KitKat";if(h[0]===5)return"Lollipop";if(h[0]===6)return"Marshmallow";if(h[0]===7)return"Nougat";if(h[0]===8)return"Oreo";if(h[0]===9)return"Pie"}}static getVersionPrecision(u){return u.split(".").length}static compareVersions(u,h,y=!1){const v=Utils.getVersionPrecision(u),b=Utils.getVersionPrecision(h);let w=Math.max(v,b),E=0;const _=Utils.map([u,h],S=>{const A=w-Utils.getVersionPrecision(S),R=S+new Array(A+1).join(".0");return Utils.map(R.split("."),x=>new Array(20-x.length).join("0")+x).reverse()});for(y&&(E=w-Math.min(v,b)),w-=1;w>=E;){if(_[0][w]>_[1][w])return 1;if(_[0][w]===_[1][w]){if(w===E)return 0;w-=1}else if(_[0][w]<_[1][w])return-1}}static map(u,h){const y=[];let v;if(Array.prototype.map)return Array.prototype.map.call(u,h);for(v=0;v<u.length;v+=1)y.push(h(u[v]));return y}static find(u,h){let y,v;if(Array.prototype.find)return Array.prototype.find.call(u,h);for(y=0,v=u.length;y<v;y+=1){const b=u[y];if(h(b,y))return b}}static assign(u,...h){const y=u;let v,b;if(Object.assign)return Object.assign(u,...h);for(v=0,b=h.length;v<b;v+=1){const w=h[v];typeof w=="object"&&w!==null&&Object.keys(w).forEach(_=>{y[_]=w[_]})}return u}static getBrowserAlias(u){return BROWSER_ALIASES_MAP[u]}static getBrowserTypeByAlias(u){return BROWSER_MAP[u]||""}}const commonVersionIdentifier=/version\/(\d+(\.?_?\d+)+)/i,browsersList=[{test:[/googlebot/i],describe(g){const u={name:"Googlebot"},h=Utils.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,g)||Utils.getFirstMatch(commonVersionIdentifier,g);return h&&(u.version=h),u}},{test:[/opera/i],describe(g){const u={name:"Opera"},h=Utils.getFirstMatch(commonVersionIdentifier,g)||Utils.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/opr\/|opios/i],describe(g){const u={name:"Opera"},h=Utils.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,g)||Utils.getFirstMatch(commonVersionIdentifier,g);return h&&(u.version=h),u}},{test:[/SamsungBrowser/i],describe(g){const u={name:"Samsung Internet for Android"},h=Utils.getFirstMatch(commonVersionIdentifier,g)||Utils.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/Whale/i],describe(g){const u={name:"NAVER Whale Browser"},h=Utils.getFirstMatch(commonVersionIdentifier,g)||Utils.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/PaleMoon/i],describe(g){const u={name:"Pale Moon"},h=Utils.getFirstMatch(commonVersionIdentifier,g)||Utils.getFirstMatch(/(?:PaleMoon)[\s/](\d+(?:\.\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/MZBrowser/i],describe(g){const u={name:"MZ Browser"},h=Utils.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,g)||Utils.getFirstMatch(commonVersionIdentifier,g);return h&&(u.version=h),u}},{test:[/focus/i],describe(g){const u={name:"Focus"},h=Utils.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,g)||Utils.getFirstMatch(commonVersionIdentifier,g);return h&&(u.version=h),u}},{test:[/swing/i],describe(g){const u={name:"Swing"},h=Utils.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,g)||Utils.getFirstMatch(commonVersionIdentifier,g);return h&&(u.version=h),u}},{test:[/coast/i],describe(g){const u={name:"Opera Coast"},h=Utils.getFirstMatch(commonVersionIdentifier,g)||Utils.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(g){const u={name:"Opera Touch"},h=Utils.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,g)||Utils.getFirstMatch(commonVersionIdentifier,g);return h&&(u.version=h),u}},{test:[/yabrowser/i],describe(g){const u={name:"Yandex Browser"},h=Utils.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,g)||Utils.getFirstMatch(commonVersionIdentifier,g);return h&&(u.version=h),u}},{test:[/ucbrowser/i],describe(g){const u={name:"UC Browser"},h=Utils.getFirstMatch(commonVersionIdentifier,g)||Utils.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/Maxthon|mxios/i],describe(g){const u={name:"Maxthon"},h=Utils.getFirstMatch(commonVersionIdentifier,g)||Utils.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/epiphany/i],describe(g){const u={name:"Epiphany"},h=Utils.getFirstMatch(commonVersionIdentifier,g)||Utils.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/puffin/i],describe(g){const u={name:"Puffin"},h=Utils.getFirstMatch(commonVersionIdentifier,g)||Utils.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/sleipnir/i],describe(g){const u={name:"Sleipnir"},h=Utils.getFirstMatch(commonVersionIdentifier,g)||Utils.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/k-meleon/i],describe(g){const u={name:"K-Meleon"},h=Utils.getFirstMatch(commonVersionIdentifier,g)||Utils.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/micromessenger/i],describe(g){const u={name:"WeChat"},h=Utils.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,g)||Utils.getFirstMatch(commonVersionIdentifier,g);return h&&(u.version=h),u}},{test:[/qqbrowser/i],describe(g){const u={name:/qqbrowserlite/i.test(g)?"QQ Browser Lite":"QQ Browser"},h=Utils.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,g)||Utils.getFirstMatch(commonVersionIdentifier,g);return h&&(u.version=h),u}},{test:[/msie|trident/i],describe(g){const u={name:"Internet Explorer"},h=Utils.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/\sedg\//i],describe(g){const u={name:"Microsoft Edge"},h=Utils.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/edg([ea]|ios)/i],describe(g){const u={name:"Microsoft Edge"},h=Utils.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/vivaldi/i],describe(g){const u={name:"Vivaldi"},h=Utils.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/seamonkey/i],describe(g){const u={name:"SeaMonkey"},h=Utils.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/sailfish/i],describe(g){const u={name:"Sailfish"},h=Utils.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,g);return h&&(u.version=h),u}},{test:[/silk/i],describe(g){const u={name:"Amazon Silk"},h=Utils.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/phantom/i],describe(g){const u={name:"PhantomJS"},h=Utils.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/slimerjs/i],describe(g){const u={name:"SlimerJS"},h=Utils.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(g){const u={name:"BlackBerry"},h=Utils.getFirstMatch(commonVersionIdentifier,g)||Utils.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/(web|hpw)[o0]s/i],describe(g){const u={name:"WebOS Browser"},h=Utils.getFirstMatch(commonVersionIdentifier,g)||Utils.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/bada/i],describe(g){const u={name:"Bada"},h=Utils.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/tizen/i],describe(g){const u={name:"Tizen"},h=Utils.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,g)||Utils.getFirstMatch(commonVersionIdentifier,g);return h&&(u.version=h),u}},{test:[/qupzilla/i],describe(g){const u={name:"QupZilla"},h=Utils.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,g)||Utils.getFirstMatch(commonVersionIdentifier,g);return h&&(u.version=h),u}},{test:[/firefox|iceweasel|fxios/i],describe(g){const u={name:"Firefox"},h=Utils.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/electron/i],describe(g){const u={name:"Electron"},h=Utils.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/MiuiBrowser/i],describe(g){const u={name:"Miui"},h=Utils.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/chromium/i],describe(g){const u={name:"Chromium"},h=Utils.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,g)||Utils.getFirstMatch(commonVersionIdentifier,g);return h&&(u.version=h),u}},{test:[/chrome|crios|crmo/i],describe(g){const u={name:"Chrome"},h=Utils.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/GSA/i],describe(g){const u={name:"Google Search"},h=Utils.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test(g){const u=!g.test(/like android/i),h=g.test(/android/i);return u&&h},describe(g){const u={name:"Android Browser"},h=Utils.getFirstMatch(commonVersionIdentifier,g);return h&&(u.version=h),u}},{test:[/playstation 4/i],describe(g){const u={name:"PlayStation 4"},h=Utils.getFirstMatch(commonVersionIdentifier,g);return h&&(u.version=h),u}},{test:[/safari|applewebkit/i],describe(g){const u={name:"Safari"},h=Utils.getFirstMatch(commonVersionIdentifier,g);return h&&(u.version=h),u}},{test:[/.*/i],describe(g){const u=/^(.*)\/(.*) /,h=/^(.*)\/(.*)[ \t]\((.*)/,v=g.search("\\(")!==-1?h:u;return{name:Utils.getFirstMatch(v,g),version:Utils.getSecondMatch(v,g)}}}],osParsersList=[{test:[/Roku\/DVP/],describe(g){const u=Utils.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,g);return{name:OS_MAP.Roku,version:u}}},{test:[/windows phone/i],describe(g){const u=Utils.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,g);return{name:OS_MAP.WindowsPhone,version:u}}},{test:[/windows /i],describe(g){const u=Utils.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,g),h=Utils.getWindowsVersionName(u);return{name:OS_MAP.Windows,version:u,versionName:h}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(g){const u={name:OS_MAP.iOS},h=Utils.getSecondMatch(/(Version\/)(\d[\d.]+)/,g);return h&&(u.version=h),u}},{test:[/macintosh/i],describe(g){const u=Utils.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,g).replace(/[_\s]/g,"."),h=Utils.getMacOSVersionName(u),y={name:OS_MAP.MacOS,version:u};return h&&(y.versionName=h),y}},{test:[/(ipod|iphone|ipad)/i],describe(g){const u=Utils.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,g).replace(/[_\s]/g,".");return{name:OS_MAP.iOS,version:u}}},{test(g){const u=!g.test(/like android/i),h=g.test(/android/i);return u&&h},describe(g){const u=Utils.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,g),h=Utils.getAndroidVersionName(u),y={name:OS_MAP.Android,version:u};return h&&(y.versionName=h),y}},{test:[/(web|hpw)[o0]s/i],describe(g){const u=Utils.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,g),h={name:OS_MAP.WebOS};return u&&u.length&&(h.version=u),h}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(g){const u=Utils.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,g)||Utils.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,g)||Utils.getFirstMatch(/\bbb(\d+)/i,g);return{name:OS_MAP.BlackBerry,version:u}}},{test:[/bada/i],describe(g){const u=Utils.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,g);return{name:OS_MAP.Bada,version:u}}},{test:[/tizen/i],describe(g){const u=Utils.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,g);return{name:OS_MAP.Tizen,version:u}}},{test:[/linux/i],describe(){return{name:OS_MAP.Linux}}},{test:[/CrOS/],describe(){return{name:OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe(g){const u=Utils.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,g);return{name:OS_MAP.PlayStation4,version:u}}}],platformParsersList=[{test:[/googlebot/i],describe(){return{type:PLATFORMS_MAP.bot,vendor:"Google"}}},{test:[/huawei/i],describe(g){const u=Utils.getFirstMatch(/(can-l01)/i,g)&&"Nova",h={type:PLATFORMS_MAP.mobile,vendor:"Huawei"};return u&&(h.model=u),h}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe(){return{type:PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe(){return{type:PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(){return{type:PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe(){return{type:PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe(){return{type:PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe(){return{type:PLATFORMS_MAP.tablet}}},{test(g){const u=g.test(/ipod|iphone/i),h=g.test(/like (ipod|iphone)/i);return u&&!h},describe(g){const u=Utils.getFirstMatch(/(ipod|iphone)/i,g);return{type:PLATFORMS_MAP.mobile,vendor:"Apple",model:u}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe(){return{type:PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/Nokia/i],describe(g){const u=Utils.getFirstMatch(/Nokia\s+([0-9]+(\.[0-9]+)?)/i,g),h={type:PLATFORMS_MAP.mobile,vendor:"Nokia"};return u&&(h.model=u),h}},{test:[/[^-]mobi/i],describe(){return{type:PLATFORMS_MAP.mobile}}},{test(g){return g.getBrowserName(!0)==="blackberry"},describe(){return{type:PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test(g){return g.getBrowserName(!0)==="bada"},describe(){return{type:PLATFORMS_MAP.mobile}}},{test(g){return g.getBrowserName()==="windows phone"},describe(){return{type:PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test(g){const u=Number(String(g.getOSVersion()).split(".")[0]);return g.getOSName(!0)==="android"&&u>=3},describe(){return{type:PLATFORMS_MAP.tablet}}},{test(g){return g.getOSName(!0)==="android"},describe(){return{type:PLATFORMS_MAP.mobile}}},{test(g){return g.getOSName(!0)==="macos"},describe(){return{type:PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test(g){return g.getOSName(!0)==="windows"},describe(){return{type:PLATFORMS_MAP.desktop}}},{test(g){return g.getOSName(!0)==="linux"},describe(){return{type:PLATFORMS_MAP.desktop}}},{test(g){return g.getOSName(!0)==="playstation 4"},describe(){return{type:PLATFORMS_MAP.tv}}},{test(g){return g.getOSName(!0)==="roku"},describe(){return{type:PLATFORMS_MAP.tv}}}],enginesParsersList=[{test(g){return g.getBrowserName(!0)==="microsoft edge"},describe(g){if(/\sedg\//i.test(g))return{name:ENGINE_MAP.Blink};const h=Utils.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,g);return{name:ENGINE_MAP.EdgeHTML,version:h}}},{test:[/trident/i],describe(g){const u={name:ENGINE_MAP.Trident},h=Utils.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test(g){return g.test(/presto/i)},describe(g){const u={name:ENGINE_MAP.Presto},h=Utils.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test(g){const u=g.test(/gecko/i),h=g.test(/like gecko/i);return u&&!h},describe(g){const u={name:ENGINE_MAP.Gecko},h=Utils.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}},{test:[/(apple)?webkit\/537\.36/i],describe(){return{name:ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe(g){const u={name:ENGINE_MAP.WebKit},h=Utils.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,g);return h&&(u.version=h),u}}];class Parser{constructor(u,h=!1){if(u==null||u==="")throw new Error("UserAgent parameter can't be empty");this._ua=u,this.parsedResult={},h!==!0&&this.parse()}getUA(){return this._ua}test(u){return u.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const u=Utils.find(browsersList,h=>{if(typeof h.test=="function")return h.test(this);if(Array.isArray(h.test))return h.test.some(y=>this.test(y));throw new Error("Browser's test function is not valid")});return u&&(this.parsedResult.browser=u.describe(this.getUA())),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(u){return u?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const u=Utils.find(osParsersList,h=>{if(typeof h.test=="function")return h.test(this);if(Array.isArray(h.test))return h.test.some(y=>this.test(y));throw new Error("Browser's test function is not valid")});return u&&(this.parsedResult.os=u.describe(this.getUA())),this.parsedResult.os}getOSName(u){const{name:h}=this.getOS();return u?String(h).toLowerCase()||"":h||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(u=!1){const{type:h}=this.getPlatform();return u?String(h).toLowerCase()||"":h||""}parsePlatform(){this.parsedResult.platform={};const u=Utils.find(platformParsersList,h=>{if(typeof h.test=="function")return h.test(this);if(Array.isArray(h.test))return h.test.some(y=>this.test(y));throw new Error("Browser's test function is not valid")});return u&&(this.parsedResult.platform=u.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(u){return u?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const u=Utils.find(enginesParsersList,h=>{if(typeof h.test=="function")return h.test(this);if(Array.isArray(h.test))return h.test.some(y=>this.test(y));throw new Error("Browser's test function is not valid")});return u&&(this.parsedResult.engine=u.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return Utils.assign({},this.parsedResult)}satisfies(u){const h={};let y=0;const v={};let b=0;if(Object.keys(u).forEach(E=>{const _=u[E];typeof _=="string"?(v[E]=_,b+=1):typeof _=="object"&&(h[E]=_,y+=1)}),y>0){const E=Object.keys(h),_=Utils.find(E,A=>this.isOS(A));if(_){const A=this.satisfies(h[_]);if(A!==void 0)return A}const S=Utils.find(E,A=>this.isPlatform(A));if(S){const A=this.satisfies(h[S]);if(A!==void 0)return A}}if(b>0){const E=Object.keys(v),_=Utils.find(E,S=>this.isBrowser(S,!0));if(_!==void 0)return this.compareVersion(v[_])}}isBrowser(u,h=!1){const y=this.getBrowserName().toLowerCase();let v=u.toLowerCase();const b=Utils.getBrowserTypeByAlias(v);return h&&b&&(v=b.toLowerCase()),v===y}compareVersion(u){let h=[0],y=u,v=!1;const b=this.getBrowserVersion();if(typeof b=="string")return u[0]===">"||u[0]==="<"?(y=u.substr(1),u[1]==="="?(v=!0,y=u.substr(2)):h=[],u[0]===">"?h.push(1):h.push(-1)):u[0]==="="?y=u.substr(1):u[0]==="~"&&(v=!0,y=u.substr(1)),h.indexOf(Utils.compareVersions(b,y,v))>-1}isOS(u){return this.getOSName(!0)===String(u).toLowerCase()}isPlatform(u){return this.getPlatformType(!0)===String(u).toLowerCase()}isEngine(u){return this.getEngineName(!0)===String(u).toLowerCase()}is(u,h=!1){return this.isBrowser(u,h)||this.isOS(u)||this.isPlatform(u)}some(u=[]){return u.some(h=>this.is(h))}}/*!
 * Bowser - a browser detector
 * https://github.com/lancedikson/bowser
 * MIT License | (c) Dustin Diaz 2012-2015
 * MIT License | (c) Denis Demchenko 2015-2019
 */class Bowser{static getParser(u,h=!1){if(typeof u!="string")throw new Error("UserAgent should be a string");return new Parser(u,h)}static parse(u){return new Parser(u).getResult()}static get BROWSER_MAP(){return BROWSER_MAP}static get ENGINE_MAP(){return ENGINE_MAP}static get OS_MAP(){return OS_MAP}static get PLATFORMS_MAP(){return PLATFORMS_MAP}}var base64url$2={exports:{}},base64url$1={},padString={},hasRequiredPadString;function requirePadString(){if(hasRequiredPadString)return padString;hasRequiredPadString=1,Object.defineProperty(padString,"__esModule",{value:!0});function g(u){var h=4,y=u.length,v=y%h;if(!v)return u;var b=y,w=h-v,E=y+w,_=Buffer.alloc(E);for(_.write(u);w--;)_.write("=",b++);return _.toString()}return padString.default=g,padString}var hasRequiredBase64url$1;function requireBase64url$1(){if(hasRequiredBase64url$1)return base64url$1;hasRequiredBase64url$1=1,Object.defineProperty(base64url$1,"__esModule",{value:!0});var g=requirePadString();function u(E,_){return _===void 0&&(_="utf8"),Buffer.isBuffer(E)?v(E.toString("base64")):v(Buffer.from(E,_).toString("base64"))}function h(E,_){return _===void 0&&(_="utf8"),Buffer.from(y(E),"base64").toString(_)}function y(E){return E=E.toString(),g.default(E).replace(/\-/g,"+").replace(/_/g,"/")}function v(E){return E.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function b(E){return Buffer.from(y(E),"base64")}var w=u;return w.encode=u,w.decode=h,w.toBase64=y,w.fromBase64=v,w.toBuffer=b,base64url$1.default=w,base64url$1}var hasRequiredBase64url;function requireBase64url(){return hasRequiredBase64url||(hasRequiredBase64url=1,(function(g){g.exports=requireBase64url$1().default,g.exports.default=g.exports})(base64url$2)),base64url$2.exports}var base64urlExports=requireBase64url();const base64urlLib=getDefaultExportFromCjs(base64urlExports),base64url=base64urlLib;function safeatob(g){return base64url.decode(g)}function jsonToBase64(g){return base64url.encode(JSON.stringify(g))}function storageAvailable$1(g){let u=!1,h=0,y;try{y=window[g],u=!0,h=y.length;const v="__storage_test__";return y.setItem(v,v),y.removeItem(v),!0}catch(v){const b=v;return b&&(b.code===22||b.code===1014||b.name==="QuotaExceededError"||b.name==="NS_ERROR_DOM_QUOTA_REACHED")&&u&&h!==0}}const WEB3AUTH_LEGACY_NETWORK=TORUS_LEGACY_NETWORK,WEB3AUTH_SAPPHIRE_NETWORK=TORUS_SAPPHIRE_NETWORK,UX_MODE={POPUP:"popup",REDIRECT:"redirect"},WEB3AUTH_NETWORK=_objectSpread2(_objectSpread2({},WEB3AUTH_SAPPHIRE_NETWORK),WEB3AUTH_LEGACY_NETWORK),SUPPORTED_KEY_CURVES={OTHER:"other"},LOGIN_PROVIDER={FACEBOOK:"facebook",LINE:"line",SMS_PASSWORDLESS:"sms_passwordless",PASSKEYS:"passkeys",AUTHENTICATOR:"authenticator"},AUTH_ACTIONS={LOGIN:"login",ENABLE_MFA:"enable_mfa",MANAGE_MFA:"manage_mfa",ADD_AUTHENTICATOR_FACTOR:"add_authenticator_factor",ADD_PASSKEY_FACTOR:"add_passkey_factor"},BUILD_ENV={PRODUCTION:"production",DEVELOPMENT:"development",STAGING:"staging",TESTING:"testing"},version$1="9.6.4";function getHashQueryParams(g=!1){const u={},h=new URLSearchParams(window.location.search.slice(1));h.forEach((w,E)=>{E!=="b64Params"&&(u[E]=w)});const y=h.get("b64Params");if(y)try{const w=JSON.parse(safeatob(y));Object.keys(w).forEach(E=>{u[E]=w[E]})}catch(w){loglevel$1.error(w)}const v=new URLSearchParams(window.location.hash.substring(1));v.forEach((w,E)=>{E!=="b64Params"&&(u[E]=w)});const b=v.get("b64Params");if(b)try{const w=JSON.parse(safeatob(b));Object.keys(w).forEach(E=>{u[E]=w[E]})}catch(w){loglevel$1.error(w)}if(g){const w=new URL(window.location.origin+window.location.pathname);h.size!==0&&(h.delete("error"),h.delete("state"),h.delete("b64Params"),h.delete("sessionNamespace"),w.search=h.toString()),v.size!==0&&(v.delete("error"),v.delete("state"),v.delete("b64Params"),v.delete("sessionNamespace"),w.hash=v.toString()),window.history.replaceState(_objectSpread2(_objectSpread2({},window.history.state),{},{as:w.href,url:w.href}),"",w.href)}return u}function constructURL(g){const{baseURL:u,query:h,hash:y}=g,v=new URL(u);if(h&&Object.keys(h).forEach(b=>{v.searchParams.append(b,h[b])}),y){const b=new URL(constructURL({baseURL:u,query:y})).searchParams.toString();v.hash=b}return v.toString()}function getPopupFeatures$1(){if(typeof window>"u")return"";const g=window.screenLeft!==void 0?window.screenLeft:window.screenX,u=window.screenTop!==void 0?window.screenTop:window.screenY,h=1200,y=700,v=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:window.screen.width,b=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:window.screen.height,w=1,E=Math.abs((v-h)/2/w+g),_=Math.abs((b-y)/2/w+u);return`titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=${y/w},width=${h/w},top=${_},left=${E}`}function isMobileOrTablet(){if(typeof window>"u")return!1;const u=Bowser.getParser(window.navigator.userAgent).getPlatform();return u.type===Bowser.PLATFORMS_MAP.tablet||u.type===Bowser.PLATFORMS_MAP.mobile}function getTimeout(g){return(g===LOGIN_PROVIDER.FACEBOOK||g===LOGIN_PROVIDER.LINE)&&isMobileOrTablet()?1e3*60*5:1e3*10}let PopupHandler$1=class extends eventsExports.EventEmitter{constructor({url:u,target:h,features:y,timeout:v=3e4,sessionSocketUrl:b,sessionServerUrl:w}){super(),_defineProperty(this,"url",void 0),_defineProperty(this,"target",void 0),_defineProperty(this,"features",void 0),_defineProperty(this,"window",void 0),_defineProperty(this,"windowTimer",void 0),_defineProperty(this,"iClosedWindow",void 0),_defineProperty(this,"timeout",void 0),_defineProperty(this,"sessionSocketUrl",void 0),_defineProperty(this,"sessionServerUrl",void 0),this.url=u,this.target=h||"_blank",this.features=y||getPopupFeatures$1(),this.window=void 0,this.windowTimer=void 0,this.iClosedWindow=!1,this.timeout=v,this.sessionServerUrl=w||SESSION_SERVER_API_URL,this.sessionSocketUrl=b||SESSION_SERVER_SOCKET_URL,this._setupTimer()}_setupTimer(){this.windowTimer=Number(setInterval(()=>{this.window&&this.window.closed&&(clearInterval(this.windowTimer),setTimeout(()=>{this.iClosedWindow||this.emit("close"),this.iClosedWindow=!1,this.window=void 0},this.timeout)),this.window===void 0&&clearInterval(this.windowTimer)},500))}open(){var u;if(this.window=window.open(this.url,this.target,this.features),!this.window)throw LoginError.popupBlocked();(u=this.window)!==null&&u!==void 0&&u.focus&&this.window.focus()}close(){this.iClosedWindow=!0,this.window&&this.window.close()}redirect(u){u?window.location.replace(this.url):window.location.href=this.url}async listenOnChannel(u){const h=new SecurePubSub({serverUrl:this.sessionServerUrl,socketUrl:this.sessionSocketUrl}),y=await h.subscribe(u);this.close(),h.cleanup();const v=JSON.parse(y);return v.error?{error:v.error,state:v.state}:v.data}};class MemoryStore{constructor(){_defineProperty(this,"store",new Map)}getItem(u){return this.store.get(u)||null}setItem(u,h){this.store.set(u,h)}removeItem(u){this.store.delete(u)}}class BrowserStorage{constructor(u,h){_defineProperty(this,"storage",void 0),_defineProperty(this,"_storeKey",void 0),this.storage=h,this._storeKey=u;try{h.getItem(u)||this.resetStore()}catch{}}static getInstance(u,h="local"){if(!this.instanceMap.has(u)){let y;h==="local"&&storageAvailable$1("localStorage")?y=window.localStorage:h==="session"&&storageAvailable$1("sessionStorage")?y=window.sessionStorage:y=new MemoryStore,this.instanceMap.set(u,new this(u,y))}return this.instanceMap.get(u)}toJSON(){return this.storage.getItem(this._storeKey)}resetStore(){const u=this.getStore();return this.storage.removeItem(this._storeKey),u}getStore(){return JSON.parse(this.storage.getItem(this._storeKey)||"{}")}get(u){return JSON.parse(this.storage.getItem(this._storeKey)||"{}")[u]}set(u,h){const y=JSON.parse(this.storage.getItem(this._storeKey)||"{}");y[u]=h,this.storage.setItem(this._storeKey,JSON.stringify(y))}}_defineProperty(BrowserStorage,"instanceMap",new Map);class Auth{constructor(u){if(_defineProperty(this,"state",{}),_defineProperty(this,"options",void 0),_defineProperty(this,"sessionManager",void 0),_defineProperty(this,"currentStorage",void 0),_defineProperty(this,"_storageBaseKey","auth_store"),_defineProperty(this,"dappState",void 0),_defineProperty(this,"addVersionInUrls",!0),!u.clientId)throw InitializationError.invalidParams("clientId is required");if(u.network||(u.network=WEB3AUTH_NETWORK.SAPPHIRE_MAINNET),u.buildEnv||(u.buildEnv=BUILD_ENV.PRODUCTION),(u.buildEnv===BUILD_ENV.DEVELOPMENT||u.buildEnv===BUILD_ENV.TESTING||u.sdkUrl)&&(this.addVersionInUrls=!1),!u.sdkUrl&&!u.useMpc&&(u.buildEnv===BUILD_ENV.DEVELOPMENT?(u.sdkUrl="http://localhost:3000",u.dashboardUrl="http://localhost:5173"):u.buildEnv===BUILD_ENV.STAGING?(u.sdkUrl="https://staging-auth.web3auth.io",u.dashboardUrl="https://staging-account.web3auth.io"):u.buildEnv===BUILD_ENV.TESTING?(u.sdkUrl="https://develop-auth.web3auth.io",u.dashboardUrl="https://develop-account.web3auth.io"):(u.sdkUrl="https://auth.web3auth.io",u.dashboardUrl="https://account.web3auth.io")),u.useMpc&&!u.sdkUrl){if(Object.values(WEB3AUTH_LEGACY_NETWORK).includes(u.network))throw InitializationError.invalidParams("MPC is not supported on legacy networks, please use sapphire_devnet or sapphire_mainnet.");u.buildEnv===BUILD_ENV.DEVELOPMENT?u.sdkUrl="http://localhost:3000":u.buildEnv===BUILD_ENV.STAGING?u.sdkUrl="https://staging-mpc-auth.web3auth.io":u.buildEnv===BUILD_ENV.TESTING?u.sdkUrl="https://develop-mpc-auth.web3auth.io":u.sdkUrl="https://mpc-auth.web3auth.io"}!u.redirectUrl&&typeof window<"u"&&(u.redirectUrl=`${window.location.protocol}//${window.location.host}${window.location.pathname}`),u.uxMode||(u.uxMode=UX_MODE.REDIRECT),typeof u.replaceUrlOnRedirect!="boolean"&&(u.replaceUrlOnRedirect=!0),u.originData||(u.originData={}),u.whiteLabel||(u.whiteLabel={}),u.loginConfig||(u.loginConfig={}),u.mfaSettings||(u.mfaSettings={}),u.storageServerUrl||(u.storageServerUrl=SESSION_SERVER_API_URL),u.sessionSocketUrl||(u.sessionSocketUrl=SESSION_SERVER_SOCKET_URL),u.storageKey||(u.storageKey="local"),u.webauthnTransports||(u.webauthnTransports=["internal"]),u.sessionTime||(u.sessionTime=86400),this.options=u}get privKey(){return this.options.useMpc?this.state.factorKey||"":this.state.privKey?this.state.privKey.padStart(64,"0"):""}get coreKitKey(){return this.state.coreKitKey?this.state.coreKitKey.padStart(64,"0"):""}get ed25519PrivKey(){return this.state.ed25519PrivKey?this.state.ed25519PrivKey.padStart(128,"0"):""}get coreKitEd25519Key(){return this.state.coreKitEd25519PrivKey?this.state.coreKitEd25519PrivKey.padStart(128,"0"):""}get sessionId(){return this.state.sessionId||""}get sessionNamespace(){return this.options.sessionNamespace||""}get appState(){return this.state.userInfo.appState||this.dappState||""}get baseUrl(){return this.addVersionInUrls?`${this.options.sdkUrl}/v${version$1.split(".")[0]}`:`${this.options.sdkUrl}`}get dashboardUrl(){return this.addVersionInUrls?`${this.options.dashboardUrl}/v${version$1.split(".")[0]}`:`${this.options.dashboardUrl}`}async init(){const u=getHashQueryParams(this.options.replaceUrlOnRedirect);u.sessionNamespace&&(this.options.sessionNamespace=u.sessionNamespace);const h=this.options.sessionNamespace?`${this._storageBaseKey}_${this.options.sessionNamespace}`:this._storageBaseKey;this.currentStorage=BrowserStorage.getInstance(h,this.options.storageKey);const y=this.currentStorage.get("sessionId");if(this.sessionManager=new SessionManager({sessionServerBaseUrl:this.options.storageServerUrl,sessionNamespace:this.options.sessionNamespace,sessionTime:this.options.sessionTime,sessionId:y,allowedOrigin:this.options.sdkUrl}),(this.options.network===WEB3AUTH_NETWORK.TESTNET||this.options.network===WEB3AUTH_NETWORK.SAPPHIRE_DEVNET)&&console.log(`%c WARNING! You are on ${this.options.network}. Please set network: 'mainnet' or 'sapphire_mainnet' in production`,"color: #FF0000"),this.options.buildEnv!==BUILD_ENV.PRODUCTION&&console.log(`%c WARNING! You are using build env ${this.options.buildEnv}. Please set buildEnv: 'production' in production`,"color: #FF0000"),u.error)throw this.dappState=u.state,LoginError.loginFailed(u.error);if(u.sessionId&&(this.currentStorage.set("sessionId",u.sessionId),this.sessionManager.sessionId=u.sessionId),this.sessionManager.sessionId){const v=await this._authorizeSession();this.updateState(v),Object.keys(v).length===0?this.currentStorage.set("sessionId",""):this.updateState({sessionId:this.sessionManager.sessionId})}}async login(u){if(!u.loginProvider)throw LoginError.invalidLoginParams("loginProvider is required");const h={redirectUrl:this.options.redirectUrl},y=_objectSpread2(_objectSpread2({loginProvider:u.loginProvider},h),u),v={actionType:AUTH_ACTIONS.LOGIN,options:this.options,params:y},b=await this.authHandler(`${this.baseUrl}/start`,v,getTimeout(u.loginProvider));if(this.options.uxMode===UX_MODE.REDIRECT)return null;if(b.error)throw this.dappState=b.state,LoginError.loginFailed(b.error);return this.sessionManager.sessionId=b.sessionId,this.options.sessionNamespace=b.sessionNamespace,this.currentStorage.set("sessionId",b.sessionId),await this.rehydrateSession(),{privKey:this.privKey}}async logout(){if(!this.sessionManager.sessionId)throw LoginError.userNotLoggedIn();await this.sessionManager.invalidateSession(),this.updateState({privKey:"",coreKitKey:"",coreKitEd25519PrivKey:"",ed25519PrivKey:"",walletKey:"",oAuthPrivateKey:"",tKey:"",metadataNonce:"",keyMode:void 0,userInfo:{name:"",profileImage:"",dappShare:"",idToken:"",oAuthIdToken:"",oAuthAccessToken:"",appState:"",email:"",verifier:"",verifierId:"",aggregateVerifier:"",typeOfLogin:"",isMfaEnabled:!1},authToken:"",sessionId:"",factorKey:"",signatures:[],tssShareIndex:-1,tssPubKey:"",tssShare:"",tssNonce:-1}),this.currentStorage.set("sessionId","")}async enableMFA(u){var h;if(!this.sessionId)throw LoginError.userNotLoggedIn();if(this.state.userInfo.isMfaEnabled)throw LoginError.mfaAlreadyEnabled();const y={redirectUrl:this.options.redirectUrl},v={actionType:AUTH_ACTIONS.ENABLE_MFA,options:this.options,params:_objectSpread2(_objectSpread2(_objectSpread2({},y),u),{},{loginProvider:this.state.userInfo.typeOfLogin,extraLoginOptions:{login_hint:this.state.userInfo.verifierId},mfaLevel:"mandatory"}),sessionId:this.sessionId},b=await this.authHandler(`${this.baseUrl}/start`,v,getTimeout(v.params.loginProvider));if(this.options.uxMode===UX_MODE.REDIRECT)return null;if(b.error)throw this.dappState=b.state,LoginError.loginFailed(b.error);return this.sessionManager.sessionId=b.sessionId,this.options.sessionNamespace=b.sessionNamespace,this.currentStorage.set("sessionId",b.sessionId),await this.rehydrateSession(),!!(!((h=this.state.userInfo)===null||h===void 0)&&h.isMfaEnabled)}async manageMFA(u){if(!this.sessionId)throw LoginError.userNotLoggedIn();if(!this.state.userInfo.isMfaEnabled)throw LoginError.mfaNotEnabled();const h={redirectUrl:`${this.dashboardUrl}/wallet/account`,dappUrl:`${window.location.origin}${window.location.pathname}`},y=SessionManager.generateRandomSessionKey(),v={actionType:AUTH_ACTIONS.MANAGE_MFA,options:_objectSpread2(_objectSpread2({},this.options),{},{uxMode:"redirect"}),params:_objectSpread2(_objectSpread2(_objectSpread2({},h),u),{},{loginProvider:this.state.userInfo.typeOfLogin,extraLoginOptions:{login_hint:this.state.userInfo.verifierId},appState:jsonToBase64({loginId:y})}),sessionId:this.sessionId};this.createLoginSession(y,v,v.options.sessionTime,!0);const b={loginId:y,sessionNamespace:this.options.sessionNamespace,storageServerUrl:this.options.storageServerUrl},w=constructURL({baseURL:`${this.baseUrl}/start`,hash:{b64Params:jsonToBase64(b)}});window.open(w,"_blank")}async manageSocialFactor(u,h){if(!this.sessionId)throw LoginError.userNotLoggedIn();const y={redirectUrl:this.options.redirectUrl},v={actionType:u,options:this.options,params:_objectSpread2(_objectSpread2({},y),h),sessionId:this.sessionId},b=await this.authHandler(`${this.baseUrl}/start`,v);if(this.options.uxMode!==UX_MODE.REDIRECT)return!b.error}async addAuthenticatorFactor(u){if(!this.sessionId)throw LoginError.userNotLoggedIn();const h={redirectUrl:this.options.redirectUrl},y={actionType:AUTH_ACTIONS.ADD_AUTHENTICATOR_FACTOR,options:this.options,params:_objectSpread2(_objectSpread2(_objectSpread2({},h),u),{},{loginProvider:LOGIN_PROVIDER.AUTHENTICATOR}),sessionId:this.sessionId},v=await this.authHandler(`${this.baseUrl}/start`,y);if(this.options.uxMode!==UX_MODE.REDIRECT)return!v.error}async addPasskeyFactor(u){if(!this.sessionId)throw LoginError.userNotLoggedIn();const h={redirectUrl:this.options.redirectUrl},y={actionType:AUTH_ACTIONS.ADD_PASSKEY_FACTOR,options:this.options,params:_objectSpread2(_objectSpread2(_objectSpread2({},h),u),{},{loginProvider:LOGIN_PROVIDER.PASSKEYS}),sessionId:this.sessionId},v=await this.authHandler(`${this.baseUrl}/start`,y);if(this.options.uxMode!==UX_MODE.REDIRECT)return!v.error}getUserInfo(){if(!this.sessionManager.sessionId)throw LoginError.userNotLoggedIn();return this.state.userInfo}async createLoginSession(u,h,y=600,v=!1){if(!this.sessionManager)throw InitializationError.notInitialized();const w=new SessionManager({sessionServerBaseUrl:h.options.storageServerUrl,sessionNamespace:h.options.sessionNamespace,sessionTime:y,sessionId:u,allowedOrigin:this.options.sdkUrl}).createSession(JSON.parse(JSON.stringify(h)));h.options.uxMode===UX_MODE.REDIRECT&&!v&&await w}async _authorizeSession(){try{return this.sessionManager.sessionId?await this.sessionManager.authorizeSession():{}}catch(u){return loglevel$1.error("authorization failed",u),{}}}updateState(u){this.state=_objectSpread2(_objectSpread2({},this.state),u)}async rehydrateSession(){const u=await this._authorizeSession();this.updateState(u)}async authHandler(u,h,y=1e3*10){const v=SessionManager.generateRandomSessionKey();await this.createLoginSession(v,h);const b={loginId:v,sessionNamespace:this.options.sessionNamespace,storageServerUrl:this.options.storageServerUrl};if(this.options.uxMode===UX_MODE.REDIRECT){const _=constructURL({baseURL:u,hash:{b64Params:jsonToBase64(b)}});window.location.href=_;return}const w=constructURL({baseURL:u,hash:{b64Params:jsonToBase64(b)}}),E=new PopupHandler$1({url:w,timeout:y,sessionServerUrl:this.options.storageServerUrl,sessionSocketUrl:this.options.sessionSocketUrl});return new Promise((_,S)=>{E.on("close",()=>{S(LoginError.popupClosed())}),E.listenOnChannel(v).then(_).catch(S);try{E.open()}catch(A){S(A)}})}}function commonjsRequire(g){throw new Error('Could not dynamically require "'+g+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var naclFast={exports:{}},hasRequiredNaclFast;function requireNaclFast(){return hasRequiredNaclFast||(hasRequiredNaclFast=1,(function(g){(function(u){var h=function(ie){var fe,ye=new Float64Array(16);if(ie)for(fe=0;fe<ie.length;fe++)ye[fe]=ie[fe];return ye},y=function(){throw new Error("no PRNG")},v=new Uint8Array(16),b=new Uint8Array(32);b[0]=9;var w=h(),E=h([1]),_=h([56129,1]),S=h([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),A=h([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),R=h([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),x=h([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),T=h([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function C(ie,fe,ye,Q){ie[fe]=ye>>24&255,ie[fe+1]=ye>>16&255,ie[fe+2]=ye>>8&255,ie[fe+3]=ye&255,ie[fe+4]=Q>>24&255,ie[fe+5]=Q>>16&255,ie[fe+6]=Q>>8&255,ie[fe+7]=Q&255}function I(ie,fe,ye,Q,ve){var Te,Ie=0;for(Te=0;Te<ve;Te++)Ie|=ie[fe+Te]^ye[Q+Te];return(1&Ie-1>>>8)-1}function L(ie,fe,ye,Q){return I(ie,fe,ye,Q,16)}function $(ie,fe,ye,Q){return I(ie,fe,ye,Q,32)}function B(ie,fe,ye,Q){for(var ve=Q[0]&255|(Q[1]&255)<<8|(Q[2]&255)<<16|(Q[3]&255)<<24,Te=ye[0]&255|(ye[1]&255)<<8|(ye[2]&255)<<16|(ye[3]&255)<<24,Ie=ye[4]&255|(ye[5]&255)<<8|(ye[6]&255)<<16|(ye[7]&255)<<24,$e=ye[8]&255|(ye[9]&255)<<8|(ye[10]&255)<<16|(ye[11]&255)<<24,De=ye[12]&255|(ye[13]&255)<<8|(ye[14]&255)<<16|(ye[15]&255)<<24,Ve=Q[4]&255|(Q[5]&255)<<8|(Q[6]&255)<<16|(Q[7]&255)<<24,Ke=fe[0]&255|(fe[1]&255)<<8|(fe[2]&255)<<16|(fe[3]&255)<<24,vt=fe[4]&255|(fe[5]&255)<<8|(fe[6]&255)<<16|(fe[7]&255)<<24,Ge=fe[8]&255|(fe[9]&255)<<8|(fe[10]&255)<<16|(fe[11]&255)<<24,nt=fe[12]&255|(fe[13]&255)<<8|(fe[14]&255)<<16|(fe[15]&255)<<24,st=Q[8]&255|(Q[9]&255)<<8|(Q[10]&255)<<16|(Q[11]&255)<<24,mt=ye[16]&255|(ye[17]&255)<<8|(ye[18]&255)<<16|(ye[19]&255)<<24,yt=ye[20]&255|(ye[21]&255)<<8|(ye[22]&255)<<16|(ye[23]&255)<<24,ot=ye[24]&255|(ye[25]&255)<<8|(ye[26]&255)<<16|(ye[27]&255)<<24,ct=ye[28]&255|(ye[29]&255)<<8|(ye[30]&255)<<16|(ye[31]&255)<<24,at=Q[12]&255|(Q[13]&255)<<8|(Q[14]&255)<<16|(Q[15]&255)<<24,Ze=ve,tt=Te,Ye=Ie,Qe=$e,et=De,je=Ve,Be=Ke,ke=vt,Fe=Ge,qe=nt,Ue=st,He=mt,ht=yt,St=ot,Rt=ct,At=at,Re,Ct=0;Ct<20;Ct+=2)Re=Ze+ht|0,et^=Re<<7|Re>>>25,Re=et+Ze|0,Fe^=Re<<9|Re>>>23,Re=Fe+et|0,ht^=Re<<13|Re>>>19,Re=ht+Fe|0,Ze^=Re<<18|Re>>>14,Re=je+tt|0,qe^=Re<<7|Re>>>25,Re=qe+je|0,St^=Re<<9|Re>>>23,Re=St+qe|0,tt^=Re<<13|Re>>>19,Re=tt+St|0,je^=Re<<18|Re>>>14,Re=Ue+Be|0,Rt^=Re<<7|Re>>>25,Re=Rt+Ue|0,Ye^=Re<<9|Re>>>23,Re=Ye+Rt|0,Be^=Re<<13|Re>>>19,Re=Be+Ye|0,Ue^=Re<<18|Re>>>14,Re=At+He|0,Qe^=Re<<7|Re>>>25,Re=Qe+At|0,ke^=Re<<9|Re>>>23,Re=ke+Qe|0,He^=Re<<13|Re>>>19,Re=He+ke|0,At^=Re<<18|Re>>>14,Re=Ze+Qe|0,tt^=Re<<7|Re>>>25,Re=tt+Ze|0,Ye^=Re<<9|Re>>>23,Re=Ye+tt|0,Qe^=Re<<13|Re>>>19,Re=Qe+Ye|0,Ze^=Re<<18|Re>>>14,Re=je+et|0,Be^=Re<<7|Re>>>25,Re=Be+je|0,ke^=Re<<9|Re>>>23,Re=ke+Be|0,et^=Re<<13|Re>>>19,Re=et+ke|0,je^=Re<<18|Re>>>14,Re=Ue+qe|0,He^=Re<<7|Re>>>25,Re=He+Ue|0,Fe^=Re<<9|Re>>>23,Re=Fe+He|0,qe^=Re<<13|Re>>>19,Re=qe+Fe|0,Ue^=Re<<18|Re>>>14,Re=At+Rt|0,ht^=Re<<7|Re>>>25,Re=ht+At|0,St^=Re<<9|Re>>>23,Re=St+ht|0,Rt^=Re<<13|Re>>>19,Re=Rt+St|0,At^=Re<<18|Re>>>14;Ze=Ze+ve|0,tt=tt+Te|0,Ye=Ye+Ie|0,Qe=Qe+$e|0,et=et+De|0,je=je+Ve|0,Be=Be+Ke|0,ke=ke+vt|0,Fe=Fe+Ge|0,qe=qe+nt|0,Ue=Ue+st|0,He=He+mt|0,ht=ht+yt|0,St=St+ot|0,Rt=Rt+ct|0,At=At+at|0,ie[0]=Ze>>>0&255,ie[1]=Ze>>>8&255,ie[2]=Ze>>>16&255,ie[3]=Ze>>>24&255,ie[4]=tt>>>0&255,ie[5]=tt>>>8&255,ie[6]=tt>>>16&255,ie[7]=tt>>>24&255,ie[8]=Ye>>>0&255,ie[9]=Ye>>>8&255,ie[10]=Ye>>>16&255,ie[11]=Ye>>>24&255,ie[12]=Qe>>>0&255,ie[13]=Qe>>>8&255,ie[14]=Qe>>>16&255,ie[15]=Qe>>>24&255,ie[16]=et>>>0&255,ie[17]=et>>>8&255,ie[18]=et>>>16&255,ie[19]=et>>>24&255,ie[20]=je>>>0&255,ie[21]=je>>>8&255,ie[22]=je>>>16&255,ie[23]=je>>>24&255,ie[24]=Be>>>0&255,ie[25]=Be>>>8&255,ie[26]=Be>>>16&255,ie[27]=Be>>>24&255,ie[28]=ke>>>0&255,ie[29]=ke>>>8&255,ie[30]=ke>>>16&255,ie[31]=ke>>>24&255,ie[32]=Fe>>>0&255,ie[33]=Fe>>>8&255,ie[34]=Fe>>>16&255,ie[35]=Fe>>>24&255,ie[36]=qe>>>0&255,ie[37]=qe>>>8&255,ie[38]=qe>>>16&255,ie[39]=qe>>>24&255,ie[40]=Ue>>>0&255,ie[41]=Ue>>>8&255,ie[42]=Ue>>>16&255,ie[43]=Ue>>>24&255,ie[44]=He>>>0&255,ie[45]=He>>>8&255,ie[46]=He>>>16&255,ie[47]=He>>>24&255,ie[48]=ht>>>0&255,ie[49]=ht>>>8&255,ie[50]=ht>>>16&255,ie[51]=ht>>>24&255,ie[52]=St>>>0&255,ie[53]=St>>>8&255,ie[54]=St>>>16&255,ie[55]=St>>>24&255,ie[56]=Rt>>>0&255,ie[57]=Rt>>>8&255,ie[58]=Rt>>>16&255,ie[59]=Rt>>>24&255,ie[60]=At>>>0&255,ie[61]=At>>>8&255,ie[62]=At>>>16&255,ie[63]=At>>>24&255}function U(ie,fe,ye,Q){for(var ve=Q[0]&255|(Q[1]&255)<<8|(Q[2]&255)<<16|(Q[3]&255)<<24,Te=ye[0]&255|(ye[1]&255)<<8|(ye[2]&255)<<16|(ye[3]&255)<<24,Ie=ye[4]&255|(ye[5]&255)<<8|(ye[6]&255)<<16|(ye[7]&255)<<24,$e=ye[8]&255|(ye[9]&255)<<8|(ye[10]&255)<<16|(ye[11]&255)<<24,De=ye[12]&255|(ye[13]&255)<<8|(ye[14]&255)<<16|(ye[15]&255)<<24,Ve=Q[4]&255|(Q[5]&255)<<8|(Q[6]&255)<<16|(Q[7]&255)<<24,Ke=fe[0]&255|(fe[1]&255)<<8|(fe[2]&255)<<16|(fe[3]&255)<<24,vt=fe[4]&255|(fe[5]&255)<<8|(fe[6]&255)<<16|(fe[7]&255)<<24,Ge=fe[8]&255|(fe[9]&255)<<8|(fe[10]&255)<<16|(fe[11]&255)<<24,nt=fe[12]&255|(fe[13]&255)<<8|(fe[14]&255)<<16|(fe[15]&255)<<24,st=Q[8]&255|(Q[9]&255)<<8|(Q[10]&255)<<16|(Q[11]&255)<<24,mt=ye[16]&255|(ye[17]&255)<<8|(ye[18]&255)<<16|(ye[19]&255)<<24,yt=ye[20]&255|(ye[21]&255)<<8|(ye[22]&255)<<16|(ye[23]&255)<<24,ot=ye[24]&255|(ye[25]&255)<<8|(ye[26]&255)<<16|(ye[27]&255)<<24,ct=ye[28]&255|(ye[29]&255)<<8|(ye[30]&255)<<16|(ye[31]&255)<<24,at=Q[12]&255|(Q[13]&255)<<8|(Q[14]&255)<<16|(Q[15]&255)<<24,Ze=ve,tt=Te,Ye=Ie,Qe=$e,et=De,je=Ve,Be=Ke,ke=vt,Fe=Ge,qe=nt,Ue=st,He=mt,ht=yt,St=ot,Rt=ct,At=at,Re,Ct=0;Ct<20;Ct+=2)Re=Ze+ht|0,et^=Re<<7|Re>>>25,Re=et+Ze|0,Fe^=Re<<9|Re>>>23,Re=Fe+et|0,ht^=Re<<13|Re>>>19,Re=ht+Fe|0,Ze^=Re<<18|Re>>>14,Re=je+tt|0,qe^=Re<<7|Re>>>25,Re=qe+je|0,St^=Re<<9|Re>>>23,Re=St+qe|0,tt^=Re<<13|Re>>>19,Re=tt+St|0,je^=Re<<18|Re>>>14,Re=Ue+Be|0,Rt^=Re<<7|Re>>>25,Re=Rt+Ue|0,Ye^=Re<<9|Re>>>23,Re=Ye+Rt|0,Be^=Re<<13|Re>>>19,Re=Be+Ye|0,Ue^=Re<<18|Re>>>14,Re=At+He|0,Qe^=Re<<7|Re>>>25,Re=Qe+At|0,ke^=Re<<9|Re>>>23,Re=ke+Qe|0,He^=Re<<13|Re>>>19,Re=He+ke|0,At^=Re<<18|Re>>>14,Re=Ze+Qe|0,tt^=Re<<7|Re>>>25,Re=tt+Ze|0,Ye^=Re<<9|Re>>>23,Re=Ye+tt|0,Qe^=Re<<13|Re>>>19,Re=Qe+Ye|0,Ze^=Re<<18|Re>>>14,Re=je+et|0,Be^=Re<<7|Re>>>25,Re=Be+je|0,ke^=Re<<9|Re>>>23,Re=ke+Be|0,et^=Re<<13|Re>>>19,Re=et+ke|0,je^=Re<<18|Re>>>14,Re=Ue+qe|0,He^=Re<<7|Re>>>25,Re=He+Ue|0,Fe^=Re<<9|Re>>>23,Re=Fe+He|0,qe^=Re<<13|Re>>>19,Re=qe+Fe|0,Ue^=Re<<18|Re>>>14,Re=At+Rt|0,ht^=Re<<7|Re>>>25,Re=ht+At|0,St^=Re<<9|Re>>>23,Re=St+ht|0,Rt^=Re<<13|Re>>>19,Re=Rt+St|0,At^=Re<<18|Re>>>14;ie[0]=Ze>>>0&255,ie[1]=Ze>>>8&255,ie[2]=Ze>>>16&255,ie[3]=Ze>>>24&255,ie[4]=je>>>0&255,ie[5]=je>>>8&255,ie[6]=je>>>16&255,ie[7]=je>>>24&255,ie[8]=Ue>>>0&255,ie[9]=Ue>>>8&255,ie[10]=Ue>>>16&255,ie[11]=Ue>>>24&255,ie[12]=At>>>0&255,ie[13]=At>>>8&255,ie[14]=At>>>16&255,ie[15]=At>>>24&255,ie[16]=Be>>>0&255,ie[17]=Be>>>8&255,ie[18]=Be>>>16&255,ie[19]=Be>>>24&255,ie[20]=ke>>>0&255,ie[21]=ke>>>8&255,ie[22]=ke>>>16&255,ie[23]=ke>>>24&255,ie[24]=Fe>>>0&255,ie[25]=Fe>>>8&255,ie[26]=Fe>>>16&255,ie[27]=Fe>>>24&255,ie[28]=qe>>>0&255,ie[29]=qe>>>8&255,ie[30]=qe>>>16&255,ie[31]=qe>>>24&255}function z(ie,fe,ye,Q){B(ie,fe,ye,Q)}function ne(ie,fe,ye,Q){U(ie,fe,ye,Q)}var ue=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function he(ie,fe,ye,Q,ve,Te,Ie){var $e=new Uint8Array(16),De=new Uint8Array(64),Ve,Ke;for(Ke=0;Ke<16;Ke++)$e[Ke]=0;for(Ke=0;Ke<8;Ke++)$e[Ke]=Te[Ke];for(;ve>=64;){for(z(De,$e,Ie,ue),Ke=0;Ke<64;Ke++)ie[fe+Ke]=ye[Q+Ke]^De[Ke];for(Ve=1,Ke=8;Ke<16;Ke++)Ve=Ve+($e[Ke]&255)|0,$e[Ke]=Ve&255,Ve>>>=8;ve-=64,fe+=64,Q+=64}if(ve>0)for(z(De,$e,Ie,ue),Ke=0;Ke<ve;Ke++)ie[fe+Ke]=ye[Q+Ke]^De[Ke];return 0}function Y(ie,fe,ye,Q,ve){var Te=new Uint8Array(16),Ie=new Uint8Array(64),$e,De;for(De=0;De<16;De++)Te[De]=0;for(De=0;De<8;De++)Te[De]=Q[De];for(;ye>=64;){for(z(Ie,Te,ve,ue),De=0;De<64;De++)ie[fe+De]=Ie[De];for($e=1,De=8;De<16;De++)$e=$e+(Te[De]&255)|0,Te[De]=$e&255,$e>>>=8;ye-=64,fe+=64}if(ye>0)for(z(Ie,Te,ve,ue),De=0;De<ye;De++)ie[fe+De]=Ie[De];return 0}function X(ie,fe,ye,Q,ve){var Te=new Uint8Array(32);ne(Te,Q,ve,ue);for(var Ie=new Uint8Array(8),$e=0;$e<8;$e++)Ie[$e]=Q[$e+16];return Y(ie,fe,ye,Ie,Te)}function J(ie,fe,ye,Q,ve,Te,Ie){var $e=new Uint8Array(32);ne($e,Te,Ie,ue);for(var De=new Uint8Array(8),Ve=0;Ve<8;Ve++)De[Ve]=Te[Ve+16];return he(ie,fe,ye,Q,ve,De,$e)}var j=function(ie){this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.leftover=0,this.fin=0;var fe,ye,Q,ve,Te,Ie,$e,De;fe=ie[0]&255|(ie[1]&255)<<8,this.r[0]=fe&8191,ye=ie[2]&255|(ie[3]&255)<<8,this.r[1]=(fe>>>13|ye<<3)&8191,Q=ie[4]&255|(ie[5]&255)<<8,this.r[2]=(ye>>>10|Q<<6)&7939,ve=ie[6]&255|(ie[7]&255)<<8,this.r[3]=(Q>>>7|ve<<9)&8191,Te=ie[8]&255|(ie[9]&255)<<8,this.r[4]=(ve>>>4|Te<<12)&255,this.r[5]=Te>>>1&8190,Ie=ie[10]&255|(ie[11]&255)<<8,this.r[6]=(Te>>>14|Ie<<2)&8191,$e=ie[12]&255|(ie[13]&255)<<8,this.r[7]=(Ie>>>11|$e<<5)&8065,De=ie[14]&255|(ie[15]&255)<<8,this.r[8]=($e>>>8|De<<8)&8191,this.r[9]=De>>>5&127,this.pad[0]=ie[16]&255|(ie[17]&255)<<8,this.pad[1]=ie[18]&255|(ie[19]&255)<<8,this.pad[2]=ie[20]&255|(ie[21]&255)<<8,this.pad[3]=ie[22]&255|(ie[23]&255)<<8,this.pad[4]=ie[24]&255|(ie[25]&255)<<8,this.pad[5]=ie[26]&255|(ie[27]&255)<<8,this.pad[6]=ie[28]&255|(ie[29]&255)<<8,this.pad[7]=ie[30]&255|(ie[31]&255)<<8};j.prototype.blocks=function(ie,fe,ye){for(var Q=this.fin?0:2048,ve,Te,Ie,$e,De,Ve,Ke,vt,Ge,nt,st,mt,yt,ot,ct,at,Ze,tt,Ye,Qe=this.h[0],et=this.h[1],je=this.h[2],Be=this.h[3],ke=this.h[4],Fe=this.h[5],qe=this.h[6],Ue=this.h[7],He=this.h[8],ht=this.h[9],St=this.r[0],Rt=this.r[1],At=this.r[2],Re=this.r[3],Ct=this.r[4],$t=this.r[5],Bt=this.r[6],xt=this.r[7],Nt=this.r[8],Lt=this.r[9];ye>=16;)ve=ie[fe+0]&255|(ie[fe+1]&255)<<8,Qe+=ve&8191,Te=ie[fe+2]&255|(ie[fe+3]&255)<<8,et+=(ve>>>13|Te<<3)&8191,Ie=ie[fe+4]&255|(ie[fe+5]&255)<<8,je+=(Te>>>10|Ie<<6)&8191,$e=ie[fe+6]&255|(ie[fe+7]&255)<<8,Be+=(Ie>>>7|$e<<9)&8191,De=ie[fe+8]&255|(ie[fe+9]&255)<<8,ke+=($e>>>4|De<<12)&8191,Fe+=De>>>1&8191,Ve=ie[fe+10]&255|(ie[fe+11]&255)<<8,qe+=(De>>>14|Ve<<2)&8191,Ke=ie[fe+12]&255|(ie[fe+13]&255)<<8,Ue+=(Ve>>>11|Ke<<5)&8191,vt=ie[fe+14]&255|(ie[fe+15]&255)<<8,He+=(Ke>>>8|vt<<8)&8191,ht+=vt>>>5|Q,Ge=0,nt=Ge,nt+=Qe*St,nt+=et*(5*Lt),nt+=je*(5*Nt),nt+=Be*(5*xt),nt+=ke*(5*Bt),Ge=nt>>>13,nt&=8191,nt+=Fe*(5*$t),nt+=qe*(5*Ct),nt+=Ue*(5*Re),nt+=He*(5*At),nt+=ht*(5*Rt),Ge+=nt>>>13,nt&=8191,st=Ge,st+=Qe*Rt,st+=et*St,st+=je*(5*Lt),st+=Be*(5*Nt),st+=ke*(5*xt),Ge=st>>>13,st&=8191,st+=Fe*(5*Bt),st+=qe*(5*$t),st+=Ue*(5*Ct),st+=He*(5*Re),st+=ht*(5*At),Ge+=st>>>13,st&=8191,mt=Ge,mt+=Qe*At,mt+=et*Rt,mt+=je*St,mt+=Be*(5*Lt),mt+=ke*(5*Nt),Ge=mt>>>13,mt&=8191,mt+=Fe*(5*xt),mt+=qe*(5*Bt),mt+=Ue*(5*$t),mt+=He*(5*Ct),mt+=ht*(5*Re),Ge+=mt>>>13,mt&=8191,yt=Ge,yt+=Qe*Re,yt+=et*At,yt+=je*Rt,yt+=Be*St,yt+=ke*(5*Lt),Ge=yt>>>13,yt&=8191,yt+=Fe*(5*Nt),yt+=qe*(5*xt),yt+=Ue*(5*Bt),yt+=He*(5*$t),yt+=ht*(5*Ct),Ge+=yt>>>13,yt&=8191,ot=Ge,ot+=Qe*Ct,ot+=et*Re,ot+=je*At,ot+=Be*Rt,ot+=ke*St,Ge=ot>>>13,ot&=8191,ot+=Fe*(5*Lt),ot+=qe*(5*Nt),ot+=Ue*(5*xt),ot+=He*(5*Bt),ot+=ht*(5*$t),Ge+=ot>>>13,ot&=8191,ct=Ge,ct+=Qe*$t,ct+=et*Ct,ct+=je*Re,ct+=Be*At,ct+=ke*Rt,Ge=ct>>>13,ct&=8191,ct+=Fe*St,ct+=qe*(5*Lt),ct+=Ue*(5*Nt),ct+=He*(5*xt),ct+=ht*(5*Bt),Ge+=ct>>>13,ct&=8191,at=Ge,at+=Qe*Bt,at+=et*$t,at+=je*Ct,at+=Be*Re,at+=ke*At,Ge=at>>>13,at&=8191,at+=Fe*Rt,at+=qe*St,at+=Ue*(5*Lt),at+=He*(5*Nt),at+=ht*(5*xt),Ge+=at>>>13,at&=8191,Ze=Ge,Ze+=Qe*xt,Ze+=et*Bt,Ze+=je*$t,Ze+=Be*Ct,Ze+=ke*Re,Ge=Ze>>>13,Ze&=8191,Ze+=Fe*At,Ze+=qe*Rt,Ze+=Ue*St,Ze+=He*(5*Lt),Ze+=ht*(5*Nt),Ge+=Ze>>>13,Ze&=8191,tt=Ge,tt+=Qe*Nt,tt+=et*xt,tt+=je*Bt,tt+=Be*$t,tt+=ke*Ct,Ge=tt>>>13,tt&=8191,tt+=Fe*Re,tt+=qe*At,tt+=Ue*Rt,tt+=He*St,tt+=ht*(5*Lt),Ge+=tt>>>13,tt&=8191,Ye=Ge,Ye+=Qe*Lt,Ye+=et*Nt,Ye+=je*xt,Ye+=Be*Bt,Ye+=ke*$t,Ge=Ye>>>13,Ye&=8191,Ye+=Fe*Ct,Ye+=qe*Re,Ye+=Ue*At,Ye+=He*Rt,Ye+=ht*St,Ge+=Ye>>>13,Ye&=8191,Ge=(Ge<<2)+Ge|0,Ge=Ge+nt|0,nt=Ge&8191,Ge=Ge>>>13,st+=Ge,Qe=nt,et=st,je=mt,Be=yt,ke=ot,Fe=ct,qe=at,Ue=Ze,He=tt,ht=Ye,fe+=16,ye-=16;this.h[0]=Qe,this.h[1]=et,this.h[2]=je,this.h[3]=Be,this.h[4]=ke,this.h[5]=Fe,this.h[6]=qe,this.h[7]=Ue,this.h[8]=He,this.h[9]=ht},j.prototype.finish=function(ie,fe){var ye=new Uint16Array(10),Q,ve,Te,Ie;if(this.leftover){for(Ie=this.leftover,this.buffer[Ie++]=1;Ie<16;Ie++)this.buffer[Ie]=0;this.fin=1,this.blocks(this.buffer,0,16)}for(Q=this.h[1]>>>13,this.h[1]&=8191,Ie=2;Ie<10;Ie++)this.h[Ie]+=Q,Q=this.h[Ie]>>>13,this.h[Ie]&=8191;for(this.h[0]+=Q*5,Q=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=Q,Q=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=Q,ye[0]=this.h[0]+5,Q=ye[0]>>>13,ye[0]&=8191,Ie=1;Ie<10;Ie++)ye[Ie]=this.h[Ie]+Q,Q=ye[Ie]>>>13,ye[Ie]&=8191;for(ye[9]-=8192,ve=(Q^1)-1,Ie=0;Ie<10;Ie++)ye[Ie]&=ve;for(ve=~ve,Ie=0;Ie<10;Ie++)this.h[Ie]=this.h[Ie]&ve|ye[Ie];for(this.h[0]=(this.h[0]|this.h[1]<<13)&65535,this.h[1]=(this.h[1]>>>3|this.h[2]<<10)&65535,this.h[2]=(this.h[2]>>>6|this.h[3]<<7)&65535,this.h[3]=(this.h[3]>>>9|this.h[4]<<4)&65535,this.h[4]=(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14)&65535,this.h[5]=(this.h[6]>>>2|this.h[7]<<11)&65535,this.h[6]=(this.h[7]>>>5|this.h[8]<<8)&65535,this.h[7]=(this.h[8]>>>8|this.h[9]<<5)&65535,Te=this.h[0]+this.pad[0],this.h[0]=Te&65535,Ie=1;Ie<8;Ie++)Te=(this.h[Ie]+this.pad[Ie]|0)+(Te>>>16)|0,this.h[Ie]=Te&65535;ie[fe+0]=this.h[0]>>>0&255,ie[fe+1]=this.h[0]>>>8&255,ie[fe+2]=this.h[1]>>>0&255,ie[fe+3]=this.h[1]>>>8&255,ie[fe+4]=this.h[2]>>>0&255,ie[fe+5]=this.h[2]>>>8&255,ie[fe+6]=this.h[3]>>>0&255,ie[fe+7]=this.h[3]>>>8&255,ie[fe+8]=this.h[4]>>>0&255,ie[fe+9]=this.h[4]>>>8&255,ie[fe+10]=this.h[5]>>>0&255,ie[fe+11]=this.h[5]>>>8&255,ie[fe+12]=this.h[6]>>>0&255,ie[fe+13]=this.h[6]>>>8&255,ie[fe+14]=this.h[7]>>>0&255,ie[fe+15]=this.h[7]>>>8&255},j.prototype.update=function(ie,fe,ye){var Q,ve;if(this.leftover){for(ve=16-this.leftover,ve>ye&&(ve=ye),Q=0;Q<ve;Q++)this.buffer[this.leftover+Q]=ie[fe+Q];if(ye-=ve,fe+=ve,this.leftover+=ve,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0}if(ye>=16&&(ve=ye-ye%16,this.blocks(ie,fe,ve),fe+=ve,ye-=ve),ye){for(Q=0;Q<ye;Q++)this.buffer[this.leftover+Q]=ie[fe+Q];this.leftover+=ye}};function M(ie,fe,ye,Q,ve,Te){var Ie=new j(Te);return Ie.update(ye,Q,ve),Ie.finish(ie,fe),0}function N(ie,fe,ye,Q,ve,Te){var Ie=new Uint8Array(16);return M(Ie,0,ye,Q,ve,Te),L(ie,fe,Ie,0)}function P(ie,fe,ye,Q,ve){var Te;if(ye<32)return-1;for(J(ie,0,fe,0,ye,Q,ve),M(ie,16,ie,32,ye-32,ie),Te=0;Te<16;Te++)ie[Te]=0;return 0}function O(ie,fe,ye,Q,ve){var Te,Ie=new Uint8Array(32);if(ye<32||(X(Ie,0,32,Q,ve),N(fe,16,fe,32,ye-32,Ie)!==0))return-1;for(J(ie,0,fe,0,ye,Q,ve),Te=0;Te<32;Te++)ie[Te]=0;return 0}function k(ie,fe){var ye;for(ye=0;ye<16;ye++)ie[ye]=fe[ye]|0}function q(ie){var fe,ye,Q=1;for(fe=0;fe<16;fe++)ye=ie[fe]+Q+65535,Q=Math.floor(ye/65536),ie[fe]=ye-Q*65536;ie[0]+=Q-1+37*(Q-1)}function F(ie,fe,ye){for(var Q,ve=~(ye-1),Te=0;Te<16;Te++)Q=ve&(ie[Te]^fe[Te]),ie[Te]^=Q,fe[Te]^=Q}function H(ie,fe){var ye,Q,ve,Te=h(),Ie=h();for(ye=0;ye<16;ye++)Ie[ye]=fe[ye];for(q(Ie),q(Ie),q(Ie),Q=0;Q<2;Q++){for(Te[0]=Ie[0]-65517,ye=1;ye<15;ye++)Te[ye]=Ie[ye]-65535-(Te[ye-1]>>16&1),Te[ye-1]&=65535;Te[15]=Ie[15]-32767-(Te[14]>>16&1),ve=Te[15]>>16&1,Te[14]&=65535,F(Ie,Te,1-ve)}for(ye=0;ye<16;ye++)ie[2*ye]=Ie[ye]&255,ie[2*ye+1]=Ie[ye]>>8}function D(ie,fe){var ye=new Uint8Array(32),Q=new Uint8Array(32);return H(ye,ie),H(Q,fe),$(ye,0,Q,0)}function G(ie){var fe=new Uint8Array(32);return H(fe,ie),fe[0]&1}function W(ie,fe){var ye;for(ye=0;ye<16;ye++)ie[ye]=fe[2*ye]+(fe[2*ye+1]<<8);ie[15]&=32767}function K(ie,fe,ye){for(var Q=0;Q<16;Q++)ie[Q]=fe[Q]+ye[Q]}function Z(ie,fe,ye){for(var Q=0;Q<16;Q++)ie[Q]=fe[Q]-ye[Q]}function ae(ie,fe,ye){var Q,ve,Te=0,Ie=0,$e=0,De=0,Ve=0,Ke=0,vt=0,Ge=0,nt=0,st=0,mt=0,yt=0,ot=0,ct=0,at=0,Ze=0,tt=0,Ye=0,Qe=0,et=0,je=0,Be=0,ke=0,Fe=0,qe=0,Ue=0,He=0,ht=0,St=0,Rt=0,At=0,Re=ye[0],Ct=ye[1],$t=ye[2],Bt=ye[3],xt=ye[4],Nt=ye[5],Lt=ye[6],Vt=ye[7],Ft=ye[8],Kt=ye[9],Wt=ye[10],Ht=ye[11],zt=ye[12],Gt=ye[13],jt=ye[14],Yt=ye[15];Q=fe[0],Te+=Q*Re,Ie+=Q*Ct,$e+=Q*$t,De+=Q*Bt,Ve+=Q*xt,Ke+=Q*Nt,vt+=Q*Lt,Ge+=Q*Vt,nt+=Q*Ft,st+=Q*Kt,mt+=Q*Wt,yt+=Q*Ht,ot+=Q*zt,ct+=Q*Gt,at+=Q*jt,Ze+=Q*Yt,Q=fe[1],Ie+=Q*Re,$e+=Q*Ct,De+=Q*$t,Ve+=Q*Bt,Ke+=Q*xt,vt+=Q*Nt,Ge+=Q*Lt,nt+=Q*Vt,st+=Q*Ft,mt+=Q*Kt,yt+=Q*Wt,ot+=Q*Ht,ct+=Q*zt,at+=Q*Gt,Ze+=Q*jt,tt+=Q*Yt,Q=fe[2],$e+=Q*Re,De+=Q*Ct,Ve+=Q*$t,Ke+=Q*Bt,vt+=Q*xt,Ge+=Q*Nt,nt+=Q*Lt,st+=Q*Vt,mt+=Q*Ft,yt+=Q*Kt,ot+=Q*Wt,ct+=Q*Ht,at+=Q*zt,Ze+=Q*Gt,tt+=Q*jt,Ye+=Q*Yt,Q=fe[3],De+=Q*Re,Ve+=Q*Ct,Ke+=Q*$t,vt+=Q*Bt,Ge+=Q*xt,nt+=Q*Nt,st+=Q*Lt,mt+=Q*Vt,yt+=Q*Ft,ot+=Q*Kt,ct+=Q*Wt,at+=Q*Ht,Ze+=Q*zt,tt+=Q*Gt,Ye+=Q*jt,Qe+=Q*Yt,Q=fe[4],Ve+=Q*Re,Ke+=Q*Ct,vt+=Q*$t,Ge+=Q*Bt,nt+=Q*xt,st+=Q*Nt,mt+=Q*Lt,yt+=Q*Vt,ot+=Q*Ft,ct+=Q*Kt,at+=Q*Wt,Ze+=Q*Ht,tt+=Q*zt,Ye+=Q*Gt,Qe+=Q*jt,et+=Q*Yt,Q=fe[5],Ke+=Q*Re,vt+=Q*Ct,Ge+=Q*$t,nt+=Q*Bt,st+=Q*xt,mt+=Q*Nt,yt+=Q*Lt,ot+=Q*Vt,ct+=Q*Ft,at+=Q*Kt,Ze+=Q*Wt,tt+=Q*Ht,Ye+=Q*zt,Qe+=Q*Gt,et+=Q*jt,je+=Q*Yt,Q=fe[6],vt+=Q*Re,Ge+=Q*Ct,nt+=Q*$t,st+=Q*Bt,mt+=Q*xt,yt+=Q*Nt,ot+=Q*Lt,ct+=Q*Vt,at+=Q*Ft,Ze+=Q*Kt,tt+=Q*Wt,Ye+=Q*Ht,Qe+=Q*zt,et+=Q*Gt,je+=Q*jt,Be+=Q*Yt,Q=fe[7],Ge+=Q*Re,nt+=Q*Ct,st+=Q*$t,mt+=Q*Bt,yt+=Q*xt,ot+=Q*Nt,ct+=Q*Lt,at+=Q*Vt,Ze+=Q*Ft,tt+=Q*Kt,Ye+=Q*Wt,Qe+=Q*Ht,et+=Q*zt,je+=Q*Gt,Be+=Q*jt,ke+=Q*Yt,Q=fe[8],nt+=Q*Re,st+=Q*Ct,mt+=Q*$t,yt+=Q*Bt,ot+=Q*xt,ct+=Q*Nt,at+=Q*Lt,Ze+=Q*Vt,tt+=Q*Ft,Ye+=Q*Kt,Qe+=Q*Wt,et+=Q*Ht,je+=Q*zt,Be+=Q*Gt,ke+=Q*jt,Fe+=Q*Yt,Q=fe[9],st+=Q*Re,mt+=Q*Ct,yt+=Q*$t,ot+=Q*Bt,ct+=Q*xt,at+=Q*Nt,Ze+=Q*Lt,tt+=Q*Vt,Ye+=Q*Ft,Qe+=Q*Kt,et+=Q*Wt,je+=Q*Ht,Be+=Q*zt,ke+=Q*Gt,Fe+=Q*jt,qe+=Q*Yt,Q=fe[10],mt+=Q*Re,yt+=Q*Ct,ot+=Q*$t,ct+=Q*Bt,at+=Q*xt,Ze+=Q*Nt,tt+=Q*Lt,Ye+=Q*Vt,Qe+=Q*Ft,et+=Q*Kt,je+=Q*Wt,Be+=Q*Ht,ke+=Q*zt,Fe+=Q*Gt,qe+=Q*jt,Ue+=Q*Yt,Q=fe[11],yt+=Q*Re,ot+=Q*Ct,ct+=Q*$t,at+=Q*Bt,Ze+=Q*xt,tt+=Q*Nt,Ye+=Q*Lt,Qe+=Q*Vt,et+=Q*Ft,je+=Q*Kt,Be+=Q*Wt,ke+=Q*Ht,Fe+=Q*zt,qe+=Q*Gt,Ue+=Q*jt,He+=Q*Yt,Q=fe[12],ot+=Q*Re,ct+=Q*Ct,at+=Q*$t,Ze+=Q*Bt,tt+=Q*xt,Ye+=Q*Nt,Qe+=Q*Lt,et+=Q*Vt,je+=Q*Ft,Be+=Q*Kt,ke+=Q*Wt,Fe+=Q*Ht,qe+=Q*zt,Ue+=Q*Gt,He+=Q*jt,ht+=Q*Yt,Q=fe[13],ct+=Q*Re,at+=Q*Ct,Ze+=Q*$t,tt+=Q*Bt,Ye+=Q*xt,Qe+=Q*Nt,et+=Q*Lt,je+=Q*Vt,Be+=Q*Ft,ke+=Q*Kt,Fe+=Q*Wt,qe+=Q*Ht,Ue+=Q*zt,He+=Q*Gt,ht+=Q*jt,St+=Q*Yt,Q=fe[14],at+=Q*Re,Ze+=Q*Ct,tt+=Q*$t,Ye+=Q*Bt,Qe+=Q*xt,et+=Q*Nt,je+=Q*Lt,Be+=Q*Vt,ke+=Q*Ft,Fe+=Q*Kt,qe+=Q*Wt,Ue+=Q*Ht,He+=Q*zt,ht+=Q*Gt,St+=Q*jt,Rt+=Q*Yt,Q=fe[15],Ze+=Q*Re,tt+=Q*Ct,Ye+=Q*$t,Qe+=Q*Bt,et+=Q*xt,je+=Q*Nt,Be+=Q*Lt,ke+=Q*Vt,Fe+=Q*Ft,qe+=Q*Kt,Ue+=Q*Wt,He+=Q*Ht,ht+=Q*zt,St+=Q*Gt,Rt+=Q*jt,At+=Q*Yt,Te+=38*tt,Ie+=38*Ye,$e+=38*Qe,De+=38*et,Ve+=38*je,Ke+=38*Be,vt+=38*ke,Ge+=38*Fe,nt+=38*qe,st+=38*Ue,mt+=38*He,yt+=38*ht,ot+=38*St,ct+=38*Rt,at+=38*At,ve=1,Q=Te+ve+65535,ve=Math.floor(Q/65536),Te=Q-ve*65536,Q=Ie+ve+65535,ve=Math.floor(Q/65536),Ie=Q-ve*65536,Q=$e+ve+65535,ve=Math.floor(Q/65536),$e=Q-ve*65536,Q=De+ve+65535,ve=Math.floor(Q/65536),De=Q-ve*65536,Q=Ve+ve+65535,ve=Math.floor(Q/65536),Ve=Q-ve*65536,Q=Ke+ve+65535,ve=Math.floor(Q/65536),Ke=Q-ve*65536,Q=vt+ve+65535,ve=Math.floor(Q/65536),vt=Q-ve*65536,Q=Ge+ve+65535,ve=Math.floor(Q/65536),Ge=Q-ve*65536,Q=nt+ve+65535,ve=Math.floor(Q/65536),nt=Q-ve*65536,Q=st+ve+65535,ve=Math.floor(Q/65536),st=Q-ve*65536,Q=mt+ve+65535,ve=Math.floor(Q/65536),mt=Q-ve*65536,Q=yt+ve+65535,ve=Math.floor(Q/65536),yt=Q-ve*65536,Q=ot+ve+65535,ve=Math.floor(Q/65536),ot=Q-ve*65536,Q=ct+ve+65535,ve=Math.floor(Q/65536),ct=Q-ve*65536,Q=at+ve+65535,ve=Math.floor(Q/65536),at=Q-ve*65536,Q=Ze+ve+65535,ve=Math.floor(Q/65536),Ze=Q-ve*65536,Te+=ve-1+37*(ve-1),ve=1,Q=Te+ve+65535,ve=Math.floor(Q/65536),Te=Q-ve*65536,Q=Ie+ve+65535,ve=Math.floor(Q/65536),Ie=Q-ve*65536,Q=$e+ve+65535,ve=Math.floor(Q/65536),$e=Q-ve*65536,Q=De+ve+65535,ve=Math.floor(Q/65536),De=Q-ve*65536,Q=Ve+ve+65535,ve=Math.floor(Q/65536),Ve=Q-ve*65536,Q=Ke+ve+65535,ve=Math.floor(Q/65536),Ke=Q-ve*65536,Q=vt+ve+65535,ve=Math.floor(Q/65536),vt=Q-ve*65536,Q=Ge+ve+65535,ve=Math.floor(Q/65536),Ge=Q-ve*65536,Q=nt+ve+65535,ve=Math.floor(Q/65536),nt=Q-ve*65536,Q=st+ve+65535,ve=Math.floor(Q/65536),st=Q-ve*65536,Q=mt+ve+65535,ve=Math.floor(Q/65536),mt=Q-ve*65536,Q=yt+ve+65535,ve=Math.floor(Q/65536),yt=Q-ve*65536,Q=ot+ve+65535,ve=Math.floor(Q/65536),ot=Q-ve*65536,Q=ct+ve+65535,ve=Math.floor(Q/65536),ct=Q-ve*65536,Q=at+ve+65535,ve=Math.floor(Q/65536),at=Q-ve*65536,Q=Ze+ve+65535,ve=Math.floor(Q/65536),Ze=Q-ve*65536,Te+=ve-1+37*(ve-1),ie[0]=Te,ie[1]=Ie,ie[2]=$e,ie[3]=De,ie[4]=Ve,ie[5]=Ke,ie[6]=vt,ie[7]=Ge,ie[8]=nt,ie[9]=st,ie[10]=mt,ie[11]=yt,ie[12]=ot,ie[13]=ct,ie[14]=at,ie[15]=Ze}function le(ie,fe){ae(ie,fe,fe)}function te(ie,fe){var ye=h(),Q;for(Q=0;Q<16;Q++)ye[Q]=fe[Q];for(Q=253;Q>=0;Q--)le(ye,ye),Q!==2&&Q!==4&&ae(ye,ye,fe);for(Q=0;Q<16;Q++)ie[Q]=ye[Q]}function ce(ie,fe){var ye=h(),Q;for(Q=0;Q<16;Q++)ye[Q]=fe[Q];for(Q=250;Q>=0;Q--)le(ye,ye),Q!==1&&ae(ye,ye,fe);for(Q=0;Q<16;Q++)ie[Q]=ye[Q]}function ge(ie,fe,ye){var Q=new Uint8Array(32),ve=new Float64Array(80),Te,Ie,$e=h(),De=h(),Ve=h(),Ke=h(),vt=h(),Ge=h();for(Ie=0;Ie<31;Ie++)Q[Ie]=fe[Ie];for(Q[31]=fe[31]&127|64,Q[0]&=248,W(ve,ye),Ie=0;Ie<16;Ie++)De[Ie]=ve[Ie],Ke[Ie]=$e[Ie]=Ve[Ie]=0;for($e[0]=Ke[0]=1,Ie=254;Ie>=0;--Ie)Te=Q[Ie>>>3]>>>(Ie&7)&1,F($e,De,Te),F(Ve,Ke,Te),K(vt,$e,Ve),Z($e,$e,Ve),K(Ve,De,Ke),Z(De,De,Ke),le(Ke,vt),le(Ge,$e),ae($e,Ve,$e),ae(Ve,De,vt),K(vt,$e,Ve),Z($e,$e,Ve),le(De,$e),Z(Ve,Ke,Ge),ae($e,Ve,_),K($e,$e,Ke),ae(Ve,Ve,$e),ae($e,Ke,Ge),ae(Ke,De,ve),le(De,vt),F($e,De,Te),F(Ve,Ke,Te);for(Ie=0;Ie<16;Ie++)ve[Ie+16]=$e[Ie],ve[Ie+32]=Ve[Ie],ve[Ie+48]=De[Ie],ve[Ie+64]=Ke[Ie];var nt=ve.subarray(32),st=ve.subarray(16);return te(nt,nt),ae(st,st,nt),H(ie,st),0}function Ee(ie,fe){return ge(ie,fe,b)}function pe(ie,fe){return y(fe,32),Ee(ie,fe)}function de(ie,fe,ye){var Q=new Uint8Array(32);return ge(Q,ye,fe),ne(ie,v,Q,ue)}var me=P,_e=O;function Ae(ie,fe,ye,Q,ve,Te){var Ie=new Uint8Array(32);return de(Ie,ve,Te),me(ie,fe,ye,Q,Ie)}function Pe(ie,fe,ye,Q,ve,Te){var Ie=new Uint8Array(32);return de(Ie,ve,Te),_e(ie,fe,ye,Q,Ie)}var Me=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function Ne(ie,fe,ye,Q){for(var ve=new Int32Array(16),Te=new Int32Array(16),Ie,$e,De,Ve,Ke,vt,Ge,nt,st,mt,yt,ot,ct,at,Ze,tt,Ye,Qe,et,je,Be,ke,Fe,qe,Ue,He,ht=ie[0],St=ie[1],Rt=ie[2],At=ie[3],Re=ie[4],Ct=ie[5],$t=ie[6],Bt=ie[7],xt=fe[0],Nt=fe[1],Lt=fe[2],Vt=fe[3],Ft=fe[4],Kt=fe[5],Wt=fe[6],Ht=fe[7],zt=0;Q>=128;){for(et=0;et<16;et++)je=8*et+zt,ve[et]=ye[je+0]<<24|ye[je+1]<<16|ye[je+2]<<8|ye[je+3],Te[et]=ye[je+4]<<24|ye[je+5]<<16|ye[je+6]<<8|ye[je+7];for(et=0;et<80;et++)if(Ie=ht,$e=St,De=Rt,Ve=At,Ke=Re,vt=Ct,Ge=$t,nt=Bt,st=xt,mt=Nt,yt=Lt,ot=Vt,ct=Ft,at=Kt,Ze=Wt,tt=Ht,Be=Bt,ke=Ht,Fe=ke&65535,qe=ke>>>16,Ue=Be&65535,He=Be>>>16,Be=(Re>>>14|Ft<<18)^(Re>>>18|Ft<<14)^(Ft>>>9|Re<<23),ke=(Ft>>>14|Re<<18)^(Ft>>>18|Re<<14)^(Re>>>9|Ft<<23),Fe+=ke&65535,qe+=ke>>>16,Ue+=Be&65535,He+=Be>>>16,Be=Re&Ct^~Re&$t,ke=Ft&Kt^~Ft&Wt,Fe+=ke&65535,qe+=ke>>>16,Ue+=Be&65535,He+=Be>>>16,Be=Me[et*2],ke=Me[et*2+1],Fe+=ke&65535,qe+=ke>>>16,Ue+=Be&65535,He+=Be>>>16,Be=ve[et%16],ke=Te[et%16],Fe+=ke&65535,qe+=ke>>>16,Ue+=Be&65535,He+=Be>>>16,qe+=Fe>>>16,Ue+=qe>>>16,He+=Ue>>>16,Ye=Ue&65535|He<<16,Qe=Fe&65535|qe<<16,Be=Ye,ke=Qe,Fe=ke&65535,qe=ke>>>16,Ue=Be&65535,He=Be>>>16,Be=(ht>>>28|xt<<4)^(xt>>>2|ht<<30)^(xt>>>7|ht<<25),ke=(xt>>>28|ht<<4)^(ht>>>2|xt<<30)^(ht>>>7|xt<<25),Fe+=ke&65535,qe+=ke>>>16,Ue+=Be&65535,He+=Be>>>16,Be=ht&St^ht&Rt^St&Rt,ke=xt&Nt^xt&Lt^Nt&Lt,Fe+=ke&65535,qe+=ke>>>16,Ue+=Be&65535,He+=Be>>>16,qe+=Fe>>>16,Ue+=qe>>>16,He+=Ue>>>16,nt=Ue&65535|He<<16,tt=Fe&65535|qe<<16,Be=Ve,ke=ot,Fe=ke&65535,qe=ke>>>16,Ue=Be&65535,He=Be>>>16,Be=Ye,ke=Qe,Fe+=ke&65535,qe+=ke>>>16,Ue+=Be&65535,He+=Be>>>16,qe+=Fe>>>16,Ue+=qe>>>16,He+=Ue>>>16,Ve=Ue&65535|He<<16,ot=Fe&65535|qe<<16,St=Ie,Rt=$e,At=De,Re=Ve,Ct=Ke,$t=vt,Bt=Ge,ht=nt,Nt=st,Lt=mt,Vt=yt,Ft=ot,Kt=ct,Wt=at,Ht=Ze,xt=tt,et%16===15)for(je=0;je<16;je++)Be=ve[je],ke=Te[je],Fe=ke&65535,qe=ke>>>16,Ue=Be&65535,He=Be>>>16,Be=ve[(je+9)%16],ke=Te[(je+9)%16],Fe+=ke&65535,qe+=ke>>>16,Ue+=Be&65535,He+=Be>>>16,Ye=ve[(je+1)%16],Qe=Te[(je+1)%16],Be=(Ye>>>1|Qe<<31)^(Ye>>>8|Qe<<24)^Ye>>>7,ke=(Qe>>>1|Ye<<31)^(Qe>>>8|Ye<<24)^(Qe>>>7|Ye<<25),Fe+=ke&65535,qe+=ke>>>16,Ue+=Be&65535,He+=Be>>>16,Ye=ve[(je+14)%16],Qe=Te[(je+14)%16],Be=(Ye>>>19|Qe<<13)^(Qe>>>29|Ye<<3)^Ye>>>6,ke=(Qe>>>19|Ye<<13)^(Ye>>>29|Qe<<3)^(Qe>>>6|Ye<<26),Fe+=ke&65535,qe+=ke>>>16,Ue+=Be&65535,He+=Be>>>16,qe+=Fe>>>16,Ue+=qe>>>16,He+=Ue>>>16,ve[je]=Ue&65535|He<<16,Te[je]=Fe&65535|qe<<16;Be=ht,ke=xt,Fe=ke&65535,qe=ke>>>16,Ue=Be&65535,He=Be>>>16,Be=ie[0],ke=fe[0],Fe+=ke&65535,qe+=ke>>>16,Ue+=Be&65535,He+=Be>>>16,qe+=Fe>>>16,Ue+=qe>>>16,He+=Ue>>>16,ie[0]=ht=Ue&65535|He<<16,fe[0]=xt=Fe&65535|qe<<16,Be=St,ke=Nt,Fe=ke&65535,qe=ke>>>16,Ue=Be&65535,He=Be>>>16,Be=ie[1],ke=fe[1],Fe+=ke&65535,qe+=ke>>>16,Ue+=Be&65535,He+=Be>>>16,qe+=Fe>>>16,Ue+=qe>>>16,He+=Ue>>>16,ie[1]=St=Ue&65535|He<<16,fe[1]=Nt=Fe&65535|qe<<16,Be=Rt,ke=Lt,Fe=ke&65535,qe=ke>>>16,Ue=Be&65535,He=Be>>>16,Be=ie[2],ke=fe[2],Fe+=ke&65535,qe+=ke>>>16,Ue+=Be&65535,He+=Be>>>16,qe+=Fe>>>16,Ue+=qe>>>16,He+=Ue>>>16,ie[2]=Rt=Ue&65535|He<<16,fe[2]=Lt=Fe&65535|qe<<16,Be=At,ke=Vt,Fe=ke&65535,qe=ke>>>16,Ue=Be&65535,He=Be>>>16,Be=ie[3],ke=fe[3],Fe+=ke&65535,qe+=ke>>>16,Ue+=Be&65535,He+=Be>>>16,qe+=Fe>>>16,Ue+=qe>>>16,He+=Ue>>>16,ie[3]=At=Ue&65535|He<<16,fe[3]=Vt=Fe&65535|qe<<16,Be=Re,ke=Ft,Fe=ke&65535,qe=ke>>>16,Ue=Be&65535,He=Be>>>16,Be=ie[4],ke=fe[4],Fe+=ke&65535,qe+=ke>>>16,Ue+=Be&65535,He+=Be>>>16,qe+=Fe>>>16,Ue+=qe>>>16,He+=Ue>>>16,ie[4]=Re=Ue&65535|He<<16,fe[4]=Ft=Fe&65535|qe<<16,Be=Ct,ke=Kt,Fe=ke&65535,qe=ke>>>16,Ue=Be&65535,He=Be>>>16,Be=ie[5],ke=fe[5],Fe+=ke&65535,qe+=ke>>>16,Ue+=Be&65535,He+=Be>>>16,qe+=Fe>>>16,Ue+=qe>>>16,He+=Ue>>>16,ie[5]=Ct=Ue&65535|He<<16,fe[5]=Kt=Fe&65535|qe<<16,Be=$t,ke=Wt,Fe=ke&65535,qe=ke>>>16,Ue=Be&65535,He=Be>>>16,Be=ie[6],ke=fe[6],Fe+=ke&65535,qe+=ke>>>16,Ue+=Be&65535,He+=Be>>>16,qe+=Fe>>>16,Ue+=qe>>>16,He+=Ue>>>16,ie[6]=$t=Ue&65535|He<<16,fe[6]=Wt=Fe&65535|qe<<16,Be=Bt,ke=Ht,Fe=ke&65535,qe=ke>>>16,Ue=Be&65535,He=Be>>>16,Be=ie[7],ke=fe[7],Fe+=ke&65535,qe+=ke>>>16,Ue+=Be&65535,He+=Be>>>16,qe+=Fe>>>16,Ue+=qe>>>16,He+=Ue>>>16,ie[7]=Bt=Ue&65535|He<<16,fe[7]=Ht=Fe&65535|qe<<16,zt+=128,Q-=128}return Q}function we(ie,fe,ye){var Q=new Int32Array(8),ve=new Int32Array(8),Te=new Uint8Array(256),Ie,$e=ye;for(Q[0]=1779033703,Q[1]=3144134277,Q[2]=1013904242,Q[3]=2773480762,Q[4]=1359893119,Q[5]=2600822924,Q[6]=528734635,Q[7]=1541459225,ve[0]=4089235720,ve[1]=2227873595,ve[2]=4271175723,ve[3]=1595750129,ve[4]=2917565137,ve[5]=725511199,ve[6]=4215389547,ve[7]=327033209,Ne(Q,ve,fe,ye),ye%=128,Ie=0;Ie<ye;Ie++)Te[Ie]=fe[$e-ye+Ie];for(Te[ye]=128,ye=256-128*(ye<112?1:0),Te[ye-9]=0,C(Te,ye-8,$e/536870912|0,$e<<3),Ne(Q,ve,Te,ye),Ie=0;Ie<8;Ie++)C(ie,8*Ie,Q[Ie],ve[Ie]);return 0}function Le(ie,fe){var ye=h(),Q=h(),ve=h(),Te=h(),Ie=h(),$e=h(),De=h(),Ve=h(),Ke=h();Z(ye,ie[1],ie[0]),Z(Ke,fe[1],fe[0]),ae(ye,ye,Ke),K(Q,ie[0],ie[1]),K(Ke,fe[0],fe[1]),ae(Q,Q,Ke),ae(ve,ie[3],fe[3]),ae(ve,ve,A),ae(Te,ie[2],fe[2]),K(Te,Te,Te),Z(Ie,Q,ye),Z($e,Te,ve),K(De,Te,ve),K(Ve,Q,ye),ae(ie[0],Ie,$e),ae(ie[1],Ve,De),ae(ie[2],De,$e),ae(ie[3],Ie,Ve)}function Oe(ie,fe,ye){var Q;for(Q=0;Q<4;Q++)F(ie[Q],fe[Q],ye)}function Ce(ie,fe){var ye=h(),Q=h(),ve=h();te(ve,fe[2]),ae(ye,fe[0],ve),ae(Q,fe[1],ve),H(ie,Q),ie[31]^=G(ye)<<7}function We(ie,fe,ye){var Q,ve;for(k(ie[0],w),k(ie[1],E),k(ie[2],E),k(ie[3],w),ve=255;ve>=0;--ve)Q=ye[ve/8|0]>>(ve&7)&1,Oe(ie,fe,Q),Le(fe,ie),Le(ie,ie),Oe(ie,fe,Q)}function ze(ie,fe){var ye=[h(),h(),h(),h()];k(ye[0],R),k(ye[1],x),k(ye[2],E),ae(ye[3],R,x),We(ie,ye,fe)}function Xe(ie,fe,ye){var Q=new Uint8Array(64),ve=[h(),h(),h(),h()],Te;for(ye||y(fe,32),we(Q,fe,32),Q[0]&=248,Q[31]&=127,Q[31]|=64,ze(ve,Q),Ce(ie,ve),Te=0;Te<32;Te++)fe[Te+32]=ie[Te];return 0}var it=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function Je(ie,fe){var ye,Q,ve,Te;for(Q=63;Q>=32;--Q){for(ye=0,ve=Q-32,Te=Q-12;ve<Te;++ve)fe[ve]+=ye-16*fe[Q]*it[ve-(Q-32)],ye=Math.floor((fe[ve]+128)/256),fe[ve]-=ye*256;fe[ve]+=ye,fe[Q]=0}for(ye=0,ve=0;ve<32;ve++)fe[ve]+=ye-(fe[31]>>4)*it[ve],ye=fe[ve]>>8,fe[ve]&=255;for(ve=0;ve<32;ve++)fe[ve]-=ye*it[ve];for(Q=0;Q<32;Q++)fe[Q+1]+=fe[Q]>>8,ie[Q]=fe[Q]&255}function bt(ie){var fe=new Float64Array(64),ye;for(ye=0;ye<64;ye++)fe[ye]=ie[ye];for(ye=0;ye<64;ye++)ie[ye]=0;Je(ie,fe)}function Et(ie,fe,ye,Q){var ve=new Uint8Array(64),Te=new Uint8Array(64),Ie=new Uint8Array(64),$e,De,Ve=new Float64Array(64),Ke=[h(),h(),h(),h()];we(ve,Q,32),ve[0]&=248,ve[31]&=127,ve[31]|=64;var vt=ye+64;for($e=0;$e<ye;$e++)ie[64+$e]=fe[$e];for($e=0;$e<32;$e++)ie[32+$e]=ve[32+$e];for(we(Ie,ie.subarray(32),ye+32),bt(Ie),ze(Ke,Ie),Ce(ie,Ke),$e=32;$e<64;$e++)ie[$e]=Q[$e];for(we(Te,ie,ye+64),bt(Te),$e=0;$e<64;$e++)Ve[$e]=0;for($e=0;$e<32;$e++)Ve[$e]=Ie[$e];for($e=0;$e<32;$e++)for(De=0;De<32;De++)Ve[$e+De]+=Te[$e]*ve[De];return Je(ie.subarray(32),Ve),vt}function lt(ie,fe){var ye=h(),Q=h(),ve=h(),Te=h(),Ie=h(),$e=h(),De=h();return k(ie[2],E),W(ie[1],fe),le(ve,ie[1]),ae(Te,ve,S),Z(ve,ve,ie[2]),K(Te,ie[2],Te),le(Ie,Te),le($e,Ie),ae(De,$e,Ie),ae(ye,De,ve),ae(ye,ye,Te),ce(ye,ye),ae(ye,ye,ve),ae(ye,ye,Te),ae(ye,ye,Te),ae(ie[0],ye,Te),le(Q,ie[0]),ae(Q,Q,Te),D(Q,ve)&&ae(ie[0],ie[0],T),le(Q,ie[0]),ae(Q,Q,Te),D(Q,ve)?-1:(G(ie[0])===fe[31]>>7&&Z(ie[0],w,ie[0]),ae(ie[3],ie[0],ie[1]),0)}function wt(ie,fe,ye,Q){var ve,Te=new Uint8Array(32),Ie=new Uint8Array(64),$e=[h(),h(),h(),h()],De=[h(),h(),h(),h()];if(ye<64||lt(De,Q))return-1;for(ve=0;ve<ye;ve++)ie[ve]=fe[ve];for(ve=0;ve<32;ve++)ie[ve+32]=Q[ve];if(we(Ie,ie,ye),bt(Ie),We($e,De,Ie),ze(De,fe.subarray(32)),Le($e,De),Ce(Te,$e),ye-=64,$(fe,0,Te,0)){for(ve=0;ve<ye;ve++)ie[ve]=0;return-1}for(ve=0;ve<ye;ve++)ie[ve]=fe[ve+64];return ye}var qt=32,pt=24,Tt=32,Pt=16,gt=32,kt=32,Mt=32,ft=32,Ut=32,Dt=pt,dt=Tt,Ot=Pt,It=64,rt=32,_t=64,Se=32,se=64;u.lowlevel={crypto_core_hsalsa20:ne,crypto_stream_xor:J,crypto_stream:X,crypto_stream_salsa20_xor:he,crypto_stream_salsa20:Y,crypto_onetimeauth:M,crypto_onetimeauth_verify:N,crypto_verify_16:L,crypto_verify_32:$,crypto_secretbox:P,crypto_secretbox_open:O,crypto_scalarmult:ge,crypto_scalarmult_base:Ee,crypto_box_beforenm:de,crypto_box_afternm:me,crypto_box:Ae,crypto_box_open:Pe,crypto_box_keypair:pe,crypto_hash:we,crypto_sign:Et,crypto_sign_keypair:Xe,crypto_sign_open:wt,crypto_secretbox_KEYBYTES:qt,crypto_secretbox_NONCEBYTES:pt,crypto_secretbox_ZEROBYTES:Tt,crypto_secretbox_BOXZEROBYTES:Pt,crypto_scalarmult_BYTES:gt,crypto_scalarmult_SCALARBYTES:kt,crypto_box_PUBLICKEYBYTES:Mt,crypto_box_SECRETKEYBYTES:ft,crypto_box_BEFORENMBYTES:Ut,crypto_box_NONCEBYTES:Dt,crypto_box_ZEROBYTES:dt,crypto_box_BOXZEROBYTES:Ot,crypto_sign_BYTES:It,crypto_sign_PUBLICKEYBYTES:rt,crypto_sign_SECRETKEYBYTES:_t,crypto_sign_SEEDBYTES:Se,crypto_hash_BYTES:se,gf:h,D:S,L:it,pack:Ce,pack25519:H,unpack25519:W,M:ae,A:K,S:le,Z,pow2523:ce,add:Le,set25519:k,modL:Je,scalarmult:We,scalarbase:ze};function ee(ie,fe){if(ie.length!==qt)throw new Error("bad key size");if(fe.length!==pt)throw new Error("bad nonce size")}function oe(ie,fe){if(ie.length!==Mt)throw new Error("bad public key size");if(fe.length!==ft)throw new Error("bad secret key size")}function be(){for(var ie=0;ie<arguments.length;ie++)if(!(arguments[ie]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function xe(ie){for(var fe=0;fe<ie.length;fe++)ie[fe]=0}u.randomBytes=function(ie){var fe=new Uint8Array(ie);return y(fe,ie),fe},u.secretbox=function(ie,fe,ye){be(ie,fe,ye),ee(ye,fe);for(var Q=new Uint8Array(Tt+ie.length),ve=new Uint8Array(Q.length),Te=0;Te<ie.length;Te++)Q[Te+Tt]=ie[Te];return P(ve,Q,Q.length,fe,ye),ve.subarray(Pt)},u.secretbox.open=function(ie,fe,ye){be(ie,fe,ye),ee(ye,fe);for(var Q=new Uint8Array(Pt+ie.length),ve=new Uint8Array(Q.length),Te=0;Te<ie.length;Te++)Q[Te+Pt]=ie[Te];return Q.length<32||O(ve,Q,Q.length,fe,ye)!==0?null:ve.subarray(Tt)},u.secretbox.keyLength=qt,u.secretbox.nonceLength=pt,u.secretbox.overheadLength=Pt,u.scalarMult=function(ie,fe){if(be(ie,fe),ie.length!==kt)throw new Error("bad n size");if(fe.length!==gt)throw new Error("bad p size");var ye=new Uint8Array(gt);return ge(ye,ie,fe),ye},u.scalarMult.base=function(ie){if(be(ie),ie.length!==kt)throw new Error("bad n size");var fe=new Uint8Array(gt);return Ee(fe,ie),fe},u.scalarMult.scalarLength=kt,u.scalarMult.groupElementLength=gt,u.box=function(ie,fe,ye,Q){var ve=u.box.before(ye,Q);return u.secretbox(ie,fe,ve)},u.box.before=function(ie,fe){be(ie,fe),oe(ie,fe);var ye=new Uint8Array(Ut);return de(ye,ie,fe),ye},u.box.after=u.secretbox,u.box.open=function(ie,fe,ye,Q){var ve=u.box.before(ye,Q);return u.secretbox.open(ie,fe,ve)},u.box.open.after=u.secretbox.open,u.box.keyPair=function(){var ie=new Uint8Array(Mt),fe=new Uint8Array(ft);return pe(ie,fe),{publicKey:ie,secretKey:fe}},u.box.keyPair.fromSecretKey=function(ie){if(be(ie),ie.length!==ft)throw new Error("bad secret key size");var fe=new Uint8Array(Mt);return Ee(fe,ie),{publicKey:fe,secretKey:new Uint8Array(ie)}},u.box.publicKeyLength=Mt,u.box.secretKeyLength=ft,u.box.sharedKeyLength=Ut,u.box.nonceLength=Dt,u.box.overheadLength=u.secretbox.overheadLength,u.sign=function(ie,fe){if(be(ie,fe),fe.length!==_t)throw new Error("bad secret key size");var ye=new Uint8Array(It+ie.length);return Et(ye,ie,ie.length,fe),ye},u.sign.open=function(ie,fe){if(be(ie,fe),fe.length!==rt)throw new Error("bad public key size");var ye=new Uint8Array(ie.length),Q=wt(ye,ie,ie.length,fe);if(Q<0)return null;for(var ve=new Uint8Array(Q),Te=0;Te<ve.length;Te++)ve[Te]=ye[Te];return ve},u.sign.detached=function(ie,fe){for(var ye=u.sign(ie,fe),Q=new Uint8Array(It),ve=0;ve<Q.length;ve++)Q[ve]=ye[ve];return Q},u.sign.detached.verify=function(ie,fe,ye){if(be(ie,fe,ye),fe.length!==It)throw new Error("bad signature size");if(ye.length!==rt)throw new Error("bad public key size");var Q=new Uint8Array(It+ie.length),ve=new Uint8Array(It+ie.length),Te;for(Te=0;Te<It;Te++)Q[Te]=fe[Te];for(Te=0;Te<ie.length;Te++)Q[Te+It]=ie[Te];return wt(ve,Q,Q.length,ye)>=0},u.sign.keyPair=function(){var ie=new Uint8Array(rt),fe=new Uint8Array(_t);return Xe(ie,fe),{publicKey:ie,secretKey:fe}},u.sign.keyPair.fromSecretKey=function(ie){if(be(ie),ie.length!==_t)throw new Error("bad secret key size");for(var fe=new Uint8Array(rt),ye=0;ye<fe.length;ye++)fe[ye]=ie[32+ye];return{publicKey:fe,secretKey:new Uint8Array(ie)}},u.sign.keyPair.fromSeed=function(ie){if(be(ie),ie.length!==Se)throw new Error("bad seed size");for(var fe=new Uint8Array(rt),ye=new Uint8Array(_t),Q=0;Q<32;Q++)ye[Q]=ie[Q];return Xe(fe,ye,!0),{publicKey:fe,secretKey:ye}},u.sign.publicKeyLength=rt,u.sign.secretKeyLength=_t,u.sign.seedLength=Se,u.sign.signatureLength=It,u.hash=function(ie){be(ie);var fe=new Uint8Array(se);return we(fe,ie,ie.length),fe},u.hash.hashLength=se,u.verify=function(ie,fe){return be(ie,fe),ie.length===0||fe.length===0||ie.length!==fe.length?!1:I(ie,0,fe,0,ie.length)===0},u.setPRNG=function(ie){y=ie},(function(){var ie=typeof self<"u"?self.crypto||self.msCrypto:null;if(ie&&ie.getRandomValues){var fe=65536;u.setPRNG(function(ye,Q){var ve,Te=new Uint8Array(Q);for(ve=0;ve<Q;ve+=fe)ie.getRandomValues(Te.subarray(ve,ve+Math.min(Q-ve,fe)));for(ve=0;ve<Q;ve++)ye[ve]=Te[ve];xe(Te)})}else typeof commonjsRequire<"u"&&(ie=requireCryptoBrowserify(),ie&&ie.randomBytes&&u.setPRNG(function(ye,Q){var ve,Te=ie.randomBytes(Q);for(ve=0;ve<Q;ve++)ye[ve]=Te[ve];xe(Te)}))})()})(g.exports?g.exports:self.nacl=self.nacl||{})})(naclFast)),naclFast.exports}var naclFastExports=requireNaclFast();const nacl=getDefaultExportFromCjs(naclFastExports),l=nacl.lowlevel;function getED25519Key(g){let u;typeof g=="string"?u=Buffer.from(g,"hex"):u=g;const h=new Uint8Array(64),y=[l.gf(),l.gf(),l.gf(),l.gf()],v=new Uint8Array([...new Uint8Array(u),...new Uint8Array(32)]),b=new Uint8Array(32);l.crypto_hash(h,v,32),h[0]&=248,h[31]&=127,h[31]|=64,l.scalarbase(y,h),l.pack(b,y);for(let w=0;w<32;w+=1)v[w+32]=b[w];return{sk:Buffer.from(v),pk:Buffer.from(b)}}var browser={exports:{}},stream={exports:{}},primordials,hasRequiredPrimordials;function requirePrimordials(){if(hasRequiredPrimordials)return primordials;hasRequiredPrimordials=1;class g extends Error{constructor(h){if(!Array.isArray(h))throw new TypeError(`Expected input to be an Array, got ${typeof h}`);let y="";for(let v=0;v<h.length;v++)y+=`    ${h[v].stack}
`;super(y),this.name="AggregateError",this.errors=h}}return primordials={AggregateError:g,ArrayIsArray(u){return Array.isArray(u)},ArrayPrototypeIncludes(u,h){return u.includes(h)},ArrayPrototypeIndexOf(u,h){return u.indexOf(h)},ArrayPrototypeJoin(u,h){return u.join(h)},ArrayPrototypeMap(u,h){return u.map(h)},ArrayPrototypePop(u,h){return u.pop(h)},ArrayPrototypePush(u,h){return u.push(h)},ArrayPrototypeSlice(u,h,y){return u.slice(h,y)},Error,FunctionPrototypeCall(u,h,...y){return u.call(h,...y)},FunctionPrototypeSymbolHasInstance(u,h){return Function.prototype[Symbol.hasInstance].call(u,h)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(u,h){return Object.defineProperties(u,h)},ObjectDefineProperty(u,h,y){return Object.defineProperty(u,h,y)},ObjectGetOwnPropertyDescriptor(u,h){return Object.getOwnPropertyDescriptor(u,h)},ObjectKeys(u){return Object.keys(u)},ObjectSetPrototypeOf(u,h){return Object.setPrototypeOf(u,h)},Promise,PromisePrototypeCatch(u,h){return u.catch(h)},PromisePrototypeThen(u,h,y){return u.then(h,y)},PromiseReject(u){return Promise.reject(u)},PromiseResolve(u){return Promise.resolve(u)},ReflectApply:Reflect.apply,RegExpPrototypeTest(u,h){return u.test(h)},SafeSet:Set,String,StringPrototypeSlice(u,h,y){return u.slice(h,y)},StringPrototypeToLowerCase(u){return u.toLowerCase()},StringPrototypeToUpperCase(u){return u.toUpperCase()},StringPrototypeTrim(u){return u.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,SymbolDispose:Symbol.dispose||Symbol("Symbol.dispose"),SymbolAsyncDispose:Symbol.asyncDispose||Symbol("Symbol.asyncDispose"),TypedArrayPrototypeSet(u,h,y){return u.set(h,y)},Boolean,Uint8Array},primordials}var util={exports:{}},inspect,hasRequiredInspect;function requireInspect(){return hasRequiredInspect||(hasRequiredInspect=1,inspect={format(g,...u){return g.replace(/%([sdifj])/g,function(...[h,y]){const v=u.shift();return y==="f"?v.toFixed(6):y==="j"?JSON.stringify(v):y==="s"&&typeof v=="object"?`${v.constructor!==Object?v.constructor.name:""} {}`.trim():v.toString()})},inspect(g){switch(typeof g){case"string":if(g.includes("'"))if(g.includes('"')){if(!g.includes("`")&&!g.includes("${"))return`\`${g}\``}else return`"${g}"`;return`'${g}'`;case"number":return isNaN(g)?"NaN":Object.is(g,-0)?String(g):g;case"bigint":return`${String(g)}n`;case"boolean":case"undefined":return String(g);case"object":return"{}"}}}),inspect}var errors,hasRequiredErrors;function requireErrors(){if(hasRequiredErrors)return errors;hasRequiredErrors=1;const{format:g,inspect:u}=requireInspect(),{AggregateError:h}=requirePrimordials(),y=globalThis.AggregateError||h,v=Symbol("kIsNodeError"),b=["string","function","number","object","Function","Object","boolean","bigint","symbol"],w=/^([A-Z][a-z0-9]*)+$/,E="__node_internal_",_={};function S(L,$){if(!L)throw new _.ERR_INTERNAL_ASSERTION($)}function A(L){let $="",B=L.length;const U=L[0]==="-"?1:0;for(;B>=U+4;B-=3)$=`_${L.slice(B-3,B)}${$}`;return`${L.slice(0,B)}${$}`}function R(L,$,B){if(typeof $=="function")return S($.length<=B.length,`Code: ${L}; The provided arguments length (${B.length}) does not match the required ones (${$.length}).`),$(...B);const U=($.match(/%[dfijoOs]/g)||[]).length;return S(U===B.length,`Code: ${L}; The provided arguments length (${B.length}) does not match the required ones (${U}).`),B.length===0?$:g($,...B)}function x(L,$,B){B||(B=Error);class U extends B{constructor(...ne){super(R(L,$,ne))}toString(){return`${this.name} [${L}]: ${this.message}`}}Object.defineProperties(U.prototype,{name:{value:B.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${L}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),U.prototype.code=L,U.prototype[v]=!0,_[L]=U}function T(L){const $=E+L.name;return Object.defineProperty(L,"name",{value:$}),L}function C(L,$){if(L&&$&&L!==$){if(Array.isArray($.errors))return $.errors.push(L),$;const B=new y([$,L],$.message);return B.code=$.code,B}return L||$}class I extends Error{constructor($="The operation was aborted",B=void 0){if(B!==void 0&&typeof B!="object")throw new _.ERR_INVALID_ARG_TYPE("options","Object",B);super($,B),this.code="ABORT_ERR",this.name="AbortError"}}return x("ERR_ASSERTION","%s",Error),x("ERR_INVALID_ARG_TYPE",(L,$,B)=>{S(typeof L=="string","'name' must be a string"),Array.isArray($)||($=[$]);let U="The ";L.endsWith(" argument")?U+=`${L} `:U+=`"${L}" ${L.includes(".")?"property":"argument"} `,U+="must be ";const z=[],ne=[],ue=[];for(const Y of $)S(typeof Y=="string","All expected entries have to be of type string"),b.includes(Y)?z.push(Y.toLowerCase()):w.test(Y)?ne.push(Y):(S(Y!=="object",'The value "object" should be written as "Object"'),ue.push(Y));if(ne.length>0){const Y=z.indexOf("object");Y!==-1&&(z.splice(z,Y,1),ne.push("Object"))}if(z.length>0){switch(z.length){case 1:U+=`of type ${z[0]}`;break;case 2:U+=`one of type ${z[0]} or ${z[1]}`;break;default:{const Y=z.pop();U+=`one of type ${z.join(", ")}, or ${Y}`}}(ne.length>0||ue.length>0)&&(U+=" or ")}if(ne.length>0){switch(ne.length){case 1:U+=`an instance of ${ne[0]}`;break;case 2:U+=`an instance of ${ne[0]} or ${ne[1]}`;break;default:{const Y=ne.pop();U+=`an instance of ${ne.join(", ")}, or ${Y}`}}ue.length>0&&(U+=" or ")}switch(ue.length){case 0:break;case 1:ue[0].toLowerCase()!==ue[0]&&(U+="an "),U+=`${ue[0]}`;break;case 2:U+=`one of ${ue[0]} or ${ue[1]}`;break;default:{const Y=ue.pop();U+=`one of ${ue.join(", ")}, or ${Y}`}}if(B==null)U+=`. Received ${B}`;else if(typeof B=="function"&&B.name)U+=`. Received function ${B.name}`;else if(typeof B=="object"){var he;if((he=B.constructor)!==null&&he!==void 0&&he.name)U+=`. Received an instance of ${B.constructor.name}`;else{const Y=u(B,{depth:-1});U+=`. Received ${Y}`}}else{let Y=u(B,{colors:!1});Y.length>25&&(Y=`${Y.slice(0,25)}...`),U+=`. Received type ${typeof B} (${Y})`}return U},TypeError),x("ERR_INVALID_ARG_VALUE",(L,$,B="is invalid")=>{let U=u($);return U.length>128&&(U=U.slice(0,128)+"..."),`The ${L.includes(".")?"property":"argument"} '${L}' ${B}. Received ${U}`},TypeError),x("ERR_INVALID_RETURN_VALUE",(L,$,B)=>{var U;const z=B!=null&&(U=B.constructor)!==null&&U!==void 0&&U.name?`instance of ${B.constructor.name}`:`type ${typeof B}`;return`Expected ${L} to be returned from the "${$}" function but got ${z}.`},TypeError),x("ERR_MISSING_ARGS",(...L)=>{S(L.length>0,"At least one arg needs to be specified");let $;const B=L.length;switch(L=(Array.isArray(L)?L:[L]).map(U=>`"${U}"`).join(" or "),B){case 1:$+=`The ${L[0]} argument`;break;case 2:$+=`The ${L[0]} and ${L[1]} arguments`;break;default:{const U=L.pop();$+=`The ${L.join(", ")}, and ${U} arguments`}break}return`${$} must be specified`},TypeError),x("ERR_OUT_OF_RANGE",(L,$,B)=>{S($,'Missing "range" argument');let U;if(Number.isInteger(B)&&Math.abs(B)>2**32)U=A(String(B));else if(typeof B=="bigint"){U=String(B);const z=BigInt(2)**BigInt(32);(B>z||B<-z)&&(U=A(U)),U+="n"}else U=u(B);return`The value of "${L}" is out of range. It must be ${$}. Received ${U}`},RangeError),x("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error),x("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error),x("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error),x("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error),x("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error),x("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),x("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error),x("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error),x("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error),x("ERR_STREAM_WRITE_AFTER_END","write after end",Error),x("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError),errors={AbortError:I,aggregateTwoErrors:T(C),hideStackFrames:T,codes:_},errors}const require$$0=getAugmentedNamespace(empty$2);var hasRequiredUtil;function requireUtil(){return hasRequiredUtil||(hasRequiredUtil=1,(function(g){const u=requireDist$1(),{format:h,inspect:y}=requireInspect(),{codes:{ERR_INVALID_ARG_TYPE:v}}=requireErrors(),{kResistStopPropagation:b,AggregateError:w,SymbolDispose:E}=requirePrimordials(),_=globalThis.AbortSignal||require$$0.AbortSignal,S=globalThis.AbortController||require$$0.AbortController,A=Object.getPrototypeOf(async function(){}).constructor,R=globalThis.Blob||u.Blob,x=typeof R<"u"?function(L){return L instanceof R}:function(L){return!1},T=(I,L)=>{if(I!==void 0&&(I===null||typeof I!="object"||!("aborted"in I)))throw new v(L,"AbortSignal",I)},C=(I,L)=>{if(typeof I!="function")throw new v(L,"Function",I)};g.exports={AggregateError:w,kEmptyObject:Object.freeze({}),once(I){let L=!1;return function(...$){L||(L=!0,I.apply(this,$))}},createDeferredPromise:function(){let I,L;return{promise:new Promise((B,U)=>{I=B,L=U}),resolve:I,reject:L}},promisify(I){return new Promise((L,$)=>{I((B,...U)=>B?$(B):L(...U))})},debuglog(){return function(){}},format:h,inspect:y,types:{isAsyncFunction(I){return I instanceof A},isArrayBufferView(I){return ArrayBuffer.isView(I)}},isBlob:x,deprecate(I,L){return I},addAbortListener:requireEvents().addAbortListener||function(L,$){if(L===void 0)throw new v("signal","AbortSignal",L);T(L,"signal"),C($,"listener");let B;return L.aborted?queueMicrotask(()=>$()):(L.addEventListener("abort",$,{__proto__:null,once:!0,[b]:!0}),B=()=>{L.removeEventListener("abort",$)}),{__proto__:null,[E](){var U;(U=B)===null||U===void 0||U()}}},AbortSignalAny:_.any||function(L){if(L.length===1)return L[0];const $=new S,B=()=>$.abort();return L.forEach(U=>{T(U,"signals"),U.addEventListener("abort",B,{once:!0})}),$.signal.addEventListener("abort",()=>{L.forEach(U=>U.removeEventListener("abort",B))},{once:!0}),$.signal}},g.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")})(util)),util.exports}var operators={},validators,hasRequiredValidators;function requireValidators(){if(hasRequiredValidators)return validators;hasRequiredValidators=1;const{ArrayIsArray:g,ArrayPrototypeIncludes:u,ArrayPrototypeJoin:h,ArrayPrototypeMap:y,NumberIsInteger:v,NumberIsNaN:b,NumberMAX_SAFE_INTEGER:w,NumberMIN_SAFE_INTEGER:E,NumberParseInt:_,ObjectPrototypeHasOwnProperty:S,RegExpPrototypeExec:A,String:R,StringPrototypeToUpperCase:x,StringPrototypeTrim:T}=requirePrimordials(),{hideStackFrames:C,codes:{ERR_SOCKET_BAD_PORT:I,ERR_INVALID_ARG_TYPE:L,ERR_INVALID_ARG_VALUE:$,ERR_OUT_OF_RANGE:B,ERR_UNKNOWN_SIGNAL:U}}=requireErrors(),{normalizeEncoding:z}=requireUtil(),{isAsyncFunction:ne,isArrayBufferView:ue}=requireUtil().types,he={};function Y(we){return we===(we|0)}function X(we){return we===we>>>0}const J=/^[0-7]+$/,j="must be a 32-bit unsigned integer or an octal string";function M(we,Le,Oe){if(typeof we>"u"&&(we=Oe),typeof we=="string"){if(A(J,we)===null)throw new $(Le,we,j);we=_(we,8)}return O(we,Le),we}const N=C((we,Le,Oe=E,Ce=w)=>{if(typeof we!="number")throw new L(Le,"number",we);if(!v(we))throw new B(Le,"an integer",we);if(we<Oe||we>Ce)throw new B(Le,`>= ${Oe} && <= ${Ce}`,we)}),P=C((we,Le,Oe=-2147483648,Ce=2147483647)=>{if(typeof we!="number")throw new L(Le,"number",we);if(!v(we))throw new B(Le,"an integer",we);if(we<Oe||we>Ce)throw new B(Le,`>= ${Oe} && <= ${Ce}`,we)}),O=C((we,Le,Oe=!1)=>{if(typeof we!="number")throw new L(Le,"number",we);if(!v(we))throw new B(Le,"an integer",we);const Ce=Oe?1:0,We=4294967295;if(we<Ce||we>We)throw new B(Le,`>= ${Ce} && <= ${We}`,we)});function k(we,Le){if(typeof we!="string")throw new L(Le,"string",we)}function q(we,Le,Oe=void 0,Ce){if(typeof we!="number")throw new L(Le,"number",we);if(Oe!=null&&we<Oe||Ce!=null&&we>Ce||(Oe!=null||Ce!=null)&&b(we))throw new B(Le,`${Oe!=null?`>= ${Oe}`:""}${Oe!=null&&Ce!=null?" && ":""}${Ce!=null?`<= ${Ce}`:""}`,we)}const F=C((we,Le,Oe)=>{if(!u(Oe,we)){const We="must be one of: "+h(y(Oe,ze=>typeof ze=="string"?`'${ze}'`:R(ze)),", ");throw new $(Le,we,We)}});function H(we,Le){if(typeof we!="boolean")throw new L(Le,"boolean",we)}function D(we,Le,Oe){return we==null||!S(we,Le)?Oe:we[Le]}const G=C((we,Le,Oe=null)=>{const Ce=D(Oe,"allowArray",!1),We=D(Oe,"allowFunction",!1);if(!D(Oe,"nullable",!1)&&we===null||!Ce&&g(we)||typeof we!="object"&&(!We||typeof we!="function"))throw new L(Le,"Object",we)}),W=C((we,Le)=>{if(we!=null&&typeof we!="object"&&typeof we!="function")throw new L(Le,"a dictionary",we)}),K=C((we,Le,Oe=0)=>{if(!g(we))throw new L(Le,"Array",we);if(we.length<Oe){const Ce=`must be longer than ${Oe}`;throw new $(Le,we,Ce)}});function Z(we,Le){K(we,Le);for(let Oe=0;Oe<we.length;Oe++)k(we[Oe],`${Le}[${Oe}]`)}function ae(we,Le){K(we,Le);for(let Oe=0;Oe<we.length;Oe++)H(we[Oe],`${Le}[${Oe}]`)}function le(we,Le){K(we,Le);for(let Oe=0;Oe<we.length;Oe++){const Ce=we[Oe],We=`${Le}[${Oe}]`;if(Ce==null)throw new L(We,"AbortSignal",Ce);pe(Ce,We)}}function te(we,Le="signal"){if(k(we,Le),he[we]===void 0)throw he[x(we)]!==void 0?new U(we+" (signals must use all capital letters)"):new U(we)}const ce=C((we,Le="buffer")=>{if(!ue(we))throw new L(Le,["Buffer","TypedArray","DataView"],we)});function ge(we,Le){const Oe=z(Le),Ce=we.length;if(Oe==="hex"&&Ce%2!==0)throw new $("encoding",Le,`is invalid for data of length ${Ce}`)}function Ee(we,Le="Port",Oe=!0){if(typeof we!="number"&&typeof we!="string"||typeof we=="string"&&T(we).length===0||+we!==+we>>>0||we>65535||we===0&&!Oe)throw new I(Le,we,Oe);return we|0}const pe=C((we,Le)=>{if(we!==void 0&&(we===null||typeof we!="object"||!("aborted"in we)))throw new L(Le,"AbortSignal",we)}),de=C((we,Le)=>{if(typeof we!="function")throw new L(Le,"Function",we)}),me=C((we,Le)=>{if(typeof we!="function"||ne(we))throw new L(Le,"Function",we)}),_e=C((we,Le)=>{if(we!==void 0)throw new L(Le,"undefined",we)});function Ae(we,Le,Oe){if(!u(Oe,we))throw new L(Le,`('${h(Oe,"|")}')`,we)}const Pe=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function Me(we,Le){if(typeof we>"u"||!A(Pe,we))throw new $(Le,we,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function Ne(we){if(typeof we=="string")return Me(we,"hints"),we;if(g(we)){const Le=we.length;let Oe="";if(Le===0)return Oe;for(let Ce=0;Ce<Le;Ce++){const We=we[Ce];Me(We,"hints"),Oe+=We,Ce!==Le-1&&(Oe+=", ")}return Oe}throw new $("hints",we,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}return validators={isInt32:Y,isUint32:X,parseFileMode:M,validateArray:K,validateStringArray:Z,validateBooleanArray:ae,validateAbortSignalArray:le,validateBoolean:H,validateBuffer:ce,validateDictionary:W,validateEncoding:ge,validateFunction:de,validateInt32:P,validateInteger:N,validateNumber:q,validateObject:G,validateOneOf:F,validatePlainFunction:me,validatePort:Ee,validateSignalName:te,validateString:k,validateUint32:O,validateUndefined:_e,validateUnion:Ae,validateAbortSignal:pe,validateLinkHeaderValue:Ne},validators}var endOfStream$1={exports:{}},dist={},hasRequiredDist;function requireDist(){return hasRequiredDist||(hasRequiredDist=1,(function(g){Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});function u(z){return z&&z.__esModule&&Object.prototype.hasOwnProperty.call(z,"default")?z.default:z}var h={exports:{}},y=h.exports={},v,b;function w(){throw new Error("setTimeout has not been defined")}function E(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?v=setTimeout:v=w}catch{v=w}try{typeof clearTimeout=="function"?b=clearTimeout:b=E}catch{b=E}})();function _(z){if(v===setTimeout)return setTimeout(z,0);if((v===w||!v)&&setTimeout)return v=setTimeout,setTimeout(z,0);try{return v(z,0)}catch{try{return v.call(null,z,0)}catch{return v.call(this,z,0)}}}function S(z){if(b===clearTimeout)return clearTimeout(z);if((b===E||!b)&&clearTimeout)return b=clearTimeout,clearTimeout(z);try{return b(z)}catch{try{return b.call(null,z)}catch{return b.call(this,z)}}}var A=[],R=!1,x,T=-1;function C(){!R||!x||(R=!1,x.length?A=x.concat(A):T=-1,A.length&&I())}function I(){if(!R){var z=_(C);R=!0;for(var ne=A.length;ne;){for(x=A,A=[];++T<ne;)x&&x[T].run();T=-1,ne=A.length}x=null,R=!1,S(z)}}y.nextTick=function(z){var ne=new Array(arguments.length-1);if(arguments.length>1)for(var ue=1;ue<arguments.length;ue++)ne[ue-1]=arguments[ue];A.push(new L(z,ne)),A.length===1&&!R&&_(I)};function L(z,ne){this.fun=z,this.array=ne}L.prototype.run=function(){this.fun.apply(null,this.array)},y.title="browser",y.browser=!0,y.env={},y.argv=[],y.version="",y.versions={};function $(){}y.on=$,y.addListener=$,y.once=$,y.off=$,y.removeListener=$,y.removeAllListeners=$,y.emit=$,y.prependListener=$,y.prependOnceListener=$,y.listeners=function(z){return[]},y.binding=function(z){throw new Error("process.binding is not supported")},y.cwd=function(){return"/"},y.chdir=function(z){throw new Error("process.chdir is not supported")},y.umask=function(){return 0};var B=h.exports;const U=u(B);g.default=U,g.process=U})(dist)),dist}var utils,hasRequiredUtils;function requireUtils(){if(hasRequiredUtils)return utils;hasRequiredUtils=1;const{SymbolAsyncIterator:g,SymbolIterator:u,SymbolFor:h}=requirePrimordials(),y=h("nodejs.stream.destroyed"),v=h("nodejs.stream.errored"),b=h("nodejs.stream.readable"),w=h("nodejs.stream.writable"),E=h("nodejs.stream.disturbed"),_=h("nodejs.webstream.isClosedPromise"),S=h("nodejs.webstream.controllerErrorFunction");function A(D,G=!1){var W;return!!(D&&typeof D.pipe=="function"&&typeof D.on=="function"&&(!G||typeof D.pause=="function"&&typeof D.resume=="function")&&(!D._writableState||((W=D._readableState)===null||W===void 0?void 0:W.readable)!==!1)&&(!D._writableState||D._readableState))}function R(D){var G;return!!(D&&typeof D.write=="function"&&typeof D.on=="function"&&(!D._readableState||((G=D._writableState)===null||G===void 0?void 0:G.writable)!==!1))}function x(D){return!!(D&&typeof D.pipe=="function"&&D._readableState&&typeof D.on=="function"&&typeof D.write=="function")}function T(D){return D&&(D._readableState||D._writableState||typeof D.write=="function"&&typeof D.on=="function"||typeof D.pipe=="function"&&typeof D.on=="function")}function C(D){return!!(D&&!T(D)&&typeof D.pipeThrough=="function"&&typeof D.getReader=="function"&&typeof D.cancel=="function")}function I(D){return!!(D&&!T(D)&&typeof D.getWriter=="function"&&typeof D.abort=="function")}function L(D){return!!(D&&!T(D)&&typeof D.readable=="object"&&typeof D.writable=="object")}function $(D){return C(D)||I(D)||L(D)}function B(D,G){return D==null?!1:G===!0?typeof D[g]=="function":G===!1?typeof D[u]=="function":typeof D[g]=="function"||typeof D[u]=="function"}function U(D){if(!T(D))return null;const G=D._writableState,W=D._readableState,K=G||W;return!!(D.destroyed||D[y]||K!=null&&K.destroyed)}function z(D){if(!R(D))return null;if(D.writableEnded===!0)return!0;const G=D._writableState;return G!=null&&G.errored?!1:typeof G?.ended!="boolean"?null:G.ended}function ne(D,G){if(!R(D))return null;if(D.writableFinished===!0)return!0;const W=D._writableState;return W!=null&&W.errored?!1:typeof W?.finished!="boolean"?null:!!(W.finished||G===!1&&W.ended===!0&&W.length===0)}function ue(D){if(!A(D))return null;if(D.readableEnded===!0)return!0;const G=D._readableState;return!G||G.errored?!1:typeof G?.ended!="boolean"?null:G.ended}function he(D,G){if(!A(D))return null;const W=D._readableState;return W!=null&&W.errored?!1:typeof W?.endEmitted!="boolean"?null:!!(W.endEmitted||G===!1&&W.ended===!0&&W.length===0)}function Y(D){return D&&D[b]!=null?D[b]:typeof D?.readable!="boolean"?null:U(D)?!1:A(D)&&D.readable&&!he(D)}function X(D){return D&&D[w]!=null?D[w]:typeof D?.writable!="boolean"?null:U(D)?!1:R(D)&&D.writable&&!z(D)}function J(D,G){return T(D)?U(D)?!0:!(G?.readable!==!1&&Y(D)||G?.writable!==!1&&X(D)):null}function j(D){var G,W;return T(D)?D.writableErrored?D.writableErrored:(G=(W=D._writableState)===null||W===void 0?void 0:W.errored)!==null&&G!==void 0?G:null:null}function M(D){var G,W;return T(D)?D.readableErrored?D.readableErrored:(G=(W=D._readableState)===null||W===void 0?void 0:W.errored)!==null&&G!==void 0?G:null:null}function N(D){if(!T(D))return null;if(typeof D.closed=="boolean")return D.closed;const G=D._writableState,W=D._readableState;return typeof G?.closed=="boolean"||typeof W?.closed=="boolean"?G?.closed||W?.closed:typeof D._closed=="boolean"&&P(D)?D._closed:null}function P(D){return typeof D._closed=="boolean"&&typeof D._defaultKeepAlive=="boolean"&&typeof D._removedConnection=="boolean"&&typeof D._removedContLen=="boolean"}function O(D){return typeof D._sent100=="boolean"&&P(D)}function k(D){var G;return typeof D._consuming=="boolean"&&typeof D._dumped=="boolean"&&((G=D.req)===null||G===void 0?void 0:G.upgradeOrConnect)===void 0}function q(D){if(!T(D))return null;const G=D._writableState,W=D._readableState,K=G||W;return!K&&O(D)||!!(K&&K.autoDestroy&&K.emitClose&&K.closed===!1)}function F(D){var G;return!!(D&&((G=D[E])!==null&&G!==void 0?G:D.readableDidRead||D.readableAborted))}function H(D){var G,W,K,Z,ae,le,te,ce,ge,Ee;return!!(D&&((G=(W=(K=(Z=(ae=(le=D[v])!==null&&le!==void 0?le:D.readableErrored)!==null&&ae!==void 0?ae:D.writableErrored)!==null&&Z!==void 0?Z:(te=D._readableState)===null||te===void 0?void 0:te.errorEmitted)!==null&&K!==void 0?K:(ce=D._writableState)===null||ce===void 0?void 0:ce.errorEmitted)!==null&&W!==void 0?W:(ge=D._readableState)===null||ge===void 0?void 0:ge.errored)!==null&&G!==void 0?G:!((Ee=D._writableState)===null||Ee===void 0)&&Ee.errored))}return utils={isDestroyed:U,kIsDestroyed:y,isDisturbed:F,kIsDisturbed:E,isErrored:H,kIsErrored:v,isReadable:Y,kIsReadable:b,kIsClosedPromise:_,kControllerErrorFunction:S,kIsWritable:w,isClosed:N,isDuplexNodeStream:x,isFinished:J,isIterable:B,isReadableNodeStream:A,isReadableStream:C,isReadableEnded:ue,isReadableFinished:he,isReadableErrored:M,isNodeStream:T,isWebStream:$,isWritable:X,isWritableNodeStream:R,isWritableStream:I,isWritableEnded:z,isWritableFinished:ne,isWritableErrored:j,isServerRequest:k,isServerResponse:O,willEmitClose:q,isTransformStream:L},utils}var hasRequiredEndOfStream$1;function requireEndOfStream$1(){if(hasRequiredEndOfStream$1)return endOfStream$1.exports;hasRequiredEndOfStream$1=1;const g=requireDist(),{AbortError:u,codes:h}=requireErrors(),{ERR_INVALID_ARG_TYPE:y,ERR_STREAM_PREMATURE_CLOSE:v}=h,{kEmptyObject:b,once:w}=requireUtil(),{validateAbortSignal:E,validateFunction:_,validateObject:S,validateBoolean:A}=requireValidators(),{Promise:R,PromisePrototypeThen:x,SymbolDispose:T}=requirePrimordials(),{isClosed:C,isReadable:I,isReadableNodeStream:L,isReadableStream:$,isReadableFinished:B,isReadableErrored:U,isWritable:z,isWritableNodeStream:ne,isWritableStream:ue,isWritableFinished:he,isWritableErrored:Y,isNodeStream:X,willEmitClose:J,kIsClosedPromise:j}=requireUtils();let M;function N(F){return F.setHeader&&typeof F.abort=="function"}const P=()=>{};function O(F,H,D){var G,W;if(arguments.length===2?(D=H,H=b):H==null?H=b:S(H,"options"),_(D,"callback"),E(H.signal,"options.signal"),D=w(D),$(F)||ue(F))return k(F,H,D);if(!X(F))throw new y("stream",["ReadableStream","WritableStream","Stream"],F);const K=(G=H.readable)!==null&&G!==void 0?G:L(F),Z=(W=H.writable)!==null&&W!==void 0?W:ne(F),ae=F._writableState,le=F._readableState,te=()=>{F.writable||Ee()};let ce=J(F)&&L(F)===K&&ne(F)===Z,ge=he(F,!1);const Ee=()=>{ge=!0,F.destroyed&&(ce=!1),!(ce&&(!F.readable||K))&&(!K||pe)&&D.call(F)};let pe=B(F,!1);const de=()=>{pe=!0,F.destroyed&&(ce=!1),!(ce&&(!F.writable||Z))&&(!Z||ge)&&D.call(F)},me=we=>{D.call(F,we)};let _e=C(F);const Ae=()=>{_e=!0;const we=Y(F)||U(F);if(we&&typeof we!="boolean")return D.call(F,we);if(K&&!pe&&L(F,!0)&&!B(F,!1))return D.call(F,new v);if(Z&&!ge&&!he(F,!1))return D.call(F,new v);D.call(F)},Pe=()=>{_e=!0;const we=Y(F)||U(F);if(we&&typeof we!="boolean")return D.call(F,we);D.call(F)},Me=()=>{F.req.on("finish",Ee)};N(F)?(F.on("complete",Ee),ce||F.on("abort",Ae),F.req?Me():F.on("request",Me)):Z&&!ae&&(F.on("end",te),F.on("close",te)),!ce&&typeof F.aborted=="boolean"&&F.on("aborted",Ae),F.on("end",de),F.on("finish",Ee),H.error!==!1&&F.on("error",me),F.on("close",Ae),_e?g.nextTick(Ae):ae!=null&&ae.errorEmitted||le!=null&&le.errorEmitted?ce||g.nextTick(Pe):(!K&&(!ce||I(F))&&(ge||z(F)===!1)||!Z&&(!ce||z(F))&&(pe||I(F)===!1)||le&&F.req&&F.aborted)&&g.nextTick(Pe);const Ne=()=>{D=P,F.removeListener("aborted",Ae),F.removeListener("complete",Ee),F.removeListener("abort",Ae),F.removeListener("request",Me),F.req&&F.req.removeListener("finish",Ee),F.removeListener("end",te),F.removeListener("close",te),F.removeListener("finish",Ee),F.removeListener("end",de),F.removeListener("error",me),F.removeListener("close",Ae)};if(H.signal&&!_e){const we=()=>{const Le=D;Ne(),Le.call(F,new u(void 0,{cause:H.signal.reason}))};if(H.signal.aborted)g.nextTick(we);else{M=M||requireUtil().addAbortListener;const Le=M(H.signal,we),Oe=D;D=w((...Ce)=>{Le[T](),Oe.apply(F,Ce)})}}return Ne}function k(F,H,D){let G=!1,W=P;if(H.signal)if(W=()=>{G=!0,D.call(F,new u(void 0,{cause:H.signal.reason}))},H.signal.aborted)g.nextTick(W);else{M=M||requireUtil().addAbortListener;const Z=M(H.signal,W),ae=D;D=w((...le)=>{Z[T](),ae.apply(F,le)})}const K=(...Z)=>{G||g.nextTick(()=>D.apply(F,Z))};return x(F[j].promise,K,K),P}function q(F,H){var D;let G=!1;return H===null&&(H=b),(D=H)!==null&&D!==void 0&&D.cleanup&&(A(H.cleanup,"cleanup"),G=H.cleanup),new R((W,K)=>{const Z=O(F,H,ae=>{G&&Z(),ae?K(ae):W()})})}return endOfStream$1.exports=O,endOfStream$1.exports.finished=q,endOfStream$1.exports}var destroy_1,hasRequiredDestroy;function requireDestroy(){if(hasRequiredDestroy)return destroy_1;hasRequiredDestroy=1;const g=requireDist(),{aggregateTwoErrors:u,codes:{ERR_MULTIPLE_CALLBACK:h},AbortError:y}=requireErrors(),{Symbol:v}=requirePrimordials(),{kIsDestroyed:b,isDestroyed:w,isFinished:E,isServerRequest:_}=requireUtils(),S=v("kDestroy"),A=v("kConstruct");function R(J,j,M){J&&(J.stack,j&&!j.errored&&(j.errored=J),M&&!M.errored&&(M.errored=J))}function x(J,j){const M=this._readableState,N=this._writableState,P=N||M;return N!=null&&N.destroyed||M!=null&&M.destroyed?(typeof j=="function"&&j(),this):(R(J,N,M),N&&(N.destroyed=!0),M&&(M.destroyed=!0),P.constructed?T(this,J,j):this.once(S,function(O){T(this,u(O,J),j)}),this)}function T(J,j,M){let N=!1;function P(O){if(N)return;N=!0;const k=J._readableState,q=J._writableState;R(O,q,k),q&&(q.closed=!0),k&&(k.closed=!0),typeof M=="function"&&M(O),O?g.nextTick(C,J,O):g.nextTick(I,J)}try{J._destroy(j||null,P)}catch(O){P(O)}}function C(J,j){L(J,j),I(J)}function I(J){const j=J._readableState,M=J._writableState;M&&(M.closeEmitted=!0),j&&(j.closeEmitted=!0),(M!=null&&M.emitClose||j!=null&&j.emitClose)&&J.emit("close")}function L(J,j){const M=J._readableState,N=J._writableState;N!=null&&N.errorEmitted||M!=null&&M.errorEmitted||(N&&(N.errorEmitted=!0),M&&(M.errorEmitted=!0),J.emit("error",j))}function $(){const J=this._readableState,j=this._writableState;J&&(J.constructed=!0,J.closed=!1,J.closeEmitted=!1,J.destroyed=!1,J.errored=null,J.errorEmitted=!1,J.reading=!1,J.ended=J.readable===!1,J.endEmitted=J.readable===!1),j&&(j.constructed=!0,j.destroyed=!1,j.closed=!1,j.closeEmitted=!1,j.errored=null,j.errorEmitted=!1,j.finalCalled=!1,j.prefinished=!1,j.ended=j.writable===!1,j.ending=j.writable===!1,j.finished=j.writable===!1)}function B(J,j,M){const N=J._readableState,P=J._writableState;if(P!=null&&P.destroyed||N!=null&&N.destroyed)return this;N!=null&&N.autoDestroy||P!=null&&P.autoDestroy?J.destroy(j):j&&(j.stack,P&&!P.errored&&(P.errored=j),N&&!N.errored&&(N.errored=j),M?g.nextTick(L,J,j):L(J,j))}function U(J,j){if(typeof J._construct!="function")return;const M=J._readableState,N=J._writableState;M&&(M.constructed=!1),N&&(N.constructed=!1),J.once(A,j),!(J.listenerCount(A)>1)&&g.nextTick(z,J)}function z(J){let j=!1;function M(N){if(j){B(J,N??new h);return}j=!0;const P=J._readableState,O=J._writableState,k=O||P;P&&(P.constructed=!0),O&&(O.constructed=!0),k.destroyed?J.emit(S,N):N?B(J,N,!0):g.nextTick(ne,J)}try{J._construct(N=>{g.nextTick(M,N)})}catch(N){g.nextTick(M,N)}}function ne(J){J.emit(A)}function ue(J){return J?.setHeader&&typeof J.abort=="function"}function he(J){J.emit("close")}function Y(J,j){J.emit("error",j),g.nextTick(he,J)}function X(J,j){!J||w(J)||(!j&&!E(J)&&(j=new y),_(J)?(J.socket=null,J.destroy(j)):ue(J)?J.abort():ue(J.req)?J.req.abort():typeof J.destroy=="function"?J.destroy(j):typeof J.close=="function"?J.close():j?g.nextTick(Y,J,j):g.nextTick(he,J),J.destroyed||(J[b]=!0))}return destroy_1={construct:U,destroyer:X,destroy:x,undestroy:$,errorOrDestroy:B},destroy_1}var legacy,hasRequiredLegacy;function requireLegacy(){if(hasRequiredLegacy)return legacy;hasRequiredLegacy=1;const{ArrayIsArray:g,ObjectSetPrototypeOf:u}=requirePrimordials(),{EventEmitter:h}=requireEvents();function y(b){h.call(this,b)}u(y.prototype,h.prototype),u(y,h),y.prototype.pipe=function(b,w){const E=this;function _(I){b.writable&&b.write(I)===!1&&E.pause&&E.pause()}E.on("data",_);function S(){E.readable&&E.resume&&E.resume()}b.on("drain",S),!b._isStdio&&(!w||w.end!==!1)&&(E.on("end",R),E.on("close",x));let A=!1;function R(){A||(A=!0,b.end())}function x(){A||(A=!0,typeof b.destroy=="function"&&b.destroy())}function T(I){C(),h.listenerCount(this,"error")===0&&this.emit("error",I)}v(E,"error",T),v(b,"error",T);function C(){E.removeListener("data",_),b.removeListener("drain",S),E.removeListener("end",R),E.removeListener("close",x),E.removeListener("error",T),b.removeListener("error",T),E.removeListener("end",C),E.removeListener("close",C),b.removeListener("close",C)}return E.on("end",C),E.on("close",C),b.on("close",C),b.emit("pipe",E),b};function v(b,w,E){if(typeof b.prependListener=="function")return b.prependListener(w,E);!b._events||!b._events[w]?b.on(w,E):g(b._events[w])?b._events[w].unshift(E):b._events[w]=[E,b._events[w]]}return legacy={Stream:y,prependListener:v},legacy}var addAbortSignal={exports:{}},hasRequiredAddAbortSignal;function requireAddAbortSignal(){return hasRequiredAddAbortSignal||(hasRequiredAddAbortSignal=1,(function(g){const{SymbolDispose:u}=requirePrimordials(),{AbortError:h,codes:y}=requireErrors(),{isNodeStream:v,isWebStream:b,kControllerErrorFunction:w}=requireUtils(),E=requireEndOfStream$1(),{ERR_INVALID_ARG_TYPE:_}=y;let S;const A=(R,x)=>{if(typeof R!="object"||!("aborted"in R))throw new _(x,"AbortSignal",R)};g.exports.addAbortSignal=function(x,T){if(A(x,"signal"),!v(T)&&!b(T))throw new _("stream",["ReadableStream","WritableStream","Stream"],T);return g.exports.addAbortSignalNoValidate(x,T)},g.exports.addAbortSignalNoValidate=function(R,x){if(typeof R!="object"||!("aborted"in R))return x;const T=v(x)?()=>{x.destroy(new h(void 0,{cause:R.reason}))}:()=>{x[w](new h(void 0,{cause:R.reason}))};if(R.aborted)T();else{S=S||requireUtil().addAbortListener;const C=S(R,T);E(x,C[u])}return x}})(addAbortSignal)),addAbortSignal.exports}var buffer_list,hasRequiredBuffer_list;function requireBuffer_list(){if(hasRequiredBuffer_list)return buffer_list;hasRequiredBuffer_list=1;const{StringPrototypeSlice:g,SymbolIterator:u,TypedArrayPrototypeSet:h,Uint8Array:y}=requirePrimordials(),{Buffer:v}=requireDist$1(),{inspect:b}=requireUtil();return buffer_list=class{constructor(){this.head=null,this.tail=null,this.length=0}push(E){const _={data:E,next:null};this.length>0?this.tail.next=_:this.head=_,this.tail=_,++this.length}unshift(E){const _={data:E,next:this.head};this.length===0&&(this.tail=_),this.head=_,++this.length}shift(){if(this.length===0)return;const E=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,E}clear(){this.head=this.tail=null,this.length=0}join(E){if(this.length===0)return"";let _=this.head,S=""+_.data;for(;(_=_.next)!==null;)S+=E+_.data;return S}concat(E){if(this.length===0)return v.alloc(0);const _=v.allocUnsafe(E>>>0);let S=this.head,A=0;for(;S;)h(_,S.data,A),A+=S.data.length,S=S.next;return _}consume(E,_){const S=this.head.data;if(E<S.length){const A=S.slice(0,E);return this.head.data=S.slice(E),A}return E===S.length?this.shift():_?this._getString(E):this._getBuffer(E)}first(){return this.head.data}*[u](){for(let E=this.head;E;E=E.next)yield E.data}_getString(E){let _="",S=this.head,A=0;do{const R=S.data;if(E>R.length)_+=R,E-=R.length;else{E===R.length?(_+=R,++A,S.next?this.head=S.next:this.head=this.tail=null):(_+=g(R,0,E),this.head=S,S.data=g(R,E));break}++A}while((S=S.next)!==null);return this.length-=A,_}_getBuffer(E){const _=v.allocUnsafe(E),S=E;let A=this.head,R=0;do{const x=A.data;if(E>x.length)h(_,x,S-E),E-=x.length;else{E===x.length?(h(_,x,S-E),++R,A.next?this.head=A.next:this.head=this.tail=null):(h(_,new y(x.buffer,x.byteOffset,E),S-E),this.head=A,A.data=x.slice(E));break}++R}while((A=A.next)!==null);return this.length-=R,_}[Symbol.for("nodejs.util.inspect.custom")](E,_){return b(this,{..._,depth:0,customInspect:!1})}},buffer_list}var state,hasRequiredState;function requireState(){if(hasRequiredState)return state;hasRequiredState=1;const{MathFloor:g,NumberIsInteger:u}=requirePrimordials(),{validateInteger:h}=requireValidators(),{ERR_INVALID_ARG_VALUE:y}=requireErrors().codes;let v=16*1024,b=16;function w(A,R,x){return A.highWaterMark!=null?A.highWaterMark:R?A[x]:null}function E(A){return A?b:v}function _(A,R){h(R,"value",0),A?b=R:v=R}function S(A,R,x,T){const C=w(R,T,x);if(C!=null){if(!u(C)||C<0){const I=T?`options.${x}`:"options.highWaterMark";throw new y(I,C)}return g(C)}return E(A.objectMode)}return state={getHighWaterMark:S,getDefaultHighWaterMark:E,setDefaultHighWaterMark:_},state}var from_1,hasRequiredFrom;function requireFrom(){if(hasRequiredFrom)return from_1;hasRequiredFrom=1;const g=requireDist(),{PromisePrototypeThen:u,SymbolAsyncIterator:h,SymbolIterator:y}=requirePrimordials(),{Buffer:v}=requireDist$1(),{ERR_INVALID_ARG_TYPE:b,ERR_STREAM_NULL_VALUES:w}=requireErrors().codes;function E(_,S,A){let R;if(typeof S=="string"||S instanceof v)return new _({objectMode:!0,...A,read(){this.push(S),this.push(null)}});let x;if(S&&S[h])x=!0,R=S[h]();else if(S&&S[y])x=!1,R=S[y]();else throw new b("iterable",["Iterable"],S);const T=new _({objectMode:!0,highWaterMark:1,...A});let C=!1;T._read=function(){C||(C=!0,L())},T._destroy=function($,B){u(I($),()=>g.nextTick(B,$),U=>g.nextTick(B,U||$))};async function I($){const B=$!=null,U=typeof R.throw=="function";if(B&&U){const{value:z,done:ne}=await R.throw($);if(await z,ne)return}if(typeof R.return=="function"){const{value:z}=await R.return();await z}}async function L(){for(;;){try{const{value:$,done:B}=x?await R.next():R.next();if(B)T.push(null);else{const U=$&&typeof $.then=="function"?await $:$;if(U===null)throw C=!1,new w;if(T.push(U))continue;C=!1}}catch($){T.destroy($)}break}}return T}return from_1=E,from_1}var readable,hasRequiredReadable;function requireReadable(){if(hasRequiredReadable)return readable;hasRequiredReadable=1;const g=requireDist(),{ArrayPrototypeIndexOf:u,NumberIsInteger:h,NumberIsNaN:y,NumberParseInt:v,ObjectDefineProperties:b,ObjectKeys:w,ObjectSetPrototypeOf:E,Promise:_,SafeSet:S,SymbolAsyncDispose:A,SymbolAsyncIterator:R,Symbol:x}=requirePrimordials();readable=Ce,Ce.ReadableState=Oe;const{EventEmitter:T}=requireEvents(),{Stream:C,prependListener:I}=requireLegacy(),{Buffer:L}=requireDist$1(),{addAbortSignal:$}=requireAddAbortSignal(),B=requireEndOfStream$1();let U=requireUtil().debuglog("stream",Se=>{U=Se});const z=requireBuffer_list(),ne=requireDestroy(),{getHighWaterMark:ue,getDefaultHighWaterMark:he}=requireState(),{aggregateTwoErrors:Y,codes:{ERR_INVALID_ARG_TYPE:X,ERR_METHOD_NOT_IMPLEMENTED:J,ERR_OUT_OF_RANGE:j,ERR_STREAM_PUSH_AFTER_EOF:M,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:N},AbortError:P}=requireErrors(),{validateObject:O}=requireValidators(),k=x("kPaused"),{StringDecoder:q}=requireString_decoder(),F=requireFrom();E(Ce.prototype,C.prototype),E(Ce,C);const H=()=>{},{errorOrDestroy:D}=ne,G=1,W=2,K=4,Z=8,ae=16,le=32,te=64,ce=128,ge=256,Ee=512,pe=1024,de=2048,me=4096,_e=8192,Ae=16384,Pe=32768,Me=65536,Ne=1<<17,we=1<<18;function Le(Se){return{enumerable:!1,get(){return(this.state&Se)!==0},set(se){se?this.state|=Se:this.state&=~Se}}}b(Oe.prototype,{objectMode:Le(G),ended:Le(W),endEmitted:Le(K),reading:Le(Z),constructed:Le(ae),sync:Le(le),needReadable:Le(te),emittedReadable:Le(ce),readableListening:Le(ge),resumeScheduled:Le(Ee),errorEmitted:Le(pe),emitClose:Le(de),autoDestroy:Le(me),destroyed:Le(_e),closed:Le(Ae),closeEmitted:Le(Pe),multiAwaitDrain:Le(Me),readingMore:Le(Ne),dataEmitted:Le(we)});function Oe(Se,se,ee){typeof ee!="boolean"&&(ee=se instanceof requireDuplex()),this.state=de|me|ae|le,Se&&Se.objectMode&&(this.state|=G),ee&&Se&&Se.readableObjectMode&&(this.state|=G),this.highWaterMark=Se?ue(this,Se,"readableHighWaterMark",ee):he(!1),this.buffer=new z,this.length=0,this.pipes=[],this.flowing=null,this[k]=null,Se&&Se.emitClose===!1&&(this.state&=~de),Se&&Se.autoDestroy===!1&&(this.state&=~me),this.errored=null,this.defaultEncoding=Se&&Se.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.decoder=null,this.encoding=null,Se&&Se.encoding&&(this.decoder=new q(Se.encoding),this.encoding=Se.encoding)}function Ce(Se){if(!(this instanceof Ce))return new Ce(Se);const se=this instanceof requireDuplex();this._readableState=new Oe(Se,this,se),Se&&(typeof Se.read=="function"&&(this._read=Se.read),typeof Se.destroy=="function"&&(this._destroy=Se.destroy),typeof Se.construct=="function"&&(this._construct=Se.construct),Se.signal&&!se&&$(Se.signal,this)),C.call(this,Se),ne.construct(this,()=>{this._readableState.needReadable&&wt(this,this._readableState)})}Ce.prototype.destroy=ne.destroy,Ce.prototype._undestroy=ne.undestroy,Ce.prototype._destroy=function(Se,se){se(Se)},Ce.prototype[T.captureRejectionSymbol]=function(Se){this.destroy(Se)},Ce.prototype[A]=function(){let Se;return this.destroyed||(Se=this.readableEnded?null:new P,this.destroy(Se)),new _((se,ee)=>B(this,oe=>oe&&oe!==Se?ee(oe):se(null)))},Ce.prototype.push=function(Se,se){return We(this,Se,se,!1)},Ce.prototype.unshift=function(Se,se){return We(this,Se,se,!0)};function We(Se,se,ee,oe){U("readableAddChunk",se);const be=Se._readableState;let xe;if((be.state&G)===0&&(typeof se=="string"?(ee=ee||be.defaultEncoding,be.encoding!==ee&&(oe&&be.encoding?se=L.from(se,ee).toString(be.encoding):(se=L.from(se,ee),ee=""))):se instanceof L?ee="":C._isUint8Array(se)?(se=C._uint8ArrayToBuffer(se),ee=""):se!=null&&(xe=new X("chunk",["string","Buffer","Uint8Array"],se))),xe)D(Se,xe);else if(se===null)be.state&=~Z,bt(Se,be);else if((be.state&G)!==0||se&&se.length>0)if(oe)if((be.state&K)!==0)D(Se,new N);else{if(be.destroyed||be.errored)return!1;ze(Se,be,se,!0)}else if(be.ended)D(Se,new M);else{if(be.destroyed||be.errored)return!1;be.state&=~Z,be.decoder&&!ee?(se=be.decoder.write(se),be.objectMode||se.length!==0?ze(Se,be,se,!1):wt(Se,be)):ze(Se,be,se,!1)}else oe||(be.state&=~Z,wt(Se,be));return!be.ended&&(be.length<be.highWaterMark||be.length===0)}function ze(Se,se,ee,oe){se.flowing&&se.length===0&&!se.sync&&Se.listenerCount("data")>0?((se.state&Me)!==0?se.awaitDrainWriters.clear():se.awaitDrainWriters=null,se.dataEmitted=!0,Se.emit("data",ee)):(se.length+=se.objectMode?1:ee.length,oe?se.buffer.unshift(ee):se.buffer.push(ee),(se.state&te)!==0&&Et(Se)),wt(Se,se)}Ce.prototype.isPaused=function(){const Se=this._readableState;return Se[k]===!0||Se.flowing===!1},Ce.prototype.setEncoding=function(Se){const se=new q(Se);this._readableState.decoder=se,this._readableState.encoding=this._readableState.decoder.encoding;const ee=this._readableState.buffer;let oe="";for(const be of ee)oe+=se.write(be);return ee.clear(),oe!==""&&ee.push(oe),this._readableState.length=oe.length,this};const Xe=1073741824;function it(Se){if(Se>Xe)throw new j("size","<= 1GiB",Se);return Se--,Se|=Se>>>1,Se|=Se>>>2,Se|=Se>>>4,Se|=Se>>>8,Se|=Se>>>16,Se++,Se}function Je(Se,se){return Se<=0||se.length===0&&se.ended?0:(se.state&G)!==0?1:y(Se)?se.flowing&&se.length?se.buffer.first().length:se.length:Se<=se.length?Se:se.ended?se.length:0}Ce.prototype.read=function(Se){U("read",Se),Se===void 0?Se=NaN:h(Se)||(Se=v(Se,10));const se=this._readableState,ee=Se;if(Se>se.highWaterMark&&(se.highWaterMark=it(Se)),Se!==0&&(se.state&=~ce),Se===0&&se.needReadable&&((se.highWaterMark!==0?se.length>=se.highWaterMark:se.length>0)||se.ended))return U("read: emitReadable",se.length,se.ended),se.length===0&&se.ended?dt(this):Et(this),null;if(Se=Je(Se,se),Se===0&&se.ended)return se.length===0&&dt(this),null;let oe=(se.state&te)!==0;if(U("need readable",oe),(se.length===0||se.length-Se<se.highWaterMark)&&(oe=!0,U("length less than watermark",oe)),se.ended||se.reading||se.destroyed||se.errored||!se.constructed)oe=!1,U("reading, ended or constructing",oe);else if(oe){U("do read"),se.state|=Z|le,se.length===0&&(se.state|=te);try{this._read(se.highWaterMark)}catch(xe){D(this,xe)}se.state&=~le,se.reading||(Se=Je(ee,se))}let be;return Se>0?be=Dt(Se,se):be=null,be===null?(se.needReadable=se.length<=se.highWaterMark,Se=0):(se.length-=Se,se.multiAwaitDrain?se.awaitDrainWriters.clear():se.awaitDrainWriters=null),se.length===0&&(se.ended||(se.needReadable=!0),ee!==Se&&se.ended&&dt(this)),be!==null&&!se.errorEmitted&&!se.closeEmitted&&(se.dataEmitted=!0,this.emit("data",be)),be};function bt(Se,se){if(U("onEofChunk"),!se.ended){if(se.decoder){const ee=se.decoder.end();ee&&ee.length&&(se.buffer.push(ee),se.length+=se.objectMode?1:ee.length)}se.ended=!0,se.sync?Et(Se):(se.needReadable=!1,se.emittedReadable=!0,lt(Se))}}function Et(Se){const se=Se._readableState;U("emitReadable",se.needReadable,se.emittedReadable),se.needReadable=!1,se.emittedReadable||(U("emitReadable",se.flowing),se.emittedReadable=!0,g.nextTick(lt,Se))}function lt(Se){const se=Se._readableState;U("emitReadable_",se.destroyed,se.length,se.ended),!se.destroyed&&!se.errored&&(se.length||se.ended)&&(Se.emit("readable"),se.emittedReadable=!1),se.needReadable=!se.flowing&&!se.ended&&se.length<=se.highWaterMark,Mt(Se)}function wt(Se,se){!se.readingMore&&se.constructed&&(se.readingMore=!0,g.nextTick(qt,Se,se))}function qt(Se,se){for(;!se.reading&&!se.ended&&(se.length<se.highWaterMark||se.flowing&&se.length===0);){const ee=se.length;if(U("maybeReadMore read 0"),Se.read(0),ee===se.length)break}se.readingMore=!1}Ce.prototype._read=function(Se){throw new J("_read()")},Ce.prototype.pipe=function(Se,se){const ee=this,oe=this._readableState;oe.pipes.length===1&&(oe.multiAwaitDrain||(oe.multiAwaitDrain=!0,oe.awaitDrainWriters=new S(oe.awaitDrainWriters?[oe.awaitDrainWriters]:[]))),oe.pipes.push(Se),U("pipe count=%d opts=%j",oe.pipes.length,se);const xe=(!se||se.end!==!1)&&Se!==g.stdout&&Se!==g.stderr?fe:Ke;oe.endEmitted?g.nextTick(xe):ee.once("end",xe),Se.on("unpipe",ie);function ie(vt,Ge){U("onunpipe"),vt===ee&&Ge&&Ge.hasUnpiped===!1&&(Ge.hasUnpiped=!0,ve())}function fe(){U("onend"),Se.end()}let ye,Q=!1;function ve(){U("cleanup"),Se.removeListener("close",De),Se.removeListener("finish",Ve),ye&&Se.removeListener("drain",ye),Se.removeListener("error",$e),Se.removeListener("unpipe",ie),ee.removeListener("end",fe),ee.removeListener("end",Ke),ee.removeListener("data",Ie),Q=!0,ye&&oe.awaitDrainWriters&&(!Se._writableState||Se._writableState.needDrain)&&ye()}function Te(){Q||(oe.pipes.length===1&&oe.pipes[0]===Se?(U("false write response, pause",0),oe.awaitDrainWriters=Se,oe.multiAwaitDrain=!1):oe.pipes.length>1&&oe.pipes.includes(Se)&&(U("false write response, pause",oe.awaitDrainWriters.size),oe.awaitDrainWriters.add(Se)),ee.pause()),ye||(ye=pt(ee,Se),Se.on("drain",ye))}ee.on("data",Ie);function Ie(vt){U("ondata");const Ge=Se.write(vt);U("dest.write",Ge),Ge===!1&&Te()}function $e(vt){if(U("onerror",vt),Ke(),Se.removeListener("error",$e),Se.listenerCount("error")===0){const Ge=Se._writableState||Se._readableState;Ge&&!Ge.errorEmitted?D(Se,vt):Se.emit("error",vt)}}I(Se,"error",$e);function De(){Se.removeListener("finish",Ve),Ke()}Se.once("close",De);function Ve(){U("onfinish"),Se.removeListener("close",De),Ke()}Se.once("finish",Ve);function Ke(){U("unpipe"),ee.unpipe(Se)}return Se.emit("pipe",ee),Se.writableNeedDrain===!0?Te():oe.flowing||(U("pipe resume"),ee.resume()),Se};function pt(Se,se){return function(){const oe=Se._readableState;oe.awaitDrainWriters===se?(U("pipeOnDrain",1),oe.awaitDrainWriters=null):oe.multiAwaitDrain&&(U("pipeOnDrain",oe.awaitDrainWriters.size),oe.awaitDrainWriters.delete(se)),(!oe.awaitDrainWriters||oe.awaitDrainWriters.size===0)&&Se.listenerCount("data")&&Se.resume()}}Ce.prototype.unpipe=function(Se){const se=this._readableState,ee={hasUnpiped:!1};if(se.pipes.length===0)return this;if(!Se){const be=se.pipes;se.pipes=[],this.pause();for(let xe=0;xe<be.length;xe++)be[xe].emit("unpipe",this,{hasUnpiped:!1});return this}const oe=u(se.pipes,Se);return oe===-1?this:(se.pipes.splice(oe,1),se.pipes.length===0&&this.pause(),Se.emit("unpipe",this,ee),this)},Ce.prototype.on=function(Se,se){const ee=C.prototype.on.call(this,Se,se),oe=this._readableState;return Se==="data"?(oe.readableListening=this.listenerCount("readable")>0,oe.flowing!==!1&&this.resume()):Se==="readable"&&!oe.endEmitted&&!oe.readableListening&&(oe.readableListening=oe.needReadable=!0,oe.flowing=!1,oe.emittedReadable=!1,U("on readable",oe.length,oe.reading),oe.length?Et(this):oe.reading||g.nextTick(Pt,this)),ee},Ce.prototype.addListener=Ce.prototype.on,Ce.prototype.removeListener=function(Se,se){const ee=C.prototype.removeListener.call(this,Se,se);return Se==="readable"&&g.nextTick(Tt,this),ee},Ce.prototype.off=Ce.prototype.removeListener,Ce.prototype.removeAllListeners=function(Se){const se=C.prototype.removeAllListeners.apply(this,arguments);return(Se==="readable"||Se===void 0)&&g.nextTick(Tt,this),se};function Tt(Se){const se=Se._readableState;se.readableListening=Se.listenerCount("readable")>0,se.resumeScheduled&&se[k]===!1?se.flowing=!0:Se.listenerCount("data")>0?Se.resume():se.readableListening||(se.flowing=null)}function Pt(Se){U("readable nexttick read 0"),Se.read(0)}Ce.prototype.resume=function(){const Se=this._readableState;return Se.flowing||(U("resume"),Se.flowing=!Se.readableListening,gt(this,Se)),Se[k]=!1,this};function gt(Se,se){se.resumeScheduled||(se.resumeScheduled=!0,g.nextTick(kt,Se,se))}function kt(Se,se){U("resume",se.reading),se.reading||Se.read(0),se.resumeScheduled=!1,Se.emit("resume"),Mt(Se),se.flowing&&!se.reading&&Se.read(0)}Ce.prototype.pause=function(){return U("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(U("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[k]=!0,this};function Mt(Se){const se=Se._readableState;for(U("flow",se.flowing);se.flowing&&Se.read()!==null;);}Ce.prototype.wrap=function(Se){let se=!1;Se.on("data",oe=>{!this.push(oe)&&Se.pause&&(se=!0,Se.pause())}),Se.on("end",()=>{this.push(null)}),Se.on("error",oe=>{D(this,oe)}),Se.on("close",()=>{this.destroy()}),Se.on("destroy",()=>{this.destroy()}),this._read=()=>{se&&Se.resume&&(se=!1,Se.resume())};const ee=w(Se);for(let oe=1;oe<ee.length;oe++){const be=ee[oe];this[be]===void 0&&typeof Se[be]=="function"&&(this[be]=Se[be].bind(Se))}return this},Ce.prototype[R]=function(){return ft(this)},Ce.prototype.iterator=function(Se){return Se!==void 0&&O(Se,"options"),ft(this,Se)};function ft(Se,se){typeof Se.read!="function"&&(Se=Ce.wrap(Se,{objectMode:!0}));const ee=Ut(Se,se);return ee.stream=Se,ee}async function*Ut(Se,se){let ee=H;function oe(ie){this===Se?(ee(),ee=H):ee=ie}Se.on("readable",oe);let be;const xe=B(Se,{writable:!1},ie=>{be=ie?Y(be,ie):null,ee(),ee=H});try{for(;;){const ie=Se.destroyed?null:Se.read();if(ie!==null)yield ie;else{if(be)throw be;if(be===null)return;await new _(oe)}}}catch(ie){throw be=Y(be,ie),be}finally{(be||se?.destroyOnReturn!==!1)&&(be===void 0||Se._readableState.autoDestroy)?ne.destroyer(Se,null):(Se.off("readable",oe),xe())}}b(Ce.prototype,{readable:{__proto__:null,get(){const Se=this._readableState;return!!Se&&Se.readable!==!1&&!Se.destroyed&&!Se.errorEmitted&&!Se.endEmitted},set(Se){this._readableState&&(this._readableState.readable=!!Se)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(Se){this._readableState&&(this._readableState.flowing=Se)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(Se){this._readableState&&(this._readableState.destroyed=Se)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),b(Oe.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[k]!==!1},set(Se){this[k]=!!Se}}}),Ce._fromList=Dt;function Dt(Se,se){if(se.length===0)return null;let ee;return se.objectMode?ee=se.buffer.shift():!Se||Se>=se.length?(se.decoder?ee=se.buffer.join(""):se.buffer.length===1?ee=se.buffer.first():ee=se.buffer.concat(se.length),se.buffer.clear()):ee=se.buffer.consume(Se,se.decoder),ee}function dt(Se){const se=Se._readableState;U("endReadable",se.endEmitted),se.endEmitted||(se.ended=!0,g.nextTick(Ot,se,Se))}function Ot(Se,se){if(U("endReadableNT",Se.endEmitted,Se.length),!Se.errored&&!Se.closeEmitted&&!Se.endEmitted&&Se.length===0){if(Se.endEmitted=!0,se.emit("end"),se.writable&&se.allowHalfOpen===!1)g.nextTick(It,se);else if(Se.autoDestroy){const ee=se._writableState;(!ee||ee.autoDestroy&&(ee.finished||ee.writable===!1))&&se.destroy()}}}function It(Se){Se.writable&&!Se.writableEnded&&!Se.destroyed&&Se.end()}Ce.from=function(Se,se){return F(Ce,Se,se)};let rt;function _t(){return rt===void 0&&(rt={}),rt}return Ce.fromWeb=function(Se,se){return _t().newStreamReadableFromReadableStream(Se,se)},Ce.toWeb=function(Se,se){return _t().newReadableStreamFromStreamReadable(Se,se)},Ce.wrap=function(Se,se){var ee,oe;return new Ce({objectMode:(ee=(oe=Se.readableObjectMode)!==null&&oe!==void 0?oe:Se.objectMode)!==null&&ee!==void 0?ee:!0,...se,destroy(be,xe){ne.destroyer(Se,be),xe(be)}}).wrap(Se)},readable}var writable,hasRequiredWritable;function requireWritable(){if(hasRequiredWritable)return writable;hasRequiredWritable=1;const g=requireDist(),{ArrayPrototypeSlice:u,Error:h,FunctionPrototypeSymbolHasInstance:y,ObjectDefineProperty:v,ObjectDefineProperties:b,ObjectSetPrototypeOf:w,StringPrototypeToLowerCase:E,Symbol:_,SymbolHasInstance:S}=requirePrimordials();writable=O,O.WritableState=N;const{EventEmitter:A}=requireEvents(),R=requireLegacy().Stream,{Buffer:x}=requireDist$1(),T=requireDestroy(),{addAbortSignal:C}=requireAddAbortSignal(),{getHighWaterMark:I,getDefaultHighWaterMark:L}=requireState(),{ERR_INVALID_ARG_TYPE:$,ERR_METHOD_NOT_IMPLEMENTED:B,ERR_MULTIPLE_CALLBACK:U,ERR_STREAM_CANNOT_PIPE:z,ERR_STREAM_DESTROYED:ne,ERR_STREAM_ALREADY_FINISHED:ue,ERR_STREAM_NULL_VALUES:he,ERR_STREAM_WRITE_AFTER_END:Y,ERR_UNKNOWN_ENCODING:X}=requireErrors().codes,{errorOrDestroy:J}=T;w(O.prototype,R.prototype),w(O,R);function j(){}const M=_("kOnFinished");function N(me,_e,Ae){typeof Ae!="boolean"&&(Ae=_e instanceof requireDuplex()),this.objectMode=!!(me&&me.objectMode),Ae&&(this.objectMode=this.objectMode||!!(me&&me.writableObjectMode)),this.highWaterMark=me?I(this,me,"writableHighWaterMark",Ae):L(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;const Pe=!!(me&&me.decodeStrings===!1);this.decodeStrings=!Pe,this.defaultEncoding=me&&me.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=D.bind(void 0,_e),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,P(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!me||me.emitClose!==!1,this.autoDestroy=!me||me.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[M]=[]}function P(me){me.buffered=[],me.bufferedIndex=0,me.allBuffers=!0,me.allNoop=!0}N.prototype.getBuffer=function(){return u(this.buffered,this.bufferedIndex)},v(N.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function O(me){const _e=this instanceof requireDuplex();if(!_e&&!y(O,this))return new O(me);this._writableState=new N(me,this,_e),me&&(typeof me.write=="function"&&(this._write=me.write),typeof me.writev=="function"&&(this._writev=me.writev),typeof me.destroy=="function"&&(this._destroy=me.destroy),typeof me.final=="function"&&(this._final=me.final),typeof me.construct=="function"&&(this._construct=me.construct),me.signal&&C(me.signal,this)),R.call(this,me),T.construct(this,()=>{const Ae=this._writableState;Ae.writing||Z(this,Ae),ce(this,Ae)})}v(O,S,{__proto__:null,value:function(me){return y(this,me)?!0:this!==O?!1:me&&me._writableState instanceof N}}),O.prototype.pipe=function(){J(this,new z)};function k(me,_e,Ae,Pe){const Me=me._writableState;if(typeof Ae=="function")Pe=Ae,Ae=Me.defaultEncoding;else{if(!Ae)Ae=Me.defaultEncoding;else if(Ae!=="buffer"&&!x.isEncoding(Ae))throw new X(Ae);typeof Pe!="function"&&(Pe=j)}if(_e===null)throw new he;if(!Me.objectMode)if(typeof _e=="string")Me.decodeStrings!==!1&&(_e=x.from(_e,Ae),Ae="buffer");else if(_e instanceof x)Ae="buffer";else if(R._isUint8Array(_e))_e=R._uint8ArrayToBuffer(_e),Ae="buffer";else throw new $("chunk",["string","Buffer","Uint8Array"],_e);let Ne;return Me.ending?Ne=new Y:Me.destroyed&&(Ne=new ne("write")),Ne?(g.nextTick(Pe,Ne),J(me,Ne,!0),Ne):(Me.pendingcb++,q(me,Me,_e,Ae,Pe))}O.prototype.write=function(me,_e,Ae){return k(this,me,_e,Ae)===!0},O.prototype.cork=function(){this._writableState.corked++},O.prototype.uncork=function(){const me=this._writableState;me.corked&&(me.corked--,me.writing||Z(this,me))},O.prototype.setDefaultEncoding=function(_e){if(typeof _e=="string"&&(_e=E(_e)),!x.isEncoding(_e))throw new X(_e);return this._writableState.defaultEncoding=_e,this};function q(me,_e,Ae,Pe,Me){const Ne=_e.objectMode?1:Ae.length;_e.length+=Ne;const we=_e.length<_e.highWaterMark;return we||(_e.needDrain=!0),_e.writing||_e.corked||_e.errored||!_e.constructed?(_e.buffered.push({chunk:Ae,encoding:Pe,callback:Me}),_e.allBuffers&&Pe!=="buffer"&&(_e.allBuffers=!1),_e.allNoop&&Me!==j&&(_e.allNoop=!1)):(_e.writelen=Ne,_e.writecb=Me,_e.writing=!0,_e.sync=!0,me._write(Ae,Pe,_e.onwrite),_e.sync=!1),we&&!_e.errored&&!_e.destroyed}function F(me,_e,Ae,Pe,Me,Ne,we){_e.writelen=Pe,_e.writecb=we,_e.writing=!0,_e.sync=!0,_e.destroyed?_e.onwrite(new ne("write")):Ae?me._writev(Me,_e.onwrite):me._write(Me,Ne,_e.onwrite),_e.sync=!1}function H(me,_e,Ae,Pe){--_e.pendingcb,Pe(Ae),K(_e),J(me,Ae)}function D(me,_e){const Ae=me._writableState,Pe=Ae.sync,Me=Ae.writecb;if(typeof Me!="function"){J(me,new U);return}Ae.writing=!1,Ae.writecb=null,Ae.length-=Ae.writelen,Ae.writelen=0,_e?(_e.stack,Ae.errored||(Ae.errored=_e),me._readableState&&!me._readableState.errored&&(me._readableState.errored=_e),Pe?g.nextTick(H,me,Ae,_e,Me):H(me,Ae,_e,Me)):(Ae.buffered.length>Ae.bufferedIndex&&Z(me,Ae),Pe?Ae.afterWriteTickInfo!==null&&Ae.afterWriteTickInfo.cb===Me?Ae.afterWriteTickInfo.count++:(Ae.afterWriteTickInfo={count:1,cb:Me,stream:me,state:Ae},g.nextTick(G,Ae.afterWriteTickInfo)):W(me,Ae,1,Me))}function G({stream:me,state:_e,count:Ae,cb:Pe}){return _e.afterWriteTickInfo=null,W(me,_e,Ae,Pe)}function W(me,_e,Ae,Pe){for(!_e.ending&&!me.destroyed&&_e.length===0&&_e.needDrain&&(_e.needDrain=!1,me.emit("drain"));Ae-- >0;)_e.pendingcb--,Pe();_e.destroyed&&K(_e),ce(me,_e)}function K(me){if(me.writing)return;for(let Me=me.bufferedIndex;Me<me.buffered.length;++Me){var _e;const{chunk:Ne,callback:we}=me.buffered[Me],Le=me.objectMode?1:Ne.length;me.length-=Le,we((_e=me.errored)!==null&&_e!==void 0?_e:new ne("write"))}const Ae=me[M].splice(0);for(let Me=0;Me<Ae.length;Me++){var Pe;Ae[Me]((Pe=me.errored)!==null&&Pe!==void 0?Pe:new ne("end"))}P(me)}function Z(me,_e){if(_e.corked||_e.bufferProcessing||_e.destroyed||!_e.constructed)return;const{buffered:Ae,bufferedIndex:Pe,objectMode:Me}=_e,Ne=Ae.length-Pe;if(!Ne)return;let we=Pe;if(_e.bufferProcessing=!0,Ne>1&&me._writev){_e.pendingcb-=Ne-1;const Le=_e.allNoop?j:Ce=>{for(let We=we;We<Ae.length;++We)Ae[We].callback(Ce)},Oe=_e.allNoop&&we===0?Ae:u(Ae,we);Oe.allBuffers=_e.allBuffers,F(me,_e,!0,_e.length,Oe,"",Le),P(_e)}else{do{const{chunk:Le,encoding:Oe,callback:Ce}=Ae[we];Ae[we++]=null;const We=Me?1:Le.length;F(me,_e,!1,We,Le,Oe,Ce)}while(we<Ae.length&&!_e.writing);we===Ae.length?P(_e):we>256?(Ae.splice(0,we),_e.bufferedIndex=0):_e.bufferedIndex=we}_e.bufferProcessing=!1}O.prototype._write=function(me,_e,Ae){if(this._writev)this._writev([{chunk:me,encoding:_e}],Ae);else throw new B("_write()")},O.prototype._writev=null,O.prototype.end=function(me,_e,Ae){const Pe=this._writableState;typeof me=="function"?(Ae=me,me=null,_e=null):typeof _e=="function"&&(Ae=_e,_e=null);let Me;if(me!=null){const Ne=k(this,me,_e);Ne instanceof h&&(Me=Ne)}return Pe.corked&&(Pe.corked=1,this.uncork()),Me||(!Pe.errored&&!Pe.ending?(Pe.ending=!0,ce(this,Pe,!0),Pe.ended=!0):Pe.finished?Me=new ue("end"):Pe.destroyed&&(Me=new ne("end"))),typeof Ae=="function"&&(Me||Pe.finished?g.nextTick(Ae,Me):Pe[M].push(Ae)),this};function ae(me){return me.ending&&!me.destroyed&&me.constructed&&me.length===0&&!me.errored&&me.buffered.length===0&&!me.finished&&!me.writing&&!me.errorEmitted&&!me.closeEmitted}function le(me,_e){let Ae=!1;function Pe(Me){if(Ae){J(me,Me??U());return}if(Ae=!0,_e.pendingcb--,Me){const Ne=_e[M].splice(0);for(let we=0;we<Ne.length;we++)Ne[we](Me);J(me,Me,_e.sync)}else ae(_e)&&(_e.prefinished=!0,me.emit("prefinish"),_e.pendingcb++,g.nextTick(ge,me,_e))}_e.sync=!0,_e.pendingcb++;try{me._final(Pe)}catch(Me){Pe(Me)}_e.sync=!1}function te(me,_e){!_e.prefinished&&!_e.finalCalled&&(typeof me._final=="function"&&!_e.destroyed?(_e.finalCalled=!0,le(me,_e)):(_e.prefinished=!0,me.emit("prefinish")))}function ce(me,_e,Ae){ae(_e)&&(te(me,_e),_e.pendingcb===0&&(Ae?(_e.pendingcb++,g.nextTick((Pe,Me)=>{ae(Me)?ge(Pe,Me):Me.pendingcb--},me,_e)):ae(_e)&&(_e.pendingcb++,ge(me,_e))))}function ge(me,_e){_e.pendingcb--,_e.finished=!0;const Ae=_e[M].splice(0);for(let Pe=0;Pe<Ae.length;Pe++)Ae[Pe]();if(me.emit("finish"),_e.autoDestroy){const Pe=me._readableState;(!Pe||Pe.autoDestroy&&(Pe.endEmitted||Pe.readable===!1))&&me.destroy()}}b(O.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(me){this._writableState&&(this._writableState.destroyed=me)}},writable:{__proto__:null,get(){const me=this._writableState;return!!me&&me.writable!==!1&&!me.destroyed&&!me.errored&&!me.ending&&!me.ended},set(me){this._writableState&&(this._writableState.writable=!!me)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){const me=this._writableState;return me?!me.destroyed&&!me.ending&&me.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});const Ee=T.destroy;O.prototype.destroy=function(me,_e){const Ae=this._writableState;return!Ae.destroyed&&(Ae.bufferedIndex<Ae.buffered.length||Ae[M].length)&&g.nextTick(K,Ae),Ee.call(this,me,_e),this},O.prototype._undestroy=T.undestroy,O.prototype._destroy=function(me,_e){_e(me)},O.prototype[A.captureRejectionSymbol]=function(me){this.destroy(me)};let pe;function de(){return pe===void 0&&(pe={}),pe}return O.fromWeb=function(me,_e){return de().newStreamWritableFromWritableStream(me,_e)},O.toWeb=function(me){return de().newWritableStreamFromStreamWritable(me)},writable}var duplexify,hasRequiredDuplexify;function requireDuplexify(){if(hasRequiredDuplexify)return duplexify;hasRequiredDuplexify=1;const g=requireDist(),u=requireDist$1(),{isReadable:h,isWritable:y,isIterable:v,isNodeStream:b,isReadableNodeStream:w,isWritableNodeStream:E,isDuplexNodeStream:_,isReadableStream:S,isWritableStream:A}=requireUtils(),R=requireEndOfStream$1(),{AbortError:x,codes:{ERR_INVALID_ARG_TYPE:T,ERR_INVALID_RETURN_VALUE:C}}=requireErrors(),{destroyer:I}=requireDestroy(),L=requireDuplex(),$=requireReadable(),B=requireWritable(),{createDeferredPromise:U}=requireUtil(),z=requireFrom(),ne=globalThis.Blob||u.Blob,ue=typeof ne<"u"?function(N){return N instanceof ne}:function(N){return!1},he=globalThis.AbortController||require$$0.AbortController,{FunctionPrototypeCall:Y}=requirePrimordials();class X extends L{constructor(N){super(N),N?.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),N?.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}}duplexify=function M(N,P){if(_(N))return N;if(w(N))return j({readable:N});if(E(N))return j({writable:N});if(b(N))return j({writable:!1,readable:!1});if(S(N))return j({readable:$.fromWeb(N)});if(A(N))return j({writable:B.fromWeb(N)});if(typeof N=="function"){const{value:k,write:q,final:F,destroy:H}=J(N);if(v(k))return z(X,k,{objectMode:!0,write:q,final:F,destroy:H});const D=k?.then;if(typeof D=="function"){let G;const W=Y(D,k,K=>{if(K!=null)throw new C("nully","body",K)},K=>{I(G,K)});return G=new X({objectMode:!0,readable:!1,write:q,final(K){F(async()=>{try{await W,g.nextTick(K,null)}catch(Z){g.nextTick(K,Z)}})},destroy:H})}throw new C("Iterable, AsyncIterable or AsyncFunction",P,k)}if(ue(N))return M(N.arrayBuffer());if(v(N))return z(X,N,{objectMode:!0,writable:!1});if(S(N?.readable)&&A(N?.writable))return X.fromWeb(N);if(typeof N?.writable=="object"||typeof N?.readable=="object"){const k=N!=null&&N.readable?w(N?.readable)?N?.readable:M(N.readable):void 0,q=N!=null&&N.writable?E(N?.writable)?N?.writable:M(N.writable):void 0;return j({readable:k,writable:q})}const O=N?.then;if(typeof O=="function"){let k;return Y(O,N,q=>{q!=null&&k.push(q),k.push(null)},q=>{I(k,q)}),k=new X({objectMode:!0,writable:!1,read(){}})}throw new T(P,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],N)};function J(M){let{promise:N,resolve:P}=U();const O=new he,k=O.signal;return{value:M((async function*(){for(;;){const F=N;N=null;const{chunk:H,done:D,cb:G}=await F;if(g.nextTick(G),D)return;if(k.aborted)throw new x(void 0,{cause:k.reason});({promise:N,resolve:P}=U()),yield H}})(),{signal:k}),write(F,H,D){const G=P;P=null,G({chunk:F,done:!1,cb:D})},final(F){const H=P;P=null,H({done:!0,cb:F})},destroy(F,H){O.abort(),H(F)}}}function j(M){const N=M.readable&&typeof M.readable.read!="function"?$.wrap(M.readable):M.readable,P=M.writable;let O=!!h(N),k=!!y(P),q,F,H,D,G;function W(K){const Z=D;D=null,Z?Z(K):K&&G.destroy(K)}return G=new X({readableObjectMode:!!(N!=null&&N.readableObjectMode),writableObjectMode:!!(P!=null&&P.writableObjectMode),readable:O,writable:k}),k&&(R(P,K=>{k=!1,K&&I(N,K),W(K)}),G._write=function(K,Z,ae){P.write(K,Z)?ae():q=ae},G._final=function(K){P.end(),F=K},P.on("drain",function(){if(q){const K=q;q=null,K()}}),P.on("finish",function(){if(F){const K=F;F=null,K()}})),O&&(R(N,K=>{O=!1,K&&I(N,K),W(K)}),N.on("readable",function(){if(H){const K=H;H=null,K()}}),N.on("end",function(){G.push(null)}),G._read=function(){for(;;){const K=N.read();if(K===null){H=G._read;return}if(!G.push(K))return}}),G._destroy=function(K,Z){!K&&D!==null&&(K=new x),H=null,q=null,F=null,D===null?Z(K):(D=Z,I(P,K),I(N,K))},G}return duplexify}var duplex,hasRequiredDuplex;function requireDuplex(){if(hasRequiredDuplex)return duplex;hasRequiredDuplex=1;const{ObjectDefineProperties:g,ObjectGetOwnPropertyDescriptor:u,ObjectKeys:h,ObjectSetPrototypeOf:y}=requirePrimordials();duplex=w;const v=requireReadable(),b=requireWritable();y(w.prototype,v.prototype),y(w,v);{const A=h(b.prototype);for(let R=0;R<A.length;R++){const x=A[R];w.prototype[x]||(w.prototype[x]=b.prototype[x])}}function w(A){if(!(this instanceof w))return new w(A);v.call(this,A),b.call(this,A),A?(this.allowHalfOpen=A.allowHalfOpen!==!1,A.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),A.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}g(w.prototype,{writable:{__proto__:null,...u(b.prototype,"writable")},writableHighWaterMark:{__proto__:null,...u(b.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...u(b.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...u(b.prototype,"writableBuffer")},writableLength:{__proto__:null,...u(b.prototype,"writableLength")},writableFinished:{__proto__:null,...u(b.prototype,"writableFinished")},writableCorked:{__proto__:null,...u(b.prototype,"writableCorked")},writableEnded:{__proto__:null,...u(b.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...u(b.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(A){this._readableState&&this._writableState&&(this._readableState.destroyed=A,this._writableState.destroyed=A)}}});let E;function _(){return E===void 0&&(E={}),E}w.fromWeb=function(A,R){return _().newStreamDuplexFromReadableWritablePair(A,R)},w.toWeb=function(A){return _().newReadableWritablePairFromDuplex(A)};let S;return w.from=function(A){return S||(S=requireDuplexify()),S(A,"body")},duplex}var transform,hasRequiredTransform;function requireTransform(){if(hasRequiredTransform)return transform;hasRequiredTransform=1;const{ObjectSetPrototypeOf:g,Symbol:u}=requirePrimordials();transform=w;const{ERR_METHOD_NOT_IMPLEMENTED:h}=requireErrors().codes,y=requireDuplex(),{getHighWaterMark:v}=requireState();g(w.prototype,y.prototype),g(w,y);const b=u("kCallback");function w(S){if(!(this instanceof w))return new w(S);const A=S?v(this,S,"readableHighWaterMark",!0):null;A===0&&(S={...S,highWaterMark:null,readableHighWaterMark:A,writableHighWaterMark:S.writableHighWaterMark||0}),y.call(this,S),this._readableState.sync=!1,this[b]=null,S&&(typeof S.transform=="function"&&(this._transform=S.transform),typeof S.flush=="function"&&(this._flush=S.flush)),this.on("prefinish",_)}function E(S){typeof this._flush=="function"&&!this.destroyed?this._flush((A,R)=>{if(A){S?S(A):this.destroy(A);return}R!=null&&this.push(R),this.push(null),S&&S()}):(this.push(null),S&&S())}function _(){this._final!==E&&E.call(this)}return w.prototype._final=E,w.prototype._transform=function(S,A,R){throw new h("_transform()")},w.prototype._write=function(S,A,R){const x=this._readableState,T=this._writableState,C=x.length;this._transform(S,A,(I,L)=>{if(I){R(I);return}L!=null&&this.push(L),T.ended||C===x.length||x.length<x.highWaterMark?R():this[b]=R})},w.prototype._read=function(){if(this[b]){const S=this[b];this[b]=null,S()}},transform}var passthrough,hasRequiredPassthrough;function requirePassthrough(){if(hasRequiredPassthrough)return passthrough;hasRequiredPassthrough=1;const{ObjectSetPrototypeOf:g}=requirePrimordials();passthrough=h;const u=requireTransform();g(h.prototype,u.prototype),g(h,u);function h(y){if(!(this instanceof h))return new h(y);u.call(this,y)}return h.prototype._transform=function(y,v,b){b(null,y)},passthrough}var pipeline_1,hasRequiredPipeline;function requirePipeline(){if(hasRequiredPipeline)return pipeline_1;hasRequiredPipeline=1;const g=requireDist(),{ArrayIsArray:u,Promise:h,SymbolAsyncIterator:y,SymbolDispose:v}=requirePrimordials(),b=requireEndOfStream$1(),{once:w}=requireUtil(),E=requireDestroy(),_=requireDuplex(),{aggregateTwoErrors:S,codes:{ERR_INVALID_ARG_TYPE:A,ERR_INVALID_RETURN_VALUE:R,ERR_MISSING_ARGS:x,ERR_STREAM_DESTROYED:T,ERR_STREAM_PREMATURE_CLOSE:C},AbortError:I}=requireErrors(),{validateFunction:L,validateAbortSignal:$}=requireValidators(),{isIterable:B,isReadable:U,isReadableNodeStream:z,isNodeStream:ne,isTransformStream:ue,isWebStream:he,isReadableStream:Y,isReadableFinished:X}=requireUtils(),J=globalThis.AbortController||require$$0.AbortController;let j,M,N;function P(K,Z,ae){let le=!1;K.on("close",()=>{le=!0});const te=b(K,{readable:Z,writable:ae},ce=>{le=!ce});return{destroy:ce=>{le||(le=!0,E.destroyer(K,ce||new T("pipe")))},cleanup:te}}function O(K){return L(K[K.length-1],"streams[stream.length - 1]"),K.pop()}function k(K){if(B(K))return K;if(z(K))return q(K);throw new A("val",["Readable","Iterable","AsyncIterable"],K)}async function*q(K){M||(M=requireReadable()),yield*M.prototype[y].call(K)}async function F(K,Z,ae,{end:le}){let te,ce=null;const ge=de=>{if(de&&(te=de),ce){const me=ce;ce=null,me()}},Ee=()=>new h((de,me)=>{te?me(te):ce=()=>{te?me(te):de()}});Z.on("drain",ge);const pe=b(Z,{readable:!1},ge);try{Z.writableNeedDrain&&await Ee();for await(const de of K)Z.write(de)||await Ee();le&&(Z.end(),await Ee()),ae()}catch(de){ae(te!==de?S(te,de):de)}finally{pe(),Z.off("drain",ge)}}async function H(K,Z,ae,{end:le}){ue(Z)&&(Z=Z.writable);const te=Z.getWriter();try{for await(const ce of K)await te.ready,te.write(ce).catch(()=>{});await te.ready,le&&await te.close(),ae()}catch(ce){try{await te.abort(ce),ae(ce)}catch(ge){ae(ge)}}}function D(...K){return G(K,w(O(K)))}function G(K,Z,ae){if(K.length===1&&u(K[0])&&(K=K[0]),K.length<2)throw new x("streams");const le=new J,te=le.signal,ce=ae?.signal,ge=[];$(ce,"options.signal");function Ee(){Me(new I)}N=N||requireUtil().addAbortListener;let pe;ce&&(pe=N(ce,Ee));let de,me;const _e=[];let Ae=0;function Pe(Oe){Me(Oe,--Ae===0)}function Me(Oe,Ce){var We;if(Oe&&(!de||de.code==="ERR_STREAM_PREMATURE_CLOSE")&&(de=Oe),!(!de&&!Ce)){for(;_e.length;)_e.shift()(de);(We=pe)===null||We===void 0||We[v](),le.abort(),Ce&&(de||ge.forEach(ze=>ze()),g.nextTick(Z,de,me))}}let Ne;for(let Oe=0;Oe<K.length;Oe++){const Ce=K[Oe],We=Oe<K.length-1,ze=Oe>0,Xe=We||ae?.end!==!1,it=Oe===K.length-1;if(ne(Ce)){let Je=function(bt){bt&&bt.name!=="AbortError"&&bt.code!=="ERR_STREAM_PREMATURE_CLOSE"&&Pe(bt)};if(Xe){const{destroy:bt,cleanup:Et}=P(Ce,We,ze);_e.push(bt),U(Ce)&&it&&ge.push(Et)}Ce.on("error",Je),U(Ce)&&it&&ge.push(()=>{Ce.removeListener("error",Je)})}if(Oe===0)if(typeof Ce=="function"){if(Ne=Ce({signal:te}),!B(Ne))throw new R("Iterable, AsyncIterable or Stream","source",Ne)}else B(Ce)||z(Ce)||ue(Ce)?Ne=Ce:Ne=_.from(Ce);else if(typeof Ce=="function"){if(ue(Ne)){var we;Ne=k((we=Ne)===null||we===void 0?void 0:we.readable)}else Ne=k(Ne);if(Ne=Ce(Ne,{signal:te}),We){if(!B(Ne,!0))throw new R("AsyncIterable",`transform[${Oe-1}]`,Ne)}else{var Le;j||(j=requirePassthrough());const Je=new j({objectMode:!0}),bt=(Le=Ne)===null||Le===void 0?void 0:Le.then;if(typeof bt=="function")Ae++,bt.call(Ne,wt=>{me=wt,wt!=null&&Je.write(wt),Xe&&Je.end(),g.nextTick(Pe)},wt=>{Je.destroy(wt),g.nextTick(Pe,wt)});else if(B(Ne,!0))Ae++,F(Ne,Je,Pe,{end:Xe});else if(Y(Ne)||ue(Ne)){const wt=Ne.readable||Ne;Ae++,F(wt,Je,Pe,{end:Xe})}else throw new R("AsyncIterable or Promise","destination",Ne);Ne=Je;const{destroy:Et,cleanup:lt}=P(Ne,!1,!0);_e.push(Et),it&&ge.push(lt)}}else if(ne(Ce)){if(z(Ne)){Ae+=2;const Je=W(Ne,Ce,Pe,{end:Xe});U(Ce)&&it&&ge.push(Je)}else if(ue(Ne)||Y(Ne)){const Je=Ne.readable||Ne;Ae++,F(Je,Ce,Pe,{end:Xe})}else if(B(Ne))Ae++,F(Ne,Ce,Pe,{end:Xe});else throw new A("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],Ne);Ne=Ce}else if(he(Ce)){if(z(Ne))Ae++,H(k(Ne),Ce,Pe,{end:Xe});else if(Y(Ne)||B(Ne))Ae++,H(Ne,Ce,Pe,{end:Xe});else if(ue(Ne))Ae++,H(Ne.readable,Ce,Pe,{end:Xe});else throw new A("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],Ne);Ne=Ce}else Ne=_.from(Ce)}return(te!=null&&te.aborted||ce!=null&&ce.aborted)&&g.nextTick(Ee),Ne}function W(K,Z,ae,{end:le}){let te=!1;if(Z.on("close",()=>{te||ae(new C)}),K.pipe(Z,{end:!1}),le){let ce=function(){te=!0,Z.end()};X(K)?g.nextTick(ce):K.once("end",ce)}else ae();return b(K,{readable:!0,writable:!1},ce=>{const ge=K._readableState;ce&&ce.code==="ERR_STREAM_PREMATURE_CLOSE"&&ge&&ge.ended&&!ge.errored&&!ge.errorEmitted?K.once("end",ae).once("error",ae):ae(ce)}),b(Z,{readable:!1,writable:!0},ae)}return pipeline_1={pipelineImpl:G,pipeline:D},pipeline_1}var compose,hasRequiredCompose;function requireCompose(){if(hasRequiredCompose)return compose;hasRequiredCompose=1;const{pipeline:g}=requirePipeline(),u=requireDuplex(),{destroyer:h}=requireDestroy(),{isNodeStream:y,isReadable:v,isWritable:b,isWebStream:w,isTransformStream:E,isWritableStream:_,isReadableStream:S}=requireUtils(),{AbortError:A,codes:{ERR_INVALID_ARG_VALUE:R,ERR_MISSING_ARGS:x}}=requireErrors(),T=requireEndOfStream$1();return compose=function(...I){if(I.length===0)throw new x("streams");if(I.length===1)return u.from(I[0]);const L=[...I];if(typeof I[0]=="function"&&(I[0]=u.from(I[0])),typeof I[I.length-1]=="function"){const j=I.length-1;I[j]=u.from(I[j])}for(let j=0;j<I.length;++j)if(!(!y(I[j])&&!w(I[j]))){if(j<I.length-1&&!(v(I[j])||S(I[j])||E(I[j])))throw new R(`streams[${j}]`,L[j],"must be readable");if(j>0&&!(b(I[j])||_(I[j])||E(I[j])))throw new R(`streams[${j}]`,L[j],"must be writable")}let $,B,U,z,ne;function ue(j){const M=z;z=null,M?M(j):j?ne.destroy(j):!J&&!X&&ne.destroy()}const he=I[0],Y=g(I,ue),X=!!(b(he)||_(he)||E(he)),J=!!(v(Y)||S(Y)||E(Y));if(ne=new u({writableObjectMode:!!(he!=null&&he.writableObjectMode),readableObjectMode:!!(Y!=null&&Y.readableObjectMode),writable:X,readable:J}),X){if(y(he))ne._write=function(M,N,P){he.write(M,N)?P():$=P},ne._final=function(M){he.end(),B=M},he.on("drain",function(){if($){const M=$;$=null,M()}});else if(w(he)){const N=(E(he)?he.writable:he).getWriter();ne._write=async function(P,O,k){try{await N.ready,N.write(P).catch(()=>{}),k()}catch(q){k(q)}},ne._final=async function(P){try{await N.ready,N.close().catch(()=>{}),B=P}catch(O){P(O)}}}const j=E(Y)?Y.readable:Y;T(j,()=>{if(B){const M=B;B=null,M()}})}if(J){if(y(Y))Y.on("readable",function(){if(U){const j=U;U=null,j()}}),Y.on("end",function(){ne.push(null)}),ne._read=function(){for(;;){const j=Y.read();if(j===null){U=ne._read;return}if(!ne.push(j))return}};else if(w(Y)){const M=(E(Y)?Y.readable:Y).getReader();ne._read=async function(){for(;;)try{const{value:N,done:P}=await M.read();if(!ne.push(N))return;if(P){ne.push(null);return}}catch{return}}}}return ne._destroy=function(j,M){!j&&z!==null&&(j=new A),U=null,$=null,B=null,z===null?M(j):(z=M,y(Y)&&h(Y,j))},ne},compose}var hasRequiredOperators;function requireOperators(){if(hasRequiredOperators)return operators;hasRequiredOperators=1;const g=globalThis.AbortController||require$$0.AbortController,{codes:{ERR_INVALID_ARG_VALUE:u,ERR_INVALID_ARG_TYPE:h,ERR_MISSING_ARGS:y,ERR_OUT_OF_RANGE:v},AbortError:b}=requireErrors(),{validateAbortSignal:w,validateInteger:E,validateObject:_}=requireValidators(),S=requirePrimordials().Symbol("kWeak"),A=requirePrimordials().Symbol("kResistStopPropagation"),{finished:R}=requireEndOfStream$1(),x=requireCompose(),{addAbortSignalNoValidate:T}=requireAddAbortSignal(),{isWritable:C,isNodeStream:I}=requireUtils(),{deprecate:L}=requireUtil(),{ArrayPrototypePush:$,Boolean:B,MathFloor:U,Number:z,NumberIsNaN:ne,Promise:ue,PromiseReject:he,PromiseResolve:Y,PromisePrototypeThen:X,Symbol:J}=requirePrimordials(),j=J("kEmpty"),M=J("kEof");function N(ce,ge){if(ge!=null&&_(ge,"options"),ge?.signal!=null&&w(ge.signal,"options.signal"),I(ce)&&!C(ce))throw new u("stream",ce,"must be writable");const Ee=x(this,ce);return ge!=null&&ge.signal&&T(ge.signal,Ee),Ee}function P(ce,ge){if(typeof ce!="function")throw new h("fn",["Function","AsyncFunction"],ce);ge!=null&&_(ge,"options"),ge?.signal!=null&&w(ge.signal,"options.signal");let Ee=1;ge?.concurrency!=null&&(Ee=U(ge.concurrency));let pe=Ee-1;return ge?.highWaterMark!=null&&(pe=U(ge.highWaterMark)),E(Ee,"options.concurrency",1),E(pe,"options.highWaterMark",0),pe+=Ee,(async function*(){const me=requireUtil().AbortSignalAny([ge?.signal].filter(B)),_e=this,Ae=[],Pe={signal:me};let Me,Ne,we=!1,Le=0;function Oe(){we=!0,Ce()}function Ce(){Le-=1,We()}function We(){Ne&&!we&&Le<Ee&&Ae.length<pe&&(Ne(),Ne=null)}async function ze(){try{for await(let Xe of _e){if(we)return;if(me.aborted)throw new b;try{if(Xe=ce(Xe,Pe),Xe===j)continue;Xe=Y(Xe)}catch(it){Xe=he(it)}Le+=1,X(Xe,Ce,Oe),Ae.push(Xe),Me&&(Me(),Me=null),!we&&(Ae.length>=pe||Le>=Ee)&&await new ue(it=>{Ne=it})}Ae.push(M)}catch(Xe){const it=he(Xe);X(it,Ce,Oe),Ae.push(it)}finally{we=!0,Me&&(Me(),Me=null)}}ze();try{for(;;){for(;Ae.length>0;){const Xe=await Ae[0];if(Xe===M)return;if(me.aborted)throw new b;Xe!==j&&(yield Xe),Ae.shift(),We()}await new ue(Xe=>{Me=Xe})}}finally{we=!0,Ne&&(Ne(),Ne=null)}}).call(this)}function O(ce=void 0){return ce!=null&&_(ce,"options"),ce?.signal!=null&&w(ce.signal,"options.signal"),(async function*(){let Ee=0;for await(const de of this){var pe;if(ce!=null&&(pe=ce.signal)!==null&&pe!==void 0&&pe.aborted)throw new b({cause:ce.signal.reason});yield[Ee++,de]}}).call(this)}async function k(ce,ge=void 0){for await(const Ee of D.call(this,ce,ge))return!0;return!1}async function q(ce,ge=void 0){if(typeof ce!="function")throw new h("fn",["Function","AsyncFunction"],ce);return!await k.call(this,async(...Ee)=>!await ce(...Ee),ge)}async function F(ce,ge){for await(const Ee of D.call(this,ce,ge))return Ee}async function H(ce,ge){if(typeof ce!="function")throw new h("fn",["Function","AsyncFunction"],ce);async function Ee(pe,de){return await ce(pe,de),j}for await(const pe of P.call(this,Ee,ge));}function D(ce,ge){if(typeof ce!="function")throw new h("fn",["Function","AsyncFunction"],ce);async function Ee(pe,de){return await ce(pe,de)?pe:j}return P.call(this,Ee,ge)}class G extends y{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}}async function W(ce,ge,Ee){var pe;if(typeof ce!="function")throw new h("reducer",["Function","AsyncFunction"],ce);Ee!=null&&_(Ee,"options"),Ee?.signal!=null&&w(Ee.signal,"options.signal");let de=arguments.length>1;if(Ee!=null&&(pe=Ee.signal)!==null&&pe!==void 0&&pe.aborted){const Me=new b(void 0,{cause:Ee.signal.reason});throw this.once("error",()=>{}),await R(this.destroy(Me)),Me}const me=new g,_e=me.signal;if(Ee!=null&&Ee.signal){const Me={once:!0,[S]:this,[A]:!0};Ee.signal.addEventListener("abort",()=>me.abort(),Me)}let Ae=!1;try{for await(const Me of this){var Pe;if(Ae=!0,Ee!=null&&(Pe=Ee.signal)!==null&&Pe!==void 0&&Pe.aborted)throw new b;de?ge=await ce(ge,Me,{signal:_e}):(ge=Me,de=!0)}if(!Ae&&!de)throw new G}finally{me.abort()}return ge}async function K(ce){ce!=null&&_(ce,"options"),ce?.signal!=null&&w(ce.signal,"options.signal");const ge=[];for await(const pe of this){var Ee;if(ce!=null&&(Ee=ce.signal)!==null&&Ee!==void 0&&Ee.aborted)throw new b(void 0,{cause:ce.signal.reason});$(ge,pe)}return ge}function Z(ce,ge){const Ee=P.call(this,ce,ge);return(async function*(){for await(const de of Ee)yield*de}).call(this)}function ae(ce){if(ce=z(ce),ne(ce))return 0;if(ce<0)throw new v("number",">= 0",ce);return ce}function le(ce,ge=void 0){return ge!=null&&_(ge,"options"),ge?.signal!=null&&w(ge.signal,"options.signal"),ce=ae(ce),(async function*(){var pe;if(ge!=null&&(pe=ge.signal)!==null&&pe!==void 0&&pe.aborted)throw new b;for await(const me of this){var de;if(ge!=null&&(de=ge.signal)!==null&&de!==void 0&&de.aborted)throw new b;ce--<=0&&(yield me)}}).call(this)}function te(ce,ge=void 0){return ge!=null&&_(ge,"options"),ge?.signal!=null&&w(ge.signal,"options.signal"),ce=ae(ce),(async function*(){var pe;if(ge!=null&&(pe=ge.signal)!==null&&pe!==void 0&&pe.aborted)throw new b;for await(const me of this){var de;if(ge!=null&&(de=ge.signal)!==null&&de!==void 0&&de.aborted)throw new b;if(ce-- >0&&(yield me),ce<=0)return}}).call(this)}return operators.streamReturningOperators={asIndexedPairs:L(O,"readable.asIndexedPairs will be removed in a future version."),drop:le,filter:D,flatMap:Z,map:P,take:te,compose:N},operators.promiseReturningOperators={every:q,forEach:H,reduce:W,toArray:K,some:k,find:F},operators}var promises,hasRequiredPromises;function requirePromises(){if(hasRequiredPromises)return promises;hasRequiredPromises=1;const{ArrayPrototypePop:g,Promise:u}=requirePrimordials(),{isIterable:h,isNodeStream:y,isWebStream:v}=requireUtils(),{pipelineImpl:b}=requirePipeline(),{finished:w}=requireEndOfStream$1();requireStream();function E(..._){return new u((S,A)=>{let R,x;const T=_[_.length-1];if(T&&typeof T=="object"&&!y(T)&&!h(T)&&!v(T)){const C=g(_);R=C.signal,x=C.end}b(_,(C,I)=>{C?A(C):S(I)},{signal:R,end:x})})}return promises={finished:w,pipeline:E},promises}var hasRequiredStream;function requireStream(){if(hasRequiredStream)return stream.exports;hasRequiredStream=1;const{Buffer:g}=requireDist$1(),{ObjectDefineProperty:u,ObjectKeys:h,ReflectApply:y}=requirePrimordials(),{promisify:{custom:v}}=requireUtil(),{streamReturningOperators:b,promiseReturningOperators:w}=requireOperators(),{codes:{ERR_ILLEGAL_CONSTRUCTOR:E}}=requireErrors(),_=requireCompose(),{setDefaultHighWaterMark:S,getDefaultHighWaterMark:A}=requireState(),{pipeline:R}=requirePipeline(),{destroyer:x}=requireDestroy(),T=requireEndOfStream$1(),C=requirePromises(),I=requireUtils(),L=stream.exports=requireLegacy().Stream;L.isDestroyed=I.isDestroyed,L.isDisturbed=I.isDisturbed,L.isErrored=I.isErrored,L.isReadable=I.isReadable,L.isWritable=I.isWritable,L.Readable=requireReadable();for(const B of h(b)){let z=function(...ne){if(new.target)throw E();return L.Readable.from(y(U,this,ne))};const U=b[B];u(z,"name",{__proto__:null,value:U.name}),u(z,"length",{__proto__:null,value:U.length}),u(L.Readable.prototype,B,{__proto__:null,value:z,enumerable:!1,configurable:!0,writable:!0})}for(const B of h(w)){let z=function(...ne){if(new.target)throw E();return y(U,this,ne)};const U=w[B];u(z,"name",{__proto__:null,value:U.name}),u(z,"length",{__proto__:null,value:U.length}),u(L.Readable.prototype,B,{__proto__:null,value:z,enumerable:!1,configurable:!0,writable:!0})}L.Writable=requireWritable(),L.Duplex=requireDuplex(),L.Transform=requireTransform(),L.PassThrough=requirePassthrough(),L.pipeline=R;const{addAbortSignal:$}=requireAddAbortSignal();return L.addAbortSignal=$,L.finished=T,L.destroy=x,L.compose=_,L.setDefaultHighWaterMark=S,L.getDefaultHighWaterMark=A,u(L,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return C}}),u(R,v,{__proto__:null,enumerable:!0,get(){return C.pipeline}}),u(T,v,{__proto__:null,enumerable:!0,get(){return C.finished}}),L.Stream=L,L._isUint8Array=function(U){return U instanceof Uint8Array},L._uint8ArrayToBuffer=function(U){return g.from(U.buffer,U.byteOffset,U.byteLength)},stream.exports}var hasRequiredBrowser;function requireBrowser(){return hasRequiredBrowser||(hasRequiredBrowser=1,(function(g){const u=requireStream(),h=requirePromises(),y=u.Readable.destroy;g.exports=u.Readable,g.exports._uint8ArrayToBuffer=u._uint8ArrayToBuffer,g.exports._isUint8Array=u._isUint8Array,g.exports.isDisturbed=u.isDisturbed,g.exports.isErrored=u.isErrored,g.exports.isReadable=u.isReadable,g.exports.Readable=u.Readable,g.exports.Writable=u.Writable,g.exports.Duplex=u.Duplex,g.exports.Transform=u.Transform,g.exports.PassThrough=u.PassThrough,g.exports.addAbortSignal=u.addAbortSignal,g.exports.finished=u.finished,g.exports.destroy=u.destroy,g.exports.destroy=y,g.exports.pipeline=u.pipeline,g.exports.compose=u.compose,Object.defineProperty(u,"promises",{configurable:!0,enumerable:!0,get(){return h}}),g.exports.Stream=u.Stream,g.exports.default=g.exports})(browser)),browser.exports}var browserExports=requireBrowser();function safeApply(g,u,h){try{Reflect.apply(g,u,h)}catch(y){setTimeout(()=>{throw y})}}function arrayClone(g){const u=g.length,h=new Array(u);for(let y=0;y<u;y+=1)h[y]=g[y];return h}class SafeEventEmitter extends eventsExports.EventEmitter{emit(u,...h){let y=u==="error";const v=this._events;if(v!==void 0)y=y&&v.error===void 0;else if(!y)return!1;if(y){let w;if(h.length>0&&([w]=h),w instanceof Error)throw w;const E=new Error(`Unhandled error.${w?` (${w.message})`:""}`);throw E.context=w,E}const b=v[u];if(b===void 0)return!1;if(typeof b=="function")safeApply(b,this,h);else{const w=b.length,E=arrayClone(b);for(let _=0;_<w;_+=1)safeApply(E[_],this,h)}return!0}}class SerializableError extends Error{constructor({code:u,message:h,data:y}){if(!Number.isInteger(u))throw new Error("code must be an integer");if(!h||typeof h!="string")throw new Error("message must be string");super(h),_defineProperty(this,"code",void 0),_defineProperty(this,"data",void 0),this.code=u,y!==void 0&&(this.data=y)}toString(){return stringify({code:this.code,message:this.message,data:this.data,stack:this.stack})}}class Substream extends browserExports.Duplex{constructor({parent:u,name:h}){super({objectMode:!0}),_defineProperty(this,"_parent",void 0),_defineProperty(this,"_name",void 0),this._parent=u,this._name=h}_read(){}_write(u,h,y){this._parent.push({name:this._name,data:u}),y()}}const errorCodes={rpc:{invalidInput:-32e3,resourceNotFound:-32001,resourceUnavailable:-32002,transactionRejected:-32003,methodNotSupported:-32004,limitExceeded:-32005,parse:-32700,invalidRequest:-32600,methodNotFound:-32601,invalidParams:-32602,internal:-32603},provider:{userRejectedRequest:4001,unauthorized:4100,unsupportedMethod:4200,disconnected:4900,chainDisconnected:4901}},errorValues={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."}},FALLBACK_ERROR_CODE=errorCodes.rpc.internal,FALLBACK_MESSAGE="Unspecified error message. This is a bug, please report it.",JSON_RPC_SERVER_ERROR_MESSAGE="Unspecified server error.";function isValidCode(g){return Number.isInteger(g)}function isValidString(g){return typeof g=="string"&&g.length>0}function isObject(g){return!!g&&typeof g=="object"&&!Array.isArray(g)}function isPlainObject(g){if(typeof g!="object"||g===null)return!1;try{let u=g;for(;Object.getPrototypeOf(u)!==null;)u=Object.getPrototypeOf(u);return Object.getPrototypeOf(g)===u}catch{return!1}}function isJsonRpcServerError(g){return g>=-32099&&g<=-32e3}function isJsonRpcError(g){const u=g;return!(!u||!isValidCode(u.code)||!isValidString(u.message)||u.stack&&!isValidString(u.stack))}function getMessageFromCode(g,u=FALLBACK_MESSAGE){if(isValidCode(g)){const h=g.toString();if(Object.hasOwn(errorValues,h))return errorValues[h].message;if(isJsonRpcServerError(g))return JSON_RPC_SERVER_ERROR_MESSAGE}return u}const FALLBACK_ERROR={code:FALLBACK_ERROR_CODE,message:getMessageFromCode(FALLBACK_ERROR_CODE)};function isValidJson(g){try{JSON.parse(JSON.stringify(g,(u,h)=>{if(u==="__proto__"||u==="constructor")throw new Error("Not valid json");if(typeof h=="function"||typeof h=="symbol")throw new Error("Not valid json");return h}),(u,h)=>{if(!(u==="__proto__"||u==="constructor"))return h})}catch{return!1}return!0}function serializeObject(g){return Object.getOwnPropertyNames(g).reduce((u,h)=>{const y=g[h];return isValidJson(y)&&(u[h]=y),u},{})}function serializeCause(g){return Array.isArray(g)?g.map(u=>isValidJson(u)?u:isObject(u)?serializeObject(u):null):isObject(g)?serializeObject(g):isValidJson(g)?g:null}function buildError(g,u){if(g&&typeof g=="object"&&"serialize"in g&&typeof g.serialize=="function")return g.serialize();if(isJsonRpcError(g))return g;const h=serializeCause(g);return _objectSpread2(_objectSpread2({},u),{},{data:{cause:h}})}function serializeError$1(g,{fallbackError:u=FALLBACK_ERROR,shouldIncludeStack:h=!0}={}){if(!isJsonRpcError(u))throw new Error("Must provide fallback error with integer number code and string message.");const y=buildError(g,u);return h||delete y.stack,y}function dataHasCause(g){return isObject(g)&&Object.hasOwn(g,"cause")&&isObject(g.cause)}function isValidEthProviderCode(g){return Number.isInteger(g)&&g>=1e3&&g<=4999}function stringifyReplacer(g,u){if(u!=="[Circular]")return u}class JsonRpcError extends Error{constructor(u,h,y){if(!Number.isInteger(u))throw new Error('"code" must be an integer.');if(!h||typeof h!="string")throw new Error('"message" must be a non-empty string.');dataHasCause(y)?(super(h,{cause:y.cause}),_defineProperty(this,"cause",void 0),_defineProperty(this,"code",void 0),_defineProperty(this,"data",void 0),Object.hasOwn(this,"cause")||Object.assign(this,{cause:y.cause})):(super(h),_defineProperty(this,"cause",void 0),_defineProperty(this,"code",void 0),_defineProperty(this,"data",void 0)),y!==void 0&&(this.data=y),this.code=u,this.cause=y?.cause}serialize(){const u={code:this.code,message:this.message};return this.data!==void 0&&(u.data=this.data,isPlainObject(this.data)&&(u.data.cause=serializeCause(this.data.cause))),this.stack&&(u.stack=this.stack),u}toString(){return stringify(this.serialize(),{replacer:stringifyReplacer,space:2})}}class EthereumProviderError extends JsonRpcError{constructor(u,h,y){if(!isValidEthProviderCode(u))throw new Error('"code" must be an integer such that: 1000 <= code <= 4999');super(u,h,y)}}function parseOpts(g){if(g){if(typeof g=="string")return[g];if(typeof g=="object"&&!Array.isArray(g)){const{message:u,data:h}=g;if(u&&typeof u!="string")throw new Error("Must specify string message.");return[u??void 0,h]}}return[]}function getJsonRpcError(g,u){const[h,y]=parseOpts(u);return new JsonRpcError(g,h??getMessageFromCode(g),y)}function getEthProviderError(g,u){const[h,y]=parseOpts(u);return new EthereumProviderError(g,h??getMessageFromCode(g),y)}const rpcErrors={parse:g=>getJsonRpcError(errorCodes.rpc.parse,g),invalidRequest:g=>getJsonRpcError(errorCodes.rpc.invalidRequest,g),invalidParams:g=>getJsonRpcError(errorCodes.rpc.invalidParams,g),methodNotFound:g=>getJsonRpcError(errorCodes.rpc.methodNotFound,g),internal:g=>getJsonRpcError(errorCodes.rpc.internal,g),server:g=>{if(!g||typeof g!="object"||Array.isArray(g))throw new Error("Ethereum RPC Server errors must provide single object argument.");const{code:u}=g;if(!Number.isInteger(u)||u>-32005||u<-32099)throw new Error('"code" must be an integer such that: -32099 <= code <= -32005');return getJsonRpcError(u,g)},invalidInput:g=>getJsonRpcError(errorCodes.rpc.invalidInput,g),resourceNotFound:g=>getJsonRpcError(errorCodes.rpc.resourceNotFound,g),resourceUnavailable:g=>getJsonRpcError(errorCodes.rpc.resourceUnavailable,g),transactionRejected:g=>getJsonRpcError(errorCodes.rpc.transactionRejected,g),methodNotSupported:g=>getJsonRpcError(errorCodes.rpc.methodNotSupported,g),limitExceeded:g=>getJsonRpcError(errorCodes.rpc.limitExceeded,g)},providerErrors={userRejectedRequest:g=>getEthProviderError(errorCodes.provider.userRejectedRequest,g),unauthorized:g=>getEthProviderError(errorCodes.provider.unauthorized,g),unsupportedMethod:g=>getEthProviderError(errorCodes.provider.unsupportedMethod,g),disconnected:g=>getEthProviderError(errorCodes.provider.disconnected,g),chainDisconnected:g=>getEthProviderError(errorCodes.provider.chainDisconnected,g),custom:g=>{if(!g||typeof g!="object"||Array.isArray(g))throw new Error("Ethereum Provider custom errors must provide single object argument.");const{code:u,message:h,data:y}=g;if(!h||typeof h!="string")throw new Error('"message" must be a nonempty string');return new EthereumProviderError(u,h,y)}},getRpcPromiseCallback=(g,u,h=!0)=>(y,v)=>{y||v.error?u(y||v.error):!h||Array.isArray(v)?g(v):g(v.result)};function createStreamMiddleware(){const g={};function u(){return!1}const h=new SafeEventEmitter;function y(_){const S=g[_.id];if(!S)throw new Error(`StreamMiddleware - Unknown response id "${_.id}"`);delete g[_.id],Object.assign(S.res,_),setTimeout(S.end)}function v(_){h.emit("notification",_)}function b(_,S,A){let R;try{!_.id?v(_):y(_)}catch(x){R=x}A(R)}const w=new browserExports.Duplex({objectMode:!0,read:u,write:b});return{events:h,middleware:(_,S,A,R)=>{w.push(_),g[_.id]={req:_,res:S,next:A,end:R}},stream:w}}function createIdRemapMiddleware(){return(g,u,h,y)=>{const v=g.id,b=Math.random().toString(36).slice(2);g.id=b,u.id=b,h(w=>{g.id=v,u.id=v,w()})}}function createAsyncMiddleware(g){return async(u,h,y,v)=>{let b;const w=new Promise(A=>{b=A});let E=null,_=!1;const S=async()=>{_=!0,y(A=>{E=A,b()}),await w};try{await g(u,h,S),_?(await w,E(null)):v(null)}catch(A){const R=A;E?E(R):v(R)}}}function constructFallbackError(g){const{message:u="",code:h=-32603,stack:y="Stack trace is not available.",data:v=""}=g,b=parseInt(h?.toString()||"-32603");return{message:u||g?.toString()||getMessageFromCode(b),code:b,stack:y,data:v||u||g?.toString()}}class JRPCEngine extends SafeEventEmitter{constructor(){super(),_defineProperty(this,"_middleware",void 0),this._middleware=[]}static async _runAllMiddleware(u,h,y){const v=[];let b=null,w=!1;for(const E of y)if([b,w]=await JRPCEngine._runMiddleware(u,h,E,v),w)break;return[b,w,v.reverse()]}static _runMiddleware(u,h,y,v){return new Promise(b=>{const w=_=>{const S=_||h.error;S&&(typeof S=="object"&&Object.keys(S).includes("stack")===!1&&(S.stack="Stack trace is not available."),loglevel$1.error(S),h.error=serializeError$1(S,{shouldIncludeStack:!0,fallbackError:constructFallbackError(S)})),b([S,!0])},E=_=>{h.error?w(h.error):(_&&(typeof _!="function"&&w(new SerializableError({code:-32603,message:"JRPCEngine: 'next' return handlers must be functions"})),v.push(_)),b([null,!1]))};try{y(u,h,E,w)}catch(_){w(_)}})}static async _runReturnHandlers(u){for(const h of u)await new Promise((y,v)=>{h(b=>b?v(b):y())})}static _checkForCompletion(u,h,y){if(!("result"in h)&&!("error"in h))throw new SerializableError({code:-32603,message:"Response has no error or result for request"});if(!y)throw new SerializableError({code:-32603,message:"Nothing ended request"})}push(u){this._middleware.push(u)}handle(u,h){if(h&&typeof h!="function")throw new Error('"callback" must be a function if provided.');return Array.isArray(u)?h?this._handleBatch(u,h):this._handleBatch(u):h?this._handle(u,h):this._promiseHandle(u)}asMiddleware(){return async(u,h,y,v)=>{try{const[b,w,E]=await JRPCEngine._runAllMiddleware(u,h,this._middleware);return w?(await JRPCEngine._runReturnHandlers(E),v(b)):y(async _=>{try{await JRPCEngine._runReturnHandlers(E)}catch(S){return _(S)}return _()})}catch(b){return v(b)}}}async _handleBatch(u,h){try{const y=await Promise.all(u.map(this._promiseHandle.bind(this)));return h?h(null,y):y}catch(y){if(h)return h(y);throw y}}_promiseHandle(u){return new Promise((h,y)=>{this._handle(u,(v,b)=>{v&&b===void 0?y(v):h(b)}).catch(y)})}async _handle(u,h){if(!u||Array.isArray(u)||typeof u!="object"){const w=new SerializableError({code:-32603,message:"request must be plain object"});return h(w,{id:void 0,jsonrpc:"2.0",error:w})}if(typeof u.method!="string"){const w=new SerializableError({code:-32603,message:"method must be string"});return h(w,{id:u.id,jsonrpc:"2.0",error:w})}const y=_objectSpread2({},u),v={id:y.id,jsonrpc:y.jsonrpc};let b=null;try{await this._processRequest(y,v)}catch(w){b=w}return b&&(delete v.result,v.error||(typeof b=="object"&&Object.keys(b).includes("stack")===!1&&(b.stack="Stack trace is not available."),loglevel$1.error(b),v.error=serializeError$1(b,{shouldIncludeStack:!0,fallbackError:constructFallbackError(b)}))),h(b,v)}async _processRequest(u,h){const[y,v,b]=await JRPCEngine._runAllMiddleware(u,h,this._middleware);if(JRPCEngine._checkForCompletion(u,h,v),await JRPCEngine._runReturnHandlers(b),y)throw y}}function mergeMiddleware(g){const u=new JRPCEngine;return g.forEach(h=>{u.push(h)}),u.asMiddleware()}function providerFromEngine(g){const u=new SafeEventEmitter;return u.sendAsync=async h=>{const y=await g.handle(h);if(y.error){typeof y.error=="object"&&Object.keys(y.error).includes("stack")===!1&&(y.error.stack="Stack trace is not available."),loglevel$1.error(y.error);const v=serializeError$1(y.error,{fallbackError:constructFallbackError(y.error),shouldIncludeStack:!0});throw rpcErrors.internal(v)}return y.result},u.send=(h,y)=>{if(typeof y!="function")throw new Error('Must provide callback to "send" method.');g.handle(h,y)},g.on&&g.on("notification",h=>{u.emit("data",null,h)}),u.request=async h=>{const y=_objectSpread2(_objectSpread2({},h),{},{id:Math.random().toString(36).slice(2),jsonrpc:"2.0"});return await u.sendAsync(y)},u}var once$1={exports:{}},wrappy_1,hasRequiredWrappy;function requireWrappy(){if(hasRequiredWrappy)return wrappy_1;hasRequiredWrappy=1,wrappy_1=g;function g(u,h){if(u&&h)return g(u)(h);if(typeof u!="function")throw new TypeError("need wrapper function");return Object.keys(u).forEach(function(v){y[v]=u[v]}),y;function y(){for(var v=new Array(arguments.length),b=0;b<v.length;b++)v[b]=arguments[b];var w=u.apply(this,v),E=v[v.length-1];return typeof w=="function"&&w!==E&&Object.keys(E).forEach(function(_){w[_]=E[_]}),w}}return wrappy_1}var hasRequiredOnce;function requireOnce(){if(hasRequiredOnce)return once$1.exports;hasRequiredOnce=1;var g=requireWrappy();once$1.exports=g(u),once$1.exports.strict=g(h),u.proto=u(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return u(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return h(this)},configurable:!0})});function u(y){var v=function(){return v.called?v.value:(v.called=!0,v.value=y.apply(this,arguments))};return v.called=!1,v}function h(y){var v=function(){if(v.called)throw new Error(v.onceError);return v.called=!0,v.value=y.apply(this,arguments)},b=y.name||"Function wrapped with `once`";return v.onceError=b+" shouldn't be called more than once",v.called=!1,v}return once$1.exports}var endOfStream,hasRequiredEndOfStream;function requireEndOfStream(){if(hasRequiredEndOfStream)return endOfStream;hasRequiredEndOfStream=1;var g=requireOnce(),u=function(){},h=globalThis.Bare?queueMicrotask:process$1.nextTick.bind(process$1),y=function(w){return w.setHeader&&typeof w.abort=="function"},v=function(w){return w.stdio&&Array.isArray(w.stdio)&&w.stdio.length===3},b=function(w,E,_){if(typeof E=="function")return b(w,null,E);E||(E={}),_=g(_||u);var S=w._writableState,A=w._readableState,R=E.readable||E.readable!==!1&&w.readable,x=E.writable||E.writable!==!1&&w.writable,T=!1,C=function(){w.writable||I()},I=function(){x=!1,R||_.call(w)},L=function(){R=!1,x||_.call(w)},$=function(ue){_.call(w,ue?new Error("exited with error code: "+ue):null)},B=function(ue){_.call(w,ue)},U=function(){h(z)},z=function(){if(!T){if(R&&!(A&&A.ended&&!A.destroyed))return _.call(w,new Error("premature close"));if(x&&!(S&&S.ended&&!S.destroyed))return _.call(w,new Error("premature close"))}},ne=function(){w.req.on("finish",I)};return y(w)?(w.on("complete",I),w.on("abort",U),w.req?ne():w.on("request",ne)):x&&!S&&(w.on("end",C),w.on("close",C)),v(w)&&w.on("exit",$),w.on("end",L),w.on("finish",I),E.error!==!1&&w.on("error",B),w.on("close",U),function(){T=!0,w.removeListener("complete",I),w.removeListener("abort",U),w.removeListener("request",ne),w.req&&w.req.removeListener("finish",I),w.removeListener("end",C),w.removeListener("close",C),w.removeListener("finish",I),w.removeListener("exit",$),w.removeListener("end",L),w.removeListener("error",B),w.removeListener("close",U)}};return endOfStream=b,endOfStream}var endOfStreamExports=requireEndOfStream();const eos=getDefaultExportFromCjs(endOfStreamExports);var onceExports=requireOnce();const once=getDefaultExportFromCjs(onceExports),fs={},__viteBrowserExternal=Object.freeze(Object.defineProperty({__proto__:null,default:fs},Symbol.toStringTag,{value:"Module"})),require$$8=getAugmentedNamespace(__viteBrowserExternal);var pump_1,hasRequiredPump;function requirePump(){if(hasRequiredPump)return pump_1;hasRequiredPump=1;var g=requireOnce(),u=requireEndOfStream(),h;try{h=require$$8}catch{}var y=function(){},v=typeof process$1>"u"?!1:/^v?\.0/.test(process$1.version),b=function(x){return typeof x=="function"},w=function(x){return!v||!h?!1:(x instanceof(h.ReadStream||y)||x instanceof(h.WriteStream||y))&&b(x.close)},E=function(x){return x.setHeader&&b(x.abort)},_=function(x,T,C,I){I=g(I);var L=!1;x.on("close",function(){L=!0}),u(x,{readable:T,writable:C},function(B){if(B)return I(B);L=!0,I()});var $=!1;return function(B){if(!L&&!$){if($=!0,w(x))return x.close(y);if(E(x))return x.abort();if(b(x.destroy))return x.destroy();I(B||new Error("stream was destroyed"))}}},S=function(x){x()},A=function(x,T){return x.pipe(T)},R=function(){var x=Array.prototype.slice.call(arguments),T=b(x[x.length-1]||y)&&x.pop()||y;if(Array.isArray(x[0])&&(x=x[0]),x.length<2)throw new Error("pump requires two streams per minimum");var C,I=x.map(function(L,$){var B=$<x.length-1,U=$>0;return _(L,B,U,function(z){C||(C=z),z&&I.forEach(S),!B&&(I.forEach(S),T(C))})});return x.reduce(A)};return pump_1=R,pump_1}var pumpExports=requirePump();const pump=getDefaultExportFromCjs(pumpExports),IGNORE_SUBSTREAM=Symbol("IGNORE_SUBSTREAM");class ObjectMultiplex extends browserExports.Duplex{constructor(u={}){super(_objectSpread2(_objectSpread2({},u),{},{objectMode:!0})),_defineProperty(this,"_substreams",void 0),_defineProperty(this,"getStream",void 0),this._substreams={}}createStream(u){if(!u)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[u])throw new Error(`ObjectMultiplex - Substream for name "${u}" already exists`);const h=new Substream({parent:this,name:u});return this._substreams[u]=h,anyStreamEnd(this,y=>h.destroy(y||void 0)),h}ignoreStream(u){if(!u)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[u])throw new Error(`ObjectMultiplex - Substream for name "${u}" already exists`);this._substreams[u]=IGNORE_SUBSTREAM}_read(){}_write(u,h,y){const{name:v,data:b}=u;if(!v)return window.console.warn(`ObjectMultiplex - malformed chunk without name "${u}"`),y();const w=this._substreams[v];return w?(w!==IGNORE_SUBSTREAM&&w.push(b),y()):(window.console.warn(`ObjectMultiplex - orphaned data for stream "${v}"`),y())}}function anyStreamEnd(g,u){const h=once(u);eos(g,{readable:!1},h),eos(g,{writable:!1},h)}function padToEven(g){let u=g;if(typeof u!="string")throw new Error(`[padToEven] value must be type 'string', received ${typeof u}`);return u.length%2&&(u=`0${u}`),u}BigInt(0);const hexToBytesMapFirstKey={},hexToBytesMapSecondKey={};for(let g=0;g<16;g++){const u=g,h=g*16,y=g.toString(16).toLowerCase();hexToBytesMapSecondKey[y]=u,hexToBytesMapSecondKey[y.toUpperCase()]=u,hexToBytesMapFirstKey[y]=h,hexToBytesMapFirstKey[y.toUpperCase()]=h}function _unprefixedHexToBytes(g){const u=g.length,h=new Uint8Array(u/2);for(let y=0;y<u;y+=2)h[y/2]=hexToBytesMapFirstKey[g[y]]+hexToBytesMapSecondKey[g[y+1]];return h}Array.from({length:256},(g,u)=>u.toString(16).padStart(2,"0"));for(let g=0;g<=256*256-1;g++)BigInt(g);const hexToBytes=g=>{if(typeof g!="string")throw new Error(`hex argument type ${typeof g} must be of type string`);if(!/^0x[0-9a-fA-F]*$/.test(g))throw new Error(`Input must be a 0x-prefixed hexadecimal string, got ${g}`);const u=g.slice(2);return _unprefixedHexToBytes(u.length%2===0?u:padToEven(u))},intToHex=g=>{if(!Number.isSafeInteger(g)||g<0)throw new Error(`Received an invalid integer type: ${g}`);return`0x${g.toString(16)}`},intToBytes=g=>{const u=intToHex(g);return hexToBytes(u)};BigInt("0xffffffffffffffff");BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");BigInt("115792089237316195423570985008687907853269984665640564039457584007913129639935");secp256k1$1.CURVE.n;secp256k1$1.CURVE.n/BigInt(2);BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");const KECCAK256_NULL_S="0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470";hexToBytes(KECCAK256_NULL_S);const KECCAK256_RLP_ARRAY_S="0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347";hexToBytes(KECCAK256_RLP_ARRAY_S);const KECCAK256_RLP_S="0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421";hexToBytes(KECCAK256_RLP_S);Uint8Array.from([128]);BigInt(-1);BigInt(0);BigInt(1);BigInt(2);BigInt(3);BigInt(7);BigInt(8);BigInt(27);BigInt(28);BigInt(31);BigInt(32);BigInt(64);BigInt(128);BigInt(255);BigInt(256);BigInt(96);BigInt(100);BigInt(160);BigInt(224);BigInt(7922816251426434e13);BigInt(1461501637330903e33);BigInt(2695994666715064e52);BigInt(1e9);Array.from({length:256},(g,u)=>u.toString(16).padStart(2,"0"));var KeyEncoding;(function(g){g.String="string",g.Bytes="view",g.Number="number"})(KeyEncoding||(KeyEncoding={}));var ValueEncoding;(function(g){g.String="string",g.Bytes="view",g.JSON="json"})(ValueEncoding||(ValueEncoding={}));var TypeOutput;(function(g){g[g.Number=0]="Number",g[g.BigInt=1]="BigInt",g[g.Uint8Array=2]="Uint8Array",g[g.PrefixedHexString=3]="PrefixedHexString"})(TypeOutput||(TypeOutput={}));var CLRequestType;(function(g){g[g.Deposit=0]="Deposit",g[g.Withdrawal=1]="Withdrawal",g[g.Consolidation=2]="Consolidation"})(CLRequestType||(CLRequestType={}));var VerkleLeafType;(function(g){g[g.Version=0]="Version",g[g.Balance=1]="Balance",g[g.Nonce=2]="Nonce",g[g.CodeHash=3]="CodeHash",g[g.CodeSize=4]="CodeSize"})(VerkleLeafType||(VerkleLeafType={}));intToBytes(VerkleLeafType.Version);intToBytes(VerkleLeafType.Balance);intToBytes(VerkleLeafType.Nonce);intToBytes(VerkleLeafType.CodeHash);intToBytes(VerkleLeafType.CodeSize);BigInt(256)**BigInt(31);function serializeError(g){const u=g.findIndex(b=>b instanceof Error),h=g.findIndex(b=>typeof b=="string"),y=g.findIndex(b=>b&&typeof b=="object"&&"status"in b&&"type"in b);let v;if(y!==-1){const b=g[y];v=new Error(`${b.status} ${b.type.toString()} ${b.statusText}`)}else u!==-1?v=g.splice(u,1)[0]:h!==-1?v=new Error(g.splice(h,1)[0]):v=new Error("Unknown error");return[v,g]}class Web3AuthError extends CustomError{constructor(u,h,y){super(h),_defineProperty(this,"code",void 0),_defineProperty(this,"message",void 0),_defineProperty(this,"cause",void 0),this.code=u,this.message=h||"",this.cause=y,Object.defineProperty(this,"name",{value:"Web3AuthError"})}toJSON(){return{name:this.name,code:this.code,message:this.message,cause:serializeError([this.cause])}}toString(){return JSON.stringify(this.toJSON())}}class WalletInitializationError extends Web3AuthError{constructor(u,h,y){super(u,h,y),Object.defineProperty(this,"name",{value:"WalletInitializationError"})}static fromCode(u,h="",y){return new WalletInitializationError(u,`${WalletInitializationError.messages[u]}, ${h}`,y)}static notFound(u="",h){return WalletInitializationError.fromCode(5001,u,h)}static notInstalled(u="",h){return WalletInitializationError.fromCode(5002,u,h)}static notReady(u="",h){return WalletInitializationError.fromCode(5003,u,h)}static windowBlocked(u="",h){return WalletInitializationError.fromCode(5004,u,h)}static windowClosed(u="",h){return WalletInitializationError.fromCode(5005,u,h)}static incompatibleChainNameSpace(u="",h){return WalletInitializationError.fromCode(5006,u,h)}static duplicateAdapterError(u="",h){return WalletInitializationError.fromCode(5007,u,h)}static invalidProviderConfigError(u="",h){return WalletInitializationError.fromCode(5008,u,h)}static providerNotReadyError(u="",h){return WalletInitializationError.fromCode(5009,u,h)}static rpcConnectionError(u="",h){return WalletInitializationError.fromCode(5010,u,h)}static invalidParams(u="",h){return WalletInitializationError.fromCode(5011,u,h)}static invalidNetwork(u="",h){return WalletInitializationError.fromCode(5013,u,h)}}_defineProperty(WalletInitializationError,"messages",{5e3:"Custom",5001:"Wallet is not found",5002:"Wallet is not installed",5003:"Wallet is not ready yet",5004:"Wallet window is blocked",5005:"Wallet window has been closed by the user",5006:"Incompatible chain namespace provided",5007:"Adapter has already been included",5008:"Invalid provider Config",5009:"Provider is not ready yet",5010:"Failed to connect with rpc url",5011:"Invalid params passed in",5013:"Invalid network provided"});class WalletLoginError extends Web3AuthError{constructor(u,h,y){super(u,h,y),Object.defineProperty(this,"name",{value:"WalletLoginError"})}static fromCode(u,h="",y){return new WalletLoginError(u,`${WalletLoginError.messages[u]}. ${h}`,y)}static connectionError(u="",h){return WalletLoginError.fromCode(5111,u,h)}static disconnectionError(u="",h){return WalletLoginError.fromCode(5112,u,h)}static notConnectedError(u="",h){return WalletLoginError.fromCode(5113,u,h)}static popupClosed(u="",h){return WalletLoginError.fromCode(5114,u,h)}static mfaEnabled(u="",h){return WalletLoginError.fromCode(5115,u,h)}static chainConfigNotAdded(u="",h){return WalletLoginError.fromCode(5116,u,h)}static unsupportedOperation(u="",h){return WalletLoginError.fromCode(5117,u,h)}static coreKitKeyNotFound(u="",h){return WalletLoginError.fromCode(5118,u,h)}static userNotLoggedIn(u="",h){return WalletLoginError.fromCode(5119,u,h)}}_defineProperty(WalletLoginError,"messages",{5e3:"Custom",5111:"Failed to connect with wallet",5112:"Failed to disconnect from wallet",5113:"Wallet is not connected",5114:"Wallet popup has been closed by the user",5115:"User has already enabled mfa, please use the @web3auth/web3auth-web sdk for login with mfa",5116:"Chain config has not been added. Please add the chain config before calling switchChain",5117:"Unsupported operation",5118:"useCoreKitKey flag is enabled but coreKitKey is not available",5119:"User not logged in."});class WalletOperationsError extends Web3AuthError{constructor(u,h,y){super(u,h,y),Object.defineProperty(this,"name",{value:"WalletOperationsError"})}static fromCode(u,h="",y){return new WalletOperationsError(u,`${WalletOperationsError.messages[u]}, ${h}`,y)}static chainIDNotAllowed(u="",h){return WalletOperationsError.fromCode(5201,u,h)}static operationNotAllowed(u="",h){return WalletOperationsError.fromCode(5202,u,h)}static chainNamespaceNotAllowed(u="",h){return WalletOperationsError.fromCode(5203,u,h)}}_defineProperty(WalletOperationsError,"messages",{5e3:"Custom",5201:"Provided chainId is not allowed",5202:"This operation is not allowed"});class WalletProviderError extends Web3AuthError{constructor(u,h,y){super(u,h,y),Object.defineProperty(this,"name",{value:"WalletProviderError"})}static fromCode(u,h="",y){return new WalletOperationsError(u,`${WalletProviderError.messages[u]}, ${h}`,y)}static invalidRequestArgs(u="",h){return WalletOperationsError.fromCode(5301,u,h)}static invalidRequestMethod(u="",h){return WalletOperationsError.fromCode(5302,u,h)}static invalidRequestParams(u="",h){return WalletOperationsError.fromCode(5303,u,h)}}_defineProperty(WalletProviderError,"messages",{5e3:"Custom",5301:"Expected a single, non-array, object argument.",5302:"'args.method' must be a non-empty string.",5303:"'args.params' must be an object or array if provided."});const CHAIN_NAMESPACES={EIP155:"eip155",SOLANA:"solana",CASPER:"casper",XRPL:"xrpl",OTHER:"other"},ADAPTER_NAMESPACES={MULTICHAIN:"multichain"},INFURA_PROXY_URL="https://api.web3auth.io/infura-service/v1",getDefaultNetworkId=g=>{if(g===CHAIN_NAMESPACES.EIP155)return 1;if(g===CHAIN_NAMESPACES.SOLANA)return 1;if(g===CHAIN_NAMESPACES.XRPL)return 1;throw WalletInitializationError.invalidParams(`Chain namespace ${g} is not supported`)},getEvmChainConfig=(g,u="")=>{const h=CHAIN_NAMESPACES.EIP155,y=`${INFURA_PROXY_URL}/${g}/${u}`;return g===1?{logo:"https://images.toruswallet.io/eth.svg",chainNamespace:h,chainId:"0x1",rpcTarget:y,displayName:"Ethereum Mainnet",blockExplorerUrl:"https://etherscan.io/",ticker:"ETH",tickerName:"Ethereum",decimals:18}:g===10?{chainNamespace:CHAIN_NAMESPACES.EIP155,decimals:18,blockExplorerUrl:"https://optimistic.etherscan.io",chainId:"0xa",displayName:"Optimism",logo:"optimism.svg",rpcTarget:y,ticker:"ETH",tickerName:"Ethereum"}:g===8453?{chainNamespace:CHAIN_NAMESPACES.EIP155,decimals:18,blockExplorerUrl:"https://basescan.org",chainId:"0x2105",displayName:"Base",logo:"base.svg",rpcTarget:y,ticker:"ETH",tickerName:"Ethereum"}:g===42161?{chainNamespace:CHAIN_NAMESPACES.EIP155,decimals:18,blockExplorerUrl:"https://arbiscan.io",chainId:"0xa4b1",displayName:"Arbitrum One",logo:"arbitrum.svg",rpcTarget:y,ticker:"ETH",tickerName:"Ethereum"}:g===59144?{chainNamespace:CHAIN_NAMESPACES.EIP155,decimals:18,blockExplorerUrl:"https://lineascan.build",chainId:"0xe708",logo:"https://images.toruswallet.io/eth.svg",rpcTarget:y,ticker:"ETH",tickerName:"Ethereum"}:g===11155111?{logo:"https://images.toruswallet.io/eth.svg",chainNamespace:h,chainId:"0xaa36a7",rpcTarget:y,displayName:"Sepolia Testnet",blockExplorerUrl:"https://sepolia.etherscan.io/",ticker:"ETH",tickerName:"Ethereum",decimals:18}:g===137?{logo:"https://images.toruswallet.io/polygon.svg",chainNamespace:h,chainId:"0x89",rpcTarget:y,displayName:"Polygon Mainnet",blockExplorerUrl:"https://polygonscan.com",ticker:"POL",tickerName:"Polygon Ecosystem Token"}:g===80002?{logo:"https://images.toruswallet.io/polygon.svg",chainNamespace:h,chainId:"0x13882",rpcTarget:y,displayName:"Polygon Amoy Testnet",blockExplorerUrl:"https://www.oklink.com/amoy",ticker:"POL",tickerName:"Polygon Ecosystem Token",decimals:18}:g===56?{logo:"https://images.toruswallet.io/bnb.png",chainNamespace:h,chainId:"0x38",rpcTarget:y,displayName:"Binance SmartChain Mainnet",blockExplorerUrl:"https://bscscan.com",ticker:"BNB",tickerName:"Binance SmartChain",decimals:18}:g===97?{logo:"https://images.toruswallet.io/bnb.png",chainNamespace:h,chainId:"0x61",rpcTarget:y,displayName:"Binance SmartChain Testnet",blockExplorerUrl:"https://testnet.bscscan.com",ticker:"BNB",tickerName:"Binance SmartChain",decimals:18}:g===25?{logo:"https://images.toruswallet.io/cro.svg",chainNamespace:h,chainId:"0x19",rpcTarget:"https://rpc.cronos.org",displayName:"Cronos Mainnet",blockExplorerUrl:"https://cronoscan.com/",ticker:"CRO",tickerName:"Cronos"}:g===338?{logo:"https://images.toruswallet.io/cro.svg",chainNamespace:h,chainId:"0x152",rpcTarget:"https://rpc-t3.cronos.org/",displayName:"Cronos Testnet",blockExplorerUrl:"https://cronoscan.com/",ticker:"CRO",tickerName:"Cronos",decimals:18}:g===8217?{logo:"https://images.toruswallet.io/klay.svg",chainNamespace:h,chainId:"0x2019",rpcTarget:"https://public-node-api.klaytnapi.com/v1/cypress",displayName:"Klaytn Mainnet",blockExplorerUrl:"https://scope.klaytn.com",ticker:"KLAY",tickerName:"Klaytn",decimals:18}:g===1946?{chainNamespace:CHAIN_NAMESPACES.EIP155,chainId:"0x79a",rpcTarget:"https://rpc.minato.soneium.org",displayName:"Soneium Minato Testnet",blockExplorerUrl:"https://explorer-testnet.soneium.org",ticker:"ETH",tickerName:"ETH",logo:"https://iili.io/2i5xce2.png"}:g===1868?{chainNamespace:CHAIN_NAMESPACES.EIP155,chainId:"0x74c",rpcTarget:"https://rpc.soneium.org",displayName:"Soneium Mainnet",blockExplorerUrl:"https://soneium.blockscout.com",ticker:"ETH",tickerName:"ETH",logo:"https://iili.io/2i5xce2.png"}:null},getSolanaChainConfig=g=>{const u=CHAIN_NAMESPACES.SOLANA;return g===101||g===1?{logo:"https://images.toruswallet.io/sol.svg",chainNamespace:u,chainId:"0x65",rpcTarget:"https://rpc.ankr.com/solana",displayName:"Solana Mainnet",blockExplorerUrl:"https://explorer.solana.com",ticker:"SOL",tickerName:"Solana",decimals:9}:g===102||g===2?{logo:"https://images.toruswallet.io/sol.svg",chainNamespace:u,chainId:"0x66",rpcTarget:"https://api.testnet.solana.com",displayName:"Solana Testnet",blockExplorerUrl:"https://explorer.solana.com?cluster=testnet",ticker:"SOL",tickerName:"Solana",decimals:9}:g===103||g===3?{logo:"https://images.toruswallet.io/sol.svg",chainNamespace:u,chainId:"0x67",rpcTarget:"https://api.devnet.solana.com",displayName:"Solana Devnet",blockExplorerUrl:"https://explorer.solana.com?cluster=devnet",ticker:"SOL",tickerName:"Solana",decimals:9}:null},getXrplChainConfig=g=>{const u=CHAIN_NAMESPACES.XRPL;return g===1?{chainNamespace:u,decimals:15,chainId:"0x1",logo:"https://images.toruswallet.io/XRP.svg",rpcTarget:"https://ripple-node.tor.us",wsTarget:"wss://s2.ripple.com",ticker:"XRP",tickerName:"XRPL",displayName:"xrpl mainnet",blockExplorerUrl:"https://livenet.xrpl.org"}:g===2?{chainNamespace:u,decimals:15,chainId:"0x2",logo:"https://images.toruswallet.io/XRP.svg",rpcTarget:"https://testnet-ripple-node.tor.us",wsTarget:"wss://s.altnet.rippletest.net",ticker:"XRP",tickerName:"XRPL",displayName:"xrpl testnet",blockExplorerUrl:"https://testnet.xrpl.org",isTestnet:!0}:g===3?{chainNamespace:u,decimals:15,chainId:"0x3",logo:"https://images.toruswallet.io/XRP.svg",rpcTarget:"https://devnet-ripple-node.tor.us",wsTarget:"wss://s.devnet.rippletest.net/",ticker:"XRP",tickerName:"XRPL",displayName:"xrpl devnet",blockExplorerUrl:"https://devnet.xrpl.org",isTestnet:!0}:null},getChainConfig=(g,u,h)=>{if(g===CHAIN_NAMESPACES.OTHER)return null;const y=u?typeof u=="number"?u:parseInt(u,16):getDefaultNetworkId(g);return g===CHAIN_NAMESPACES.EIP155?getEvmChainConfig(y,h):g===CHAIN_NAMESPACES.SOLANA?getSolanaChainConfig(y):g===CHAIN_NAMESPACES.XRPL?getXrplChainConfig(y):null};var loglevel=loglevel$2.getLogger("web3auth-logger");class BaseController extends SafeEventEmitter{constructor({config:u={},state:h={}}){super(),_defineProperty(this,"defaultConfig",{}),_defineProperty(this,"defaultState",{}),_defineProperty(this,"disabled",!1),_defineProperty(this,"name","BaseController"),_defineProperty(this,"initialConfig",void 0),_defineProperty(this,"initialState",void 0),_defineProperty(this,"internalConfig",this.defaultConfig),_defineProperty(this,"internalState",this.defaultState),this.initialState=h,this.initialConfig=u}get config(){return this.internalConfig}get state(){return this.internalState}configure(u,h=!1,y=!0){if(y){this.internalConfig=h?u:Object.assign(this.internalConfig,u);for(const v in this.internalConfig)typeof this.internalConfig[v]<"u"&&(this[v]=this.internalConfig[v])}else for(const v in u)typeof this.internalConfig[v]<"u"&&(this.internalConfig[v]=u[v],this[v]=u[v])}update(u,h=!1){this.internalState=_objectSpread2(h?{}:_objectSpread2({},this.internalState),u),this.emit("store",this.internalState)}initialize(){return this.internalState=this.defaultState,this.internalConfig=this.defaultConfig,this.configure(this.initialConfig),this.update(this.initialState),this}}const filterNoop=()=>!0,internalEvents=["newListener","removeListener"],externalEventFilter=g=>!internalEvents.includes(g);function getRawListeners(g,u){return typeof g.rawListeners<"u"?g.rawListeners(u):g.listeners(u)}function createEventEmitterProxy(g,u){let y={}.eventFilter||filterNoop;if(typeof y=="string"&&y==="skipInternal"&&(y=externalEventFilter),typeof y!="function")throw new Error("createEventEmitterProxy - Invalid eventFilter");let v=g,b=E=>{if(v===E)return;const _=v;v=E,_.eventNames().filter(y).forEach(A=>{getRawListeners(_,A).forEach(R=>{E.on(A,R)})}),_.removeAllListeners()};return new Proxy({},{get:(E,_)=>_==="setTarget"?b:v[_],set:(E,_,S)=>_==="setTarget"?(b=S,!0):(v[_]=S,!0),has:(E,_)=>_[0]==="_"?!1:_ in v})}const FEATURES_DEFAULT_POPUP_WINDOW={height:700,width:1200},COMMUNICATION_NOTIFICATIONS={IFRAME_STATUS:"iframe_status",CLOSE_WINDOW:"close_window",USER_LOGGED_IN:"user_logged_in",USER_LOGGED_OUT:"user_logged_out",TOGGLE_WIDGET_BUTTON:"toggle_widget_button",ALLOW_WALLET_SERVICE:"allow_wallet_service"},COMMUNICATION_JRPC_METHODS={LOGOUT:"logout",WALLET_INSTANCE_ID:"wallet_instance_id",USER_INFO:"user_info",SET_PROVIDER:"set_provider",TOPUP:"topup",IFRAME_STATUS:"iframe_status",CLOSED_WINDOW:"closed_window",WINDOW_BLOCKED:"window_blocked",GET_PROVIDER_STATE:"get_provider_state",LOGIN_WITH_PRIVATE_KEY:"login_with_private_key",SHOW_WALLET_CONNECT:"show_wallet_connect",SHOW_CHECKOUT:"show_checkout",SHOW_WALLET_UI:"show_wallet_ui",SHOW_SWAP:"show_swap",LOGIN_WITH_SESSION_ID:"login_with_session_id"},PROVIDER_JRPC_METHODS={GET_PROVIDER_STATE:"wallet_get_provider_state",WALLET_SWITCH_CHAIN:"wallet_switchChain"},PROVIDER_NOTIFICATIONS={ACCOUNTS_CHANGED:"wallet_accounts_changed",CHAIN_CHANGED:"wallet_chain_changed",UNLOCK_STATE_CHANGED:"wallet_unlock_state_changed"};var isNumeric=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,mathceil=Math.ceil,mathfloor=Math.floor,bignumberError="[BigNumber Error] ",tooManyDigits=bignumberError+"Number primitive has more than 15 significant digits: ",BASE=1e14,LOG_BASE=14,MAX_SAFE_INTEGER=9007199254740991,POWS_TEN=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],SQRT_BASE=1e7,MAX=1e9;function clone(g){var u,h,y,v=B.prototype={constructor:B,toString:null,valueOf:null},b=new B(1),w=20,E=4,_=-7,S=21,A=-1e7,R=1e7,x=!1,T=1,C=0,I={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},L="0123456789abcdefghijklmnopqrstuvwxyz",$=!0;function B(Y,X){var J,j,M,N,P,O,k,q,F=this;if(!(F instanceof B))return new B(Y,X);if(X==null){if(Y&&Y._isBigNumber===!0){F.s=Y.s,!Y.c||Y.e>R?F.c=F.e=null:Y.e<A?F.c=[F.e=0]:(F.e=Y.e,F.c=Y.c.slice());return}if((O=typeof Y=="number")&&Y*0==0){if(F.s=1/Y<0?(Y=-Y,-1):1,Y===~~Y){for(N=0,P=Y;P>=10;P/=10,N++);N>R?F.c=F.e=null:(F.e=N,F.c=[Y]);return}q=String(Y)}else{if(!isNumeric.test(q=String(Y)))return y(F,q,O);F.s=q.charCodeAt(0)==45?(q=q.slice(1),-1):1}(N=q.indexOf("."))>-1&&(q=q.replace(".","")),(P=q.search(/e/i))>0?(N<0&&(N=P),N+=+q.slice(P+1),q=q.substring(0,P)):N<0&&(N=q.length)}else{if(intCheck(X,2,L.length,"Base"),X==10&&$)return F=new B(Y),ue(F,w+F.e+1,E);if(q=String(Y),O=typeof Y=="number"){if(Y*0!=0)return y(F,q,O,X);if(F.s=1/Y<0?(q=q.slice(1),-1):1,B.DEBUG&&q.replace(/^0\.0*|\./,"").length>15)throw Error(tooManyDigits+Y)}else F.s=q.charCodeAt(0)===45?(q=q.slice(1),-1):1;for(J=L.slice(0,X),N=P=0,k=q.length;P<k;P++)if(J.indexOf(j=q.charAt(P))<0){if(j=="."){if(P>N){N=k;continue}}else if(!M&&(q==q.toUpperCase()&&(q=q.toLowerCase())||q==q.toLowerCase()&&(q=q.toUpperCase()))){M=!0,P=-1,N=0;continue}return y(F,String(Y),O,X)}O=!1,q=h(q,X,10,F.s),(N=q.indexOf("."))>-1?q=q.replace(".",""):N=q.length}for(P=0;q.charCodeAt(P)===48;P++);for(k=q.length;q.charCodeAt(--k)===48;);if(q=q.slice(P,++k)){if(k-=P,O&&B.DEBUG&&k>15&&(Y>MAX_SAFE_INTEGER||Y!==mathfloor(Y)))throw Error(tooManyDigits+F.s*Y);if((N=N-P-1)>R)F.c=F.e=null;else if(N<A)F.c=[F.e=0];else{if(F.e=N,F.c=[],P=(N+1)%LOG_BASE,N<0&&(P+=LOG_BASE),P<k){for(P&&F.c.push(+q.slice(0,P)),k-=LOG_BASE;P<k;)F.c.push(+q.slice(P,P+=LOG_BASE));P=LOG_BASE-(q=q.slice(P)).length}else P-=k;for(;P--;q+="0");F.c.push(+q)}}else F.c=[F.e=0]}B.clone=clone,B.ROUND_UP=0,B.ROUND_DOWN=1,B.ROUND_CEIL=2,B.ROUND_FLOOR=3,B.ROUND_HALF_UP=4,B.ROUND_HALF_DOWN=5,B.ROUND_HALF_EVEN=6,B.ROUND_HALF_CEIL=7,B.ROUND_HALF_FLOOR=8,B.EUCLID=9,B.config=B.set=function(Y){var X,J;if(Y!=null)if(typeof Y=="object"){if(Y.hasOwnProperty(X="DECIMAL_PLACES")&&(J=Y[X],intCheck(J,0,MAX,X),w=J),Y.hasOwnProperty(X="ROUNDING_MODE")&&(J=Y[X],intCheck(J,0,8,X),E=J),Y.hasOwnProperty(X="EXPONENTIAL_AT")&&(J=Y[X],J&&J.pop?(intCheck(J[0],-MAX,0,X),intCheck(J[1],0,MAX,X),_=J[0],S=J[1]):(intCheck(J,-MAX,MAX,X),_=-(S=J<0?-J:J))),Y.hasOwnProperty(X="RANGE"))if(J=Y[X],J&&J.pop)intCheck(J[0],-MAX,-1,X),intCheck(J[1],1,MAX,X),A=J[0],R=J[1];else if(intCheck(J,-MAX,MAX,X),J)A=-(R=J<0?-J:J);else throw Error(bignumberError+X+" cannot be zero: "+J);if(Y.hasOwnProperty(X="CRYPTO"))if(J=Y[X],J===!!J)if(J)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))x=J;else throw x=!J,Error(bignumberError+"crypto unavailable");else x=J;else throw Error(bignumberError+X+" not true or false: "+J);if(Y.hasOwnProperty(X="MODULO_MODE")&&(J=Y[X],intCheck(J,0,9,X),T=J),Y.hasOwnProperty(X="POW_PRECISION")&&(J=Y[X],intCheck(J,0,MAX,X),C=J),Y.hasOwnProperty(X="FORMAT"))if(J=Y[X],typeof J=="object")I=J;else throw Error(bignumberError+X+" not an object: "+J);if(Y.hasOwnProperty(X="ALPHABET"))if(J=Y[X],typeof J=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(J))$=J.slice(0,10)=="0123456789",L=J;else throw Error(bignumberError+X+" invalid: "+J)}else throw Error(bignumberError+"Object expected: "+Y);return{DECIMAL_PLACES:w,ROUNDING_MODE:E,EXPONENTIAL_AT:[_,S],RANGE:[A,R],CRYPTO:x,MODULO_MODE:T,POW_PRECISION:C,FORMAT:I,ALPHABET:L}},B.isBigNumber=function(Y){if(!Y||Y._isBigNumber!==!0)return!1;if(!B.DEBUG)return!0;var X,J,j=Y.c,M=Y.e,N=Y.s;e:if({}.toString.call(j)=="[object Array]"){if((N===1||N===-1)&&M>=-MAX&&M<=MAX&&M===mathfloor(M)){if(j[0]===0){if(M===0&&j.length===1)return!0;break e}if(X=(M+1)%LOG_BASE,X<1&&(X+=LOG_BASE),String(j[0]).length==X){for(X=0;X<j.length;X++)if(J=j[X],J<0||J>=BASE||J!==mathfloor(J))break e;if(J!==0)return!0}}}else if(j===null&&M===null&&(N===null||N===1||N===-1))return!0;throw Error(bignumberError+"Invalid BigNumber: "+Y)},B.maximum=B.max=function(){return z(arguments,-1)},B.minimum=B.min=function(){return z(arguments,1)},B.random=(function(){var Y=9007199254740992,X=Math.random()*Y&2097151?function(){return mathfloor(Math.random()*Y)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(J){var j,M,N,P,O,k=0,q=[],F=new B(b);if(J==null?J=w:intCheck(J,0,MAX),P=mathceil(J/LOG_BASE),x)if(crypto.getRandomValues){for(j=crypto.getRandomValues(new Uint32Array(P*=2));k<P;)O=j[k]*131072+(j[k+1]>>>11),O>=9e15?(M=crypto.getRandomValues(new Uint32Array(2)),j[k]=M[0],j[k+1]=M[1]):(q.push(O%1e14),k+=2);k=P/2}else if(crypto.randomBytes){for(j=crypto.randomBytes(P*=7);k<P;)O=(j[k]&31)*281474976710656+j[k+1]*1099511627776+j[k+2]*4294967296+j[k+3]*16777216+(j[k+4]<<16)+(j[k+5]<<8)+j[k+6],O>=9e15?crypto.randomBytes(7).copy(j,k):(q.push(O%1e14),k+=7);k=P/7}else throw x=!1,Error(bignumberError+"crypto unavailable");if(!x)for(;k<P;)O=X(),O<9e15&&(q[k++]=O%1e14);for(P=q[--k],J%=LOG_BASE,P&&J&&(O=POWS_TEN[LOG_BASE-J],q[k]=mathfloor(P/O)*O);q[k]===0;q.pop(),k--);if(k<0)q=[N=0];else{for(N=-1;q[0]===0;q.splice(0,1),N-=LOG_BASE);for(k=1,O=q[0];O>=10;O/=10,k++);k<LOG_BASE&&(N-=LOG_BASE-k)}return F.e=N,F.c=q,F}})(),B.sum=function(){for(var Y=1,X=arguments,J=new B(X[0]);Y<X.length;)J=J.plus(X[Y++]);return J},h=(function(){var Y="0123456789";function X(J,j,M,N){for(var P,O=[0],k,q=0,F=J.length;q<F;){for(k=O.length;k--;O[k]*=j);for(O[0]+=N.indexOf(J.charAt(q++)),P=0;P<O.length;P++)O[P]>M-1&&(O[P+1]==null&&(O[P+1]=0),O[P+1]+=O[P]/M|0,O[P]%=M)}return O.reverse()}return function(J,j,M,N,P){var O,k,q,F,H,D,G,W,K=J.indexOf("."),Z=w,ae=E;for(K>=0&&(F=C,C=0,J=J.replace(".",""),W=new B(j),D=W.pow(J.length-K),C=F,W.c=X(toFixedPoint(coeffToString(D.c),D.e,"0"),10,M,Y),W.e=W.c.length),G=X(J,j,M,P?(O=L,Y):(O=Y,L)),q=F=G.length;G[--F]==0;G.pop());if(!G[0])return O.charAt(0);if(K<0?--q:(D.c=G,D.e=q,D.s=N,D=u(D,W,Z,ae,M),G=D.c,H=D.r,q=D.e),k=q+Z+1,K=G[k],F=M/2,H=H||k<0||G[k+1]!=null,H=ae<4?(K!=null||H)&&(ae==0||ae==(D.s<0?3:2)):K>F||K==F&&(ae==4||H||ae==6&&G[k-1]&1||ae==(D.s<0?8:7)),k<1||!G[0])J=H?toFixedPoint(O.charAt(1),-Z,O.charAt(0)):O.charAt(0);else{if(G.length=k,H)for(--M;++G[--k]>M;)G[k]=0,k||(++q,G=[1].concat(G));for(F=G.length;!G[--F];);for(K=0,J="";K<=F;J+=O.charAt(G[K++]));J=toFixedPoint(J,q,O.charAt(0))}return J}})(),u=(function(){function Y(j,M,N){var P,O,k,q,F=0,H=j.length,D=M%SQRT_BASE,G=M/SQRT_BASE|0;for(j=j.slice();H--;)k=j[H]%SQRT_BASE,q=j[H]/SQRT_BASE|0,P=G*k+q*D,O=D*k+P%SQRT_BASE*SQRT_BASE+F,F=(O/N|0)+(P/SQRT_BASE|0)+G*q,j[H]=O%N;return F&&(j=[F].concat(j)),j}function X(j,M,N,P){var O,k;if(N!=P)k=N>P?1:-1;else for(O=k=0;O<N;O++)if(j[O]!=M[O]){k=j[O]>M[O]?1:-1;break}return k}function J(j,M,N,P){for(var O=0;N--;)j[N]-=O,O=j[N]<M[N]?1:0,j[N]=O*P+j[N]-M[N];for(;!j[0]&&j.length>1;j.splice(0,1));}return function(j,M,N,P,O){var k,q,F,H,D,G,W,K,Z,ae,le,te,ce,ge,Ee,pe,de,me=j.s==M.s?1:-1,_e=j.c,Ae=M.c;if(!_e||!_e[0]||!Ae||!Ae[0])return new B(!j.s||!M.s||(_e?Ae&&_e[0]==Ae[0]:!Ae)?NaN:_e&&_e[0]==0||!Ae?me*0:me/0);for(K=new B(me),Z=K.c=[],q=j.e-M.e,me=N+q+1,O||(O=BASE,q=bitFloor(j.e/LOG_BASE)-bitFloor(M.e/LOG_BASE),me=me/LOG_BASE|0),F=0;Ae[F]==(_e[F]||0);F++);if(Ae[F]>(_e[F]||0)&&q--,me<0)Z.push(1),H=!0;else{for(ge=_e.length,pe=Ae.length,F=0,me+=2,D=mathfloor(O/(Ae[0]+1)),D>1&&(Ae=Y(Ae,D,O),_e=Y(_e,D,O),pe=Ae.length,ge=_e.length),ce=pe,ae=_e.slice(0,pe),le=ae.length;le<pe;ae[le++]=0);de=Ae.slice(),de=[0].concat(de),Ee=Ae[0],Ae[1]>=O/2&&Ee++;do{if(D=0,k=X(Ae,ae,pe,le),k<0){if(te=ae[0],pe!=le&&(te=te*O+(ae[1]||0)),D=mathfloor(te/Ee),D>1)for(D>=O&&(D=O-1),G=Y(Ae,D,O),W=G.length,le=ae.length;X(G,ae,W,le)==1;)D--,J(G,pe<W?de:Ae,W,O),W=G.length,k=1;else D==0&&(k=D=1),G=Ae.slice(),W=G.length;if(W<le&&(G=[0].concat(G)),J(ae,G,le,O),le=ae.length,k==-1)for(;X(Ae,ae,pe,le)<1;)D++,J(ae,pe<le?de:Ae,le,O),le=ae.length}else k===0&&(D++,ae=[0]);Z[F++]=D,ae[0]?ae[le++]=_e[ce]||0:(ae=[_e[ce]],le=1)}while((ce++<ge||ae[0]!=null)&&me--);H=ae[0]!=null,Z[0]||Z.splice(0,1)}if(O==BASE){for(F=1,me=Z[0];me>=10;me/=10,F++);ue(K,N+(K.e=F+q*LOG_BASE-1)+1,P,H)}else K.e=q,K.r=+H;return K}})();function U(Y,X,J,j){var M,N,P,O,k;if(J==null?J=E:intCheck(J,0,8),!Y.c)return Y.toString();if(M=Y.c[0],P=Y.e,X==null)k=coeffToString(Y.c),k=j==1||j==2&&(P<=_||P>=S)?toExponential(k,P):toFixedPoint(k,P,"0");else if(Y=ue(new B(Y),X,J),N=Y.e,k=coeffToString(Y.c),O=k.length,j==1||j==2&&(X<=N||N<=_)){for(;O<X;k+="0",O++);k=toExponential(k,N)}else if(X-=P+(j===2&&N>P),k=toFixedPoint(k,N,"0"),N+1>O){if(--X>0)for(k+=".";X--;k+="0");}else if(X+=N-O,X>0)for(N+1==O&&(k+=".");X--;k+="0");return Y.s<0&&M?"-"+k:k}function z(Y,X){for(var J,j,M=1,N=new B(Y[0]);M<Y.length;M++)j=new B(Y[M]),(!j.s||(J=compare(N,j))===X||J===0&&N.s===X)&&(N=j);return N}function ne(Y,X,J){for(var j=1,M=X.length;!X[--M];X.pop());for(M=X[0];M>=10;M/=10,j++);return(J=j+J*LOG_BASE-1)>R?Y.c=Y.e=null:J<A?Y.c=[Y.e=0]:(Y.e=J,Y.c=X),Y}y=(function(){var Y=/^(-?)0([xbo])(?=\w[\w.]*$)/i,X=/^([^.]+)\.$/,J=/^\.([^.]+)$/,j=/^-?(Infinity|NaN)$/,M=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(N,P,O,k){var q,F=O?P:P.replace(M,"");if(j.test(F))N.s=isNaN(F)?null:F<0?-1:1;else{if(!O&&(F=F.replace(Y,function(H,D,G){return q=(G=G.toLowerCase())=="x"?16:G=="b"?2:8,!k||k==q?D:H}),k&&(q=k,F=F.replace(X,"$1").replace(J,"0.$1")),P!=F))return new B(F,q);if(B.DEBUG)throw Error(bignumberError+"Not a"+(k?" base "+k:"")+" number: "+P);N.s=null}N.c=N.e=null}})();function ue(Y,X,J,j){var M,N,P,O,k,q,F,H=Y.c,D=POWS_TEN;if(H){e:{for(M=1,O=H[0];O>=10;O/=10,M++);if(N=X-M,N<0)N+=LOG_BASE,P=X,k=H[q=0],F=mathfloor(k/D[M-P-1]%10);else if(q=mathceil((N+1)/LOG_BASE),q>=H.length)if(j){for(;H.length<=q;H.push(0));k=F=0,M=1,N%=LOG_BASE,P=N-LOG_BASE+1}else break e;else{for(k=O=H[q],M=1;O>=10;O/=10,M++);N%=LOG_BASE,P=N-LOG_BASE+M,F=P<0?0:mathfloor(k/D[M-P-1]%10)}if(j=j||X<0||H[q+1]!=null||(P<0?k:k%D[M-P-1]),j=J<4?(F||j)&&(J==0||J==(Y.s<0?3:2)):F>5||F==5&&(J==4||j||J==6&&(N>0?P>0?k/D[M-P]:0:H[q-1])%10&1||J==(Y.s<0?8:7)),X<1||!H[0])return H.length=0,j?(X-=Y.e+1,H[0]=D[(LOG_BASE-X%LOG_BASE)%LOG_BASE],Y.e=-X||0):H[0]=Y.e=0,Y;if(N==0?(H.length=q,O=1,q--):(H.length=q+1,O=D[LOG_BASE-N],H[q]=P>0?mathfloor(k/D[M-P]%D[P])*O:0),j)for(;;)if(q==0){for(N=1,P=H[0];P>=10;P/=10,N++);for(P=H[0]+=O,O=1;P>=10;P/=10,O++);N!=O&&(Y.e++,H[0]==BASE&&(H[0]=1));break}else{if(H[q]+=O,H[q]!=BASE)break;H[q--]=0,O=1}for(N=H.length;H[--N]===0;H.pop());}Y.e>R?Y.c=Y.e=null:Y.e<A&&(Y.c=[Y.e=0])}return Y}function he(Y){var X,J=Y.e;return J===null?Y.toString():(X=coeffToString(Y.c),X=J<=_||J>=S?toExponential(X,J):toFixedPoint(X,J,"0"),Y.s<0?"-"+X:X)}return v.absoluteValue=v.abs=function(){var Y=new B(this);return Y.s<0&&(Y.s=1),Y},v.comparedTo=function(Y,X){return compare(this,new B(Y,X))},v.decimalPlaces=v.dp=function(Y,X){var J,j,M,N=this;if(Y!=null)return intCheck(Y,0,MAX),X==null?X=E:intCheck(X,0,8),ue(new B(N),Y+N.e+1,X);if(!(J=N.c))return null;if(j=((M=J.length-1)-bitFloor(this.e/LOG_BASE))*LOG_BASE,M=J[M])for(;M%10==0;M/=10,j--);return j<0&&(j=0),j},v.dividedBy=v.div=function(Y,X){return u(this,new B(Y,X),w,E)},v.dividedToIntegerBy=v.idiv=function(Y,X){return u(this,new B(Y,X),0,1)},v.exponentiatedBy=v.pow=function(Y,X){var J,j,M,N,P,O,k,q,F,H=this;if(Y=new B(Y),Y.c&&!Y.isInteger())throw Error(bignumberError+"Exponent not an integer: "+he(Y));if(X!=null&&(X=new B(X)),O=Y.e>14,!H.c||!H.c[0]||H.c[0]==1&&!H.e&&H.c.length==1||!Y.c||!Y.c[0])return F=new B(Math.pow(+he(H),O?Y.s*(2-isOdd(Y)):+he(Y))),X?F.mod(X):F;if(k=Y.s<0,X){if(X.c?!X.c[0]:!X.s)return new B(NaN);j=!k&&H.isInteger()&&X.isInteger(),j&&(H=H.mod(X))}else{if(Y.e>9&&(H.e>0||H.e<-1||(H.e==0?H.c[0]>1||O&&H.c[1]>=24e7:H.c[0]<8e13||O&&H.c[0]<=9999975e7)))return N=H.s<0&&isOdd(Y)?-0:0,H.e>-1&&(N=1/N),new B(k?1/N:N);C&&(N=mathceil(C/LOG_BASE+2))}for(O?(J=new B(.5),k&&(Y.s=1),q=isOdd(Y)):(M=Math.abs(+he(Y)),q=M%2),F=new B(b);;){if(q){if(F=F.times(H),!F.c)break;N?F.c.length>N&&(F.c.length=N):j&&(F=F.mod(X))}if(M){if(M=mathfloor(M/2),M===0)break;q=M%2}else if(Y=Y.times(J),ue(Y,Y.e+1,1),Y.e>14)q=isOdd(Y);else{if(M=+he(Y),M===0)break;q=M%2}H=H.times(H),N?H.c&&H.c.length>N&&(H.c.length=N):j&&(H=H.mod(X))}return j?F:(k&&(F=b.div(F)),X?F.mod(X):N?ue(F,C,E,P):F)},v.integerValue=function(Y){var X=new B(this);return Y==null?Y=E:intCheck(Y,0,8),ue(X,X.e+1,Y)},v.isEqualTo=v.eq=function(Y,X){return compare(this,new B(Y,X))===0},v.isFinite=function(){return!!this.c},v.isGreaterThan=v.gt=function(Y,X){return compare(this,new B(Y,X))>0},v.isGreaterThanOrEqualTo=v.gte=function(Y,X){return(X=compare(this,new B(Y,X)))===1||X===0},v.isInteger=function(){return!!this.c&&bitFloor(this.e/LOG_BASE)>this.c.length-2},v.isLessThan=v.lt=function(Y,X){return compare(this,new B(Y,X))<0},v.isLessThanOrEqualTo=v.lte=function(Y,X){return(X=compare(this,new B(Y,X)))===-1||X===0},v.isNaN=function(){return!this.s},v.isNegative=function(){return this.s<0},v.isPositive=function(){return this.s>0},v.isZero=function(){return!!this.c&&this.c[0]==0},v.minus=function(Y,X){var J,j,M,N,P=this,O=P.s;if(Y=new B(Y,X),X=Y.s,!O||!X)return new B(NaN);if(O!=X)return Y.s=-X,P.plus(Y);var k=P.e/LOG_BASE,q=Y.e/LOG_BASE,F=P.c,H=Y.c;if(!k||!q){if(!F||!H)return F?(Y.s=-X,Y):new B(H?P:NaN);if(!F[0]||!H[0])return H[0]?(Y.s=-X,Y):new B(F[0]?P:E==3?-0:0)}if(k=bitFloor(k),q=bitFloor(q),F=F.slice(),O=k-q){for((N=O<0)?(O=-O,M=F):(q=k,M=H),M.reverse(),X=O;X--;M.push(0));M.reverse()}else for(j=(N=(O=F.length)<(X=H.length))?O:X,O=X=0;X<j;X++)if(F[X]!=H[X]){N=F[X]<H[X];break}if(N&&(M=F,F=H,H=M,Y.s=-Y.s),X=(j=H.length)-(J=F.length),X>0)for(;X--;F[J++]=0);for(X=BASE-1;j>O;){if(F[--j]<H[j]){for(J=j;J&&!F[--J];F[J]=X);--F[J],F[j]+=BASE}F[j]-=H[j]}for(;F[0]==0;F.splice(0,1),--q);return F[0]?ne(Y,F,q):(Y.s=E==3?-1:1,Y.c=[Y.e=0],Y)},v.modulo=v.mod=function(Y,X){var J,j,M=this;return Y=new B(Y,X),!M.c||!Y.s||Y.c&&!Y.c[0]?new B(NaN):!Y.c||M.c&&!M.c[0]?new B(M):(T==9?(j=Y.s,Y.s=1,J=u(M,Y,0,3),Y.s=j,J.s*=j):J=u(M,Y,0,T),Y=M.minus(J.times(Y)),!Y.c[0]&&T==1&&(Y.s=M.s),Y)},v.multipliedBy=v.times=function(Y,X){var J,j,M,N,P,O,k,q,F,H,D,G,W,K,Z,ae=this,le=ae.c,te=(Y=new B(Y,X)).c;if(!le||!te||!le[0]||!te[0])return!ae.s||!Y.s||le&&!le[0]&&!te||te&&!te[0]&&!le?Y.c=Y.e=Y.s=null:(Y.s*=ae.s,!le||!te?Y.c=Y.e=null:(Y.c=[0],Y.e=0)),Y;for(j=bitFloor(ae.e/LOG_BASE)+bitFloor(Y.e/LOG_BASE),Y.s*=ae.s,k=le.length,H=te.length,k<H&&(W=le,le=te,te=W,M=k,k=H,H=M),M=k+H,W=[];M--;W.push(0));for(K=BASE,Z=SQRT_BASE,M=H;--M>=0;){for(J=0,D=te[M]%Z,G=te[M]/Z|0,P=k,N=M+P;N>M;)q=le[--P]%Z,F=le[P]/Z|0,O=G*q+F*D,q=D*q+O%Z*Z+W[N]+J,J=(q/K|0)+(O/Z|0)+G*F,W[N--]=q%K;W[N]=J}return J?++j:W.splice(0,1),ne(Y,W,j)},v.negated=function(){var Y=new B(this);return Y.s=-Y.s||null,Y},v.plus=function(Y,X){var J,j=this,M=j.s;if(Y=new B(Y,X),X=Y.s,!M||!X)return new B(NaN);if(M!=X)return Y.s=-X,j.minus(Y);var N=j.e/LOG_BASE,P=Y.e/LOG_BASE,O=j.c,k=Y.c;if(!N||!P){if(!O||!k)return new B(M/0);if(!O[0]||!k[0])return k[0]?Y:new B(O[0]?j:M*0)}if(N=bitFloor(N),P=bitFloor(P),O=O.slice(),M=N-P){for(M>0?(P=N,J=k):(M=-M,J=O),J.reverse();M--;J.push(0));J.reverse()}for(M=O.length,X=k.length,M-X<0&&(J=k,k=O,O=J,X=M),M=0;X;)M=(O[--X]=O[X]+k[X]+M)/BASE|0,O[X]=BASE===O[X]?0:O[X]%BASE;return M&&(O=[M].concat(O),++P),ne(Y,O,P)},v.precision=v.sd=function(Y,X){var J,j,M,N=this;if(Y!=null&&Y!==!!Y)return intCheck(Y,1,MAX),X==null?X=E:intCheck(X,0,8),ue(new B(N),Y,X);if(!(J=N.c))return null;if(M=J.length-1,j=M*LOG_BASE+1,M=J[M]){for(;M%10==0;M/=10,j--);for(M=J[0];M>=10;M/=10,j++);}return Y&&N.e+1>j&&(j=N.e+1),j},v.shiftedBy=function(Y){return intCheck(Y,-MAX_SAFE_INTEGER,MAX_SAFE_INTEGER),this.times("1e"+Y)},v.squareRoot=v.sqrt=function(){var Y,X,J,j,M,N=this,P=N.c,O=N.s,k=N.e,q=w+4,F=new B("0.5");if(O!==1||!P||!P[0])return new B(!O||O<0&&(!P||P[0])?NaN:P?N:1/0);if(O=Math.sqrt(+he(N)),O==0||O==1/0?(X=coeffToString(P),(X.length+k)%2==0&&(X+="0"),O=Math.sqrt(+X),k=bitFloor((k+1)/2)-(k<0||k%2),O==1/0?X="5e"+k:(X=O.toExponential(),X=X.slice(0,X.indexOf("e")+1)+k),J=new B(X)):J=new B(O+""),J.c[0]){for(k=J.e,O=k+q,O<3&&(O=0);;)if(M=J,J=F.times(M.plus(u(N,M,q,1))),coeffToString(M.c).slice(0,O)===(X=coeffToString(J.c)).slice(0,O))if(J.e<k&&--O,X=X.slice(O-3,O+1),X=="9999"||!j&&X=="4999"){if(!j&&(ue(M,M.e+w+2,0),M.times(M).eq(N))){J=M;break}q+=4,O+=4,j=1}else{(!+X||!+X.slice(1)&&X.charAt(0)=="5")&&(ue(J,J.e+w+2,1),Y=!J.times(J).eq(N));break}}return ue(J,J.e+w+1,E,Y)},v.toExponential=function(Y,X){return Y!=null&&(intCheck(Y,0,MAX),Y++),U(this,Y,X,1)},v.toFixed=function(Y,X){return Y!=null&&(intCheck(Y,0,MAX),Y=Y+this.e+1),U(this,Y,X)},v.toFormat=function(Y,X,J){var j,M=this;if(J==null)Y!=null&&X&&typeof X=="object"?(J=X,X=null):Y&&typeof Y=="object"?(J=Y,Y=X=null):J=I;else if(typeof J!="object")throw Error(bignumberError+"Argument not an object: "+J);if(j=M.toFixed(Y,X),M.c){var N,P=j.split("."),O=+J.groupSize,k=+J.secondaryGroupSize,q=J.groupSeparator||"",F=P[0],H=P[1],D=M.s<0,G=D?F.slice(1):F,W=G.length;if(k&&(N=O,O=k,k=N,W-=N),O>0&&W>0){for(N=W%O||O,F=G.substr(0,N);N<W;N+=O)F+=q+G.substr(N,O);k>0&&(F+=q+G.slice(N)),D&&(F="-"+F)}j=H?F+(J.decimalSeparator||"")+((k=+J.fractionGroupSize)?H.replace(new RegExp("\\d{"+k+"}\\B","g"),"$&"+(J.fractionGroupSeparator||"")):H):F}return(J.prefix||"")+j+(J.suffix||"")},v.toFraction=function(Y){var X,J,j,M,N,P,O,k,q,F,H,D,G=this,W=G.c;if(Y!=null&&(O=new B(Y),!O.isInteger()&&(O.c||O.s!==1)||O.lt(b)))throw Error(bignumberError+"Argument "+(O.isInteger()?"out of range: ":"not an integer: ")+he(O));if(!W)return new B(G);for(X=new B(b),q=J=new B(b),j=k=new B(b),D=coeffToString(W),N=X.e=D.length-G.e-1,X.c[0]=POWS_TEN[(P=N%LOG_BASE)<0?LOG_BASE+P:P],Y=!Y||O.comparedTo(X)>0?N>0?X:q:O,P=R,R=1/0,O=new B(D),k.c[0]=0;F=u(O,X,0,1),M=J.plus(F.times(j)),M.comparedTo(Y)!=1;)J=j,j=M,q=k.plus(F.times(M=q)),k=M,X=O.minus(F.times(M=X)),O=M;return M=u(Y.minus(J),j,0,1),k=k.plus(M.times(q)),J=J.plus(M.times(j)),k.s=q.s=G.s,N=N*2,H=u(q,j,N,E).minus(G).abs().comparedTo(u(k,J,N,E).minus(G).abs())<1?[q,j]:[k,J],R=P,H},v.toNumber=function(){return+he(this)},v.toPrecision=function(Y,X){return Y!=null&&intCheck(Y,1,MAX),U(this,Y,X,2)},v.toString=function(Y){var X,J=this,j=J.s,M=J.e;return M===null?j?(X="Infinity",j<0&&(X="-"+X)):X="NaN":(Y==null?X=M<=_||M>=S?toExponential(coeffToString(J.c),M):toFixedPoint(coeffToString(J.c),M,"0"):Y===10&&$?(J=ue(new B(J),w+M+1,E),X=toFixedPoint(coeffToString(J.c),J.e,"0")):(intCheck(Y,2,L.length,"Base"),X=h(toFixedPoint(coeffToString(J.c),M,"0"),10,Y,j,!0)),j<0&&J.c[0]&&(X="-"+X)),X},v.valueOf=v.toJSON=function(){return he(this)},v._isBigNumber=!0,v[Symbol.toStringTag]="BigNumber",v[Symbol.for("nodejs.util.inspect.custom")]=v.valueOf,g!=null&&B.set(g),B}function bitFloor(g){var u=g|0;return g>0||g===u?u:u-1}function coeffToString(g){for(var u,h,y=1,v=g.length,b=g[0]+"";y<v;){for(u=g[y++]+"",h=LOG_BASE-u.length;h--;u="0"+u);b+=u}for(v=b.length;b.charCodeAt(--v)===48;);return b.slice(0,v+1||1)}function compare(g,u){var h,y,v=g.c,b=u.c,w=g.s,E=u.s,_=g.e,S=u.e;if(!w||!E)return null;if(h=v&&!v[0],y=b&&!b[0],h||y)return h?y?0:-E:w;if(w!=E)return w;if(h=w<0,y=_==S,!v||!b)return y?0:!v^h?1:-1;if(!y)return _>S^h?1:-1;for(E=(_=v.length)<(S=b.length)?_:S,w=0;w<E;w++)if(v[w]!=b[w])return v[w]>b[w]^h?1:-1;return _==S?0:_>S^h?1:-1}function intCheck(g,u,h,y){if(g<u||g>h||g!==mathfloor(g))throw Error(bignumberError+(y||"Argument")+(typeof g=="number"?g<u||g>h?" out of range: ":" not an integer: ":" not a primitive number: ")+String(g))}function isOdd(g){var u=g.c.length-1;return bitFloor(g.e/LOG_BASE)==u&&g.c[u]%2!=0}function toExponential(g,u){return(g.length>1?g.charAt(0)+"."+g.slice(1):g)+(u<0?"e":"e+")+u}function toFixedPoint(g,u,h){var y,v;if(u<0){for(v=h+".";++u;v+=h);g=v+g}else if(y=g.length,++u>y){for(v=h,u-=y;--u;v+=h);g+=v}else u<y&&(g=g.slice(0,u)+"."+g.slice(u));return g}clone();function getPopupFeatures({width:g,height:u}){const h=window.screenLeft!==void 0?window.screenLeft:window.screenX,y=window.screenTop!==void 0?window.screenTop:window.screenY,v=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:window.screen.width,b=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:window.screen.height,w=1,E=Math.abs((v-g)/2/w+h),_=Math.abs((b-u)/2/w+y);return`titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=${u/w},width=${g/w},top=${_},left=${E}`}const RETRIABLE_ERRORS=["Gateway timeout","ETIMEDOUT","failed to parse response body","Failed to fetch"];function checkForHttpErrors(g){switch(g.status){case 405:throw rpcErrors.methodNotFound();case 418:throw rpcErrors.internal({message:"Request is being rate limited.",data:{cause:g}});case 503:case 504:throw rpcErrors.internal({message:"Gateway timeout. The request took too long to process.This can happen when querying over too wide a block range.",data:{cause:g}})}}function timeout(g){return new Promise(u=>{setTimeout(u,g)})}function parseResponse(g,u){if(g.status!==200)throw rpcErrors.internal({message:`Non-200 status code: '${g.status}'`,data:u});if(u.error){var h;throw rpcErrors.internal({data:u.error,message:(h=u.error)===null||h===void 0?void 0:h.message})}return u.result}function createFetchConfigFromReq({req:g,rpcTarget:u,originHttpHeaderKey:h}){const y=new URL(u),v={id:g.id,jsonrpc:g.jsonrpc,method:g.method,params:g.params},b=g.origin,w=JSON.stringify(v),E={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:w};return h&&b&&(E.headers[h]=b),{fetchUrl:y.href,fetchParams:E}}function createFetchMiddleware({rpcTarget:g,originHttpHeaderKey:u}){return createAsyncMiddleware(async(h,y,v)=>{const{fetchUrl:b,fetchParams:w}=createFetchConfigFromReq({req:h,rpcTarget:g,originHttpHeaderKey:u}),E=5,_=1e3;for(let S=0;S<E;S++){try{const A=await fetch(b,w);checkForHttpErrors(A);const R=await A.json(),x=parseResponse(A,R);y.result=x;return}catch(A){const R=(A.message||A).toString();if(!RETRIABLE_ERRORS.some(T=>R.includes(T)))throw A}await timeout(_)}})}function cloneDeep(g){try{return structuredClone(g)}catch{return JSON.parse(JSON.stringify(g,(h,y)=>typeof y=="bigint"?y.toString():y))}}function createLoggerMiddleware(g){return function(h,y,v){v(b=>{y.error&&loglevel$2.warn(`Error in RPC response:
`,y),!h.isTorusInternal&&(loglevel$2.info(`RPC (${g.origin}):`,h,"->",y),b())})}}const MULTI_CHAIN_ADAPTERS={AUTH:"auth",WALLET_CONNECT_V2:"wallet-connect-v2",SFA:"sfa"},SOLANA_ADAPTERS=_objectSpread2({TORUS_SOLANA:"torus-solana"},MULTI_CHAIN_ADAPTERS),EVM_ADAPTERS=_objectSpread2({TORUS_EVM:"torus-evm",COINBASE:"coinbase"},MULTI_CHAIN_ADAPTERS),WALLET_ADAPTERS=_objectSpread2(_objectSpread2({},EVM_ADAPTERS),SOLANA_ADAPTERS);MULTI_CHAIN_ADAPTERS.AUTH+"",MULTI_CHAIN_ADAPTERS.WALLET_CONNECT_V2+"",MULTI_CHAIN_ADAPTERS.SFA+"",SOLANA_ADAPTERS.TORUS_SOLANA+"",EVM_ADAPTERS.TORUS_EVM+"",EVM_ADAPTERS.COINBASE+"";const ADAPTER_CATEGORY={IN_APP:"in_app"},ADAPTER_STATUS={NOT_READY:"not_ready",READY:"ready",CONNECTING:"connecting",CONNECTED:"connected",DISCONNECTED:"disconnected",ERRORED:"errored"},ADAPTER_EVENTS=_objectSpread2(_objectSpread2({},ADAPTER_STATUS),{},{ADAPTER_DATA_UPDATED:"adapter_data_updated",CACHE_CLEAR:"cache_clear"});class BaseAdapter extends SafeEventEmitter{constructor(u={}){super(),_defineProperty(this,"adapterData",{}),_defineProperty(this,"sessionTime",86400),_defineProperty(this,"clientId",void 0),_defineProperty(this,"web3AuthNetwork",WEB3AUTH_NETWORK.MAINNET),_defineProperty(this,"useCoreKitKey",void 0),_defineProperty(this,"rehydrated",!1),_defineProperty(this,"chainConfig",null),_defineProperty(this,"knownChainConfigs",{}),_defineProperty(this,"adapterNamespace",void 0),_defineProperty(this,"currentChainNamespace",void 0),_defineProperty(this,"type",void 0),_defineProperty(this,"name",void 0),_defineProperty(this,"status",void 0),this.setAdapterSettings(u)}get chainConfigProxy(){return this.chainConfig?_objectSpread2({},this.chainConfig):null}get connnected(){return this.status===ADAPTER_STATUS.CONNECTED}setAdapterSettings(u){if(this.status===ADAPTER_STATUS.READY)return;u!=null&&u.sessionTime&&(this.sessionTime=u.sessionTime),u!=null&&u.clientId&&(this.clientId=u.clientId),u!=null&&u.web3AuthNetwork&&(this.web3AuthNetwork=u.web3AuthNetwork),u?.useCoreKitKey!==void 0&&(this.useCoreKitKey=u.useCoreKitKey);const h=u.chainConfig;if(h){if(!h.chainNamespace)throw WalletInitializationError.notReady("ChainNamespace is required while setting chainConfig");this.currentChainNamespace=h.chainNamespace;const y=getChainConfig(h.chainNamespace,h.chainId,this.clientId),v=_objectSpread2(_objectSpread2({},y||{}),h);this.chainConfig=v,this.addChainConfig(v)}}checkConnectionRequirements(){if(!(this.name===WALLET_ADAPTERS.WALLET_CONNECT_V2&&this.status===ADAPTER_STATUS.CONNECTING)){if(this.status===ADAPTER_STATUS.CONNECTING)throw WalletInitializationError.notReady("Already connecting");if(this.status===ADAPTER_STATUS.CONNECTED)throw WalletLoginError.connectionError("Already connected");if(this.status!==ADAPTER_STATUS.READY)throw WalletLoginError.connectionError("Wallet adapter is not ready yet, Please wait for init function to resolve before calling connect/connectTo function")}}checkInitializationRequirements(){if(!this.clientId)throw WalletInitializationError.invalidParams("Please initialize Web3Auth with a valid clientId in constructor");if(!this.chainConfig||!this.chainConfig.rpcTarget&&this.chainConfig.chainNamespace!==CHAIN_NAMESPACES.OTHER)throw WalletInitializationError.invalidParams("rpcTarget is required in chainConfig");if(!this.chainConfig.chainId&&this.chainConfig.chainNamespace!==CHAIN_NAMESPACES.OTHER)throw WalletInitializationError.invalidParams("chainID is required in chainConfig");if(this.status!==ADAPTER_STATUS.NOT_READY){if(this.status===ADAPTER_STATUS.CONNECTED)throw WalletInitializationError.notReady("Already connected");if(this.status===ADAPTER_STATUS.READY)throw WalletInitializationError.notReady("Adapter is already initialized")}}checkDisconnectionRequirements(){if(this.status!==ADAPTER_STATUS.CONNECTED)throw WalletLoginError.disconnectionError("Not connected with wallet")}checkAddChainRequirements(u,h=!1){if(!h&&!this.provider)throw WalletLoginError.notConnectedError("Not connected with wallet.");if(this.currentChainNamespace!==u.chainNamespace)throw WalletOperationsError.chainNamespaceNotAllowed("This adapter doesn't support this chainNamespace")}checkSwitchChainRequirements({chainId:u},h=!1){if(!h&&!this.provider)throw WalletLoginError.notConnectedError("Not connected with wallet.");if(!this.knownChainConfigs[u])throw WalletLoginError.chainConfigNotAdded("Invalid chainId")}updateAdapterData(u){this.adapterData=u,this.emit(ADAPTER_EVENTS.ADAPTER_DATA_UPDATED,{adapterName:this.name,data:u})}addChainConfig(u){const h=this.knownChainConfigs[u.chainId];this.knownChainConfigs[u.chainId]=_objectSpread2(_objectSpread2({},h||{}),u)}getChainConfig(u){return this.knownChainConfigs[u]||null}}function storageAvailable(g){let u=!1,h=0,y;try{y=window[g],u=!0,h=y.length;const v="__storage_test__";return y.setItem(v,v),y.removeItem(v),!0}catch(v){const b=v;return!!(b&&(b.code===22||b.code===1014||b.name==="QuotaExceededError"||b.name==="NS_ERROR_DOM_QUOTA_REACHED")&&u&&h!==0)}}const signerHost=g=>SIGNER_MAP[g??WEB3AUTH_NETWORK.SAPPHIRE_MAINNET],fetchProjectConfig=async(g,u,h)=>{const y=new URL(`${signerHost(u)}/api/configuration`);return y.searchParams.append("project_id",g),y.searchParams.append("network",u),y.searchParams.append("whitelist","true"),h&&y.searchParams.append("aa_provider",h),await get(y.href)},PLUGIN_NAMESPACES=_objectSpread2(_objectSpread2({},CHAIN_NAMESPACES),{},{MULTICHAIN:"multichain"}),PLUGIN_STATUS={READY:"ready",CONNECTING:"connecting",CONNECTED:"connected",DISCONNECTED:"disconnected",ERRORED:"errored"};_objectSpread2({},PLUGIN_STATUS);const EVM_PLUGINS={WALLET_SERVICES:"wallet-services",NFT_CHECKOUT:"nft-checkout"},SOLANA_PLUGINS={SOLANA:"solana"};_objectSpread2(_objectSpread2({},EVM_PLUGINS),SOLANA_PLUGINS);const getAuthDefaultOptions=()=>({adapterSettings:{network:WEB3AUTH_NETWORK.SAPPHIRE_MAINNET,clientId:"",uxMode:UX_MODE.POPUP},loginSettings:{},privateKeyProvider:void 0});class AuthAdapter extends BaseAdapter{constructor(u={}){super(u),_defineProperty(this,"name",WALLET_ADAPTERS.AUTH),_defineProperty(this,"adapterNamespace",ADAPTER_NAMESPACES.MULTICHAIN),_defineProperty(this,"type",ADAPTER_CATEGORY.IN_APP),_defineProperty(this,"authInstance",null),_defineProperty(this,"status",ADAPTER_STATUS.NOT_READY),_defineProperty(this,"currentChainNamespace",CHAIN_NAMESPACES.EIP155),_defineProperty(this,"privateKeyProvider",null),_defineProperty(this,"authOptions",void 0),_defineProperty(this,"loginSettings",{loginProvider:""}),this.setAdapterSettings(_objectSpread2(_objectSpread2({},u.adapterSettings),{},{chainConfig:u.chainConfig,clientId:u.clientId||"",sessionTime:u.sessionTime,web3AuthNetwork:u.web3AuthNetwork,useCoreKitKey:u.useCoreKitKey,privateKeyProvider:u.privateKeyProvider})),this.loginSettings=u.loginSettings||{loginProvider:""},this.privateKeyProvider=u.privateKeyProvider||null}get chainConfigProxy(){return this.chainConfig?_objectSpread2({},this.chainConfig):null}get provider(){return this.status!==ADAPTER_STATUS.NOT_READY&&this.privateKeyProvider?this.privateKeyProvider:null}set provider(u){throw new Error("Not implemented")}async init(u){if(super.checkInitializationRequirements(),!this.clientId)throw WalletInitializationError.invalidParams("clientId is required before auth's initialization");if(!this.authOptions)throw WalletInitializationError.invalidParams("authOptions is required before auth's initialization");const h=this.authOptions.uxMode===UX_MODE.REDIRECT;if(this.authOptions=_objectSpread2(_objectSpread2({},this.authOptions),{},{replaceUrlOnRedirect:h,useCoreKitKey:this.useCoreKitKey}),this.authInstance=new Auth(_objectSpread2(_objectSpread2({},this.authOptions),{},{clientId:this.clientId,network:this.authOptions.network||this.web3AuthNetwork||WEB3AUTH_NETWORK.SAPPHIRE_MAINNET})),loglevel.debug("initializing auth adapter init"),await this.authInstance.init(),!this.chainConfig)throw WalletInitializationError.invalidParams("chainConfig is required before initialization");this.status=ADAPTER_STATUS.READY,this.emit(ADAPTER_EVENTS.READY,WALLET_ADAPTERS.AUTH);try{loglevel.debug("initializing auth adapter"),this._getFinalPrivKey()&&(u.autoConnect||h)&&(this.rehydrated=!0,await this.connect())}catch(y){loglevel.error("Failed to connect with cached auth provider",y),this.emit(ADAPTER_EVENTS.ERRORED,y)}}async connect(u={loginProvider:""}){super.checkConnectionRequirements(),this.status=ADAPTER_STATUS.CONNECTING,this.emit(ADAPTER_EVENTS.CONNECTING,_objectSpread2(_objectSpread2({},u),{},{adapter:WALLET_ADAPTERS.AUTH}));try{return await this.connectWithProvider(u),this.provider}catch(h){throw loglevel.error("Failed to connect with auth provider",h),this.status=ADAPTER_STATUS.READY,this.emit(ADAPTER_EVENTS.ERRORED,h),h!=null&&h.message.includes("user closed popup")?WalletLoginError.popupClosed():h instanceof Web3AuthError?h:WalletLoginError.connectionError("Failed to login with auth",h)}}async enableMFA(u={loginProvider:""}){if(this.status!==ADAPTER_STATUS.CONNECTED)throw WalletLoginError.notConnectedError("Not connected with wallet");if(!this.authInstance)throw WalletInitializationError.notReady("authInstance is not ready");try{await this.authInstance.enableMFA(u)}catch(h){throw loglevel.error("Failed to enable MFA with auth provider",h),h instanceof Web3AuthError?h:WalletLoginError.connectionError("Failed to enable MFA with auth",h)}}async manageMFA(u={loginProvider:""}){if(this.status!==ADAPTER_STATUS.CONNECTED)throw WalletLoginError.notConnectedError("Not connected with wallet");if(!this.authInstance)throw WalletInitializationError.notReady("authInstance is not ready");try{await this.authInstance.manageMFA(u)}catch(h){throw loglevel.error("Failed to manage MFA with auth provider",h),h instanceof Web3AuthError?h:WalletLoginError.connectionError("Failed to manage MFA with auth",h)}}async disconnect(u={cleanup:!1}){if(this.status!==ADAPTER_STATUS.CONNECTED)throw WalletLoginError.notConnectedError("Not connected with wallet");if(!this.authInstance)throw WalletInitializationError.notReady("authInstance is not ready");await this.authInstance.logout(),u.cleanup?(this.status=ADAPTER_STATUS.NOT_READY,this.authInstance=null,this.privateKeyProvider=null):this.status=ADAPTER_STATUS.READY,this.rehydrated=!1,this.emit(ADAPTER_EVENTS.DISCONNECTED)}async authenticateUser(){if(this.status!==ADAPTER_STATUS.CONNECTED)throw WalletLoginError.notConnectedError("Not connected with wallet, Please login/connect first");return{idToken:(await this.getUserInfo()).idToken}}async getUserInfo(){if(this.status!==ADAPTER_STATUS.CONNECTED)throw WalletLoginError.notConnectedError("Not connected with wallet");if(!this.authInstance)throw WalletInitializationError.notReady("authInstance is not ready");return this.authInstance.getUserInfo()}setAdapterSettings(u){super.setAdapterSettings(u);const h=getAuthDefaultOptions();loglevel.info("setting adapter settings",u),this.authOptions=deepmerge.all([h.adapterSettings,this.authOptions||{},u||{}]),u.web3AuthNetwork&&(this.authOptions.network=u.web3AuthNetwork),u.privateKeyProvider&&(this.privateKeyProvider=u.privateKeyProvider)}async addChain(u,h=!1){var y;super.checkAddChainRequirements(u,h),(y=this.privateKeyProvider)===null||y===void 0||y.addChain(u),this.addChainConfig(u)}async switchChain(u,h=!1){var y;super.checkSwitchChainRequirements(u,h),await((y=this.privateKeyProvider)===null||y===void 0?void 0:y.switchChain(u)),this.setAdapterSettings({chainConfig:this.getChainConfig(u.chainId)})}_getFinalPrivKey(){if(!this.authInstance)return"";let u=this.authInstance.privKey;if(this.useCoreKitKey){if(this.authInstance.privKey&&!this.authInstance.coreKitKey)throw WalletLoginError.coreKitKeyNotFound();u=this.authInstance.coreKitKey}return u}_getFinalEd25519PrivKey(){if(!this.authInstance)return"";let u=this.authInstance.ed25519PrivKey;if(this.useCoreKitKey){if(this.authInstance.ed25519PrivKey&&!this.authInstance.coreKitEd25519Key)throw WalletLoginError.coreKitKeyNotFound();u=this.authInstance.coreKitEd25519Key}return u}async connectWithProvider(u={loginProvider:""}){var h;if(!this.privateKeyProvider)throw WalletInitializationError.invalidParams("PrivateKey Provider is required before initialization");if(!this.authInstance)throw WalletInitializationError.notReady("authInstance is not ready");if(!this._getFinalPrivKey()||(h=u.extraLoginOptions)!==null&&h!==void 0&&h.id_token){var v;if(this.loginSettings.curve=SUPPORTED_KEY_CURVES.OTHER,!u.loginProvider&&!this.loginSettings.loginProvider)throw WalletInitializationError.invalidParams("loginProvider is required for login");await this.authInstance.login(deepmerge.all([this.loginSettings,u,{extraLoginOptions:_objectSpread2(_objectSpread2({},u.extraLoginOptions||{}),{},{login_hint:u.login_hint||((v=u.extraLoginOptions)===null||v===void 0?void 0:v.login_hint)})}]))}let b=this._getFinalPrivKey();b&&(this.currentChainNamespace===CHAIN_NAMESPACES.SOLANA&&(b=this._getFinalEd25519PrivKey()),await this.privateKeyProvider.setupProvider(b),this.status=ADAPTER_STATUS.CONNECTED,this.emit(ADAPTER_EVENTS.CONNECTED,{adapter:WALLET_ADAPTERS.AUTH,reconnected:this.rehydrated,provider:this.provider}))}}let BaseProvider$1=class extends BaseController{constructor({config:u,state:h}){if(super({config:u,state:h}),_defineProperty(this,"_providerEngineProxy",null),_defineProperty(this,"keyExportFlagSetByCode",!1),!u.chainConfig)throw WalletInitializationError.invalidProviderConfigError("Please provide chainConfig");if(!u.chainConfig.chainId)throw WalletInitializationError.invalidProviderConfigError("Please provide chainId inside chainConfig");if(!u.chainConfig.rpcTarget)throw WalletInitializationError.invalidProviderConfigError("Please provide rpcTarget inside chainConfig");typeof u.keyExportEnabled=="boolean"&&(this.keyExportFlagSetByCode=!0),this.defaultState={chainId:"loading"},this.defaultConfig={chainConfig:u.chainConfig,networks:{[u.chainConfig.chainId]:u.chainConfig},keyExportEnabled:typeof u.keyExportEnabled=="boolean"?u.keyExportEnabled:!0},super.initialize()}get currentChainConfig(){return this.config.chainConfig}get provider(){return this._providerEngineProxy}get chainId(){return this.state.chainId}set provider(u){throw new Error("Method not implemented.")}async request(u){var h;if(!u||typeof u!="object"||Array.isArray(u))throw rpcErrors.invalidRequest({message:WalletProviderError.invalidRequestArgs().message,data:_objectSpread2(_objectSpread2({},u||{}),{},{cause:WalletProviderError.invalidRequestArgs().message})});const{method:y,params:v}=u;if(typeof y!="string"||y.length===0)throw rpcErrors.invalidRequest({message:WalletProviderError.invalidRequestMethod().message,data:_objectSpread2(_objectSpread2({},u||{}),{},{cause:WalletProviderError.invalidRequestMethod().message})});if(v!==void 0&&!Array.isArray(v)&&(typeof v!="object"||v===null))throw rpcErrors.invalidRequest({message:WalletProviderError.invalidRequestParams().message,data:_objectSpread2(_objectSpread2({},u||{}),{},{cause:WalletProviderError.invalidRequestParams().message})});return(h=this.provider)===null||h===void 0?void 0:h.request(u)}sendAsync(u,h){return h?this.send(u,h):this.request(u)}send(u,h){this.request(u).then(y=>h(null,{result:y})).catch(y=>h(y,null))}addChain(u){if(!u.chainId||!u.rpcTarget)throw rpcErrors.invalidParams("chainId is required");this.configure({networks:_objectSpread2(_objectSpread2({},this.config.networks),{},{[u.chainId]:u})})}getChainConfig(u){var h;const y=(h=this.config.networks)===null||h===void 0?void 0:h[u];if(!y)throw rpcErrors.invalidRequest(`Chain ${u} is not supported, please add chainConfig for it`);return y}updateProviderEngineProxy(u){this._providerEngineProxy?this._providerEngineProxy.setTarget(u):this._providerEngineProxy=createEventEmitterProxy(u)}setKeyExportFlag(u){this.keyExportFlagSetByCode||this.configure({keyExportEnabled:u})}getProviderEngineProxy(){return this._providerEngineProxy}};function createChainIdMiddleware$1(g){return(u,h,y,v)=>u.method==="chainId"?(h.result=g,v()):y()}function createProviderConfigMiddleware$1(g){return(u,h,y,v)=>u.method==="provider_config"?(h.result=g,v()):y()}function createJsonRpcClient$1(g){const{chainId:u,rpcTarget:h}=g,y=createFetchMiddleware({rpcTarget:h});return{networkMiddleware:mergeMiddleware([createChainIdMiddleware$1(u),createProviderConfigMiddleware$1(g),y]),fetchMiddleware:y}}var _CommonJRPCProvider;class CommonJRPCProvider extends BaseProvider$1{constructor({config:u,state:h}){super({config:u,state:h})}async setupProvider(){const{networkMiddleware:u}=createJsonRpcClient$1(this.config.chainConfig),h=new JRPCEngine;h.push(u);const y=providerFromEngine(h);this.updateProviderEngineProxy(y);const v=this.config.chainConfig.chainId;this.state.chainId!==v&&(this.emit("chainChanged",v),this.emit("connect",{chainId:v})),this.update({chainId:this.config.chainConfig.chainId})}async switchChain(u){if(!this._providerEngineProxy)throw providerErrors.custom({message:"Provider is not initialized",code:4902});const h=this.getChainConfig(u.chainId);this.update({chainId:"loading"}),this.configure({chainConfig:h}),await this.setupProvider()}updateProviderEngineProxy(u){this._providerEngineProxy?this._providerEngineProxy.setTarget(u):this._providerEngineProxy=createEventEmitterProxy(u)}getProviderEngineProxy(){return this._providerEngineProxy}lookupNetwork(){throw new Error("Method not implemented.")}}_CommonJRPCProvider=CommonJRPCProvider;_defineProperty(CommonJRPCProvider,"getProviderInstance",async g=>{const u=new _CommonJRPCProvider({config:{chainConfig:g.chainConfig}});return await u.setupProvider(),u});const ADAPTER_CACHE_KEY="Web3Auth-cachedAdapter";class Web3AuthNoModal extends SafeEventEmitter{constructor(u){var h,y,v,b;if(super(),_defineProperty(this,"coreOptions",void 0),_defineProperty(this,"connectedAdapterName",null),_defineProperty(this,"status",ADAPTER_STATUS.NOT_READY),_defineProperty(this,"cachedAdapter",null),_defineProperty(this,"walletAdapters",{}),_defineProperty(this,"commonJRPCProvider",null),_defineProperty(this,"plugins",{}),_defineProperty(this,"storage","localStorage"),!u.clientId)throw WalletInitializationError.invalidParams("Please provide a valid clientId in constructor");if(u.enableLogging?loglevel.enableAll():loglevel.setLevel("error"),!u.privateKeyProvider&&!u.chainConfig)throw WalletInitializationError.invalidParams("Please provide chainConfig or privateKeyProvider");if(u.chainConfig=u.chainConfig||u.privateKeyProvider.currentChainConfig,!((h=u.chainConfig)!==null&&h!==void 0&&h.chainNamespace)||!Object.values(CHAIN_NAMESPACES).includes((y=u.chainConfig)===null||y===void 0?void 0:y.chainNamespace))throw WalletInitializationError.invalidParams("Please provide a valid chainNamespace in chainConfig");u.storageKey==="session"&&(this.storage="sessionStorage"),this.cachedAdapter=storageAvailable(this.storage)?window[this.storage].getItem(ADAPTER_CACHE_KEY):null,this.coreOptions=_objectSpread2(_objectSpread2({},u),{},{chainConfig:_objectSpread2(_objectSpread2({},getChainConfig((v=u.chainConfig)===null||v===void 0?void 0:v.chainNamespace,(b=u.chainConfig)===null||b===void 0?void 0:b.chainId,u.clientId)||{}),u.chainConfig)}),this.subscribeToAdapterEvents=this.subscribeToAdapterEvents.bind(this)}get connected(){return!!this.connectedAdapterName}get provider(){return this.status!==ADAPTER_STATUS.NOT_READY&&this.commonJRPCProvider?this.commonJRPCProvider:null}set provider(u){throw new Error("Not implemented")}async init(){this.commonJRPCProvider=await CommonJRPCProvider.getProviderInstance({chainConfig:this.coreOptions.chainConfig});let u;try{var h;u=await fetchProjectConfig(this.coreOptions.clientId,this.coreOptions.web3AuthNetwork,(h=this.coreOptions.accountAbstractionProvider)===null||h===void 0?void 0:h.config.smartAccountInit.name)}catch(v){throw loglevel.error("Failed to fetch project configurations",v),WalletInitializationError.notReady("failed to fetch project configurations",v)}const y=Object.keys(this.walletAdapters).map(async v=>{if(this.subscribeToAdapterEvents(this.walletAdapters[v]),this.walletAdapters[v].chainConfigProxy)this.walletAdapters[v].setAdapterSettings({sessionTime:this.coreOptions.sessionTime,clientId:this.coreOptions.clientId,web3AuthNetwork:this.coreOptions.web3AuthNetwork,useCoreKitKey:this.coreOptions.useCoreKitKey});else{const b=this.coreOptions.chainConfig;if(!b.chainNamespace)throw WalletInitializationError.invalidParams("Please provide chainNamespace in chainConfig");this.walletAdapters[v].setAdapterSettings({chainConfig:b,sessionTime:this.coreOptions.sessionTime,clientId:this.coreOptions.clientId,web3AuthNetwork:this.coreOptions.web3AuthNetwork,useCoreKitKey:this.coreOptions.useCoreKitKey})}if(v===WALLET_ADAPTERS.AUTH){const b=this.walletAdapters[v],{whitelabel:w}=u;this.coreOptions.uiConfig=deepmerge(cloneDeep(w||{}),this.coreOptions.uiConfig||{}),this.coreOptions.uiConfig.mode||(this.coreOptions.uiConfig.mode="light");const{sms_otp_enabled:E,whitelist:_,key_export_enabled:S}=u;if(E!==void 0&&b.setAdapterSettings({loginConfig:{[LOGIN_PROVIDER.SMS_PASSWORDLESS]:{showOnModal:E,showOnDesktop:E,showOnMobile:E,showOnSocialBackupFactor:E}}}),_&&b.setAdapterSettings({originData:_.signed_urls}),typeof S=="boolean"&&(this.coreOptions.privateKeyProvider.setKeyExportFlag(S),this.commonJRPCProvider.setKeyExportFlag(S)),this.coreOptions.privateKeyProvider){if(b.currentChainNamespace!==this.coreOptions.privateKeyProvider.currentChainConfig.chainNamespace)throw WalletInitializationError.incompatibleChainNameSpace("private key provider is not compatible with provided chainNamespace for auth adapter");b.setAdapterSettings({privateKeyProvider:this.coreOptions.privateKeyProvider})}if(b.setAdapterSettings({whiteLabel:this.coreOptions.uiConfig}),!b.privateKeyProvider)throw WalletInitializationError.invalidParams("privateKeyProvider is required for auth adapter")}else if(v===WALLET_ADAPTERS.WALLET_CONNECT_V2){const b=this.walletAdapters[v],{wallet_connect_enabled:w,wallet_connect_project_id:E}=u;if(w===!1)throw WalletInitializationError.invalidParams("Please enable wallet connect v2 addon on dashboard");if(!E)throw WalletInitializationError.invalidParams("Invalid wallet connect project id. Please configure it on the dashboard");b.setAdapterSettings({adapterSettings:{walletConnectInitOptions:{projectId:E}}})}return this.walletAdapters[v].init({autoConnect:this.cachedAdapter===v}).catch(b=>loglevel.error(b,v))});await Promise.all(y),this.status===ADAPTER_STATUS.NOT_READY&&(this.status=ADAPTER_STATUS.READY,this.emit(ADAPTER_EVENTS.READY))}getAdapter(u){return this.walletAdapters[u]||null}configureAdapter(u){this.checkInitRequirements();const h=this.coreOptions.chainConfig;if(!h.chainNamespace)throw WalletInitializationError.invalidParams("Please provide chainNamespace in chainConfig");if(this.walletAdapters[u.name])throw WalletInitializationError.duplicateAdapterError(`Wallet adapter for ${u.name} already exists`);if(u.adapterNamespace!==ADAPTER_NAMESPACES.MULTICHAIN&&u.adapterNamespace!==h.chainNamespace)throw WalletInitializationError.incompatibleChainNameSpace(`This wallet adapter belongs to ${u.adapterNamespace} which is incompatible with currently used namespace: ${h.chainNamespace}`);return u.adapterNamespace===ADAPTER_NAMESPACES.MULTICHAIN&&u.currentChainNamespace&&h.chainNamespace!==u.currentChainNamespace&&u.setAdapterSettings({chainConfig:h}),this.walletAdapters[u.name]=u,this}clearCache(){storageAvailable(this.storage)&&(window[this.storage].removeItem(ADAPTER_CACHE_KEY),this.cachedAdapter=null)}async addChain(u){if(this.status===ADAPTER_STATUS.CONNECTED&&this.connectedAdapterName)return this.walletAdapters[this.connectedAdapterName].addChain(u);if(this.commonJRPCProvider)return this.commonJRPCProvider.addChain(u);throw WalletInitializationError.notReady("No wallet is ready")}async switchChain(u){if(this.status===ADAPTER_STATUS.CONNECTED&&this.connectedAdapterName)return this.walletAdapters[this.connectedAdapterName].switchChain(u);if(this.commonJRPCProvider)return this.commonJRPCProvider.switchChain(u);throw WalletInitializationError.notReady("No wallet is ready")}async connectTo(u,h){if(!this.walletAdapters[u]||!this.commonJRPCProvider)throw WalletInitializationError.notFound(`Please add wallet adapter for ${u} wallet, before connecting`);return new Promise((y,v)=>{this.once(ADAPTER_EVENTS.CONNECTED,b=>{y(this.provider)}),this.once(ADAPTER_EVENTS.ERRORED,b=>{v(b)}),this.walletAdapters[u].connect(h)})}async logout(u={cleanup:!1}){if(this.status!==ADAPTER_STATUS.CONNECTED||!this.connectedAdapterName)throw WalletLoginError.notConnectedError("No wallet is connected");await this.walletAdapters[this.connectedAdapterName].disconnect(u)}async getUserInfo(){if(loglevel.debug("Getting user info",this.status,this.connectedAdapterName),this.status!==ADAPTER_STATUS.CONNECTED||!this.connectedAdapterName)throw WalletLoginError.notConnectedError("No wallet is connected");return this.walletAdapters[this.connectedAdapterName].getUserInfo()}async enableMFA(u){if(this.status!==ADAPTER_STATUS.CONNECTED||!this.connectedAdapterName)throw WalletLoginError.notConnectedError("No wallet is connected");if(this.connectedAdapterName!==WALLET_ADAPTERS.AUTH)throw WalletLoginError.unsupportedOperation("EnableMFA is not supported for this adapter.");return this.walletAdapters[this.connectedAdapterName].enableMFA(u)}async manageMFA(u){if(this.status!==ADAPTER_STATUS.CONNECTED||!this.connectedAdapterName)throw WalletLoginError.notConnectedError("No wallet is connected");if(this.connectedAdapterName!==WALLET_ADAPTERS.AUTH)throw WalletLoginError.unsupportedOperation("ManageMFA is not supported for this adapter.");return this.walletAdapters[this.connectedAdapterName].manageMFA(u)}async authenticateUser(){if(this.status!==ADAPTER_STATUS.CONNECTED||!this.connectedAdapterName)throw WalletLoginError.notConnectedError("No wallet is connected");return this.walletAdapters[this.connectedAdapterName].authenticateUser()}addPlugin(u){if(this.plugins[u.name])throw WalletInitializationError.duplicateAdapterError(`Plugin ${u.name} already exist`);if(u.pluginNamespace!==PLUGIN_NAMESPACES.MULTICHAIN&&u.pluginNamespace!==this.coreOptions.chainConfig.chainNamespace)throw WalletInitializationError.incompatibleChainNameSpace(`This plugin belongs to ${u.pluginNamespace} namespace which is incompatible with currently used namespace: ${this.coreOptions.chainConfig.chainNamespace}`);return this.plugins[u.name]=u,this.status===ADAPTER_STATUS.CONNECTED&&this.connectedAdapterName&&this.connectToPlugins({adapter:this.connectedAdapterName}),this}getPlugin(u){return this.plugins[u]||null}subscribeToAdapterEvents(u){u.on(ADAPTER_EVENTS.CONNECTED,async h=>{if(!this.commonJRPCProvider)throw WalletInitializationError.notFound("CommonJrpcProvider not found");const{provider:y}=h;let v=y.provider||y;this.coreOptions.accountAbstractionProvider&&(h.adapter===WALLET_ADAPTERS.AUTH||h.adapter!==WALLET_ADAPTERS.AUTH&&this.coreOptions.useAAWithExternalWallet)&&(await this.coreOptions.accountAbstractionProvider.setupProvider(y),v=this.coreOptions.accountAbstractionProvider),this.commonJRPCProvider.updateProviderEngineProxy(v),this.connectedAdapterName=h.adapter,this.status=ADAPTER_STATUS.CONNECTED,this.cacheWallet(h.adapter),loglevel.debug("connected",this.status,this.connectedAdapterName),this.connectToPlugins(h),this.emit(ADAPTER_EVENTS.CONNECTED,_objectSpread2({},h))}),u.on(ADAPTER_EVENTS.DISCONNECTED,async()=>{if(this.status=ADAPTER_STATUS.READY,storageAvailable(this.storage)){const h=window[this.storage].getItem(ADAPTER_CACHE_KEY);this.connectedAdapterName===h&&this.clearCache()}loglevel.debug("disconnected",this.status,this.connectedAdapterName),await Promise.all(Object.values(this.plugins).map(h=>h.disconnect().catch(y=>{y.code!==5211&&loglevel.error(y)}))),this.connectedAdapterName=null,this.emit(ADAPTER_EVENTS.DISCONNECTED)}),u.on(ADAPTER_EVENTS.CONNECTING,h=>{this.status=ADAPTER_STATUS.CONNECTING,this.emit(ADAPTER_EVENTS.CONNECTING,h),loglevel.debug("connecting",this.status,this.connectedAdapterName)}),u.on(ADAPTER_EVENTS.ERRORED,h=>{this.status=ADAPTER_STATUS.ERRORED,this.clearCache(),this.emit(ADAPTER_EVENTS.ERRORED,h),loglevel.debug("errored",this.status,this.connectedAdapterName)}),u.on(ADAPTER_EVENTS.ADAPTER_DATA_UPDATED,h=>{loglevel.debug("adapter data updated",h),this.emit(ADAPTER_EVENTS.ADAPTER_DATA_UPDATED,h)}),u.on(ADAPTER_EVENTS.CACHE_CLEAR,h=>{loglevel.debug("adapter cache clear",h),storageAvailable(this.storage)&&this.clearCache()})}checkInitRequirements(){if(this.status===ADAPTER_STATUS.CONNECTING)throw WalletInitializationError.notReady("Already pending connection");if(this.status===ADAPTER_STATUS.CONNECTED)throw WalletInitializationError.notReady("Already connected");if(this.status===ADAPTER_STATUS.READY)throw WalletInitializationError.notReady("Adapter is already initialized")}cacheWallet(u){storageAvailable(this.storage)&&(window[this.storage].setItem(ADAPTER_CACHE_KEY,u),this.cachedAdapter=u)}connectToPlugins(u){Object.values(this.plugins).map(async h=>{try{if(!h.SUPPORTED_ADAPTERS.includes("all")&&!h.SUPPORTED_ADAPTERS.includes(u.adapter)||h.status===PLUGIN_STATUS.CONNECTED)return;const{authInstance:y}=this.walletAdapters[this.connectedAdapterName],{options:v,sessionId:b,sessionNamespace:w}=y||{};await h.initWithWeb3Auth(this,v?.whiteLabel),await h.connect({sessionId:b,sessionNamespace:w})}catch(y){if(y.code===5211)return;loglevel.error(y)}})}}class SolanaWallet{constructor(u){_defineProperty(this,"provider",void 0),this.provider=u}async requestAccounts(){return await this.provider.request({method:"requestAccounts"})}async signAndSendTransaction(u){const{signature:h}=await this.provider.request({method:"signAndSendTransaction",params:{message:u}});return{signature:h}}async signTransaction(u){return await this.provider.request({method:"signTransaction",params:{message:u}})}async signAllTransactions(u){return await this.provider.request({method:"signAllTransactions",params:{message:u}})}async signMessage(u){return await this.provider.request({method:"signMessage",params:{message:u}})}async request(u){return await this.provider.request(u)}}function createGetAccountsMiddleware({getAccounts:g}){return createAsyncMiddleware(async(u,h,y)=>{const{method:v}=u;if(v!=="getAccounts")return y();if(!g)throw new Error("WalletMiddleware - opts.getAccounts not provided");const b=await g(u);h.result=b})}function createRequestAccountsMiddleware({requestAccounts:g}){return createAsyncMiddleware(async(u,h,y)=>{const{method:v}=u;if(v!=="requestAccounts")return y();if(!g)throw new Error("WalletMiddleware - opts.requestAccounts not provided");const b=await g(u);h.result=b})}function createGenericJRPCMiddleware(g,u){return createAsyncMiddleware(async(h,y,v)=>{const{method:b}=h;if(b!==g)return v();if(!u)throw new Error(`WalletMiddleware - ${g} not provided`);const w=await u(h);y.result=w})}function createSolanaMiddleware(g){const{getAccounts:u,requestAccounts:h,signTransaction:y,signAndSendTransaction:v,signAllTransactions:b,signMessage:w,getPrivateKey:E,getSecretKey:_,getPublicKey:S}=g;return mergeMiddleware([createRequestAccountsMiddleware({requestAccounts:h}),createGetAccountsMiddleware({getAccounts:u}),createGenericJRPCMiddleware("signTransaction",y),createGenericJRPCMiddleware("signAndSendTransaction",v),createGenericJRPCMiddleware("signAllTransactions",b),createGenericJRPCMiddleware("signMessage",w),createGenericJRPCMiddleware("solanaPrivateKey",E),createGenericJRPCMiddleware("private_key",E),createGenericJRPCMiddleware("public_key",S),createGenericJRPCMiddleware("solanaPublicKey",S),createGenericJRPCMiddleware("solanaSecretKey",_)])}function createChainSwitchMiddleware({addNewChainConfig:g,switchSolanaChain:u}){return mergeMiddleware([createGenericJRPCMiddleware("addSolanaChain",g),createGenericJRPCMiddleware("switchSolanaChain",u)])}function createAccountMiddleware({updatePrivatekey:g}){return mergeMiddleware([createGenericJRPCMiddleware("updateAccount",g)])}function createChainIdMiddleware(g){return(u,h,y,v)=>u.method==="solana_chainId"?(h.result=g,v()):y()}function createProviderConfigMiddleware(g){return(u,h,y,v)=>u.method==="solana_provider_config"?(h.result=g,v()):y()}function createConfigMiddleware(g){const{chainId:u}=g;return mergeMiddleware([createChainIdMiddleware(u),createProviderConfigMiddleware(g)])}function createJsonRpcClient(g){const{rpcTarget:u}=g,h=createFetchMiddleware({rpcTarget:u});return{networkMiddleware:mergeMiddleware([createConfigMiddleware(g),h]),fetchMiddleware:h}}var src,hasRequiredSrc;function requireSrc(){if(hasRequiredSrc)return src;hasRequiredSrc=1;function g(u){if(u.length>=255)throw new TypeError("Alphabet too long");for(var h=new Uint8Array(256),y=0;y<h.length;y++)h[y]=255;for(var v=0;v<u.length;v++){var b=u.charAt(v),w=b.charCodeAt(0);if(h[w]!==255)throw new TypeError(b+" is ambiguous");h[w]=v}var E=u.length,_=u.charAt(0),S=Math.log(E)/Math.log(256),A=Math.log(256)/Math.log(E);function R(C){if(C instanceof Uint8Array||(ArrayBuffer.isView(C)?C=new Uint8Array(C.buffer,C.byteOffset,C.byteLength):Array.isArray(C)&&(C=Uint8Array.from(C))),!(C instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(C.length===0)return"";for(var I=0,L=0,$=0,B=C.length;$!==B&&C[$]===0;)$++,I++;for(var U=(B-$)*A+1>>>0,z=new Uint8Array(U);$!==B;){for(var ne=C[$],ue=0,he=U-1;(ne!==0||ue<L)&&he!==-1;he--,ue++)ne+=256*z[he]>>>0,z[he]=ne%E>>>0,ne=ne/E>>>0;if(ne!==0)throw new Error("Non-zero carry");L=ue,$++}for(var Y=U-L;Y!==U&&z[Y]===0;)Y++;for(var X=_.repeat(I);Y<U;++Y)X+=u.charAt(z[Y]);return X}function x(C){if(typeof C!="string")throw new TypeError("Expected String");if(C.length===0)return new Uint8Array;for(var I=0,L=0,$=0;C[I]===_;)L++,I++;for(var B=(C.length-I)*S+1>>>0,U=new Uint8Array(B);C[I];){var z=C.charCodeAt(I);if(z>255)return;var ne=h[z];if(ne===255)return;for(var ue=0,he=B-1;(ne!==0||ue<$)&&he!==-1;he--,ue++)ne+=E*U[he]>>>0,U[he]=ne%256>>>0,ne=ne/256>>>0;if(ne!==0)throw new Error("Non-zero carry");$=ue,I++}for(var Y=B-$;Y!==B&&U[Y]===0;)Y++;for(var X=new Uint8Array(L+(B-Y)),J=L;Y!==B;)X[J++]=U[Y++];return X}function T(C){var I=x(C);if(I)return I;throw new Error("Non-base"+E+" character")}return{encode:R,decodeUnsafe:x,decode:T}}return src=g,src}var bs58$1,hasRequiredBs58;function requireBs58(){return hasRequiredBs58||(hasRequiredBs58=1,bs58$1=requireSrc()("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")),bs58$1}var bs58Exports=requireBs58();const bs58=getDefaultExportFromCjs(bs58Exports);async function getProviderHandlers({privKey:g,keyExportEnabled:u,getProviderEngineProxy:h}){const y=()=>Keypair.fromSecretKey(Buffer.from(g,"hex"));if(typeof g!="string")throw WalletInitializationError.invalidParams("privKey must be a string");const v=y();return{requestAccounts:async()=>[v.publicKey.toBase58()],getAccounts:async()=>[v.publicKey.toBase58()],getPublicKey:async()=>v.publicKey.toBase58(),getPrivateKey:async()=>{if(!u)throw providerErrors.custom({message:"Private key export is disabled",code:4902});return g},getSecretKey:async()=>bs58.encode(v.secretKey),signTransaction:async w=>{var E;if(!((E=w.params)!==null&&E!==void 0&&E.message))throw rpcErrors.invalidParams("message");const _=w.params.message;return _.version!==void 0||_ instanceof VersionedTransaction?_.sign([v]):_.partialSign(v),_},signMessage:async w=>{var E;if(!((E=w.params)!==null&&E!==void 0&&E.message))throw rpcErrors.invalidParams("message");return nacl.sign.detached(w.params.message,v.secretKey)},signAndSendTransaction:async w=>{var E;if(!((E=w.params)!==null&&E!==void 0&&E.message))throw rpcErrors.invalidParams("message");const _=h();if(!_)throw providerErrors.custom({message:"Provider is not initialized",code:4902});const S=w.params.message;return S.version!==void 0||S instanceof VersionedTransaction?S.sign([v]):S.partialSign(v),{signature:await _.request({method:"sendTransaction",params:[Buffer.from(S.serialize()).toString("base64"),{encoding:"base64",preflightCommitment:"confirmed"}]})}},signAllTransactions:async w=>{var E,_,S;if(!((E=w.params)!==null&&E!==void 0&&E.message)||!((_=w.params)!==null&&_!==void 0&&_.message.length))throw rpcErrors.invalidParams("message");const A=(S=w.params)===null||S===void 0?void 0:S.message;for(const R of A||[]){const x=R;x.version!==void 0||x instanceof VersionedTransaction?x.sign([v]):x.partialSign(v)}return A}}}var _SolanaPrivateKeyProvider;class SolanaPrivateKeyProvider extends BaseProvider$1{constructor({config:u,state:h}){super({config:u,state:h}),_defineProperty(this,"PROVIDER_CHAIN_NAMESPACE",CHAIN_NAMESPACES.SOLANA)}async enable(){if(!this.state.privateKey)throw providerErrors.custom({message:"Private key is not found in state, plz pass it in constructor state param",code:4902});return await this.setupProvider(this.state.privateKey),this._providerEngineProxy.request({method:"eth_accounts"})}getEd25519Key(u){return getED25519Key(u).sk.toString("hex").padStart(128,"0")}async setupProvider(u){const{chainNamespace:h}=this.config.chainConfig;if(h!==this.PROVIDER_CHAIN_NAMESPACE)throw WalletInitializationError.incompatibleChainNameSpace("Invalid chain namespace");const y=await getProviderHandlers({privKey:u,getProviderEngineProxy:this.getProviderEngineProxy.bind(this),keyExportEnabled:this.config.keyExportEnabled}),v=createSolanaMiddleware(y),b=new JRPCEngine,{networkMiddleware:w}=createJsonRpcClient(this.config.chainConfig);b.push(this.getChainSwitchMiddleware()),b.push(this.getAccountMiddleware()),b.push(v),b.push(w);const E=providerFromEngine(b);this.updateProviderEngineProxy(E),await this.lookupNetwork()}async updateAccount(u){if(!this._providerEngineProxy)throw providerErrors.custom({message:"Provider is not initialized",code:4902});if(await this._providerEngineProxy.request({method:"solanaPrivateKey"})!==u.privateKey){await this.setupProvider(u.privateKey);const y=await this._providerEngineProxy.request({method:"requestAccounts"});this.emit("accountsChanged",y)}}async switchChain(u){if(!this._providerEngineProxy)throw providerErrors.custom({message:"Provider is not initialized",code:4902});const h=this.getChainConfig(u.chainId);this.update({chainId:"loading"}),this.configure({chainConfig:h});const y=await this._providerEngineProxy.request({method:"solanaPrivateKey"});await this.setupProvider(y)}async lookupNetwork(){if(!this._providerEngineProxy)throw providerErrors.custom({message:"Provider is not initialized",code:4902});const u=await this._providerEngineProxy.request({method:"getHealth",params:[]}),{chainConfig:h}=this.config;if(u!=="ok")throw WalletInitializationError.rpcConnectionError(`Failed to lookup network for following rpc target: ${h.rpcTarget}`);return this.update({chainId:h.chainId}),this.state.chainId!==h.chainId&&(this.emit("chainChanged",this.state.chainId),this.emit("connect",{chainId:this.state.chainId})),this.state.chainId}getChainSwitchMiddleware(){return createChainSwitchMiddleware({addNewChainConfig:async y=>{if(!y.params)throw rpcErrors.invalidParams("Missing request params");const{chainId:v,chainName:b,rpcUrls:w,blockExplorerUrls:E,nativeCurrency:_,iconUrls:S}=y.params;if(!v)throw rpcErrors.invalidParams("Missing chainId in chainParams");if(!w||w.length===0)throw rpcErrors.invalidParams("Missing rpcUrls in chainParams");if(!_)throw rpcErrors.invalidParams("Missing nativeCurrency in chainParams");this.addChain({chainNamespace:CHAIN_NAMESPACES.SOLANA,chainId:v,ticker:_?.symbol||"SOL",tickerName:_?.name||"Solana",displayName:b,rpcTarget:w[0],blockExplorerUrl:E?.[0]||"",decimals:_?.decimals||9,logo:S?.[0]||"https://images.toruswallet.io/sol.svg"})},switchSolanaChain:async y=>{if(!y.params)throw rpcErrors.invalidParams("Missing request params");if(!y.params.chainId)throw rpcErrors.invalidParams("Missing chainId");await this.switchChain(y.params)}})}getAccountMiddleware(){return createAccountMiddleware({updatePrivatekey:async h=>{if(!h.params)throw rpcErrors.invalidParams("Missing request params");if(!h.params.privateKey)throw rpcErrors.invalidParams("Missing privateKey");const{privateKey:y}=h.params;await this.updateAccount({privateKey:y})}})}}_SolanaPrivateKeyProvider=SolanaPrivateKeyProvider;_defineProperty(SolanaPrivateKeyProvider,"getProviderInstance",async g=>{const u=new _SolanaPrivateKeyProvider({config:{chainConfig:g.chainConfig}});return await u.setupProvider(g.privKey),u});var fastDeepEqual,hasRequiredFastDeepEqual;function requireFastDeepEqual(){return hasRequiredFastDeepEqual||(hasRequiredFastDeepEqual=1,fastDeepEqual=function g(u,h){if(u===h)return!0;if(u&&h&&typeof u=="object"&&typeof h=="object"){if(u.constructor!==h.constructor)return!1;var y,v,b;if(Array.isArray(u)){if(y=u.length,y!=h.length)return!1;for(v=y;v--!==0;)if(!g(u[v],h[v]))return!1;return!0}if(u.constructor===RegExp)return u.source===h.source&&u.flags===h.flags;if(u.valueOf!==Object.prototype.valueOf)return u.valueOf()===h.valueOf();if(u.toString!==Object.prototype.toString)return u.toString()===h.toString();if(b=Object.keys(u),y=b.length,y!==Object.keys(h).length)return!1;for(v=y;v--!==0;)if(!Object.prototype.hasOwnProperty.call(h,b[v]))return!1;for(v=y;v--!==0;){var w=b[v];if(!g(u[w],h[w]))return!1}return!0}return u!==u&&h!==h}),fastDeepEqual}var fastDeepEqualExports=requireFastDeepEqual();const dequal=getDefaultExportFromCjs(fastDeepEqualExports),SOLANA_METHOD_TYPES={GET_ACCOUNTS:"getAccounts",SOLANA_REQUEST_ACCOUNTS:"solana_requestAccounts"},SOLANA_CHAIN_IDS={SOLANA_MAINNET:"0x65"},EVM_METHOD_TYPES={GET_ACCOUNTS:"eth_accounts",ETH_REQUEST_ACCOUNTS:"eth_requestAccounts"};function isStream(g){return g!==null&&typeof g=="object"&&typeof g.pipe=="function"}function isWritableStream(g){return isStream(g)&&g.writable!==!1&&typeof g._write=="function"&&typeof g._writableState=="object"}function isReadableStream(g){return isStream(g)&&g.readable!==!1&&typeof g._read=="function"&&typeof g._readableState=="object"}function isDuplexStream(g){return isWritableStream(g)&&isReadableStream(g)}var messages={errors:{disconnected:()=>"Web3Auth: Lost connection to Web3Auth.",permanentlyDisconnected:()=>"Web3Auth: Disconnected from iframe. Page reload required.",unsupportedSync:g=>`Web3Auth: The Web3Auth Ethereum provider does not support synchronous methods like ${g} without a callback parameter.`,invalidDuplexStream:()=>"Must provide a Node.js-style duplex stream.",invalidOptions:g=>`Invalid options. Received: { maxEventListeners: ${g}}`,invalidRequestArgs:()=>"Expected a single, non-array, object argument.",invalidRequestMethod:()=>"'args.method' must be a non-empty string.",invalidRequestParams:()=>"'args.params' must be an object or array if provided.",invalidLoggerObject:()=>"'args.logger' must be an object if provided.",invalidLoggerMethod:g=>`'args.logger' must include required method '${g}'.`},info:{connected:g=>`Web3Auth: Connected to chain with ID "${g}".`}},log=loglevel$2.getLogger("ws-embed");function createErrorMiddleware(){return(g,u,h)=>{(typeof g.method!="string"||!g.method)&&(u.error=rpcErrors.invalidRequest({message:"The request 'method' must be a non-empty string.",data:_objectSpread2(_objectSpread2({},g||{}),{},{cause:"The request 'method' must be a non-empty string."})})),h(y=>{const{error:v}=u;return v&&log.error(`Ws-Embed - RPC Error: ${v.message}`,v),y()})}}function logStreamDisconnectWarning(g,u,h){let y=`Web3Auth: Lost connection to "${g}".`;u!=null&&u.stack&&(y+=`
${u.stack}`),log.warn(y),h&&h.listenerCount("error")>0&&h.emit("error",y)}const EMITTED_NOTIFICATIONS=["eth_subscription"];class BaseProvider extends SafeEventEmitter{constructor(u,{maxEventListeners:h=100,jsonRpcStreamName:y="provider"}){if(super(),_defineProperty(this,"rpcEngine",void 0),_defineProperty(this,"jsonRpcConnectionEvents",void 0),_defineProperty(this,"isWeb3Auth",void 0),_defineProperty(this,"state",void 0),!isDuplexStream(u))throw new Error(messages.errors.invalidDuplexStream());this.isWeb3Auth=!0,this.setMaxListeners(h),this.handleConnect=this.handleConnect.bind(this),this.handleDisconnect=this.handleDisconnect.bind(this),this.handleStreamDisconnect=this.handleStreamDisconnect.bind(this),this.rpcRequest=this.rpcRequest.bind(this),this.initializeState=this.initializeState.bind(this),this.request=this.request.bind(this),this.sendAsync=this.sendAsync.bind(this),this.send=this.send.bind(this);const v=new ObjectMultiplex;pump(u,v,u,this.handleStreamDisconnect.bind(this,"Web3Auth")),v.ignoreStream("phishing");const b=createStreamMiddleware();pump(b.stream,v.createStream(y),b.stream,this.handleStreamDisconnect.bind(this,"Web3Auth RpcProvider"));const w=new JRPCEngine;w.push(createIdRemapMiddleware()),w.push(createErrorMiddleware()),w.push(createLoggerMiddleware({origin:location.origin})),w.push(b.middleware),this.rpcEngine=w,this.jsonRpcConnectionEvents=b.events}async request(u){if(!u||typeof u!="object"||Array.isArray(u))throw rpcErrors.invalidRequest({message:messages.errors.invalidRequestArgs(),data:_objectSpread2(_objectSpread2({},u||{}),{},{cause:messages.errors.invalidRequestArgs()})});const{method:h,params:y}=u;if(typeof h!="string"||h.length===0)throw rpcErrors.invalidRequest({message:messages.errors.invalidRequestMethod(),data:_objectSpread2(_objectSpread2({},u||{}),{},{cause:messages.errors.invalidRequestArgs()})});if(y!==void 0&&!Array.isArray(y)&&(typeof y!="object"||y===null))throw rpcErrors.invalidRequest({message:messages.errors.invalidRequestParams(),data:_objectSpread2(_objectSpread2({},u||{}),{},{cause:messages.errors.invalidRequestArgs()})});return new Promise((v,b)=>{this.rpcRequest({method:h,params:y},getRpcPromiseCallback(v,b))})}send(u,h){this.rpcRequest(u,h)}sendAsync(u){return new Promise((h,y)=>{this.rpcRequest(u,getRpcPromiseCallback(h,y))})}handleStreamDisconnect(u,h){logStreamDisconnectWarning(u,h,this),this.handleDisconnect(!1,h?h.message:void 0)}}const WS_EMBED_BUILD_ENV={PRODUCTION:"production",STAGING:"staging",DEVELOPMENT:"development",TESTING:"testing"},BUTTON_POSITION={BOTTOM_LEFT:"bottom-left",TOP_LEFT:"top-left",BOTTOM_RIGHT:"bottom-right",TOP_RIGHT:"top-right"};class PopupHandler extends SafeEventEmitter{constructor({url:u,target:h,features:y,timeout:v=3e4}){super(),_defineProperty(this,"url",void 0),_defineProperty(this,"target",void 0),_defineProperty(this,"features",void 0),_defineProperty(this,"window",void 0),_defineProperty(this,"windowTimer",void 0),_defineProperty(this,"iClosedWindow",void 0),_defineProperty(this,"timeout",void 0),this.url=u,this.target=h||"_blank",this.features=y||getPopupFeatures(FEATURES_DEFAULT_POPUP_WINDOW),this.window=void 0,this.windowTimer=void 0,this.iClosedWindow=!1,this.timeout=v,this._setupTimer()}_setupTimer(){this.windowTimer=Number(setInterval(()=>{this.window&&this.window.closed&&(clearInterval(this.windowTimer),setTimeout(()=>{this.iClosedWindow||this.emit("close"),this.iClosedWindow=!1,this.window=void 0},this.timeout)),this.window===void 0&&clearInterval(this.windowTimer)},500))}open(){var u;this.window=window.open(this.url.href,this.target,this.features),(u=this.window)!==null&&u!==void 0&&u.focus&&this.window.focus()}close(){this.iClosedWindow=!0,this.window&&this.window.close()}redirect(u){u?window.location.replace(this.url.href):window.location.href=this.url.href}}class CommunicationProvider extends BaseProvider{constructor(u,{maxEventListeners:h=100,jsonRpcStreamName:y="provider"},v){super(u,{maxEventListeners:h,jsonRpcStreamName:y}),_defineProperty(this,"tryWindowHandle",void 0),_defineProperty(this,"windowRefs",void 0),_defineProperty(this,"iframeUrl",void 0),_defineProperty(this,"iframeId",void 0),this.state=_objectSpread2(_objectSpread2({},CommunicationProvider.defaultState),v),this.iframeUrl="",this.iframeId="",this.windowRefs=new Map,this.on("connect",()=>{this.state.isConnected=!0});const b=w=>{const{method:E,params:_}=w;if(E===COMMUNICATION_NOTIFICATIONS.IFRAME_STATUS){const{isFullScreen:S,rid:A}=_;this.displayIframe({isFull:S,rid:A},!0)}else if(E===COMMUNICATION_NOTIFICATIONS.CLOSE_WINDOW)this.handleCloseWindow(_);else if(E===COMMUNICATION_NOTIFICATIONS.USER_LOGGED_IN){const{currentLoginProvider:S}=_;this.state.isLoggedIn=!0,this.state.currentLoginProvider=S}else if(E===COMMUNICATION_NOTIFICATIONS.USER_LOGGED_OUT)this.state.isLoggedIn=!1,this.state.currentLoginProvider=null,this.displayIframe({isFull:!1},!0);else if(E===COMMUNICATION_NOTIFICATIONS.TOGGLE_WIDGET_BUTTON){const{show:S}=_;this.state.widgetVisibility=S,this.displayIframe()}else if(E===COMMUNICATION_NOTIFICATIONS.ALLOW_WALLET_SERVICE){const{allow:S}=_;this.state.allowWalletService=S}};this.jsonRpcConnectionEvents.on("notification",b)}get isLoggedIn(){return this.state.isLoggedIn}get isIFrameFullScreen(){return this.state.isIFrameFullScreen}get allowWalletService(){return this.state.allowWalletService}isConnected(){return this.state.isConnected}async initializeState(u){try{const{torusUrl:h,torusIframeId:y}=u;this.iframeUrl=h,this.iframeId=y;const{currentLoginProvider:v,isLoggedIn:b}=await this.request({method:COMMUNICATION_JRPC_METHODS.GET_PROVIDER_STATE,params:[]});b&&this.handleConnect(v,b)}catch(h){log.error("Web3Auth: Failed to get initial state. Please report this bug.",h)}finally{log.info("initialized communication state"),this.state.initialized=!0}}displayIframe({isFull:u=!1,rid:h=""}={},y=!1){const v={};if(u)v.display="block",v.width="100%",v.height="100%",v.top="0px",v.right="0px",v.left="0px",v.bottom="0px";else switch(v.display=this.state.widgetVisibility?"block":"none",v.height=this.state.widgetVisibility?"70px":"0px",v.width=this.state.widgetVisibility?"70px":"0px",this.state.buttonPosition){case BUTTON_POSITION.TOP_LEFT:v.top="0px",v.left="0px",v.right="auto",v.bottom="auto";break;case BUTTON_POSITION.TOP_RIGHT:v.top="0px",v.right="0px",v.left="auto",v.bottom="auto";break;case BUTTON_POSITION.BOTTOM_RIGHT:v.bottom="0px",v.right="0px",v.top="auto",v.left="auto";break;case BUTTON_POSITION.BOTTOM_LEFT:default:v.bottom="0px",v.left="0px",v.top="auto",v.right="auto";break}const b=document.getElementById(this.iframeId);Object.assign(b.style,v),this.state.isIFrameFullScreen=u,y||this.request({method:COMMUNICATION_JRPC_METHODS.IFRAME_STATUS,params:{isIFrameFullScreen:u,rid:h}})}async handleWindow(u,{url:h,target:y,features:v,timeout:b}={}){const w=new URL(h||`${this.iframeUrl}/redirect?windowId=${u}&sessionNamespace=${window.location.hostname}`),E=new PopupHandler({url:w,target:y,features:v,timeout:b});if(E.open(),!E.window){this.displayIframe({isFull:!0}),this.request({method:COMMUNICATION_JRPC_METHODS.WINDOW_BLOCKED,params:{windowId:u,finalUrl:w.href}});return}this.windowRefs.set(u,E),E.once("close",()=>{this.windowRefs.delete(u),this.request({method:COMMUNICATION_JRPC_METHODS.CLOSED_WINDOW,params:{windowId:u}})})}rpcRequest(u,h){const y=h,v=u;Array.isArray(v)||v.jsonrpc||(v.jsonrpc="2.0"),this.rpcEngine.handle(v,y)}handleConnect(u,h){this.state.isConnected||(this.state.isConnected=!0,this.emit("connect",{currentLoginProvider:u,isLoggedIn:h}),log.debug(messages.info.connected(u)))}handleDisconnect(u,h){if(this.state.isConnected||!this.state.isPermanentlyDisconnected&&!u){this.state.isConnected=!1;let y;u?(y=new EthereumProviderError(1013,h||messages.errors.disconnected()),log.debug(y)):(y=new EthereumProviderError(1011,h||messages.errors.permanentlyDisconnected()),log.error(y),this.state.currentLoginProvider=null,this.state.isLoggedIn=!1,this.state.widgetVisibility=!1,this.state.isIFrameFullScreen=!1,this.state.isPermanentlyDisconnected=!0),this.emit("disconnect",y)}}handleCloseWindow(u){const{windowId:h}=u;this.windowRefs.has(h)&&(this.windowRefs.get(h).close(),this.windowRefs.delete(h))}}_defineProperty(CommunicationProvider,"defaultState",{buttonPosition:"bottom-left",currentLoginProvider:null,isIFrameFullScreen:!1,widgetVisibility:!1,initialized:!1,isLoggedIn:!1,isPermanentlyDisconnected:!1,isConnected:!1,hasEmittedConnection:!1,allowWalletService:!1});class TorusInPageProvider extends BaseProvider{constructor(u,{maxEventListeners:h=100,jsonRpcStreamName:y="provider"}){super(u,{maxEventListeners:h,jsonRpcStreamName:y}),_defineProperty(this,"chainId",void 0),_defineProperty(this,"selectedAddress",void 0),_defineProperty(this,"tryWindowHandle",void 0),this.state=_objectSpread2({},TorusInPageProvider.defaultState),this.selectedAddress=null,this.chainId=null,this.handleAccountsChanged=this.handleAccountsChanged.bind(this),this.handleChainChanged=this.handleChainChanged.bind(this),this.handleUnlockStateChanged=this.handleUnlockStateChanged.bind(this),this.on("connect",()=>{this.state.isConnected=!0});const v=b=>{const{method:w,params:E}=b;w===PROVIDER_NOTIFICATIONS.ACCOUNTS_CHANGED?this.handleAccountsChanged(E):w===PROVIDER_NOTIFICATIONS.UNLOCK_STATE_CHANGED?this.handleUnlockStateChanged(E):w===PROVIDER_NOTIFICATIONS.CHAIN_CHANGED?this.handleChainChanged(E):EMITTED_NOTIFICATIONS.includes(w)&&(this.emit("data",b),this.emit("notification",E.result),this.emit("message",{type:w,data:E}))};this.jsonRpcConnectionEvents.on("notification",v)}isConnected(){return this.state.isConnected}async initializeState(){try{const{accounts:u,chainId:h,isUnlocked:y}=await this.request({method:PROVIDER_JRPC_METHODS.GET_PROVIDER_STATE,params:[]});this.emit("connect",{chainId:h}),this.handleChainChanged({chainId:h}),this.handleUnlockStateChanged({accounts:u,isUnlocked:y}),this.handleAccountsChanged(u)}catch(u){log.error("WsEmbed: Failed to get initial state. Please report this bug.",u)}finally{log.info("initialized provider state"),this.state.initialized=!0}}rpcRequest(u,h,y=!1){let v=h;const b=u;if(!Array.isArray(b)){if(b.jsonrpc||(b.jsonrpc="2.0"),[EVM_METHOD_TYPES.GET_ACCOUNTS,EVM_METHOD_TYPES.ETH_REQUEST_ACCOUNTS,SOLANA_METHOD_TYPES.SOLANA_REQUEST_ACCOUNTS,SOLANA_METHOD_TYPES.GET_ACCOUNTS].includes(b.method))v=(w,E)=>{this.handleAccountsChanged(E.result||[],b.method==="eth_accounts",y),h(w,E)};else if(b.method==="wallet_getProviderState"){this.rpcEngine.handle(u,v);return}}this.tryWindowHandle(b,v)}handleConnect(u){this.state.isConnected||(this.state.isConnected=!0,this.emit("connect",{chainId:u}),log.debug(messages.info.connected(u)))}handleDisconnect(u,h){if(this.state.isConnected||!this.state.isPermanentlyDisconnected&&!u){this.state.isConnected=!1;let y;u?(y=new EthereumProviderError(1013,h||messages.errors.disconnected()),log.debug(y)):(y=new EthereumProviderError(1011,h||messages.errors.permanentlyDisconnected()),log.error(y),this.chainId=null,this.state.accounts=null,this.selectedAddress=null,this.state.isUnlocked=!1,this.state.isPermanentlyDisconnected=!0),this.emit("disconnect",y)}}handleAccountsChanged(u,h=!1,y=!1){let v=u;Array.isArray(v)||(log.error("WsEmbed: Received non-array accounts parameter. Please report this bug.",v),v=[]);for(const b of u)if(typeof b!="string"){log.error("WsEmbed: Received non-string account. Please report this bug.",u),v=[];break}dequal(this.state.accounts,v)||(h&&Array.isArray(this.state.accounts)&&this.state.accounts.length>0&&!y&&log.error('WsEmbed: "eth_accounts" unexpectedly updated accounts. Please report this bug.',v),this.state.accounts=v,this.emit("accountsChanged",v)),this.selectedAddress!==v[0]&&(this.selectedAddress=v[0]||null)}handleChainChanged({chainId:u}={}){if(!u){log.error("WsEmbed: Received invalid network parameters. Please report this bug.",{chainId:u});return}u==="loading"?this.handleDisconnect(!0):(this.handleConnect(u),u!==this.chainId&&(this.chainId=u,this.state.initialized&&this.emit("chainChanged",this.chainId)))}handleUnlockStateChanged({accounts:u,isUnlocked:h}={}){if(typeof h!="boolean"){log.error("WsEmbed: Received invalid isUnlocked parameter. Please report this bug.",{isUnlocked:h});return}h!==this.state.isUnlocked&&(this.state.isUnlocked=h,this.handleAccountsChanged(u||[]))}}_defineProperty(TorusInPageProvider,"defaultState",{accounts:null,isConnected:!1,isUnlocked:!1,initialized:!1,isPermanentlyDisconnected:!1,hasEmittedConnection:!1});const version="4.0.14",addedVersion=`v${version.split(".")[0]}`,WALLET_URLS_DEFAULT={[WS_EMBED_BUILD_ENV.TESTING]:{url:"https://develop-wallet.web3auth.io",logLevel:"debug"},[WS_EMBED_BUILD_ENV.DEVELOPMENT]:{url:"http://localhost:4050",logLevel:"debug"},[WS_EMBED_BUILD_ENV.STAGING]:{url:`https://staging-wallet.web3auth.io/${addedVersion}`,logLevel:"debug"},[WS_EMBED_BUILD_ENV.PRODUCTION]:{url:`https://wallet.web3auth.io/${addedVersion}`,logLevel:"error"}};(async function g(){try{if(typeof document>"u")return;const u=document.createElement("link"),{url:h}=WALLET_URLS_DEFAULT.production;u.href=`${h}/frame`,u.crossOrigin="anonymous",u.type="text/html",u.rel="prefetch",u.relList&&u.relList.supports&&u.relList.supports("prefetch")&&document.head.appendChild(u)}catch(u){log.warn(u)}})();const clientId="BIcF8x3jW7FR6hqAedtD8s0sjsyCsGSRk_sLnuCdDThbaYyk7op5q8J_F3ywacftuWmzHrL39PFZjYocu5vHQMU",chainConfig={chainNamespace:CHAIN_NAMESPACES.SOLANA,chainId:SOLANA_CHAIN_IDS.SOLANA_MAINNET,rpcTarget:"https://marni-l6uvpy-fast-mainnet.helius-rpc.com",displayName:"Solana Mainnet",blockExplorerUrl:"https://explorer.solana.com",ticker:"SOL",tickerName:"Solana",decimals:9,logo:"https://images.toruswallet.io/solana.svg"},useAuth=()=>{const g=useState("web3auth",()=>null),u=useState("provider",()=>null),h=useState("userInfo",()=>null),y=useState("account",()=>null),v=useState("isAuthenticated",()=>!1),b=ref$1(null),w=useState("privateKey",()=>null);async function E(C){const I=Buffer.from(C,"hex").slice(0,32),L=useLocalStorage("modifier",crypto.randomUUID()),$=Buffer.from(L.value).slice(0,4),B=Buffer.concat([I.slice(0,28),$]),U=await generateKeyPairFromSeed("Ed25519",B),z=await SolanaPrivateKeyProvider.getProviderInstance({chainConfig,privKey:Buffer.from(U.raw).toString("hex")});u.value=new SolanaWallet(z),y.value=(await u.value.requestAccounts())[0]}const _=async()=>{const C=await u.value?.request({method:"solanaPrivateKey",params:[]});if(!C)throw new Error("Failed to retrieve private key from provider");return C},S=async()=>{try{const C=new SolanaPrivateKeyProvider({config:{chainConfig}}),I={clientId,web3AuthNetwork:WEB3AUTH_NETWORK.SAPPHIRE_DEVNET,privateKeyProvider:C,chainConfig},L=new Web3AuthNoModal(I),$=`${window.location.origin}/web3auth-callback`,B=new AuthAdapter({privateKeyProvider:C,adapterSettings:{redirectUrl:$,uxMode:UX_MODE.REDIRECT}});L.configureAdapter(B),await L.init(),g.value=L}catch(C){b.value="Failed to initialize Web3Auth",console.error(C)}};return{init:S,loginWithWeb3Auth:async C=>{g.value||await S();try{if(g.value?.status!=="ready")throw new Error("Failed to connect");C&&(console.log("Connecting with provider:",C),await g.value.connectTo(WALLET_ADAPTERS.AUTH,{loginProvider:C}));const I=await g.value.provider?.request({method:"solanaPrivateKey"});E(I),h.value=await g.value?.getUserInfo().then(L=>({username:L.name||"Web3Auth User",profileImage:L.profileImage||"https://avatars.dicebear.com/api/identicon/default.svg"})),v.value=!0,localStorage.setItem("authMethod","web3auth")}catch(I){b.value="Web3Auth login failed",console.error(I)}},loginWithPrivateKey:async C=>{try{E(C),h.value={username:"Anonymous Worker",profileImage:"/img/avatar.jpg"},v.value=!0,localStorage.setItem("authMethod","privateKey"),localStorage.setItem("userInfo",JSON.stringify(h.value)),localStorage.setItem("privateKey",C)}catch(I){b.value="Private key login failed",console.error(I)}},logout:async()=>{g.value&&await g.value.logout(),u.value=null,h.value=null,v.value=!1,localStorage.removeItem("authMethod"),localStorage.removeItem("userInfo"),localStorage.removeItem("privateKey")},checkSession:async()=>{const C=localStorage.getItem("authMethod");if(C==="web3auth"){if(await S(),g.value?.status==="connected"){const I=await g.value.provider?.request({method:"solanaPrivateKey"});if(!I){b.value="Failed to retrieve private key from Web3Auth";return}h.value=await g.value?.getUserInfo().then(L=>({username:L.name||"Web3Auth User",profileImage:L.profileImage||"https://avatars.dicebear.com/api/identicon/default.svg"})),w.value=I,v.value=!0}}else if(C==="privateKey"){const I=localStorage.getItem("userInfo");if(I){h.value=JSON.parse(I),v.value=!0;const L=localStorage.getItem("privateKey");L?w.value=L:b.value="Private key not found in localStorage"}}if(v.value&&w.value){await E(w.value);const{initialize:I}=useWorkerStore();if(w.value)try{const L=Buffer.from(w.value,"hex").slice(0,32);await I(L)}catch(L){b.value="Failed to initialize worker with private key",console.error(L)}}},requestPrivateKey:_,provider:u,userInfo:h,isAuthenticated:v,error:b,web3Auth:g,privateKey:w,account:y}};export{containsBytes as $,SOLANA_ERROR__SUBTLE_CRYPTO__EXPORT_FUNCTION_UNIMPLEMENTED as A,SOLANA_ERROR__SUBTLE_CRYPTO__DISALLOWED_IN_INSECURE_CONTEXT as B,SOLANA_ERROR__SUBTLE_CRYPTO__SIGN_FUNCTION_UNIMPLEMENTED as C,SOLANA_ERROR__SUBTLE_CRYPTO__VERIFY_FUNCTION_UNIMPLEMENTED as D,transformEncoder as E,fixEncoderSize as F,isSolanaError as G,SOLANA_ERROR__ADDRESSES__FAILED_TO_FIND_VIABLE_PDA_BUMP_SEED as H,SOLANA_ERROR__ADDRESSES__MAX_NUMBER_OF_PDA_SEEDS_EXCEEDED as I,SOLANA_ERROR__ADDRESSES__MAX_PDA_SEED_LENGTH_EXCEEDED as J,Keypair as K,SOLANA_ERROR__ADDRESSES__INVALID_SEEDS_POINT_ON_CURVE as L,SOLANA_ERROR__ADDRESSES__INVALID_ED25519_PUBLIC_KEY as M,combineCodec as N,SOLANA_ERROR__ADDRESSES__STRING_LENGTH_OUT_OF_RANGE as O,SOLANA_ERROR__ADDRESSES__INVALID_BYTE_LENGTH as P,fixDecoderSize as Q,getEncodedSize as R,SolanaError as S,getU32Encoder as T,isFixedSize as U,SOLANA_ERROR__CODECS__INVALID_NUMBER_OF_ITEMS as V,getU8Encoder as W,SOLANA_ERROR__CODECS__CANNOT_USE_LEXICAL_VALUES_AS_ENUM_DISCRIMINATORS as X,SOLANA_ERROR__CODECS__INVALID_ENUM_VARIANT as Y,transformDecoder as Z,getU8Decoder as _,useWorkerStore as a,requireCryptoBrowserify as a$,SOLANA_ERROR__CODECS__INVALID_CONSTANT as a0,getU32Decoder as a1,SOLANA_ERROR__CODECS__UNION_VARIANT_OUT_OF_RANGE as a2,SOLANA_ERROR__CODECS__ENUM_DISCRIMINATOR_OUT_OF_RANGE as a3,SOLANA_ERROR__CODECS__INVALID_DISCRIMINATED_UNION_VARIANT as a4,assertIsFixedSize as a5,SOLANA_ERROR__KEYS__INVALID_KEY_PAIR_BYTE_LENGTH as a6,SOLANA_ERROR__KEYS__PUBLIC_KEY_MUST_MATCH_PRIVATE_KEY as a7,SOLANA_ERROR__KEYS__INVALID_PRIVATE_KEY_BYTE_LENGTH as a8,SOLANA_ERROR__SUBTLE_CRYPTO__CANNOT_EXPORT_NON_EXTRACTABLE_KEY as a9,SOLANA_ERROR__SIGNER__ADDRESS_CANNOT_HAVE_MULTIPLE_SIGNERS as aA,getSolanaErrorFromTransactionError as aB,SOLANA_ERROR__BLOCK_HEIGHT_EXCEEDED as aC,ed25519 as aD,LayoutExports as aE,coerce$1 as aF,string$1 as aG,instance as aH,tuple as aI,literal as aJ,unknown as aK,type$1 as aL,number$1 as aM,array as aN,nullable as aO,optional$1 as aP,boolean as aQ,record as aR,union as aS,create$1 as aT,secp256k1$2 as aU,bs58$2 as aV,BN as aW,sha256$4 as aX,any as aY,libExports as aZ,getDefaultExportFromCjs as a_,SOLANA_ERROR__RPC__API_PLAN_MISSING_FOR_RPC_METHOD as aa,getSolanaErrorFromJsonRpcError as ab,SOLANA_ERROR__RPC__TRANSPORT_HTTP_ERROR as ac,SOLANA_ERROR__RPC__INTEGER_OVERFLOW as ad,safeCaptureStackTrace as ae,SOLANA_ERROR__INVARIANT_VIOLATION__SUBSCRIPTION_ITERATOR_STATE_MISSING as af,SOLANA_ERROR__INVARIANT_VIOLATION__SUBSCRIPTION_ITERATOR_MUST_NOT_POLL_BEFORE_RESOLVING_EXISTING_MESSAGE_PROMISE as ag,SOLANA_ERROR__RPC_SUBSCRIPTIONS__CANNOT_CREATE_SUBSCRIPTION_PLAN as ah,SOLANA_ERROR__RPC_SUBSCRIPTIONS__EXPECTED_SERVER_SUBSCRIPTION_ID as ai,SOLANA_ERROR__INVARIANT_VIOLATION__DATA_PUBLISHER_CHANNEL_UNIMPLEMENTED as aj,SOLANA_ERROR__RPC_SUBSCRIPTIONS__CHANNEL_CONNECTION_CLOSED as ak,SOLANA_ERROR__RPC_SUBSCRIPTIONS__CHANNEL_FAILED_TO_CONNECT as al,SOLANA_ERROR__RPC_SUBSCRIPTIONS__CHANNEL_CLOSED_BEFORE_MESSAGE_BUFFERED as am,SOLANA_ERROR__INVARIANT_VIOLATION__SWITCH_MUST_BE_EXHAUSTIVE as an,SOLANA_ERROR__LAMPORTS_OUT_OF_RANGE as ao,getShortU16Encoder as ap,SOLANA_ERROR__TRANSACTION__VERSION_NUMBER_OUT_OF_RANGE as aq,addEncoderSizePrefix as ar,SOLANA_ERROR__TRANSACTION__INVOKED_PROGRAMS_MUST_NOT_BE_WRITABLE as as,SOLANA_ERROR__TRANSACTION__INVOKED_PROGRAMS_CANNOT_PAY_FEES as at,SOLANA_ERROR__TRANSACTION__FEE_PAYER_SIGNATURE_MISSING as au,SOLANA_ERROR__TRANSACTION__SIGNATURES_MISSING as av,SOLANA_ERROR__TRANSACTION__ADDRESSES_CANNOT_SIGN_TRANSACTION as aw,SOLANA_ERROR__TRANSACTION__CANNOT_ENCODE_WITH_EMPTY_SIGNATURES as ax,SOLANA_ERROR__SIGNER__TRANSACTION_SENDING_SIGNER_MISSING as ay,SOLANA_ERROR__SIGNER__TRANSACTION_CANNOT_HAVE_MULTIPLE_SENDING_SIGNERS as az,requireObjectKeys as b,require$$8 as b0,padLeftEncoder as b1,getU64Encoder as b2,getU16Encoder as b3,getI16Encoder as b4,getF64Encoder as b5,getU64Decoder as b6,getU16Decoder as b7,addDecoderSizePrefix as b8,getI16Decoder as b9,getF64Decoder as ba,SOLANA_ERROR__TRANSACTION_ERROR__ALREADY_PROCESSED as bb,require_stream_readable$1 as bc,require_stream_writable$1 as bd,require_stream_duplex$1 as be,require_stream_transform$1 as bf,require_stream_passthrough$1 as bg,requireEndOfStream$2 as bh,requirePipeline$1 as bi,__viteBrowserExternal as bj,requireShams$1 as c,requireCallBound as d,requireEsObjectAtoms as e,fromString as f,requireCallBind as g,requireGetIntrinsic as h,requireDefineDataProperty as i,requireHasPropertyDescriptors as j,decodeTime as k,createDecoder as l,multiaddr as m,createEncoder as n,SOLANA_ERROR__CODECS__INVALID_STRING_FOR_BASE as o,peerIdFromString$1 as p,SOLANA_ERROR__ACCOUNTS__FAILED_TO_DECODE_ACCOUNT as q,requireUtil$2 as r,sha512$3 as s,toString$1 as t,useAuth as u,SOLANA_ERROR__ACCOUNTS__ACCOUNT_NOT_FOUND as v,SOLANA_ERROR__SUBTLE_CRYPTO__DIGEST_UNIMPLEMENTED as w,SOLANA_ERROR__CRYPTO__RANDOM_VALUES_FUNCTION_UNIMPLEMENTED as x,SOLANA_ERROR__SUBTLE_CRYPTO__GENERATE_FUNCTION_UNIMPLEMENTED as y,SOLANA_ERROR__SUBTLE_CRYPTO__ED25519_ALGORITHM_UNIMPLEMENTED as z};
